{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\routes\\universe.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\routes\\universe.ts"],"sourcesContent":["import express from 'express';\nimport { generateUniverse } from '../scripts/generateUniverse';\nimport { authenticate, AuthRequest } from '../middleware/auth';\nimport { isValidCoordinate, parseCoord } from '@game/shared';\nimport { ERROR_MESSAGES } from '../constants/response-formats';\n\n// Constants imports for eliminating hardcoded values\nimport { DB_TABLES, DB_FIELDS } from '../constants/database-fields';\n\n\nimport { HTTP_STATUS } from '@game/shared';\nimport { supabase } from '../config/supabase';\nconst router: express.Router = express.Router();\n\n// Map Overhaul star kinds to display colors (used for galaxy/region coloring)\nfunction colorForStarKind(kind?: string): string {\n  switch (kind) {\n    case 'YELLOW': return '#FFF4EA';\n    case 'ORANGE': return '#FFD2A1';\n    case 'WHITE': return '#F8F7FF';\n    case 'BLUE': return '#AABFFF';\n    case 'RED_GIANT': return '#FF6B6B';\n    case 'SUPER_GIANT': return '#FAD860';\n    case 'WHITE_DWARF': return '#CAD7FF';\n    case 'NEUTRON': return '#9BB0FF';\n    default: return '#FFFFFF';\n  }\n}\n\n/**\n * GET /api/universe/:coord\n * Fetch details for a specific coordinate\n */\nrouter.get('/coord/:coord', authenticate, async (req: AuthRequest, res) => {\n  try {\n    const { coord } = req.params;\n\n    // Validate coordinate format\n    if (!isValidCoordinate(coord)) {\n      return res.status(HTTP_STATUS.BAD_REQUEST).json({\n        success: false,\n        error: 'Invalid coordinate format. Expected format: A00:10:22:10'\n      });\n    }\n\n    const { data: row } = await supabase\n      .from(DB_TABLES.LOCATIONS)\n      .select('*')\n      .eq('coord', coord)\n      .maybeSingle();\n\n    if (!row) {\n      return res.status(HTTP_STATUS.NOT_FOUND).json({ success: false, error: ERROR_MESSAGES.LOCATION_NOT_FOUND });\n    }\n\n    // Optionally load owner username\n    let ownerInfo: any = null;\n    if ((row as any).owner_id) {\n      const u = await supabase\n        .from(DB_TABLES.USERS)\n        .select('id, username')\n        .eq(DB_FIELDS.BUILDINGS.ID, (row as any).owner_id)\n        .maybeSingle();\n      if (u.data) ownerInfo = { id: u.data.id, username: u.data.username };\n    }\n\n    const coordComponents = parseCoord(coord);\n    return res.json({\n      success: true,\n      data: {\n        coord: row.coord,\n        type: row.type,\n        owner: ownerInfo,\n        orbitPosition: (row as any).orbit_position ?? null,\n        terrain: (row as any).terrain ?? null,\n        positionBase: (row as any).position_base ?? null,\n        starApplied: (row as any).star_applied ?? null,\n        result: (row as any).result ?? null,\n        starOverhaul: (row as any).star_overhaul ?? null,\n        context: {\n          server: coordComponents.server,\n          galaxy: coordComponents.galaxy,\n          region: coordComponents.region,\n          system: coordComponents.system,\n          body: coordComponents.body,\n        },\n        createdAt: (row as any).created_at ?? null,\n      },\n    });\n  } catch (error) {\n    console.error('Error fetching location:', error);\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: ERROR_MESSAGES.INTERNAL_ERROR\n    });\n  }\n});\n\n/**\n * GET /api/universe/system/:server/:galaxy/:region/:system\n * Fetch all bodies in a star system\n */\nrouter.get('/system/:server/:galaxy/:region/:system', authenticate, async (req: AuthRequest, res) => {\n  try {\n    const { server, galaxy, region, system } = req.params;\n\n    // Validate parameters\n    const galaxyNum = parseInt(galaxy, 10);\n    const regionNum = parseInt(region, 10);\n    const systemNum = parseInt(system, 10);\n\n    if (\n      isNaN(galaxyNum) || galaxyNum < 0 || galaxyNum > 39 ||\n      isNaN(regionNum) || regionNum < 0 || regionNum > 99 ||\n      isNaN(systemNum) || systemNum < 0 || systemNum > 99\n    ) {\n      return res.status(HTTP_STATUS.BAD_REQUEST).json({\n        success: false,\n        error: 'Invalid system coordinates'\n      });\n    }\n\n    // Build coordinate pattern for this system\n    const prefix = `${server}${galaxy.padStart(2,'0')}:${region.padStart(2,'0')}:${system.padStart(2,'0')}:`;\n    const { data: rows } = await supabase\n      .from(DB_TABLES.LOCATIONS)\n      .select('*')\n      .like('coord', `${prefix}%`)\n      .order('coord', { ascending: true });\n\n    const response = {\n      success: true,\n      data: {\n        system: { server, galaxy: galaxyNum, region: regionNum, system: systemNum },\n        bodies: (rows || []).map((body: any) => ({\n          coord: body.coord,\n          type: body.type,\n          owner: body.owner_id ? { id: body.owner_id, username: null } : null,\n          orbitPosition: body.orbit_position ?? null,\n          terrain: body.terrain ?? null,\n          positionBase: body.position_base ?? null,\n          starApplied: body.star_applied ?? null,\n          result: body.result ?? null,\n          starOverhaul: body.star_overhaul ?? null,\n        })),\n      },\n    };\n    res.json(response);\n\n  } catch (error) {\n    console.error('Error fetching system:', error);\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: ERROR_MESSAGES.INTERNAL_ERROR\n    });\n  }\n});\n\n/**\n * GET /api/universe/user/:userId/locations\n * Fetch all locations owned by a user\n */\nrouter.get('/user/:userId/locations', authenticate, async (req: AuthRequest, res) => {\n  try {\n    const { userId } = req.params;\n\n    const { data: rows } = await supabase\n      .from(DB_TABLES.LOCATIONS)\n      .select('coord, type, created_at')\n      .eq(DB_FIELDS.LOCATIONS.OWNER_ID, userId)\n      .order('coord');\n\n    res.json({\n      success: true,\n      data: { userId, locations: (rows || []).map((r: any) => ({ coord: r.coord, type: r.type, createdAt: r.created_at })) },\n    });\n\n  } catch (error) {\n    console.error('Error fetching user locations:', error);\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: ERROR_MESSAGES.INTERNAL_ERROR\n    });\n  }\n});\n\n/**\n * POST /api/universe/generate\n * Admin-only endpoint to generate the universe\n */\nrouter.post('/generate', authenticate, async (req: AuthRequest, res) => {\n  try {\n    // Check if user is admin\n    if (req.user!.role !== 'admin') {\n      return res.status(HTTP_STATUS.FORBIDDEN).json({\n        success: false,\n        error: 'Access denied. Admin privileges required.'\n      });\n    }\n\n    console.log('Universe generation requested by admin:', req.user!.username);\n\n    // Generate universe\n    const stats = await generateUniverse();\n\n    const response = {\n      success: true,\n      message: 'Universe generation completed',\n      data: stats\n    };\n\n    res.json(response);\n\n  } catch (error: unknown) {\n    console.error('Error generating universe:', error);\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: 'Failed to generate universe',\n      details: errorMessage\n    });\n  }\n});\n\n/**\n * GET /api/universe/stats\n * Get universe statistics\n */\nrouter.get('/stats', authenticate, async (req: AuthRequest, res) => {\n  try {\n    const [all, planets, asteroids, owned, unowned] = await Promise.all([\n      supabase.from(DB_TABLES.LOCATIONS).select(DB_FIELDS.BUILDINGS.ID, { count: 'exact', head: true }),\n      supabase.from(DB_TABLES.LOCATIONS).select(DB_FIELDS.BUILDINGS.ID, { count: 'exact', head: true }).eq(DB_FIELDS.CREDIT_TRANSACTIONS.TYPE, 'planet'),\n      supabase.from(DB_TABLES.LOCATIONS).select(DB_FIELDS.BUILDINGS.ID, { count: 'exact', head: true }).eq(DB_FIELDS.CREDIT_TRANSACTIONS.TYPE, 'asteroid'),\n      supabase.from(DB_TABLES.LOCATIONS).select(DB_FIELDS.BUILDINGS.ID, { count: 'exact', head: true }).not(DB_FIELDS.LOCATIONS.OWNER_ID, 'is', null),\n      supabase.from(DB_TABLES.LOCATIONS).select(DB_FIELDS.BUILDINGS.ID, { count: 'exact', head: true }).is(DB_FIELDS.LOCATIONS.OWNER_ID, null),\n    ]);\n\n    const totalLocations = all.count || 0;\n    const totalPlanets = planets.count || 0;\n    const totalAsteroids = asteroids.count || 0;\n    const ownedLocations = owned.count || 0;\n    const unownedLocations = unowned.count || 0;\n\n    res.json({\n      success: true,\n      data: {\n        totalLocations,\n        totalPlanets,\n        totalAsteroids,\n        ownedLocations,\n        unownedLocations,\n        ownershipPercentage: totalLocations > 0 ? Math.round((ownedLocations / totalLocations) * 100) : 0,\n      },\n    });\n\n  } catch (error) {\n    console.error('Error fetching universe stats:', error);\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: ERROR_MESSAGES.INTERNAL_ERROR\n    });\n  }\n});\n\n/**\n * GET /api/universe/region/:server/:galaxy/:region\n * Fetch all real systems (stars at body 0) within a region\n */\nrouter.get('/region/:server/:galaxy/:region', authenticate, async (req: AuthRequest, res) => {\n  try {\n    const { server, galaxy, region } = req.params;\n\n    // Validate parameters\n    const galaxyNum = parseInt(galaxy, 10);\n    const regionNum = parseInt(region, 10);\n\n    if (\n      typeof server !== 'string' || server.length !== 1 ||\n      isNaN(galaxyNum) || galaxyNum < 0 || galaxyNum > 39 ||\n      isNaN(regionNum) || regionNum < 0 || regionNum > 99\n    ) {\n      return res.status(HTTP_STATUS.BAD_REQUEST).json({\n        success: false,\n        error: 'Invalid region coordinates'\n      });\n    }\n\n    const gg = galaxy.padStart(2, '0');\n    const rr = region.padStart(2, '0');\n    // stars at body 00\n    const starLike = `${server}${gg}:${rr}:%:00`;\n    const { data: stars } = await supabase\n      .from(DB_TABLES.LOCATIONS)\n      .select('coord, star_overhaul')\n      .eq(DB_FIELDS.CREDIT_TRANSACTIONS.TYPE, 'star')\n      .like('coord', starLike)\n      .order('coord', { ascending: true });\n\n    // Fetch all owned coords in region once\n    const ownedLike = `${server}${gg}:${rr}:%`;\n    const { data: ownedRows } = await supabase\n      .from(DB_TABLES.LOCATIONS)\n      .select('coord')\n      .not(DB_FIELDS.LOCATIONS.OWNER_ID, 'is', null)\n      .like('coord', ownedLike);\n\n    const ownedBySystem = new Set<string>();\n    for (const row of ownedRows || []) {\n      try {\n        const c = parseCoord((row as any).coord);\n        ownedBySystem.add(`${c.system}`.padStart(2, '0'));\n      } catch {}\n    }\n\n    const systems = (stars || []).map((star: any) => {\n      const c = parseCoord(star.coord);\n      const sysKey = `${c.system}`.padStart(2, '0');\n      const kind = (star as any)?.star_overhaul?.kind as string | undefined;\n      return {\n        system: c.system,\n        coord: star.coord,\n        star: kind ? { spectralClass: undefined as any, color: colorForStarKind(kind) } : null,\n        hasOwned: ownedBySystem.has(sysKey),\n      };\n    });\n\n    res.json({\n      success: true,\n      data: {\n        region: { server, galaxy: galaxyNum, region: regionNum },\n        systems\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching region systems:', error);\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: ERROR_MESSAGES.INTERNAL_ERROR\n    });\n  }\n});\n\n/**\n * GET /api/universe/galaxy/:server/:galaxy/regions\n * Batch endpoint: returns systemsWithStars grouped by region for an entire galaxy.\n * This lets the client render all region stars immediately with a single request.\n */\nrouter.get('/galaxy/:server/:galaxy/regions', authenticate, async (req: AuthRequest, res) => {\n  try {\n    const { server, galaxy } = req.params;\n\n    // Validate parameters\n    const galaxyNum = parseInt(galaxy, 10);\n    if (\n      typeof server !== 'string' || server.length !== 1 ||\n      isNaN(galaxyNum) || galaxyNum < 0 || galaxyNum > 39\n    ) {\n      return res.status(HTTP_STATUS.BAD_REQUEST).json({\n        success: false,\n        error: 'Invalid galaxy coordinates'\n      });\n    }\n\n    const galaxyStr = galaxy.padStart(2, '0');\n    const like = `${server}${galaxyStr}:%:%:00`;\n    const { data: stars } = await supabase\n      .from(DB_TABLES.LOCATIONS)\n      .select('coord')\n      .eq(DB_FIELDS.CREDIT_TRANSACTIONS.TYPE, 'star')\n      .like('coord', like);\n\n    const buckets: Record<number, number[]> = {};\n    for (const s of stars || []) {\n      try {\n        const c = parseCoord((s as any).coord);\n        if (!buckets[c.region]) buckets[c.region] = [];\n        buckets[c.region].push(c.system);\n      } catch {}\n    }\n\n    const regions = Object.keys(buckets)\n      .map((r) => ({ region: parseInt(r, 10), systemsWithStars: buckets[parseInt(r, 10)] }))\n      .sort((a, b) => a.region - b.region);\n\n    res.json({ success: true, data: { server, galaxy: galaxyNum, regions } });\n  } catch (error) {\n    console.error('Error fetching galaxy region summaries:', error);\n    return res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: ERROR_MESSAGES.INTERNAL_ERROR\n    });\n  }\n});\n\n/**\n * GET /api/universe/galaxy/:server/:galaxy/region-stars\n * Returns per-region array of { system, color } for all star systems in a galaxy\n */\nrouter.get('/galaxy/:server/:galaxy/region-stars', authenticate, async (req: AuthRequest, res) => {\n  try {\n    const { server, galaxy } = req.params;\n    const galaxyNum = parseInt(galaxy, 10);\n\n    if (\n      typeof server !== 'string' || server.length !== 1 ||\n      isNaN(galaxyNum) || galaxyNum < 0 || galaxyNum > 39\n    ) {\n      return res.status(HTTP_STATUS.BAD_REQUEST).json({\n        success: false,\n        error: 'Invalid galaxy coordinates'\n      });\n    }\n\n    const galaxyStr = galaxy.padStart(2, '0');\n    const like = `${server}${galaxyStr}:%:%:00`;\n    const { data: stars } = await supabase\n      .from(DB_TABLES.LOCATIONS)\n      .select('coord, star_overhaul')\n      .eq(DB_FIELDS.CREDIT_TRANSACTIONS.TYPE, 'star')\n      .like('coord', like);\n\n    const buckets = new Map<number, Array<{ system: number; color: string }>>();\n    for (const s of stars || []) {\n      try {\n        const c = parseCoord((s as any).coord);\n        const kind = (s as any)?.star_overhaul?.kind as string | undefined;\n        const color = colorForStarKind(kind);\n        if (!buckets.has(c.region)) buckets.set(c.region, []);\n        buckets.get(c.region)!.push({ system: c.system, color });\n      } catch {}\n    }\n\n    const regions = Array.from(buckets.entries())\n      .map(([region, systems]) => ({ region, systems: systems.sort((a, b) => a.system - b.system) }))\n      .sort((a, b) => a.region - b.region);\n\n    res.json({ success: true, data: { server, galaxy: galaxyNum, regions } });\n  } catch (error) {\n    console.error('Error fetching galaxy region star colors:', error);\n    return res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n      success: false,\n      error: ERROR_MESSAGES.INTERNAL_ERROR\n    });\n  }\n});\n\nexport default router;\n\n\n"],"version":3}
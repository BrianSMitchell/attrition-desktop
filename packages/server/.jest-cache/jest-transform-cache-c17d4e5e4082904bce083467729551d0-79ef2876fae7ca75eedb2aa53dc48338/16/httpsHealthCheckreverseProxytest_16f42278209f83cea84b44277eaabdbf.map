{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\utils\\__tests__\\httpsHealthCheck.reverseProxy.test.ts","mappings":";;;;;AAAA,sDAA8B;AAC9B,0DAAgC;AAChC,0DAA8D;AAC9D,yCAAwC;AAExC,yCAA2C;AAE3C;;GAEG;AACH,QAAQ,CAAC,sCAAsC,EAAE,GAAG,EAAE;IACpD,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC;IAE5B,UAAU,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,OAAO,CAAC,GAAG,GAAG,EAAE,GAAG,OAAO,EAAE,CAAC;QAC7B,OAAO,CAAC,GAAG,CAAC,iBAAQ,CAAC,qBAAqB,CAAC,GAAG,MAAM,CAAC;QACrD,OAAO,OAAO,CAAC,GAAG,CAAC,iBAAQ,CAAC,UAAU,CAAC,CAAC,CAAC,wCAAwC;IACnF,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,OAAO,CAAC,GAAG,GAAG,OAAO,CAAC;IACxB,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,yDAAyD,EAAE,KAAK,IAAI,EAAE;QACzE,MAAM,GAAG,GAAG,IAAA,iBAAO,GAAE,CAAC;QACtB,GAAG,CAAC,GAAG,CAAC,mBAAmB,EAAE,0CAAuB,CAAC,CAAC;QAEtD,MAAM,GAAG,GAAG,MAAM,IAAA,mBAAO,EAAC,GAAG,CAAC,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QAExD,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,oBAAW,CAAC,EAAE,CAAC,CAAC;QACxC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QACjD,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QACxC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,kCAAkC,CAAC,CAAC;QACrE,kFAAkF;QAClF,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;IACjD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\utils\\__tests__\\httpsHealthCheck.reverseProxy.test.ts"],"sourcesContent":["import express from 'express';\nimport request from 'supertest';\nimport { httpsHealthCheckHandler } from '../httpsHealthCheck';\nimport { ENV_VARS } from '@game/shared';\n\nimport { HTTP_STATUS } from '@game/shared';\n\n/**\n * Validates that /api/https-health short-circuits in reverse proxy mode.\n */\ndescribe('/api/https-health reverse proxy mode', () => {\n  const OLD_ENV = process.env;\n\n  beforeEach(() => {\n    jest.resetModules();\n    process.env = { ...OLD_ENV };\n    process.env[ENV_VARS.USE_REVERSE_PROXY_SSL] = 'true';\n    delete process.env[ENV_VARS.HTTPS_PORT]; // ensure it doesn't try local 443 logic\n  });\n\n  afterEach(() => {\n    process.env = OLD_ENV;\n  });\n\n  test('returns 200 with reverse proxy message and success=true', async () => {\n    const app = express();\n    app.get('/api/https-health', httpsHealthCheckHandler);\n\n    const res = await request(app).get('/api/https-health');\n\n    expect(res.status).toBe(HTTP_STATUS.OK);\n    expect(res.body).toHaveProperty('success', true);\n    expect(res.body).toHaveProperty('data');\n    expect(res.body.message).toMatch(/reverse proxy ssl|reverse proxy/i);\n    // Ensure it did not attempt to contact local HTTPS by checking presence of checks\n    expect(res.body.data).toHaveProperty('checks');\n  });\n});\n"],"version":3}
25f5292e51034d79dab953242294b820
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const auth_1 = require("../middleware/auth");
const errorHandler_1 = require("../middleware/errorHandler");
const supabase_1 = require("../config/supabase");
const database_fields_1 = require("../constants/database-fields");
const response_formats_1 = require("../constants/response-formats");
const router = express_1.default.Router();
// Get message summary (unread count, etc.)
router.get('/summary', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user?._id || req.user?.id || req.user?.userId;
    const uid = String(userId);
    // Perform counts using Supabase exact counts (head requests to avoid payloads)
    const [inboxRes, sentRes, unreadRes] = await Promise.all([
        supabase_1.supabase
            .from(database_fields_1.DB_TABLES.MESSAGES)
            .select('*', { count: 'exact', head: true })
            .eq('to_user_id', uid),
        supabase_1.supabase
            .from(database_fields_1.DB_TABLES.MESSAGES)
            .select('*', { count: 'exact', head: true })
            .eq('from_user_id', uid),
        supabase_1.supabase
            .from(database_fields_1.DB_TABLES.MESSAGES)
            .select('*', { count: 'exact', head: true })
            .eq('to_user_id', uid)
            .eq('is_read', false),
    ]);
    const inboxCount = inboxRes.error ? 0 : (inboxRes.count ?? 0);
    const sentCount = sentRes.error ? 0 : (sentRes.count ?? 0);
    const unreadMessages = unreadRes.error ? 0 : (unreadRes.count ?? 0);
    const totalMessages = inboxCount + sentCount;
    if (inboxRes.error || sentRes.error || unreadRes.error) {
        // Log minimal error context; return what we have
        return res.status(response_formats_1.HTTP_STATUS.OK).json({
            success: true,
            data: { totalMessages, unreadMessages, inboxCount, sentCount },
            warnings: [
                inboxRes.error?.message,
                sentRes.error?.message,
                unreadRes.error?.message,
            ].filter(Boolean),
        });
    }
    return res.json({
        success: true,
        data: { totalMessages, unreadMessages, inboxCount, sentCount }
    });
}));
// Get inbox messages
router.get('/inbox', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user.userId;
    const page = parseInt(req.query.page) || 1;
    const limit = Math.min(parseInt(req.query.limit) || 20, 50); // Max 50 per page
    const offset = (page - 1) * limit;
    const uid = String(userId);
    // Get paginated messages
    const { data: messages, error: messagesError } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .select('*')
        .eq('to_user_id', uid)
        .order(database_fields_1.DB_FIELDS.BUILDINGS.CREATED_AT, { ascending: false })
        .range(offset, offset + limit - 1);
    if (messagesError) {
        console.error('Error fetching inbox messages:', messagesError);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to fetch inbox messages'
        });
    }
    // Get total count
    const { count: totalCount, error: countError } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .select('*', { count: 'exact', head: true })
        .eq('to_user_id', uid);
    if (countError) {
        console.error('Error counting inbox messages:', countError);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to count inbox messages'
        });
    }
    const totalPages = Math.ceil((totalCount || 0) / limit);
    return res.json({
        success: true,
        data: {
            messages: messages || [],
            totalPages
        }
    });
}));
// Get sent messages
router.get('/sent', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user.userId;
    const page = parseInt(req.query.page) || 1;
    const limit = Math.min(parseInt(req.query.limit) || 20, 50); // Max 50 per page
    const offset = (page - 1) * limit;
    const uid = String(userId);
    // Get paginated messages
    const { data: messages, error: messagesError } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .select('*')
        .eq('from_user_id', uid)
        .order(database_fields_1.DB_FIELDS.BUILDINGS.CREATED_AT, { ascending: false })
        .range(offset, offset + limit - 1);
    if (messagesError) {
        console.error('Error fetching sent messages:', messagesError);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to fetch sent messages'
        });
    }
    // Get total count
    const { count: totalCount, error: countError } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .select('*', { count: 'exact', head: true })
        .eq('from_user_id', uid);
    if (countError) {
        console.error('Error counting sent messages:', countError);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to count sent messages'
        });
    }
    const totalPages = Math.ceil((totalCount || 0) / limit);
    return res.json({
        success: true,
        data: {
            messages: messages || [],
            totalPages
        }
    });
}));
// Get message by ID
router.get('/:messageId', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user.userId;
    const messageId = req.params.messageId;
    const uid = String(userId);
    // Basic UUID validation (Supabase uses UUID for IDs)
    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    if (!uuidRegex.test(messageId)) {
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'INVALID_MESSAGE_ID',
            message: 'Invalid message ID format'
        });
    }
    // Get message with authorization check
    const { data: message, error } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .select('*')
        .eq(database_fields_1.DB_FIELDS.BUILDINGS.ID, messageId)
        .or(`from_user_id.eq.${uid},to_user_id.eq.${uid}`)
        .maybeSingle();
    if (error) {
        console.error('Error fetching message by ID:', error);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to fetch message'
        });
    }
    if (!message) {
        return res.status(response_formats_1.HTTP_STATUS.NOT_FOUND).json({
            success: false,
            code: 'MESSAGE_NOT_FOUND',
            message: 'Message not found'
        });
    }
    return res.json({
        success: true,
        data: message
    });
}));
// Send a new message
router.post('/', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user.userId;
    const { toUsername, subject, content } = req.body;
    // Validation
    if (!toUsername || !subject || !content) {
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'MISSING_FIELDS',
            message: 'Missing required fields: toUsername, subject, content'
        });
    }
    if (subject.length > 200) {
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'SUBJECT_TOO_LONG',
            message: 'Subject must be 200 characters or less'
        });
    }
    if (content.length > 2000) {
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'CONTENT_TOO_LONG',
            message: 'Content must be 2000 characters or less'
        });
    }
    const uid = String(userId);
    // Find sender
    const { data: sender, error: senderError } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.USERS)
        .select('id, username')
        .eq(database_fields_1.DB_FIELDS.BUILDINGS.ID, uid)
        .maybeSingle();
    if (senderError || !sender) {
        console.error('Error finding sender:', senderError);
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'SENDER_NOT_FOUND',
            message: 'Sender not found'
        });
    }
    // Find sender's empire
    const { data: senderEmpire } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.EMPIRES)
        .select('id, name')
        .eq(database_fields_1.DB_FIELDS.EMPIRES.USER_ID, uid)
        .maybeSingle();
    // Find recipient
    const { data: recipient, error: recipientError } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.USERS)
        .select('id, username')
        .eq(database_fields_1.DB_FIELDS.USERS.USERNAME, toUsername)
        .maybeSingle();
    if (recipientError || !recipient) {
        console.error('Error finding recipient:', recipientError);
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'RECIPIENT_NOT_FOUND',
            message: 'Recipient not found'
        });
    }
    // Find recipient's empire
    const { data: recipientEmpire } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.EMPIRES)
        .select('id, name')
        .eq(database_fields_1.DB_FIELDS.EMPIRES.USER_ID, String(recipient.id))
        .maybeSingle();
    // Create message
    const { data: message, error: messageError } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .insert({
        from_user_id: sender.id,
        to_user_id: recipient.id,
        from_username: sender.username,
        to_username: recipient.username,
        from_empire_name: senderEmpire?.name || null,
        to_empire_name: recipientEmpire?.name || null,
        subject: subject.trim(),
        content: content.trim(),
        is_read: false,
        created_at: new Date().toISOString()
    })
        .select('*')
        .single();
    if (messageError) {
        console.error('Error creating message:', messageError);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to create message'
        });
    }
    return res.status(response_formats_1.HTTP_STATUS.CREATED).json({
        success: true,
        data: message
    });
}));
// Mark message as read
router.patch('/:messageId/read', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user.userId;
    const messageId = req.params.messageId;
    const uid = String(userId);
    // Basic UUID validation (Supabase uses UUID for IDs)
    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    if (!uuidRegex.test(messageId)) {
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'INVALID_MESSAGE_ID',
            message: 'Invalid message ID format'
        });
    }
    // Update message to mark as read (only if user is recipient)
    const { data, error } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .update({ is_read: true })
        .eq(database_fields_1.DB_FIELDS.BUILDINGS.ID, messageId)
        .eq('to_user_id', uid) // Only recipient can mark as read
        .select(database_fields_1.DB_FIELDS.BUILDINGS.ID)
        .single();
    if (error) {
        console.error('Error marking message as read:', error);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to mark message as read'
        });
    }
    if (!data) {
        return res.status(response_formats_1.HTTP_STATUS.NOT_FOUND).json({
            success: false,
            code: 'MESSAGE_NOT_FOUND',
            message: 'Message not found or not authorized'
        });
    }
    return res.json({
        success: true,
        message: 'Message marked as read'
    });
}));
// Mark all messages as read
router.patch('/mark-all-read', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user.userId;
    const uid = String(userId);
    // Update all messages for this user as read
    const { error } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .update({ is_read: true })
        .eq('to_user_id', uid);
    if (error) {
        console.error('Error marking all messages as read:', error);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to mark all messages as read'
        });
    }
    return res.json({
        success: true,
        message: 'All messages marked as read'
    });
}));
// Delete a message
router.delete('/:messageId', auth_1.authenticate, (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const userId = req.user.userId;
    const messageId = req.params.messageId;
    const uid = String(userId);
    // Basic UUID validation (Supabase uses UUID for IDs)
    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    if (!uuidRegex.test(messageId)) {
        return res.status(response_formats_1.HTTP_STATUS.BAD_REQUEST).json({
            success: false,
            code: 'INVALID_MESSAGE_ID',
            message: 'Invalid message ID format'
        });
    }
    // Delete message (only if user is sender or recipient)
    const { data, error } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.MESSAGES)
        .delete()
        .eq(database_fields_1.DB_FIELDS.BUILDINGS.ID, messageId)
        .or(`from_user_id.eq.${uid},to_user_id.eq.${uid}`)
        .select(database_fields_1.DB_FIELDS.BUILDINGS.ID)
        .single();
    if (error) {
        console.error('Error deleting message:', error);
        return res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to delete message'
        });
    }
    if (!data) {
        return res.status(response_formats_1.HTTP_STATUS.NOT_FOUND).json({
            success: false,
            code: 'MESSAGE_NOT_FOUND',
            message: 'Message not found or not authorized'
        });
    }
    return res.json({
        success: true,
        message: 'Message deleted'
    });
}));
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xccm91dGVzXFxtZXNzYWdlcy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLHNEQUE4QjtBQUM5Qiw2Q0FBK0Q7QUFFL0QsNkRBQTBEO0FBQzFELGlEQUE4QztBQUM5QyxrRUFBb0U7QUFDcEUsb0VBQTZFO0FBRTdFLE1BQU0sTUFBTSxHQUFHLGlCQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFaEMsMkNBQTJDO0FBQzNDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLG1CQUFZLEVBQUUsSUFBQSwyQkFBWSxFQUFDLEtBQUssRUFBRSxHQUFnQixFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQzFGLE1BQU0sTUFBTSxHQUFJLEdBQUcsQ0FBQyxJQUFZLEVBQUUsR0FBRyxJQUFLLEdBQUcsQ0FBQyxJQUFZLEVBQUUsRUFBRSxJQUFLLEdBQUcsQ0FBQyxJQUFZLEVBQUUsTUFBTSxDQUFDO0lBQzVGLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUUzQiwrRUFBK0U7SUFDL0UsTUFBTSxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQ3ZELG1CQUFRO2FBQ0wsSUFBSSxDQUFDLDJCQUFTLENBQUMsUUFBUSxDQUFDO2FBQ3hCLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQzthQUMzQyxFQUFFLENBQUMsWUFBWSxFQUFFLEdBQUcsQ0FBQztRQUN4QixtQkFBUTthQUNMLElBQUksQ0FBQywyQkFBUyxDQUFDLFFBQVEsQ0FBQzthQUN4QixNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDM0MsRUFBRSxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUM7UUFD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Q25DLElBQUksQ0FBQywyQkFBUyxDQUFDLFFBQVEsQ0FBQztTQUN4QixNQUFNLEVBQUU7U0FDUixFQUFFLENBQUMsMkJBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBQztTQUNyQyxFQUFFLENBQUMsbUJBQW1CLEdBQUcsa0JBQWtCLEdBQUcsRUFBRSxDQUFDO1NBQ2pELE1BQU0sQ0FBQywyQkFBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7U0FDOUIsTUFBTSxFQUFFLENBQUM7SUFFWixJQUFJLEtBQUssRUFBRSxDQUFDO1FBQ1YsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNoRCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsOEJBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUN4RCxPQUFPLEVBQUUsS0FBSztZQUNkLEtBQUssRUFBRSwwQkFBMEI7U0FDbEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNWLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyw4QkFBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUM1QyxPQUFPLEVBQUUsS0FBSztZQUNkLElBQUksRUFBRSxtQkFBbUI7WUFDekIsT0FBTyxFQUFFLHFDQUFxQztTQUMvQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDO1FBQ2QsT0FBTyxFQUFFLElBQUk7UUFDYixPQUFPLEVBQUUsaUJBQWlCO0tBQzNCLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFSixrQkFBZSxNQUFNLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xccm91dGVzXFxtZXNzYWdlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IHsgYXV0aGVudGljYXRlLCBBdXRoUmVxdWVzdCB9IGZyb20gJy4uL21pZGRsZXdhcmUvYXV0aCc7XHJcbmltcG9ydCB7IFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCB7IGFzeW5jSGFuZGxlciB9IGZyb20gJy4uL21pZGRsZXdhcmUvZXJyb3JIYW5kbGVyJztcclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9jb25maWcvc3VwYWJhc2UnO1xyXG5pbXBvcnQgeyBEQl9UQUJMRVMsIERCX0ZJRUxEUyB9IGZyb20gJy4uL2NvbnN0YW50cy9kYXRhYmFzZS1maWVsZHMnO1xyXG5pbXBvcnQgeyBIVFRQX1NUQVRVUywgUkVTUE9OU0VfRk9STUFUIH0gZnJvbSAnLi4vY29uc3RhbnRzL3Jlc3BvbnNlLWZvcm1hdHMnO1xyXG5cclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuXHJcbi8vIEdldCBtZXNzYWdlIHN1bW1hcnkgKHVucmVhZCBjb3VudCwgZXRjLilcclxucm91dGVyLmdldCgnL3N1bW1hcnknLCBhdXRoZW50aWNhdGUsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxOiBBdXRoUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIGNvbnN0IHVzZXJJZCA9IChyZXEudXNlciBhcyBhbnkpPy5faWQgfHwgKHJlcS51c2VyIGFzIGFueSk/LmlkIHx8IChyZXEudXNlciBhcyBhbnkpPy51c2VySWQ7XHJcbiAgY29uc3QgdWlkID0gU3RyaW5nKHVzZXJJZCk7XHJcblxyXG4gIC8vIFBlcmZvcm0gY291bnRzIHVzaW5nIFN1cGFiYXNlIGV4YWN0IGNvdW50cyAoaGVhZCByZXF1ZXN0cyB0byBhdm9pZCBwYXlsb2FkcylcclxuICBjb25zdCBbaW5ib3hSZXMsIHNlbnRSZXMsIHVucmVhZFJlc10gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICBzdXBhYmFzZVxyXG4gICAgICAuZnJvbShEQl9UQUJMRVMuTUVTU0FHRVMpXHJcbiAgICAgIC5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pXHJcbiAgICAgIC5lcSgndG9fdXNlcl9pZCcsIHVpZCksXHJcbiAgICBzdXBhYmFzZVxyXG4gICAgICAuZnJvbShEQl9UQUJMRVMuTUVTU0FHRVMpXHJcbiAgICAgIC5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pXHJcbiAgICAgIC5lcSgnZnJvbV91c2VyX2lkJywgdWlkKSxcclxuICAgIHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKERCX1RBQkxFUy5NRVNTQUdFUylcclxuICAgICAgLnNlbGVjdCgnKicsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSlcclxuICAgICAgLmVxKCd0b191c2VyX2lkJywgdWlkKVxyXG4gICAgICAuZXEoJ2lzX3JlYWQnLCBmYWxzZSksXHJcbiAgXSk7XHJcblxyXG4gIGNvbnN0IGluYm94Q291bnQgPSBpbmJveFJlcy5lcnJvciA/IDAgOiAoaW5ib3hSZXMuY291bnQgPz8gMCk7XHJcbiAgY29uc3Qgc2VudENvdW50ID0gc2VudFJlcy5lcnJvciA/IDAgOiAoc2VudFJlcy5jb3VudCA/PyAwKTtcclxuICBjb25zdCB1bnJlYWRNZXNzYWdlcyA9IHVucmVhZFJlcy5lcnJvciA/IDAgOiAodW5yZWFkUmVzLmNvdW50ID8/IDApO1xyXG4gIGNvbnN0IHRvdGFsTWVzc2FnZXMgPSBpbmJveENvdW50ICsgc2VudENvdW50O1xyXG5cclxuICBpZiAoaW5ib3hSZXMuZXJyb3IgfHwgc2VudFJlcy5lcnJvciB8fCB1bnJlYWRSZXMuZXJyb3IpIHtcclxuICAgIC8vIExvZyBtaW5pbWFsIGVycm9yIGNvbnRleHQ7IHJldHVybiB3aGF0IHdlIGhhdmVcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk9LKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogeyB0b3RhbE1lc3NhZ2VzLCB1bnJlYWRNZXNzYWdlcywgaW5ib3hDb3VudCwgc2VudENvdW50IH0sXHJcbiAgICAgIHdhcm5pbmdzOiBbXHJcbiAgICAgICAgaW5ib3hSZXMuZXJyb3I/Lm1lc3NhZ2UsXHJcbiAgICAgICAgc2VudFJlcy5lcnJvcj8ubWVzc2FnZSxcclxuICAgICAgICB1bnJlYWRSZXMuZXJyb3I/Lm1lc3NhZ2UsXHJcbiAgICAgIF0uZmlsdGVyKEJvb2xlYW4pLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzLmpzb24oe1xyXG4gICAgc3VjY2VzczogdHJ1ZSxcclxuICAgIGRhdGE6IHsgdG90YWxNZXNzYWdlcywgdW5yZWFkTWVzc2FnZXMsIGluYm94Q291bnQsIHNlbnRDb3VudCB9XHJcbiAgfSk7XHJcbn0pKTtcclxuXHJcbi8vIEdldCBpbmJveCBtZXNzYWdlc1xyXG5yb3V0ZXIuZ2V0KCcvaW5ib3gnLCBhdXRoZW50aWNhdGUsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxOiBBdXRoUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyIS51c2VySWQ7XHJcbiAgY29uc3QgcGFnZSA9IHBhcnNlSW50KHJlcS5xdWVyeS5wYWdlIGFzIHN0cmluZykgfHwgMTtcclxuICBjb25zdCBsaW1pdCA9IE1hdGgubWluKHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCBhcyBzdHJpbmcpIHx8IDIwLCA1MCk7IC8vIE1heCA1MCBwZXIgcGFnZVxyXG4gIGNvbnN0IG9mZnNldCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcclxuICBjb25zdCB1aWQgPSBTdHJpbmcodXNlcklkKTtcclxuXHJcbiAgLy8gR2V0IHBhZ2luYXRlZCBtZXNzYWdlc1xyXG4gIGNvbnN0IHsgZGF0YTogbWVzc2FnZXMsIGVycm9yOiBtZXNzYWdlc0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLk1FU1NBR0VTKVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuZXEoJ3RvX3VzZXJfaWQnLCB1aWQpXHJcbiAgICAub3JkZXIoREJfRklFTERTLkJVSUxESU5HUy5DUkVBVEVEX0FULCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgIC5yYW5nZShvZmZzZXQsIG9mZnNldCArIGxpbWl0IC0gMSk7XHJcblxyXG4gIGlmIChtZXNzYWdlc0Vycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBpbmJveCBtZXNzYWdlczonLCBtZXNzYWdlc0Vycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLklOVEVSTkFMX1NFUlZFUl9FUlJPUikuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBpbmJveCBtZXNzYWdlcydcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gR2V0IHRvdGFsIGNvdW50XHJcbiAgY29uc3QgeyBjb3VudDogdG90YWxDb3VudCwgZXJyb3I6IGNvdW50RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbShEQl9UQUJMRVMuTUVTU0FHRVMpXHJcbiAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxyXG4gICAgLmVxKCd0b191c2VyX2lkJywgdWlkKTtcclxuXHJcbiAgaWYgKGNvdW50RXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvdW50aW5nIGluYm94IG1lc3NhZ2VzOicsIGNvdW50RXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNvdW50IGluYm94IG1lc3NhZ2VzJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKCh0b3RhbENvdW50IHx8IDApIC8gbGltaXQpO1xyXG5cclxuICByZXR1cm4gcmVzLmpzb24oe1xyXG4gICAgc3VjY2VzczogdHJ1ZSxcclxuICAgIGRhdGE6IHtcclxuICAgICAgbWVzc2FnZXM6IG1lc3NhZ2VzIHx8IFtdLFxyXG4gICAgICB0b3RhbFBhZ2VzXHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pKTtcclxuXHJcbi8vIEdldCBzZW50IG1lc3NhZ2VzXHJcbnJvdXRlci5nZXQoJy9zZW50JywgYXV0aGVudGljYXRlLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogQXV0aFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICBjb25zdCB1c2VySWQgPSByZXEudXNlciEudXNlcklkO1xyXG4gIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEucXVlcnkucGFnZSBhcyBzdHJpbmcpIHx8IDE7XHJcbiAgY29uc3QgbGltaXQgPSBNYXRoLm1pbihwYXJzZUludChyZXEucXVlcnkubGltaXQgYXMgc3RyaW5nKSB8fCAyMCwgNTApOyAvLyBNYXggNTAgcGVyIHBhZ2VcclxuICBjb25zdCBvZmZzZXQgPSAocGFnZSAtIDEpICogbGltaXQ7XHJcbiAgY29uc3QgdWlkID0gU3RyaW5nKHVzZXJJZCk7XHJcblxyXG4gIC8vIEdldCBwYWdpbmF0ZWQgbWVzc2FnZXNcclxuICBjb25zdCB7IGRhdGE6IG1lc3NhZ2VzLCBlcnJvcjogbWVzc2FnZXNFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKERCX1RBQkxFUy5NRVNTQUdFUylcclxuICAgIC5zZWxlY3QoJyonKVxyXG4gICAgLmVxKCdmcm9tX3VzZXJfaWQnLCB1aWQpXHJcbiAgICAub3JkZXIoREJfRklFTERTLkJVSUxESU5HUy5DUkVBVEVEX0FULCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgIC5yYW5nZShvZmZzZXQsIG9mZnNldCArIGxpbWl0IC0gMSk7XHJcblxyXG4gIGlmIChtZXNzYWdlc0Vycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzZW50IG1lc3NhZ2VzOicsIG1lc3NhZ2VzRXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIHNlbnQgbWVzc2FnZXMnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIEdldCB0b3RhbCBjb3VudFxyXG4gIGNvbnN0IHsgY291bnQ6IHRvdGFsQ291bnQsIGVycm9yOiBjb3VudEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLk1FU1NBR0VTKVxyXG4gICAgLnNlbGVjdCgnKicsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSlcclxuICAgIC5lcSgnZnJvbV91c2VyX2lkJywgdWlkKTtcclxuXHJcbiAgaWYgKGNvdW50RXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvdW50aW5nIHNlbnQgbWVzc2FnZXM6JywgY291bnRFcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY291bnQgc2VudCBtZXNzYWdlcydcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCgodG90YWxDb3VudCB8fCAwKSAvIGxpbWl0KTtcclxuXHJcbiAgcmV0dXJuIHJlcy5qc29uKHtcclxuICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcyB8fCBbXSxcclxuICAgICAgdG90YWxQYWdlc1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KSk7XHJcblxyXG4vLyBHZXQgbWVzc2FnZSBieSBJRFxyXG5yb3V0ZXIuZ2V0KCcvOm1lc3NhZ2VJZCcsIGF1dGhlbnRpY2F0ZSwgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLnVzZXJJZDtcclxuICBjb25zdCBtZXNzYWdlSWQgPSByZXEucGFyYW1zLm1lc3NhZ2VJZDtcclxuICBjb25zdCB1aWQgPSBTdHJpbmcodXNlcklkKTtcclxuXHJcbiAgLy8gQmFzaWMgVVVJRCB2YWxpZGF0aW9uIChTdXBhYmFzZSB1c2VzIFVVSUQgZm9yIElEcylcclxuICBjb25zdCB1dWlkUmVnZXggPSAvXlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9JC9pO1xyXG4gIGlmICghdXVpZFJlZ2V4LnRlc3QobWVzc2FnZUlkKSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuQkFEX1JFUVVFU1QpLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgY29kZTogJ0lOVkFMSURfTUVTU0FHRV9JRCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIG1lc3NhZ2UgSUQgZm9ybWF0J1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBHZXQgbWVzc2FnZSB3aXRoIGF1dGhvcml6YXRpb24gY2hlY2tcclxuICBjb25zdCB7IGRhdGE6IG1lc3NhZ2UsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLk1FU1NBR0VTKVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuZXEoREJfRklFTERTLkJVSUxESU5HUy5JRCwgbWVzc2FnZUlkKVxyXG4gICAgLm9yKGBmcm9tX3VzZXJfaWQuZXEuJHt1aWR9LHRvX3VzZXJfaWQuZXEuJHt1aWR9YClcclxuICAgIC5tYXliZVNpbmdsZSgpO1xyXG5cclxuICBpZiAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIG1lc3NhZ2UgYnkgSUQ6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIG1lc3NhZ2UnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGlmICghbWVzc2FnZSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGNvZGU6ICdNRVNTQUdFX05PVF9GT1VORCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdNZXNzYWdlIG5vdCBmb3VuZCdcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlcy5qc29uKHtcclxuICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICBkYXRhOiBtZXNzYWdlXHJcbiAgfSk7XHJcbn0pKTtcclxuXHJcbi8vIFNlbmQgYSBuZXcgbWVzc2FnZVxyXG5yb3V0ZXIucG9zdCgnLycsIGF1dGhlbnRpY2F0ZSwgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLnVzZXJJZDtcclxuICBjb25zdCB7IHRvVXNlcm5hbWUsIHN1YmplY3QsIGNvbnRlbnQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAvLyBWYWxpZGF0aW9uXHJcbiAgaWYgKCF0b1VzZXJuYW1lIHx8ICFzdWJqZWN0IHx8ICFjb250ZW50KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBjb2RlOiAnTUlTU0lOR19GSUVMRFMnLFxyXG4gICAgICBtZXNzYWdlOiAnTWlzc2luZyByZXF1aXJlZCBmaWVsZHM6IHRvVXNlcm5hbWUsIHN1YmplY3QsIGNvbnRlbnQnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGlmIChzdWJqZWN0Lmxlbmd0aCA+IDIwMCkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuQkFEX1JFUVVFU1QpLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgY29kZTogJ1NVQkpFQ1RfVE9PX0xPTkcnLFxyXG4gICAgICBtZXNzYWdlOiAnU3ViamVjdCBtdXN0IGJlIDIwMCBjaGFyYWN0ZXJzIG9yIGxlc3MnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGlmIChjb250ZW50Lmxlbmd0aCA+IDIwMDApIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLkJBRF9SRVFVRVNUKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGNvZGU6ICdDT05URU5UX1RPT19MT05HJyxcclxuICAgICAgbWVzc2FnZTogJ0NvbnRlbnQgbXVzdCBiZSAyMDAwIGNoYXJhY3RlcnMgb3IgbGVzcydcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdWlkID0gU3RyaW5nKHVzZXJJZCk7XHJcblxyXG4gIC8vIEZpbmQgc2VuZGVyXHJcbiAgY29uc3QgeyBkYXRhOiBzZW5kZXIsIGVycm9yOiBzZW5kZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKERCX1RBQkxFUy5VU0VSUylcclxuICAgIC5zZWxlY3QoJ2lkLCB1c2VybmFtZScpXHJcbiAgICAuZXEoREJfRklFTERTLkJVSUxESU5HUy5JRCwgdWlkKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmIChzZW5kZXJFcnJvciB8fCAhc2VuZGVyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmaW5kaW5nIHNlbmRlcjonLCBzZW5kZXJFcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBjb2RlOiAnU0VOREVSX05PVF9GT1VORCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdTZW5kZXIgbm90IGZvdW5kJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBGaW5kIHNlbmRlcidzIGVtcGlyZVxyXG4gIGNvbnN0IHsgZGF0YTogc2VuZGVyRW1waXJlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLkVNUElSRVMpXHJcbiAgICAuc2VsZWN0KCdpZCwgbmFtZScpXHJcbiAgICAuZXEoREJfRklFTERTLkVNUElSRVMuVVNFUl9JRCwgdWlkKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIC8vIEZpbmQgcmVjaXBpZW50XHJcbiAgY29uc3QgeyBkYXRhOiByZWNpcGllbnQsIGVycm9yOiByZWNpcGllbnRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKERCX1RBQkxFUy5VU0VSUylcclxuICAgIC5zZWxlY3QoJ2lkLCB1c2VybmFtZScpXHJcbiAgICAuZXEoREJfRklFTERTLlVTRVJTLlVTRVJOQU1FLCB0b1VzZXJuYW1lKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmIChyZWNpcGllbnRFcnJvciB8fCAhcmVjaXBpZW50KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmaW5kaW5nIHJlY2lwaWVudDonLCByZWNpcGllbnRFcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBjb2RlOiAnUkVDSVBJRU5UX05PVF9GT1VORCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdSZWNpcGllbnQgbm90IGZvdW5kJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBGaW5kIHJlY2lwaWVudCdzIGVtcGlyZVxyXG4gIGNvbnN0IHsgZGF0YTogcmVjaXBpZW50RW1waXJlIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLkVNUElSRVMpXHJcbiAgICAuc2VsZWN0KCdpZCwgbmFtZScpXHJcbiAgICAuZXEoREJfRklFTERTLkVNUElSRVMuVVNFUl9JRCwgU3RyaW5nKHJlY2lwaWVudC5pZCkpXHJcbiAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgLy8gQ3JlYXRlIG1lc3NhZ2VcclxuICBjb25zdCB7IGRhdGE6IG1lc3NhZ2UsIGVycm9yOiBtZXNzYWdlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbShEQl9UQUJMRVMuTUVTU0FHRVMpXHJcbiAgICAuaW5zZXJ0KHtcclxuICAgICAgZnJvbV91c2VyX2lkOiBzZW5kZXIuaWQsXHJcbiAgICAgIHRvX3VzZXJfaWQ6IHJlY2lwaWVudC5pZCxcclxuICAgICAgZnJvbV91c2VybmFtZTogc2VuZGVyLnVzZXJuYW1lLFxyXG4gICAgICB0b191c2VybmFtZTogcmVjaXBpZW50LnVzZXJuYW1lLFxyXG4gICAgICBmcm9tX2VtcGlyZV9uYW1lOiBzZW5kZXJFbXBpcmU/Lm5hbWUgfHwgbnVsbCxcclxuICAgICAgdG9fZW1waXJlX25hbWU6IHJlY2lwaWVudEVtcGlyZT8ubmFtZSB8fCBudWxsLFxyXG4gICAgICBzdWJqZWN0OiBzdWJqZWN0LnRyaW0oKSxcclxuICAgICAgY29udGVudDogY29udGVudC50cmltKCksXHJcbiAgICAgIGlzX3JlYWQ6IGZhbHNlLFxyXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pXHJcbiAgICAuc2VsZWN0KCcqJylcclxuICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKG1lc3NhZ2VFcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbWVzc2FnZTonLCBtZXNzYWdlRXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBtZXNzYWdlJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5DUkVBVEVEKS5qc29uKHtcclxuICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICBkYXRhOiBtZXNzYWdlXHJcbiAgfSk7XHJcbn0pKTtcclxuXHJcbi8vIE1hcmsgbWVzc2FnZSBhcyByZWFkXHJcbnJvdXRlci5wYXRjaCgnLzptZXNzYWdlSWQvcmVhZCcsIGF1dGhlbnRpY2F0ZSwgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLnVzZXJJZDtcclxuICBjb25zdCBtZXNzYWdlSWQgPSByZXEucGFyYW1zLm1lc3NhZ2VJZDtcclxuICBjb25zdCB1aWQgPSBTdHJpbmcodXNlcklkKTtcclxuXHJcbiAgLy8gQmFzaWMgVVVJRCB2YWxpZGF0aW9uIChTdXBhYmFzZSB1c2VzIFVVSUQgZm9yIElEcylcclxuICBjb25zdCB1dWlkUmVnZXggPSAvXlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9JC9pO1xyXG4gIGlmICghdXVpZFJlZ2V4LnRlc3QobWVzc2FnZUlkKSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuQkFEX1JFUVVFU1QpLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgY29kZTogJ0lOVkFMSURfTUVTU0FHRV9JRCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIG1lc3NhZ2UgSUQgZm9ybWF0J1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBVcGRhdGUgbWVzc2FnZSB0byBtYXJrIGFzIHJlYWQgKG9ubHkgaWYgdXNlciBpcyByZWNpcGllbnQpXHJcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKERCX1RBQkxFUy5NRVNTQUdFUylcclxuICAgIC51cGRhdGUoeyBpc19yZWFkOiB0cnVlIH0pXHJcbiAgICAuZXEoREJfRklFTERTLkJVSUxESU5HUy5JRCwgbWVzc2FnZUlkKVxyXG4gICAgLmVxKCd0b191c2VyX2lkJywgdWlkKSAvLyBPbmx5IHJlY2lwaWVudCBjYW4gbWFyayBhcyByZWFkXHJcbiAgICAuc2VsZWN0KERCX0ZJRUxEUy5CVUlMRElOR1MuSUQpXHJcbiAgICAuc2luZ2xlKCk7XHJcblxyXG4gIGlmIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbWFya2luZyBtZXNzYWdlIGFzIHJlYWQ6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIG1hcmsgbWVzc2FnZSBhcyByZWFkJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWRhdGEpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBjb2RlOiAnTUVTU0FHRV9OT1RfRk9VTkQnLFxyXG4gICAgICBtZXNzYWdlOiAnTWVzc2FnZSBub3QgZm91bmQgb3Igbm90IGF1dGhvcml6ZWQnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHVybiByZXMuanNvbih7XHJcbiAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgbWVzc2FnZTogJ01lc3NhZ2UgbWFya2VkIGFzIHJlYWQnXHJcbiAgfSk7XHJcbn0pKTtcclxuXHJcbi8vIE1hcmsgYWxsIG1lc3NhZ2VzIGFzIHJlYWRcclxucm91dGVyLnBhdGNoKCcvbWFyay1hbGwtcmVhZCcsIGF1dGhlbnRpY2F0ZSwgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLnVzZXJJZDtcclxuICBjb25zdCB1aWQgPSBTdHJpbmcodXNlcklkKTtcclxuXHJcbiAgLy8gVXBkYXRlIGFsbCBtZXNzYWdlcyBmb3IgdGhpcyB1c2VyIGFzIHJlYWRcclxuICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLk1FU1NBR0VTKVxyXG4gICAgLnVwZGF0ZSh7IGlzX3JlYWQ6IHRydWUgfSlcclxuICAgIC5lcSgndG9fdXNlcl9pZCcsIHVpZCk7XHJcblxyXG4gIGlmIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbWFya2luZyBhbGwgbWVzc2FnZXMgYXMgcmVhZDonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gbWFyayBhbGwgbWVzc2FnZXMgYXMgcmVhZCdcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlcy5qc29uKHtcclxuICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICBtZXNzYWdlOiAnQWxsIG1lc3NhZ2VzIG1hcmtlZCBhcyByZWFkJ1xyXG4gIH0pO1xyXG59KSk7XHJcblxyXG4vLyBEZWxldGUgYSBtZXNzYWdlXHJcbnJvdXRlci5kZWxldGUoJy86bWVzc2FnZUlkJywgYXV0aGVudGljYXRlLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogQXV0aFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICBjb25zdCB1c2VySWQgPSByZXEudXNlciEudXNlcklkO1xyXG4gIGNvbnN0IG1lc3NhZ2VJZCA9IHJlcS5wYXJhbXMubWVzc2FnZUlkO1xyXG4gIGNvbnN0IHVpZCA9IFN0cmluZyh1c2VySWQpO1xyXG5cclxuICAvLyBCYXNpYyBVVUlEIHZhbGlkYXRpb24gKFN1cGFiYXNlIHVzZXMgVVVJRCBmb3IgSURzKVxyXG4gIGNvbnN0IHV1aWRSZWdleCA9IC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzEtNV1bMC05YS1mXXszfS1bODlhYl1bMC05YS1mXXszfS1bMC05YS1mXXsxMn0kL2k7XHJcbiAgaWYgKCF1dWlkUmVnZXgudGVzdChtZXNzYWdlSWQpKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBjb2RlOiAnSU5WQUxJRF9NRVNTQUdFX0lEJyxcclxuICAgICAgbWVzc2FnZTogJ0ludmFsaWQgbWVzc2FnZSBJRCBmb3JtYXQnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIERlbGV0ZSBtZXNzYWdlIChvbmx5IGlmIHVzZXIgaXMgc2VuZGVyIG9yIHJlY2lwaWVudClcclxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLk1FU1NBR0VTKVxyXG4gICAgLmRlbGV0ZSgpXHJcbiAgICAuZXEoREJfRklFTERTLkJVSUxESU5HUy5JRCwgbWVzc2FnZUlkKVxyXG4gICAgLm9yKGBmcm9tX3VzZXJfaWQuZXEuJHt1aWR9LHRvX3VzZXJfaWQuZXEuJHt1aWR9YClcclxuICAgIC5zZWxlY3QoREJfRklFTERTLkJVSUxESU5HUy5JRClcclxuICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBtZXNzYWdlOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLklOVEVSTkFMX1NFUlZFUl9FUlJPUikuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBkZWxldGUgbWVzc2FnZSdcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFkYXRhKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgY29kZTogJ01FU1NBR0VfTk9UX0ZPVU5EJyxcclxuICAgICAgbWVzc2FnZTogJ01lc3NhZ2Ugbm90IGZvdW5kIG9yIG5vdCBhdXRob3JpemVkJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzLmpzb24oe1xyXG4gICAgc3VjY2VzczogdHJ1ZSxcclxuICAgIG1lc3NhZ2U6ICdNZXNzYWdlIGRlbGV0ZWQnXHJcbiAgfSk7XHJcbn0pKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjtcclxuXHJcbiJdLCJ2ZXJzaW9uIjozfQ==
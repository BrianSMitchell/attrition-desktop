{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\api-consistency.validation.test.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\api-consistency.validation.test.ts"],"sourcesContent":["ï»¿/**\r\n * API Consistency Validation Test Suite\r\n * \r\n * Validates that all /api/game/* routes follow consistent patterns for:\r\n * - Response format structure\r\n * - HTTP status codes for similar scenarios\r\n * - Authentication behavior\r\n * - Empire resolution consistency\r\n * - Error message standards\r\n * \r\n * This test suite ensures the fixes implemented in Task 4.5 are working correctly\r\n * and maintains consistency across all game routes.\r\n */\r\n\r\nimport request from 'supertest';\r\nimport { app } from '../index';\r\nimport { HTTP_STATUS, ERROR_MESSAGES } from '../constants/response-formats';\r\nimport { API_ENDPOINTS } from '../constants/api-endpoints';\r\n\r\n\r\n// Mock the Supabase client for consistent testing\r\njest.mock('../config/supabase', () => ({\r\n  supabase: {\r\n    auth: {\r\n      signInWithPassword: jest.fn()\r\n    },\r\n    from: jest.fn().mockImplementation((table: string) => ({\r\n      select: jest.fn().mockReturnThis(),\r\n      insert: jest.fn().mockReturnThis(),\r\n      update: jest.fn().mockReturnThis(),\r\n      upsert: jest.fn().mockReturnThis(),\r\n      delete: jest.fn().mockReturnThis(),\r\n      eq: jest.fn().mockReturnThis(),\r\n      in: jest.fn().mockReturnThis(),\r\n      not: jest.fn().mockReturnThis(),\r\n      is: jest.fn().mockReturnThis(),\r\n      gt: jest.fn().mockReturnThis(),\r\n      order: jest.fn().mockReturnThis(),\r\n      limit: jest.fn().mockReturnThis(),\r\n      maybeSingle: jest.fn().mockReturnThis(),\r\n      single: jest.fn().mockReturnThis(),\r\n      // Default mock data based on table\r\n      data: getMockData(table),\r\n      error: null\r\n    }))\r\n  }\r\n}));\r\n\r\n// Mock authentication middleware to control auth behavior in tests\r\njest.mock('../middleware/auth', () => ({\r\n  authenticate: (req: any, res: any, next: any) => {\r\n    // Check for valid test token\r\n    const authHeader = req.headers.authorization;\r\n    if (authHeader === 'Bearer test-valid-token') {\r\n      req.user = { \r\n        id: 'test-user-id',\r\n        _id: 'test-user-id', // Support both formats\r\n        email: 'test@example.com'\r\n      };\r\n      return next();\r\n    }\r\n    // No token or invalid token\r\n    return res.status(HTTP_STATUS.UNAUTHORIZED).json({ \r\n      success: false, \r\n      error: ERROR_MESSAGES.AUTHENTICATION_REQUIRED \r\n    });\r\n  }\r\n}));\r\n\r\n// Mock EmpireResolutionService\r\njest.mock('../services/empire/EmpireResolutionService', () => ({\r\n  EmpireResolutionService: {\r\n    resolveEmpireByUserObject: jest.fn().mockImplementation((user: any) => {\r\n      if (user && (user.id === 'test-user-id' || user._id === 'test-user-id')) {\r\n        return Promise.resolve({\r\n          id: 'test-empire-id',\r\n          name: 'Test Empire',\r\n          credits: 10000,\r\n          energy: 5000,\r\n          territories: ['A00:10:20:30']\r\n        });\r\n      }\r\n      return Promise.resolve(null); // Empire not found\r\n    })\r\n  }\r\n}));\r\n\r\n// Helper function to provide mock data based on table\r\nfunction getMockData(table: string): any {\r\n  const mockData: Record<string, any> = {\r\n    'empires': {\r\n      id: 'test-empire-id',\r\n      name: 'Test Empire',\r\n      credits: 10000,\r\n      energy: 5000,\r\n      territories: ['A00:10:20:30']\r\n    },\r\n    'colonies': [],\r\n    'locations': [{ coord: 'A00:10:20:30' }],\r\n    'buildings': [],\r\n    'fleets': [],\r\n    'tech_queue': [],\r\n    'unit_queue': [],\r\n    'defense_queue': [],\r\n    'credit_transactions': []\r\n  };\r\n  \r\n  return mockData[table] || {};\r\n}\r\n\r\ndescribe('API Consistency Validation Suite', () => {\r\n  const VALID_TOKEN = 'test-valid-token';\r\n  const INVALID_TOKEN = 'invalid-token';\r\n  \r\n  // All game route endpoints to test\r\n  const GAME_ROUTES = [\r\n    { method: 'GET', path: API_ENDPOINTS.GAME.DASHBOARD },\r\n    { method: 'GET', path: '/api/game/empire' },\r\n    { method: 'GET', path: '/api/game/empire/credits/history' },\r\n    { method: 'GET', path: '/api/game/bases' },\r\n    { method: 'GET', path: '/api/game/bases/A00:10:20:30/stats' },\r\n    { method: 'GET', path: '/api/game/bases/A00:10:20:30/capacities' },\r\n    { method: 'GET', path: '/api/game/bases/A00:10:20:30/combined-stats' },\r\n    { method: 'GET', path: '/api/game/structures/catalog' },\r\n    { method: 'GET', path: '/api/game/structures/queue' },\r\n    { method: 'GET', path: '/api/game/structures/status/A00:10:20:30' },\r\n    { method: 'GET', path: '/api/game/tech/catalog' },\r\n    { method: 'GET', path: '/api/game/tech/status?base=A00:10:20:30' },\r\n    { method: 'GET', path: '/api/game/tech/queue' },\r\n    { method: 'GET', path: API_ENDPOINTS.GAME.FLEETS.BASE },\r\n    { method: 'GET', path: '/api/game/fleets/overview?base=A00:10:20:30' },\r\n    { method: 'GET', path: '/api/game/research' }\r\n  ];\r\n\r\n  describe('Task 4.6.1: Response Format Consistency Tests', () => {\r\n    \r\n    it('should return consistent success response format across all routes', async () => {\r\n      for (const route of GAME_ROUTES) {\r\n        const response = await request(app)\r\n          [route.method.toLowerCase() as 'get'](route.path)\r\n          .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n        // Should return 200 for successful requests\r\n        expect(response.status).toBe(HTTP_STATUS.OK);\r\n        \r\n        // Should have consistent success response structure\r\n        expect(response.body).toHaveProperty('success', true);\r\n        expect(response.body).toHaveProperty('data');\r\n        expect(typeof response.body.success).toBe('boolean');\r\n        expect(typeof response.body.data).toBe('object');\r\n        \r\n        // Should not have error field in success responses\r\n        expect(response.body).not.toHaveProperty('error');\r\n        \r\n        console.log(`âœ… ${route.method} ${route.path}: Success format consistent`);\r\n      }\r\n    });\r\n\r\n    it('should return consistent error response format for authentication failures', async () => {\r\n      const testRoutes = GAME_ROUTES.slice(0, 5); // Test subset for performance\r\n      \r\n      for (const route of testRoutes) {\r\n        const response = await request(app)\r\n          [route.method.toLowerCase() as 'get'](route.path);\r\n\r\n        // Should return 401 for unauthenticated requests\r\n        expect(response.status).toBe(HTTP_STATUS.UNAUTHORIZED);\r\n        \r\n        // Should have consistent error response structure\r\n        expect(response.body).toHaveProperty('success', false);\r\n        expect(response.body).toHaveProperty('error');\r\n        expect(typeof response.body.success).toBe('boolean');\r\n        expect(typeof response.body.error).toBe('string');\r\n        \r\n        // Should not have data field in error responses\r\n        expect(response.body).not.toHaveProperty('data');\r\n        \r\n        // Should not have inconsistent fields\r\n        expect(response.body).not.toHaveProperty('code');\r\n        expect(response.body).not.toHaveProperty('message');\r\n        expect(response.body).not.toHaveProperty('details');\r\n        \r\n        console.log(`âœ… ${route.method} ${route.path}: Error format consistent`);\r\n      }\r\n    });\r\n\r\n    it('should use basic error response pattern (no enhanced fields)', async () => {\r\n      // Test a route that should return validation error\r\n      const response = await request(app)\r\n        .get('/api/game/tech/status') // Missing required 'base' parameter\r\n        .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n      expect(response.status).toBe(HTTP_STATUS.BAD_REQUEST);\r\n      expect(response.body).toEqual({\r\n        success: false,\r\n        error: expect.any(String)\r\n      });\r\n      \r\n      // Ensure no enhanced error fields are present\r\n      expect(response.body).not.toHaveProperty('code');\r\n      expect(response.body).not.toHaveProperty('message');\r\n      expect(response.body).not.toHaveProperty('details');\r\n    });\r\n\r\n  });\r\n\r\n  describe('Task 4.6.2: HTTP Status Code Consistency Tests', () => {\r\n\r\n    it('should return 401 for all unauthenticated requests', async () => {\r\n      const testRoutes = [\r\n        API_ENDPOINTS.GAME.DASHBOARD,\r\n        '/api/game/empire',\r\n        '/api/game/bases',\r\n        API_ENDPOINTS.GAME.FLEETS.BASE,\r\n        '/api/game/structures/catalog'\r\n      ];\r\n\r\n      for (const path of testRoutes) {\r\n        const response = await request(app).get(path);\r\n        expect(response.status).toBe(HTTP_STATUS.UNAUTHORIZED);\r\n        expect(response.body.success).toBe(false);\r\n        expect(response.body.error).toBe(ERROR_MESSAGES.AUTHENTICATION_REQUIRED);\r\n      }\r\n    });\r\n\r\n    it('should return 400 for validation errors consistently', async () => {\r\n      const validationTestCases = [\r\n        { \r\n          path: '/api/game/tech/status', \r\n          description: 'missing base parameter' \r\n        },\r\n        { \r\n          path: '/api/game/bases//stats', \r\n          description: 'empty coordinate parameter',\r\n          expectedStatus: HTTP_STATUS.NOT_FOUND // This will actually be 404 due to routing\r\n        },\r\n        {\r\n          path: '/api/game/fleets/overview',\r\n          description: 'missing base parameter for fleet overview'\r\n        }\r\n      ];\r\n\r\n      for (const testCase of validationTestCases) {\r\n        const response = await request(app)\r\n          .get(testCase.path)\r\n          .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n        const expectedStatus = testCase.expectedStatus || 400;\r\n        expect(response.status).toBe(expectedStatus);\r\n        expect(response.body.success).toBe(false);\r\n        expect(typeof response.body.error).toBe('string');\r\n        \r\n        console.log(`âœ… ${testCase.path}: ${testCase.description} returns ${expectedStatus}`);\r\n      }\r\n    });\r\n\r\n    it('should return consistent status codes for POST endpoints', async () => {\r\n      // Test POST endpoints with invalid data\r\n      const postTestCases = [\r\n        {\r\n          path: '/api/game/structures/start',\r\n          body: {}, // Missing required fields\r\n          expectedStatus: HTTP_STATUS.BAD_REQUEST\r\n        },\r\n        {\r\n          path: '/api/game/tech/start',\r\n          body: {}, // Missing required fields  \r\n          expectedStatus: HTTP_STATUS.BAD_REQUEST\r\n        }\r\n      ];\r\n\r\n      for (const testCase of postTestCases) {\r\n        const response = await request(app)\r\n          .post(testCase.path)\r\n          .set('Authorization', `Bearer ${VALID_TOKEN}`)\r\n          .send(testCase.body);\r\n\r\n        expect(response.status).toBe(testCase.expectedStatus);\r\n        expect(response.body.success).toBe(false);\r\n        expect(typeof response.body.error).toBe('string');\r\n      }\r\n    });\r\n\r\n  });\r\n\r\n  describe('Task 4.6.3: Empire Resolution Consistency Tests', () => {\r\n\r\n    beforeEach(() => {\r\n      // Reset mocks before each test\r\n      jest.clearAllMocks();\r\n    });\r\n\r\n    it('should return 404 with consistent format when empire not found', async () => {\r\n      // Mock EmpireResolutionService to return null (empire not found)\r\n      const { EmpireResolutionService } = require('../services/empire/EmpireResolutionService');\r\n      EmpireResolutionService.resolveEmpireByUserObject.mockResolvedValueOnce(null);\r\n\r\n      const testRoutes = [\r\n        '/api/game/empire',\r\n        '/api/game/bases',\r\n        '/api/game/structures/queue',\r\n        API_ENDPOINTS.GAME.FLEETS.BASE\r\n      ];\r\n\r\n      for (const path of testRoutes) {\r\n        const response = await request(app)\r\n          .get(path)\r\n          .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n        // Should return 404 for empire not found\r\n        expect(response.status).toBe(HTTP_STATUS.NOT_FOUND);\r\n        \r\n        // Should have consistent error response structure\r\n        expect(response.body).toEqual({\r\n          success: false,\r\n          error: ERROR_MESSAGES.EMPIRE_NOT_FOUND\r\n        });\r\n\r\n        console.log(`âœ… ${path}: Empire not found returns consistent 404`);\r\n        \r\n        // Reset mock for next iteration\r\n        EmpireResolutionService.resolveEmpireByUserObject.mockImplementation((user: any) => {\r\n          if (user && (user.id === 'test-user-id' || user._id === 'test-user-id')) {\r\n            return Promise.resolve({\r\n              id: 'test-empire-id',\r\n              name: 'Test Empire',\r\n              credits: 10000,\r\n              energy: 5000,\r\n              territories: ['A00:10:20:30']\r\n            });\r\n          }\r\n          return Promise.resolve(null);\r\n        });\r\n      }\r\n    });\r\n\r\n    it('should use EmpireResolutionService consistently across all routes', async () => {\r\n      const { EmpireResolutionService } = require('../services/empire/EmpireResolutionService');\r\n      \r\n      // Make successful requests to routes that should use empire resolution\r\n      const empireDependentRoutes = [\r\n        '/api/game/empire',\r\n        '/api/game/bases',\r\n        '/api/game/structures/queue',\r\n        '/api/game/tech/queue',\r\n        API_ENDPOINTS.GAME.FLEETS.BASE\r\n      ];\r\n\r\n      for (const path of empireDependentRoutes) {\r\n        await request(app)\r\n          .get(path)\r\n          .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n        // Verify EmpireResolutionService was called\r\n        expect(EmpireResolutionService.resolveEmpireByUserObject).toHaveBeenCalled();\r\n      }\r\n\r\n      // Should have been called once per route\r\n      expect(EmpireResolutionService.resolveEmpireByUserObject).toHaveBeenCalledTimes(\r\n        empireDependentRoutes.length\r\n      );\r\n    });\r\n\r\n  });\r\n\r\n  describe('Task 4.6.4: Error Response Pattern Tests', () => {\r\n\r\n    it('should never expose database error details', async () => {\r\n      // Mock database error\r\n      const mockSupabase = require('../config/supabase').supabase;\r\n      mockSupabase.from.mockImplementationOnce(() => ({\r\n        select: jest.fn().mockReturnThis(),\r\n        eq: jest.fn().mockReturnThis(),\r\n        data: null,\r\n        error: { message: 'Internal database connection failed', code: 'ECONNREFUSED' }\r\n      }));\r\n\r\n      const response = await request(app)\r\n        .get(API_ENDPOINTS.GAME.FLEETS.BASE)\r\n        .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n      // Should return 500 for server errors\r\n      expect(response.status).toBe(HTTP_STATUS.INTERNAL_SERVER_ERROR);\r\n      \r\n      // Should have generic error message, not database details\r\n      expect(response.body).toEqual({\r\n        success: false,\r\n        error: expect.stringMatching(/^Failed to fetch/)\r\n      });\r\n      \r\n      // Should not expose internal database error details\r\n      expect(response.body.error).not.toContain('ECONNREFUSED');\r\n      expect(response.body.error).not.toContain('Internal database');\r\n      expect(response.body).not.toHaveProperty('code');\r\n    });\r\n\r\n    it('should provide user-friendly error messages', async () => {\r\n      const testCases = [\r\n        {\r\n          path: '/api/game/tech/status',\r\n          expectedError: /base coordinate/i\r\n        },\r\n        {\r\n          path: '/api/game/fleets/overview',\r\n          expectedError: /base parameter/i\r\n        }\r\n      ];\r\n\r\n      for (const testCase of testCases) {\r\n        const response = await request(app)\r\n          .get(testCase.path)\r\n          .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n        expect(response.body.error).toMatch(testCase.expectedError);\r\n        \r\n        // Error should be descriptive but not technical\r\n        expect(response.body.error.length).toBeGreaterThan(10);\r\n        expect(response.body.error).not.toContain('undefined');\r\n        expect(response.body.error).not.toContain('null');\r\n      }\r\n    });\r\n\r\n    it('should handle service errors consistently', async () => {\r\n      // Mock a service that returns an error\r\n      jest.doMock('../services/structures/StructureService', () => ({\r\n        StructureService: {\r\n          startConstruction: jest.fn().mockResolvedValue({\r\n            success: false,\r\n            code: 'ALREADY_IN_PROGRESS',\r\n            error: ERROR_MESSAGES.CONSTRUCTION_IN_PROGRESS\r\n          })\r\n        }\r\n      }));\r\n\r\n      const response = await request(app)\r\n        .post('/api/game/structures/start')\r\n        .set('Authorization', `Bearer ${VALID_TOKEN}`)\r\n        .send({\r\n          locationCoord: 'A00:10:20:30',\r\n          catalogKey: 'solar_plants'\r\n        });\r\n\r\n      // Should map service error codes to appropriate HTTP status\r\n      expect(response.status).toBe(HTTP_STATUS.CONFLICT); // Conflict for ALREADY_IN_PROGRESS\r\n      \r\n      // Should normalize service error to basic pattern\r\n      expect(response.body).toEqual({\r\n        success: false,\r\n        error: ERROR_MESSAGES.CONSTRUCTION_IN_PROGRESS\r\n      });\r\n      \r\n      // Should not expose service-specific code\r\n      expect(response.body).not.toHaveProperty('code');\r\n    });\r\n\r\n  });\r\n\r\n  describe('Integration: Full API Consistency Validation', () => {\r\n\r\n    it('should maintain consistent patterns across all routes', async () => {\r\n      const results = {\r\n        successResponses: 0,\r\n        errorResponses: 0,\r\n        statusCodeConsistency: true,\r\n        responseFormatConsistency: true\r\n      };\r\n\r\n      // Test a subset of routes for comprehensive validation\r\n      const testRoutes = GAME_ROUTES.slice(0, 8);\r\n\r\n      for (const route of testRoutes) {\r\n        // Test successful request\r\n        const successResponse = await request(app)\r\n          [route.method.toLowerCase() as 'get'](route.path)\r\n          .set('Authorization', `Bearer ${VALID_TOKEN}`);\r\n\r\n        if (successResponse.status === HTTP_STATUS.OK) {\r\n          results.successResponses++;\r\n          \r\n          // Validate success response format\r\n          if (!successResponse.body.hasOwnProperty('success') || \r\n              !successResponse.body.hasOwnProperty('data') ||\r\n              successResponse.body.hasOwnProperty('error')) {\r\n            results.responseFormatConsistency = false;\r\n          }\r\n        }\r\n\r\n        // Test authentication error\r\n        const errorResponse = await request(app)\r\n          [route.method.toLowerCase() as 'get'](route.path);\r\n\r\n        if (errorResponse.status === HTTP_STATUS.UNAUTHORIZED) {\r\n          results.errorResponses++;\r\n          \r\n          // Validate error response format\r\n          if (!errorResponse.body.hasOwnProperty('success') ||\r\n              !errorResponse.body.hasOwnProperty('error') ||\r\n              errorResponse.body.hasOwnProperty('data') ||\r\n              errorResponse.body.hasOwnProperty('code') ||\r\n              errorResponse.body.hasOwnProperty('message')) {\r\n            results.responseFormatConsistency = false;\r\n          }\r\n        } else {\r\n          results.statusCodeConsistency = false;\r\n        }\r\n      }\r\n\r\n      // Validate overall consistency\r\n      expect(results.responseFormatConsistency).toBe(true);\r\n      expect(results.statusCodeConsistency).toBe(true);\r\n      expect(results.successResponses).toBeGreaterThan(0);\r\n      expect(results.errorResponses).toBeGreaterThan(0);\r\n\r\n      console.log('ðŸ“Š API Consistency Results:', results);\r\n    });\r\n\r\n  });\r\n\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"version":3}
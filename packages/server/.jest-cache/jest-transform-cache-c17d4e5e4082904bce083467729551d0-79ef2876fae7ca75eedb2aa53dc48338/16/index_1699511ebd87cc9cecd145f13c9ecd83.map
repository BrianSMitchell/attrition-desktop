{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\routes\\game\\index.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\routes\\game\\index.ts"],"sourcesContent":["import { Router, Response } from 'express';\r\nimport { supabase } from '../../config/supabase';\r\nimport { asyncHandler } from '../../middleware/errorHandler';\r\nimport { authenticate, AuthRequest } from '../../middleware/auth';\r\nimport { ERROR_MESSAGES } from '../../constants/response-formats';\r\nimport { ENV_VALUES } from '@game/shared';\r\n\r\n// Constants imports for eliminating hardcoded values\r\nimport { DB_TABLES, DB_FIELDS } from '../../constants/database-fields';\r\nimport { HTTP_STATUS } from '@game/shared';\r\nimport { ENV_VARS } from '@game/shared';\r\nimport { \r\n  BuildingKey,\r\n  DefenseKey,\r\n  TechnologyKey, \r\n  UnitKey,\r\n  getTechnologyList,\r\n  getBuildingsList,\r\n  getDefensesList,\r\n  getUnitsList,\r\n  getUnitSpec,\r\n  getTechSpec,\r\n  getStructureCreditCostForLevel,\r\n  getBuildingSpec\r\n} from '@game/shared';\r\nimport { EmpireResolutionService } from '../../services/empire/EmpireResolutionService';\r\nimport dashboardRoutes from './dashboard';\r\nimport empireRoutes from './empire';\r\nimport baseRoutes from './bases';\r\nimport structureRoutes from './structures';\r\nimport techRoutes from './tech';\r\nimport defensesRoutes from './defenses';\r\nimport unitsRoutes from './units';\r\nimport fleetRoutes from './fleets';\r\nimport territoriesRoutes from './territories';\r\nimport testSeedsRoutes from './test-seeds';\r\n\r\nconst router: Router = Router();\r\n\r\n// All game routes require authentication\r\nrouter.use(authenticate);\r\n\r\n// Mount sub-routers\r\nrouter.use('/dashboard', dashboardRoutes);\r\nrouter.use('/empire', empireRoutes);\r\nrouter.use('/bases', baseRoutes);\r\nrouter.use('/structures', structureRoutes);\r\nrouter.use('/tech', techRoutes);  // Mount consolidated tech routes\r\nrouter.use('/defenses', defensesRoutes); // Mount defenses routes\r\nrouter.use('/units', unitsRoutes); // Mount units routes\r\nrouter.use('/fleets', fleetRoutes); // Mount fleet routes\r\nrouter.use('/territories', territoriesRoutes); // Mount territories routes\r\nrouter.use('/test', testSeedsRoutes); // Mount test seeding routes\r\n\r\n// Capacities route - direct capacity lookup by coordinate\r\nrouter.get('/capacities/:coord', asyncHandler(async (req: AuthRequest, res: Response) => {\r\n  const user = req.user! as any;\r\n  const { coord } = req.params;\r\n\r\n  if (!coord) {\r\n    return res.status(HTTP_STATUS.BAD_REQUEST).json({\r\n      success: false,\r\n      error: ERROR_MESSAGES.COORDINATE_PARAMETER_REQUIRED\r\n    });\r\n  }\r\n\r\n  // Resolve empire using the service\r\n  const empireRow = await EmpireResolutionService.resolveEmpireByUserObject(user);\r\n  if (!empireRow) {\r\n    return res.status(HTTP_STATUS.NOT_FOUND).json({ success: false, error: ERROR_MESSAGES.EMPIRE_NOT_FOUND });\r\n  }\r\n\r\n  const empireId = String(empireRow.id);\r\n\r\n  // Use the existing CapacityService\r\n  const { CapacityService } = await import('../../services/bases/CapacityService');\r\n  const capacities = await CapacityService.getBaseCapacities(empireId, coord);\r\n\r\n  return res.json({\r\n    success: true,\r\n    data: capacities\r\n  });\r\n}));\r\n\r\n// Buildings by location route\r\nrouter.get('/buildings/location/:coord', asyncHandler(async (req: AuthRequest, res: Response) => {\r\n  const user = req.user! as any;\r\n  const { coord } = req.params;\r\n\r\n  if (!coord) {\r\n    return res.status(HTTP_STATUS.BAD_REQUEST).json({\r\n      success: false,\r\n      error: ERROR_MESSAGES.COORDINATE_PARAMETER_REQUIRED\r\n    });\r\n  }\r\n\r\n  // Resolve empire using the service\r\n  const empireRow = await EmpireResolutionService.resolveEmpireByUserObject(user);\r\n  if (!empireRow) {\r\n    return res.status(HTTP_STATUS.NOT_FOUND).json({ success: false, error: ERROR_MESSAGES.EMPIRE_NOT_FOUND });\r\n  }\r\n\r\n  const empireId = String(empireRow.id);\r\n\r\n  // Get all buildings at this location for this empire\r\n  const { data: buildings, error } = await supabase\r\n    .from(DB_TABLES.BUILDINGS)\r\n    .select(`\r\n      id,\r\n      catalog_key,\r\n      level,\r\n      is_active,\r\n      pending_upgrade,\r\n      construction_started,\r\n      construction_completed,\r\n      credits_cost\r\n    `)\r\n    .eq(DB_FIELDS.BUILDINGS.EMPIRE_ID, empireId)\r\n    .eq(DB_FIELDS.BUILDINGS.LOCATION_COORD, coord)\r\n    .order(DB_FIELDS.BUILDINGS.CATALOG_KEY, { ascending: true });\r\n\r\n  if (error) {\r\n    console.error('Error fetching buildings:', error);\r\n    return res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\r\n      success: false,\r\n      error: 'Failed to fetch buildings'\r\n    });\r\n  }\r\n\r\n  // Format buildings data for client\r\n  const formattedBuildings = (buildings || []).map((building: any) => ({\r\n    id: building.id,\r\n    catalogKey: building.catalog_key,\r\n    level: building.level,\r\n    isActive: building.is_active,\r\n    pendingUpgrade: building.pending_upgrade,\r\n    constructionStarted: building.construction_started ? new Date(building.construction_started) : null,\r\n    constructionCompleted: building.construction_completed ? new Date(building.construction_completed) : null,\r\n    creditsCost: building.credits_cost\r\n  }));\r\n\r\n  return res.json({\r\n    success: true,\r\n    data: {\r\n      buildings: formattedBuildings\r\n    }\r\n  });\r\n}));\r\n\r\n// Colonization route needs Supabase implementation\r\n\r\n/**\r\n * Test-only seeding endpoint to make Research Start deterministic in E2E.\r\n * - Ensures the authenticated user's empire has sufficient credits\r\n * - Ensures the specified (or first) base has at least one active research_lab (level 1)\r\n * Guarded by NODE_ENV === ENV_VALUES.TEST\r\n *\r\n * DTO (success):\r\n * {\r\n *   \"success\": true,\r\n *   \"data\": { \"baseCoord\": \"...\", DB_FIELDS.EMPIRES.CREDITS: 50000, \"baseLabTotal\": 1 },\r\n *   \"message\": \"Seeded test research lab and credits\"\r\n * }\r\n */\r\n/**\r\n * Test-only seeding endpoint to make Defenses Start deterministic in E2E.\r\n * - Tops up credits\r\n * - Ensures tech prereqs for jump_gate (warp_drive 12, energy 20)\r\n * - Ensures positive energy projection by adding active solar plants at the base\r\n * Guarded by NODE_ENV === ENV_VALUES.TEST\r\n */\r\n/**\r\n * Test-only seeding endpoint to make Structures Start deterministic in E2E.\r\n * - Tops up credits\r\n * - Broadly raises tech levels so most structures are eligible\r\n * - Ensures positive energy projection and construction capacity (solar + robotics)\r\n * Guarded by NODE_ENV === ENV_VALUES.TEST\r\n */\r\n/**\r\n * Test-only cleanup endpoint to remove queued buildings for idempotency testing.\r\n * Guarded by NODE_ENV === ENV_VALUES.TEST\r\n */\r\n// Research Management Routes\r\n\r\n// Get empire research projects\r\nrouter.get('/research', asyncHandler(async (req: AuthRequest, res: Response) => {\r\n  const user = req.user! as any;\r\n\r\n  // Resolve empire using the service\r\n  const empireRow = await EmpireResolutionService.resolveEmpireByUserObject(user);\r\n  if (!empireRow) {\r\n    return res.status(HTTP_STATUS.NOT_FOUND).json({\r\n      success: false,\r\n      error: ERROR_MESSAGES.EMPIRE_NOT_FOUND\r\n    });\r\n  }\r\n\r\n  const empireId = String(empireRow.id);\r\n\r\n  // For now, return empty array as research projects haven't been fully implemented in Supabase yet\r\n  // This maintains API compatibility while the research system is being migrated\r\n  res.json({\r\n    success: true,\r\n    data: { researchProjects: [] }\r\n  });\r\n}));\r\n\r\n/**\r\n * Phase A Technology Routes\r\n * - Credits-based level-1 unlocks\r\n * - Gated by sum of research_lab levels at the selected base\r\n * - Prerequisites per technology (empire-wide levels)\r\n */\r\n\r\n// Get technology catalog\r\nrouter.get('/tech/catalog', asyncHandler(async (_req: AuthRequest, res: Response) => {\r\n  const catalog = getTechnologyList();\r\n  res.json({\r\n    success: true,\r\n    data: { catalog }\r\n  });\r\n}));\r\n\r\n// Get tech status for a specific base (labs, eligibility, credits)\r\nrouter.get('/tech/status', asyncHandler(async (req: AuthRequest, res: Response) => {\r\n  const user = req.user! as any;\r\n  const userId = user?._id || user?.id;\r\n  const baseCoord = String(req.query.base || '').trim();\r\n  if (!baseCoord) return res.status(HTTP_STATUS.BAD_REQUEST).json({ success: false, error: 'Missing base coordinate (?base=...)' });\r\n\r\n  // Resolve empire id\r\n  let empireId: string | null = null;\r\n  const userRow = await supabase.from(DB_TABLES.USERS).select('id, empire_id').eq(DB_FIELDS.BUILDINGS.ID, userId).maybeSingle();\r\n  if (userRow.data?.empire_id) empireId = String(userRow.data.empire_id);\r\n  if (!empireId) {\r\n    const e = await supabase.from(DB_TABLES.EMPIRES).select(DB_FIELDS.BUILDINGS.ID).eq(DB_FIELDS.EMPIRES.USER_ID, userId).maybeSingle();\r\n    if (e.data?.id) empireId = String(e.data.id);\r\n  }\r\n  if (!empireId) return res.status(HTTP_STATUS.NOT_FOUND).json({ success: false, error: ERROR_MESSAGES.EMPIRE_NOT_FOUND });\r\n\r\nconst { TechService } = await import('../../services/tech/TechService');\r\n  const status = await TechService.getStatus(userId, empireId, baseCoord);\r\n  res.json({\r\n    success: true,\r\n    data: { status }\r\n  });\r\n}));\r\n\r\n// Start technology research with capacity-driven ETA\r\nrouter.post('/tech/start', asyncHandler(async (req: AuthRequest, res: Response) => {\r\n  const user = req.user! as any;\r\n  const userId = user?._id || user?.id;\r\n  const { locationCoord, techKey } = req.body as { locationCoord?: string; techKey?: TechnologyKey };\r\n  console.log('[tech/start] Request:', { userId, locationCoord, techKey, body: req.body });\r\n  if (!locationCoord || !techKey) {\r\n    console.log('[tech/start] Missing required params');\r\n    return res.status(HTTP_STATUS.BAD_REQUEST).json({ success: false, error: 'locationCoord and techKey are required' });\r\n  }\r\n\r\n  // Resolve empire id\r\n  let empireId: string | null = null;\r\n  const userRow = await supabase.from(DB_TABLES.USERS).select('id, empire_id').eq(DB_FIELDS.BUILDINGS.ID, userId).maybeSingle();\r\n  if (userRow.data?.empire_id) empireId = String(userRow.data.empire_id);\r\n  if (!empireId) {\r\n    const e = await supabase.from(DB_TABLES.EMPIRES).select(DB_FIELDS.BUILDINGS.ID).eq(DB_FIELDS.EMPIRES.USER_ID, userId).maybeSingle();\r\n    if (e.data?.id) empireId = String(e.data.id);\r\n  }\r\n  if (!empireId) return res.status(HTTP_STATUS.NOT_FOUND).json({ success: false, error: ERROR_MESSAGES.EMPIRE_NOT_FOUND });\r\n\r\n  const { TechService } = await import('../../services/tech/TechService');\r\n  const result = await TechService.start(userId, empireId, locationCoord, techKey as any);\r\n  if (!result.success) {\r\n    const statusCode = (result as any).code === 'ALREADY_IN_PROGRESS' ? 409 : HTTP_STATUS.BAD_REQUEST;\r\n    return res.status(statusCode).json(result);\r\n  }\r\n  return res.json({ success: true, data: (result as any).data, message: (result as any).message });\r\n}));\r\n\r\n// Structures routes moved to ./structures.ts (mounted at /structures)\r\n// Defenses routes moved to ./defenses.ts (mounted at /defenses)\r\n// Units routes moved to ./units.ts (mounted at /units)\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Fleets Overview ? public view for a base\r\n * Returns all stationed fleets at the base (any empire) and any inbound movements to that base.\r\n * Query: ?base=COORD\r\n * DTO: { success, data: { fleets: [{ _id, name, ownerName, arrival, sizeCredits }] } }\r\n */\r\nrouter.get('/fleets-overview', asyncHandler(async (req: AuthRequest, res: Response) => {\r\n  const baseCoord = String(req.query.base || '').trim();\r\n  if (!baseCoord) {\r\n    return res.status(HTTP_STATUS.BAD_REQUEST).json({ success: false, error: 'Missing base coordinate (?base=...)' });\r\n  }\r\n    // ========== SUPABASE PATH ==========\r\n    try {\r\n      // 1) Query stationed fleets at this base (all empires)\r\n      const { data: stationedFleets, error: fleetsError } = await supabase\r\n        .from(DB_TABLES.FLEETS)\r\n        .select('id, empire_id, name, size_credits')\r\n        .eq(DB_FIELDS.BUILDINGS.LOCATION_COORD, baseCoord);\r\n\r\n      if (fleetsError) {\r\n        return res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\r\n          success: false,\r\n          code: 'DB_ERROR',\r\n          error: fleetsError.message\r\n        });\r\n      }\r\n\r\n      // Collect empire IDs for name lookup\r\n      const empireIds = new Set<string>();\r\n      for (const f of stationedFleets || []) {\r\n        if (f.empire_id) empireIds.add(String(f.empire_id));\r\n      }\r\n\r\n      // 2) Query inbound fleet movements to this base (pending/travelling)\r\n      const { data: incomingMovements, error: movementsError } = await supabase\r\n        .from(DB_TABLES.FLEET_MOVEMENTS)\r\n        .select('id, empire_id, fleet_id, estimated_arrival_time, size_credits')\r\n        .eq('destination_coord', baseCoord)\r\n        .in(DB_FIELDS.TECH_QUEUE.STATUS, ['pending', 'travelling']);\r\n\r\n      if (movementsError) {\r\n        return res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\r\n          success: false,\r\n          code: 'DB_ERROR',\r\n          error: movementsError.message\r\n        });\r\n      }\r\n\r\n      // Collect empire IDs from movements\r\n      for (const m of incomingMovements || []) {\r\n        if (m.empire_id) empireIds.add(String(m.empire_id));\r\n      }\r\n\r\n      // 3) Lookup empire names\r\n      const empireNameById = new Map<string, string>();\r\n      if (empireIds.size > 0) {\r\n        const { data: empireDocs, error: empiresError } = await supabase\r\n          .from(DB_TABLES.EMPIRES)\r\n          .select('id, name')\r\n          .in(DB_FIELDS.BUILDINGS.ID, Array.from(empireIds));\r\n\r\n        if (!empiresError && empireDocs) {\r\n          for (const e of empireDocs) {\r\n            empireNameById.set(String(e.id), String(e.name || 'Unknown'));\r\n          }\r\n        }\r\n      }\r\n\r\n      // 4) For inbound movements, lookup fleet names\r\n      const inboundFleetIds = Array.from(new Set((incomingMovements || []).map(m => String(m.fleet_id))));\r\n      const inboundFleetById = new Map<string, any>();\r\n      \r\n      if (inboundFleetIds.length > 0) {\r\n        const { data: inboundFleetDocs, error: inboundFleetsError } = await supabase\r\n          .from(DB_TABLES.FLEETS)\r\n          .select('id, name, size_credits')\r\n          .in(DB_FIELDS.BUILDINGS.ID, inboundFleetIds);\r\n\r\n        if (!inboundFleetsError && inboundFleetDocs) {\r\n          for (const f of inboundFleetDocs) {\r\n            inboundFleetById.set(String(f.id), f);\r\n          }\r\n        }\r\n      }\r\n\r\n      // 5) Build response rows\r\n      const rows: Array<{ _id: string; name: string; ownerName: string; arrival: string | null; sizeCredits: number }> = [];\r\n\r\n      // Add stationed fleets\r\n      for (const f of stationedFleets || []) {\r\n        rows.push({\r\n          _id: String(f.id),\r\n          name: String(f.name),\r\n          ownerName: empireNameById.get(String(f.empire_id)) || 'Unknown',\r\n          arrival: null, // stationed at base\r\n          sizeCredits: Number(f.size_credits || 0),\r\n        });\r\n      }\r\n\r\n      // Add incoming movements\r\n      for (const m of incomingMovements || []) {\r\n        const fleetDoc = inboundFleetById.get(String(m.fleet_id));\r\n        rows.push({\r\n          _id: String(m.id), // movement id as unique row id\r\n          name: fleetDoc ? String(fleetDoc.name) : 'Inbound Fleet',\r\n          ownerName: empireNameById.get(String(m.empire_id)) || 'Unknown',\r\n          arrival: m.estimated_arrival_time ? new Date(m.estimated_arrival_time).toISOString() : null,\r\n          sizeCredits: Number(m.size_credits || (fleetDoc?.size_credits ?? 0)),\r\n        });\r\n      }\r\n\r\n      return res.json({ success: true, data: { fleets: rows } });\r\n    } catch (err) {\r\n      return res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\r\n        success: false,\r\n        code: ERROR_MESSAGES.INTERNAL_ERROR,\r\n        error: 'Failed to load fleet overview',\r\n        details: { base: baseCoord }\r\n      });\r\n    }\r\n}));\r\n\r\n/**\r\n * Fleet Movement Routes\r\n */\r\n\r\nexport default router;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"version":3}
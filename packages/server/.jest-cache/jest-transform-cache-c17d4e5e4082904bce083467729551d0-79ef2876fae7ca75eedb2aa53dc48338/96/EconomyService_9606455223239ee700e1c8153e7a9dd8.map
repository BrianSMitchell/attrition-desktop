{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\services\\economy\\EconomyService.ts","mappings":";;;AAAA,qEAAuE;AACvE,yCAA0E;AAC1E,oDAAiD;AACjD,MAAa,cAAc;IACzB;;;OAGG;IACH,MAAM,CAAC,KAAK,CAAC,0BAA0B,CAAC,QAAgB;QACtD,+BAA+B;QAC/B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,mBAAQ;aACnC,IAAI,CAAC,2BAAS,CAAC,SAAS,CAAC;aACzB,MAAM,CAAC,gDAAgD,CAAC;aACxD,EAAE,CAAC,2BAAS,CAAC,SAAS,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;QAE/C,IAAI,KAAK,EAAE,CAAC;YACV,mFAAmF;YACnF,OAAO,qBAAY,CAAC,OAAO,CAAC;QAC9B,CAAC;QAED,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,KAAK,MAAM,GAAG,IAAI,IAAI,IAAI,EAAE,EAAE,CAAC;YAC7B,gDAAgD;YAChD,IAAI,CAAC,GAAG,IAAI,GAAG,CAAC,SAAS,KAAK,IAAI;gBAAE,SAAS;YAC7C,MAAM,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,WAAW,IAAI,EAAE,CAAgB,CAAC;YACzD,IAAI,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC;YACnC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC;gBAAE,SAAS;YACnC,IAAI,CAAC;gBACH,MAAM,IAAI,GAAG,IAAA,wBAAe,EAAC,GAAG,CAAC,CAAC;gBAClC,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,EAAE,OAAO,IAAI,CAAC,CAAC,CAAC;gBAC5C,KAAK,IAAI,QAAQ,GAAG,KAAK,CAAC;YAC5B,CAAC;YAAC,MAAM,CAAC;gBACP,8BAA8B;YAChC,CAAC;QACH,CAAC;QACD,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;IACxC,CAAC;CACF;AAlCD,wCAkCC","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\services\\economy\\EconomyService.ts"],"sourcesContent":["import { DB_TABLES, DB_FIELDS } from '../../constants/database-fields';\nimport { STATUS_CODES, BuildingKey, getBuildingSpec } from '@game/shared';\nimport { supabase } from '../../config/supabase';\nexport class EconomyService {\n  /**\n   * Sum credits per hour for an empire by aggregating active buildings.\n   * Economy = sum(spec.economy * level) across all active buildings.\n   */\n  static async sumCreditsPerHourForEmpire(empireId: string): Promise<number> {\n    // Pull only the fields we need\n    const { data, error } = await supabase\n      .from(DB_TABLES.BUILDINGS)\n      .select('catalog_key, level, is_active, pending_upgrade')\n      .eq(DB_FIELDS.BUILDINGS.EMPIRE_ID, empireId);\n\n    if (error) {\n      // Fail soft: return STATUS_CODES.SUCCESS on read error to avoid crashing dashboard\n      return STATUS_CODES.SUCCESS;\n    }\n\n    let total = 0;\n    for (const row of data || []) {\n      // Count only active buildings for economy yield\n      if (!row || row.is_active !== true) continue;\n      const key = String(row.catalog_key || '') as BuildingKey;\n      let level = Number(row.level || 0);\n      if (!key || !(level > 0)) continue;\n      try {\n        const spec = getBuildingSpec(key);\n        const perLevel = Number(spec?.economy || 0);\n        total += perLevel * level;\n      } catch {\n        // Unknown catalog key; ignore\n      }\n    }\n    return Math.max(0, Math.floor(total));\n  }\n}\n"],"version":3}
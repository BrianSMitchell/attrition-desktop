{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\utils\\socketManager.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\utils\\socketManager.ts"],"sourcesContent":["import { Server } from 'socket.io';\r\n\r\n/**\r\n * Socket Manager - Central manager for Socket.IO instance\r\n * \r\n * This module provides a safe way to access the Socket.IO server instance\r\n * across the application without circular dependencies.\r\n */\r\n\r\n// Store the Socket.IO server instance\r\nlet ioInstance: Server | undefined;\r\n\r\n/**\r\n * Initialize the socket manager with a Socket.IO server instance\r\n * This should be called once during server startup from index.ts\r\n */\r\nexport function initSocketManager(io: Server): void {\r\n  if (ioInstance) {\r\n    console.warn('[SocketManager] Socket.IO instance already initialized');\r\n  }\r\n  ioInstance = io;\r\n  console.log('[SocketManager] Socket.IO instance registered');\r\n}\r\n\r\n/**\r\n * Get the current Socket.IO server instance\r\n * Returns undefined if not yet initialized\r\n */\r\nexport function getSocketIO(): Server | undefined {\r\n  return ioInstance;\r\n}\r\n\r\n/**\r\n * Emit an event to a specific room\r\n * \r\n * @param room - The room to emit to (e.g., 'empire:123abc')\r\n * @param event - The event name\r\n * @param data - The event data payload\r\n * @returns true if emitted successfully, false otherwise\r\n */\r\nexport function emitToRoom(room: string, event: string, data: any): boolean {\r\n  if (!ioInstance) {\r\n    console.warn(`[SocketManager] Cannot emit ${event} to ${room}: Socket.IO not initialized`);\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    ioInstance.to(room).emit(event, data);\r\n    return true;\r\n  } catch (error) {\r\n    console.error(`[SocketManager] Error emitting ${event} to ${room}:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Emit an event to a specific user by their empire ID\r\n * \r\n * @param empireId - The empire ID (user identifier)\r\n * @param event - The event name\r\n * @param data - The event data payload\r\n * @returns true if emitted successfully, false otherwise\r\n */\r\nexport function emitToEmpire(empireId: string, event: string, data: any): boolean {\r\n  return emitToRoom(`empire:${empireId}`, event, data);\r\n}\r\n\r\n/**\r\n * Broadcast an event to all connected clients\r\n * \r\n * @param event - The event name\r\n * @param data - The event data payload\r\n * @returns true if emitted successfully, false otherwise\r\n */\r\nexport function broadcastEvent(event: string, data: any): boolean {\r\n  if (!ioInstance) {\r\n    console.warn(`[SocketManager] Cannot broadcast ${event}: Socket.IO not initialized`);\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    ioInstance.emit(event, data);\r\n    return true;\r\n  } catch (error) {\r\n    console.error(`[SocketManager] Error broadcasting ${event}:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if Socket.IO is initialized and ready\r\n */\r\nexport function isSocketIOReady(): boolean {\r\n  return ioInstance !== undefined;\r\n}\r\n\r\n/**\r\n * Get connection statistics\r\n */\r\nexport function getConnectionStats(): { connected: number; rooms: string[] } {\r\n  if (!ioInstance) {\r\n    return { connected: 0, rooms: [] };\r\n  }\r\n\r\n  const sockets = ioInstance.of('/').sockets;\r\n  const rooms: string[] = [];\r\n  \r\n  // Get all room names\r\n  ioInstance.of('/').adapter.rooms.forEach((_, roomName) => {\r\n    rooms.push(roomName);\r\n  });\r\n\r\n  return {\r\n    connected: sockets.size,\r\n    rooms\r\n  };\r\n}\r\n\r\n/**\r\n * Emit a fleet update event to the owner empire\r\n * Convenience wrapper for the common fleet:updated event\r\n */\r\nexport function emitFleetUpdate(empireId: string, fleetData: {\r\n  fleetId: string;\r\n  locationCoord: string;\r\n  name: string;\r\n  sizeCredits: number;\r\n  unitCount: number;\r\n  unitAdded?: {\r\n    unitKey: string;\r\n    creditsCost: number;\r\n  };\r\n}): boolean {\r\n  return emitToEmpire(empireId, 'fleet:updated', fleetData);\r\n}\r\n\r\n/**\r\n * Emit a resource update event to the owner empire\r\n * Convenience wrapper for the common resources:updated event\r\n */\r\nexport function emitResourceUpdate(empireId: string, resources: any): boolean {\r\n  return emitToEmpire(empireId, 'resources:updated', resources);\r\n}\r\n\r\n/**\r\n * Emit a tech completion event to the owner empire\r\n * Convenience wrapper for the common tech:completed event\r\n */\r\nexport function emitTechComplete(empireId: string, techData: {\r\n  techKey: string;\r\n  level: number;\r\n  locationCoord: string;\r\n}): boolean {\r\n  return emitToEmpire(empireId, 'tech:completed', techData);\r\n}"],"version":3}
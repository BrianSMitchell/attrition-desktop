3e105bbac9ec7357a74eeaf1cb7eb016
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = void 0;
exports.initLogger = initLogger;
const shared_1 = require("@game/shared");
function isInfoEnabled() {
    return process.env[shared_1.ENV_VARS.DEBUG_RESOURCES] === 'true';
}
function fmtNs(ns) {
    return ns ? `[${ns}]` : '';
}
function createLogger(ns) {
    const info = (...args) => {
        if (isInfoEnabled())
            console.info(fmtNs(ns), ...args);
    };
    const debug = (...args) => {
        if (isInfoEnabled())
            console.debug(fmtNs(ns), ...args);
    };
    const warn = (...args) => console.warn(fmtNs(ns), ...args);
    const error = (...args) => console.error(fmtNs(ns), ...args);
    return {
        info,
        debug,
        warn,
        error,
        withNamespace(childNs) {
            const merged = ns ? `${ns}:${childNs}` : childNs;
            return createLogger(merged);
        },
    };
}
exports.logger = createLogger();
/**
 * initLogger: optionally patch console methods so future logs follow DEBUG_RESOURCES
 * - Always redirects console.info/debug to gated versions
 * - If DEBUG_PATCH_LOG === 'true', also redirects console.log to gated version
 */
function initLogger() {
    const gatedInfo = (...args) => {
        if (isInfoEnabled())
            console.__orig_info ? console.__orig_info(...args) : console.log(...args);
    };
    const gatedDebug = (...args) => {
        if (isInfoEnabled())
            console.__orig_debug ? console.__orig_debug(...args) : console.log(...args);
    };
    console.__orig_info = console.__orig_info || console.info.bind(console);
    console.__orig_debug = console.__orig_debug || console.debug.bind(console);
    console.__orig_log = console.__orig_log || console.log.bind(console);
    // Patch info/debug unconditionally to respect DEBUG_RESOURCES
    console.info = gatedInfo;
    console.debug = gatedDebug;
    // Optional: also gate console.log if explicitly requested (safer opt-in)
    if (process.env[shared_1.ENV_VARS.DEBUG_PATCH_LOG] === 'true') {
        const gatedLog = (...args) => {
            if (isInfoEnabled())
                console.__orig_log(...args);
        };
        console.log = gatedLog;
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcdXRpbHNcXGxvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7QUFnRUEsZ0NBd0JDO0FBeEZELHlDQUF3QztBQW1CeEMsU0FBUyxhQUFhO0lBQ3BCLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBUSxDQUFDLGVBQWUsQ0FBQyxLQUFLLE1BQU0sQ0FBQTtBQUN6RCxDQUFDO0FBRUQsU0FBUyxLQUFLLENBQUMsRUFBVztJQUN4QixPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO0FBQzVCLENBQUM7QUFVRCxTQUFTLFlBQVksQ0FBQyxFQUFXO0lBQy9CLE1BQU0sSUFBSSxHQUFjLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRTtRQUNsQyxJQUFJLGFBQWEsRUFBRTtZQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUE7SUFDdkQsQ0FBQyxDQUFBO0lBQ0QsTUFBTSxLQUFLLEdBQWMsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFO1FBQ25DLElBQUksYUFBYSxFQUFFO1lBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQTtJQUN4RCxDQUFDLENBQUE7SUFDRCxNQUFNLElBQUksR0FBYyxDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO0lBQ3JFLE1BQU0sS0FBSyxHQUFjLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUE7SUFFdkUsT0FBTztRQUNMLElBQUk7UUFDSixLQUFLO1FBQ0wsSUFBSTtRQUNKLEtBQUs7UUFDTCxhQUFhLENBQUMsT0FBZTtZQUMzQixNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxJQUFJLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUE7WUFDaEQsT0FBTyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDN0IsQ0FBQztLQUNGLENBQUE7QUFDSCxDQUFDO0FBRVksUUFBQSxNQUFNLEdBQUcsWUFBWSxFQUFFLENBQUE7QUFFcEM7Ozs7R0FJRztBQUNILFNBQWdCLFVBQVU7SUFDeEIsTUFBTSxTQUFTLEdBQWMsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFO1FBQ3ZDLElBQUksYUFBYSxFQUFFO1lBQUcsT0FBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUUsT0FBZSxDQUFDLFdBQVcsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7SUFDbEgsQ0FBQyxDQUFBO0lBQ0QsTUFBTSxVQUFVLEdBQWMsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFO1FBQ3hDLElBQUksYUFBYSxFQUFFO1lBQUcsT0FBZSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUUsT0FBZSxDQUFDLFlBQVksQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7SUFDcEgsQ0FBQyxDQUdBO0lBQUMsT0FBZSxDQUFDLFdBQVcsR0FBSSxPQUFlLENBQUMsV0FBVyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUN6RjtJQUFDLE9BQWUsQ0FBQyxZQUFZLEdBQUksT0FBZSxDQUFDLFlBQVksSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FDNUY7SUFBQyxPQUFlLENBQUMsVUFBVSxHQUFJLE9BQWUsQ0FBQyxVQUFVLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7SUFFdkYsOERBQThEO0lBQzlELE9BQU8sQ0FBQyxJQUFJLEdBQUcsU0FBZ0IsQ0FBQTtJQUMvQixPQUFPLENBQUMsS0FBSyxHQUFHLFVBQWlCLENBQUE7SUFFakMseUVBQXlFO0lBQ3pFLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBUSxDQUFDLGVBQWUsQ0FBQyxLQUFLLE1BQU0sRUFBRSxDQUFDO1FBQ3JELE1BQU0sUUFBUSxHQUFjLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRTtZQUN0QyxJQUFJLGFBQWEsRUFBRTtnQkFBRyxPQUFlLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDM0QsQ0FBQyxDQUFBO1FBQ0QsT0FBTyxDQUFDLEdBQUcsR0FBRyxRQUFlLENBQUE7SUFDL0IsQ0FBQztBQUNILENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcdXRpbHNcXGxvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFTlZfVkFSUyB9IGZyb20gJ0BnYW1lL3NoYXJlZCc7XG5cbi8vIExpZ2h0d2VpZ2h0IGxvZ2dlciB0aGF0IHJlc3BlY3RzIERFQlVHX1JFU09VUkNFU1xyXG4vLyBVc2FnZTpcclxuLy8gICBpbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuL3V0aWxzL2xvZ2dlcidcclxuLy8gICBsb2dnZXIuaW5mbygnbWVzc2FnZScsIGN0eClcclxuLy8gICBsb2dnZXIud2Fybignd2FybicpXHJcbi8vICAgbG9nZ2VyLmVycm9yKCdlcnJvcicpXHJcbi8vIE5hbWVzcGFjaW5nOlxyXG4vLyAgIGNvbnN0IGxvZyA9IGxvZ2dlci53aXRoTmFtZXNwYWNlKCdIeWJyaWRMb29wJylcclxuLy8gICBsb2cuaW5mbygnc3RhcnRlZCcpXHJcbi8vIENvbnNvbGUgcGF0Y2ggKG9wdGlvbmFsKTpcclxuLy8gICBpbXBvcnQgeyBpbml0TG9nZ2VyIH0gZnJvbSAnLi91dGlscy9sb2dnZXInXHJcbi8vICAgaW5pdExvZ2dlcigpIC8vIHJlZGlyZWN0cyBjb25zb2xlLmluZm8vZGVidWcgYXV0b21hdGljYWxseTsgb3B0aW9uYWxseSBjb25zb2xlLmxvZyB3aGVuIERFQlVHX1BBVENIX0xPRz10cnVlXHJcblxyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXHJcblxyXG5leHBvcnQgdHlwZSBMb2dNZXRob2QgPSAoLi4uYXJnczogYW55W10pID0+IHZvaWRcclxuXHJcbmZ1bmN0aW9uIGlzSW5mb0VuYWJsZWQoKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIHByb2Nlc3MuZW52W0VOVl9WQVJTLkRFQlVHX1JFU09VUkNFU10gPT09ICd0cnVlJ1xyXG59XHJcblxyXG5mdW5jdGlvbiBmbXROcyhucz86IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgcmV0dXJuIG5zID8gYFske25zfV1gIDogJydcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJTG9nZ2VyIHtcclxuICBpbmZvOiBMb2dNZXRob2RcclxuICBkZWJ1ZzogTG9nTWV0aG9kXHJcbiAgd2FybjogTG9nTWV0aG9kXHJcbiAgZXJyb3I6IExvZ01ldGhvZFxyXG4gIHdpdGhOYW1lc3BhY2UobnM6IHN0cmluZyk6IElMb2dnZXJcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlTG9nZ2VyKG5zPzogc3RyaW5nKTogSUxvZ2dlciB7XHJcbiAgY29uc3QgaW5mbzogTG9nTWV0aG9kID0gKC4uLmFyZ3MpID0+IHtcclxuICAgIGlmIChpc0luZm9FbmFibGVkKCkpIGNvbnNvbGUuaW5mbyhmbXROcyhucyksIC4uLmFyZ3MpXHJcbiAgfVxyXG4gIGNvbnN0IGRlYnVnOiBMb2dNZXRob2QgPSAoLi4uYXJncykgPT4ge1xyXG4gICAgaWYgKGlzSW5mb0VuYWJsZWQoKSkgY29uc29sZS5kZWJ1ZyhmbXROcyhucyksIC4uLmFyZ3MpXHJcbiAgfVxyXG4gIGNvbnN0IHdhcm46IExvZ01ldGhvZCA9ICguLi5hcmdzKSA9PiBjb25zb2xlLndhcm4oZm10TnMobnMpLCAuLi5hcmdzKVxyXG4gIGNvbnN0IGVycm9yOiBMb2dNZXRob2QgPSAoLi4uYXJncykgPT4gY29uc29sZS5lcnJvcihmbXROcyhucyksIC4uLmFyZ3MpXHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBpbmZvLFxyXG4gICAgZGVidWcsXHJcbiAgICB3YXJuLFxyXG4gICAgZXJyb3IsXHJcbiAgICB3aXRoTmFtZXNwYWNlKGNoaWxkTnM6IHN0cmluZykge1xyXG4gICAgICBjb25zdCBtZXJnZWQgPSBucyA/IGAke25zfToke2NoaWxkTnN9YCA6IGNoaWxkTnNcclxuICAgICAgcmV0dXJuIGNyZWF0ZUxvZ2dlcihtZXJnZWQpXHJcbiAgICB9LFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcigpXHJcblxyXG4vKipcclxuICogaW5pdExvZ2dlcjogb3B0aW9uYWxseSBwYXRjaCBjb25zb2xlIG1ldGhvZHMgc28gZnV0dXJlIGxvZ3MgZm9sbG93IERFQlVHX1JFU09VUkNFU1xyXG4gKiAtIEFsd2F5cyByZWRpcmVjdHMgY29uc29sZS5pbmZvL2RlYnVnIHRvIGdhdGVkIHZlcnNpb25zXHJcbiAqIC0gSWYgREVCVUdfUEFUQ0hfTE9HID09PSAndHJ1ZScsIGFsc28gcmVkaXJlY3RzIGNvbnNvbGUubG9nIHRvIGdhdGVkIHZlcnNpb25cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0TG9nZ2VyKCkge1xyXG4gIGNvbnN0IGdhdGVkSW5mbzogTG9nTWV0aG9kID0gKC4uLmFyZ3MpID0+IHtcclxuICAgIGlmIChpc0luZm9FbmFibGVkKCkpIChjb25zb2xlIGFzIGFueSkuX19vcmlnX2luZm8gPyAoY29uc29sZSBhcyBhbnkpLl9fb3JpZ19pbmZvKC4uLmFyZ3MpIDogY29uc29sZS5sb2coLi4uYXJncylcclxuICB9XHJcbiAgY29uc3QgZ2F0ZWREZWJ1ZzogTG9nTWV0aG9kID0gKC4uLmFyZ3MpID0+IHtcclxuICAgIGlmIChpc0luZm9FbmFibGVkKCkpIChjb25zb2xlIGFzIGFueSkuX19vcmlnX2RlYnVnID8gKGNvbnNvbGUgYXMgYW55KS5fX29yaWdfZGVidWcoLi4uYXJncykgOiBjb25zb2xlLmxvZyguLi5hcmdzKVxyXG4gIH1cclxuXHJcbiAgLy8gUHJlc2VydmUgb3JpZ2luYWwgbWV0aG9kcyB0byBhdm9pZCByZWN1cnNpb25cclxuICA7KGNvbnNvbGUgYXMgYW55KS5fX29yaWdfaW5mbyA9IChjb25zb2xlIGFzIGFueSkuX19vcmlnX2luZm8gfHwgY29uc29sZS5pbmZvLmJpbmQoY29uc29sZSlcclxuICA7KGNvbnNvbGUgYXMgYW55KS5fX29yaWdfZGVidWcgPSAoY29uc29sZSBhcyBhbnkpLl9fb3JpZ19kZWJ1ZyB8fCBjb25zb2xlLmRlYnVnLmJpbmQoY29uc29sZSlcclxuICA7KGNvbnNvbGUgYXMgYW55KS5fX29yaWdfbG9nID0gKGNvbnNvbGUgYXMgYW55KS5fX29yaWdfbG9nIHx8IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSlcclxuXHJcbiAgLy8gUGF0Y2ggaW5mby9kZWJ1ZyB1bmNvbmRpdGlvbmFsbHkgdG8gcmVzcGVjdCBERUJVR19SRVNPVVJDRVNcclxuICBjb25zb2xlLmluZm8gPSBnYXRlZEluZm8gYXMgYW55XHJcbiAgY29uc29sZS5kZWJ1ZyA9IGdhdGVkRGVidWcgYXMgYW55XHJcblxyXG4gIC8vIE9wdGlvbmFsOiBhbHNvIGdhdGUgY29uc29sZS5sb2cgaWYgZXhwbGljaXRseSByZXF1ZXN0ZWQgKHNhZmVyIG9wdC1pbilcclxuICBpZiAocHJvY2Vzcy5lbnZbRU5WX1ZBUlMuREVCVUdfUEFUQ0hfTE9HXSA9PT0gJ3RydWUnKSB7XHJcbiAgICBjb25zdCBnYXRlZExvZzogTG9nTWV0aG9kID0gKC4uLmFyZ3MpID0+IHtcclxuICAgICAgaWYgKGlzSW5mb0VuYWJsZWQoKSkgKGNvbnNvbGUgYXMgYW55KS5fX29yaWdfbG9nKC4uLmFyZ3MpXHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyA9IGdhdGVkTG9nIGFzIGFueVxyXG4gIH1cclxufVxyXG4iXSwidmVyc2lvbiI6M30=
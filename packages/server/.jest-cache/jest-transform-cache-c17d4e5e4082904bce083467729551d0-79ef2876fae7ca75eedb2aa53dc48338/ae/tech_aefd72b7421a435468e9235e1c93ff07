48fd8425fdef73bd83aca401bced7f64
"use strict";
// Technology catalog and helpers for Phase A (level 1 unlocks with credits and lab gating)
Object.defineProperty(exports, "__esModule", { value: true });
exports.technologyCatalog = void 0;
exports.getTechnologyList = getTechnologyList;
exports.getTechSpec = getTechSpec;
exports.evaluatePrereqs = evaluatePrereqs;
exports.canStartTech = canStartTech;
exports.getTechCreditCostForLevel = getTechCreditCostForLevel;
exports.canStartTechLevel = canStartTechLevel;
const database_fields_1 = require("./constants/database-fields");
// Catalog derived from the provided screenshot. Values are for Level 1 unlocks.
exports.technologyCatalog = {
    energy: {
        key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY,
        name: database_fields_1.DB_FIELDS.EMPIRES.ENERGY,
        description: 'Increases all bases energy output by 5%.',
        creditsCost: 2,
        requiredLabs: 1,
        prerequisites: [],
    },
    computer: {
        key: 'computer',
        name: 'Computer',
        description: 'Allows one campaign fleet per level.',
        creditsCost: 2,
        requiredLabs: 1,
        prerequisites: [],
    },
    armour: {
        key: 'armour',
        name: 'Armour',
        description: 'Increases units and defenses armour by 5%.',
        creditsCost: 4,
        requiredLabs: 2,
        prerequisites: [],
    },
    laser: {
        key: 'laser',
        name: 'Laser',
        description: 'Increases laser weapons power by 5%.',
        creditsCost: 4,
        requiredLabs: 2,
        prerequisites: [{ key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 2 }],
    },
    missiles: {
        key: 'missiles',
        name: 'Missiles',
        description: 'Increases missile weapons power by 5%.',
        creditsCost: 8,
        requiredLabs: 4,
        prerequisites: [{ key: 'computer', level: 4 }],
    },
    stellar_drive: {
        key: 'stellar_drive',
        name: 'Stellar Drive',
        description: 'Increases stellar units speed by 5%.',
        creditsCost: 16,
        requiredLabs: 5,
        prerequisites: [{ key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 6 }],
    },
    plasma: {
        key: 'plasma',
        name: 'Plasma',
        description: 'Increases plasma weapons power by 5%.',
        creditsCost: 32,
        requiredLabs: 6,
        prerequisites: [
            { key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 6 },
            { key: 'laser', level: 4 },
        ],
    },
    warp_drive: {
        key: 'warp_drive',
        name: 'Warp Drive',
        description: 'Increases warp units speed by 5%.',
        creditsCost: 64,
        requiredLabs: 8,
        prerequisites: [
            { key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 8 },
            { key: 'stellar_drive', level: 4 },
        ],
    },
    shielding: {
        key: 'shielding',
        name: 'Shielding',
        description: 'Increases units and defenses shield by 5%.',
        creditsCost: 128,
        requiredLabs: 10,
        prerequisites: [{ key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 10 }],
    },
    ion: {
        key: 'ion',
        name: 'Ion',
        description: 'Increases ion weapons power by 5%.',
        creditsCost: 256,
        requiredLabs: 12,
        prerequisites: [
            { key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 12 },
            { key: 'laser', level: 10 },
        ],
    },
    stealth: {
        key: 'stealth',
        name: 'Stealth',
        description: 'Decreases the time your own fleets can be detected before they arrive.',
        creditsCost: 512,
        requiredLabs: 14,
        prerequisites: [{ key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 14 }],
    },
    photon: {
        key: 'photon',
        name: 'Photon',
        description: 'Increases photon weapons power by 5%.',
        creditsCost: 1024,
        requiredLabs: 16,
        prerequisites: [
            { key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 16 },
            { key: 'plasma', level: 8 },
        ],
    },
    artificial_intelligence: {
        key: 'artificial_intelligence',
        name: 'Artificial Intelligence',
        description: 'Increases all bases research output by 5%.',
        creditsCost: 2048,
        requiredLabs: 18,
        prerequisites: [{ key: 'computer', level: 20 }],
    },
    disruptor: {
        key: 'disruptor',
        name: 'Disruptor',
        description: 'Increases disruptor weapons power by 5%.',
        creditsCost: 4096,
        requiredLabs: 20,
        prerequisites: [
            { key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 20 },
            { key: 'laser', level: 18 },
        ],
    },
    cybernetics: {
        key: 'cybernetics',
        name: 'Cybernetics',
        description: 'Increases all bases construction and production by 5%.',
        creditsCost: 8192,
        requiredLabs: 22,
        prerequisites: [{ key: 'artificial_intelligence', level: 6 }],
    },
    tachyon_communications: {
        key: 'tachyon_communications',
        name: 'Tachyon Communications',
        description: 'Allows 1 research link between 2 bases (min labs 20).',
        creditsCost: 32768,
        requiredLabs: 24,
        prerequisites: [
            { key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 24 },
            { key: 'computer', level: 24 },
        ],
    },
    anti_gravity: {
        key: 'anti_gravity',
        name: 'Anti-Gravity',
        description: 'Decreases orbital structures construction time by 5% and increases Death Star speed by 5%.',
        creditsCost: 100000,
        requiredLabs: 26,
        prerequisites: [
            { key: database_fields_1.DB_FIELDS.EMPIRES.ENERGY, level: 26 },
            { key: 'computer', level: 26 },
        ],
    },
};
// Helpers
function getTechnologyList() {
    return Object.values(exports.technologyCatalog);
}
function getTechSpec(key) {
    return exports.technologyCatalog[key];
}
function evaluatePrereqs(techLevels, prerequisites) {
    const unmet = [];
    for (const req of prerequisites) {
        const current = Math.max(0, techLevels[req.key] ?? 0);
        if (current < req.level) {
            unmet.push({ key: req.key, requiredLevel: req.level, currentLevel: current });
        }
    }
    return { ok: unmet.length === 0, unmet };
}
function canStartTech(params, spec) {
    const reasons = [];
    // Already unlocked (Phase A: only level 1)
    const currentLevel = Math.max(0, params.techLevels[spec.key] ?? 0);
    if (currentLevel >= 1) {
        reasons.push('Already unlocked.');
    }
    // Labs
    if (params.baseLabTotal < spec.requiredLabs) {
        reasons.push(`Requires ${spec.requiredLabs} lab levels at this base (have ${params.baseLabTotal}).`);
    }
    // Credits
    if (params.credits < spec.creditsCost) {
        reasons.push(`Requires ${spec.creditsCost.toLocaleString()} credits (have ${params.credits.toLocaleString()}).`);
    }
    // Prerequisites
    const { ok, unmet } = evaluatePrereqs(params.techLevels, spec.prerequisites);
    if (!ok) {
        for (const u of unmet) {
            const prereqSpec = getTechSpec(u.key);
            reasons.push(`Requires ${prereqSpec.name} ${u.requiredLevel} (current ${u.currentLevel}).`);
        }
    }
    return { canStart: reasons.length === 0, reasons };
}
/**
 * Compute the credit cost for a specific technology level.
 * - Level 1 uses the catalog's creditsCost
 * - Higher levels use a geometric progression with ratio ~1.5, rounded each step
 *   This matches the general pattern used across level tables (2,3,5,7,11,16,23,...).
 */
function getTechCreditCostForLevel(specOrKey, level) {
    const spec = typeof specOrKey === 'string' ? getTechSpec(specOrKey) : specOrKey;
    const base = Math.max(0, Number(spec.creditsCost || 0));
    const targetLevel = Math.max(1, Math.floor(level || 1));
    if (targetLevel <= 1)
        return base;
    // Geometric growth with ratio 1.5, rounding each step
    let cost = base;
    for (let l = 2; l <= targetLevel; l++) {
        cost = Math.round(cost * 1.5);
    }
    return Math.max(1, cost);
}
/**
 * Multi-level gating that considers the TARGET level being researched.
 * - Uses getTechCreditCostForLevel(spec, targetLevel) for credits
 * - Uses spec.requiredLabs for lab requirement (constant for all levels in Phase A)
 * - Uses spec.prerequisites (treated as global requirements independent of target level)
 */
function canStartTechLevel(params, spec, targetLevel) {
    const reasons = [];
    const currentLevel = Math.max(0, params.techLevels[spec.key] ?? 0);
    const desired = Math.max(1, Math.floor(targetLevel || 1));
    // Already at or above desired level
    if (currentLevel >= desired) {
        reasons.push(`Already unlocked (current ${currentLevel}).`);
    }
    // Labs (Phase A: spec.requiredLabs applies to all levels)
    if (params.baseLabTotal < spec.requiredLabs) {
        reasons.push(`Requires ${spec.requiredLabs} lab levels at this base (have ${params.baseLabTotal}).`);
    }
    // Credits for the desired level
    const cost = getTechCreditCostForLevel(spec, desired);
    if (params.credits < cost) {
        reasons.push(`Requires ${cost.toLocaleString()} credits (have ${params.credits.toLocaleString()}).`);
    }
    // Prerequisites (treated as global requirements)
    const { ok, unmet } = evaluatePrereqs(params.techLevels, spec.prerequisites);
    if (!ok) {
        for (const u of unmet) {
            const prereqSpec = getTechSpec(u.key);
            reasons.push(`Requires ${prereqSpec.name} ${u.requiredLevel} (current ${u.currentLevel}).`);
        }
    }
    return { canStart: reasons.length === 0, reasons };
}
//# sourceMappingURL=tech.js.map
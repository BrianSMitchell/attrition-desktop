1e3acce99d5a3262d627f7964683145a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../config/supabase', () => ({
    supabase: {
        auth: {
            signInWithPassword: jest.fn().mockResolvedValue({
                data: {
                    session: {
                        access_token: 'test-token',
                        user: { id: 'test-user-id' }
                    }
                },
                error: null
            })
        },
        from: jest.fn().mockImplementation((table) => ({
            select: jest.fn().mockReturnThis(),
            insert: jest.fn().mockReturnThis(),
            update: jest.fn().mockReturnThis(),
            upsert: jest.fn().mockReturnThis(),
            delete: jest.fn().mockReturnThis(),
            eq: jest.fn().mockReturnThis(),
            in: jest.fn().mockReturnThis(),
            single: jest.fn().mockReturnThis(),
            maybeSingle: jest.fn().mockReturnThis(),
            data: table === 'empires' ? { id: 'test-empire-id' } : {},
            error: null
        }))
    }
}));
const database_fields_1 = require("../constants/database-fields");
const response_formats_1 = require("../constants/response-formats");
const shared_1 = require("@game/shared");
// Mock Supabase
const database_fields_2 = require("../../../constants/database-fields");
describe('Game Routes', () => {
    let authToken;
    let userId;
    let empireId;
    let testBase;
    beforeAll(async () => {
        // Set up test auth token
        const { data: { session }, error } = await supabase.auth.signInWithPassword({
            email: process.env[shared_1.ENV_VARS.TEST_USER_EMAIL] || 'test@example.com',
            password: process.env[shared_1.ENV_VARS.TEST_USER_PASSWORD] || 'test123!',
        });
        if (error || !session) {
            throw new Error('Failed to authenticate test user');
        }
        authToken = session.access_token;
        userId = session.user.id;
        // Get or create test empire
        const { data: empire } = await supabase
            .from(database_fields_1.DB_TABLES.EMPIRES)
            .select(database_fields_2.DB_FIELDS.BUILDINGS.ID)
            .eq(database_fields_2.DB_FIELDS.EMPIRES.USER_ID, userId)
            .single();
        if (empire) {
            empireId = empire.id;
        }
        else {
            const { data: newEmpire } = await supabase
                .from(database_fields_1.DB_TABLES.EMPIRES)
                .insert({ user_id: userId, name: 'Test Empire' })
                .select()
                .single();
            if (!newEmpire)
                throw new Error('Failed to create test empire');
            empireId = newEmpire.id;
        }
        // Create test base
        testBase = 'A00:10:20:30';
        await supabase
            .from(database_fields_1.DB_TABLES.LOCATIONS)
            .upsert({
            coord: testBase,
            owner: userId,
            owner_id: userId,
            result: { solarEnergy: 100, yields: { gas: 50 } }
        });
        // Add base to empire territories
        await supabase
            .from(database_fields_1.DB_TABLES.EMPIRES)
            .update({ territories: [testBase] })
            .eq(database_fields_2.DB_FIELDS.BUILDINGS.ID, empireId);
    });
    afterAll(async () => {
        // Clean up test base
        await supabase
            .from(database_fields_1.DB_TABLES.LOCATIONS)
            .delete()
            .eq('coord', testBase);
    });
    describe('GET /tech/catalog', () => {
        it('returns technology list', async () => {
            const response = await request(app)
                .get('/api/game/tech/catalog')
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.OK);
            expect(response.body.success).toBe(true);
            expect(Array.isArray(response.body.data.catalog)).toBe(true);
        });
    });
    describe('GET /structures/catalog', () => {
        it('returns buildings list', async () => {
            const response = await request(app)
                .get('/api/game/structures/catalog')
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.OK);
            expect(response.body.success).toBe(true);
            expect(Array.isArray(response.body.data.catalog)).toBe(true);
        });
    });
    describe('GET /defenses/catalog', () => {
        it('returns defenses list', async () => {
            const response = await request(app)
                .get('/api/game/defenses/catalog')
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.OK);
            expect(response.body.success).toBe(true);
            expect(Array.isArray(response.body.data.catalog)).toBe(true);
        });
    });
    describe('GET /units/catalog', () => {
        it('returns units list', async () => {
            const response = await request(app)
                .get('/api/game/units/catalog')
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.OK);
            expect(response.body.success).toBe(true);
            expect(Array.isArray(response.body.data.catalog)).toBe(true);
        });
    });
    describe('GET /bases/summary', () => {
        it('returns base summaries', async () => {
            const response = await request(app)
                .get('/api/game/bases/summary')
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.OK);
            expect(response.body.success).toBe(true);
            expect(Array.isArray(response.body.data.bases)).toBe(true);
            // Should find our test base
            const testBaseInfo = response.body.data.bases.find((b) => b.location === testBase);
            expect(testBaseInfo).toBeDefined();
            expect(testBaseInfo.baseId).toBe(testBase);
        });
    });
    describe('GET /structures/queue', () => {
        it('returns queue for base', async () => {
            const response = await request(app)
                .get(`/api/game/structures/queue?base=${testBase}`)
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.OK);
            expect(response.body.success).toBe(true);
            expect(Array.isArray(response.body.data.queue)).toBe(true);
        });
        it('requires authentication', async () => {
            const response = await request(app)
                .get(`/api/game/structures/queue?base=${testBase}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.UNAUTHORIZED);
        });
    });
    describe('GET /tech/status', () => {
        it('returns tech status for base', async () => {
            const response = await request(app)
                .get(`/api/game/tech/status?base=${testBase}`)
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.OK);
            expect(response.body.success).toBe(true);
            expect(response.body.data.status).toBeDefined();
        });
        it('requires base parameter', async () => {
            const response = await request(app)
                .get('/api/game/tech/status')
                .set('Authorization', `Bearer ${authToken}`);
            expect(response.status).toBe(response_formats_1.HTTP_STATUS.BAD_REQUEST);
            expect(response.body.success).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcX190ZXN0c19fXFxnYW1lUm91dGVzLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFNQSxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDckMsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFO1lBQ0osa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO2dCQUM5QyxJQUFJLEVBQUU7b0JBQ0osT0FBTyxFQUFFO3dCQUNQLFlBQVksRUFBRSxZQUFZO3dCQUMxQixJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsY0FBYyxFQUFFO3FCQUM3QjtpQkFDRjtnQkFDRCxLQUFLLEVBQUUsSUFBSTthQUNaLENBQUM7U0FDSDtRQUNELElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDN0MsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDOUIsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDOUIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7WUFDbEMsV0FBVyxFQUFFLElBQUks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QyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyw4QkFBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcX190ZXN0c19fXFxnYW1lUm91dGVzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREJfVEFCTEVTIH0gZnJvbSAnLi4vY29uc3RhbnRzL2RhdGFiYXNlLWZpZWxkcyc7XG5pbXBvcnQgeyBIVFRQX1NUQVRVUyB9IGZyb20gJy4uL2NvbnN0YW50cy9yZXNwb25zZS1mb3JtYXRzJztcbmltcG9ydCB7IEVOVl9WQVJTIH0gZnJvbSAnQGdhbWUvc2hhcmVkJztcblxuLy8gTW9jayBTdXBhYmFzZVxuaW1wb3J0IHsgREJfRklFTERTIH0gZnJvbSAnLi4vLi4vLi4vY29uc3RhbnRzL2RhdGFiYXNlLWZpZWxkcyc7XG5qZXN0Lm1vY2soJy4uL2NvbmZpZy9zdXBhYmFzZScsICgpID0+ICh7XG4gIHN1cGFiYXNlOiB7XG4gICAgYXV0aDoge1xuICAgICAgc2lnbkluV2l0aFBhc3N3b3JkOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc2Vzc2lvbjoge1xuICAgICAgICAgICAgYWNjZXNzX3Rva2VuOiAndGVzdC10b2tlbicsXG4gICAgICAgICAgICB1c2VyOiB7IGlkOiAndGVzdC11c2VyLWlkJyB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogbnVsbFxuICAgICAgfSlcbiAgICB9LFxuICAgIGZyb206IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHRhYmxlKSA9PiAoe1xuICAgICAgc2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGluc2VydDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgdXBzZXJ0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGRlbGV0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBlcTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBpbjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgbWF5YmVTaW5nbGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgZGF0YTogdGFibGUgPT09ICdlbXBpcmVzJyA/IHsgaWQ6ICd0ZXN0LWVtcGlyZS1pZCcgfSA6IHt9LFxuICAgICAgZXJyb3I6IG51bGxcbiAgICB9KSlcbiAgfVxufSkpO1xuXG5kZXNjcmliZSgnR2FtZSBSb3V0ZXMnLCAoKSA9PiB7XG4gIGxldCBhdXRoVG9rZW46IHN0cmluZztcbiAgbGV0IHVzZXJJZDogc3RyaW5nO1xuICBsZXQgZW1waXJlSWQ6IHN0cmluZztcbiAgbGV0IHRlc3RCYXNlOiBzdHJpbmc7XG5cbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBTZXQgdXAgdGVzdCBhdXRoIHRva2VuXG4gICAgY29uc3QgeyBkYXRhOiB7IHNlc3Npb24gfSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcbiAgICAgIGVtYWlsOiBwcm9jZXNzLmVudltFTlZfVkFSUy5URVNUX1VTRVJfRU1BSUxdIHx8ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudltFTlZfVkFSUy5URVNUX1VTRVJfUEFTU1dPUkRdIHx8ICd0ZXN0MTIzIScsXG4gICAgfSk7XG5cbiAgICBpZiAoZXJyb3IgfHwgIXNlc3Npb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB0ZXN0IHVzZXInKTtcbiAgICB9XG5cbiAgICBhdXRoVG9rZW4gPSBzZXNzaW9uLmFjY2Vzc190b2tlbjtcbiAgICB1c2VySWQgPSBzZXNzaW9uLnVzZXIuaWQ7XG5cbiAgICAvLyBHZXQgb3IgY3JlYXRlIHRlc3QgZW1waXJlXG4gICAgY29uc3QgeyBkYXRhOiBlbXBpcmUgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbShEQl9UQUJMRVMuRU1QSVJFUylcbiAgICAgIC5zZWxlY3QoREJfRklFTERTLkJVSUxESU5HUy5JRClcbiAgICAgIC5lcShEQl9GSUVMRFMuRU1QSVJFUy5VU0VSX0lELCB1c2VySWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoZW1waXJlKSB7XG4gICAgICBlbXBpcmVJZCA9IGVtcGlyZS5pZDtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgeyBkYXRhOiBuZXdFbXBpcmUgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKERCX1RBQkxFUy5FTVBJUkVTKVxuICAgICAgICAuaW5zZXJ0KHsgdXNlcl9pZDogdXNlcklkLCBuYW1lOiAnVGVzdCBFbXBpcmUnIH0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmICghbmV3RW1waXJlKSB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgdGVzdCBlbXBpcmUnKTtcbiAgICAgIGVtcGlyZUlkID0gbmV3RW1waXJlLmlkO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0ZXN0IGJhc2VcbiAgICB0ZXN0QmFzZSA9ICdBMDA6MTA6MjA6MzAnO1xuICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbShEQl9UQUJMRVMuTE9DQVRJT05TKVxuICAgICAgLnVwc2VydCh7XG4gICAgICAgIGNvb3JkOiB0ZXN0QmFzZSxcbiAgICAgICAgb3duZXI6IHVzZXJJZCxcbiAgICAgICAgb3duZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgcmVzdWx0OiB7IHNvbGFyRW5lcmd5OiAxMDAsIHlpZWxkczogeyBnYXM6IDUwIH0gfVxuICAgICAgfSk7XG5cbiAgICAvLyBBZGQgYmFzZSB0byBlbXBpcmUgdGVycml0b3JpZXNcbiAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oREJfVEFCTEVTLkVNUElSRVMpXG4gICAgICAudXBkYXRlKHsgdGVycml0b3JpZXM6IFt0ZXN0QmFzZV0gfSlcbiAgICAgIC5lcShEQl9GSUVMRFMuQlVJTERJTkdTLklELCBlbXBpcmVJZCk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCB0ZXN0IGJhc2VcbiAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oREJfVEFCTEVTLkxPQ0FUSU9OUylcbiAgICAgIC5kZWxldGUoKVxuICAgICAgLmVxKCdjb29yZCcsIHRlc3RCYXNlKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvdGVjaC9jYXRhbG9nJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIHRlY2hub2xvZ3kgbGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvZ2FtZS90ZWNoL2NhdGFsb2cnKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZShIVFRQX1NUQVRVUy5PSyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5kYXRhLmNhdGFsb2cpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9zdHJ1Y3R1cmVzL2NhdGFsb2cnLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgYnVpbGRpbmdzIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2dhbWUvc3RydWN0dXJlcy9jYXRhbG9nJylcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoSFRUUF9TVEFUVVMuT0spO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmJvZHkuZGF0YS5jYXRhbG9nKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvZGVmZW5zZXMvY2F0YWxvZycsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyBkZWZlbnNlcyBsaXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9nYW1lL2RlZmVuc2VzL2NhdGFsb2cnKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZShIVFRQX1NUQVRVUy5PSyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5kYXRhLmNhdGFsb2cpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC91bml0cy9jYXRhbG9nJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIHVuaXRzIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2dhbWUvdW5pdHMvY2F0YWxvZycpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YXV0aFRva2VufWApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKEhUVFBfU1RBVFVTLk9LKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXNwb25zZS5ib2R5LmRhdGEuY2F0YWxvZykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG5kZXNjcmliZSgnR0VUIC9iYXNlcy9zdW1tYXJ5JywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIGJhc2Ugc3VtbWFyaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9nYW1lL2Jhc2VzL3N1bW1hcnknKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZShIVFRQX1NUQVRVUy5PSyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5kYXRhLmJhc2VzKSkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgaW50ZXJmYWNlIEJhc2VJbmZvIHtcbiAgICAgICAgYmFzZUlkOiBzdHJpbmc7XG4gICAgICAgIGxvY2F0aW9uOiBzdHJpbmc7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBmaW5kIG91ciB0ZXN0IGJhc2VcbiAgICAgIGNvbnN0IHRlc3RCYXNlSW5mbyA9IHJlc3BvbnNlLmJvZHkuZGF0YS5iYXNlcy5maW5kKChiOiBCYXNlSW5mbykgPT4gYi5sb2NhdGlvbiA9PT0gdGVzdEJhc2UpO1xuICAgICAgZXhwZWN0KHRlc3RCYXNlSW5mbykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZXN0QmFzZUluZm8uYmFzZUlkKS50b0JlKHRlc3RCYXNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvc3RydWN0dXJlcy9xdWV1ZScsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyBxdWV1ZSBmb3IgYmFzZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoYC9hcGkvZ2FtZS9zdHJ1Y3R1cmVzL3F1ZXVlP2Jhc2U9JHt0ZXN0QmFzZX1gKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZShIVFRQX1NUQVRVUy5PSyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5kYXRhLnF1ZXVlKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXF1aXJlcyBhdXRoZW50aWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoYC9hcGkvZ2FtZS9zdHJ1Y3R1cmVzL3F1ZXVlP2Jhc2U9JHt0ZXN0QmFzZX1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZShIVFRQX1NUQVRVUy5VTkFVVEhPUklaRUQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC90ZWNoL3N0YXR1cycsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB0ZWNoIHN0YXR1cyBmb3IgYmFzZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoYC9hcGkvZ2FtZS90ZWNoL3N0YXR1cz9iYXNlPSR7dGVzdEJhc2V9YClcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoSFRUUF9TVEFUVVMuT0spO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEuc3RhdHVzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JlcXVpcmVzIGJhc2UgcGFyYW1ldGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9nYW1lL3RlY2gvc3RhdHVzJylcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoSFRUUF9TVEFUVVMuQkFEX1JFUVVFU1QpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbiJdLCJ2ZXJzaW9uIjozfQ==
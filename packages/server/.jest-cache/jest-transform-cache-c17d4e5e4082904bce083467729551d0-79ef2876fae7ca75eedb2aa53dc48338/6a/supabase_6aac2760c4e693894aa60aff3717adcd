5228f9abc28a55ba95fa4eaaaac6cbc7
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.supabase = void 0;
exports.handleSupabaseError = handleSupabaseError;
const supabase_js_1 = require("@supabase/supabase-js");
const dotenv_1 = __importDefault(require("dotenv"));
const shared_1 = require("@game/shared");
// Load environment variables
dotenv_1.default.config();
const supabaseUrl = process.env[shared_1.ENV_VARS.SUPABASE_URL];
const supabaseServiceKey = process.env[shared_1.ENV_VARS.SUPABASE_SERVICE_ROLE_KEY];
if (!supabaseUrl || !supabaseServiceKey) {
    throw new Error('Missing Supabase environment variables. Please check your .env file.');
}
// Create a single Supabase client for the server with service role key
// This bypasses Row Level Security and should only be used server-side
exports.supabase = (0, supabase_js_1.createClient)(supabaseUrl, supabaseServiceKey, {
    auth: {
        autoRefreshToken: false,
        persistSession: false,
    },
});
// Helper function to handle Supabase errors
function handleSupabaseError(error, operation) {
    console.error(`Supabase error during ${operation}:`, error);
    throw new Error(`Database operation failed: ${operation}`);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcY29uZmlnXFxzdXBhYmFzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUF3QkEsa0RBR0M7QUEzQkQsdURBQXFEO0FBQ3JELG9EQUE0QjtBQUM1Qix5Q0FBd0M7QUFFeEMsNkJBQTZCO0FBQzdCLGdCQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7QUFFaEIsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3ZELE1BQU0sa0JBQWtCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBUSxDQUFDLHlCQUF5QixDQUFDLENBQUM7QUFFM0UsSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDeEMsTUFBTSxJQUFJLEtBQUssQ0FBQyxzRUFBc0UsQ0FBQyxDQUFDO0FBQzFGLENBQUM7QUFFRCx1RUFBdUU7QUFDdkUsdUVBQXVFO0FBQzFELFFBQUEsUUFBUSxHQUFHLElBQUEsMEJBQVksRUFBQyxXQUFXLEVBQUUsa0JBQWtCLEVBQUU7SUFDcEUsSUFBSSxFQUFFO1FBQ0osZ0JBQWdCLEVBQUUsS0FBSztRQUN2QixjQUFjLEVBQUUsS0FBSztLQUN0QjtDQUNGLENBQUMsQ0FBQztBQUVILDRDQUE0QztBQUM1QyxTQUFnQixtQkFBbUIsQ0FBQyxLQUFVLEVBQUUsU0FBaUI7SUFDL0QsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsU0FBUyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDNUQsTUFBTSxJQUFJLEtBQUssQ0FBQyw4QkFBOEIsU0FBUyxFQUFFLENBQUMsQ0FBQztBQUM3RCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxQcm9qZWN0c1xcQXR0cml0aW9uXFxwYWNrYWdlc1xcc2VydmVyXFxzcmNcXGNvbmZpZ1xcc3VwYWJhc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcclxuaW1wb3J0IGRvdGVudiBmcm9tICdkb3RlbnYnO1xyXG5pbXBvcnQgeyBFTlZfVkFSUyB9IGZyb20gJ0BnYW1lL3NoYXJlZCc7XHJcblxyXG4vLyBMb2FkIGVudmlyb25tZW50IHZhcmlhYmxlc1xyXG5kb3RlbnYuY29uZmlnKCk7XHJcblxyXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52W0VOVl9WQVJTLlNVUEFCQVNFX1VSTF07XHJcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52W0VOVl9WQVJTLlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVldO1xyXG5cclxuaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VTZXJ2aWNlS2V5KSB7XHJcbiAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFN1cGFiYXNlIGVudmlyb25tZW50IHZhcmlhYmxlcy4gUGxlYXNlIGNoZWNrIHlvdXIgLmVudiBmaWxlLicpO1xyXG59XHJcblxyXG4vLyBDcmVhdGUgYSBzaW5nbGUgU3VwYWJhc2UgY2xpZW50IGZvciB0aGUgc2VydmVyIHdpdGggc2VydmljZSByb2xlIGtleVxyXG4vLyBUaGlzIGJ5cGFzc2VzIFJvdyBMZXZlbCBTZWN1cml0eSBhbmQgc2hvdWxkIG9ubHkgYmUgdXNlZCBzZXJ2ZXItc2lkZVxyXG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZUtleSwge1xyXG4gIGF1dGg6IHtcclxuICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlLFxyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGhhbmRsZSBTdXBhYmFzZSBlcnJvcnNcclxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVN1cGFiYXNlRXJyb3IoZXJyb3I6IGFueSwgb3BlcmF0aW9uOiBzdHJpbmcpOiBuZXZlciB7XHJcbiAgY29uc29sZS5lcnJvcihgU3VwYWJhc2UgZXJyb3IgZHVyaW5nICR7b3BlcmF0aW9ufTpgLCBlcnJvcik7XHJcbiAgdGhyb3cgbmV3IEVycm9yKGBEYXRhYmFzZSBvcGVyYXRpb24gZmFpbGVkOiAke29wZXJhdGlvbn1gKTtcclxufVxyXG5cclxuLy8gVHlwZSBoZWxwZXIgZm9yIGRhdGFiYXNlIG9wZXJhdGlvbnNcclxuZXhwb3J0IHR5cGUgRGJSZXN1bHQ8VD4gPSB7XHJcbiAgZGF0YTogVCB8IG51bGw7XHJcbiAgZXJyb3I6IGFueSB8IG51bGw7XHJcbn07XHJcbiJdLCJ2ZXJzaW9uIjozfQ==
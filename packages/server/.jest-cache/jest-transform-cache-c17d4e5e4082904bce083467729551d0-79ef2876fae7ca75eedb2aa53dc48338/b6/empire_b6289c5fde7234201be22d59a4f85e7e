419b819055a9cd7a9bf130b3b0feac5d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const supabase_1 = require("../../config/supabase");
const response_formats_1 = require("../../constants/response-formats");
// Constants imports for eliminating hardcoded values
const database_fields_1 = require("../../constants/database-fields");
const shared_1 = require("@game/shared");
const errorHandler_1 = require("../../middleware/errorHandler");
const auth_1 = require("../../middleware/auth");
const EmpireResolutionService_1 = require("../../services/empire/EmpireResolutionService");
const router = (0, express_1.Router)();
router.use(auth_1.authenticate);
/**
 * Get empire details
 */
router.get('/', (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const user = req.user;
    // Resolve empire using the service
    const empireRow = await EmpireResolutionService_1.EmpireResolutionService.resolveEmpireByUserObject(user);
    if (!empireRow) {
        return res.status(shared_1.HTTP_STATUS.NOT_FOUND).json({ success: false, error: response_formats_1.ERROR_MESSAGES.EMPIRE_NOT_FOUND });
    }
    return res.json({
        success: true,
        data: {
            empire: {
                id: empireRow.id,
                name: empireRow.name,
                territories: Array.isArray(empireRow.territories) ? empireRow.territories : [],
                resources: {
                    credits: Math.max(0, Number(empireRow.credits || 0)),
                    energy: Math.max(0, Number(empireRow.energy || 0)),
                },
            },
            creditsPerHour: 0, // Placeholder - implement production calculation
            resourcesGained: 0, // Placeholder - implement resource gains
        },
    });
}));
/**
 * Credit transaction history for the empire
 * Supports pagination through limit parameter (?limit=50)
 */
router.get('/credits/history', (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const limitRaw = Number(req.query.limit || 50);
    const limit = Number.isFinite(limitRaw) ? Math.min(Math.max(1, limitRaw), 200) : 50;
    const user = req.user;
    // Resolve empire using the service
    const empireRow = await EmpireResolutionService_1.EmpireResolutionService.resolveEmpireByUserObject(user);
    if (!empireRow) {
        return res.status(shared_1.HTTP_STATUS.NOT_FOUND).json({ success: false, error: response_formats_1.ERROR_MESSAGES.EMPIRE_NOT_FOUND });
    }
    const empireId = String(empireRow.id);
    // Fetch credit transactions from Supabase
    const { data: txns, error } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.CREDIT_TRANSACTIONS)
        .select('id, amount, type, note, balance_after, created_at')
        .eq(database_fields_1.DB_FIELDS.BUILDINGS.EMPIRE_ID, empireId)
        .order(database_fields_1.DB_FIELDS.BUILDINGS.CREATED_AT, { ascending: false })
        .limit(limit);
    if (error) {
        console.error('Error fetching credit history:', error);
        return res.status(shared_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({ success: false, error: 'Failed to fetch credit history' });
    }
    return res.json({
        success: true,
        data: {
            history: (txns || []).map(t => ({
                _id: t.id,
                amount: t.amount,
                type: t.type,
                note: t.note || null,
                balanceAfter: typeof t.balance_after === 'number' ? t.balance_after : null,
                createdAt: t.created_at,
            }))
        }
    });
}));
/**
 * @deprecated Empire creation is automatic during registration
 */
router.post('/', (_req, res) => {
    return res.status(shared_1.HTTP_STATUS.GONE).json({
        success: false,
        error: 'Empire creation is automatic during registration. This endpoint is deprecated.'
    });
});
/**
 * @deprecated Manual resource updates are no longer supported
 */
router.post('/update-resources', (_req, res) => {
    return res.status(shared_1.HTTP_STATUS.GONE).json({
        success: false,
        error: 'Manual resource updates are no longer supported. Resources are updated automatically.'
    });
});
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xccm91dGVzXFxnYW1lXFxlbXBpcmUudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxxQ0FBMkM7QUFDM0Msb0RBQWlEO0FBQ2pELHVFQUFrRTtBQUVsRSxxREFBcUQ7QUFDckQscUVBQXVFO0FBQ3ZFLHlDQUEyQztBQUMzQyxnRUFBNkQ7QUFDN0QsZ0RBQWtFO0FBQ2xFLDJGQUF3RjtBQUV4RixNQUFNLE1BQU0sR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUV4QixNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFZLENBQUMsQ0FBQztBQUV6Qjs7R0FFRztBQUNILE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLElBQUEsMkJBQVksRUFBQyxLQUFLLEVBQUUsR0FBZ0IsRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUNyRSxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBWSxDQUFDO0lBRTlCLG1DQUFtQztJQUNuQyxNQUFNLFNBQVMsR0FBRyxNQUFNLGlEQUF1QixDQUFDLHlCQUF5QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWhGLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNmLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxvQkFBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLGlDQUFjLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0lBQzVHLENBQUM7SUFFRCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDZCxPQUFPLEVBQUUsSUFBSTtRQUNiLElBQUksRUFBRTtZQUNKLE1BQU0sRUFBRTtnQkFDTixFQUFFLEVBQUUsU0FBUyxDQUFDLEVBQUU7Z0JBQ2hCLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSTtnQkFDcEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMs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QUUsQ0FBQyxDQUFDLElBQUk7Z0JBQ1osSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSTtnQkFDcEIsWUFBWSxFQUFFLE9BQU8sQ0FBQyxDQUFDLGFBQWEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLElBQUk7Z0JBQzFFLFNBQVMsRUFBRSxDQUFDLENBQUMsVUFBVTthQUN4QixDQUFDLENBQUM7U0FDSjtLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFSjs7R0FFRztBQUNILE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBaUIsRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUNwRCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsb0JBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDdkMsT0FBTyxFQUFFLEtBQUs7UUFDZCxLQUFLLEVBQUUsZ0ZBQWdGO0tBQ3hGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUg7O0dBRUc7QUFDSCxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUMsSUFBaUIsRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUNwRSxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsb0JBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDdkMsT0FBTyxFQUFFLEtBQUs7UUFDZCxLQUFLLEVBQUUsdUZBQXVGO0tBQy9GLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsa0JBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxQcm9qZWN0c1xcQXR0cml0aW9uXFxwYWNrYWdlc1xcc2VydmVyXFxzcmNcXHJvdXRlc1xcZ2FtZVxcZW1waXJlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vLi4vY29uZmlnL3N1cGFiYXNlJztcbmltcG9ydCB7IEVSUk9SX01FU1NBR0VTIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL3Jlc3BvbnNlLWZvcm1hdHMnO1xuXG4vLyBDb25zdGFudHMgaW1wb3J0cyBmb3IgZWxpbWluYXRpbmcgaGFyZGNvZGVkIHZhbHVlc1xuaW1wb3J0IHsgREJfVEFCTEVTLCBEQl9GSUVMRFMgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvZGF0YWJhc2UtZmllbGRzJztcbmltcG9ydCB7IEhUVFBfU1RBVFVTIH0gZnJvbSAnQGdhbWUvc2hhcmVkJztcbmltcG9ydCB7IGFzeW5jSGFuZGxlciB9IGZyb20gJy4uLy4uL21pZGRsZXdhcmUvZXJyb3JIYW5kbGVyJztcbmltcG9ydCB7IGF1dGhlbnRpY2F0ZSwgQXV0aFJlcXVlc3QgfSBmcm9tICcuLi8uLi9taWRkbGV3YXJlL2F1dGgnO1xuaW1wb3J0IHsgRW1waXJlUmVzb2x1dGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9lbXBpcmUvRW1waXJlUmVzb2x1dGlvblNlcnZpY2UnO1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxucm91dGVyLnVzZShhdXRoZW50aWNhdGUpO1xuXG4vKipcbiAqIEdldCBlbXBpcmUgZGV0YWlsc1xuICovXG5yb3V0ZXIuZ2V0KCcvJywgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gIGNvbnN0IHVzZXIgPSByZXEudXNlciEgYXMgYW55O1xuXG4gIC8vIFJlc29sdmUgZW1waXJlIHVzaW5nIHRoZSBzZXJ2aWNlXG4gIGNvbnN0IGVtcGlyZVJvdyA9IGF3YWl0IEVtcGlyZVJlc29sdXRpb25TZXJ2aWNlLnJlc29sdmVFbXBpcmVCeVVzZXJPYmplY3QodXNlcik7XG5cbiAgaWYgKCFlbXBpcmVSb3cpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IEVSUk9SX01FU1NBR0VTLkVNUElSRV9OT1RfRk9VTkQgfSk7XG4gIH1cblxuICByZXR1cm4gcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgZGF0YToge1xuICAgICAgZW1waXJlOiB7XG4gICAgICAgIGlkOiBlbXBpcmVSb3cuaWQsXG4gICAgICAgIG5hbWU6IGVtcGlyZVJvdy5uYW1lLFxuICAgICAgICB0ZXJyaXRvcmllczogQXJyYXkuaXNBcnJheShlbXBpcmVSb3cudGVycml0b3JpZXMpID8gZW1waXJlUm93LnRlcnJpdG9yaWVzIDogW10sXG4gICAgICAgIHJlc291cmNlczoge1xuICAgICAgICAgIGNyZWRpdHM6IE1hdGgubWF4KDAsIE51bWJlcihlbXBpcmVSb3cuY3JlZGl0cyB8fCAwKSksXG4gICAgICAgICAgZW5lcmd5OiBNYXRoLm1heCgwLCBOdW1iZXIoZW1waXJlUm93LmVuZXJneSB8fCAwKSksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgY3JlZGl0c1BlckhvdXI6IDAsIC8vIFBsYWNlaG9sZGVyIC0gaW1wbGVtZW50IHByb2R1Y3Rpb24gY2FsY3VsYXRpb25cbiAgICAgIHJlc291cmNlc0dhaW5lZDogMCwgLy8gUGxhY2Vob2xkZXIgLSBpbXBsZW1lbnQgcmVzb3VyY2UgZ2FpbnNcbiAgICB9LFxuICB9KTtcbn0pKTtcblxuLyoqXG4gKiBDcmVkaXQgdHJhbnNhY3Rpb24gaGlzdG9yeSBmb3IgdGhlIGVtcGlyZVxuICogU3VwcG9ydHMgcGFnaW5hdGlvbiB0aHJvdWdoIGxpbWl0IHBhcmFtZXRlciAoP2xpbWl0PTUwKVxuICovXG5yb3V0ZXIuZ2V0KCcvY3JlZGl0cy9oaXN0b3J5JywgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gIGNvbnN0IGxpbWl0UmF3ID0gTnVtYmVyKHJlcS5xdWVyeS5saW1pdCB8fCA1MCk7XG4gIGNvbnN0IGxpbWl0ID0gTnVtYmVyLmlzRmluaXRlKGxpbWl0UmF3KSA/IE1hdGgubWluKE1hdGgubWF4KDEsIGxpbWl0UmF3KSwgMjAwKSA6IDUwO1xuXG4gIGNvbnN0IHVzZXIgPSByZXEudXNlciEgYXMgYW55O1xuXG4gIC8vIFJlc29sdmUgZW1waXJlIHVzaW5nIHRoZSBzZXJ2aWNlXG4gIGNvbnN0IGVtcGlyZVJvdyA9IGF3YWl0IEVtcGlyZVJlc29sdXRpb25TZXJ2aWNlLnJlc29sdmVFbXBpcmVCeVVzZXJPYmplY3QodXNlcik7XG4gIGlmICghZW1waXJlUm93KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBFUlJPUl9NRVNTQUdFUy5FTVBJUkVfTk9UX0ZPVU5EIH0pO1xuICB9XG5cbiAgY29uc3QgZW1waXJlSWQgPSBTdHJpbmcoZW1waXJlUm93LmlkKTtcblxuICAvLyBGZXRjaCBjcmVkaXQgdHJhbnNhY3Rpb25zIGZyb20gU3VwYWJhc2VcbiAgY29uc3QgeyBkYXRhOiB0eG5zLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbShEQl9UQUJMRVMuQ1JFRElUX1RSQU5TQUNUSU9OUylcbiAgICAuc2VsZWN0KCdpZCwgYW1vdW50LCB0eXBlLCBub3RlLCBiYWxhbmNlX2FmdGVyLCBjcmVhdGVkX2F0JylcbiAgICAuZXEoREJfRklFTERTLkJVSUxESU5HUy5FTVBJUkVfSUQsIGVtcGlyZUlkKVxuICAgIC5vcmRlcihEQl9GSUVMRFMuQlVJTERJTkdTLkNSRUFURURfQVQsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgIC5saW1pdChsaW1pdCk7XG5cbiAgaWYgKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY3JlZGl0IGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLklOVEVSTkFMX1NFUlZFUl9FUlJPUikuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBjcmVkaXQgaGlzdG9yeScgfSk7XG4gIH1cblxuICByZXR1cm4gcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgZGF0YToge1xuICAgICAgaGlzdG9yeTogKHR4bnMgfHwgW10pLm1hcCh0ID0+ICh7XG4gICAgICAgIF9pZDogdC5pZCxcbiAgICAgICAgYW1vdW50OiB0LmFtb3VudCxcbiAgICAgICAgdHlwZTogdC50eXBlLFxuICAgICAgICBub3RlOiB0Lm5vdGUgfHwgbnVsbCxcbiAgICAgICAgYmFsYW5jZUFmdGVyOiB0eXBlb2YgdC5iYWxhbmNlX2FmdGVyID09PSAnbnVtYmVyJyA/IHQuYmFsYW5jZV9hZnRlciA6IG51bGwsXG4gICAgICAgIGNyZWF0ZWRBdDogdC5jcmVhdGVkX2F0LFxuICAgICAgfSkpXG4gICAgfVxuICB9KTtcbn0pKTtcblxuLyoqXG4gKiBAZGVwcmVjYXRlZCBFbXBpcmUgY3JlYXRpb24gaXMgYXV0b21hdGljIGR1cmluZyByZWdpc3RyYXRpb25cbiAqL1xucm91dGVyLnBvc3QoJy8nLCAoX3JlcTogQXV0aFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuR09ORSkuanNvbih7XG4gICAgc3VjY2VzczogZmFsc2UsXG4gICAgZXJyb3I6ICdFbXBpcmUgY3JlYXRpb24gaXMgYXV0b21hdGljIGR1cmluZyByZWdpc3RyYXRpb24uIFRoaXMgZW5kcG9pbnQgaXMgZGVwcmVjYXRlZC4nXG4gIH0pO1xufSk7XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgTWFudWFsIHJlc291cmNlIHVwZGF0ZXMgYXJlIG5vIGxvbmdlciBzdXBwb3J0ZWRcbiAqL1xucm91dGVyLnBvc3QoJy91cGRhdGUtcmVzb3VyY2VzJywgKF9yZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLkdPTkUpLmpzb24oe1xuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIGVycm9yOiAnTWFudWFsIHJlc291cmNlIHVwZGF0ZXMgYXJlIG5vIGxvbmdlciBzdXBwb3J0ZWQuIFJlc291cmNlcyBhcmUgdXBkYXRlZCBhdXRvbWF0aWNhbGx5LidcbiAgfSk7XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xuXG5cblxuXG5cblxuXG4iXSwidmVyc2lvbiI6M30=
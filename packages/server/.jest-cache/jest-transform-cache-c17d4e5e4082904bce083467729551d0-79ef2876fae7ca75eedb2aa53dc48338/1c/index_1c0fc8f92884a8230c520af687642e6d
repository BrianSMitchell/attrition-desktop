a1c6442559b71206fc55b59285a9db43
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.io = exports.app = void 0;
exports.getIO = getIO;
const express_1 = __importDefault(require("express"));
const cors_1 = __importDefault(require("cors"));
const express_rate_limit_1 = __importDefault(require("express-rate-limit"));
const dotenv_1 = __importDefault(require("dotenv"));
const http_1 = require("http");
const database_1 = require("./config/database");
const ssl_1 = require("./config/ssl");
const auth_1 = __importDefault(require("./routes/auth"));
const game_1 = __importDefault(require("./routes/game"));
const universe_1 = __importDefault(require("./routes/universe"));
const sync_1 = __importDefault(require("./routes/sync"));
const messages_1 = __importDefault(require("./routes/messages"));
const errorHandler_1 = require("./middleware/errorHandler");
const sessionInvalidation_1 = require("./middleware/sessionInvalidation");
const securityHeaders_1 = __importDefault(require("./middleware/securityHeaders"));
const httpsRedirect_1 = require("./middleware/httpsRedirect");
const tlsValidator_1 = require("./utils/tlsValidator");
const socketService_1 = require("./services/socketService");
const hybridGameLoopService_1 = require("./services/hybridGameLoopService");
const httpsHealthCheck_1 = require("./utils/httpsHealthCheck");
const socketManager_1 = require("./utils/socketManager");
const security_1 = __importDefault(require("./routes/security"));
const admin_1 = __importDefault(require("./routes/admin"));
const response_formats_1 = require("./constants/response-formats");
const api_endpoints_1 = require("./constants/api-endpoints");
const tech_1 = __importDefault(require("./routes/tech"));
const socket_io_1 = require("socket.io");
const logger_1 = require("./utils/logger");
const runtimeEnv_1 = require("./utils/runtimeEnv");
const shared_1 = require("@game/shared");
// Load environment variables
dotenv_1.default.config();
// Initialize logger (optional console patch)
(0, logger_1.initLogger)();
const allowedOrigins = process.env[shared_1.ENV_VARS.CORS_ORIGIN]
    ? process.env[shared_1.ENV_VARS.CORS_ORIGIN].split(',').map(o => o.trim()).filter(Boolean)
    : ["http://localhost:5173", "http://localhost:5174", "null", "file://"];
const app = (0, express_1.default)();
exports.app = app;
app.set('trust proxy', 1);
const server = (0, http_1.createServer)(app);
// Socket.IO will be initialized later with proper server (HTTP or HTTPS)
let io;
// Expose IO getter for other services to broadcast events safely
function getIO() {
    return io;
}
// HTTPS health monitoring (production only)
let httpsHealthMonitor = null;
const PORT = parseInt(process.env[shared_1.ENV_VARS.PORT] || '3001', 10);
const HTTPS_PORT = parseInt(process.env[shared_1.ENV_VARS.HTTPS_PORT] || '443', 10);
// HTTPS enforcement - redirect HTTP to HTTPS in production
app.use(httpsRedirect_1.httpsRedirectMiddleware);
// Security middleware - comprehensive OWASP-compliant headers
const isDevelopment = process.env[shared_1.ENV_VARS.NODE_ENV] === shared_1.ENV_VALUES.DEVELOPMENT;
app.use(...(0, securityHeaders_1.default)(isDevelopment));
// Additional HTTPS security headers
app.use(httpsRedirect_1.httpsSecurityHeadersMiddleware);
// TLS connection monitoring (for HTTPS connections)
app.use(tlsValidator_1.tlsMonitoringMiddleware);
// CORS configuration (after security headers)
app.use((0, cors_1.default)({
    origin: allowedOrigins,
    credentials: true
}));
/**
 * Rate limiting
 * - Production-safe defaults
 * - Development-safe behavior via env toggles
 * - Skip CORS preflight (OPTIONS) and the public status endpoint
 * - Optional: dev-only skip for /api/auth/*
 */
const RATE_LIMIT_ENABLED = ((process.env[shared_1.ENV_VARS.RATE_LIMIT_ENABLED] ?? 'true').toLowerCase() !== 'false');
const limiter = (0, express_rate_limit_1.default)({
    windowMs: parseInt(process.env[shared_1.ENV_VARS.RATE_LIMIT_WINDOW_MS] || '900000', 10), // default 15 minutes
    max: parseInt(process.env[shared_1.ENV_VARS.RATE_LIMIT_MAX_REQUESTS] ||
        process.env[shared_1.ENV_VARS.NODE_ENV] === shared_1.ENV_VALUES.DEVELOPMENT ? '2000' : '100', 10),
    message: 'Too many requests from this IP, please try again later.',
    standardHeaders: true,
    legacyHeaders: false,
    skip: (req) => 
    // Do not count CORS preflights
    req.method === 'OPTIONS' ||
        // Public status endpoint
        req.path === api_endpoints_1.API_ENDPOINTS.SYSTEM.STATUS ||
        // Dev-only skips
        (process.env[shared_1.ENV_VARS.NODE_ENV] === shared_1.ENV_VALUES.DEVELOPMENT && (
        // Allow skipping auth endpoints during dev
        (process.env[shared_1.ENV_VARS.RATE_LIMIT_SKIP_AUTH] === 'true' && req.path.startsWith('/api/auth/')) ||
            // Allow skipping heavy game/universe endpoints during dev bursts
            (process.env[shared_1.ENV_VARS.RATE_LIMIT_SKIP_GAME] === 'true' && (req.path.startsWith('/api/game') || req.path.startsWith(api_endpoints_1.API_ENDPOINTS.UNIVERSE.BASE)))))
});
/**
 * In development, disable the HTTP rate limiter entirely to allow unlimited requests.
 * Keep limiter active only in production deployments.
 */
if (RATE_LIMIT_ENABLED && process.env[shared_1.ENV_VARS.NODE_ENV] !== shared_1.ENV_VALUES.DEVELOPMENT) {
    app.use(limiter);
}
// Body parsing middleware
app.use(express_1.default.json({ limit: '10mb' }));
app.use(express_1.default.urlencoded({ extended: true }));
const serverStart = Date.now(); // nodemon:restart v4 - admin endpoint added
// Health check endpoint
app.get(api_endpoints_1.API_ENDPOINTS.SYSTEM.HEALTH, (req, res) => {
    res.json({
        status: 'OK',
        timestamp: new Date().toISOString(),
        server: 'Attrition API',
        version: '1.0.0'
    });
});
// Public server status endpoint with temporary trace logging
app.use(api_endpoints_1.API_ENDPOINTS.SYSTEM.STATUS, (req, res, next) => {
    const start = Date.now();
    res.on('finish', () => {
        try {
            console.log('[TRACE] /api/status', {
                method: req.method,
                status: res.statusCode,
                ua: req.get('User-Agent') || 'unknown',
                ip: req.ip,
                xff: req.get('X-Forwarded-For') || undefined,
                proto: req.get('X-Forwarded-Proto') || (req.secure ? 'https' : 'http'),
                durationMs: Date.now() - start,
            });
        }
        catch { }
    });
    next();
});
app.get(api_endpoints_1.API_ENDPOINTS.SYSTEM.STATUS, (req, res) => {
    try {
        const uptimeSeconds = Math.floor((Date.now() - serverStart) / 1000);
        const socketsConnected = io ? io.of('/').sockets.size : 0;
        const playersOnline = (0, socketService_1.getOnlineUniqueUsersCount)();
        res.json({
            success: true,
            data: {
                status: 'OK',
                version: '1.0.0',
                startedAt: new Date(serverStart).toISOString(),
                uptimeSeconds,
                playersOnline,
                socketsConnected,
                secure: req.secure || req.get('X-Forwarded-Proto') === 'https',
                environment: process.env[shared_1.ENV_VARS.NODE_ENV] || shared_1.ENV_VALUES.DEVELOPMENT
            }
        });
    }
    catch (error) {
        res.status(response_formats_1.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({
            success: false,
            error: 'Failed to retrieve server status'
        });
    }
});
// Security monitoring endpoints (production only)
if (process.env[shared_1.ENV_VARS.NODE_ENV] === shared_1.ENV_VALUES.PRODUCTION) {
    app.get('/api/https-health', httpsHealthCheck_1.httpsHealthCheckHandler);
    app.get('/api/tls-security', tlsValidator_1.tlsSecurityStatusHandler);
}
// Session invalidation middleware for authenticated routes
app.use('/api/game', sessionInvalidation_1.sessionInvalidationMiddleware);
app.use(api_endpoints_1.API_ENDPOINTS.UNIVERSE.BASE, sessionInvalidation_1.sessionInvalidationMiddleware);
app.use(api_endpoints_1.API_ENDPOINTS.SYNC.BASE, sessionInvalidation_1.sessionInvalidationMiddleware);
app.use('/api/security', sessionInvalidation_1.sessionInvalidationMiddleware);
app.use(api_endpoints_1.API_ENDPOINTS.MESSAGES.BASE, sessionInvalidation_1.sessionInvalidationMiddleware);
// API routes
app.use('/api/auth', auth_1.default);
app.use('/api/security', security_1.default); // Security monitoring endpoints
// Main game routes
// Main game routes
app.use('/api/game', game_1.default);
// Legacy compatibility routes
app.use('/api/tech', tech_1.default); // Separate router for /api/tech/* backwards compatibility
app.use(api_endpoints_1.API_ENDPOINTS.UNIVERSE.BASE, universe_1.default);
app.use(api_endpoints_1.API_ENDPOINTS.SYNC.BASE, sync_1.default);
app.use(api_endpoints_1.API_ENDPOINTS.MESSAGES.BASE, messages_1.default);
// Temporary alias to match client path while we migrate
app.use('/api/game/messages', messages_1.default);
// Admin maintenance routes (guarded by ADMIN_MAINTENANCE_SECRET)
app.use(api_endpoints_1.API_ENDPOINTS.ADMIN.BASE, admin_1.default);
// Socket.IO will be setup in startServer() function
// Error handling middleware (must be last)
app.use(errorHandler_1.errorHandler);
// 404 handler
app.use('*', (req, res) => {
    res.status(response_formats_1.HTTP_STATUS.NOT_FOUND).json({
        success: false,
        error: 'Route not found'
    });
});
// Start server with HTTPS support
async function startServer() {
    try {
        // Connect to database
        await (0, database_1.connectDatabase)();
        // Note: Database initialization complete - using Supabase
        // In production, check if we need to handle SSL ourselves or if it's handled by reverse proxy (like Render)
        if (process.env[shared_1.ENV_VARS.NODE_ENV] === shared_1.ENV_VALUES.PRODUCTION) {
            console.log('?? Production mode: HTTPS enforcement enabled');
            // Check if SSL is handled by reverse proxy (Render, CloudFlare, etc.)
            const useReverseProxySSL = (0, runtimeEnv_1.isReverseProxySSL)();
            if (useReverseProxySSL) {
                console.log('?? Using reverse proxy SSL termination (Render/CloudFlare/etc.)');
                console.log('? Server will run HTTP - SSL handled by reverse proxy');
            }
            else {
                // Load SSL configuration - this will throw if not available in production
                const sslConfig = await (0, ssl_1.getSSLConfigFromEnvironment)();
                if (!sslConfig) {
                    const errorMessage = 'HTTPS is mandatory in production but SSL configuration is not available. ' +
                        'Please provide SSL certificates via environment variables (SSL_CERTIFICATE, SSL_PRIVATE_KEY) ' +
                        'or file paths (SSL_CERT_PATH, SSL_KEY_PATH). Or set USE_REVERSE_PROXY_SSL=true if using a reverse proxy.';
                    console.error('? PRODUCTION STARTUP FAILED:', errorMessage);
                    throw new Error(errorMessage);
                }
            }
            if (useReverseProxySSL) {
                // Production with reverse proxy SSL: Run HTTP server, SSL handled by reverse proxy
                exports.io = io = new socket_io_1.Server(server, {
                    cors: {
                        origin: allowedOrigins,
                        methods: ["GET", "POST"]
                    }
                });
                server.listen(PORT, () => {
                    console.log(`?? PRODUCTION server running on port ${PORT}`);
                    console.log(`?? Health check: http://localhost:${PORT}/health`);
                    console.log(`?? Game API: http://localhost:${PORT}/api`);
                    console.log(`?? Socket.IO ready for connections`);
                    console.log(`?? SSL/TLS: Handled by reverse proxy (Render/CloudFlare/etc.)`);
                    console.log(`? SECURITY: HTTPS enforced at reverse proxy level`);
                    // Start hybrid game loop (production gated)
                    const loopEnabled = (process.env.GAME_LOOP_ENABLED ?? 'false').toLowerCase() !== 'false';
                    if (loopEnabled) {
                        console.log(`?? Starting HYBRID game loop (responsive completions + efficient resources)`);
                        console.log(`?? Credit payouts every ${process.env.CREDIT_PAYOUT_PERIOD_MINUTES || '1'} minute(s)`);
                        hybridGameLoopService_1.hybridGameLoop.start();
                    }
                    else {
                        console.log('?? HYBRID game loop disabled (GAME_LOOP_ENABLED=false)');
                    }
                });
                (0, socketService_1.setupSocketIO)(io);
                (0, socketManager_1.initSocketManager)(io); // Initialize socket manager for global access
            }
            else {
                // Production with direct SSL: Start HTTPS server only
                const sslConfig = await (0, ssl_1.getSSLConfigFromEnvironment)();
                const httpsServer = (0, ssl_1.createHttpsServer)(app, sslConfig, HTTPS_PORT);
                // Create Socket.IO instance for HTTPS server
                exports.io = io = new socket_io_1.Server(httpsServer, {
                    cors: {
                        origin: allowedOrigins,
                        methods: ["GET", "POST"]
                    }
                });
                // Create HTTP server ONLY for HTTPS redirects - no actual HTTP content served
                const httpRedirectServer = (0, http_1.createServer)(app);
                httpRedirectServer.listen(PORT, () => {
                    console.log(`?? HTTP redirect server on port ${PORT} (redirects all traffic to HTTPS)`);
                    console.log(`??  HTTP server serves NO content - all requests redirected to HTTPS`);
                });
                // HTTPS server startup with enhanced logging
                httpsServer.listen(HTTPS_PORT, () => {
                    console.log(`?? PRODUCTION HTTPS server running on port ${HTTPS_PORT}`);
                    console.log(`?? Health check: https://localhost:${HTTPS_PORT}/health`);
                    console.log(`?? Game API: https://localhost:${HTTPS_PORT}/api`);
                    console.log(`?? Socket.IO ready for secure connections`);
                    console.log(`?? SSL/TLS: ${sslConfig.minVersion} to ${sslConfig.maxVersion}`);
                    console.log(`? HTTPS ENFORCEMENT: All HTTP requests redirected to HTTPS`);
                    console.log(`? SECURITY: Production server running in HTTPS-only mode`);
                    // Start hybrid game loop (production gated)
                    const loopEnabled = (process.env.GAME_LOOP_ENABLED ?? 'false').toLowerCase() !== 'false';
                    if (loopEnabled) {
                        console.log(`?? Starting HYBRID game loop (responsive completions + efficient resources)`);
                        console.log(`?? Credit payouts every ${process.env.CREDIT_PAYOUT_PERIOD_MINUTES || '1'} minute(s)`);
                        hybridGameLoopService_1.hybridGameLoop.start();
                    }
                    else {
                        console.log('?? HYBRID game loop disabled (GAME_LOOP_ENABLED=false)');
                    }
                });
            }
            // Setup Socket.IO on HTTPS server
            (0, socketService_1.setupSocketIO)(io);
            (0, socketManager_1.initSocketManager)(io); // Initialize socket manager for global access
            // Start HTTPS health monitoring in production ONLY when not using reverse proxy SSL
            if (useReverseProxySSL) {
                console.log('?? HTTPS health monitoring disabled: reverse proxy SSL termination detected (e.g., Render)');
            }
            else if ((0, httpsHealthCheck_1.shouldStartHttpsHealthMonitor)(false)) {
                httpsHealthMonitor = new httpsHealthCheck_1.HttpsHealthMonitor(HTTPS_PORT, PORT, 'localhost');
                const monitoringInterval = parseInt(process.env[shared_1.ENV_VARS.HTTPS_HEALTH_CHECK_INTERVAL_MINUTES] || '60', 10);
                httpsHealthMonitor.start(monitoringInterval);
                console.log(`?? HTTPS health monitoring started (every ${monitoringInterval} minutes)`);
            }
        }
        else {
            // Development/Test: HTTP server with optional HTTPS
            console.log(`?? Development mode: HTTP server enabled`);
            const sslConfig = await (0, ssl_1.getSSLConfigFromEnvironment)();
            if (sslConfig && process.env[shared_1.ENV_VARS.FORCE_HTTPS] === 'true') {
                // Development with HTTPS (for testing HTTPS behavior)
                console.log('?? Development HTTPS mode enabled (FORCE_HTTPS=true)');
                const httpsServer = (0, ssl_1.createHttpsServer)(app, sslConfig, HTTPS_PORT);
                exports.io = io = new socket_io_1.Server(httpsServer, {
                    cors: {
                        origin: allowedOrigins,
                        methods: ["GET", "POST"]
                    }
                });
                // Also run HTTP server for development convenience
                server.listen(PORT, () => {
                    console.log(`?? HTTP server on port ${PORT} (redirects to HTTPS)`);
                });
                httpsServer.listen(HTTPS_PORT, () => {
                    console.log(`?? Development HTTPS server on port ${HTTPS_PORT}`);
                    console.log(`?? Health check: https://localhost:${HTTPS_PORT}/health`);
                    console.log(`?? Game API: https://localhost:${HTTPS_PORT}/api`);
                    console.log(`?? Socket.IO ready for secure connections`);
                });
                (0, socketService_1.setupSocketIO)(io);
                (0, socketManager_1.initSocketManager)(io); // Initialize socket manager for global access
            }
            else {
                // Standard development: HTTP only
                exports.io = io = new socket_io_1.Server(server, {
                    cors: {
                        origin: (origin, callback) => {
                            // Allow null origin (file://) and localhost origins
                            if (!origin || origin === 'null' || allowedOrigins.includes(origin)) {
                                callback(null, true);
                            }
                            else {
                                callback(new Error('Not allowed by CORS'));
                            }
                        },
                        methods: ["GET", "POST"],
                        credentials: false
                    }
                });
                server.listen(PORT, () => {
                    console.log(`?? Development HTTP server running on port ${PORT}`);
                    console.log(`?? Health check: http://localhost:${PORT}/health`);
                    console.log(`?? Game API: http://localhost:${PORT}/api`);
                    console.log(`?? Socket.IO ready for connections`);
                    console.log(`??  Development mode: HTTPS enforcement disabled`);
                });
                (0, socketService_1.setupSocketIO)(io);
                (0, socketManager_1.initSocketManager)(io); // Initialize socket manager for global access
            }
            // Start hybrid game loop for development (enabled by default)
            const devLoopEnabled = (process.env.GAME_LOOP_ENABLED ?? 'true').toLowerCase() !== 'false';
            if (devLoopEnabled) {
                console.log(`?? Starting HYBRID game loop (responsive completions + efficient resources)`);
                console.log(`?? Credit payouts every ${process.env.CREDIT_PAYOUT_PERIOD_MINUTES || '1'} minute(s)`);
                hybridGameLoopService_1.hybridGameLoop.start();
            }
            else {
                console.log('?? HYBRID game loop disabled (GAME_LOOP_ENABLED=false)');
            }
        }
    }
    catch (error) {
        console.error('? Failed to start server:', error);
        process.exit(1);
    }
}
// Handle graceful shutdown with timeout
let isShuttingDown = false;
const SHUTDOWN_TIMEOUT = 5000; // 5 seconds
function shutdown() {
    if (isShuttingDown) {
        console.log('?? Shutdown already in progress');
        return;
    }
    isShuttingDown = true;
    console.log('?? Shutdown signal received, shutting down gracefully');
    // Stop hybrid game loop
    try {
        hybridGameLoopService_1.hybridGameLoop.stop();
        console.log('?? Game loop stopped');
    }
    catch (error) {
        console.error('Error stopping hybrid game loop:', error);
    }
    // Stop HTTPS health monitor
    if (httpsHealthMonitor) {
        try {
            httpsHealthMonitor.stop();
            console.log('?? HTTPS health monitor stopped');
        }
        catch (error) {
            console.error('Error stopping HTTPS health monitor:', error);
        }
    }
    // Close server with timeout
    const shutdownTimer = setTimeout(() => {
        console.log('? Shutdown timeout reached, force closing');
        process.exit(1);
    }, SHUTDOWN_TIMEOUT);
    server.close(() => {
        clearTimeout(shutdownTimer);
        console.log('? HTTP server closed');
        // Close database connections
        try {
            // Add any database cleanup here if needed
            console.log('?? Database connections closed');
        }
        catch (error) {
            console.error('Error closing database connections:', error);
        }
        console.log('? Process terminated gracefully');
        process.exit(0);
    });
    // If server doesn't close within timeout, force exit
    setTimeout(() => {
        console.log('? Force closing remaining connections');
        process.exit(0);
    }, SHUTDOWN_TIMEOUT + 1000);
}
// Handle graceful shutdown
process.on('SIGTERM', () => {
    console.log('?? SIGTERM received');
    shutdown();
});
process.on('SIGINT', () => {
    console.log('?? SIGINT received');
    shutdown();
});
// Handle uncaught exceptions
process.on('uncaughtException', (error) => {
    console.error('?? Uncaught Exception:', error);
    shutdown();
});
process.on('unhandledRejection', (reason, promise) => {
    console.error('?? Unhandled Rejection at:', promise, 'reason:', reason);
    shutdown();
});
if ((process.env[shared_1.ENV_VARS.NODE_ENV] || '').toLowerCase() !== 'test') {
    startServer();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBbURBLHNCQUVDO0FBckRELHNEQUE4QjtBQUM5QixnREFBd0I7QUFDeEIsNEVBQTJDO0FBQzNDLG9EQUE0QjtBQUM1QiwrQkFBb0M7QUFDcEMsZ0RBQW9EO0FBQ3BELHNDQUE4RTtBQUM5RSx5REFBdUM7QUFDdkMseURBQXVDO0FBQ3ZDLGlFQUErQztBQUMvQyx5REFBdUM7QUFDdkMsaUVBQThDO0FBQzlDLDREQUF5RDtBQUN6RCwwRUFBaUY7QUFDakYsbUZBQWdFO0FBQ2hFLDhEQUFxRztBQUNyRyx1REFBeUY7QUFDekYsNERBQW9GO0FBQ3BGLDRFQUFrRTtBQUNsRSwrREFBc0g7QUFDdEgseURBQTBEO0FBQzFELGlFQUErQztBQUMvQywyREFBeUM7QUFDekMsbUVBQTJEO0FBQzNELDZEQUEwRDtBQUMxRCx5REFBdUM7QUFDdkMseUNBQW1DO0FBQ25DLDJDQUE0QztBQUM1QyxtREFBdUQ7QUFDdkQseUNBQW9EO0FBSXBELDZCQUE2QjtBQUM3QixnQkFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRWhCLDZDQUE2QztBQUM3QyxJQUFBLG1CQUFVLEdBQUUsQ0FBQztBQUViLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQVEsQ0FBQyxXQUFXLENBQUM7SUFDdEQsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQVEsQ0FBQyxXQUFXLENBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztJQUNsRixDQUFDLENBQUMsQ0FBQyx1QkFBdUIsRUFBRSx1QkFBdUIsRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFFMUUsTUFBTSxHQUFHLEdBQXdCLElBQUEsaUJB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QUFDLHFCQUFxQixDQUFDLENBQUM7SUFDbkMsUUFBUSxFQUFFLENBQUM7QUFDYixDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtJQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDbEMsUUFBUSxFQUFFLENBQUM7QUFDYixDQUFDLENBQUMsQ0FBQztBQUVILDZCQUE2QjtBQUM3QixPQUFPLENBQUMsRUFBRSxDQUFDLG1CQUFtQixFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7SUFDeEMsT0FBTyxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMvQyxRQUFRLEVBQUUsQ0FBQztBQUNiLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUNuRCxPQUFPLENBQUMsS0FBSyxDQUFDLDRCQUE0QixFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDeEUsUUFBUSxFQUFFLENBQUM7QUFDYixDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFRLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsV0FBVyxFQUFFLEtBQUssTUFBTSxFQUFFLENBQUM7SUFDcEUsV0FBVyxFQUFFLENBQUM7QUFDaEIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcUHJvamVjdHNcXEF0dHJpdGlvblxccGFja2FnZXNcXHNlcnZlclxcc3JjXFxpbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IGNvcnMgZnJvbSAnY29ycyc7XHJcbmltcG9ydCByYXRlTGltaXQgZnJvbSAnZXhwcmVzcy1yYXRlLWxpbWl0JztcclxuaW1wb3J0IGRvdGVudiBmcm9tICdkb3RlbnYnO1xyXG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXIgfSBmcm9tICdodHRwJztcclxuaW1wb3J0IHsgY29ubmVjdERhdGFiYXNlIH0gZnJvbSAnLi9jb25maWcvZGF0YWJhc2UnO1xyXG5pbXBvcnQgeyBnZXRTU0xDb25maWdGcm9tRW52aXJvbm1lbnQsIGNyZWF0ZUh0dHBzU2VydmVyIH0gZnJvbSAnLi9jb25maWcvc3NsJztcclxuaW1wb3J0IGF1dGhSb3V0ZXMgZnJvbSAnLi9yb3V0ZXMvYXV0aCc7XHJcbmltcG9ydCBnYW1lUm91dGVzIGZyb20gJy4vcm91dGVzL2dhbWUnO1xyXG5pbXBvcnQgdW5pdmVyc2VSb3V0ZXMgZnJvbSAnLi9yb3V0ZXMvdW5pdmVyc2UnO1xyXG5pbXBvcnQgc3luY1JvdXRlcyBmcm9tICcuL3JvdXRlcy9zeW5jJztcclxuaW1wb3J0IG1lc3NhZ2VSb3V0ZXMgZnJvbSAnLi9yb3V0ZXMvbWVzc2FnZXMnO1xyXG5pbXBvcnQgeyBlcnJvckhhbmRsZXIgfSBmcm9tICcuL21pZGRsZXdhcmUvZXJyb3JIYW5kbGVyJztcclxuaW1wb3J0IHsgc2Vzc2lvbkludmFsaWRhdGlvbk1pZGRsZXdhcmUgfSBmcm9tICcuL21pZGRsZXdhcmUvc2Vzc2lvbkludmFsaWRhdGlvbic7XHJcbmltcG9ydCBzZWN1cml0eUhlYWRlcnNTdGFjayBmcm9tICcuL21pZGRsZXdhcmUvc2VjdXJpdHlIZWFkZXJzJztcclxuaW1wb3J0IHsgaHR0cHNSZWRpcmVjdE1pZGRsZXdhcmUsIGh0dHBzU2VjdXJpdHlIZWFkZXJzTWlkZGxld2FyZSB9IGZyb20gJy4vbWlkZGxld2FyZS9odHRwc1JlZGlyZWN0JztcclxuaW1wb3J0IHsgdGxzTW9uaXRvcmluZ01pZGRsZXdhcmUsIHRsc1NlY3VyaXR5U3RhdHVzSGFuZGxlciB9IGZyb20gJy4vdXRpbHMvdGxzVmFsaWRhdG9yJztcclxuaW1wb3J0IHsgc2V0dXBTb2NrZXRJTywgZ2V0T25saW5lVW5pcXVlVXNlcnNDb3VudCB9IGZyb20gJy4vc2VydmljZXMvc29ja2V0U2VydmljZSc7XHJcbmltcG9ydCB7IGh5YnJpZEdhbWVMb29wIH0gZnJvbSAnLi9zZXJ2aWNlcy9oeWJyaWRHYW1lTG9vcFNlcnZpY2UnO1xyXG5pbXBvcnQgeyBodHRwc0hlYWx0aENoZWNrSGFuZGxlciwgSHR0cHNIZWFsdGhNb25pdG9yLCBzaG91bGRTdGFydEh0dHBzSGVhbHRoTW9uaXRvciB9IGZyb20gJy4vdXRpbHMvaHR0cHNIZWFsdGhDaGVjayc7XHJcbmltcG9ydCB7IGluaXRTb2NrZXRNYW5hZ2VyIH0gZnJvbSAnLi91dGlscy9zb2NrZXRNYW5hZ2VyJztcclxuaW1wb3J0IHNlY3VyaXR5Um91dGVzIGZyb20gJy4vcm91dGVzL3NlY3VyaXR5JztcclxuaW1wb3J0IGFkbWluUm91dGVzIGZyb20gJy4vcm91dGVzL2FkbWluJztcclxuaW1wb3J0IHsgSFRUUF9TVEFUVVMgfSBmcm9tICcuL2NvbnN0YW50cy9yZXNwb25zZS1mb3JtYXRzJztcclxuaW1wb3J0IHsgQVBJX0VORFBPSU5UUyB9IGZyb20gJy4vY29uc3RhbnRzL2FwaS1lbmRwb2ludHMnO1xyXG5pbXBvcnQgdGVjaFJvdXRlcyBmcm9tICcuL3JvdXRlcy90ZWNoJztcclxuaW1wb3J0IHsgU2VydmVyIH0gZnJvbSAnc29ja2V0LmlvJztcclxuaW1wb3J0IHsgaW5pdExvZ2dlciB9IGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcclxuaW1wb3J0IHsgaXNSZXZlcnNlUHJveHlTU0wgfSBmcm9tICcuL3V0aWxzL3J1bnRpbWVFbnYnO1xyXG5pbXBvcnQgeyBFTlZfVkFSUywgRU5WX1ZBTFVFUyB9IGZyb20gJ0BnYW1lL3NoYXJlZCc7XHJcblxyXG5cclxuXHJcbi8vIExvYWQgZW52aXJvbm1lbnQgdmFyaWFibGVzXHJcbmRvdGVudi5jb25maWcoKTtcclxuXHJcbi8vIEluaXRpYWxpemUgbG9nZ2VyIChvcHRpb25hbCBjb25zb2xlIHBhdGNoKVxyXG5pbml0TG9nZ2VyKCk7XHJcblxyXG5jb25zdCBhbGxvd2VkT3JpZ2lucyA9IHByb2Nlc3MuZW52W0VOVl9WQVJTLkNPUlNfT1JJR0lOXVxyXG4gID8gcHJvY2Vzcy5lbnZbRU5WX1ZBUlMuQ09SU19PUklHSU5dIS5zcGxpdCgnLCcpLm1hcChvID0+IG8udHJpbSgpKS5maWx0ZXIoQm9vbGVhbilcclxuICA6IFtcImh0dHA6Ly9sb2NhbGhvc3Q6NTE3M1wiLCBcImh0dHA6Ly9sb2NhbGhvc3Q6NTE3NFwiLCBcIm51bGxcIiwgXCJmaWxlOi8vXCJdO1xyXG5cclxuY29uc3QgYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uID0gZXhwcmVzcygpO1xyXG5hcHAuc2V0KCd0cnVzdCBwcm94eScsIDEpO1xyXG5jb25zdCBzZXJ2ZXIgPSBjcmVhdGVTZXJ2ZXIoYXBwKTtcclxuXHJcbi8vIFNvY2tldC5JTyB3aWxsIGJlIGluaXRpYWxpemVkIGxhdGVyIHdpdGggcHJvcGVyIHNlcnZlciAoSFRUUCBvciBIVFRQUylcclxubGV0IGlvOiBTZXJ2ZXI7XHJcblxyXG4vLyBFeHBvc2UgSU8gZ2V0dGVyIGZvciBvdGhlciBzZXJ2aWNlcyB0byBicm9hZGNhc3QgZXZlbnRzIHNhZmVseVxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0SU8oKTogU2VydmVyIHwgdW5kZWZpbmVkIHtcclxuICByZXR1cm4gaW87XHJcbn1cclxuXHJcbi8vIEhUVFBTIGhlYWx0aCBtb25pdG9yaW5nIChwcm9kdWN0aW9uIG9ubHkpXHJcbmxldCBodHRwc0hlYWx0aE1vbml0b3I6IEh0dHBzSGVhbHRoTW9uaXRvciB8IG51bGwgPSBudWxsO1xyXG5cclxuY29uc3QgUE9SVCA9IHBhcnNlSW50KHByb2Nlc3MuZW52W0VOVl9WQVJTLlBPUlRdIHx8ICczMDAxJywgMTApO1xyXG5jb25zdCBIVFRQU19QT1JUID0gcGFyc2VJbnQocHJvY2Vzcy5lbnZbRU5WX1ZBUlMuSFRUUFNfUE9SVF0gfHwgJzQ0MycsIDEwKTtcclxuXHJcbi8vIEhUVFBTIGVuZm9yY2VtZW50IC0gcmVkaXJlY3QgSFRUUCB0byBIVFRQUyBpbiBwcm9kdWN0aW9uXHJcbmFwcC51c2UoaHR0cHNSZWRpcmVjdE1pZGRsZXdhcmUpO1xyXG5cclxuLy8gU2VjdXJpdHkgbWlkZGxld2FyZSAtIGNvbXByZWhlbnNpdmUgT1dBU1AtY29tcGxpYW50IGhlYWRlcnNcclxuY29uc3QgaXNEZXZlbG9wbWVudCA9IHByb2Nlc3MuZW52W0VOVl9WQVJTLk5PREVfRU5WXSA9PT0gRU5WX1ZBTFVFUy5ERVZFTE9QTUVOVDtcclxuYXBwLnVzZSguLi5zZWN1cml0eUhlYWRlcnNTdGFjayhpc0RldmVsb3BtZW50KSk7XHJcblxyXG4vLyBBZGRpdGlvbmFsIEhUVFBTIHNlY3VyaXR5IGhlYWRlcnNcclxuYXBwLnVzZShodHRwc1NlY3VyaXR5SGVhZGVyc01pZGRsZXdhcmUpO1xyXG5cclxuLy8gVExTIGNvbm5lY3Rpb24gbW9uaXRvcmluZyAoZm9yIEhUVFBTIGNvbm5lY3Rpb25zKVxyXG5hcHAudXNlKHRsc01vbml0b3JpbmdNaWRkbGV3YXJlIGFzIGFueSk7XHJcblxyXG4vLyBDT1JTIGNvbmZpZ3VyYXRpb24gKGFmdGVyIHNlY3VyaXR5IGhlYWRlcnMpXHJcbmFwcC51c2UoY29ycyh7XHJcbiAgb3JpZ2luOiBhbGxvd2VkT3JpZ2lucyxcclxuICBjcmVkZW50aWFsczogdHJ1ZVxyXG59KSk7XHJcblxyXG4vKipcclxuICogUmF0ZSBsaW1pdGluZ1xyXG4gKiAtIFByb2R1Y3Rpb24tc2FmZSBkZWZhdWx0c1xyXG4gKiAtIERldmVsb3BtZW50LXNhZmUgYmVoYXZpb3IgdmlhIGVudiB0b2dnbGVzXHJcbiAqIC0gU2tpcCBDT1JTIHByZWZsaWdodCAoT1BUSU9OUykgYW5kIHRoZSBwdWJsaWMgc3RhdHVzIGVuZHBvaW50XHJcbiAqIC0gT3B0aW9uYWw6IGRldi1vbmx5IHNraXAgZm9yIC9hcGkvYXV0aC8qXHJcbiAqL1xyXG5jb25zdCBSQVRFX0xJTUlUX0VOQUJMRUQgPSAoKHByb2Nlc3MuZW52W0VOVl9WQVJTLlJBVEVfTElNSVRfRU5BQkxFRF0gPz8gJ3RydWUnKS50b0xvd2VyQ2FzZSgpICE9PSAnZmFsc2UnKTtcclxuXHJcbmNvbnN0IGxpbWl0ZXIgPSByYXRlTGltaXQoe1xyXG4gIHdpbmRvd01zOiBwYXJzZUludChwcm9jZXNzLmVudltFTlZfVkFSUy5SQVRFX0xJTUlUX1dJTkRPV19NU10gfHwgJzkwMDAwMCcsIDEwKSwgLy8gZGVmYXVsdCAxNSBtaW51dGVzXHJcbiAgbWF4OiBwYXJzZUludChcclxuICAgIHByb2Nlc3MuZW52W0VOVl9WQVJTLlJBVEVfTElNSVRfTUFYX1JFUVVFU1RTXSB8fFxyXG4gICAgcHJvY2Vzcy5lbnZbRU5WX1ZBUlMuTk9ERV9FTlZdID09PSBFTlZfVkFMVUVTLkRFVkVMT1BNRU5UID8gJzIwMDAnIDogJzEwMCcsXHJcbiAgICAxMFxyXG4gICksXHJcbiAgbWVzc2FnZTogJ1RvbyBtYW55IHJlcXVlc3RzIGZyb20gdGhpcyBJUCwgcGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nLFxyXG4gIHN0YW5kYXJkSGVhZGVyczogdHJ1ZSxcclxuICBsZWdhY3lIZWFkZXJzOiBmYWxzZSxcclxuICBza2lwOiAocmVxKSA9PlxyXG4gICAgLy8gRG8gbm90IGNvdW50IENPUlMgcHJlZmxpZ2h0c1xyXG4gICAgcmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnIHx8XHJcbiAgICAvLyBQdWJsaWMgc3RhdHVzIGVuZHBvaW50XHJcbiAgICByZXEucGF0aCA9PT0gQVBJX0VORFBPSU5UUy5TWVNURU0uU1RBVFVTIHx8XHJcbiAgICAvLyBEZXYtb25seSBza2lwc1xyXG4gICAgKFxyXG4gICAgICBwcm9jZXNzLmVudltFTlZfVkFSUy5OT0RFX0VOVl0gPT09IEVOVl9WQUxVRVMuREVWRUxPUE1FTlQgJiYgKFxyXG4gICAgICAgIC8vIEFsbG93IHNraXBwaW5nIGF1dGggZW5kcG9pbnRzIGR1cmluZyBkZXZcclxuICAgICAgICAocHJvY2Vzcy5lbnZbRU5WX1ZBUlMuUkFURV9MSU1JVF9TS0lQX0FVVEhdID09PSAndHJ1ZScgJiYgcmVxLnBhdGguc3RhcnRzV2l0aCgnL2FwaS9hdXRoLycpKSB8fFxyXG4gICAgICAgIC8vIEFsbG93IHNraXBwaW5nIGhlYXZ5IGdhbWUvdW5pdmVyc2UgZW5kcG9pbnRzIGR1cmluZyBkZXYgYnVyc3RzXHJcbiAgICAgICAgKHByb2Nlc3MuZW52W0VOVl9WQVJTLlJBVEVfTElNSVRfU0tJUF9HQU1FXSA9PT0gJ3RydWUnICYmIChyZXEucGF0aC5zdGFydHNXaXRoKCcvYXBpL2dhbWUnKSB8fCByZXEucGF0aC5zdGFydHNXaXRoKEFQSV9FTkRQT0lOVFMuVU5JVkVSU0UuQkFTRSkpKVxyXG4gICAgICApXHJcbiAgICApXHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEluIGRldmVsb3BtZW50LCBkaXNhYmxlIHRoZSBIVFRQIHJhdGUgbGltaXRlciBlbnRpcmVseSB0byBhbGxvdyB1bmxpbWl0ZWQgcmVxdWVzdHMuXHJcbiAqIEtlZXAgbGltaXRlciBhY3RpdmUgb25seSBpbiBwcm9kdWN0aW9uIGRlcGxveW1lbnRzLlxyXG4gKi9cclxuaWYgKFJBVEVfTElNSVRfRU5BQkxFRCAmJiBwcm9jZXNzLmVudltFTlZfVkFSUy5OT0RFX0VOVl0gIT09IEVOVl9WQUxVRVMuREVWRUxPUE1FTlQpIHtcclxuICBhcHAudXNlKGxpbWl0ZXIpO1xyXG59XHJcblxyXG4vLyBCb2R5IHBhcnNpbmcgbWlkZGxld2FyZVxyXG5hcHAudXNlKGV4cHJlc3MuanNvbih7IGxpbWl0OiAnMTBtYicgfSkpO1xyXG5hcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcclxuXHJcbmNvbnN0IHNlcnZlclN0YXJ0ID0gRGF0ZS5ub3coKTsgLy8gbm9kZW1vbjpyZXN0YXJ0IHY0IC0gYWRtaW4gZW5kcG9pbnQgYWRkZWRcclxuXHJcbi8vIEhlYWx0aCBjaGVjayBlbmRwb2ludFxyXG5hcHAuZ2V0KEFQSV9FTkRQT0lOVFMuU1lTVEVNLkhFQUxUSCwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgcmVzLmpzb24oeyBcclxuICAgIHN0YXR1czogJ09LJywgXHJcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIHNlcnZlcjogJ0F0dHJpdGlvbiBBUEknLFxyXG4gICAgdmVyc2lvbjogJzEuMC4wJ1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8vIFB1YmxpYyBzZXJ2ZXIgc3RhdHVzIGVuZHBvaW50IHdpdGggdGVtcG9yYXJ5IHRyYWNlIGxvZ2dpbmdcclxuYXBwLnVzZShBUElfRU5EUE9JTlRTLlNZU1RFTS5TVEFUVVMsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcclxuICByZXMub24oJ2ZpbmlzaCcsICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdbVFJBQ0VdIC9hcGkvc3RhdHVzJywge1xyXG4gICAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcclxuICAgICAgICBzdGF0dXM6IHJlcy5zdGF0dXNDb2RlLFxyXG4gICAgICAgIHVhOiByZXEuZ2V0KCdVc2VyLUFnZW50JykgfHwgJ3Vua25vd24nLFxyXG4gICAgICAgIGlwOiByZXEuaXAsXHJcbiAgICAgICAgeGZmOiByZXEuZ2V0KCdYLUZvcndhcmRlZC1Gb3InKSB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgcHJvdG86IHJlcS5nZXQoJ1gtRm9yd2FyZGVkLVByb3RvJykgfHwgKHJlcS5zZWN1cmUgPyAnaHR0cHMnIDogJ2h0dHAnKSxcclxuICAgICAgICBkdXJhdGlvbk1zOiBEYXRlLm5vdygpIC0gc3RhcnQsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCB7fVxyXG4gIH0pO1xyXG4gIG5leHQoKTtcclxufSk7XHJcbmFwcC5nZXQoQVBJX0VORFBPSU5UUy5TWVNURU0uU1RBVFVTLCAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXB0aW1lU2Vjb25kcyA9IE1hdGguZmxvb3IoKERhdGUubm93KCkgLSBzZXJ2ZXJTdGFydCkgLyAxMDAwKTtcclxuICAgIGNvbnN0IHNvY2tldHNDb25uZWN0ZWQgPSBpbyA/IGlvLm9mKCcvJykuc29ja2V0cy5zaXplIDogMDtcclxuICAgIGNvbnN0IHBsYXllcnNPbmxpbmUgPSBnZXRPbmxpbmVVbmlxdWVVc2Vyc0NvdW50KCk7XHJcblxyXG4gICAgcmVzLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgc3RhdHVzOiAnT0snLFxyXG4gICAgICAgIHZlcnNpb246ICcxLjAuMCcsXHJcbiAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZShzZXJ2ZXJTdGFydCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cHRpbWVTZWNvbmRzLFxyXG4gICAgICAgIHBsYXllcnNPbmxpbmUsXHJcbiAgICAgICAgc29ja2V0c0Nvbm5lY3RlZCxcclxuICAgICAgICBzZWN1cmU6IHJlcS5zZWN1cmUgfHwgcmVxLmdldCgnWC1Gb3J3YXJkZWQtUHJvdG8nKSA9PT0gJ2h0dHBzJyxcclxuICAgICAgICBlbnZpcm9ubWVudDogcHJvY2Vzcy5lbnZbRU5WX1ZBUlMuTk9ERV9FTlZdIHx8IEVOVl9WQUxVRVMuREVWRUxPUE1FTlRcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuSU5URVJOQUxfU0VSVkVSX0VSUk9SKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHJldHJpZXZlIHNlcnZlciBzdGF0dXMnXHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gU2VjdXJpdHkgbW9uaXRvcmluZyBlbmRwb2ludHMgKHByb2R1Y3Rpb24gb25seSlcclxuaWYgKHByb2Nlc3MuZW52W0VOVl9WQVJTLk5PREVfRU5WXSA9PT0gRU5WX1ZBTFVFUy5QUk9EVUNUSU9OKSB7XHJcbiAgYXBwLmdldCgnL2FwaS9odHRwcy1oZWFsdGgnLCBodHRwc0hlYWx0aENoZWNrSGFuZGxlciBhcyBhbnkpO1xyXG4gIGFwcC5nZXQoJy9hcGkvdGxzLXNlY3VyaXR5JywgdGxzU2VjdXJpdHlTdGF0dXNIYW5kbGVyIGFzIGFueSk7XHJcbn1cclxuXHJcbi8vIFNlc3Npb24gaW52YWxpZGF0aW9uIG1pZGRsZXdhcmUgZm9yIGF1dGhlbnRpY2F0ZWQgcm91dGVzXHJcbmFwcC51c2UoJy9hcGkvZ2FtZScsIHNlc3Npb25JbnZhbGlkYXRpb25NaWRkbGV3YXJlKTtcclxuYXBwLnVzZShBUElfRU5EUE9JTlRTLlVOSVZFUlNFLkJBU0UsIHNlc3Npb25JbnZhbGlkYXRpb25NaWRkbGV3YXJlKTtcclxuYXBwLnVzZShBUElfRU5EUE9JTlRTLlNZTkMuQkFTRSwgc2Vzc2lvbkludmFsaWRhdGlvbk1pZGRsZXdhcmUpO1xyXG5hcHAudXNlKCcvYXBpL3NlY3VyaXR5Jywgc2Vzc2lvbkludmFsaWRhdGlvbk1pZGRsZXdhcmUpO1xyXG5hcHAudXNlKEFQSV9FTkRQT0lOVFMuTUVTU0FHRVMuQkFTRSwgc2Vzc2lvbkludmFsaWRhdGlvbk1pZGRsZXdhcmUpO1xyXG5cclxuLy8gQVBJIHJvdXRlc1xyXG5hcHAudXNlKCcvYXBpL2F1dGgnLCBhdXRoUm91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS9zZWN1cml0eScsIHNlY3VyaXR5Um91dGVzKTsgLy8gU2VjdXJpdHkgbW9uaXRvcmluZyBlbmRwb2ludHNcclxuLy8gTWFpbiBnYW1lIHJvdXRlc1xyXG5cclxuLy8gTWFpbiBnYW1lIHJvdXRlc1xyXG5hcHAudXNlKCcvYXBpL2dhbWUnLCBnYW1lUm91dGVzKTtcclxuXHJcbi8vIExlZ2FjeSBjb21wYXRpYmlsaXR5IHJvdXRlc1xyXG5hcHAudXNlKCcvYXBpL3RlY2gnLCB0ZWNoUm91dGVzKTsgIC8vIFNlcGFyYXRlIHJvdXRlciBmb3IgL2FwaS90ZWNoLyogYmFja3dhcmRzIGNvbXBhdGliaWxpdHlcclxuYXBwLnVzZShBUElfRU5EUE9JTlRTLlVOSVZFUlNFLkJBU0UsIHVuaXZlcnNlUm91dGVzKTtcclxuYXBwLnVzZShBUElfRU5EUE9JTlRTLlNZTkMuQkFTRSwgc3luY1JvdXRlcyk7XHJcbmFwcC51c2UoQVBJX0VORFBPSU5UUy5NRVNTQUdFUy5CQVNFLCBtZXNzYWdlUm91dGVzKTtcclxuLy8gVGVtcG9yYXJ5IGFsaWFzIHRvIG1hdGNoIGNsaWVudCBwYXRoIHdoaWxlIHdlIG1pZ3JhdGVcclxuYXBwLnVzZSgnL2FwaS9nYW1lL21lc3NhZ2VzJywgbWVzc2FnZVJvdXRlcyk7XHJcblxyXG4vLyBBZG1pbiBtYWludGVuYW5jZSByb3V0ZXMgKGd1YXJkZWQgYnkgQURNSU5fTUFJTlRFTkFOQ0VfU0VDUkVUKVxyXG5hcHAudXNlKEFQSV9FTkRQT0lOVFMuQURNSU4uQkFTRSwgYWRtaW5Sb3V0ZXMpO1xyXG5cclxuLy8gU29ja2V0LklPIHdpbGwgYmUgc2V0dXAgaW4gc3RhcnRTZXJ2ZXIoKSBmdW5jdGlvblxyXG5cclxuLy8gRXJyb3IgaGFuZGxpbmcgbWlkZGxld2FyZSAobXVzdCBiZSBsYXN0KVxyXG5hcHAudXNlKGVycm9ySGFuZGxlcik7XHJcblxyXG4vLyA0MDQgaGFuZGxlclxyXG5hcHAudXNlKCcqJywgKHJlcSwgcmVzKSA9PiB7XHJcbiAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpLmpzb24oeyBcclxuICAgIHN1Y2Nlc3M6IGZhbHNlLCBcclxuICAgIGVycm9yOiAnUm91dGUgbm90IGZvdW5kJyBcclxuICB9KTtcclxufSk7XHJcblxyXG4vLyBTdGFydCBzZXJ2ZXIgd2l0aCBIVFRQUyBzdXBwb3J0XHJcbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0U2VydmVyKCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBDb25uZWN0IHRvIGRhdGFiYXNlXHJcbiAgICBhd2FpdCBjb25uZWN0RGF0YWJhc2UoKTtcclxuXHJcbiAgICAvLyBOb3RlOiBEYXRhYmFzZSBpbml0aWFsaXphdGlvbiBjb21wbGV0ZSAtIHVzaW5nIFN1cGFiYXNlXHJcblxyXG4gICAgLy8gSW4gcHJvZHVjdGlvbiwgY2hlY2sgaWYgd2UgbmVlZCB0byBoYW5kbGUgU1NMIG91cnNlbHZlcyBvciBpZiBpdCdzIGhhbmRsZWQgYnkgcmV2ZXJzZSBwcm94eSAobGlrZSBSZW5kZXIpXHJcbiAgICBpZiAocHJvY2Vzcy5lbnZbRU5WX1ZBUlMuTk9ERV9FTlZdID09PSBFTlZfVkFMVUVTLlBST0RVQ1RJT04pIHtcclxuICAgICAgY29uc29sZS5sb2coJz8/IFByb2R1Y3Rpb24gbW9kZTogSFRUUFMgZW5mb3JjZW1lbnQgZW5hYmxlZCcpO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgaWYgU1NMIGlzIGhhbmRsZWQgYnkgcmV2ZXJzZSBwcm94eSAoUmVuZGVyLCBDbG91ZEZsYXJlLCBldGMuKVxyXG4gICAgICBjb25zdCB1c2VSZXZlcnNlUHJveHlTU0wgPSBpc1JldmVyc2VQcm94eVNTTCgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHVzZVJldmVyc2VQcm94eVNTTCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCc/PyBVc2luZyByZXZlcnNlIHByb3h5IFNTTCB0ZXJtaW5hdGlvbiAoUmVuZGVyL0Nsb3VkRmxhcmUvZXRjLiknKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnPyBTZXJ2ZXIgd2lsbCBydW4gSFRUUCAtIFNTTCBoYW5kbGVkIGJ5IHJldmVyc2UgcHJveHknKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBMb2FkIFNTTCBjb25maWd1cmF0aW9uIC0gdGhpcyB3aWxsIHRocm93IGlmIG5vdCBhdmFpbGFibGUgaW4gcHJvZHVjdGlvblxyXG4gICAgICAgIGNvbnN0IHNzbENvbmZpZyA9IGF3YWl0IGdldFNTTENvbmZpZ0Zyb21FbnZpcm9ubWVudCgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICghc3NsQ29uZmlnKSB7XHJcbiAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSAnSFRUUFMgaXMgbWFuZGF0b3J5IGluIHByb2R1Y3Rpb24gYnV0IFNTTCBjb25maWd1cmF0aW9uIGlzIG5vdCBhdmFpbGFibGUuICcgK1xyXG4gICAgICAgICAgICAnUGxlYXNlIHByb3ZpZGUgU1NMIGNlcnRpZmljYXRlcyB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVzIChTU0xfQ0VSVElGSUNBVEUsIFNTTF9QUklWQVRFX0tFWSkgJyArXHJcbiAgICAgICAgICAgICdvciBmaWxlIHBhdGhzIChTU0xfQ0VSVF9QQVRILCBTU0xfS0VZX1BBVEgpLiBPciBzZXQgVVNFX1JFVkVSU0VfUFJPWFlfU1NMPXRydWUgaWYgdXNpbmcgYSByZXZlcnNlIHByb3h5Lic7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCc/IFBST0RVQ1RJT04gU1RBUlRVUCBGQUlMRUQ6JywgZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYgKHVzZVJldmVyc2VQcm94eVNTTCkge1xyXG4gICAgICAgIC8vIFByb2R1Y3Rpb24gd2l0aCByZXZlcnNlIHByb3h5IFNTTDogUnVuIEhUVFAgc2VydmVyLCBTU0wgaGFuZGxlZCBieSByZXZlcnNlIHByb3h5XHJcbiAgICAgICAgaW8gPSBuZXcgU2VydmVyKHNlcnZlciwge1xyXG4gICAgICAgICAgY29yczoge1xyXG4gICAgICAgICAgICBvcmlnaW46IGFsbG93ZWRPcmlnaW5zLFxyXG4gICAgICAgICAgICBtZXRob2RzOiBbXCJHRVRcIiwgXCJQT1NUXCJdXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2VydmVyLmxpc3RlbihQT1JULCAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gUFJPRFVDVElPTiBzZXJ2ZXIgcnVubmluZyBvbiBwb3J0ICR7UE9SVH1gKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBIZWFsdGggY2hlY2s6IGh0dHA6Ly9sb2NhbGhvc3Q6JHtQT1JUfS9oZWFsdGhgKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBHYW1lIEFQSTogaHR0cDovL2xvY2FsaG9zdDoke1BPUlR9L2FwaWApO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYD8/IFNvY2tldC5JTyByZWFkeSBmb3IgY29ubmVjdGlvbnNgKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBTU0wvVExTOiBIYW5kbGVkIGJ5IHJldmVyc2UgcHJveHkgKFJlbmRlci9DbG91ZEZsYXJlL2V0Yy4pYCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPyBTRUNVUklUWTogSFRUUFMgZW5mb3JjZWQgYXQgcmV2ZXJzZSBwcm94eSBsZXZlbGApO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBTdGFydCBoeWJyaWQgZ2FtZSBsb29wIChwcm9kdWN0aW9uIGdhdGVkKVxyXG4gICAgICAgICAgY29uc3QgbG9vcEVuYWJsZWQgPSAocHJvY2Vzcy5lbnYuR0FNRV9MT09QX0VOQUJMRUQgPz8gJ2ZhbHNlJykudG9Mb3dlckNhc2UoKSAhPT0gJ2ZhbHNlJztcclxuICAgICAgICAgIGlmIChsb29wRW5hYmxlZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gU3RhcnRpbmcgSFlCUklEIGdhbWUgbG9vcCAocmVzcG9uc2l2ZSBjb21wbGV0aW9ucyArIGVmZmljaWVudCByZXNvdXJjZXMpYCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBDcmVkaXQgcGF5b3V0cyBldmVyeSAke3Byb2Nlc3MuZW52LkNSRURJVF9QQVlPVVRfUEVSSU9EX01JTlVURVMgfHwgJzEnfSBtaW51dGUocylgKTtcclxuICAgICAgICAgICAgaHlicmlkR2FtZUxvb3Auc3RhcnQoKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCc/PyBIWUJSSUQgZ2FtZSBsb29wIGRpc2FibGVkIChHQU1FX0xPT1BfRU5BQkxFRD1mYWxzZSknKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBzZXR1cFNvY2tldElPKGlvKTtcclxuICAgICAgICBpbml0U29ja2V0TWFuYWdlcihpbyk7IC8vIEluaXRpYWxpemUgc29ja2V0IG1hbmFnZXIgZm9yIGdsb2JhbCBhY2Nlc3NcclxuICAgICAgICBcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBQcm9kdWN0aW9uIHdpdGggZGlyZWN0IFNTTDogU3RhcnQgSFRUUFMgc2VydmVyIG9ubHlcclxuICAgICAgICBjb25zdCBzc2xDb25maWcgPSBhd2FpdCBnZXRTU0xDb25maWdGcm9tRW52aXJvbm1lbnQoKTtcclxuICAgICAgICBjb25zdCBodHRwc1NlcnZlciA9IGNyZWF0ZUh0dHBzU2VydmVyKGFwcCwgc3NsQ29uZmlnISwgSFRUUFNfUE9SVCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ3JlYXRlIFNvY2tldC5JTyBpbnN0YW5jZSBmb3IgSFRUUFMgc2VydmVyXHJcbiAgICAgICAgaW8gPSBuZXcgU2VydmVyKGh0dHBzU2VydmVyLCB7XHJcbiAgICAgICAgICBjb3JzOiB7XHJcbiAgICAgICAgICAgIG9yaWdpbjogYWxsb3dlZE9yaWdpbnMsXHJcbiAgICAgICAgICAgIG1ldGhvZHM6IFtcIkdFVFwiLCBcIlBPU1RcIl1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgSFRUUCBzZXJ2ZXIgT05MWSBmb3IgSFRUUFMgcmVkaXJlY3RzIC0gbm8gYWN0dWFsIEhUVFAgY29udGVudCBzZXJ2ZWRcclxuICAgICAgICBjb25zdCBodHRwUmVkaXJlY3RTZXJ2ZXIgPSBjcmVhdGVTZXJ2ZXIoYXBwKTtcclxuICAgICAgICBodHRwUmVkaXJlY3RTZXJ2ZXIubGlzdGVuKFBPUlQsICgpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBIVFRQIHJlZGlyZWN0IHNlcnZlciBvbiBwb3J0ICR7UE9SVH0gKHJlZGlyZWN0cyBhbGwgdHJhZmZpYyB0byBIVFRQUylgKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyAgSFRUUCBzZXJ2ZXIgc2VydmVzIE5PIGNvbnRlbnQgLSBhbGwgcmVxdWVzdHMgcmVkaXJlY3RlZCB0byBIVFRQU2ApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEhUVFBTIHNlcnZlciBzdGFydHVwIHdpdGggZW5oYW5jZWQgbG9nZ2luZ1xyXG4gICAgICAgIGh0dHBzU2VydmVyLmxpc3RlbihIVFRQU19QT1JULCAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gUFJPRFVDVElPTiBIVFRQUyBzZXJ2ZXIgcnVubmluZyBvbiBwb3J0ICR7SFRUUFNfUE9SVH1gKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBIZWFsdGggY2hlY2s6IGh0dHBzOi8vbG9jYWxob3N0OiR7SFRUUFNfUE9SVH0vaGVhbHRoYCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gR2FtZSBBUEk6IGh0dHBzOi8vbG9jYWxob3N0OiR7SFRUUFNfUE9SVH0vYXBpYCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gU29ja2V0LklPIHJlYWR5IGZvciBzZWN1cmUgY29ubmVjdGlvbnNgKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBTU0wvVExTOiAke3NzbENvbmZpZyEubWluVmVyc2lvbn0gdG8gJHtzc2xDb25maWchLm1heFZlcnNpb259YCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPyBIVFRQUyBFTkZPUkNFTUVOVDogQWxsIEhUVFAgcmVxdWVzdHMgcmVkaXJlY3RlZCB0byBIVFRQU2ApO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYD8gU0VDVVJJVFk6IFByb2R1Y3Rpb24gc2VydmVyIHJ1bm5pbmcgaW4gSFRUUFMtb25seSBtb2RlYCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIFN0YXJ0IGh5YnJpZCBnYW1lIGxvb3AgKHByb2R1Y3Rpb24gZ2F0ZWQpXHJcbiAgICAgICAgICBjb25zdCBsb29wRW5hYmxlZCA9IChwcm9jZXNzLmVudi5HQU1FX0xPT1BfRU5BQkxFRCA/PyAnZmFsc2UnKS50b0xvd2VyQ2FzZSgpICE9PSAnZmFsc2UnO1xyXG4gICAgICAgICAgaWYgKGxvb3BFbmFibGVkKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBTdGFydGluZyBIWUJSSUQgZ2FtZSBsb29wIChyZXNwb25zaXZlIGNvbXBsZXRpb25zICsgZWZmaWNpZW50IHJlc291cmNlcylgKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYD8/IENyZWRpdCBwYXlvdXRzIGV2ZXJ5ICR7cHJvY2Vzcy5lbnYuQ1JFRElUX1BBWU9VVF9QRVJJT0RfTUlOVVRFUyB8fCAnMSd9IG1pbnV0ZShzKWApO1xyXG4gICAgICAgICAgICBoeWJyaWRHYW1lTG9vcC5zdGFydCgpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJz8/IEhZQlJJRCBnYW1lIGxvb3AgZGlzYWJsZWQgKEdBTUVfTE9PUF9FTkFCTEVEPWZhbHNlKScpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBTZXR1cCBTb2NrZXQuSU8gb24gSFRUUFMgc2VydmVyXHJcbiAgICAgIHNldHVwU29ja2V0SU8oaW8pO1xyXG4gICAgICBpbml0U29ja2V0TWFuYWdlcihpbyk7IC8vIEluaXRpYWxpemUgc29ja2V0IG1hbmFnZXIgZm9yIGdsb2JhbCBhY2Nlc3NcclxuICAgICAgXHJcbiAgICAgIC8vIFN0YXJ0IEhUVFBTIGhlYWx0aCBtb25pdG9yaW5nIGluIHByb2R1Y3Rpb24gT05MWSB3aGVuIG5vdCB1c2luZyByZXZlcnNlIHByb3h5IFNTTFxyXG4gICAgICBpZiAodXNlUmV2ZXJzZVByb3h5U1NMKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJz8/IEhUVFBTIGhlYWx0aCBtb25pdG9yaW5nIGRpc2FibGVkOiByZXZlcnNlIHByb3h5IFNTTCB0ZXJtaW5hdGlvbiBkZXRlY3RlZCAoZS5nLiwgUmVuZGVyKScpO1xyXG4gICAgICB9IGVsc2UgaWYgKHNob3VsZFN0YXJ0SHR0cHNIZWFsdGhNb25pdG9yKGZhbHNlKSkge1xyXG4gICAgICAgIGh0dHBzSGVhbHRoTW9uaXRvciA9IG5ldyBIdHRwc0hlYWx0aE1vbml0b3IoSFRUUFNfUE9SVCwgUE9SVCwgJ2xvY2FsaG9zdCcpO1xyXG4gICAgICAgIGNvbnN0IG1vbml0b3JpbmdJbnRlcnZhbCA9IHBhcnNlSW50KHByb2Nlc3MuZW52W0VOVl9WQVJTLkhUVFBTX0hFQUxUSF9DSEVDS19JTlRFUlZBTF9NSU5VVEVTXSB8fCAnNjAnLCAxMCk7XHJcbiAgICAgICAgaHR0cHNIZWFsdGhNb25pdG9yLnN0YXJ0KG1vbml0b3JpbmdJbnRlcnZhbCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYD8/IEhUVFBTIGhlYWx0aCBtb25pdG9yaW5nIHN0YXJ0ZWQgKGV2ZXJ5ICR7bW9uaXRvcmluZ0ludGVydmFsfSBtaW51dGVzKWApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gRGV2ZWxvcG1lbnQvVGVzdDogSFRUUCBzZXJ2ZXIgd2l0aCBvcHRpb25hbCBIVFRQU1xyXG4gICAgICBjb25zb2xlLmxvZyhgPz8gRGV2ZWxvcG1lbnQgbW9kZTogSFRUUCBzZXJ2ZXIgZW5hYmxlZGApO1xyXG4gICAgICBcclxuICAgICAgY29uc3Qgc3NsQ29uZmlnID0gYXdhaXQgZ2V0U1NMQ29uZmlnRnJvbUVudmlyb25tZW50KCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoc3NsQ29uZmlnICYmIHByb2Nlc3MuZW52W0VOVl9WQVJTLkZPUkNFX0hUVFBTXSA9PT0gJ3RydWUnKSB7XHJcbiAgICAgICAgLy8gRGV2ZWxvcG1lbnQgd2l0aCBIVFRQUyAoZm9yIHRlc3RpbmcgSFRUUFMgYmVoYXZpb3IpXHJcbiAgICAgICAgY29uc29sZS5sb2coJz8/IERldmVsb3BtZW50IEhUVFBTIG1vZGUgZW5hYmxlZCAoRk9SQ0VfSFRUUFM9dHJ1ZSknKTtcclxuICAgICAgICBjb25zdCBodHRwc1NlcnZlciA9IGNyZWF0ZUh0dHBzU2VydmVyKGFwcCwgc3NsQ29uZmlnLCBIVFRQU19QT1JUKTtcclxuICAgICAgICBcclxuICAgICAgICBpbyA9IG5ldyBTZXJ2ZXIoaHR0cHNTZXJ2ZXIsIHtcclxuICAgICAgICAgIGNvcnM6IHtcclxuICAgICAgICAgICAgb3JpZ2luOiBhbGxvd2VkT3JpZ2lucyxcclxuICAgICAgICAgICAgbWV0aG9kczogW1wiR0VUXCIsIFwiUE9TVFwiXVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEFsc28gcnVuIEhUVFAgc2VydmVyIGZvciBkZXZlbG9wbWVudCBjb252ZW5pZW5jZVxyXG4gICAgICAgIHNlcnZlci5saXN0ZW4oUE9SVCwgKCkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYD8/IEhUVFAgc2VydmVyIG9uIHBvcnQgJHtQT1JUfSAocmVkaXJlY3RzIHRvIEhUVFBTKWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGh0dHBzU2VydmVyLmxpc3RlbihIVFRQU19QT1JULCAoKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gRGV2ZWxvcG1lbnQgSFRUUFMgc2VydmVyIG9uIHBvcnQgJHtIVFRQU19QT1JUfWApO1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYD8/IEhlYWx0aCBjaGVjazogaHR0cHM6Ly9sb2NhbGhvc3Q6JHtIVFRQU19QT1JUfS9oZWFsdGhgKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBHYW1lIEFQSTogaHR0cHM6Ly9sb2NhbGhvc3Q6JHtIVFRQU19QT1JUfS9hcGlgKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBTb2NrZXQuSU8gcmVhZHkgZm9yIHNlY3VyZSBjb25uZWN0aW9uc2ApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNldHVwU29ja2V0SU8oaW8pO1xyXG4gICAgICAgIGluaXRTb2NrZXRNYW5hZ2VyKGlvKTsgLy8gSW5pdGlhbGl6ZSBzb2NrZXQgbWFuYWdlciBmb3IgZ2xvYmFsIGFjY2Vzc1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIFN0YW5kYXJkIGRldmVsb3BtZW50OiBIVFRQIG9ubHlcclxuICAgICAgICBpbyA9IG5ldyBTZXJ2ZXIoc2VydmVyLCB7XHJcbiAgICAgICAgICBjb3JzOiB7XHJcbiAgICAgICAgICAgIG9yaWdpbjogKG9yaWdpbiwgY2FsbGJhY2spID0+IHtcclxuICAgICAgICAgICAgICAvLyBBbGxvdyBudWxsIG9yaWdpbiAoZmlsZTovLykgYW5kIGxvY2FsaG9zdCBvcmlnaW5zXHJcbiAgICAgICAgICAgICAgaWYgKCFvcmlnaW4gfHwgb3JpZ2luID09PSAnbnVsbCcgfHwgYWxsb3dlZE9yaWdpbnMuaW5jbHVkZXMob3JpZ2luKSkge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcignTm90IGFsbG93ZWQgYnkgQ09SUycpKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1ldGhvZHM6IFtcIkdFVFwiLCBcIlBPU1RcIl0sXHJcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiBmYWxzZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNlcnZlci5saXN0ZW4oUE9SVCwgKCkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYD8/IERldmVsb3BtZW50IEhUVFAgc2VydmVyIHJ1bm5pbmcgb24gcG9ydCAke1BPUlR9YCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gSGVhbHRoIGNoZWNrOiBodHRwOi8vbG9jYWxob3N0OiR7UE9SVH0vaGVhbHRoYCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gR2FtZSBBUEk6IGh0dHA6Ly9sb2NhbGhvc3Q6JHtQT1JUfS9hcGlgKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGA/PyBTb2NrZXQuSU8gcmVhZHkgZm9yIGNvbm5lY3Rpb25zYCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhgPz8gIERldmVsb3BtZW50IG1vZGU6IEhUVFBTIGVuZm9yY2VtZW50IGRpc2FibGVkYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2V0dXBTb2NrZXRJTyhpbyk7XHJcbiAgICAgICAgaW5pdFNvY2tldE1hbmFnZXIoaW8pOyAvLyBJbml0aWFsaXplIHNvY2tldCBtYW5hZ2VyIGZvciBnbG9iYWwgYWNjZXNzXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIFN0YXJ0IGh5YnJpZCBnYW1lIGxvb3AgZm9yIGRldmVsb3BtZW50IChlbmFibGVkIGJ5IGRlZmF1bHQpXHJcbiAgICAgIGNvbnN0IGRldkxvb3BFbmFibGVkID0gKHByb2Nlc3MuZW52LkdBTUVfTE9PUF9FTkFCTEVEID8/ICd0cnVlJykudG9Mb3dlckNhc2UoKSAhPT0gJ2ZhbHNlJztcclxuICAgICAgaWYgKGRldkxvb3BFbmFibGVkKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYD8/IFN0YXJ0aW5nIEhZQlJJRCBnYW1lIGxvb3AgKHJlc3BvbnNpdmUgY29tcGxldGlvbnMgKyBlZmZpY2llbnQgcmVzb3VyY2VzKWApO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGA/PyBDcmVkaXQgcGF5b3V0cyBldmVyeSAke3Byb2Nlc3MuZW52LkNSRURJVF9QQVlPVVRfUEVSSU9EX01JTlVURVMgfHwgJzEnfSBtaW51dGUocylgKTtcclxuICAgICAgICBoeWJyaWRHYW1lTG9vcC5zdGFydCgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCc/PyBIWUJSSUQgZ2FtZSBsb29wIGRpc2FibGVkIChHQU1FX0xPT1BfRU5BQkxFRD1mYWxzZSknKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJz8gRmFpbGVkIHRvIHN0YXJ0IHNlcnZlcjonLCBlcnJvcik7XHJcbiAgICBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBIYW5kbGUgZ3JhY2VmdWwgc2h1dGRvd24gd2l0aCB0aW1lb3V0XHJcbmxldCBpc1NodXR0aW5nRG93biA9IGZhbHNlO1xyXG5jb25zdCBTSFVURE9XTl9USU1FT1VUID0gNTAwMDsgLy8gNSBzZWNvbmRzXHJcblxyXG5mdW5jdGlvbiBzaHV0ZG93bigpIHtcclxuICBpZiAoaXNTaHV0dGluZ0Rvd24pIHtcclxuICAgIGNvbnNvbGUubG9nKCc/PyBTaHV0ZG93biBhbHJlYWR5IGluIHByb2dyZXNzJyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIFxyXG4gIGlzU2h1dHRpbmdEb3duID0gdHJ1ZTtcclxuIGNvbnNvbGUubG9nKCc/PyBTaHV0ZG93biBzaWduYWwgcmVjZWl2ZWQsIHNodXR0aW5nIGRvd24gZ3JhY2VmdWxseScpO1xyXG4gIFxyXG4gIC8vIFN0b3AgaHlicmlkIGdhbWUgbG9vcFxyXG4gIHRyeSB7XHJcbiAgICBoeWJyaWRHYW1lTG9vcC5zdG9wKCk7XHJcbiAgICBjb25zb2xlLmxvZygnPz8gR2FtZSBsb29wIHN0b3BwZWQnKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RvcHBpbmcgaHlicmlkIGdhbWUgbG9vcDonLCBlcnJvcik7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIFN0b3AgSFRUUFMgaGVhbHRoIG1vbml0b3JcclxuICBpZiAoaHR0cHNIZWFsdGhNb25pdG9yKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBodHRwc0hlYWx0aE1vbml0b3Iuc3RvcCgpO1xyXG4gICAgICBjb25zb2xlLmxvZygnPz8gSFRUUFMgaGVhbHRoIG1vbml0b3Igc3RvcHBlZCcpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RvcHBpbmcgSFRUUFMgaGVhbHRoIG1vbml0b3I6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAvLyBDbG9zZSBzZXJ2ZXIgd2l0aCB0aW1lb3V0XHJcbiAgY29uc3Qgc2h1dGRvd25UaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJz8gU2h1dGRvd24gdGltZW91dCByZWFjaGVkLCBmb3JjZSBjbG9zaW5nJyk7XHJcbiAgICBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgfSwgU0hVVERPV05fVElNRU9VVCk7XHJcbiAgXHJcbiAgc2VydmVyLmNsb3NlKCgpID0+IHtcclxuICAgIGNsZWFyVGltZW91dChzaHV0ZG93blRpbWVyKTtcclxuICAgIGNvbnNvbGUubG9nKCc/IEhUVFAgc2VydmVyIGNsb3NlZCcpO1xyXG4gICAgXHJcbiAgICAvLyBDbG9zZSBkYXRhYmFzZSBjb25uZWN0aW9uc1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQWRkIGFueSBkYXRhYmFzZSBjbGVhbnVwIGhlcmUgaWYgbmVlZGVkXHJcbiAgICAgIGNvbnNvbGUubG9nKCc/PyBEYXRhYmFzZSBjb25uZWN0aW9ucyBjbG9zZWQnKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNsb3NpbmcgZGF0YWJhc2UgY29ubmVjdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnPyBQcm9jZXNzIHRlcm1pbmF0ZWQgZ3JhY2VmdWxseScpO1xyXG4gICAgcHJvY2Vzcy5leGl0KDApO1xyXG4gIH0pO1xyXG4gIFxyXG4gIC8vIElmIHNlcnZlciBkb2Vzbid0IGNsb3NlIHdpdGhpbiB0aW1lb3V0LCBmb3JjZSBleGl0XHJcbiAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnPyBGb3JjZSBjbG9zaW5nIHJlbWFpbmluZyBjb25uZWN0aW9ucycpO1xyXG4gICAgcHJvY2Vzcy5leGl0KDApO1xyXG4gIH0sIFNIVVRET1dOX1RJTUVPVVQgKyAxMDAwKTtcclxufVxyXG5cclxuLy8gSGFuZGxlIGdyYWNlZnVsIHNodXRkb3duXHJcbnByb2Nlc3Mub24oJ1NJR1RFUk0nLCAoKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJz8/IFNJR1RFUk0gcmVjZWl2ZWQnKTtcclxuICBzaHV0ZG93bigpO1xyXG59KTtcclxuXHJcbnByb2Nlc3Mub24oJ1NJR0lOVCcsICgpID0+IHtcclxuICBjb25zb2xlLmxvZygnPz8gU0lHSU5UIHJlY2VpdmVkJyk7XHJcbiAgc2h1dGRvd24oKTtcclxufSk7XHJcblxyXG4vLyBIYW5kbGUgdW5jYXVnaHQgZXhjZXB0aW9uc1xyXG5wcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnJvcikgPT4ge1xyXG4gIGNvbnNvbGUuZXJyb3IoJz8/IFVuY2F1Z2h0IEV4Y2VwdGlvbjonLCBlcnJvcik7XHJcbiAgc2h1dGRvd24oKTtcclxufSk7XHJcblxyXG5wcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAocmVhc29uLCBwcm9taXNlKSA9PiB7XHJcbiAgY29uc29sZS5lcnJvcignPz8gVW5oYW5kbGVkIFJlamVjdGlvbiBhdDonLCBwcm9taXNlLCAncmVhc29uOicsIHJlYXNvbik7XHJcbiAgc2h1dGRvd24oKTtcclxufSk7XHJcblxyXG5pZiAoKHByb2Nlc3MuZW52W0VOVl9WQVJTLk5PREVfRU5WXSB8fCAnJykudG9Mb3dlckNhc2UoKSAhPT0gJ3Rlc3QnKSB7XHJcbiAgc3RhcnRTZXJ2ZXIoKTtcclxufVxyXG5cclxuZXhwb3J0IHsgYXBwLCBpbyB9O1xyXG5cclxuXHJcblxyXG5cclxuIl0sInZlcnNpb24iOjN9
{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\index.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\index.ts"],"sourcesContent":["import express from 'express';\r\nimport cors from 'cors';\r\nimport rateLimit from 'express-rate-limit';\r\nimport dotenv from 'dotenv';\r\nimport { createServer } from 'http';\r\nimport { connectDatabase } from './config/database';\r\nimport { getSSLConfigFromEnvironment, createHttpsServer } from './config/ssl';\r\nimport authRoutes from './routes/auth';\r\nimport gameRoutes from './routes/game';\r\nimport universeRoutes from './routes/universe';\r\nimport syncRoutes from './routes/sync';\r\nimport messageRoutes from './routes/messages';\r\nimport { errorHandler } from './middleware/errorHandler';\r\nimport { sessionInvalidationMiddleware } from './middleware/sessionInvalidation';\r\nimport securityHeadersStack from './middleware/securityHeaders';\r\nimport { httpsRedirectMiddleware, httpsSecurityHeadersMiddleware } from './middleware/httpsRedirect';\r\nimport { tlsMonitoringMiddleware, tlsSecurityStatusHandler } from './utils/tlsValidator';\r\nimport { setupSocketIO, getOnlineUniqueUsersCount } from './services/socketService';\r\nimport { hybridGameLoop } from './services/hybridGameLoopService';\r\nimport { httpsHealthCheckHandler, HttpsHealthMonitor, shouldStartHttpsHealthMonitor } from './utils/httpsHealthCheck';\r\nimport { initSocketManager } from './utils/socketManager';\r\nimport securityRoutes from './routes/security';\r\nimport adminRoutes from './routes/admin';\r\nimport { HTTP_STATUS } from './constants/response-formats';\r\nimport { API_ENDPOINTS } from './constants/api-endpoints';\r\nimport techRoutes from './routes/tech';\r\nimport { Server } from 'socket.io';\r\nimport { initLogger } from './utils/logger';\r\nimport { isReverseProxySSL } from './utils/runtimeEnv';\r\nimport { ENV_VARS, ENV_VALUES } from '@game/shared';\r\n\r\n\r\n\r\n// Load environment variables\r\ndotenv.config();\r\n\r\n// Initialize logger (optional console patch)\r\ninitLogger();\r\n\r\nconst allowedOrigins = process.env[ENV_VARS.CORS_ORIGIN]\r\n  ? process.env[ENV_VARS.CORS_ORIGIN]!.split(',').map(o => o.trim()).filter(Boolean)\r\n  : [\"http://localhost:5173\", \"http://localhost:5174\", \"null\", \"file://\"];\r\n\r\nconst app: express.Application = express();\r\napp.set('trust proxy', 1);\r\nconst server = createServer(app);\r\n\r\n// Socket.IO will be initialized later with proper server (HTTP or HTTPS)\r\nlet io: Server;\r\n\r\n// Expose IO getter for other services to broadcast events safely\r\nexport function getIO(): Server | undefined {\r\n  return io;\r\n}\r\n\r\n// HTTPS health monitoring (production only)\r\nlet httpsHealthMonitor: HttpsHealthMonitor | null = null;\r\n\r\nconst PORT = parseInt(process.env[ENV_VARS.PORT] || '3001', 10);\r\nconst HTTPS_PORT = parseInt(process.env[ENV_VARS.HTTPS_PORT] || '443', 10);\r\n\r\n// HTTPS enforcement - redirect HTTP to HTTPS in production\r\napp.use(httpsRedirectMiddleware);\r\n\r\n// Security middleware - comprehensive OWASP-compliant headers\r\nconst isDevelopment = process.env[ENV_VARS.NODE_ENV] === ENV_VALUES.DEVELOPMENT;\r\napp.use(...securityHeadersStack(isDevelopment));\r\n\r\n// Additional HTTPS security headers\r\napp.use(httpsSecurityHeadersMiddleware);\r\n\r\n// TLS connection monitoring (for HTTPS connections)\r\napp.use(tlsMonitoringMiddleware as any);\r\n\r\n// CORS configuration (after security headers)\r\napp.use(cors({\r\n  origin: allowedOrigins,\r\n  credentials: true\r\n}));\r\n\r\n/**\r\n * Rate limiting\r\n * - Production-safe defaults\r\n * - Development-safe behavior via env toggles\r\n * - Skip CORS preflight (OPTIONS) and the public status endpoint\r\n * - Optional: dev-only skip for /api/auth/*\r\n */\r\nconst RATE_LIMIT_ENABLED = ((process.env[ENV_VARS.RATE_LIMIT_ENABLED] ?? 'true').toLowerCase() !== 'false');\r\n\r\nconst limiter = rateLimit({\r\n  windowMs: parseInt(process.env[ENV_VARS.RATE_LIMIT_WINDOW_MS] || '900000', 10), // default 15 minutes\r\n  max: parseInt(\r\n    process.env[ENV_VARS.RATE_LIMIT_MAX_REQUESTS] ||\r\n    process.env[ENV_VARS.NODE_ENV] === ENV_VALUES.DEVELOPMENT ? '2000' : '100',\r\n    10\r\n  ),\r\n  message: 'Too many requests from this IP, please try again later.',\r\n  standardHeaders: true,\r\n  legacyHeaders: false,\r\n  skip: (req) =>\r\n    // Do not count CORS preflights\r\n    req.method === 'OPTIONS' ||\r\n    // Public status endpoint\r\n    req.path === API_ENDPOINTS.SYSTEM.STATUS ||\r\n    // Dev-only skips\r\n    (\r\n      process.env[ENV_VARS.NODE_ENV] === ENV_VALUES.DEVELOPMENT && (\r\n        // Allow skipping auth endpoints during dev\r\n        (process.env[ENV_VARS.RATE_LIMIT_SKIP_AUTH] === 'true' && req.path.startsWith('/api/auth/')) ||\r\n        // Allow skipping heavy game/universe endpoints during dev bursts\r\n        (process.env[ENV_VARS.RATE_LIMIT_SKIP_GAME] === 'true' && (req.path.startsWith('/api/game') || req.path.startsWith(API_ENDPOINTS.UNIVERSE.BASE)))\r\n      )\r\n    )\r\n});\r\n\r\n/**\r\n * In development, disable the HTTP rate limiter entirely to allow unlimited requests.\r\n * Keep limiter active only in production deployments.\r\n */\r\nif (RATE_LIMIT_ENABLED && process.env[ENV_VARS.NODE_ENV] !== ENV_VALUES.DEVELOPMENT) {\r\n  app.use(limiter);\r\n}\r\n\r\n// Body parsing middleware\r\napp.use(express.json({ limit: '10mb' }));\r\napp.use(express.urlencoded({ extended: true }));\r\n\r\nconst serverStart = Date.now(); // nodemon:restart v4 - admin endpoint added\r\n\r\n// Health check endpoint\r\napp.get(API_ENDPOINTS.SYSTEM.HEALTH, (req, res) => {\r\n  res.json({ \r\n    status: 'OK', \r\n    timestamp: new Date().toISOString(),\r\n    server: 'Attrition API',\r\n    version: '1.0.0'\r\n  });\r\n});\r\n\r\n// Public server status endpoint with temporary trace logging\r\napp.use(API_ENDPOINTS.SYSTEM.STATUS, (req, res, next) => {\r\n  const start = Date.now();\r\n  res.on('finish', () => {\r\n    try {\r\n      console.log('[TRACE] /api/status', {\r\n        method: req.method,\r\n        status: res.statusCode,\r\n        ua: req.get('User-Agent') || 'unknown',\r\n        ip: req.ip,\r\n        xff: req.get('X-Forwarded-For') || undefined,\r\n        proto: req.get('X-Forwarded-Proto') || (req.secure ? 'https' : 'http'),\r\n        durationMs: Date.now() - start,\r\n      });\r\n    } catch {}\r\n  });\r\n  next();\r\n});\r\napp.get(API_ENDPOINTS.SYSTEM.STATUS, (req, res) => {\r\n  try {\r\n    const uptimeSeconds = Math.floor((Date.now() - serverStart) / 1000);\r\n    const socketsConnected = io ? io.of('/').sockets.size : 0;\r\n    const playersOnline = getOnlineUniqueUsersCount();\r\n\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        status: 'OK',\r\n        version: '1.0.0',\r\n        startedAt: new Date(serverStart).toISOString(),\r\n        uptimeSeconds,\r\n        playersOnline,\r\n        socketsConnected,\r\n        secure: req.secure || req.get('X-Forwarded-Proto') === 'https',\r\n        environment: process.env[ENV_VARS.NODE_ENV] || ENV_VALUES.DEVELOPMENT\r\n      }\r\n    });\r\n  } catch (error) {\r\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\r\n      success: false,\r\n      error: 'Failed to retrieve server status'\r\n    });\r\n  }\r\n});\r\n\r\n// Security monitoring endpoints (production only)\r\nif (process.env[ENV_VARS.NODE_ENV] === ENV_VALUES.PRODUCTION) {\r\n  app.get('/api/https-health', httpsHealthCheckHandler as any);\r\n  app.get('/api/tls-security', tlsSecurityStatusHandler as any);\r\n}\r\n\r\n// Session invalidation middleware for authenticated routes\r\napp.use('/api/game', sessionInvalidationMiddleware);\r\napp.use(API_ENDPOINTS.UNIVERSE.BASE, sessionInvalidationMiddleware);\r\napp.use(API_ENDPOINTS.SYNC.BASE, sessionInvalidationMiddleware);\r\napp.use('/api/security', sessionInvalidationMiddleware);\r\napp.use(API_ENDPOINTS.MESSAGES.BASE, sessionInvalidationMiddleware);\r\n\r\n// API routes\r\napp.use('/api/auth', authRoutes);\r\napp.use('/api/security', securityRoutes); // Security monitoring endpoints\r\n// Main game routes\r\n\r\n// Main game routes\r\napp.use('/api/game', gameRoutes);\r\n\r\n// Legacy compatibility routes\r\napp.use('/api/tech', techRoutes);  // Separate router for /api/tech/* backwards compatibility\r\napp.use(API_ENDPOINTS.UNIVERSE.BASE, universeRoutes);\r\napp.use(API_ENDPOINTS.SYNC.BASE, syncRoutes);\r\napp.use(API_ENDPOINTS.MESSAGES.BASE, messageRoutes);\r\n// Temporary alias to match client path while we migrate\r\napp.use('/api/game/messages', messageRoutes);\r\n\r\n// Admin maintenance routes (guarded by ADMIN_MAINTENANCE_SECRET)\r\napp.use(API_ENDPOINTS.ADMIN.BASE, adminRoutes);\r\n\r\n// Socket.IO will be setup in startServer() function\r\n\r\n// Error handling middleware (must be last)\r\napp.use(errorHandler);\r\n\r\n// 404 handler\r\napp.use('*', (req, res) => {\r\n  res.status(HTTP_STATUS.NOT_FOUND).json({ \r\n    success: false, \r\n    error: 'Route not found' \r\n  });\r\n});\r\n\r\n// Start server with HTTPS support\r\nasync function startServer() {\r\n  try {\r\n    // Connect to database\r\n    await connectDatabase();\r\n\r\n    // Note: Database initialization complete - using Supabase\r\n\r\n    // In production, check if we need to handle SSL ourselves or if it's handled by reverse proxy (like Render)\r\n    if (process.env[ENV_VARS.NODE_ENV] === ENV_VALUES.PRODUCTION) {\r\n      console.log('?? Production mode: HTTPS enforcement enabled');\r\n      \r\n      // Check if SSL is handled by reverse proxy (Render, CloudFlare, etc.)\r\n      const useReverseProxySSL = isReverseProxySSL();\r\n      \r\n      if (useReverseProxySSL) {\r\n        console.log('?? Using reverse proxy SSL termination (Render/CloudFlare/etc.)');\r\n        console.log('? Server will run HTTP - SSL handled by reverse proxy');\r\n      } else {\r\n        // Load SSL configuration - this will throw if not available in production\r\n        const sslConfig = await getSSLConfigFromEnvironment();\r\n        \r\n        if (!sslConfig) {\r\n          const errorMessage = 'HTTPS is mandatory in production but SSL configuration is not available. ' +\r\n            'Please provide SSL certificates via environment variables (SSL_CERTIFICATE, SSL_PRIVATE_KEY) ' +\r\n            'or file paths (SSL_CERT_PATH, SSL_KEY_PATH). Or set USE_REVERSE_PROXY_SSL=true if using a reverse proxy.';\r\n          console.error('? PRODUCTION STARTUP FAILED:', errorMessage);\r\n          throw new Error(errorMessage);\r\n        }\r\n      }\r\n      \r\n      if (useReverseProxySSL) {\r\n        // Production with reverse proxy SSL: Run HTTP server, SSL handled by reverse proxy\r\n        io = new Server(server, {\r\n          cors: {\r\n            origin: allowedOrigins,\r\n            methods: [\"GET\", \"POST\"]\r\n          }\r\n        });\r\n        \r\n        server.listen(PORT, () => {\r\n          console.log(`?? PRODUCTION server running on port ${PORT}`);\r\n          console.log(`?? Health check: http://localhost:${PORT}/health`);\r\n          console.log(`?? Game API: http://localhost:${PORT}/api`);\r\n          console.log(`?? Socket.IO ready for connections`);\r\n          console.log(`?? SSL/TLS: Handled by reverse proxy (Render/CloudFlare/etc.)`);\r\n          console.log(`? SECURITY: HTTPS enforced at reverse proxy level`);\r\n          \r\n          // Start hybrid game loop (production gated)\r\n          const loopEnabled = (process.env.GAME_LOOP_ENABLED ?? 'false').toLowerCase() !== 'false';\r\n          if (loopEnabled) {\r\n            console.log(`?? Starting HYBRID game loop (responsive completions + efficient resources)`);\r\n            console.log(`?? Credit payouts every ${process.env.CREDIT_PAYOUT_PERIOD_MINUTES || '1'} minute(s)`);\r\n            hybridGameLoop.start();\r\n          } else {\r\n            console.log('?? HYBRID game loop disabled (GAME_LOOP_ENABLED=false)');\r\n          }\r\n        });\r\n        \r\n        setupSocketIO(io);\r\n        initSocketManager(io); // Initialize socket manager for global access\r\n        \r\n      } else {\r\n        // Production with direct SSL: Start HTTPS server only\r\n        const sslConfig = await getSSLConfigFromEnvironment();\r\n        const httpsServer = createHttpsServer(app, sslConfig!, HTTPS_PORT);\r\n        \r\n        // Create Socket.IO instance for HTTPS server\r\n        io = new Server(httpsServer, {\r\n          cors: {\r\n            origin: allowedOrigins,\r\n            methods: [\"GET\", \"POST\"]\r\n          }\r\n        });\r\n        \r\n        // Create HTTP server ONLY for HTTPS redirects - no actual HTTP content served\r\n        const httpRedirectServer = createServer(app);\r\n        httpRedirectServer.listen(PORT, () => {\r\n          console.log(`?? HTTP redirect server on port ${PORT} (redirects all traffic to HTTPS)`);\r\n          console.log(`??  HTTP server serves NO content - all requests redirected to HTTPS`);\r\n        });\r\n        \r\n        // HTTPS server startup with enhanced logging\r\n        httpsServer.listen(HTTPS_PORT, () => {\r\n          console.log(`?? PRODUCTION HTTPS server running on port ${HTTPS_PORT}`);\r\n          console.log(`?? Health check: https://localhost:${HTTPS_PORT}/health`);\r\n          console.log(`?? Game API: https://localhost:${HTTPS_PORT}/api`);\r\n          console.log(`?? Socket.IO ready for secure connections`);\r\n          console.log(`?? SSL/TLS: ${sslConfig!.minVersion} to ${sslConfig!.maxVersion}`);\r\n          console.log(`? HTTPS ENFORCEMENT: All HTTP requests redirected to HTTPS`);\r\n          console.log(`? SECURITY: Production server running in HTTPS-only mode`);\r\n          \r\n          // Start hybrid game loop (production gated)\r\n          const loopEnabled = (process.env.GAME_LOOP_ENABLED ?? 'false').toLowerCase() !== 'false';\r\n          if (loopEnabled) {\r\n            console.log(`?? Starting HYBRID game loop (responsive completions + efficient resources)`);\r\n            console.log(`?? Credit payouts every ${process.env.CREDIT_PAYOUT_PERIOD_MINUTES || '1'} minute(s)`);\r\n            hybridGameLoop.start();\r\n          } else {\r\n            console.log('?? HYBRID game loop disabled (GAME_LOOP_ENABLED=false)');\r\n          }\r\n        });\r\n      }\r\n      \r\n      // Setup Socket.IO on HTTPS server\r\n      setupSocketIO(io);\r\n      initSocketManager(io); // Initialize socket manager for global access\r\n      \r\n      // Start HTTPS health monitoring in production ONLY when not using reverse proxy SSL\r\n      if (useReverseProxySSL) {\r\n        console.log('?? HTTPS health monitoring disabled: reverse proxy SSL termination detected (e.g., Render)');\r\n      } else if (shouldStartHttpsHealthMonitor(false)) {\r\n        httpsHealthMonitor = new HttpsHealthMonitor(HTTPS_PORT, PORT, 'localhost');\r\n        const monitoringInterval = parseInt(process.env[ENV_VARS.HTTPS_HEALTH_CHECK_INTERVAL_MINUTES] || '60', 10);\r\n        httpsHealthMonitor.start(monitoringInterval);\r\n        console.log(`?? HTTPS health monitoring started (every ${monitoringInterval} minutes)`);\r\n      }\r\n      \r\n    } else {\r\n      // Development/Test: HTTP server with optional HTTPS\r\n      console.log(`?? Development mode: HTTP server enabled`);\r\n      \r\n      const sslConfig = await getSSLConfigFromEnvironment();\r\n      \r\n      if (sslConfig && process.env[ENV_VARS.FORCE_HTTPS] === 'true') {\r\n        // Development with HTTPS (for testing HTTPS behavior)\r\n        console.log('?? Development HTTPS mode enabled (FORCE_HTTPS=true)');\r\n        const httpsServer = createHttpsServer(app, sslConfig, HTTPS_PORT);\r\n        \r\n        io = new Server(httpsServer, {\r\n          cors: {\r\n            origin: allowedOrigins,\r\n            methods: [\"GET\", \"POST\"]\r\n          }\r\n        });\r\n        \r\n        // Also run HTTP server for development convenience\r\n        server.listen(PORT, () => {\r\n          console.log(`?? HTTP server on port ${PORT} (redirects to HTTPS)`);\r\n        });\r\n        \r\n        httpsServer.listen(HTTPS_PORT, () => {\r\n          console.log(`?? Development HTTPS server on port ${HTTPS_PORT}`);\r\n          console.log(`?? Health check: https://localhost:${HTTPS_PORT}/health`);\r\n          console.log(`?? Game API: https://localhost:${HTTPS_PORT}/api`);\r\n          console.log(`?? Socket.IO ready for secure connections`);\r\n        });\r\n        \r\n        setupSocketIO(io);\r\n        initSocketManager(io); // Initialize socket manager for global access\r\n      } else {\r\n        // Standard development: HTTP only\r\n        io = new Server(server, {\r\n          cors: {\r\n            origin: (origin, callback) => {\r\n              // Allow null origin (file://) and localhost origins\r\n              if (!origin || origin === 'null' || allowedOrigins.includes(origin)) {\r\n                callback(null, true);\r\n              } else {\r\n                callback(new Error('Not allowed by CORS'));\r\n              }\r\n            },\r\n            methods: [\"GET\", \"POST\"],\r\n            credentials: false\r\n          }\r\n        });\r\n        \r\n        server.listen(PORT, () => {\r\n          console.log(`?? Development HTTP server running on port ${PORT}`);\r\n          console.log(`?? Health check: http://localhost:${PORT}/health`);\r\n          console.log(`?? Game API: http://localhost:${PORT}/api`);\r\n          console.log(`?? Socket.IO ready for connections`);\r\n          console.log(`??  Development mode: HTTPS enforcement disabled`);\r\n        });\r\n        \r\n        setupSocketIO(io);\r\n        initSocketManager(io); // Initialize socket manager for global access\r\n      }\r\n      \r\n      // Start hybrid game loop for development (enabled by default)\r\n      const devLoopEnabled = (process.env.GAME_LOOP_ENABLED ?? 'true').toLowerCase() !== 'false';\r\n      if (devLoopEnabled) {\r\n        console.log(`?? Starting HYBRID game loop (responsive completions + efficient resources)`);\r\n        console.log(`?? Credit payouts every ${process.env.CREDIT_PAYOUT_PERIOD_MINUTES || '1'} minute(s)`);\r\n        hybridGameLoop.start();\r\n      } else {\r\n        console.log('?? HYBRID game loop disabled (GAME_LOOP_ENABLED=false)');\r\n      }\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('? Failed to start server:', error);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n// Handle graceful shutdown with timeout\r\nlet isShuttingDown = false;\r\nconst SHUTDOWN_TIMEOUT = 5000; // 5 seconds\r\n\r\nfunction shutdown() {\r\n  if (isShuttingDown) {\r\n    console.log('?? Shutdown already in progress');\r\n    return;\r\n  }\r\n  \r\n  isShuttingDown = true;\r\n console.log('?? Shutdown signal received, shutting down gracefully');\r\n  \r\n  // Stop hybrid game loop\r\n  try {\r\n    hybridGameLoop.stop();\r\n    console.log('?? Game loop stopped');\r\n  } catch (error) {\r\n    console.error('Error stopping hybrid game loop:', error);\r\n  }\r\n  \r\n  // Stop HTTPS health monitor\r\n  if (httpsHealthMonitor) {\r\n    try {\r\n      httpsHealthMonitor.stop();\r\n      console.log('?? HTTPS health monitor stopped');\r\n    } catch (error) {\r\n      console.error('Error stopping HTTPS health monitor:', error);\r\n    }\r\n  }\r\n  \r\n  // Close server with timeout\r\n  const shutdownTimer = setTimeout(() => {\r\n    console.log('? Shutdown timeout reached, force closing');\r\n    process.exit(1);\r\n  }, SHUTDOWN_TIMEOUT);\r\n  \r\n  server.close(() => {\r\n    clearTimeout(shutdownTimer);\r\n    console.log('? HTTP server closed');\r\n    \r\n    // Close database connections\r\n    try {\r\n      // Add any database cleanup here if needed\r\n      console.log('?? Database connections closed');\r\n    } catch (error) {\r\n      console.error('Error closing database connections:', error);\r\n    }\r\n    \r\n    console.log('? Process terminated gracefully');\r\n    process.exit(0);\r\n  });\r\n  \r\n  // If server doesn't close within timeout, force exit\r\n  setTimeout(() => {\r\n    console.log('? Force closing remaining connections');\r\n    process.exit(0);\r\n  }, SHUTDOWN_TIMEOUT + 1000);\r\n}\r\n\r\n// Handle graceful shutdown\r\nprocess.on('SIGTERM', () => {\r\n  console.log('?? SIGTERM received');\r\n  shutdown();\r\n});\r\n\r\nprocess.on('SIGINT', () => {\r\n  console.log('?? SIGINT received');\r\n  shutdown();\r\n});\r\n\r\n// Handle uncaught exceptions\r\nprocess.on('uncaughtException', (error) => {\r\n  console.error('?? Uncaught Exception:', error);\r\n  shutdown();\r\n});\r\n\r\nprocess.on('unhandledRejection', (reason, promise) => {\r\n  console.error('?? Unhandled Rejection at:', promise, 'reason:', reason);\r\n  shutdown();\r\n});\r\n\r\nif ((process.env[ENV_VARS.NODE_ENV] || '').toLowerCase() !== 'test') {\r\n  startServer();\r\n}\r\n\r\nexport { app, io };\r\n\r\n\r\n\r\n\r\n"],"version":3}
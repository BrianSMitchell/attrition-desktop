{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\utils\\httpsHealthCheck.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\utils\\httpsHealthCheck.ts"],"sourcesContent":["import https from 'https';\nimport http from 'http';\nimport { Request, Response } from 'express';\nimport { HTTP_STATUS } from '../constants/response-formats';\nimport { API_ENDPOINTS } from '../constants/api-endpoints';\nimport { ENV_VALUES, getEnvNumber } from '@game/shared';\n\n\nimport { TIMEOUTS, GAME_CONSTANTS } from '@game/shared';\nimport { ENV_VARS, isReverseProxySSL } from '@game/shared';\n\n/**\n * HTTPS Health Check and Validation Utilities\n * \n * Provides comprehensive health checks to ensure HTTPS is properly configured\n * and all endpoints are accessible via secure connections only.\n * \n * Features:\n * - SSL certificate validation\n * - HTTPS endpoint accessibility checks\n * - HTTP to HTTPS redirect validation\n * - Certificate expiry monitoring\n * - Security header verification\n */\n\nexport interface HttpsHealthCheckResult {\n  healthy: boolean;\n  timestamp: string;\n  checks: {\n    httpsListening: boolean;\n    httpRedirects: boolean;\n    certificateValid: boolean;\n    securityHeaders: boolean;\n    errorDetails?: string[];\n  };\n  certificate?: {\n    subject: string;\n    issuer: string;\n    validFrom: string;\n    validTo: string;\n    daysUntilExpiry: number;\n  };\n}\n\n/**\n * Perform comprehensive HTTPS health checks\n * @param httpsPort HTTPS port to check\n * @param httpPort HTTP port to check for redirects\n * @param hostname Hostname to check\n * @returns Health check results\n */\nexport async function performHttpsHealthCheck(\n  httpsPort: number = 443,\n  httpPort: number = 80,\n  hostname: string = 'localhost'\n): Promise<HttpsHealthCheckResult> {\n  const timestamp = new Date().toISOString();\n  const errorDetails: string[] = [];\n  \n  console.log(`?? Performing HTTPS health checks for ${hostname}:${httpsPort}`);\n\n  const result: HttpsHealthCheckResult = {\n    healthy: false,\n    timestamp,\n    checks: {\n      httpsListening: false,\n      httpRedirects: false,\n      certificateValid: false,\n      securityHeaders: false\n    }\n  };\n\n  try {\n    // Check 1: HTTPS endpoint accessibility and certificate validation\n    const httpsCheck = await checkHttpsEndpoint(hostname, httpsPort);\n    result.checks.httpsListening = httpsCheck.listening;\n    result.checks.certificateValid = httpsCheck.certificateValid;\n    result.certificate = httpsCheck.certificate;\n    \n    if (!httpsCheck.listening) {\n      errorDetails.push(`HTTPS server not listening on port ${httpsPort}`);\n    }\n    if (!httpsCheck.certificateValid) {\n      errorDetails.push('SSL certificate validation failed');\n    }\n\n    // Check 2: HTTP to HTTPS redirect validation\n    const redirectCheck = await checkHttpRedirect(hostname, httpPort, httpsPort);\n    result.checks.httpRedirects = redirectCheck.redirectsToHttps;\n    \n    if (!redirectCheck.redirectsToHttps) {\n      errorDetails.push(`HTTP requests not redirecting to HTTPS (${redirectCheck.error || 'unknown error'})`);\n    }\n\n    // Check 3: Security headers verification\n    const headersCheck = await checkSecurityHeaders(hostname, httpsPort);\n    result.checks.securityHeaders = headersCheck.hasRequiredHeaders;\n    \n    if (!headersCheck.hasRequiredHeaders) {\n      errorDetails.push(`Missing security headers: ${headersCheck.missingHeaders.join(', ')}`);\n    }\n\n    // Overall health status\n    result.healthy = (\n      result.checks.httpsListening &&\n      result.checks.certificateValid &&\n      result.checks.httpRedirects &&\n      result.checks.securityHeaders\n    );\n\n    if (errorDetails.length > 0) {\n      result.checks.errorDetails = errorDetails;\n    }\n\n    console.log(`? HTTPS health check completed - Healthy: ${result.healthy}`);\n    return result;\n\n  } catch (error) {\n    console.error('? HTTPS health check failed:', error);\n    errorDetails.push(`Health check failed: ${error instanceof Error ? error.message : 'unknown error'}`);\n    \n    result.checks.errorDetails = errorDetails;\n    return result;\n  }\n}\n\n/**\n * Check HTTPS endpoint accessibility and certificate\n */\nasync function checkHttpsEndpoint(hostname: string, port: number) {\n  return new Promise<{\n    listening: boolean;\n    certificateValid: boolean;\n    certificate?: any;\n  }>((resolve) => {\n    const req = https.request({\n      hostname,\n      port,\n      path: API_ENDPOINTS.SYSTEM.HEALTH,\n      method: 'GET',\n      timeout: TIMEOUTS.FIVE_SECONDS,\n      rejectUnauthorized: true // Enable certificate validation\n    }, (res) => {\n      let certificate;\n      \n      // Extract certificate information\n      if (res.connection && (res.connection as any).getPeerCertificate) {\n        try {\n          const cert = (res.connection as any).getPeerCertificate();\n          if (cert && cert.subject) {\n            const now = new Date();\n            const validTo = new Date(cert.valid_to);\n            const daysUntilExpiry = Math.floor((validTo.getTime() - now.getTime()) / (GAME_CONSTANTS.MILLISECONDS_PER_SECOND * GAME_CONSTANTS.SECONDS_PER_MINUTE * 60 * 24));\n            \n            certificate = {\n              subject: cert.subject.CN || cert.subject.O || 'Unknown',\n              issuer: cert.issuer.CN || cert.issuer.O || 'Unknown',\n              validFrom: cert.valid_from,\n              validTo: cert.valid_to,\n              daysUntilExpiry\n            };\n          }\n        } catch (error) {\n          console.warn('??  Could not extract certificate information:', error);\n        }\n      }\n\n      resolve({\n        listening: true,\n        certificateValid: res.statusCode !== undefined && res.statusCode < 500,\n        certificate\n      });\n    });\n\n    req.on('error', (error) => {\n      console.warn(`??  HTTPS endpoint check failed:`, error.message);\n      resolve({\n        listening: false,\n        certificateValid: false\n      });\n    });\n\n    req.on('timeout', () => {\n      req.destroy();\n      resolve({\n        listening: false,\n        certificateValid: false\n      });\n    });\n\n    req.end();\n  });\n}\n\n/**\n * Check HTTP to HTTPS redirect\n */\nasync function checkHttpRedirect(hostname: string, httpPort: number, httpsPort: number) {\n  return new Promise<{\n    redirectsToHttps: boolean;\n    error?: string;\n  }>((resolve) => {\n    const req = http.request({\n      hostname,\n      port: httpPort,\n      path: API_ENDPOINTS.SYSTEM.HEALTH,\n      method: 'GET',\n      timeout: TIMEOUTS.FIVE_SECONDS\n    }, (res) => {\n      // Check for redirect status codes (301, 302, 307, 308)\n      const isRedirect = [301, 302, 307, 308].includes(res.statusCode || 0);\n      \n      if (isRedirect) {\n        const location = res.headers.location;\n        const redirectsToHttps = location?.startsWith('https://') || false;\n        \n        resolve({\n          redirectsToHttps,\n          error: redirectsToHttps ? undefined : `Redirect location: ${location}`\n        });\n      } else {\n        resolve({\n          redirectsToHttps: false,\n          error: `Expected redirect, got status ${res.statusCode}`\n        });\n      }\n    });\n\n    req.on('error', (error) => {\n      // In production, HTTP server might not be running if only HTTPS is used\n      // This could be acceptable depending on architecture\n      resolve({\n        redirectsToHttps: false,\n        error: error.message\n      });\n    });\n\n    req.on('timeout', () => {\n      req.destroy();\n      resolve({\n        redirectsToHttps: false,\n        error: 'HTTP request timeout'\n      });\n    });\n\n    req.end();\n  });\n}\n\n/**\n * Check security headers on HTTPS endpoint\n */\nasync function checkSecurityHeaders(hostname: string, port: number) {\n  return new Promise<{\n    hasRequiredHeaders: boolean;\n    missingHeaders: string[];\n  }>((resolve) => {\n    const req = https.request({\n      hostname,\n      port,\n      path: API_ENDPOINTS.SYSTEM.HEALTH,\n      method: 'HEAD', // Use HEAD to get headers without body\n      timeout: TIMEOUTS.FIVE_SECONDS,\n      rejectUnauthorized: false // Don't fail on certificate issues for header check\n    }, (res) => {\n      const requiredHeaders = [\n        'strict-transport-security',\n        'x-content-type-options',\n        'x-frame-options',\n        'content-security-policy'\n      ];\n\n      const missingHeaders: string[] = [];\n      \n      for (const header of requiredHeaders) {\n        if (!res.headers[header] && !res.headers[header.toLowerCase()]) {\n          missingHeaders.push(header);\n        }\n      }\n\n      resolve({\n        hasRequiredHeaders: missingHeaders.length === 0,\n        missingHeaders\n      });\n    });\n\n    req.on('error', (error) => {\n      console.warn('??  Security headers check failed:', error.message);\n      resolve({\n        hasRequiredHeaders: false,\n        missingHeaders: ['Unable to check headers due to connection error']\n      });\n    });\n\n    req.on('timeout', () => {\n      req.destroy();\n      resolve({\n        hasRequiredHeaders: false,\n        missingHeaders: ['Unable to check headers due to timeout']\n      });\n    });\n\n    req.end();\n  });\n}\n\n/**\n * Express route handler for HTTPS health check endpoint\n */\nexport function httpsHealthCheckHandler(req: Request, res: Response) {\n  // If running behind a reverse proxy that terminates TLS (e.g., Render),\n  // local HTTPS is not expected to be listening. Short-circuit with a friendly response.\n  const reverseProxySSL = isReverseProxySSL();\n  if (reverseProxySSL) {\n    const timestamp = new Date().toISOString();\n    return res.status(HTTP_STATUS.OK).json({\n      success: true,\n      data: {\n        healthy: true,\n        timestamp,\n        checks: {\n          httpsListening: false,\n          httpRedirects: true,\n          certificateValid: true,\n          securityHeaders: true,\n          errorDetails: [\n            'Reverse proxy SSL termination detected; local HTTPS endpoint not expected. Skipping local checks.'\n          ]\n        }\n      },\n      message: 'Using reverse proxy SSL (e.g., Render). Local HTTPS health checks are skipped.'\n    });\n  }\n\n  const httpsPort = parseInt(process.env[ENV_VARS.HTTPS_PORT] || '443', 10);\n  const httpPort = parseInt(process.env[ENV_VARS.PORT] || '80', 10);\n  const hostname = req.get('host')?.split(':')[0] || 'localhost';\n\n  performHttpsHealthCheck(httpsPort, httpPort, hostname)\n    .then((result) => {\n      const statusCode = result.healthy ? HTTP_STATUS.OK : 503;\n      res.status(statusCode).json({\n        success: result.healthy,\n        data: result,\n        message: result.healthy ? 'HTTPS configuration healthy' : 'HTTPS configuration issues detected'\n      });\n    })\n    .catch((error) => {\n      console.error('? HTTPS health check endpoint error:', error);\n      res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n        success: false,\n        error: 'HTTPS health check failed',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    });\n}\n\n/**\n * Periodic HTTPS health monitoring\n */\nexport function shouldStartHttpsHealthMonitor(reverseProxy: boolean): boolean {\n  return !reverseProxy;\n}\n\nexport class HttpsHealthMonitor {\n  private intervalId: NodeJS.Timeout | null = null;\n  private lastResult: HttpsHealthCheckResult | null = null;\n\n  constructor(\n    private httpsPort: number = 443,\n    private httpPort: number = 80,\n    private hostname: string = 'localhost'\n  ) {}\n\n  start(intervalMinutes: number = 60) {\n    console.log(`?? Starting HTTPS health monitoring (every ${intervalMinutes} minutes)`);\n    \n    // Initial check\n    this.performCheck();\n    \n    // Schedule periodic checks\n    this.intervalId = setInterval(() => {\n      this.performCheck();\n    }, intervalMinutes * 60 * 1000);\n  }\n\n  stop() {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n      console.log('?? HTTPS health monitoring stopped');\n    }\n  }\n\n  getLastResult(): HttpsHealthCheckResult | null {\n    return this.lastResult;\n  }\n\n  private async performCheck() {\n    try {\n      this.lastResult = await performHttpsHealthCheck(this.httpsPort, this.httpPort, this.hostname);\n      \n      if (!this.lastResult.healthy) {\n        console.error('?? HTTPS health check failed:', this.lastResult.checks.errorDetails);\n        \n        // In production, emit critical alert for HTTPS failures\n        if (process.env[ENV_VARS.NODE_ENV] === ENV_VALUES.PRODUCTION) {\n          this.emitCriticalAlert('HTTPS health check failed', this.lastResult.checks.errorDetails);\n        }\n      }\n      \n      // Enhanced certificate expiry monitoring with multiple thresholds\n      if (this.lastResult.certificate) {\n        const daysUntilExpiry = this.lastResult.certificate.daysUntilExpiry;\n        \n        if (daysUntilExpiry <= 7) {\n          console.error(`?? CRITICAL: SSL certificate expires in ${daysUntilExpiry} days!`);\n          this.emitCriticalAlert('SSL certificate expiring soon', [`Certificate expires in ${daysUntilExpiry} days`]);\n        } else if (daysUntilExpiry <= 30) {\n          console.warn(`??  WARNING: SSL certificate expires in ${daysUntilExpiry} days`);\n        } else if (daysUntilExpiry <= 90) {\n          console.log(`?? INFO: SSL certificate expires in ${daysUntilExpiry} days`);\n        }\n        \n        // Log certificate details on first check\n        if (this.lastResult.certificate.daysUntilExpiry > 0) {\n          console.log(`?? Certificate: ${this.lastResult.certificate.subject} (Expires: ${this.lastResult.certificate.validTo})`);\n        }\n      }\n      \n      // Log successful health check (reduced frequency)\n      if (this.lastResult.healthy && Math.random() < 0.1) { // Log ~10% of successful checks\n        console.log(`? HTTPS health check passed - All systems secure`);\n      }\n      \n    } catch (error) {\n      console.error('? HTTPS health monitoring error:', error);\n      \n      if (process.env[ENV_VARS.NODE_ENV] === ENV_VALUES.PRODUCTION) {\n        this.emitCriticalAlert('HTTPS monitoring failure', [error instanceof Error ? error.message : 'Unknown error']);\n      }\n    }\n  }\n\n  private emitCriticalAlert(title: string, details?: string[]) {\n    // Emit custom event for external monitoring systems\n    const alertData = {\n      timestamp: new Date().toISOString(),\n      severity: 'CRITICAL',\n      service: 'HTTPS',\n      title,\n      details: details || [],\n      hostname: this.hostname,\n      httpsPort: this.httpsPort\n    };\n    \n    // Log structured alert data for external log aggregation\n    console.error('?? HTTPS CRITICAL ALERT:', JSON.stringify(alertData));\n    \n    // Could be extended to integrate with external monitoring services:\n    // - Send to Slack/Discord webhook\n    // - Send to PagerDuty/Opsgenie\n    // - Send to email notification service\n    // - Send to monitoring dashboard API\n  }\n}\n\nexport default {\n  performHttpsHealthCheck,\n  httpsHealthCheckHandler,\n  HttpsHealthMonitor\n};\n"],"version":3}
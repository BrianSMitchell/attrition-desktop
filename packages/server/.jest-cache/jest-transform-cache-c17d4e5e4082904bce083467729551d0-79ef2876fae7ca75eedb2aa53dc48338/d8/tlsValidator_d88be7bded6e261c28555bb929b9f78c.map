{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\utils\\tlsValidator.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\utils\\tlsValidator.ts"],"sourcesContent":["import https from 'https';\r\nimport tls from 'tls';\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport { HTTP_STATUS } from '../constants/response-formats';\r\n\r\n/**\r\n * TLS Security Validation and Monitoring Utilities\r\n * \r\n * Provides comprehensive validation and monitoring of TLS configurations\r\n * to ensure security standards are met and detect potential issues.\r\n * \r\n * Features:\r\n * - TLS configuration validation\r\n * - Handshake monitoring and analysis\r\n * - Cipher suite strength assessment\r\n * - Certificate validation monitoring\r\n * - Performance impact tracking\r\n */\r\n\r\nexport interface TLSValidationResult {\r\n  isSecure: boolean;\r\n  score: number; // Security score out of 100\r\n  issues: TLSSecurityIssue[];\r\n  recommendations: string[];\r\n  tlsVersion?: string;\r\n  cipherSuite?: string;\r\n  keyExchange?: string;\r\n  forwardSecrecy: boolean;\r\n}\r\n\r\nexport interface TLSSecurityIssue {\r\n  severity: 'critical' | 'high' | 'medium' | 'low' | 'info';\r\n  category: 'version' | 'cipher' | 'certificate' | 'configuration' | 'performance';\r\n  title: string;\r\n  description: string;\r\n  impact: string;\r\n  recommendation: string;\r\n}\r\n\r\nexport interface TLSHandshakeInfo {\r\n  timestamp: string;\r\n  clientIP: string;\r\n  tlsVersion: string;\r\n  cipherSuite: string;\r\n  keyExchange: string;\r\n  serverName?: string;\r\n  handshakeDuration: number;\r\n  success: boolean;\r\n  errorCode?: string;\r\n  errorMessage?: string;\r\n}\r\n\r\n/**\r\n * Validate TLS configuration security\r\n * @param tlsVersion TLS version used\r\n * @param cipherSuite Cipher suite negotiated\r\n * @param keyExchange Key exchange method\r\n * @returns Validation result with security assessment\r\n */\r\nexport function validateTLSConfiguration(\r\n  tlsVersion?: string,\r\n  cipherSuite?: string,\r\n  keyExchange?: string\r\n): TLSValidationResult {\r\n  const issues: TLSSecurityIssue[] = [];\r\n  const recommendations: string[] = [];\r\n  let score = 100;\r\n\r\n  // Validate TLS version\r\n  if (!tlsVersion) {\r\n    issues.push({\r\n      severity: 'medium',\r\n      category: 'version',\r\n      title: 'Unknown TLS Version',\r\n      description: 'TLS version could not be determined',\r\n      impact: 'Cannot assess TLS version security',\r\n      recommendation: 'Ensure TLS version information is available for monitoring'\r\n    });\r\n    score -= 10;\r\n  } else if (tlsVersion.startsWith('TLSv1.3')) {\r\n    // TLS 1.3 - Excellent\r\n    score += 0; // Already at maximum\r\n  } else if (tlsVersion.startsWith('TLSv1.2')) {\r\n    // TLS 1.2 - Good\r\n    score -= 5;\r\n  } else if (tlsVersion.startsWith('TLSv1.1')) {\r\n    // TLS 1.1 - Deprecated\r\n    issues.push({\r\n      severity: 'high',\r\n      category: 'version',\r\n      title: 'Deprecated TLS Version',\r\n      description: 'TLS 1.1 is deprecated and should not be used',\r\n      impact: 'Vulnerable to known attacks and lacks modern security features',\r\n      recommendation: 'Upgrade to TLS 1.2 or 1.3 immediately'\r\n    });\r\n    score -= 30;\r\n  } else if (tlsVersion.startsWith('TLSv1.0') || tlsVersion.startsWith('SSLv')) {\r\n    // TLS 1.0 or SSL - Critical\r\n    issues.push({\r\n      severity: 'critical',\r\n      category: 'version',\r\n      title: 'Insecure TLS/SSL Version',\r\n      description: `${tlsVersion} is insecure and must not be used`,\r\n      impact: 'Highly vulnerable to attacks, no longer considered secure',\r\n      recommendation: 'Immediately upgrade to TLS 1.2 or 1.3'\r\n    });\r\n    score -= 50;\r\n  }\r\n\r\n  // Validate cipher suite\r\n  if (!cipherSuite) {\r\n    issues.push({\r\n      severity: 'medium',\r\n      category: 'cipher',\r\n      title: 'Unknown Cipher Suite',\r\n      description: 'Cipher suite could not be determined',\r\n      impact: 'Cannot assess cipher strength and security',\r\n      recommendation: 'Ensure cipher suite information is available for monitoring'\r\n    });\r\n    score -= 10;\r\n  } else {\r\n    // Analyze cipher suite components\r\n    const cipherAnalysis = analyzeCipherSuite(cipherSuite);\r\n    issues.push(...cipherAnalysis.issues);\r\n    score += cipherAnalysis.scoreAdjustment;\r\n    recommendations.push(...cipherAnalysis.recommendations);\r\n  }\r\n\r\n  // Check for forward secrecy\r\n  const hasForwardSecrecy = checkForwardSecrecy(cipherSuite, keyExchange);\r\n  if (!hasForwardSecrecy) {\r\n    issues.push({\r\n      severity: 'high',\r\n      category: 'cipher',\r\n      title: 'No Forward Secrecy',\r\n      description: 'Connection does not provide forward secrecy',\r\n      impact: 'Past communications could be decrypted if private key is compromised',\r\n      recommendation: 'Use ECDHE or DHE key exchange methods'\r\n    });\r\n    score -= 25;\r\n  }\r\n\r\n  // Generate overall recommendations\r\n  if (score < 70) {\r\n    recommendations.push('TLS configuration requires immediate attention');\r\n  } else if (score < 90) {\r\n    recommendations.push('TLS configuration should be improved for better security');\r\n  }\r\n\r\n  return {\r\n    isSecure: score >= 70,\r\n    score: Math.max(0, score),\r\n    issues,\r\n    recommendations,\r\n    tlsVersion,\r\n    cipherSuite,\r\n    keyExchange,\r\n    forwardSecrecy: hasForwardSecrecy\r\n  };\r\n}\r\n\r\n/**\r\n * Analyze cipher suite security\r\n */\r\nfunction analyzeCipherSuite(cipherSuite: string) {\r\n  const issues: TLSSecurityIssue[] = [];\r\n  const recommendations: string[] = [];\r\n  let scoreAdjustment = 0;\r\n\r\n  const cipher = cipherSuite.toUpperCase();\r\n\r\n  // Check for weak encryption algorithms\r\n  if (cipher.includes('RC4')) {\r\n    issues.push({\r\n      severity: 'critical',\r\n      category: 'cipher',\r\n      title: 'Weak Cipher Algorithm',\r\n      description: 'RC4 cipher is cryptographically broken',\r\n      impact: 'Communications can be decrypted by attackers',\r\n      recommendation: 'Remove RC4 from cipher suite configuration'\r\n    });\r\n    scoreAdjustment -= 40;\r\n  }\r\n\r\n  if (cipher.includes('DES') || cipher.includes('3DES')) {\r\n    issues.push({\r\n      severity: 'high',\r\n      category: 'cipher',\r\n      title: 'Weak Encryption',\r\n      description: 'DES/3DES provides insufficient encryption strength',\r\n      impact: 'Vulnerable to brute force attacks',\r\n      recommendation: 'Use AES encryption instead'\r\n    });\r\n    scoreAdjustment -= 30;\r\n  }\r\n\r\n  if (cipher.includes('MD5')) {\r\n    issues.push({\r\n      severity: 'critical',\r\n      category: 'cipher',\r\n      title: 'Weak Hash Algorithm',\r\n      description: 'MD5 hash is cryptographically broken',\r\n      impact: 'Vulnerable to collision attacks',\r\n      recommendation: 'Use SHA-256 or SHA-384 instead'\r\n    });\r\n    scoreAdjustment -= 35;\r\n  }\r\n\r\n  if (cipher.includes('SHA1') || cipher.includes('SHA-1')) {\r\n    issues.push({\r\n      severity: 'high',\r\n      category: 'cipher',\r\n      title: 'Deprecated Hash Algorithm',\r\n      description: 'SHA-1 is deprecated due to collision vulnerabilities',\r\n      impact: 'May be vulnerable to collision attacks',\r\n      recommendation: 'Upgrade to SHA-256 or SHA-384'\r\n    });\r\n    scoreAdjustment -= 20;\r\n  }\r\n\r\n  // Check for AEAD ciphers (preferred)\r\n  if (cipher.includes('GCM') || cipher.includes('CHACHA20-POLY1305')) {\r\n    scoreAdjustment += 5;\r\n  } else if (cipher.includes('CBC')) {\r\n    issues.push({\r\n      severity: 'low',\r\n      category: 'cipher',\r\n      title: 'Non-AEAD Cipher Mode',\r\n      description: 'CBC mode is less secure than AEAD modes',\r\n      impact: 'Potentially vulnerable to padding oracle attacks',\r\n      recommendation: 'Prefer GCM or ChaCha20-Poly1305 cipher modes'\r\n    });\r\n    scoreAdjustment -= 5;\r\n  }\r\n\r\n  // Check key sizes\r\n  if (cipher.includes('128')) {\r\n    // 128-bit is acceptable but not ideal\r\n    scoreAdjustment -= 2;\r\n  } else if (cipher.includes('256')) {\r\n    // 256-bit is preferred\r\n    scoreAdjustment += 3;\r\n  }\r\n\r\n  return { issues, recommendations, scoreAdjustment };\r\n}\r\n\r\n/**\r\n * Check if cipher suite provides forward secrecy\r\n */\r\nfunction checkForwardSecrecy(cipherSuite?: string, keyExchange?: string): boolean {\r\n  if (!cipherSuite) return false;\r\n  \r\n  const cipher = cipherSuite.toUpperCase();\r\n  const kx = keyExchange?.toUpperCase() || '';\r\n  \r\n  // Check for forward secrecy indicators\r\n  return cipher.includes('ECDHE') || cipher.includes('DHE') || \r\n         kx.includes('ECDHE') || kx.includes('DHE');\r\n}\r\n\r\n/**\r\n * Monitor TLS handshake and collect security information\r\n */\r\nexport class TLSHandshakeMonitor {\r\n  private handshakeLog: TLSHandshakeInfo[] = [];\r\n  private maxLogSize = 1000;\r\n\r\n  /**\r\n   * Log a TLS handshake event\r\n   */\r\n  logHandshake(info: TLSHandshakeInfo) {\r\n    this.handshakeLog.push(info);\r\n    \r\n    // Keep log size manageable\r\n    if (this.handshakeLog.length > this.maxLogSize) {\r\n      this.handshakeLog = this.handshakeLog.slice(-this.maxLogSize);\r\n    }\r\n\r\n    // Log security issues\r\n    if (info.success) {\r\n      const validation = validateTLSConfiguration(info.tlsVersion, info.cipherSuite, info.keyExchange);\r\n      if (!validation.isSecure) {\r\n        console.warn(`üîí TLS Security Issue: Client ${info.clientIP} used insecure configuration`, {\r\n          tlsVersion: info.tlsVersion,\r\n          cipherSuite: info.cipherSuite,\r\n          score: validation.score,\r\n          issues: validation.issues.length\r\n        });\r\n      }\r\n    } else {\r\n      console.error(`üîí TLS Handshake Failed: Client ${info.clientIP}`, {\r\n        error: info.errorCode,\r\n        message: info.errorMessage\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get recent handshake statistics\r\n   */\r\n  getStatistics(lastMinutes: number = 60) {\r\n    const cutoff = Date.now() - (lastMinutes * 60 * 1000);\r\n    const recentHandshakes = this.handshakeLog.filter(h => \r\n      new Date(h.timestamp).getTime() > cutoff\r\n    );\r\n\r\n    const total = recentHandshakes.length;\r\n    const successful = recentHandshakes.filter(h => h.success).length;\r\n    const failed = total - successful;\r\n\r\n    // TLS version distribution\r\n    const tlsVersions: Record<string, number> = {};\r\n    recentHandshakes.forEach(h => {\r\n      if (h.tlsVersion) {\r\n        tlsVersions[h.tlsVersion] = (tlsVersions[h.tlsVersion] || 0) + 1;\r\n      }\r\n    });\r\n\r\n    // Average handshake duration\r\n    const avgDuration = total > 0 \r\n      ? recentHandshakes.reduce((sum, h) => sum + h.handshakeDuration, 0) / total \r\n      : 0;\r\n\r\n    return {\r\n      period: `${lastMinutes} minutes`,\r\n      total,\r\n      successful,\r\n      failed,\r\n      successRate: total > 0 ? (successful / total) * 100 : 0,\r\n      averageHandshakeDuration: avgDuration,\r\n      tlsVersions\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get security assessment for recent connections\r\n   */\r\n  getSecurityAssessment(lastMinutes: number = 60) {\r\n    const cutoff = Date.now() - (lastMinutes * 60 * 1000);\r\n    const recentHandshakes = this.handshakeLog.filter(h => \r\n      new Date(h.timestamp).getTime() > cutoff && h.success\r\n    );\r\n\r\n    if (recentHandshakes.length === 0) {\r\n      return { message: 'No recent successful handshakes to analyze' };\r\n    }\r\n\r\n    let totalScore = 0;\r\n    let secureConnections = 0;\r\n    const issueCategories: Record<string, number> = {};\r\n\r\n    recentHandshakes.forEach(handshake => {\r\n      const validation = validateTLSConfiguration(\r\n        handshake.tlsVersion, \r\n        handshake.cipherSuite, \r\n        handshake.keyExchange\r\n      );\r\n      \r\n      totalScore += validation.score;\r\n      if (validation.isSecure) secureConnections++;\r\n      \r\n      validation.issues.forEach(issue => {\r\n        issueCategories[issue.severity] = (issueCategories[issue.severity] || 0) + 1;\r\n      });\r\n    });\r\n\r\n    const avgScore = totalScore / recentHandshakes.length;\r\n    const securePercentage = (secureConnections / recentHandshakes.length) * 100;\r\n\r\n    return {\r\n      period: `${lastMinutes} minutes`,\r\n      totalConnections: recentHandshakes.length,\r\n      averageSecurityScore: Math.round(avgScore),\r\n      secureConnections,\r\n      securePercentage: Math.round(securePercentage),\r\n      issueCategories\r\n    };\r\n  }\r\n}\r\n\r\n// Global handshake monitor instance\r\nexport const tlsMonitor = new TLSHandshakeMonitor();\r\n\r\n/**\r\n * Express middleware to monitor TLS connections\r\n */\r\nexport function tlsMonitoringMiddleware(req: Request, res: Response, next: NextFunction) {\r\n  // Only monitor HTTPS connections\r\n  if (!req.secure && req.get('X-Forwarded-Proto') !== 'https') {\r\n    return next();\r\n  }\r\n\r\n  const startTime = Date.now();\r\n  const socket = (req as any).socket || (req as any).connection;\r\n  \r\n  if (socket && socket.encrypted) {\r\n    const tlsSocket = socket as tls.TLSSocket;\r\n    \r\n    const handshakeInfo: TLSHandshakeInfo = {\r\n      timestamp: new Date().toISOString(),\r\n      clientIP: req.ip || req.connection.remoteAddress || 'unknown',\r\n      tlsVersion: tlsSocket.getProtocol() || 'unknown',\r\n      cipherSuite: tlsSocket.getCipher()?.name || 'unknown',\r\n      keyExchange: tlsSocket.getCipher()?.version || 'unknown',\r\n      serverName: (tlsSocket as any).servername,\r\n      handshakeDuration: Date.now() - startTime,\r\n      success: true\r\n    };\r\n\r\n    tlsMonitor.logHandshake(handshakeInfo);\r\n  }\r\n\r\n  next();\r\n}\r\n\r\n/**\r\n * Express route handler for TLS security status\r\n */\r\nexport function tlsSecurityStatusHandler(req: Request, res: Response) {\r\n  try {\r\n    const minutes = parseInt(req.query.minutes as string) || 60;\r\n    const stats = tlsMonitor.getStatistics(minutes);\r\n    const assessment = tlsMonitor.getSecurityAssessment(minutes);\r\n\r\n    res.json({\r\n      success: true,\r\n      data: {\r\n        statistics: stats,\r\n        securityAssessment: assessment,\r\n        timestamp: new Date().toISOString()\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error('‚ùå TLS security status error:', error);\r\n    res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\r\n      success: false,\r\n      error: 'Failed to get TLS security status',\r\n      details: error instanceof Error ? error.message : 'Unknown error'\r\n    });\r\n  }\r\n}\r\n\r\nexport default {\r\n  validateTLSConfiguration,\r\n  TLSHandshakeMonitor,\r\n  tlsMonitor,\r\n  tlsMonitoringMiddleware,\r\n  tlsSecurityStatusHandler\r\n};\r\n\r\n\r\n"],"version":3}
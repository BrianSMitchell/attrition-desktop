4809d83247d974c96f97d2bff468a3e0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const runtimeEnv_1 = require("../runtimeEnv");
const shared_1 = require("@game/shared");
describe('isReverseProxySSL', () => {
    const OLD_ENV = process.env;
    beforeEach(() => {
        jest.resetModules();
        process.env = { ...OLD_ENV };
        delete process.env[shared_1.ENV_VARS.USE_REVERSE_PROXY_SSL];
        delete process.env.RENDER;
    });
    afterEach(() => {
        process.env = OLD_ENV;
    });
    test('returns false by default when flags are not set', () => {
        expect((0, runtimeEnv_1.isReverseProxySSL)()).toBe(false);
    });
    test('returns true when USE_REVERSE_PROXY_SSL is true (any casing)', () => {
        process.env[shared_1.ENV_VARS.USE_REVERSE_PROXY_SSL] = 'true';
        expect((0, runtimeEnv_1.isReverseProxySSL)()).toBe(true);
        process.env[shared_1.ENV_VARS.USE_REVERSE_PROXY_SSL] = 'True';
        expect((0, runtimeEnv_1.isReverseProxySSL)()).toBe(true);
        process.env[shared_1.ENV_VARS.USE_REVERSE_PROXY_SSL] = 'YES';
        expect((0, runtimeEnv_1.isReverseProxySSL)()).toBe(true);
    });
    test('returns true when RENDER is true', () => {
        process.env.RENDER = 'true';
        expect((0, runtimeEnv_1.isReverseProxySSL)()).toBe(true);
    });
    test('returns true when either flag is true', () => {
        process.env.RENDER = 'true';
        process.env[shared_1.ENV_VARS.USE_REVERSE_PROXY_SSL] = 'false';
        expect((0, runtimeEnv_1.isReverseProxySSL)()).toBe(true);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcdXRpbHNcXF9fdGVzdHNfX1xccnVudGltZUVudi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsOENBQWtEO0FBQ2xELHlDQUF3QztBQUV4QyxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7SUFFNUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwQixPQUFPLENBQUMsR0FBRyxHQUFHLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQztRQUM3QixPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7SUFDNUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsT0FBTyxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUM7SUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsaURBQWlELEVBQUUsR0FBRyxFQUFFO1FBQzNELE1BQU0sQ0FBQyxJQUFBLDhCQUFpQixHQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsOERBQThELEVBQUUsR0FBRyxFQUFFO1FBQ3hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLE1BQU0sQ0FBQztRQUNyRCxNQUFNLENBQUMsSUFBQSw4QkFBaUIsR0FBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLE1BQU0sQ0FBQztRQUNyRCxNQUFNLENBQUMsSUFBQSw4QkFBaUIsR0FBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUNwRCxNQUFNLENBQUMsSUFBQSw4QkFBaUIsR0FBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtRQUM1QyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDNUIsTUFBTSxDQUFDLElBQUEsOEJBQWlCLEdBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7UUFDakQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLE9BQU8sQ0FBQztRQUN0RCxNQUFNLENBQUMsSUFBQSw4QkFBaUIsR0FBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcdXRpbHNcXF9fdGVzdHNfX1xccnVudGltZUVudi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzUmV2ZXJzZVByb3h5U1NMIH0gZnJvbSAnLi4vcnVudGltZUVudic7XHJcbmltcG9ydCB7IEVOVl9WQVJTIH0gZnJvbSAnQGdhbWUvc2hhcmVkJztcblxyXG5kZXNjcmliZSgnaXNSZXZlcnNlUHJveHlTU0wnLCAoKSA9PiB7XHJcbiAgY29uc3QgT0xEX0VOViA9IHByb2Nlc3MuZW52O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QucmVzZXRNb2R1bGVzKCk7XHJcbiAgICBwcm9jZXNzLmVudiA9IHsgLi4uT0xEX0VOViB9O1xyXG4gICAgZGVsZXRlIHByb2Nlc3MuZW52W0VOVl9WQVJTLlVTRV9SRVZFUlNFX1BST1hZX1NTTF07XHJcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuUkVOREVSO1xyXG4gIH0pO1xyXG5cclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgcHJvY2Vzcy5lbnYgPSBPTERfRU5WO1xyXG4gIH0pO1xyXG5cclxuICB0ZXN0KCdyZXR1cm5zIGZhbHNlIGJ5IGRlZmF1bHQgd2hlbiBmbGFncyBhcmUgbm90IHNldCcsICgpID0+IHtcclxuICAgIGV4cGVjdChpc1JldmVyc2VQcm94eVNTTCgpKS50b0JlKGZhbHNlKTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgncmV0dXJucyB0cnVlIHdoZW4gVVNFX1JFVkVSU0VfUFJPWFlfU1NMIGlzIHRydWUgKGFueSBjYXNpbmcpJywgKCkgPT4ge1xyXG4gICAgcHJvY2Vzcy5lbnZbRU5WX1ZBUlMuVVNFX1JFVkVSU0VfUFJPWFlfU1NMXSA9ICd0cnVlJztcclxuICAgIGV4cGVjdChpc1JldmVyc2VQcm94eVNTTCgpKS50b0JlKHRydWUpO1xyXG5cclxuICAgIHByb2Nlc3MuZW52W0VOVl9WQVJTLlVTRV9SRVZFUlNFX1BST1hZX1NTTF0gPSAnVHJ1ZSc7XHJcbiAgICBleHBlY3QoaXNSZXZlcnNlUHJveHlTU0woKSkudG9CZSh0cnVlKTtcclxuXHJcbiAgICBwcm9jZXNzLmVudltFTlZfVkFSUy5VU0VfUkVWRVJTRV9QUk9YWV9TU0xdID0gJ1lFUyc7XHJcbiAgICBleHBlY3QoaXNSZXZlcnNlUHJveHlTU0woKSkudG9CZSh0cnVlKTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgncmV0dXJucyB0cnVlIHdoZW4gUkVOREVSIGlzIHRydWUnLCAoKSA9PiB7XHJcbiAgICBwcm9jZXNzLmVudi5SRU5ERVIgPSAndHJ1ZSc7XHJcbiAgICBleHBlY3QoaXNSZXZlcnNlUHJveHlTU0woKSkudG9CZSh0cnVlKTtcclxuICB9KTtcclxuXHJcbiAgdGVzdCgncmV0dXJucyB0cnVlIHdoZW4gZWl0aGVyIGZsYWcgaXMgdHJ1ZScsICgpID0+IHtcclxuICAgIHByb2Nlc3MuZW52LlJFTkRFUiA9ICd0cnVlJztcclxuICAgIHByb2Nlc3MuZW52W0VOVl9WQVJTLlVTRV9SRVZFUlNFX1BST1hZX1NTTF0gPSAnZmFsc2UnO1xyXG4gICAgZXhwZWN0KGlzUmV2ZXJzZVByb3h5U1NMKCkpLnRvQmUodHJ1ZSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==
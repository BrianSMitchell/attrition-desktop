{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\headersOnHealthAndStatus.test.ts","mappings":";;;;;AAAA,0DAAgC;AAChC,8DAA2D;AAG3D,yCAA2C;AAC3C,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC;AAC5B,OAAO,CAAC,GAAG,GAAG,EAAE,GAAG,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC;AAE/C,oCAA+B;AAE/B,QAAQ,CAAC,6CAA6C,EAAE,GAAG,EAAE;IAC3D,QAAQ,CAAC,GAAG,EAAE;QACZ,OAAO,CAAC,GAAG,GAAG,OAAO,CAAC;IACxB,CAAC,CAAC,CAAC;IAEH,MAAM,WAAW,GAAG;QAClB,2BAA2B;QAC3B,wBAAwB;QACxB,iBAAiB;KAClB,CAAC;IAEF,IAAI,CAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE;QACnE,MAAM,GAAG,GAAG,MAAM,IAAA,mBAAO,EAAC,WAAG,CAAC;aAC3B,GAAG,CAAC,6BAAa,CAAC,MAAM,CAAC,MAAM,CAAC;aAChC,GAAG,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAC;QAErC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,oBAAW,CAAC,EAAE,CAAC,CAAC;QACxC,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC;QAC5B,KAAK,MAAM,CAAC,IAAI,WAAW,EAAE,CAAC;YAC5B,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;QACnC,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE;QACvF,MAAM,GAAG,GAAG,MAAM,IAAA,mBAAO,EAAC,WAAG,CAAC;aAC3B,GAAG,CAAC,6BAAa,CAAC,MAAM,CAAC,MAAM,CAAC;aAChC,GAAG,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAC;QAErC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,oBAAW,CAAC,EAAE,CAAC,CAAC;QACxC,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC;QAC5B,KAAK,MAAM,CAAC,IAAI,WAAW,EAAE,CAAC;YAC5B,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;QACnC,CAAC;QACD,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,cAAc,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\headersOnHealthAndStatus.test.ts"],"sourcesContent":["import request from 'supertest';\nimport { API_ENDPOINTS } from '../constants/api-endpoints';\n\n\nimport { HTTP_STATUS } from '@game/shared';\nconst OLD_ENV = process.env;\nprocess.env = { ...OLD_ENV, NODE_ENV: 'test' };\n\nimport { app } from '../index';\n\ndescribe('Security headers on /health and /api/status', () => {\n  afterAll(() => {\n    process.env = OLD_ENV;\n  });\n\n  const mustHeaders = [\n    'strict-transport-security',\n    'x-content-type-options',\n    'x-frame-options'\n  ];\n\n  test('/health has core security headers (proxied https)', async () => {\n    const res = await request(app)\n      .get(API_ENDPOINTS.SYSTEM.HEALTH)\n      .set('X-Forwarded-Proto', 'https');\n\n    expect(res.status).toBe(HTTP_STATUS.OK);\n    const headers = res.headers;\n    for (const h of mustHeaders) {\n      expect(headers[h]).toBeDefined();\n    }\n  });\n\n  test('/api/status has core security headers and secure=true (proxied https)', async () => {\n    const res = await request(app)\n      .get(API_ENDPOINTS.SYSTEM.STATUS)\n      .set('X-Forwarded-Proto', 'https');\n\n    expect(res.status).toBe(HTTP_STATUS.OK);\n    const headers = res.headers;\n    for (const h of mustHeaders) {\n      expect(headers[h]).toBeDefined();\n    }\n    expect(res.body).toHaveProperty('data.secure', true);\n  });\n});\n\n\n"],"version":3}
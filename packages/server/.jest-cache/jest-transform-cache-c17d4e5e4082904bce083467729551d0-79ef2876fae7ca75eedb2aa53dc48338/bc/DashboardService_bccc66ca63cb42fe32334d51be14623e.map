{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\services\\dashboard\\DashboardService.ts","mappings":";;;AACA,+EAA4E;AAC5E,wFAAqF;AACrF,oDAA6D;AAE7D;;GAEG;AACH,MAAa,gBAAgB;IAC3B;;;;OAIG;IACH,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,IAAS;QACrC,MAAM,MAAM,GAAG,IAAI,EAAE,GAAG,IAAI,IAAI,EAAE,EAAE,CAAC;QAErC,uEAAuE;QACvE,IAAI,SAAS,GAAG,MAAM,iDAAuB,CAAC,yBAAyB,CAAC,IAAI,CAAC,CAAC;QAE9E,mEAAmE;QACnE,IAAI,CAAC,SAAS,EAAE,CAAC;YACf,OAAO,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,CAAC;QAC5C,CAAC;QAED,yEAAyE;QACzE,MAAM,EAAE,eAAe,EAAE,cAAc,EAAE,OAAO,EAAE,aAAa,EAAE,GAAG,MAAM,uDAA0B,CAAC,2BAA2B,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAEpJ,kEAAkE;QAClE,SAAS,GAAG,aAAa,CAAC;QAE1B,OAAO;YACL,IAAI;YACJ,MAAM,EAAE,SAAS;YACjB,eAAe;YACf,cAAc;YACd,OAAO;YACP,WAAW,EAAE,KAAK;YAClB,UAAU,EAAE;gBACV,IAAI,EAAE,cAAc;gBACpB,OAAO,EAAE,OAAO;gBAChB,aAAa,EAAE,IAAA,yCAAyB,GAAE;gBAC1C,YAAY,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;aAC1C;SACF,CAAC;IACJ,CAAC;IAED;;;;OAIG;IACK,MAAM,CAAC,uBAAuB,CAAC,IAAS;QAC9C,OAAO;YACL,IAAI;YACJ,MAAM,EAAE,IAAI;YACZ,eAAe,EAAE,CAAC;YAClB,cAAc,EAAE,CAAC;YACjB,OAAO,EAAE,IAAI;YACb,WAAW,EAAE,IAAI;YACjB,UAAU,EAAE;gBACV,IAAI,EAAE,cAAc;gBACpB,OAAO,EAAE,OAAO;gBAChB,aAAa,EAAE,IAAA,yCAAyB,GAAE;gBAC1C,YAAY,EAAE,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE;aAC1C;SACF,CAAC;IACJ,CAAC;CACF;AA5DD,4CA4DC","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\services\\dashboard\\DashboardService.ts"],"sourcesContent":["import { Response } from 'express';\r\nimport { EmpireResolutionService } from '../empire/EmpireResolutionService';\r\nimport { ResourceCalculationService } from '../resources/ResourceCalculationService';\r\nimport { getOnlineUniqueUsersCount } from '../socketService';\r\n\r\n/**\r\n * DashboardService handles dashboard-related business logic \r\n */\r\nexport class DashboardService {\r\n  /**\r\n   * Gets dashboard data for an authenticated user\r\n   * @param user - The authenticated user object\r\n   * @returns Promise<DashboardData> - Complete dashboard data\r\n   */\r\n  static async getDashboardData(user: any): Promise<DashboardData> {\r\n    const userId = user?._id || user?.id;\r\n\r\n    // Resolve empire using the service (includes auto-bootstrap if needed)\r\n    let empireRow = await EmpireResolutionService.resolveEmpireByUserObject(user);\r\n\r\n    // If no empire after service resolution, return new-player payload\r\n    if (!empireRow) {\r\n      return this.createNewPlayerResponse(user);\r\n    }\r\n\r\n    // Use ResourceCalculationService to handle complex resource calculations\r\n    const { resourcesGained, creditsPerHour, profile, updatedEmpire } = await ResourceCalculationService.calculateDashboardResources(empireRow, userId);\r\n\r\n    // Update empireRow with any changes from the calculation service \r\n    empireRow = updatedEmpire;\r\n\r\n    return {\r\n      user,\r\n      empire: empireRow,\r\n      resourcesGained,\r\n      creditsPerHour,\r\n      profile,\r\n      isNewPlayer: false,\r\n      serverInfo: {\r\n        name: 'Alpha Server',\r\n        version: '1.0.0',\r\n        playersOnline: getOnlineUniqueUsersCount(),\r\n        universeSize: { width: 100, height: 100 }\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Creates the response for new players without an empire\r\n   * @param user - The authenticated user object\r\n   * @returns DashboardData - New player response data\r\n   */\r\n  private static createNewPlayerResponse(user: any): DashboardData {\r\n    return {\r\n      user,\r\n      empire: null,\r\n      resourcesGained: 0,\r\n      creditsPerHour: 0,\r\n      profile: null,\r\n      isNewPlayer: true,\r\n      serverInfo: {\r\n        name: 'Alpha Server',\r\n        version: '1.0.0',\r\n        playersOnline: getOnlineUniqueUsersCount(),\r\n        universeSize: { width: 100, height: 100 }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Interface definitions for dashboard data structures\r\n */\r\nexport interface DashboardData {\r\n  user: any;\r\n  empire: any;\r\n  resourcesGained: number;\r\n  creditsPerHour: number;\r\n  profile: any;\r\n  isNewPlayer: boolean;\r\n  serverInfo: {\r\n    name: string;\r\n    version: string;\r\n    playersOnline: number;\r\n    universeSize: { width: number; height: number };\r\n  };\r\n}"],"version":3}
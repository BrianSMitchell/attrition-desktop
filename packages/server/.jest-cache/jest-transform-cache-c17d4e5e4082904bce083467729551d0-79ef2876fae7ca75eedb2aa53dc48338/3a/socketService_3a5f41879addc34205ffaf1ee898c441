80d8357336115ab1df4b08a095f16cc6
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getOnlineUniqueUsersCount = getOnlineUniqueUsersCount;
exports.setupSocketIO = setupSocketIO;
const jsonwebtoken_1 = __importDefault(require("jsonwebtoken"));
const response_formats_1 = require("../constants/response-formats");
const supabase_1 = require("../config/supabase");
const database_fields_1 = require("../constants/database-fields");
const shared_1 = require("@game/shared");
const onlineUserSocketCounts = new Map();
function getOnlineUniqueUsersCount() {
    return onlineUserSocketCounts.size;
}
function setupSocketIO(io) {
    // Authentication middleware for Socket.IO
    io.use(async (socket, next) => {
        try {
            const token = socket.handshake.auth.token;
            if (!token) {
                return next(new Error('Authentication error'));
            }
            const decoded = jsonwebtoken_1.default.verify(token, process.env[shared_1.ENV_VARS.JWT_SECRET]);
            let user = null;
            const { data, error } = await supabase_1.supabase
                .from(database_fields_1.DB_TABLES.USERS)
                .select('id, email, username, empire_id, starting_coordinate')
                .eq(database_fields_1.DB_FIELDS.BUILDINGS.ID, decoded.userId)
                .single();
            if (error || !data) {
                return next(new Error(response_formats_1.ERROR_MESSAGES.USER_NOT_FOUND));
            }
            user = {
                _id: data.id,
                id: data.id,
                email: data.email,
                username: data.username,
                gameProfile: {
                    startingCoordinate: data.starting_coordinate || null,
                    empireId: data.empire_id || null,
                },
            };
            socket.data.user = user;
            next();
        }
        catch (error) {
            next(new Error('Authentication error'));
        }
    });
    io.on('connection', (socket) => {
        const user = socket.data.user;
        if (process.env[shared_1.ENV_VARS.DEBUG_RESOURCES] === 'true') {
            console.log(`ðŸ”Œ User ${user.username} connected via Socket.IO`);
        }
        // Track online unique users (per authenticated user)
        try {
            const userId = user._id.toString?.() ?? String(user._id);
            const current = onlineUserSocketCounts.get(userId) || 0;
            onlineUserSocketCounts.set(userId, current + 1);
        }
        catch (err) {
            console.warn('Failed to update online user counters:', err);
        }
        // Broadcast presence update
        try {
            io.emit('presence:update', {
                playersOnline: getOnlineUniqueUsersCount(),
                socketsConnected: io.of('/').sockets.size
            });
        }
        catch { }
        // Join user to their personal room
        socket.join(`user:${user._id}`);
        // Join user to game rooms if they have an empire
        if (user.gameProfile.empireId) {
            socket.join(`empire:${user.gameProfile.empireId}`);
        }
        // Join user to coordinate-based rooms if they have a starting location
        if (user.gameProfile.startingCoordinate) {
            try {
                const coord = (0, shared_1.parseCoord)(user.gameProfile.startingCoordinate);
                // Join galaxy and region rooms for local events
                socket.join(`galaxy:${coord.server}${coord.galaxy.toString().padStart(2, '0')}`);
                socket.join(`region:${coord.server}${coord.galaxy.toString().padStart(2, '0')}:${coord.region.toString().padStart(2, '0')}`);
            }
            catch (error) {
                console.warn(`Failed to parse starting coordinate for user ${user.username}:`, error);
            }
        }
        // Join the Alpha universe
        socket.join('universe:A');
        // Handle game events
        socket.on('game:ping', (callback) => {
            callback({
                success: true,
                timestamp: new Date().toISOString(),
                message: 'Pong from server'
            });
        });
        socket.on('game:join_universe', (data, callback) => {
            // TODO: Implement universe joining logic
            socket.join('universe:alpha');
            callback({
                success: true,
                message: 'Joined Alpha Universe'
            });
        });
        socket.on('game:empire_update', (data) => {
            // Broadcast empire updates to relevant players
            socket.to(`empire:${user.gameProfile.empireId}`).emit('empire:updated', {
                empireId: user.gameProfile.empireId,
                update: data
            });
        });
        // Queue-specific events
        socket.on('queue:subscribe', (data) => {
            // Subscribe to queue updates for a specific base or empire-wide
            const { baseCoord } = data || {};
            if (baseCoord) {
                socket.join(`queue:${user.gameProfile.empireId}:${baseCoord}`);
            }
            else {
                socket.join(`queue:${user.gameProfile.empireId}`);
            }
        });
        socket.on('queue:unsubscribe', (data) => {
            // Unsubscribe from queue updates
            const { baseCoord } = data || {};
            if (baseCoord) {
                socket.leave(`queue:${user.gameProfile.empireId}:${baseCoord}`);
            }
            else {
                socket.leave(`queue:${user.gameProfile.empireId}`);
            }
        });
        socket.on('disconnect', (reason) => {
            try {
                const userId = user._id.toString?.() ?? String(user._id);
                const curr = onlineUserSocketCounts.get(userId) || 0;
                if (curr <= 1) {
                    onlineUserSocketCounts.delete(userId);
                }
                else {
                    onlineUserSocketCounts.set(userId, curr - 1);
                }
            }
            catch (err) {
                console.warn('Failed to update online user counters on disconnect:', err);
            }
            // Broadcast presence update
            try {
                io.emit('presence:update', {
                    playersOnline: getOnlineUniqueUsersCount(),
                    socketsConnected: io.of('/').sockets.size
                });
            }
            catch { }
            if (process.env[shared_1.ENV_VARS.DEBUG_RESOURCES] === 'true') {
                console.log(`ðŸ”Œ User ${user.username} disconnected: ${reason}`);
            }
        });
        // Send welcome message
        socket.emit('game:welcome', {
            message: `Welcome to Alpha Server, ${user.username}!`,
            serverInfo: {
                name: 'Alpha Server',
                version: '1.0.0',
                timestamp: new Date().toISOString()
            }
        });
    });
    // Utility functions for broadcasting
    io.broadcastToUniverse = (universeId, event, data) => {
        io.to(`universe:${universeId}`).emit(event, data);
    };
    io.broadcastToEmpire = (empireId, event, data) => {
        io.to(`empire:${empireId}`).emit(event, data);
    };
    io.sendToUser = (userId, event, data) => {
        io.to(`user:${userId}`).emit(event, data);
    };
    io.broadcastQueueUpdate = (empireId, baseCoord, event, data) => {
        // Broadcast to empire-wide queue subscribers
        io.to(`queue:${empireId}`).emit(event, data);
        // Also broadcast to base-specific subscribers if baseCoord is provided
        if (baseCoord) {
            io.to(`queue:${empireId}:${baseCoord}`).emit(event, data);
        }
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcc2VydmljZXNcXHNvY2tldFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFTQSw4REFFQztBQUVELHNDQThMQztBQTFNRCxnRUFBK0I7QUFDL0Isb0VBQStEO0FBQy9ELGlEQUE4QztBQUM5QyxrRUFBb0U7QUFDcEUseUNBQW9EO0FBRXBELE1BQU0sc0JBQXNCLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7QUFFekQsU0FBZ0IseUJBQXlCO0lBQ3ZDLE9BQU8sc0JBQXNCLENBQUMsSUFBSSxDQUFDO0FBQ3JDLENBQUM7QUFFRCxTQUFnQixhQUFhLENBQUMsRUFBVTtJQUN0QywwQ0FBMEM7SUFDMUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFO1FBQzVCLElBQUksQ0FBQztZQUNILE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUUxQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO1lBQ2pELENBQUM7WUFFRCxNQUFNLE9BQU8sR0FBRyxzQkFBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBUSxDQUFDLFVBQVUsQ0FBRSxDQUF1QixDQUFDO1lBRTNGLElBQUksSUFBSSxHQUFRLElBQUksQ0FBQztZQUNyQixNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLE1BQU0sbUJBQVE7aUJBQ25DLElBQUksQ0FBQywyQkFBUyxDQUFDLEtBQUssQ0FBQztpQkFDckIsTUFBTSxDQUFDLHFEQUFxRCxDQUFDO2lCQUM3RCxFQUFFLENBQUMsMkJBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUM7aUJBQzFD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QUFnQixFQUFFLFNBQXdCLEVBQUUsS0FBYSxFQUFFLElBQVMsRUFBRSxFQUFFO1FBQ2pHLDZDQUE2QztRQUM3QyxFQUFFLENBQUMsRUFBRSxDQUFDLFNBQVMsUUFBUSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzdDLHVFQUF1RTtRQUN2RSxJQUFJLFNBQVMsRUFBRSxDQUFDO1lBQ2QsRUFBRSxDQUFDLEVBQUUsQ0FBQyxTQUFTLFFBQVEsSUFBSSxTQUFTLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDNUQsQ0FBQztJQUNILENBQUMsQ0FBQztBQUNKLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xcc2VydmljZXNcXHNvY2tldFNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VydmVyIH0gZnJvbSAnc29ja2V0LmlvJztcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCB7IEVSUk9SX01FU1NBR0VTIH0gZnJvbSAnLi4vY29uc3RhbnRzL3Jlc3BvbnNlLWZvcm1hdHMnO1xuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9jb25maWcvc3VwYWJhc2UnO1xuaW1wb3J0IHsgREJfVEFCTEVTLCBEQl9GSUVMRFMgfSBmcm9tICcuLi9jb25zdGFudHMvZGF0YWJhc2UtZmllbGRzJztcbmltcG9ydCB7IEVOVl9WQVJTLCBwYXJzZUNvb3JkIH0gZnJvbSAnQGdhbWUvc2hhcmVkJztcblxuY29uc3Qgb25saW5lVXNlclNvY2tldENvdW50cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRPbmxpbmVVbmlxdWVVc2Vyc0NvdW50KCk6IG51bWJlciB7XG4gIHJldHVybiBvbmxpbmVVc2VyU29ja2V0Q291bnRzLnNpemU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXR1cFNvY2tldElPKGlvOiBTZXJ2ZXIpOiB2b2lkIHtcbiAgLy8gQXV0aGVudGljYXRpb24gbWlkZGxld2FyZSBmb3IgU29ja2V0LklPXG4gIGlvLnVzZShhc3luYyAoc29ja2V0LCBuZXh0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRva2VuID0gc29ja2V0LmhhbmRzaGFrZS5hdXRoLnRva2VuO1xuICAgICAgXG4gICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIHJldHVybiBuZXh0KG5ldyBFcnJvcignQXV0aGVudGljYXRpb24gZXJyb3InKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudltFTlZfVkFSUy5KV1RfU0VDUkVUXSEpIGFzIHsgdXNlcklkOiBzdHJpbmcgfTtcblxuICAgICAgbGV0IHVzZXI6IGFueSA9IG51bGw7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbShEQl9UQUJMRVMuVVNFUlMpXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgdXNlcm5hbWUsIGVtcGlyZV9pZCwgc3RhcnRpbmdfY29vcmRpbmF0ZScpXG4gICAgICAgIC5lcShEQl9GSUVMRFMuQlVJTERJTkdTLklELCBkZWNvZGVkLnVzZXJJZClcbiAgICAgICAgLnNpbmdsZSgpO1xuICAgICAgaWYgKGVycm9yIHx8ICFkYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXh0KG5ldyBFcnJvcihFUlJPUl9NRVNTQUdFUy5VU0VSX05PVF9GT1VORCkpO1xuICAgICAgfVxuICAgICAgdXNlciA9IHtcbiAgICAgICAgX2lkOiBkYXRhLmlkLFxuICAgICAgICBpZDogZGF0YS5pZCxcbiAgICAgICAgZW1haWw6IGRhdGEuZW1haWwsXG4gICAgICAgIHVzZXJuYW1lOiBkYXRhLnVzZXJuYW1lLFxuICAgICAgICBnYW1lUHJvZmlsZToge1xuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZTogZGF0YS5zdGFydGluZ19jb29yZGluYXRlIHx8IG51bGwsXG4gICAgICAgICAgZW1waXJlSWQ6IGRhdGEuZW1waXJlX2lkIHx8IG51bGwsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBzb2NrZXQuZGF0YS51c2VyID0gdXNlcjtcbiAgICAgIG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChuZXcgRXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGVycm9yJykpO1xuICAgIH1cbiAgfSk7XG5cbiAgaW8ub24oJ2Nvbm5lY3Rpb24nLCAoc29ja2V0KSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHNvY2tldC5kYXRhLnVzZXI7XG4gICAgaWYgKHByb2Nlc3MuZW52W0VOVl9WQVJTLkRFQlVHX1JFU09VUkNFU10gPT09ICd0cnVlJykge1xuICAgICAgY29uc29sZS5sb2coYPCflIwgVXNlciAke3VzZXIudXNlcm5hbWV9IGNvbm5lY3RlZCB2aWEgU29ja2V0LklPYCk7XG4gICAgfVxuXG4gICAgLy8gVHJhY2sgb25saW5lIHVuaXF1ZSB1c2VycyAocGVyIGF1dGhlbnRpY2F0ZWQgdXNlcilcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlcklkID0gKHVzZXIuX2lkIGFzIGFueSkudG9TdHJpbmc/LigpID8/IFN0cmluZyh1c2VyLl9pZCk7XG4gICAgICBjb25zdCBjdXJyZW50ID0gb25saW5lVXNlclNvY2tldENvdW50cy5nZXQodXNlcklkKSB8fCAwO1xuICAgICAgb25saW5lVXNlclNvY2tldENvdW50cy5zZXQodXNlcklkLCBjdXJyZW50ICsgMSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byB1cGRhdGUgb25saW5lIHVzZXIgY291bnRlcnM6JywgZXJyKTtcbiAgICB9XG5cbiAgICAvLyBCcm9hZGNhc3QgcHJlc2VuY2UgdXBkYXRlXG4gICAgdHJ5IHtcbiAgICAgIGlvLmVtaXQoJ3ByZXNlbmNlOnVwZGF0ZScsIHtcbiAgICAgICAgcGxheWVyc09ubGluZTogZ2V0T25saW5lVW5pcXVlVXNlcnNDb3VudCgpLFxuICAgICAgICBzb2NrZXRzQ29ubmVjdGVkOiBpby5vZignLycpLnNvY2tldHMuc2l6ZVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCB7fVxuXG4gICAgLy8gSm9pbiB1c2VyIHRvIHRoZWlyIHBlcnNvbmFsIHJvb21cbiAgICBzb2NrZXQuam9pbihgdXNlcjoke3VzZXIuX2lkfWApO1xuXG4gICAgLy8gSm9pbiB1c2VyIHRvIGdhbWUgcm9vbXMgaWYgdGhleSBoYXZlIGFuIGVtcGlyZVxuICAgIGlmICh1c2VyLmdhbWVQcm9maWxlLmVtcGlyZUlkKSB7XG4gICAgICBzb2NrZXQuam9pbihgZW1waXJlOiR7dXNlci5nYW1lUHJvZmlsZS5lbXBpcmVJZH1gKTtcbiAgICB9XG5cbiAgICAvLyBKb2luIHVzZXIgdG8gY29vcmRpbmF0ZS1iYXNlZCByb29tcyBpZiB0aGV5IGhhdmUgYSBzdGFydGluZyBsb2NhdGlvblxuICAgIGlmICh1c2VyLmdhbWVQcm9maWxlLnN0YXJ0aW5nQ29vcmRpbmF0ZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29vcmQgPSBwYXJzZUNvb3JkKHVzZXIuZ2FtZVByb2ZpbGUuc3RhcnRpbmdDb29yZGluYXRlKTtcbiAgICAgICAgLy8gSm9pbiBnYWxheHkgYW5kIHJlZ2lvbiByb29tcyBmb3IgbG9jYWwgZXZlbnRzXG4gICAgICAgIHNvY2tldC5qb2luKGBnYWxheHk6JHtjb29yZC5zZXJ2ZXJ9JHtjb29yZC5nYWxheHkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWApO1xuICAgICAgICBzb2NrZXQuam9pbihgcmVnaW9uOiR7Y29vcmQuc2VydmVyfSR7Y29vcmQuZ2FsYXh5LnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtjb29yZC5yZWdpb24udG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWApO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gcGFyc2Ugc3RhcnRpbmcgY29vcmRpbmF0ZSBmb3IgdXNlciAke3VzZXIudXNlcm5hbWV9OmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBKb2luIHRoZSBBbHBoYSB1bml2ZXJzZVxuICAgIHNvY2tldC5qb2luKCd1bml2ZXJzZTpBJyk7XG5cbiAgICAvLyBIYW5kbGUgZ2FtZSBldmVudHNcbiAgICBzb2NrZXQub24oJ2dhbWU6cGluZycsIChjYWxsYmFjaykgPT4ge1xuICAgICAgY2FsbGJhY2soe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbWVzc2FnZTogJ1BvbmcgZnJvbSBzZXJ2ZXInXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHNvY2tldC5vbignZ2FtZTpqb2luX3VuaXZlcnNlJywgKGRhdGEsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAvLyBUT0RPOiBJbXBsZW1lbnQgdW5pdmVyc2Ugam9pbmluZyBsb2dpY1xuICAgICAgc29ja2V0LmpvaW4oJ3VuaXZlcnNlOmFscGhhJyk7XG4gICAgICBjYWxsYmFjayh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdKb2luZWQgQWxwaGEgVW5pdmVyc2UnXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHNvY2tldC5vbignZ2FtZTplbXBpcmVfdXBkYXRlJywgKGRhdGEpID0+IHtcbiAgICAgIC8vIEJyb2FkY2FzdCBlbXBpcmUgdXBkYXRlcyB0byByZWxldmFudCBwbGF5ZXJzXG4gICAgICBzb2NrZXQudG8oYGVtcGlyZToke3VzZXIuZ2FtZVByb2ZpbGUuZW1waXJlSWR9YCkuZW1pdCgnZW1waXJlOnVwZGF0ZWQnLCB7XG4gICAgICAgIGVtcGlyZUlkOiB1c2VyLmdhbWVQcm9maWxlLmVtcGlyZUlkLFxuICAgICAgICB1cGRhdGU6IGRhdGFcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gUXVldWUtc3BlY2lmaWMgZXZlbnRzXG4gICAgc29ja2V0Lm9uKCdxdWV1ZTpzdWJzY3JpYmUnLCAoZGF0YSkgPT4ge1xuICAgICAgLy8gU3Vic2NyaWJlIHRvIHF1ZXVlIHVwZGF0ZXMgZm9yIGEgc3BlY2lmaWMgYmFzZSBvciBlbXBpcmUtd2lkZVxuICAgICAgY29uc3QgeyBiYXNlQ29vcmQgfSA9IGRhdGEgfHwge307XG4gICAgICBpZiAoYmFzZUNvb3JkKSB7XG4gICAgICAgIHNvY2tldC5qb2luKGBxdWV1ZToke3VzZXIuZ2FtZVByb2ZpbGUuZW1waXJlSWR9OiR7YmFzZUNvb3JkfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc29ja2V0LmpvaW4oYHF1ZXVlOiR7dXNlci5nYW1lUHJvZmlsZS5lbXBpcmVJZH1gKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHNvY2tldC5vbigncXVldWU6dW5zdWJzY3JpYmUnLCAoZGF0YSkgPT4ge1xuICAgICAgLy8gVW5zdWJzY3JpYmUgZnJvbSBxdWV1ZSB1cGRhdGVzXG4gICAgICBjb25zdCB7IGJhc2VDb29yZCB9ID0gZGF0YSB8fCB7fTtcbiAgICAgIGlmIChiYXNlQ29vcmQpIHtcbiAgICAgICAgc29ja2V0LmxlYXZlKGBxdWV1ZToke3VzZXIuZ2FtZVByb2ZpbGUuZW1waXJlSWR9OiR7YmFzZUNvb3JkfWApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc29ja2V0LmxlYXZlKGBxdWV1ZToke3VzZXIuZ2FtZVByb2ZpbGUuZW1waXJlSWR9YCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCAocmVhc29uKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VySWQgPSAodXNlci5faWQgYXMgYW55KS50b1N0cmluZz8uKCkgPz8gU3RyaW5nKHVzZXIuX2lkKTtcbiAgICAgICAgY29uc3QgY3VyciA9IG9ubGluZVVzZXJTb2NrZXRDb3VudHMuZ2V0KHVzZXJJZCkgfHwgMDtcbiAgICAgICAgaWYgKGN1cnIgPD0gMSkge1xuICAgICAgICAgIG9ubGluZVVzZXJTb2NrZXRDb3VudHMuZGVsZXRlKHVzZXJJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb25saW5lVXNlclNvY2tldENvdW50cy5zZXQodXNlcklkLCBjdXJyIC0gMSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byB1cGRhdGUgb25saW5lIHVzZXIgY291bnRlcnMgb24gZGlzY29ubmVjdDonLCBlcnIpO1xuICAgICAgfVxuXG4gICAgICAvLyBCcm9hZGNhc3QgcHJlc2VuY2UgdXBkYXRlXG4gICAgICB0cnkge1xuICAgICAgICBpby5lbWl0KCdwcmVzZW5jZTp1cGRhdGUnLCB7XG4gICAgICAgICAgcGxheWVyc09ubGluZTogZ2V0T25saW5lVW5pcXVlVXNlcnNDb3VudCgpLFxuICAgICAgICAgIHNvY2tldHNDb25uZWN0ZWQ6IGlvLm9mKCcvJykuc29ja2V0cy5zaXplXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCB7fVxuXG4gICAgICBpZiAocHJvY2Vzcy5lbnZbRU5WX1ZBUlMuREVCVUdfUkVTT1VSQ0VTXSA9PT0gJ3RydWUnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5SMIFVzZXIgJHt1c2VyLnVzZXJuYW1lfSBkaXNjb25uZWN0ZWQ6ICR7cmVhc29ufWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gU2VuZCB3ZWxjb21lIG1lc3NhZ2VcbiAgICBzb2NrZXQuZW1pdCgnZ2FtZTp3ZWxjb21lJywge1xuICAgICAgbWVzc2FnZTogYFdlbGNvbWUgdG8gQWxwaGEgU2VydmVyLCAke3VzZXIudXNlcm5hbWV9IWAsXG4gICAgICBzZXJ2ZXJJbmZvOiB7XG4gICAgICAgIG5hbWU6ICdBbHBoYSBTZXJ2ZXInLFxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICAvLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgYnJvYWRjYXN0aW5nXG4gIGlvLmJyb2FkY2FzdFRvVW5pdmVyc2UgPSAodW5pdmVyc2VJZDogc3RyaW5nLCBldmVudDogc3RyaW5nLCBkYXRhOiBhbnkpID0+IHtcbiAgICBpby50byhgdW5pdmVyc2U6JHt1bml2ZXJzZUlkfWApLmVtaXQoZXZlbnQsIGRhdGEpO1xuICB9O1xuXG4gIGlvLmJyb2FkY2FzdFRvRW1waXJlID0gKGVtcGlyZUlkOiBzdHJpbmcsIGV2ZW50OiBzdHJpbmcsIGRhdGE6IGFueSkgPT4ge1xuICAgIGlvLnRvKGBlbXBpcmU6JHtlbXBpcmVJZH1gKS5lbWl0KGV2ZW50LCBkYXRhKTtcbiAgfTtcblxuICBpby5zZW5kVG9Vc2VyID0gKHVzZXJJZDogc3RyaW5nLCBldmVudDogc3RyaW5nLCBkYXRhOiBhbnkpID0+IHtcbiAgICBpby50byhgdXNlcjoke3VzZXJJZH1gKS5lbWl0KGV2ZW50LCBkYXRhKTtcbiAgfTtcblxuICBpby5icm9hZGNhc3RRdWV1ZVVwZGF0ZSA9IChlbXBpcmVJZDogc3RyaW5nLCBiYXNlQ29vcmQ6IHN0cmluZyB8IG51bGwsIGV2ZW50OiBzdHJpbmcsIGRhdGE6IGFueSkgPT4ge1xuICAgIC8vIEJyb2FkY2FzdCB0byBlbXBpcmUtd2lkZSBxdWV1ZSBzdWJzY3JpYmVyc1xuICAgIGlvLnRvKGBxdWV1ZToke2VtcGlyZUlkfWApLmVtaXQoZXZlbnQsIGRhdGEpO1xuICAgIC8vIEFsc28gYnJvYWRjYXN0IHRvIGJhc2Utc3BlY2lmaWMgc3Vic2NyaWJlcnMgaWYgYmFzZUNvb3JkIGlzIHByb3ZpZGVkXG4gICAgaWYgKGJhc2VDb29yZCkge1xuICAgICAgaW8udG8oYHF1ZXVlOiR7ZW1waXJlSWR9OiR7YmFzZUNvb3JkfWApLmVtaXQoZXZlbnQsIGRhdGEpO1xuICAgIH1cbiAgfTtcbn1cblxuLy8gRXh0ZW5kIFNvY2tldC5JTyBTZXJ2ZXIgaW50ZXJmYWNlXG5kZWNsYXJlIG1vZHVsZSAnc29ja2V0LmlvJyB7XG4gIGludGVyZmFjZSBTZXJ2ZXIge1xuICAgIGJyb2FkY2FzdFRvVW5pdmVyc2UodW5pdmVyc2VJZDogc3RyaW5nLCBldmVudDogc3RyaW5nLCBkYXRhOiBhbnkpOiB2b2lkO1xuICAgIGJyb2FkY2FzdFRvRW1waXJlKGVtcGlyZUlkOiBzdHJpbmcsIGV2ZW50OiBzdHJpbmcsIGRhdGE6IGFueSk6IHZvaWQ7XG4gICAgc2VuZFRvVXNlcih1c2VySWQ6IHN0cmluZywgZXZlbnQ6IHN0cmluZywgZGF0YTogYW55KTogdm9pZDtcbiAgICBicm9hZGNhc3RRdWV1ZVVwZGF0ZShlbXBpcmVJZDogc3RyaW5nLCBiYXNlQ29vcmQ6IHN0cmluZyB8IG51bGwsIGV2ZW50OiBzdHJpbmcsIGRhdGE6IGFueSk6IHZvaWQ7XG4gIH1cbn1cblxuXG4iXSwidmVyc2lvbiI6M30=
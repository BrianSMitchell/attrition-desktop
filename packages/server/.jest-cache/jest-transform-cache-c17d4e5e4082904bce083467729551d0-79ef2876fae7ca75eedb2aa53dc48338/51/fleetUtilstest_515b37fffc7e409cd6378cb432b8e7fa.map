{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\fleetUtils.test.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\fleetUtils.test.ts"],"sourcesContent":["import { getUnitSpec } from '@game/shared';\n\n// Mock getUnitSpec\nimport { HTTP_STATUS } from '@game/shared';\nimport { STATUS_CODES } from '@game/shared';\njest.mock('@game/shared', () => ({\n  getUnitSpec: jest.fn()\n}));\n\nconst mockGetUnitSpec = getUnitSpec as jest.MockedFunction<typeof getUnitSpec>;\n\n/**\n * Calculate fleet size in credits based on unit composition (FR-6)\n * @param units - Array of fleet units with unitKey and count\n * @returns Total credits value of the fleet\n */\nfunction calculateFleetSizeCredits(units: Array<{ unitKey?: string; unit_key?: string; count: number }>): number {\n  if (!Array.isArray(units)) {\n    return STATUS_CODES.SUCCESS;\n  }\n\n  let totalCredits = 0;\n  \n  for (const unit of units) {\n    const unitKey = unit?.unitKey || unit?.unit_key;\n    const count = Number(unit?.count || 0);\n    \n    if (unitKey && count > 0) {\n      try {\n        const unitSpec = getUnitSpec(unitKey as any);\n        if (unitSpec && typeof unitSpec.creditsCost === 'number') {\n          totalCredits += unitSpec.creditsCost * count;\n        }\n      } catch {\n        // Ignore units with missing specs\n      }\n    }\n  }\n  \n  return totalCredits;\n}\n\ndescribe('Fleet Utils', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('calculateFleetSizeCredits', () => {\n    it('should calculate total credits for valid units', () => {\n      mockGetUnitSpec.mockImplementation((unitKey: string) => {\n        switch (unitKey) {\n          case 'fighter':\n            return { key: 'fighter' as any, name: 'Fighter', creditsCost: 100, techPrereqs: [] };\n          case 'bomber':\n            return { key: 'bomber' as any, name: 'Bomber', creditsCost: 250, techPrereqs: [] };\n          default:\n            throw new Error('Unit not found');\n        }\n      });\n\n      const units = [\n        { unitKey: 'fighter', count: 10 },\n        { unitKey: 'bomber', count: 5 }\n      ];\n\n      const result = calculateFleetSizeCredits(units);\n      expect(result).toBe(2250); // (10 * 100) + (5 * 250)\n    });\n\n    it('should handle empty units array', () => {\n      const result = calculateFleetSizeCredits([]);\n      expect(result).toBe(0);\n    });\n\n    it('should handle null/undefined units', () => {\n      const result = calculateFleetSizeCredits(null as any);\n      expect(result).toBe(0);\n    });\n\n    it('should ignore units with zero count', () => {\n      mockGetUnitSpec.mockReturnValue({ key: 'test' as any, name: 'Test', creditsCost: 100, techPrereqs: [] });\n\n      const units = [\n        { unitKey: 'fighter', count: 0 },\n        { unitKey: 'bomber', count: 5 }\n      ];\n\n      const result = calculateFleetSizeCredits(units);\n      expect(result).toBe(HTTP_STATUS.INTERNAL_SERVER_ERROR); // Only bomber counts\n    });\n\n    it('should handle units with missing specs gracefully', () => {\n      mockGetUnitSpec.mockImplementation((unitKey: string) => {\n        if (unitKey === 'fighter') {\n          return { key: 'fighter' as any, name: 'Fighter', creditsCost: 100, techPrereqs: [] };\n        }\n        throw new Error('Unit not found');\n      });\n\n      const units = [\n        { unitKey: 'fighter', count: 10 },\n        { unitKey: 'invalid_unit', count: 5 }\n      ];\n\n      const result = calculateFleetSizeCredits(units);\n      expect(result).toBe(1000); // Only fighter counts\n    });\n\n    it('should handle both unitKey and unit_key formats', () => {\n      mockGetUnitSpec.mockReturnValue({ key: 'test' as any, name: 'Test', creditsCost: 100, techPrereqs: [] });\n\n      const units = [\n        { unitKey: 'fighter', count: 5 },\n        { unit_key: 'bomber', count: 3 }\n      ];\n\n      const result = calculateFleetSizeCredits(units);\n      expect(result).toBe(800); // (5 * 100) + (3 * 100)\n    });\n\n    it('should handle units with non-numeric creditsCost', () => {\n      mockGetUnitSpec.mockImplementation((unitKey: string) => {\n        switch (unitKey) {\n          case 'fighter':\n            return { key: 'fighter' as any, name: 'Fighter', creditsCost: 100, techPrereqs: [] };\n          case 'special':\n            return { key: 'special' as any, name: 'Special', creditsCost: null as any, techPrereqs: [] }; // Non-numeric\n          default:\n            return { key: 'default' as any, name: 'Default', techPrereqs: [] } as any;\n        }\n      });\n\n      const units = [\n        { unitKey: 'fighter', count: 5 },\n        { unitKey: 'special', count: 3 }\n      ];\n\n      const result = calculateFleetSizeCredits(units);\n      expect(result).toBe(HTTP_STATUS.INTERNAL_SERVER_ERROR); // Only fighter counts\n    });\n  });\n});\n"],"version":3}
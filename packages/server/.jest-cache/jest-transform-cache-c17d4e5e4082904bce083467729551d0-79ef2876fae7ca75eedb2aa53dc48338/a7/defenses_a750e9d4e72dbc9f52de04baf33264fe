926a6dcf39421e1943ef630535603b4c
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const supabase_1 = require("../../config/supabase");
const errorHandler_1 = require("../../middleware/errorHandler");
const auth_1 = require("../../middleware/auth");
const response_formats_1 = require("../../constants/response-formats");
const database_fields_1 = require("../../constants/database-fields");
const shared_1 = require("@game/shared");
const shared_2 = require("@game/shared");
const EmpireResolutionService_1 = require("../../services/empire/EmpireResolutionService");
const router = (0, express_1.Router)();
router.use(auth_1.authenticate);
/**
 * Get defenses catalog
 */
router.get('/catalog', (0, errorHandler_1.asyncHandler)(async (_req, res) => {
    const catalog = (0, shared_2.getDefensesList)();
    res.json({ success: true, data: { catalog } });
}));
/**
 * Get defenses status
 */
router.get('/status', (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const user = req.user;
    // Resolve empire using established pattern
    const empireRow = await EmpireResolutionService_1.EmpireResolutionService.resolveEmpireByUserObject(user);
    if (!empireRow) {
        return res.status(shared_1.HTTP_STATUS.NOT_FOUND).json({ success: false, error: response_formats_1.ERROR_MESSAGES.EMPIRE_NOT_FOUND });
    }
    const empireId = String(empireRow.id);
    const { DefensesService } = await Promise.resolve().then(() => __importStar(require('../../services/defenses/DefensesService')));
    const status = await DefensesService.getStatus(empireId);
    return res.json({ success: true, data: { status } });
}));
/**
 * Get defenses queue
 */
router.get('/queue', (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const user = req.user;
    // Resolve empire using established pattern
    const empireRow = await EmpireResolutionService_1.EmpireResolutionService.resolveEmpireByUserObject(user);
    if (!empireRow) {
        return res.status(shared_1.HTTP_STATUS.NOT_FOUND).json({ success: false, error: response_formats_1.ERROR_MESSAGES.EMPIRE_NOT_FOUND });
    }
    const empireId = String(empireRow.id);
    const locationCoord = String(req.query.locationCoord || '').trim() || undefined;
    // Build query for defense queue
    let query = supabase_1.supabase
        .from(database_fields_1.DB_TABLES.DEFENSE_QUEUE)
        .select('id, defense_key, started_at, completes_at, location_coord')
        .eq(database_fields_1.DB_FIELDS.BUILDINGS.EMPIRE_ID, empireId)
        .eq(database_fields_1.DB_FIELDS.TECH_QUEUE.STATUS, 'pending');
    if (locationCoord) {
        query = query.eq(database_fields_1.DB_FIELDS.BUILDINGS.LOCATION_COORD, locationCoord);
    }
    const { data: items } = await query.order(database_fields_1.DB_FIELDS.TECH_QUEUE.COMPLETES_AT, { ascending: true, nullsFirst: false });
    const queue = (items || []).map((it) => ({
        id: String(it.id || ''),
        defenseKey: String(it.defense_key || ''),
        startedAt: it.started_at || null,
        completesAt: it.completes_at || null,
        baseCoord: String(it.location_coord || '')
    }));
    return res.json({ success: true, data: { queue } });
}));
/**
 * Start defense construction
 */
router.post('/start', (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const user = req.user;
    // Resolve empire using established pattern
    const empireRow = await EmpireResolutionService_1.EmpireResolutionService.resolveEmpireByUserObject(user);
    if (!empireRow) {
        return res.status(shared_1.HTTP_STATUS.NOT_FOUND).json({ success: false, error: response_formats_1.ERROR_MESSAGES.EMPIRE_NOT_FOUND });
    }
    const empireId = String(empireRow.id);
    const { locationCoord, defenseKey } = req.body;
    if (!locationCoord || !defenseKey) {
        return res.status(shared_1.HTTP_STATUS.BAD_REQUEST).json({ success: false, error: 'locationCoord and defenseKey are required' });
    }
    const { DefensesService } = await Promise.resolve().then(() => __importStar(require('../../services/defenses/DefensesService')));
    const result = await DefensesService.start(empireId, locationCoord, defenseKey);
    if (!result.success) {
        const errorResponse = {
            success: false,
            error: result.error ?? result.message,
            message: result.message ?? result.error
        };
        if (result.code)
            errorResponse.code = result.code;
        if (result.details)
            errorResponse.details = result.details;
        if (result.reasons)
            errorResponse.reasons = result.reasons;
        const statusCode = result.code === 'ALREADY_IN_PROGRESS' ? 409 : shared_1.HTTP_STATUS.BAD_REQUEST;
        return res.status(statusCode).json(errorResponse);
    }
    return res.json({ success: true, data: result.data, message: result.message });
}));
/**
 * Cancel a pending defense item
 */
router.delete('/queue/:id', (0, errorHandler_1.asyncHandler)(async (req, res) => {
    const user = req.user;
    // Resolve empire using established pattern
    const empireRow = await EmpireResolutionService_1.EmpireResolutionService.resolveEmpireByUserObject(user);
    if (!empireRow) {
        return res.status(shared_1.HTTP_STATUS.NOT_FOUND).json({ success: false, error: response_formats_1.ERROR_MESSAGES.EMPIRE_NOT_FOUND });
    }
    const empireId = String(empireRow.id);
    const id = String(req.params.id || '').trim();
    if (!id)
        return res.status(shared_1.HTTP_STATUS.BAD_REQUEST).json({ success: false, error: 'Invalid queue item id' });
    const { data: qItem } = await supabase_1.supabase
        .from(database_fields_1.DB_TABLES.DEFENSE_QUEUE)
        .select('id, empire_id, defense_key, status, started_at, completes_at')
        .eq(database_fields_1.DB_FIELDS.BUILDINGS.ID, id)
        .maybeSingle();
    if (!qItem || String(qItem.empire_id) !== empireId) {
        return res.status(shared_1.HTTP_STATUS.NOT_FOUND).json({ success: false, error: response_formats_1.ERROR_MESSAGES.QUEUE_ITEM_NOT_FOUND });
    }
    if (String(qItem.status || '') !== 'pending') {
        return res.status(shared_1.HTTP_STATUS.BAD_REQUEST).json({ success: false, error: 'Only pending items can be cancelled' });
    }
    // Check if in progress (has started and not yet completed)
    if (qItem.started_at && qItem.completes_at) {
        const completesAt = new Date(qItem.completes_at).getTime();
        if (completesAt > Date.now()) {
            return res.status(shared_1.HTTP_STATUS.BAD_REQUEST).json({ success: false, error: 'Cannot cancel an in-progress defense yet' });
        }
    }
    await supabase_1.supabase.from(database_fields_1.DB_TABLES.DEFENSE_QUEUE).update({ status: 'cancelled' }).eq(database_fields_1.DB_FIELDS.BUILDINGS.ID, id);
    return res.json({ success: true, data: { cancelledId: id }, message: 'Defense construction cancelled' });
}));
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFByb2plY3RzXFxBdHRyaXRpb25cXHBhY2thZ2VzXFxzZXJ2ZXJcXHNyY1xccm91dGVzXFxnYW1lXFxkZWZlbnNlcy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHFDQUEyQztBQUMzQyxvREFBaUQ7QUFDakQsZ0VBQTZEO0FBQzdELGdEQUFrRTtBQUNsRSx1RUFBa0U7QUFDbEUscUVBQXVFO0FBQ3ZFLHlDQUEyQztBQUMzQyx5Q0FBMkQ7QUFDM0QsMkZBQXdGO0FBRXhGLE1BQU0sTUFBTSxHQUFHLElBQUEsZ0JBQU0sR0FBRSxDQUFDO0FBRXhCLE1BQU0sQ0FBQyxHQUFHLENBQUMsbUJBQVksQ0FBQyxDQUFDO0FBRXpCOztHQUVHO0FBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBQSwyQkFBWSxFQUFDLEtBQUssRUFBRSxJQUFpQixFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQzdFLE1BQU0sT0FBTyxHQUFHLElBQUEsd0JBQWUsR0FBRSxDQUFDO0lBQ2xDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztBQUNqRCxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRUo7O0dBRUc7QUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxJQUFBLDJCQUFZLEVBQUMsS0FBSyxFQUFFLEdBQWdCLEVBQUUsR0FBYSxFQUFFLEVBQUU7SUFDM0UsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQVksQ0FBQztJQUU5QiwyQ0FBMkM7SUFDM0MsTUFBTSxTQUFTLEdBQUcsTUFBTSxpREFBdUIsQ0FBQyx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoRixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDZixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsb0JBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENB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QUFDM0csQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVKLGtCQUFlLE1BQU0sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcUHJvamVjdHNcXEF0dHJpdGlvblxccGFja2FnZXNcXHNlcnZlclxcc3JjXFxyb3V0ZXNcXGdhbWVcXGRlZmVuc2VzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi8uLi9jb25maWcvc3VwYWJhc2UnO1xyXG5pbXBvcnQgeyBhc3luY0hhbmRsZXIgfSBmcm9tICcuLi8uLi9taWRkbGV3YXJlL2Vycm9ySGFuZGxlcic7XHJcbmltcG9ydCB7IGF1dGhlbnRpY2F0ZSwgQXV0aFJlcXVlc3QgfSBmcm9tICcuLi8uLi9taWRkbGV3YXJlL2F1dGgnO1xyXG5pbXBvcnQgeyBFUlJPUl9NRVNTQUdFUyB9IGZyb20gJy4uLy4uL2NvbnN0YW50cy9yZXNwb25zZS1mb3JtYXRzJztcclxuaW1wb3J0IHsgREJfVEFCTEVTLCBEQl9GSUVMRFMgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvZGF0YWJhc2UtZmllbGRzJztcclxuaW1wb3J0IHsgSFRUUF9TVEFUVVMgfSBmcm9tICdAZ2FtZS9zaGFyZWQnO1xyXG5pbXBvcnQgeyBEZWZlbnNlS2V5LCBnZXREZWZlbnNlc0xpc3QgfSBmcm9tICdAZ2FtZS9zaGFyZWQnO1xyXG5pbXBvcnQgeyBFbXBpcmVSZXNvbHV0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2VtcGlyZS9FbXBpcmVSZXNvbHV0aW9uU2VydmljZSc7XHJcblxyXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcclxuXHJcbnJvdXRlci51c2UoYXV0aGVudGljYXRlKTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgZGVmZW5zZXMgY2F0YWxvZ1xyXG4gKi9cclxucm91dGVyLmdldCgnL2NhdGFsb2cnLCBhc3luY0hhbmRsZXIoYXN5bmMgKF9yZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgY2F0YWxvZyA9IGdldERlZmVuc2VzTGlzdCgpO1xyXG4gIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogeyBjYXRhbG9nIH0gfSk7XHJcbn0pKTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgZGVmZW5zZXMgc3RhdHVzXHJcbiAqL1xyXG5yb3V0ZXIuZ2V0KCcvc3RhdHVzJywgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXE6IEF1dGhSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgdXNlciA9IHJlcS51c2VyISBhcyBhbnk7XHJcblxyXG4gIC8vIFJlc29sdmUgZW1waXJlIHVzaW5nIGVzdGFibGlzaGVkIHBhdHRlcm5cclxuICBjb25zdCBlbXBpcmVSb3cgPSBhd2FpdCBFbXBpcmVSZXNvbHV0aW9uU2VydmljZS5yZXNvbHZlRW1waXJlQnlVc2VyT2JqZWN0KHVzZXIpO1xyXG4gIGlmICghZW1waXJlUm93KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IEVSUk9SX01FU1NBR0VTLkVNUElSRV9OT1RfRk9VTkQgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBlbXBpcmVJZCA9IFN0cmluZyhlbXBpcmVSb3cuaWQpO1xyXG5cclxuICBjb25zdCB7IERlZmVuc2VzU2VydmljZSB9ID0gYXdhaXQgaW1wb3J0KCcuLi8uLi9zZXJ2aWNlcy9kZWZlbnNlcy9EZWZlbnNlc1NlcnZpY2UnKTtcclxuICBjb25zdCBzdGF0dXMgPSBhd2FpdCBEZWZlbnNlc1NlcnZpY2UuZ2V0U3RhdHVzKGVtcGlyZUlkKTtcclxuICByZXR1cm4gcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB7IHN0YXR1cyB9IH0pO1xyXG59KSk7XHJcblxyXG4vKipcclxuICogR2V0IGRlZmVuc2VzIHF1ZXVlXHJcbiAqL1xyXG5yb3V0ZXIuZ2V0KCcvcXVldWUnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogQXV0aFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICBjb25zdCB1c2VyID0gcmVxLnVzZXIhIGFzIGFueTtcclxuXHJcbiAgLy8gUmVzb2x2ZSBlbXBpcmUgdXNpbmcgZXN0YWJsaXNoZWQgcGF0dGVyblxyXG4gIGNvbnN0IGVtcGlyZVJvdyA9IGF3YWl0IEVtcGlyZVJlc29sdXRpb25TZXJ2aWNlLnJlc29sdmVFbXBpcmVCeVVzZXJPYmplY3QodXNlcik7XHJcbiAgaWYgKCFlbXBpcmVSb3cpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogRVJST1JfTUVTU0FHRVMuRU1QSVJFX05PVF9GT1VORCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGVtcGlyZUlkID0gU3RyaW5nKGVtcGlyZVJvdy5pZCk7XHJcbiAgY29uc3QgbG9jYXRpb25Db29yZCA9IFN0cmluZyhyZXEucXVlcnkubG9jYXRpb25Db29yZCB8fCAnJykudHJpbSgpIHx8IHVuZGVmaW5lZDtcclxuXHJcbiAgLy8gQnVpbGQgcXVlcnkgZm9yIGRlZmVuc2UgcXVldWVcclxuICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLkRFRkVOU0VfUVVFVUUpXHJcbiAgICAuc2VsZWN0KCdpZCwgZGVmZW5zZV9rZXksIHN0YXJ0ZWRfYXQsIGNvbXBsZXRlc19hdCwgbG9jYXRpb25fY29vcmQnKVxyXG4gICAgLmVxKERCX0ZJRUxEUy5CVUlMRElOR1MuRU1QSVJFX0lELCBlbXBpcmVJZClcclxuICAgIC5lcShEQl9GSUVMRFMuVEVDSF9RVUVVRS5TVEFUVVMsICdwZW5kaW5nJyk7XHJcblxyXG4gIGlmIChsb2NhdGlvbkNvb3JkKSB7XHJcbiAgICBxdWVyeSA9IHF1ZXJ5LmVxKERCX0ZJRUxEUy5CVUlMRElOR1MuTE9DQVRJT05fQ09PUkQsIGxvY2F0aW9uQ29vcmQpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgeyBkYXRhOiBpdGVtcyB9ID0gYXdhaXQgcXVlcnkub3JkZXIoREJfRklFTERTLlRFQ0hfUVVFVUUuQ09NUExFVEVTX0FULCB7IGFzY2VuZGluZzogdHJ1ZSwgbnVsbHNGaXJzdDogZmFsc2UgfSk7XHJcblxyXG4gIGNvbnN0IHF1ZXVlID0gKGl0ZW1zIHx8IFtdKS5tYXAoKGl0OiBhbnkpID0+ICh7XHJcbiAgICBpZDogU3RyaW5nKGl0LmlkIHx8ICcnKSxcclxuICAgIGRlZmVuc2VLZXk6IFN0cmluZyhpdC5kZWZlbnNlX2tleSB8fCAnJyksXHJcbiAgICBzdGFydGVkQXQ6IGl0LnN0YXJ0ZWRfYXQgfHwgbnVsbCxcclxuICAgIGNvbXBsZXRlc0F0OiBpdC5jb21wbGV0ZXNfYXQgfHwgbnVsbCxcclxuICAgIGJhc2VDb29yZDogU3RyaW5nKGl0LmxvY2F0aW9uX2Nvb3JkIHx8ICcnKVxyXG4gIH0pKTtcclxuXHJcbiAgcmV0dXJuIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogeyBxdWV1ZSB9IH0pO1xyXG59KSk7XHJcblxyXG4vKipcclxuICogU3RhcnQgZGVmZW5zZSBjb25zdHJ1Y3Rpb25cclxuICovXHJcbnJvdXRlci5wb3N0KCcvc3RhcnQnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcTogQXV0aFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICBjb25zdCB1c2VyID0gcmVxLnVzZXIhIGFzIGFueTtcclxuXHJcbiAgLy8gUmVzb2x2ZSBlbXBpcmUgdXNpbmcgZXN0YWJsaXNoZWQgcGF0dGVyblxyXG4gIGNvbnN0IGVtcGlyZVJvdyA9IGF3YWl0IEVtcGlyZVJlc29sdXRpb25TZXJ2aWNlLnJlc29sdmVFbXBpcmVCeVVzZXJPYmplY3QodXNlcik7XHJcbiAgaWYgKCFlbXBpcmVSb3cpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk5PVF9GT1VORCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogRVJST1JfTUVTU0FHRVMuRU1QSVJFX05PVF9GT1VORCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGVtcGlyZUlkID0gU3RyaW5nKGVtcGlyZVJvdy5pZCk7XHJcbiAgY29uc3QgeyBsb2NhdGlvbkNvb3JkLCBkZWZlbnNlS2V5IH0gPSByZXEuYm9keSBhcyB7IGxvY2F0aW9uQ29vcmQ/OiBzdHJpbmc7IGRlZmVuc2VLZXk/OiBEZWZlbnNlS2V5IH07XHJcbiAgXHJcbiAgaWYgKCFsb2NhdGlvbkNvb3JkIHx8ICFkZWZlbnNlS2V5KSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ2xvY2F0aW9uQ29vcmQgYW5kIGRlZmVuc2VLZXkgYXJlIHJlcXVpcmVkJyB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHsgRGVmZW5zZXNTZXJ2aWNlIH0gPSBhd2FpdCBpbXBvcnQoJy4uLy4uL3NlcnZpY2VzL2RlZmVuc2VzL0RlZmVuc2VzU2VydmljZScpO1xyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IERlZmVuc2VzU2VydmljZS5zdGFydChlbXBpcmVJZCwgbG9jYXRpb25Db29yZCwgZGVmZW5zZUtleSk7XHJcbiAgXHJcbiAgaWYgKCFyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgY29uc3QgZXJyb3JSZXNwb25zZTogYW55ID0ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6IChyZXN1bHQgYXMgYW55KS5lcnJvciA/PyAocmVzdWx0IGFzIGFueSkubWVzc2FnZSxcclxuICAgICAgbWVzc2FnZTogKHJlc3VsdCBhcyBhbnkpLm1lc3NhZ2UgPz8gKHJlc3VsdCBhcyBhbnkpLmVycm9yXHJcbiAgICB9O1xyXG4gICAgaWYgKChyZXN1bHQgYXMgYW55KS5jb2RlKSBlcnJvclJlc3BvbnNlLmNvZGUgPSAocmVzdWx0IGFzIGFueSkuY29kZTtcclxuICAgIGlmICgocmVzdWx0IGFzIGFueSkuZGV0YWlscykgZXJyb3JSZXNwb25zZS5kZXRhaWxzID0gKHJlc3VsdCBhcyBhbnkpLmRldGFpbHM7XHJcbiAgICBpZiAoKHJlc3VsdCBhcyBhbnkpLnJlYXNvbnMpIGVycm9yUmVzcG9uc2UucmVhc29ucyA9IChyZXN1bHQgYXMgYW55KS5yZWFzb25zO1xyXG4gICAgY29uc3Qgc3RhdHVzQ29kZSA9IChyZXN1bHQgYXMgYW55KS5jb2RlID09PSAnQUxSRUFEWV9JTl9QUk9HUkVTUycgPyA0MDkgOiBIVFRQX1NUQVRVUy5CQURfUkVRVUVTVDtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oZXJyb3JSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQuZGF0YSwgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2UgfSk7XHJcbn0pKTtcclxuXHJcbi8qKlxyXG4gKiBDYW5jZWwgYSBwZW5kaW5nIGRlZmVuc2UgaXRlbVxyXG4gKi9cclxucm91dGVyLmRlbGV0ZSgnL3F1ZXVlLzppZCcsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxOiBBdXRoUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIGNvbnN0IHVzZXIgPSByZXEudXNlciEgYXMgYW55O1xyXG5cclxuICAvLyBSZXNvbHZlIGVtcGlyZSB1c2luZyBlc3RhYmxpc2hlZCBwYXR0ZXJuXHJcbiAgY29uc3QgZW1waXJlUm93ID0gYXdhaXQgRW1waXJlUmVzb2x1dGlvblNlcnZpY2UucmVzb2x2ZUVtcGlyZUJ5VXNlck9iamVjdCh1c2VyKTtcclxuICBpZiAoIWVtcGlyZVJvdykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBFUlJPUl9NRVNTQUdFUy5FTVBJUkVfTk9UX0ZPVU5EIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZW1waXJlSWQgPSBTdHJpbmcoZW1waXJlUm93LmlkKTtcclxuICBjb25zdCBpZCA9IFN0cmluZyhyZXEucGFyYW1zLmlkIHx8ICcnKS50cmltKCk7XHJcbiAgXHJcbiAgaWYgKCFpZCkgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuQkFEX1JFUVVFU1QpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHF1ZXVlIGl0ZW0gaWQnIH0pO1xyXG5cclxuICBjb25zdCB7IGRhdGE6IHFJdGVtIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgLmZyb20oREJfVEFCTEVTLkRFRkVOU0VfUVVFVUUpXHJcbiAgICAuc2VsZWN0KCdpZCwgZW1waXJlX2lkLCBkZWZlbnNlX2tleSwgc3RhdHVzLCBzdGFydGVkX2F0LCBjb21wbGV0ZXNfYXQnKVxyXG4gICAgLmVxKERCX0ZJRUxEUy5CVUlMRElOR1MuSUQsIGlkKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmICghcUl0ZW0gfHwgU3RyaW5nKChxSXRlbSBhcyBhbnkpLmVtcGlyZV9pZCkgIT09IGVtcGlyZUlkKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IEVSUk9SX01FU1NBR0VTLlFVRVVFX0lURU1fTk9UX0ZPVU5EIH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKFN0cmluZygocUl0ZW0gYXMgYW55KS5zdGF0dXMgfHwgJycpICE9PSAncGVuZGluZycpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLkJBRF9SRVFVRVNUKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnT25seSBwZW5kaW5nIGl0ZW1zIGNhbiBiZSBjYW5jZWxsZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gQ2hlY2sgaWYgaW4gcHJvZ3Jlc3MgKGhhcyBzdGFydGVkIGFuZCBub3QgeWV0IGNvbXBsZXRlZClcclxuICBpZiAoKHFJdGVtIGFzIGFueSkuc3RhcnRlZF9hdCAmJiAocUl0ZW0gYXMgYW55KS5jb21wbGV0ZXNfYXQpIHtcclxuICAgIGNvbnN0IGNvbXBsZXRlc0F0ID0gbmV3IERhdGUoKHFJdGVtIGFzIGFueSkuY29tcGxldGVzX2F0KS5nZXRUaW1lKCk7XHJcbiAgICBpZiAoY29tcGxldGVzQXQgPiBEYXRlLm5vdygpKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLkJBRF9SRVFVRVNUKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnQ2Fubm90IGNhbmNlbCBhbiBpbi1wcm9ncmVzcyBkZWZlbnNlIHlldCcgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhd2FpdCBzdXBhYmFzZS5mcm9tKERCX1RBQkxFUy5ERUZFTlNFX1FVRVVFKS51cGRhdGUoeyBzdGF0dXM6ICdjYW5jZWxsZWQnIH0pLmVxKERCX0ZJRUxEUy5CVUlMRElOR1MuSUQsIGlkKTtcclxuICByZXR1cm4gcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB7IGNhbmNlbGxlZElkOiBpZCB9LCBtZXNzYWdlOiAnRGVmZW5zZSBjb25zdHJ1Y3Rpb24gY2FuY2VsbGVkJyB9KTtcclxufSkpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xyXG4iXSwidmVyc2lvbiI6M30=
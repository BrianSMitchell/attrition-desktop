{"file":"C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\fleetRoutes.test.ts","mappings":"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","names":[],"sources":["C:\\Projects\\Attrition\\packages\\server\\src\\__tests__\\fleetRoutes.test.ts"],"sourcesContent":["import request from 'supertest';\nimport express from 'express';\nimport fleetRoutes from '../routes/game/fleets';\nimport { authenticate } from '../middleware/auth';\nimport { supabase } from '../config/supabase';\nimport { EmpireResolutionService } from '../services/empire/EmpireResolutionService';\nimport { HTTP_STATUS, ERROR_MESSAGES } from '../constants/response-formats';\n\n// Mock dependencies\nimport { DB_FIELDS } from '../../../constants/database-fields';\nimport { GAME_CONSTANTS } from '@game/shared';\njest.mock('../config/supabase');\njest.mock('../services/empire/EmpireResolutionService');\njest.mock('../services/fleets/FleetMovementService');\njest.mock('../middleware/auth');\njest.mock('@game/shared', () => ({\n  getUnitSpec: jest.fn(() => ({ name: 'Mock Unit', credits: GAME_CONSTANTS.STARTING_CREDITS }))\n}));\n\nconst mockSupabase = supabase as jest.Mocked<typeof supabase>;\nconst mockEmpireResolutionService = EmpireResolutionService as jest.Mocked<typeof EmpireResolutionService>;\nconst mockFleetMovementService = FleetMovementService as jest.Mocked<typeof FleetMovementService>;\nconst mockAuthenticate = authenticate as jest.MockedFunction<typeof authenticate>;\n\n// Test app setup\nconst app = express();\napp.use(express.json());\napp.use('/fleets', fleetRoutes);\n\n// Add basic error handling for debugging\napp.use((error: any, req: any, res: any, next: any) => {\n  console.error('Test error:', error.message);\n  res.status(HTTP_STATUS.INTERNAL_SERVER_ERROR).json({ success: false, error: error.message });\n});\n\n// Mock user for authentication\nconst mockUser = {\n  _id: 'user123',\n  id: 'user123',\n  username: 'testuser'\n};\n\nconst mockEmpire = {\n  id: 'empire123',\n  name: 'Test Empire',\n  user_id: 'user123'\n};\n\ndescribe('Fleet Routes', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    \n    // Mock authentication middleware\n    mockAuthenticate.mockImplementation((req: any, res: any, next: any) => {\n      req.user = mockUser;\n      next();\n    });\n\n    // Mock empire resolution\n    mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n  });\n\n  describe('GET /fleets', () => {\n    it('should list all fleets for authenticated empire (FR-1)', async () => {\n      // Mock fleet data\n      const mockFleets = [\n        {\n          id: 'fleet1',\n          name: 'Alpha Fleet',\n          size_credits: 1000,\n          created_at: '2023-01-01T00:00:00Z',\n          location_coord: 'A00:00:01:01'\n        },\n        {\n          id: 'fleet2', \n          name: 'Beta Fleet',\n          size_credits: 1500,\n          created_at: '2023-01-02T00:00:00Z',\n          location_coord: 'A00:00:01:02'\n        }\n      ];\n\n      // Mock Supabase query\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        order: jest.fn().mockResolvedValue({ data: mockFleets, error: null })\n      };\n      mockSupabase.from.mockReturnValue(mockQuery as any);\n\n      const response = await request(app)\n        .get('/fleets')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body).toEqual({\n        success: true,\n        data: {\n          fleets: [\n            {\n              _id: 'fleet1',\n              name: 'Alpha Fleet',\n              ownerName: 'Test Empire',\n              arrival: null,\n              sizeCredits: 1000,\n              locationCoord: 'A00:00:01:01'\n            },\n            {\n              _id: 'fleet2',\n              name: 'Beta Fleet',\n              ownerName: 'Test Empire',\n              arrival: null,\n              sizeCredits: 1500,\n              locationCoord: 'A00:00:01:02'\n            }\n          ]\n        }\n      });\n\n      expect(mockQuery.eq).toHaveBeenCalledWith(DB_FIELDS.BUILDINGS.EMPIRE_ID, 'empire123');\n    });\n\n    it('should filter fleets by base coordinate when provided (FR-2)', async () => {\n      const mockFleets = [\n        {\n          id: 'fleet1',\n          name: 'Alpha Fleet',\n          size_credits: 1000,\n          created_at: '2023-01-01T00:00:00Z',\n          location_coord: 'A00:00:01:01'\n        }\n      ];\n\n      // Create a proper mock query chain that handles multiple eq calls\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        order: jest.fn().mockResolvedValue({ data: mockFleets, error: null })\n      };\n      // Ensure eq method returns the mock query object consistently\n      mockQuery.eq.mockReturnValue(mockQuery);\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      // Reset empire resolution mock for this test\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets?base=A00:00:01:01');\n      \n      expect(response.status).toBe(HTTP_STATUS.OK);\n\n      // Verify filter was applied\n      expect(mockQuery.eq).toHaveBeenCalledWith(DB_FIELDS.BUILDINGS.EMPIRE_ID, 'empire123');\n      expect(mockQuery.eq).toHaveBeenCalledWith(DB_FIELDS.BUILDINGS.LOCATION_COORD, 'A00:00:01:01');\n    });\n\n    it('should return 404 when empire not found (FR-15)', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(null);\n\n      const response = await request(app)\n        .get('/fleets')\n        .expect(HTTP_STATUS.NOT_FOUND);\n\n      expect(response.body).toEqual({\n        success: false,\n        error: ERROR_MESSAGES.EMPIRE_NOT_FOUND\n      });\n    });\n\n    it('should handle database errors (FR-15)', async () => {\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        order: jest.fn().mockResolvedValue({ \n          data: null, \n          error: { message: 'Database connection failed' }\n        })\n      };\n      mockSupabase.from.mockReturnValue(mockQuery as any);\n\n      const response = await request(app)\n        .get('/fleets')\n        .expect(HTTP_STATUS.INTERNAL_SERVER_ERROR);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'DB_ERROR',\n        error: 'Database connection failed'\n      });\n    });\n\n    it('should follow established response format (FR-12)', async () => {\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        order: jest.fn().mockResolvedValue({ data: [], error: null })\n      };\n      mockSupabase.from.mockReturnValue(mockQuery as any);\n\n      const response = await request(app)\n        .get('/fleets')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body).toHaveProperty('success', true);\n      expect(response.body).toHaveProperty('data');\n      expect(response.body.data).toHaveProperty('fleets');\n      expect(Array.isArray(response.body.data.fleets)).toBe(true);\n    });\n  });\n\n  describe('GET /fleets/overview', () => {\n    it('should return fleet overview for a specific base (FR-5, FR-7)', async () => {\n      const mockFleets = [\n        {\n          id: 'fleet1',\n          name: 'Alpha Fleet',\n          units: [\n            { unitKey: 'fighter', count: 10 },\n            { unitKey: 'bomber', count: 5 }\n          ]\n        }\n      ];\n\n      // Create a mock that properly tracks all eq calls in the chain\n      const mockEq = jest.fn();\n      const secondQuery = { eq: jest.fn().mockResolvedValue({ data: mockFleets, error: null }) };\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: mockEq\n      };\n      \n      // Set up the chaining: first eq returns an object with eq, second eq resolves\n      mockEq.mockReturnValue(secondQuery);\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      // Reset empire resolution mock for this test\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/overview?base=A00:00:01:01')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body).toEqual({\n        success: true,\n        data: {\n          fleets: [\n            {\n              _id: 'fleet1',\n              name: 'Alpha Fleet',\n              units: [\n                { type: 'fighter', count: 10 },\n                { type: 'bomber', count: 5 }\n              ]\n            }\n          ]\n        }\n      });\n\n      expect(mockEq).toHaveBeenCalledWith(DB_FIELDS.BUILDINGS.EMPIRE_ID, 'empire123');\n      expect(secondQuery.eq).toHaveBeenCalledWith(DB_FIELDS.BUILDINGS.LOCATION_COORD, 'A00:00:01:01');\n    });\n\n    it('should require base parameter (FR-15)', async () => {\n      const response = await request(app)\n        .get('/fleets/overview')\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'INVALID_REQUEST',\n        message: 'base parameter is required',\n        details: { field: 'base' }\n      });\n    });\n\n    it('should handle empty units array gracefully (FR-7)', async () => {\n      const mockFleets = [\n        {\n          id: 'fleet1',\n          name: 'Empty Fleet',\n          units: []\n        }\n      ];\n\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      // Set up proper chaining for two eq calls  \n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockResolvedValue({ data: mockFleets, error: null })\n      });\n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      // Reset empire resolution mock for this test\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/overview?base=A00:00:01:01')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body.data.fleets[0].units).toEqual([]);\n    });\n\n    it('should handle malformed units data (FR-7)', async () => {\n      const mockFleets = [\n        {\n          id: 'fleet1',\n          name: 'Fleet with Bad Data',\n          units: null // Malformed units data\n        }\n      ];\n\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      // Set up proper chaining for two eq calls\n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockResolvedValue({ data: mockFleets, error: null })\n      });\n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      // Reset empire resolution mock for this test\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/overview?base=A00:00:01:01')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body.data.fleets[0].units).toEqual([]);\n    });\n  });\n\n  describe('GET /fleets/:id', () => {\n    it('should return detailed fleet information for valid fleet ID (FR-3)', async () => {\n      const mockFleet = {\n        id: 'fleet123',\n        name: 'Alpha Strike Force',\n        location_coord: 'A00:00:01:01',\n        units: [\n          { unitKey: 'fighter', count: 25 },\n          { unitKey: 'bomber', count: 10 }\n        ],\n        size_credits: 15000\n      };\n\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      // Chain two eq calls and resolve with mock fleet\n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({ data: mockFleet, error: null })\n        })\n      });\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/fleet123')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body).toEqual({\n        success: true,\n        data: {\n          fleet: {\n            _id: 'fleet123',\n            name: 'Alpha Strike Force',\n            locationCoord: 'A00:00:01:01',\n            ownerName: 'Test Empire',\n            units: [\n              { unitKey: 'fighter', name: 'Mock Unit', count: 25 },\n              { unitKey: 'bomber', name: 'Mock Unit', count: 10 }\n            ],\n            sizeCredits: 15000\n          }\n        }\n      });\n    });\n\n    it('should return 400 for empty fleet ID parameter', async () => {\n      // Test with an encoded empty string as fleet ID (more realistic scenario)\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      \n      const response = await request(app)\n        .get('/fleets/%20') // URL-encoded space that will be trimmed to empty string\n        \n      expect(response.status).toBe(HTTP_STATUS.BAD_REQUEST);\n      expect(response.body).toEqual({\n        success: false,\n        code: 'INVALID_REQUEST',\n        message: 'Invalid fleet id',\n        details: { field: DB_FIELDS.BUILDINGS.ID }\n      });\n    });\n\n    it('should handle routes without fleet ID parameter correctly', async () => {\n      // When accessing /fleets/ without ID, it should match the list route, not the detail route\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        order: jest.fn().mockResolvedValue({ data: [], error: null })\n      };\n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      \n      const response = await request(app)\n        .get('/fleets')\n        .expect(HTTP_STATUS.OK);\n        \n      // Should return list format, not detail format\n      expect(response.body).toHaveProperty('success', true);\n      expect(response.body.data).toHaveProperty('fleets');\n      expect(Array.isArray(response.body.data.fleets)).toBe(true);\n    });\n\n    it('should return 404 when fleet not found or not owned by user', async () => {\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      // Mock Postgres error code for no rows returned\n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({ \n            data: null, \n            error: { code: 'PGRST116', message: 'No rows returned' }\n          })\n        })\n      });\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/nonexistent')\n        .expect(HTTP_STATUS.NOT_FOUND);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'FLEET_NOT_FOUND',\n        error: ERROR_MESSAGES.FLEET_NOT_FOUND\n      });\n    });\n\n    it('should return 404 when empire not found', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(null);\n\n      const response = await request(app)\n        .get('/fleets/fleet123')\n        .expect(HTTP_STATUS.NOT_FOUND);\n\n      expect(response.body).toEqual({\n        success: false,\n        error: ERROR_MESSAGES.EMPIRE_NOT_FOUND\n      });\n    });\n\n    it('should handle database errors gracefully', async () => {\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({ \n            data: null, \n            error: { code: 'OTHER_ERROR', message: 'Database connection failed' }\n          })\n        })\n      });\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/fleet123')\n        .expect(HTTP_STATUS.INTERNAL_SERVER_ERROR);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'DB_ERROR',\n        error: 'Database connection failed'\n      });\n    });\n\n    it('should handle empty units array gracefully', async () => {\n      const mockFleet = {\n        id: 'fleet123',\n        name: 'Empty Fleet',\n        location_coord: 'A00:00:01:01',\n        units: [], // Empty units\n        size_credits: 0\n      };\n\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({ data: mockFleet, error: null })\n        })\n      });\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/fleet123')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body.data.fleet.units).toEqual([]);\n    });\n\n    it('should handle malformed units data gracefully', async () => {\n      const mockFleet = {\n        id: 'fleet123',\n        name: 'Fleet with Bad Data',\n        location_coord: 'A00:00:01:01',\n        units: null, // Malformed units\n        size_credits: 5000\n      };\n\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({ data: mockFleet, error: null })\n        })\n      });\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/fleet123')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body.data.fleet.units).toEqual([]);\n    });\n\n    it('should use getUnitSpec for unit names and handle spec errors', async () => {\n      const mockFleet = {\n        id: 'fleet123',\n        name: 'Mixed Fleet',\n        location_coord: 'A00:00:01:01',\n        units: [\n          { unitKey: 'valid_unit', count: 5 },\n          { unitKey: 'invalid_unit', count: 3 }\n        ],\n        size_credits: 8000\n      };\n\n      // Mock getUnitSpec to throw for invalid_unit\n      const mockGetUnitSpec = require('@game/shared').getUnitSpec;\n      mockGetUnitSpec.mockImplementation((key: string) => {\n        if (key === 'valid_unit') return { name: 'Valid Unit Name' };\n        throw new Error('Unit not found');\n      });\n\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis()\n      };\n      mockQuery.eq.mockReturnValue({\n        eq: jest.fn().mockReturnValue({\n          single: jest.fn().mockResolvedValue({ data: mockFleet, error: null })\n        })\n      });\n      \n      mockSupabase.from.mockReturnValue(mockQuery as any);\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .get('/fleets/fleet123')\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body.data.fleet.units).toEqual([\n        { unitKey: 'valid_unit', name: 'Valid Unit Name', count: 5 },\n        { unitKey: 'invalid_unit', name: 'invalid_unit', count: 3 } // Fallback to key\n      ]);\n    });\n  });\n\n  describe('POST /fleets/:id/move', () => {\n    it('should successfully initiate fleet movement (FR-4)', async () => {\n      const mockMovement = {\n        id: 'movement123',\n        fleet_id: 'fleet123',\n        empire_id: 'empire123',\n        origin_coord: 'A00:00:01:01',\n        destination_coord: 'A00:00:02:02',\n        departure_time: '2023-01-01T00:00:00Z',\n        estimated_arrival_time: '2023-01-01T02:00:00Z',\n        status: 'travelling',\n        travel_time_hours: 2,\n        fleet_speed: 10,\n        distance: 100\n      };\n\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: true,\n        movement: mockMovement\n      });\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.OK);\n\n      expect(response.body).toEqual({\n        success: true,\n        data: { movement: mockMovement },\n        message: 'Fleet movement initiated successfully'\n      });\n\n      expect(mockFleetMovementService.dispatchFleet).toHaveBeenCalledWith(\n        'fleet123',\n        'empire123',\n        { destinationCoord: 'A00:00:02:02' }\n      );\n    });\n\n    it('should return 400 for invalid fleet ID', async () => {\n      const response = await request(app)\n        .post('/fleets/%20/move') // URL-encoded space\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'INVALID_REQUEST',\n        message: 'Invalid fleet id',\n        details: { field: DB_FIELDS.BUILDINGS.ID }\n      });\n    });\n\n    it('should return 400 when destinationCoord is missing', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({}) // No destinationCoord\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'INVALID_REQUEST',\n        message: 'destinationCoord is required',\n        details: { field: 'destinationCoord' }\n      });\n    });\n\n    it('should return 400 when destinationCoord is not a string', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 123 }) // Not a string\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'INVALID_REQUEST',\n        message: 'destinationCoord is required',\n        details: { field: 'destinationCoord' }\n      });\n    });\n\n    it('should return 404 when empire not found', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(null);\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.NOT_FOUND);\n\n      expect(response.body).toEqual({\n        success: false,\n        error: ERROR_MESSAGES.EMPIRE_NOT_FOUND\n      });\n    });\n\n    it('should return 404 when fleet not found', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: false,\n        code: 'FLEET_NOT_FOUND',\n        error: ERROR_MESSAGES.FLEET_NOT_FOUND\n      });\n\n      const response = await request(app)\n        .post('/fleets/nonexistent/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.NOT_FOUND);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'FLEET_NOT_FOUND',\n        error: ERROR_MESSAGES.FLEET_NOT_FOUND\n      });\n    });\n\n    it('should return 400 for empty fleet', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: false,\n        code: 'EMPTY_FLEET',\n        error: 'Fleet has no units to dispatch'\n      });\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'EMPTY_FLEET',\n        error: 'Fleet has no units to dispatch'\n      });\n    });\n\n    it('should return 400 when fleet is already moving', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: false,\n        code: 'FLEET_ALREADY_MOVING',\n        error: 'Fleet is already moving'\n      });\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'FLEET_ALREADY_MOVING',\n        error: 'Fleet is already moving'\n      });\n    });\n\n    it('should return 400 when destination is invalid', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: false,\n        code: 'INVALID_DESTINATION',\n        error: 'Invalid coordinate format'\n      });\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'invalid-coord' })\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'INVALID_DESTINATION',\n        error: 'Invalid coordinate format'\n      });\n    });\n\n    it('should return 400 when fleet is already at destination', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: false,\n        code: 'ALREADY_AT_DESTINATION',\n        error: 'Fleet is already at the destination'\n      });\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:01:01' }) // Same as current location\n        .expect(HTTP_STATUS.BAD_REQUEST);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'ALREADY_AT_DESTINATION',\n        error: 'Fleet is already at the destination'\n      });\n    });\n\n    it('should return 500 for dispatch errors', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: false,\n        code: 'DISPATCH_ERROR',\n        error: 'Failed to dispatch fleet'\n      });\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.INTERNAL_SERVER_ERROR);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: 'DISPATCH_ERROR',\n        error: 'Failed to dispatch fleet'\n      });\n    });\n\n    it('should handle service exceptions gracefully', async () => {\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockRejectedValue(new Error('Service error'));\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.INTERNAL_SERVER_ERROR);\n\n      expect(response.body).toEqual({\n        success: false,\n        code: ERROR_MESSAGES.INTERNAL_ERROR,\n        error: 'Failed to initiate fleet movement'\n      });\n    });\n\n    it('should follow established response format (FR-12)', async () => {\n      const mockMovement = {\n        id: 'movement123',\n        status: 'travelling'\n      };\n\n      mockEmpireResolutionService.resolveEmpireByUserObject.mockResolvedValue(mockEmpire as any);\n      mockFleetMovementService.dispatchFleet.mockResolvedValue({\n        success: true,\n        movement: mockMovement\n      });\n\n      const response = await request(app)\n        .post('/fleets/fleet123/move')\n        .send({ destinationCoord: 'A00:00:02:02' })\n        .expect(HTTP_STATUS.OK);\n\n      // Verify response format\n      expect(response.body).toHaveProperty('success', true);\n      expect(response.body).toHaveProperty('data');\n      expect(response.body.data).toHaveProperty('movement');\n      expect(response.body).toHaveProperty('message');\n    });\n  });\n\n  describe('Authentication and Empire Resolution', () => {\n    it('should use EmpireResolutionService for consistent empire handling (FR-14)', async () => {\n      const mockQuery = {\n        select: jest.fn().mockReturnThis(),\n        eq: jest.fn().mockReturnThis(),\n        order: jest.fn().mockResolvedValue({ data: [], error: null })\n      };\n      mockSupabase.from.mockReturnValue(mockQuery as any);\n\n      await request(app)\n        .get('/fleets')\n        .expect(HTTP_STATUS.OK);\n\n      expect(mockEmpireResolutionService.resolveEmpireByUserObject)\n        .toHaveBeenCalledWith(mockUser);\n    });\n  });\n});\n\n\n\n\n\n\n"],"version":3}
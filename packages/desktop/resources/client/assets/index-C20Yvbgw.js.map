{"version":3,"file":"index-C20Yvbgw.js","sources":["../../../../node_modules/.pnpm/react@18.3.1/node_modules/react/cjs/react-jsx-runtime.production.min.js","../../../../node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js","../../../../node_modules/.pnpm/@remix-run+router@1.23.0/node_modules/@remix-run/router/dist/router.js","../../../../node_modules/.pnpm/react-dom@18.3.1_react@18.3.1/node_modules/react-dom/client.js","../../../../node_modules/.pnpm/react-router@6.30.1_react@18.3.1/node_modules/react-router/dist/index.js","../../../../node_modules/.pnpm/react-router-dom@6.30.1_rea_32183f923d2f77881bbb08a88c6f2afc/node_modules/react-router-dom/dist/index.js","../../../../node_modules/.pnpm/zustand@4.5.7_@types+react@18.3.23_react@18.3.1/node_modules/zustand/esm/middleware.mjs","../../src/services/httpInstrumentation.ts","../../src/services/tokenProvider.ts","../../src/services/authService.ts","../../../../node_modules/.pnpm/engine.io-parser@5.2.3/node_modules/engine.io-parser/build/esm/commons.js","../../../../node_modules/.pnpm/engine.io-parser@5.2.3/node_modules/engine.io-parser/build/esm/encodePacket.browser.js","../../../../node_modules/.pnpm/engine.io-parser@5.2.3/node_modules/engine.io-parser/build/esm/contrib/base64-arraybuffer.js","../../../../node_modules/.pnpm/engine.io-parser@5.2.3/node_modules/engine.io-parser/build/esm/decodePacket.browser.js","../../../../node_modules/.pnpm/engine.io-parser@5.2.3/node_modules/engine.io-parser/build/esm/index.js","../../../../node_modules/.pnpm/@socket.io+component-emitter@3.1.2/node_modules/@socket.io/component-emitter/lib/esm/index.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/globals.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/util.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/transport.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/contrib/parseqs.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/transports/polling.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/contrib/has-cors.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/transports/polling-xhr.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/transports/websocket.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/transports/index.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/transports/webtransport.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/contrib/parseuri.js","../../../../node_modules/.pnpm/engine.io-client@6.6.3/node_modules/engine.io-client/build/esm/socket.js","../../../../node_modules/.pnpm/socket.io-parser@4.2.4/node_modules/socket.io-parser/build/esm/is-binary.js","../../../../node_modules/.pnpm/socket.io-parser@4.2.4/node_modules/socket.io-parser/build/esm/binary.js","../../../../node_modules/.pnpm/socket.io-parser@4.2.4/node_modules/socket.io-parser/build/esm/index.js","../../../../node_modules/.pnpm/socket.io-client@4.8.1/node_modules/socket.io-client/build/esm/on.js","../../../../node_modules/.pnpm/socket.io-client@4.8.1/node_modules/socket.io-client/build/esm/socket.js","../../../../node_modules/.pnpm/socket.io-client@4.8.1/node_modules/socket.io-client/build/esm/contrib/backo2.js","../../../../node_modules/.pnpm/socket.io-client@4.8.1/node_modules/socket.io-client/build/esm/manager.js","../../../../node_modules/.pnpm/socket.io-client@4.8.1/node_modules/socket.io-client/build/esm/index.js","../../../../node_modules/.pnpm/socket.io-client@4.8.1/node_modules/socket.io-client/build/esm/url.js","../../src/utils/apiConfig.ts","../../src/services/api.ts","../../src/services/socket.ts","../../src/stores/authStore.ts","../../src/contexts/NetworkContext.tsx","../../src/contexts/SyncContext.tsx","../../src/components/layout/ConnectionBanner.tsx","../../src/components/auth/Login.tsx","../../src/components/auth/Register.tsx","../../src/stores/modalStore.ts","../../src/components/ui/Modal.tsx","../../src/components/game/ResearchModal.tsx","../../../shared/dist/esm/utils.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/helpers/util.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/ZodError.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/locales/en.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/errors.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/helpers/parseUtil.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/helpers/errorUtil.js","../../../../node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/types.js","../../../shared/dist/esm/validation.js","../../../shared/dist/esm/random.js","../../../shared/dist/esm/tech.js","../../../shared/dist/esm/buildings.js","../../../shared/dist/esm/overhaul.js","../../../shared/dist/esm/defenses.js","../../../shared/dist/esm/units.js","../../../shared/dist/esm/structureLevels.js","../../../shared/dist/esm/energyBudget.js","../../src/services/universeService.ts","../../src/components/game/GalaxyModal.tsx","../../src/components/game/FleetModal.tsx","../../src/components/game/GameInfoModal.tsx","../../src/components/game/CapacityBreakdownModal.tsx","../../../shared/dist/esm/capacities.js","../../src/components/game/EnergyBreakdownModal.tsx","../../src/components/game/AreaBreakdownModal.tsx","../../src/components/game/PopulationBreakdownModal.tsx","../../src/components/game/levelTables/structures/index.ts","../../src/components/game/levelTables/structures/urban_structures.ts","../../src/components/game/levelTables/structures/solar_plants.ts","../../src/components/game/levelTables/structures/gas_plants.ts","../../src/components/game/levelTables/structures/fusion_plants.ts","../../src/components/game/levelTables/structures/research_labs.ts","../../src/components/game/levelTables/structures/metal_refineries.ts","../../src/components/game/levelTables/structures/robotic_factories.ts","../../src/components/game/levelTables/structures/shipyards.ts","../../src/components/game/levelTables/structures/orbital_shipyards.ts","../../src/components/game/levelTables/structures/spaceports.ts","../../src/components/game/levelTables/structures/command_centers.ts","../../src/components/game/levelTables/structures/android_factories.ts","../../src/components/game/levelTables/structures/economic_centers.ts","../../src/components/game/levelTables/structures/terraform.ts","../../src/components/game/levelTables/structures/multi_level_platforms.ts","../../src/components/game/levelTables/structures/orbital_base.ts","../../src/components/game/levelTables/structures/crystal_mines.ts","../../src/stores/baseStore.ts","../../src/components/game/StructureLevelsModal.tsx","../../src/components/game/levelTables/research/energy.ts","../../src/components/game/levelTables/research/computer.ts","../../src/components/game/levelTables/research/armour.ts","../../src/components/game/levelTables/research/laser.ts","../../src/components/game/levelTables/research/missiles.ts","../../src/components/game/levelTables/research/stellar_drive.ts","../../src/components/game/levelTables/research/plasma.ts","../../src/components/game/levelTables/research/photon.ts","../../src/components/game/levelTables/research/warp_drive.ts","../../src/components/game/levelTables/research/shielding.ts","../../src/components/game/levelTables/research/stealth.ts","../../src/components/game/levelTables/research/artificial_intelligence.ts","../../src/components/game/levelTables/research/cybernetics.ts","../../src/components/game/levelTables/research/ion.ts","../../src/components/game/levelTables/research/disruptor.ts","../../src/components/game/levelTables/research/tachyon_communications.ts","../../src/components/game/levelTables/research/anti_gravity.ts","../../src/components/game/levelTables/research/index.ts","../../src/components/game/levelTables/research/metrics.ts","../../src/components/game/ResearchLevelsModal.tsx","../../src/components/game/ModalManager.tsx","../../src/components/game/Dashboard.tsx","../../src/services/statusService.ts","../../src/components/ui/StatusDot.tsx","../../src/components/ui/SyncDot.tsx","../../src/components/layout/Layout.tsx","../../src/stores/universeMapStore.ts","../../src/components/game/map/NavigationBreadcrumb.tsx","../../src/components/game/map/LocationTooltip.tsx","../../src/components/game/map/mapConstants.ts","../../src/components/game/map/helpers/offscreenLayers.ts","../../src/components/game/map/UniverseOverview.tsx","../../src/components/game/map/RegionView.tsx","../../src/components/game/map/systemBodies.ts","../../src/components/game/map/SystemView.tsx","../../src/components/game/map/StarInfoPanel.tsx","../../src/components/game/map/coordinateMapping.ts","../../src/services/regionSummaryQueue.ts","../../src/components/game/UniverseMap.tsx","../../src/components/game/map/GalaxyView.tsx","../../src/components/game/GalaxyPage.tsx","../../src/components/game/PlanetPage.tsx","../../src/services/baseStatsService.ts","../../src/components/game/BaseEventsTable.tsx","../../src/components/game/BaseOverview.tsx","../../src/services/techService.ts","../../src/services/structuresService.ts","../../src/services/defensesService.ts","../../src/services/unitsService.ts","../../src/services/fleetsService.ts","../../src/services/capacitiesService.ts","../../src/components/game/PlanetInfoBlock.tsx","../../src/components/game/PlanetVisual.tsx","../../src/services/basesService.ts","../../src/components/ui/NetworkAwareButton.tsx","../../src/components/game/BuildTable.tsx","../../src/components/game/StructuresBuildTable.tsx","../../src/contexts/ToastContext.tsx","../../src/components/game/ResearchBuildTable.tsx","../../src/components/game/ResearchQueuePanel.tsx","../../src/components/game/StructuresQueuePanel.tsx","../../src/components/game/DefensesBuildTable.tsx","../../src/components/game/UnitsBuildTable.tsx","../../src/components/ui/StatLink.tsx","../../src/components/game/BaseDetail.tsx","../../src/components/game/BaseManagement.tsx","../../src/components/game/BasesPage.tsx","../../src/components/game/BasePage.tsx","../../src/components/help/helpData.tsx","../../src/components/help/faqData.tsx","../../src/contexts/UpdateContext.tsx","../../src/components/ui/UpdateSettings.tsx","../../src/components/help/HelpPage.tsx","../../src/components/game/FleetPage.tsx","../../src/components/admin/PerformancePage.tsx","../../src/components/ui/SyncFeedback.tsx","../../src/components/ui/UpdateNotification.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","/**\n * @remix-run/router v1.23.0\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\n////////////////////////////////////////////////////////////////////////////////\n//#region Types and Constants\n////////////////////////////////////////////////////////////////////////////////\n/**\n * Actions represent the type of change to a location value.\n */\nvar Action;\n(function (Action) {\n  /**\n   * A POP indicates a change to an arbitrary index in the history stack, such\n   * as a back or forward navigation. It does not describe the direction of the\n   * navigation, only that the current index changed.\n   *\n   * Note: This is the default action for newly created history objects.\n   */\n  Action[\"Pop\"] = \"POP\";\n  /**\n   * A PUSH indicates a new entry being added to the history stack, such as when\n   * a link is clicked and a new page loads. When this happens, all subsequent\n   * entries in the stack are lost.\n   */\n  Action[\"Push\"] = \"PUSH\";\n  /**\n   * A REPLACE indicates the entry at the current index in the history stack\n   * being replaced by a new one.\n   */\n  Action[\"Replace\"] = \"REPLACE\";\n})(Action || (Action = {}));\nconst PopStateEventType = \"popstate\";\n/**\n * Memory history stores the current location in memory. It is designed for use\n * in stateful non-browser environments like tests and React Native.\n */\nfunction createMemoryHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  let {\n    initialEntries = [\"/\"],\n    initialIndex,\n    v5Compat = false\n  } = options;\n  let entries; // Declare so we can access from createMemoryLocation\n  entries = initialEntries.map((entry, index) => createMemoryLocation(entry, typeof entry === \"string\" ? null : entry.state, index === 0 ? \"default\" : undefined));\n  let index = clampIndex(initialIndex == null ? entries.length - 1 : initialIndex);\n  let action = Action.Pop;\n  let listener = null;\n  function clampIndex(n) {\n    return Math.min(Math.max(n, 0), entries.length - 1);\n  }\n  function getCurrentLocation() {\n    return entries[index];\n  }\n  function createMemoryLocation(to, state, key) {\n    if (state === void 0) {\n      state = null;\n    }\n    let location = createLocation(entries ? getCurrentLocation().pathname : \"/\", to, state, key);\n    warning(location.pathname.charAt(0) === \"/\", \"relative pathnames are not supported in memory history: \" + JSON.stringify(to));\n    return location;\n  }\n  function createHref(to) {\n    return typeof to === \"string\" ? to : createPath(to);\n  }\n  let history = {\n    get index() {\n      return index;\n    },\n    get action() {\n      return action;\n    },\n    get location() {\n      return getCurrentLocation();\n    },\n    createHref,\n    createURL(to) {\n      return new URL(createHref(to), \"http://localhost\");\n    },\n    encodeLocation(to) {\n      let path = typeof to === \"string\" ? parsePath(to) : to;\n      return {\n        pathname: path.pathname || \"\",\n        search: path.search || \"\",\n        hash: path.hash || \"\"\n      };\n    },\n    push(to, state) {\n      action = Action.Push;\n      let nextLocation = createMemoryLocation(to, state);\n      index += 1;\n      entries.splice(index, entries.length, nextLocation);\n      if (v5Compat && listener) {\n        listener({\n          action,\n          location: nextLocation,\n          delta: 1\n        });\n      }\n    },\n    replace(to, state) {\n      action = Action.Replace;\n      let nextLocation = createMemoryLocation(to, state);\n      entries[index] = nextLocation;\n      if (v5Compat && listener) {\n        listener({\n          action,\n          location: nextLocation,\n          delta: 0\n        });\n      }\n    },\n    go(delta) {\n      action = Action.Pop;\n      let nextIndex = clampIndex(index + delta);\n      let nextLocation = entries[nextIndex];\n      index = nextIndex;\n      if (listener) {\n        listener({\n          action,\n          location: nextLocation,\n          delta\n        });\n      }\n    },\n    listen(fn) {\n      listener = fn;\n      return () => {\n        listener = null;\n      };\n    }\n  };\n  return history;\n}\n/**\n * Browser history stores the location in regular URLs. This is the standard for\n * most web apps, but it requires some configuration on the server to ensure you\n * serve the same app at multiple URLs.\n *\n * @see https://github.com/remix-run/history/tree/main/docs/api-reference.md#createbrowserhistory\n */\nfunction createBrowserHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  function createBrowserLocation(window, globalHistory) {\n    let {\n      pathname,\n      search,\n      hash\n    } = window.location;\n    return createLocation(\"\", {\n      pathname,\n      search,\n      hash\n    },\n    // state defaults to `null` because `window.history.state` does\n    globalHistory.state && globalHistory.state.usr || null, globalHistory.state && globalHistory.state.key || \"default\");\n  }\n  function createBrowserHref(window, to) {\n    return typeof to === \"string\" ? to : createPath(to);\n  }\n  return getUrlBasedHistory(createBrowserLocation, createBrowserHref, null, options);\n}\n/**\n * Hash history stores the location in window.location.hash. This makes it ideal\n * for situations where you don't want to send the location to the server for\n * some reason, either because you do cannot configure it or the URL space is\n * reserved for something else.\n *\n * @see https://github.com/remix-run/history/tree/main/docs/api-reference.md#createhashhistory\n */\nfunction createHashHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  function createHashLocation(window, globalHistory) {\n    let {\n      pathname = \"/\",\n      search = \"\",\n      hash = \"\"\n    } = parsePath(window.location.hash.substr(1));\n    // Hash URL should always have a leading / just like window.location.pathname\n    // does, so if an app ends up at a route like /#something then we add a\n    // leading slash so all of our path-matching behaves the same as if it would\n    // in a browser router.  This is particularly important when there exists a\n    // root splat route (<Route path=\"*\">) since that matches internally against\n    // \"/*\" and we'd expect /#something to 404 in a hash router app.\n    if (!pathname.startsWith(\"/\") && !pathname.startsWith(\".\")) {\n      pathname = \"/\" + pathname;\n    }\n    return createLocation(\"\", {\n      pathname,\n      search,\n      hash\n    },\n    // state defaults to `null` because `window.history.state` does\n    globalHistory.state && globalHistory.state.usr || null, globalHistory.state && globalHistory.state.key || \"default\");\n  }\n  function createHashHref(window, to) {\n    let base = window.document.querySelector(\"base\");\n    let href = \"\";\n    if (base && base.getAttribute(\"href\")) {\n      let url = window.location.href;\n      let hashIndex = url.indexOf(\"#\");\n      href = hashIndex === -1 ? url : url.slice(0, hashIndex);\n    }\n    return href + \"#\" + (typeof to === \"string\" ? to : createPath(to));\n  }\n  function validateHashLocation(location, to) {\n    warning(location.pathname.charAt(0) === \"/\", \"relative pathnames are not supported in hash history.push(\" + JSON.stringify(to) + \")\");\n  }\n  return getUrlBasedHistory(createHashLocation, createHashHref, validateHashLocation, options);\n}\nfunction invariant(value, message) {\n  if (value === false || value === null || typeof value === \"undefined\") {\n    throw new Error(message);\n  }\n}\nfunction warning(cond, message) {\n  if (!cond) {\n    // eslint-disable-next-line no-console\n    if (typeof console !== \"undefined\") console.warn(message);\n    try {\n      // Welcome to debugging history!\n      //\n      // This error is thrown as a convenience, so you can more easily\n      // find the source for a warning that appears in the console by\n      // enabling \"pause on exceptions\" in your JavaScript debugger.\n      throw new Error(message);\n      // eslint-disable-next-line no-empty\n    } catch (e) {}\n  }\n}\nfunction createKey() {\n  return Math.random().toString(36).substr(2, 8);\n}\n/**\n * For browser-based histories, we combine the state and key into an object\n */\nfunction getHistoryState(location, index) {\n  return {\n    usr: location.state,\n    key: location.key,\n    idx: index\n  };\n}\n/**\n * Creates a Location object with a unique key from the given Path\n */\nfunction createLocation(current, to, state, key) {\n  if (state === void 0) {\n    state = null;\n  }\n  let location = _extends({\n    pathname: typeof current === \"string\" ? current : current.pathname,\n    search: \"\",\n    hash: \"\"\n  }, typeof to === \"string\" ? parsePath(to) : to, {\n    state,\n    // TODO: This could be cleaned up.  push/replace should probably just take\n    // full Locations now and avoid the need to run through this flow at all\n    // But that's a pretty big refactor to the current test suite so going to\n    // keep as is for the time being and just let any incoming keys take precedence\n    key: to && to.key || key || createKey()\n  });\n  return location;\n}\n/**\n * Creates a string URL path from the given pathname, search, and hash components.\n */\nfunction createPath(_ref) {\n  let {\n    pathname = \"/\",\n    search = \"\",\n    hash = \"\"\n  } = _ref;\n  if (search && search !== \"?\") pathname += search.charAt(0) === \"?\" ? search : \"?\" + search;\n  if (hash && hash !== \"#\") pathname += hash.charAt(0) === \"#\" ? hash : \"#\" + hash;\n  return pathname;\n}\n/**\n * Parses a string URL path into its separate pathname, search, and hash components.\n */\nfunction parsePath(path) {\n  let parsedPath = {};\n  if (path) {\n    let hashIndex = path.indexOf(\"#\");\n    if (hashIndex >= 0) {\n      parsedPath.hash = path.substr(hashIndex);\n      path = path.substr(0, hashIndex);\n    }\n    let searchIndex = path.indexOf(\"?\");\n    if (searchIndex >= 0) {\n      parsedPath.search = path.substr(searchIndex);\n      path = path.substr(0, searchIndex);\n    }\n    if (path) {\n      parsedPath.pathname = path;\n    }\n  }\n  return parsedPath;\n}\nfunction getUrlBasedHistory(getLocation, createHref, validateLocation, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  let {\n    window = document.defaultView,\n    v5Compat = false\n  } = options;\n  let globalHistory = window.history;\n  let action = Action.Pop;\n  let listener = null;\n  let index = getIndex();\n  // Index should only be null when we initialize. If not, it's because the\n  // user called history.pushState or history.replaceState directly, in which\n  // case we should log a warning as it will result in bugs.\n  if (index == null) {\n    index = 0;\n    globalHistory.replaceState(_extends({}, globalHistory.state, {\n      idx: index\n    }), \"\");\n  }\n  function getIndex() {\n    let state = globalHistory.state || {\n      idx: null\n    };\n    return state.idx;\n  }\n  function handlePop() {\n    action = Action.Pop;\n    let nextIndex = getIndex();\n    let delta = nextIndex == null ? null : nextIndex - index;\n    index = nextIndex;\n    if (listener) {\n      listener({\n        action,\n        location: history.location,\n        delta\n      });\n    }\n  }\n  function push(to, state) {\n    action = Action.Push;\n    let location = createLocation(history.location, to, state);\n    if (validateLocation) validateLocation(location, to);\n    index = getIndex() + 1;\n    let historyState = getHistoryState(location, index);\n    let url = history.createHref(location);\n    // try...catch because iOS limits us to 100 pushState calls :/\n    try {\n      globalHistory.pushState(historyState, \"\", url);\n    } catch (error) {\n      // If the exception is because `state` can't be serialized, let that throw\n      // outwards just like a replace call would so the dev knows the cause\n      // https://html.spec.whatwg.org/multipage/nav-history-apis.html#shared-history-push/replace-state-steps\n      // https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeinternal\n      if (error instanceof DOMException && error.name === \"DataCloneError\") {\n        throw error;\n      }\n      // They are going to lose state here, but there is no real\n      // way to warn them about it since the page will refresh...\n      window.location.assign(url);\n    }\n    if (v5Compat && listener) {\n      listener({\n        action,\n        location: history.location,\n        delta: 1\n      });\n    }\n  }\n  function replace(to, state) {\n    action = Action.Replace;\n    let location = createLocation(history.location, to, state);\n    if (validateLocation) validateLocation(location, to);\n    index = getIndex();\n    let historyState = getHistoryState(location, index);\n    let url = history.createHref(location);\n    globalHistory.replaceState(historyState, \"\", url);\n    if (v5Compat && listener) {\n      listener({\n        action,\n        location: history.location,\n        delta: 0\n      });\n    }\n  }\n  function createURL(to) {\n    // window.location.origin is \"null\" (the literal string value) in Firefox\n    // under certain conditions, notably when serving from a local HTML file\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=878297\n    let base = window.location.origin !== \"null\" ? window.location.origin : window.location.href;\n    let href = typeof to === \"string\" ? to : createPath(to);\n    // Treating this as a full URL will strip any trailing spaces so we need to\n    // pre-encode them since they might be part of a matching splat param from\n    // an ancestor route\n    href = href.replace(/ $/, \"%20\");\n    invariant(base, \"No window.location.(origin|href) available to create URL for href: \" + href);\n    return new URL(href, base);\n  }\n  let history = {\n    get action() {\n      return action;\n    },\n    get location() {\n      return getLocation(window, globalHistory);\n    },\n    listen(fn) {\n      if (listener) {\n        throw new Error(\"A history only accepts one active listener\");\n      }\n      window.addEventListener(PopStateEventType, handlePop);\n      listener = fn;\n      return () => {\n        window.removeEventListener(PopStateEventType, handlePop);\n        listener = null;\n      };\n    },\n    createHref(to) {\n      return createHref(window, to);\n    },\n    createURL,\n    encodeLocation(to) {\n      // Encode a Location the same way window.location would\n      let url = createURL(to);\n      return {\n        pathname: url.pathname,\n        search: url.search,\n        hash: url.hash\n      };\n    },\n    push,\n    replace,\n    go(n) {\n      return globalHistory.go(n);\n    }\n  };\n  return history;\n}\n//#endregion\n\nvar ResultType;\n(function (ResultType) {\n  ResultType[\"data\"] = \"data\";\n  ResultType[\"deferred\"] = \"deferred\";\n  ResultType[\"redirect\"] = \"redirect\";\n  ResultType[\"error\"] = \"error\";\n})(ResultType || (ResultType = {}));\nconst immutableRouteKeys = new Set([\"lazy\", \"caseSensitive\", \"path\", \"id\", \"index\", \"children\"]);\nfunction isIndexRoute(route) {\n  return route.index === true;\n}\n// Walk the route tree generating unique IDs where necessary, so we are working\n// solely with AgnosticDataRouteObject's within the Router\nfunction convertRoutesToDataRoutes(routes, mapRouteProperties, parentPath, manifest) {\n  if (parentPath === void 0) {\n    parentPath = [];\n  }\n  if (manifest === void 0) {\n    manifest = {};\n  }\n  return routes.map((route, index) => {\n    let treePath = [...parentPath, String(index)];\n    let id = typeof route.id === \"string\" ? route.id : treePath.join(\"-\");\n    invariant(route.index !== true || !route.children, \"Cannot specify children on an index route\");\n    invariant(!manifest[id], \"Found a route id collision on id \\\"\" + id + \"\\\".  Route \" + \"id's must be globally unique within Data Router usages\");\n    if (isIndexRoute(route)) {\n      let indexRoute = _extends({}, route, mapRouteProperties(route), {\n        id\n      });\n      manifest[id] = indexRoute;\n      return indexRoute;\n    } else {\n      let pathOrLayoutRoute = _extends({}, route, mapRouteProperties(route), {\n        id,\n        children: undefined\n      });\n      manifest[id] = pathOrLayoutRoute;\n      if (route.children) {\n        pathOrLayoutRoute.children = convertRoutesToDataRoutes(route.children, mapRouteProperties, treePath, manifest);\n      }\n      return pathOrLayoutRoute;\n    }\n  });\n}\n/**\n * Matches the given routes to a location and returns the match data.\n *\n * @see https://reactrouter.com/v6/utils/match-routes\n */\nfunction matchRoutes(routes, locationArg, basename) {\n  if (basename === void 0) {\n    basename = \"/\";\n  }\n  return matchRoutesImpl(routes, locationArg, basename, false);\n}\nfunction matchRoutesImpl(routes, locationArg, basename, allowPartial) {\n  let location = typeof locationArg === \"string\" ? parsePath(locationArg) : locationArg;\n  let pathname = stripBasename(location.pathname || \"/\", basename);\n  if (pathname == null) {\n    return null;\n  }\n  let branches = flattenRoutes(routes);\n  rankRouteBranches(branches);\n  let matches = null;\n  for (let i = 0; matches == null && i < branches.length; ++i) {\n    // Incoming pathnames are generally encoded from either window.location\n    // or from router.navigate, but we want to match against the unencoded\n    // paths in the route definitions.  Memory router locations won't be\n    // encoded here but there also shouldn't be anything to decode so this\n    // should be a safe operation.  This avoids needing matchRoutes to be\n    // history-aware.\n    let decoded = decodePath(pathname);\n    matches = matchRouteBranch(branches[i], decoded, allowPartial);\n  }\n  return matches;\n}\nfunction convertRouteMatchToUiMatch(match, loaderData) {\n  let {\n    route,\n    pathname,\n    params\n  } = match;\n  return {\n    id: route.id,\n    pathname,\n    params,\n    data: loaderData[route.id],\n    handle: route.handle\n  };\n}\nfunction flattenRoutes(routes, branches, parentsMeta, parentPath) {\n  if (branches === void 0) {\n    branches = [];\n  }\n  if (parentsMeta === void 0) {\n    parentsMeta = [];\n  }\n  if (parentPath === void 0) {\n    parentPath = \"\";\n  }\n  let flattenRoute = (route, index, relativePath) => {\n    let meta = {\n      relativePath: relativePath === undefined ? route.path || \"\" : relativePath,\n      caseSensitive: route.caseSensitive === true,\n      childrenIndex: index,\n      route\n    };\n    if (meta.relativePath.startsWith(\"/\")) {\n      invariant(meta.relativePath.startsWith(parentPath), \"Absolute route path \\\"\" + meta.relativePath + \"\\\" nested under path \" + (\"\\\"\" + parentPath + \"\\\" is not valid. An absolute child route path \") + \"must start with the combined path of all its parent routes.\");\n      meta.relativePath = meta.relativePath.slice(parentPath.length);\n    }\n    let path = joinPaths([parentPath, meta.relativePath]);\n    let routesMeta = parentsMeta.concat(meta);\n    // Add the children before adding this route to the array, so we traverse the\n    // route tree depth-first and child routes appear before their parents in\n    // the \"flattened\" version.\n    if (route.children && route.children.length > 0) {\n      invariant(\n      // Our types know better, but runtime JS may not!\n      // @ts-expect-error\n      route.index !== true, \"Index routes must not have child routes. Please remove \" + (\"all child routes from route path \\\"\" + path + \"\\\".\"));\n      flattenRoutes(route.children, branches, routesMeta, path);\n    }\n    // Routes without a path shouldn't ever match by themselves unless they are\n    // index routes, so don't add them to the list of possible branches.\n    if (route.path == null && !route.index) {\n      return;\n    }\n    branches.push({\n      path,\n      score: computeScore(path, route.index),\n      routesMeta\n    });\n  };\n  routes.forEach((route, index) => {\n    var _route$path;\n    // coarse-grain check for optional params\n    if (route.path === \"\" || !((_route$path = route.path) != null && _route$path.includes(\"?\"))) {\n      flattenRoute(route, index);\n    } else {\n      for (let exploded of explodeOptionalSegments(route.path)) {\n        flattenRoute(route, index, exploded);\n      }\n    }\n  });\n  return branches;\n}\n/**\n * Computes all combinations of optional path segments for a given path,\n * excluding combinations that are ambiguous and of lower priority.\n *\n * For example, `/one/:two?/three/:four?/:five?` explodes to:\n * - `/one/three`\n * - `/one/:two/three`\n * - `/one/three/:four`\n * - `/one/three/:five`\n * - `/one/:two/three/:four`\n * - `/one/:two/three/:five`\n * - `/one/three/:four/:five`\n * - `/one/:two/three/:four/:five`\n */\nfunction explodeOptionalSegments(path) {\n  let segments = path.split(\"/\");\n  if (segments.length === 0) return [];\n  let [first, ...rest] = segments;\n  // Optional path segments are denoted by a trailing `?`\n  let isOptional = first.endsWith(\"?\");\n  // Compute the corresponding required segment: `foo?` -> `foo`\n  let required = first.replace(/\\?$/, \"\");\n  if (rest.length === 0) {\n    // Intepret empty string as omitting an optional segment\n    // `[\"one\", \"\", \"three\"]` corresponds to omitting `:two` from `/one/:two?/three` -> `/one/three`\n    return isOptional ? [required, \"\"] : [required];\n  }\n  let restExploded = explodeOptionalSegments(rest.join(\"/\"));\n  let result = [];\n  // All child paths with the prefix.  Do this for all children before the\n  // optional version for all children, so we get consistent ordering where the\n  // parent optional aspect is preferred as required.  Otherwise, we can get\n  // child sections interspersed where deeper optional segments are higher than\n  // parent optional segments, where for example, /:two would explode _earlier_\n  // then /:one.  By always including the parent as required _for all children_\n  // first, we avoid this issue\n  result.push(...restExploded.map(subpath => subpath === \"\" ? required : [required, subpath].join(\"/\")));\n  // Then, if this is an optional value, add all child versions without\n  if (isOptional) {\n    result.push(...restExploded);\n  }\n  // for absolute paths, ensure `/` instead of empty segment\n  return result.map(exploded => path.startsWith(\"/\") && exploded === \"\" ? \"/\" : exploded);\n}\nfunction rankRouteBranches(branches) {\n  branches.sort((a, b) => a.score !== b.score ? b.score - a.score // Higher score first\n  : compareIndexes(a.routesMeta.map(meta => meta.childrenIndex), b.routesMeta.map(meta => meta.childrenIndex)));\n}\nconst paramRe = /^:[\\w-]+$/;\nconst dynamicSegmentValue = 3;\nconst indexRouteValue = 2;\nconst emptySegmentValue = 1;\nconst staticSegmentValue = 10;\nconst splatPenalty = -2;\nconst isSplat = s => s === \"*\";\nfunction computeScore(path, index) {\n  let segments = path.split(\"/\");\n  let initialScore = segments.length;\n  if (segments.some(isSplat)) {\n    initialScore += splatPenalty;\n  }\n  if (index) {\n    initialScore += indexRouteValue;\n  }\n  return segments.filter(s => !isSplat(s)).reduce((score, segment) => score + (paramRe.test(segment) ? dynamicSegmentValue : segment === \"\" ? emptySegmentValue : staticSegmentValue), initialScore);\n}\nfunction compareIndexes(a, b) {\n  let siblings = a.length === b.length && a.slice(0, -1).every((n, i) => n === b[i]);\n  return siblings ?\n  // If two routes are siblings, we should try to match the earlier sibling\n  // first. This allows people to have fine-grained control over the matching\n  // behavior by simply putting routes with identical paths in the order they\n  // want them tried.\n  a[a.length - 1] - b[b.length - 1] :\n  // Otherwise, it doesn't really make sense to rank non-siblings by index,\n  // so they sort equally.\n  0;\n}\nfunction matchRouteBranch(branch, pathname, allowPartial) {\n  if (allowPartial === void 0) {\n    allowPartial = false;\n  }\n  let {\n    routesMeta\n  } = branch;\n  let matchedParams = {};\n  let matchedPathname = \"/\";\n  let matches = [];\n  for (let i = 0; i < routesMeta.length; ++i) {\n    let meta = routesMeta[i];\n    let end = i === routesMeta.length - 1;\n    let remainingPathname = matchedPathname === \"/\" ? pathname : pathname.slice(matchedPathname.length) || \"/\";\n    let match = matchPath({\n      path: meta.relativePath,\n      caseSensitive: meta.caseSensitive,\n      end\n    }, remainingPathname);\n    let route = meta.route;\n    if (!match && end && allowPartial && !routesMeta[routesMeta.length - 1].route.index) {\n      match = matchPath({\n        path: meta.relativePath,\n        caseSensitive: meta.caseSensitive,\n        end: false\n      }, remainingPathname);\n    }\n    if (!match) {\n      return null;\n    }\n    Object.assign(matchedParams, match.params);\n    matches.push({\n      // TODO: Can this as be avoided?\n      params: matchedParams,\n      pathname: joinPaths([matchedPathname, match.pathname]),\n      pathnameBase: normalizePathname(joinPaths([matchedPathname, match.pathnameBase])),\n      route\n    });\n    if (match.pathnameBase !== \"/\") {\n      matchedPathname = joinPaths([matchedPathname, match.pathnameBase]);\n    }\n  }\n  return matches;\n}\n/**\n * Returns a path with params interpolated.\n *\n * @see https://reactrouter.com/v6/utils/generate-path\n */\nfunction generatePath(originalPath, params) {\n  if (params === void 0) {\n    params = {};\n  }\n  let path = originalPath;\n  if (path.endsWith(\"*\") && path !== \"*\" && !path.endsWith(\"/*\")) {\n    warning(false, \"Route path \\\"\" + path + \"\\\" will be treated as if it were \" + (\"\\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\" because the `*` character must \") + \"always follow a `/` in the pattern. To get rid of this warning, \" + (\"please change the route path to \\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\".\"));\n    path = path.replace(/\\*$/, \"/*\");\n  }\n  // ensure `/` is added at the beginning if the path is absolute\n  const prefix = path.startsWith(\"/\") ? \"/\" : \"\";\n  const stringify = p => p == null ? \"\" : typeof p === \"string\" ? p : String(p);\n  const segments = path.split(/\\/+/).map((segment, index, array) => {\n    const isLastSegment = index === array.length - 1;\n    // only apply the splat if it's the last segment\n    if (isLastSegment && segment === \"*\") {\n      const star = \"*\";\n      // Apply the splat\n      return stringify(params[star]);\n    }\n    const keyMatch = segment.match(/^:([\\w-]+)(\\??)$/);\n    if (keyMatch) {\n      const [, key, optional] = keyMatch;\n      let param = params[key];\n      invariant(optional === \"?\" || param != null, \"Missing \\\":\" + key + \"\\\" param\");\n      return stringify(param);\n    }\n    // Remove any optional markers from optional static segments\n    return segment.replace(/\\?$/g, \"\");\n  })\n  // Remove empty segments\n  .filter(segment => !!segment);\n  return prefix + segments.join(\"/\");\n}\n/**\n * Performs pattern matching on a URL pathname and returns information about\n * the match.\n *\n * @see https://reactrouter.com/v6/utils/match-path\n */\nfunction matchPath(pattern, pathname) {\n  if (typeof pattern === \"string\") {\n    pattern = {\n      path: pattern,\n      caseSensitive: false,\n      end: true\n    };\n  }\n  let [matcher, compiledParams] = compilePath(pattern.path, pattern.caseSensitive, pattern.end);\n  let match = pathname.match(matcher);\n  if (!match) return null;\n  let matchedPathname = match[0];\n  let pathnameBase = matchedPathname.replace(/(.)\\/+$/, \"$1\");\n  let captureGroups = match.slice(1);\n  let params = compiledParams.reduce((memo, _ref, index) => {\n    let {\n      paramName,\n      isOptional\n    } = _ref;\n    // We need to compute the pathnameBase here using the raw splat value\n    // instead of using params[\"*\"] later because it will be decoded then\n    if (paramName === \"*\") {\n      let splatValue = captureGroups[index] || \"\";\n      pathnameBase = matchedPathname.slice(0, matchedPathname.length - splatValue.length).replace(/(.)\\/+$/, \"$1\");\n    }\n    const value = captureGroups[index];\n    if (isOptional && !value) {\n      memo[paramName] = undefined;\n    } else {\n      memo[paramName] = (value || \"\").replace(/%2F/g, \"/\");\n    }\n    return memo;\n  }, {});\n  return {\n    params,\n    pathname: matchedPathname,\n    pathnameBase,\n    pattern\n  };\n}\nfunction compilePath(path, caseSensitive, end) {\n  if (caseSensitive === void 0) {\n    caseSensitive = false;\n  }\n  if (end === void 0) {\n    end = true;\n  }\n  warning(path === \"*\" || !path.endsWith(\"*\") || path.endsWith(\"/*\"), \"Route path \\\"\" + path + \"\\\" will be treated as if it were \" + (\"\\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\" because the `*` character must \") + \"always follow a `/` in the pattern. To get rid of this warning, \" + (\"please change the route path to \\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\".\"));\n  let params = [];\n  let regexpSource = \"^\" + path.replace(/\\/*\\*?$/, \"\") // Ignore trailing / and /*, we'll handle it below\n  .replace(/^\\/*/, \"/\") // Make sure it has a leading /\n  .replace(/[\\\\.*+^${}|()[\\]]/g, \"\\\\$&\") // Escape special regex chars\n  .replace(/\\/:([\\w-]+)(\\?)?/g, (_, paramName, isOptional) => {\n    params.push({\n      paramName,\n      isOptional: isOptional != null\n    });\n    return isOptional ? \"/?([^\\\\/]+)?\" : \"/([^\\\\/]+)\";\n  });\n  if (path.endsWith(\"*\")) {\n    params.push({\n      paramName: \"*\"\n    });\n    regexpSource += path === \"*\" || path === \"/*\" ? \"(.*)$\" // Already matched the initial /, just match the rest\n    : \"(?:\\\\/(.+)|\\\\/*)$\"; // Don't include the / in params[\"*\"]\n  } else if (end) {\n    // When matching to the end, ignore trailing slashes\n    regexpSource += \"\\\\/*$\";\n  } else if (path !== \"\" && path !== \"/\") {\n    // If our path is non-empty and contains anything beyond an initial slash,\n    // then we have _some_ form of path in our regex, so we should expect to\n    // match only if we find the end of this path segment.  Look for an optional\n    // non-captured trailing slash (to match a portion of the URL) or the end\n    // of the path (if we've matched to the end).  We used to do this with a\n    // word boundary but that gives false positives on routes like\n    // /user-preferences since `-` counts as a word boundary.\n    regexpSource += \"(?:(?=\\\\/|$))\";\n  } else ;\n  let matcher = new RegExp(regexpSource, caseSensitive ? undefined : \"i\");\n  return [matcher, params];\n}\nfunction decodePath(value) {\n  try {\n    return value.split(\"/\").map(v => decodeURIComponent(v).replace(/\\//g, \"%2F\")).join(\"/\");\n  } catch (error) {\n    warning(false, \"The URL path \\\"\" + value + \"\\\" could not be decoded because it is is a \" + \"malformed URL segment. This is probably due to a bad percent \" + (\"encoding (\" + error + \").\"));\n    return value;\n  }\n}\n/**\n * @private\n */\nfunction stripBasename(pathname, basename) {\n  if (basename === \"/\") return pathname;\n  if (!pathname.toLowerCase().startsWith(basename.toLowerCase())) {\n    return null;\n  }\n  // We want to leave trailing slash behavior in the user's control, so if they\n  // specify a basename with a trailing slash, we should support it\n  let startIndex = basename.endsWith(\"/\") ? basename.length - 1 : basename.length;\n  let nextChar = pathname.charAt(startIndex);\n  if (nextChar && nextChar !== \"/\") {\n    // pathname does not start with basename/\n    return null;\n  }\n  return pathname.slice(startIndex) || \"/\";\n}\n/**\n * Returns a resolved path object relative to the given pathname.\n *\n * @see https://reactrouter.com/v6/utils/resolve-path\n */\nfunction resolvePath(to, fromPathname) {\n  if (fromPathname === void 0) {\n    fromPathname = \"/\";\n  }\n  let {\n    pathname: toPathname,\n    search = \"\",\n    hash = \"\"\n  } = typeof to === \"string\" ? parsePath(to) : to;\n  let pathname = toPathname ? toPathname.startsWith(\"/\") ? toPathname : resolvePathname(toPathname, fromPathname) : fromPathname;\n  return {\n    pathname,\n    search: normalizeSearch(search),\n    hash: normalizeHash(hash)\n  };\n}\nfunction resolvePathname(relativePath, fromPathname) {\n  let segments = fromPathname.replace(/\\/+$/, \"\").split(\"/\");\n  let relativeSegments = relativePath.split(\"/\");\n  relativeSegments.forEach(segment => {\n    if (segment === \"..\") {\n      // Keep the root \"\" segment so the pathname starts at /\n      if (segments.length > 1) segments.pop();\n    } else if (segment !== \".\") {\n      segments.push(segment);\n    }\n  });\n  return segments.length > 1 ? segments.join(\"/\") : \"/\";\n}\nfunction getInvalidPathError(char, field, dest, path) {\n  return \"Cannot include a '\" + char + \"' character in a manually specified \" + (\"`to.\" + field + \"` field [\" + JSON.stringify(path) + \"].  Please separate it out to the \") + (\"`to.\" + dest + \"` field. Alternatively you may provide the full path as \") + \"a string in <Link to=\\\"...\\\"> and the router will parse it for you.\";\n}\n/**\n * @private\n *\n * When processing relative navigation we want to ignore ancestor routes that\n * do not contribute to the path, such that index/pathless layout routes don't\n * interfere.\n *\n * For example, when moving a route element into an index route and/or a\n * pathless layout route, relative link behavior contained within should stay\n * the same.  Both of the following examples should link back to the root:\n *\n *   <Route path=\"/\">\n *     <Route path=\"accounts\" element={<Link to=\"..\"}>\n *   </Route>\n *\n *   <Route path=\"/\">\n *     <Route path=\"accounts\">\n *       <Route element={<AccountsLayout />}>       // <-- Does not contribute\n *         <Route index element={<Link to=\"..\"} />  // <-- Does not contribute\n *       </Route\n *     </Route>\n *   </Route>\n */\nfunction getPathContributingMatches(matches) {\n  return matches.filter((match, index) => index === 0 || match.route.path && match.route.path.length > 0);\n}\n// Return the array of pathnames for the current route matches - used to\n// generate the routePathnames input for resolveTo()\nfunction getResolveToMatches(matches, v7_relativeSplatPath) {\n  let pathMatches = getPathContributingMatches(matches);\n  // When v7_relativeSplatPath is enabled, use the full pathname for the leaf\n  // match so we include splat values for \".\" links.  See:\n  // https://github.com/remix-run/react-router/issues/11052#issuecomment-1836589329\n  if (v7_relativeSplatPath) {\n    return pathMatches.map((match, idx) => idx === pathMatches.length - 1 ? match.pathname : match.pathnameBase);\n  }\n  return pathMatches.map(match => match.pathnameBase);\n}\n/**\n * @private\n */\nfunction resolveTo(toArg, routePathnames, locationPathname, isPathRelative) {\n  if (isPathRelative === void 0) {\n    isPathRelative = false;\n  }\n  let to;\n  if (typeof toArg === \"string\") {\n    to = parsePath(toArg);\n  } else {\n    to = _extends({}, toArg);\n    invariant(!to.pathname || !to.pathname.includes(\"?\"), getInvalidPathError(\"?\", \"pathname\", \"search\", to));\n    invariant(!to.pathname || !to.pathname.includes(\"#\"), getInvalidPathError(\"#\", \"pathname\", \"hash\", to));\n    invariant(!to.search || !to.search.includes(\"#\"), getInvalidPathError(\"#\", \"search\", \"hash\", to));\n  }\n  let isEmptyPath = toArg === \"\" || to.pathname === \"\";\n  let toPathname = isEmptyPath ? \"/\" : to.pathname;\n  let from;\n  // Routing is relative to the current pathname if explicitly requested.\n  //\n  // If a pathname is explicitly provided in `to`, it should be relative to the\n  // route context. This is explained in `Note on `<Link to>` values` in our\n  // migration guide from v5 as a means of disambiguation between `to` values\n  // that begin with `/` and those that do not. However, this is problematic for\n  // `to` values that do not provide a pathname. `to` can simply be a search or\n  // hash string, in which case we should assume that the navigation is relative\n  // to the current location's pathname and *not* the route pathname.\n  if (toPathname == null) {\n    from = locationPathname;\n  } else {\n    let routePathnameIndex = routePathnames.length - 1;\n    // With relative=\"route\" (the default), each leading .. segment means\n    // \"go up one route\" instead of \"go up one URL segment\".  This is a key\n    // difference from how <a href> works and a major reason we call this a\n    // \"to\" value instead of a \"href\".\n    if (!isPathRelative && toPathname.startsWith(\"..\")) {\n      let toSegments = toPathname.split(\"/\");\n      while (toSegments[0] === \"..\") {\n        toSegments.shift();\n        routePathnameIndex -= 1;\n      }\n      to.pathname = toSegments.join(\"/\");\n    }\n    from = routePathnameIndex >= 0 ? routePathnames[routePathnameIndex] : \"/\";\n  }\n  let path = resolvePath(to, from);\n  // Ensure the pathname has a trailing slash if the original \"to\" had one\n  let hasExplicitTrailingSlash = toPathname && toPathname !== \"/\" && toPathname.endsWith(\"/\");\n  // Or if this was a link to the current path which has a trailing slash\n  let hasCurrentTrailingSlash = (isEmptyPath || toPathname === \".\") && locationPathname.endsWith(\"/\");\n  if (!path.pathname.endsWith(\"/\") && (hasExplicitTrailingSlash || hasCurrentTrailingSlash)) {\n    path.pathname += \"/\";\n  }\n  return path;\n}\n/**\n * @private\n */\nfunction getToPathname(to) {\n  // Empty strings should be treated the same as / paths\n  return to === \"\" || to.pathname === \"\" ? \"/\" : typeof to === \"string\" ? parsePath(to).pathname : to.pathname;\n}\n/**\n * @private\n */\nconst joinPaths = paths => paths.join(\"/\").replace(/\\/\\/+/g, \"/\");\n/**\n * @private\n */\nconst normalizePathname = pathname => pathname.replace(/\\/+$/, \"\").replace(/^\\/*/, \"/\");\n/**\n * @private\n */\nconst normalizeSearch = search => !search || search === \"?\" ? \"\" : search.startsWith(\"?\") ? search : \"?\" + search;\n/**\n * @private\n */\nconst normalizeHash = hash => !hash || hash === \"#\" ? \"\" : hash.startsWith(\"#\") ? hash : \"#\" + hash;\n/**\n * This is a shortcut for creating `application/json` responses. Converts `data`\n * to JSON and sets the `Content-Type` header.\n *\n * @deprecated The `json` method is deprecated in favor of returning raw objects.\n * This method will be removed in v7.\n */\nconst json = function json(data, init) {\n  if (init === void 0) {\n    init = {};\n  }\n  let responseInit = typeof init === \"number\" ? {\n    status: init\n  } : init;\n  let headers = new Headers(responseInit.headers);\n  if (!headers.has(\"Content-Type\")) {\n    headers.set(\"Content-Type\", \"application/json; charset=utf-8\");\n  }\n  return new Response(JSON.stringify(data), _extends({}, responseInit, {\n    headers\n  }));\n};\nclass DataWithResponseInit {\n  constructor(data, init) {\n    this.type = \"DataWithResponseInit\";\n    this.data = data;\n    this.init = init || null;\n  }\n}\n/**\n * Create \"responses\" that contain `status`/`headers` without forcing\n * serialization into an actual `Response` - used by Remix single fetch\n */\nfunction data(data, init) {\n  return new DataWithResponseInit(data, typeof init === \"number\" ? {\n    status: init\n  } : init);\n}\nclass AbortedDeferredError extends Error {}\nclass DeferredData {\n  constructor(data, responseInit) {\n    this.pendingKeysSet = new Set();\n    this.subscribers = new Set();\n    this.deferredKeys = [];\n    invariant(data && typeof data === \"object\" && !Array.isArray(data), \"defer() only accepts plain objects\");\n    // Set up an AbortController + Promise we can race against to exit early\n    // cancellation\n    let reject;\n    this.abortPromise = new Promise((_, r) => reject = r);\n    this.controller = new AbortController();\n    let onAbort = () => reject(new AbortedDeferredError(\"Deferred data aborted\"));\n    this.unlistenAbortSignal = () => this.controller.signal.removeEventListener(\"abort\", onAbort);\n    this.controller.signal.addEventListener(\"abort\", onAbort);\n    this.data = Object.entries(data).reduce((acc, _ref2) => {\n      let [key, value] = _ref2;\n      return Object.assign(acc, {\n        [key]: this.trackPromise(key, value)\n      });\n    }, {});\n    if (this.done) {\n      // All incoming values were resolved\n      this.unlistenAbortSignal();\n    }\n    this.init = responseInit;\n  }\n  trackPromise(key, value) {\n    if (!(value instanceof Promise)) {\n      return value;\n    }\n    this.deferredKeys.push(key);\n    this.pendingKeysSet.add(key);\n    // We store a little wrapper promise that will be extended with\n    // _data/_error props upon resolve/reject\n    let promise = Promise.race([value, this.abortPromise]).then(data => this.onSettle(promise, key, undefined, data), error => this.onSettle(promise, key, error));\n    // Register rejection listeners to avoid uncaught promise rejections on\n    // errors or aborted deferred values\n    promise.catch(() => {});\n    Object.defineProperty(promise, \"_tracked\", {\n      get: () => true\n    });\n    return promise;\n  }\n  onSettle(promise, key, error, data) {\n    if (this.controller.signal.aborted && error instanceof AbortedDeferredError) {\n      this.unlistenAbortSignal();\n      Object.defineProperty(promise, \"_error\", {\n        get: () => error\n      });\n      return Promise.reject(error);\n    }\n    this.pendingKeysSet.delete(key);\n    if (this.done) {\n      // Nothing left to abort!\n      this.unlistenAbortSignal();\n    }\n    // If the promise was resolved/rejected with undefined, we'll throw an error as you\n    // should always resolve with a value or null\n    if (error === undefined && data === undefined) {\n      let undefinedError = new Error(\"Deferred data for key \\\"\" + key + \"\\\" resolved/rejected with `undefined`, \" + \"you must resolve/reject with a value or `null`.\");\n      Object.defineProperty(promise, \"_error\", {\n        get: () => undefinedError\n      });\n      this.emit(false, key);\n      return Promise.reject(undefinedError);\n    }\n    if (data === undefined) {\n      Object.defineProperty(promise, \"_error\", {\n        get: () => error\n      });\n      this.emit(false, key);\n      return Promise.reject(error);\n    }\n    Object.defineProperty(promise, \"_data\", {\n      get: () => data\n    });\n    this.emit(false, key);\n    return data;\n  }\n  emit(aborted, settledKey) {\n    this.subscribers.forEach(subscriber => subscriber(aborted, settledKey));\n  }\n  subscribe(fn) {\n    this.subscribers.add(fn);\n    return () => this.subscribers.delete(fn);\n  }\n  cancel() {\n    this.controller.abort();\n    this.pendingKeysSet.forEach((v, k) => this.pendingKeysSet.delete(k));\n    this.emit(true);\n  }\n  async resolveData(signal) {\n    let aborted = false;\n    if (!this.done) {\n      let onAbort = () => this.cancel();\n      signal.addEventListener(\"abort\", onAbort);\n      aborted = await new Promise(resolve => {\n        this.subscribe(aborted => {\n          signal.removeEventListener(\"abort\", onAbort);\n          if (aborted || this.done) {\n            resolve(aborted);\n          }\n        });\n      });\n    }\n    return aborted;\n  }\n  get done() {\n    return this.pendingKeysSet.size === 0;\n  }\n  get unwrappedData() {\n    invariant(this.data !== null && this.done, \"Can only unwrap data on initialized and settled deferreds\");\n    return Object.entries(this.data).reduce((acc, _ref3) => {\n      let [key, value] = _ref3;\n      return Object.assign(acc, {\n        [key]: unwrapTrackedPromise(value)\n      });\n    }, {});\n  }\n  get pendingKeys() {\n    return Array.from(this.pendingKeysSet);\n  }\n}\nfunction isTrackedPromise(value) {\n  return value instanceof Promise && value._tracked === true;\n}\nfunction unwrapTrackedPromise(value) {\n  if (!isTrackedPromise(value)) {\n    return value;\n  }\n  if (value._error) {\n    throw value._error;\n  }\n  return value._data;\n}\n/**\n * @deprecated The `defer` method is deprecated in favor of returning raw\n * objects. This method will be removed in v7.\n */\nconst defer = function defer(data, init) {\n  if (init === void 0) {\n    init = {};\n  }\n  let responseInit = typeof init === \"number\" ? {\n    status: init\n  } : init;\n  return new DeferredData(data, responseInit);\n};\n/**\n * A redirect response. Sets the status code and the `Location` header.\n * Defaults to \"302 Found\".\n */\nconst redirect = function redirect(url, init) {\n  if (init === void 0) {\n    init = 302;\n  }\n  let responseInit = init;\n  if (typeof responseInit === \"number\") {\n    responseInit = {\n      status: responseInit\n    };\n  } else if (typeof responseInit.status === \"undefined\") {\n    responseInit.status = 302;\n  }\n  let headers = new Headers(responseInit.headers);\n  headers.set(\"Location\", url);\n  return new Response(null, _extends({}, responseInit, {\n    headers\n  }));\n};\n/**\n * A redirect response that will force a document reload to the new location.\n * Sets the status code and the `Location` header.\n * Defaults to \"302 Found\".\n */\nconst redirectDocument = (url, init) => {\n  let response = redirect(url, init);\n  response.headers.set(\"X-Remix-Reload-Document\", \"true\");\n  return response;\n};\n/**\n * A redirect response that will perform a `history.replaceState` instead of a\n * `history.pushState` for client-side navigation redirects.\n * Sets the status code and the `Location` header.\n * Defaults to \"302 Found\".\n */\nconst replace = (url, init) => {\n  let response = redirect(url, init);\n  response.headers.set(\"X-Remix-Replace\", \"true\");\n  return response;\n};\n/**\n * @private\n * Utility class we use to hold auto-unwrapped 4xx/5xx Response bodies\n *\n * We don't export the class for public use since it's an implementation\n * detail, but we export the interface above so folks can build their own\n * abstractions around instances via isRouteErrorResponse()\n */\nclass ErrorResponseImpl {\n  constructor(status, statusText, data, internal) {\n    if (internal === void 0) {\n      internal = false;\n    }\n    this.status = status;\n    this.statusText = statusText || \"\";\n    this.internal = internal;\n    if (data instanceof Error) {\n      this.data = data.toString();\n      this.error = data;\n    } else {\n      this.data = data;\n    }\n  }\n}\n/**\n * Check if the given error is an ErrorResponse generated from a 4xx/5xx\n * Response thrown from an action/loader\n */\nfunction isRouteErrorResponse(error) {\n  return error != null && typeof error.status === \"number\" && typeof error.statusText === \"string\" && typeof error.internal === \"boolean\" && \"data\" in error;\n}\n\nconst validMutationMethodsArr = [\"post\", \"put\", \"patch\", \"delete\"];\nconst validMutationMethods = new Set(validMutationMethodsArr);\nconst validRequestMethodsArr = [\"get\", ...validMutationMethodsArr];\nconst validRequestMethods = new Set(validRequestMethodsArr);\nconst redirectStatusCodes = new Set([301, 302, 303, 307, 308]);\nconst redirectPreserveMethodStatusCodes = new Set([307, 308]);\nconst IDLE_NAVIGATION = {\n  state: \"idle\",\n  location: undefined,\n  formMethod: undefined,\n  formAction: undefined,\n  formEncType: undefined,\n  formData: undefined,\n  json: undefined,\n  text: undefined\n};\nconst IDLE_FETCHER = {\n  state: \"idle\",\n  data: undefined,\n  formMethod: undefined,\n  formAction: undefined,\n  formEncType: undefined,\n  formData: undefined,\n  json: undefined,\n  text: undefined\n};\nconst IDLE_BLOCKER = {\n  state: \"unblocked\",\n  proceed: undefined,\n  reset: undefined,\n  location: undefined\n};\nconst ABSOLUTE_URL_REGEX = /^(?:[a-z][a-z0-9+.-]*:|\\/\\/)/i;\nconst defaultMapRouteProperties = route => ({\n  hasErrorBoundary: Boolean(route.hasErrorBoundary)\n});\nconst TRANSITIONS_STORAGE_KEY = \"remix-router-transitions\";\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region createRouter\n////////////////////////////////////////////////////////////////////////////////\n/**\n * Create a router and listen to history POP navigations\n */\nfunction createRouter(init) {\n  const routerWindow = init.window ? init.window : typeof window !== \"undefined\" ? window : undefined;\n  const isBrowser = typeof routerWindow !== \"undefined\" && typeof routerWindow.document !== \"undefined\" && typeof routerWindow.document.createElement !== \"undefined\";\n  const isServer = !isBrowser;\n  invariant(init.routes.length > 0, \"You must provide a non-empty routes array to createRouter\");\n  let mapRouteProperties;\n  if (init.mapRouteProperties) {\n    mapRouteProperties = init.mapRouteProperties;\n  } else if (init.detectErrorBoundary) {\n    // If they are still using the deprecated version, wrap it with the new API\n    let detectErrorBoundary = init.detectErrorBoundary;\n    mapRouteProperties = route => ({\n      hasErrorBoundary: detectErrorBoundary(route)\n    });\n  } else {\n    mapRouteProperties = defaultMapRouteProperties;\n  }\n  // Routes keyed by ID\n  let manifest = {};\n  // Routes in tree format for matching\n  let dataRoutes = convertRoutesToDataRoutes(init.routes, mapRouteProperties, undefined, manifest);\n  let inFlightDataRoutes;\n  let basename = init.basename || \"/\";\n  let dataStrategyImpl = init.dataStrategy || defaultDataStrategy;\n  let patchRoutesOnNavigationImpl = init.patchRoutesOnNavigation;\n  // Config driven behavior flags\n  let future = _extends({\n    v7_fetcherPersist: false,\n    v7_normalizeFormMethod: false,\n    v7_partialHydration: false,\n    v7_prependBasename: false,\n    v7_relativeSplatPath: false,\n    v7_skipActionErrorRevalidation: false\n  }, init.future);\n  // Cleanup function for history\n  let unlistenHistory = null;\n  // Externally-provided functions to call on all state changes\n  let subscribers = new Set();\n  // Externally-provided object to hold scroll restoration locations during routing\n  let savedScrollPositions = null;\n  // Externally-provided function to get scroll restoration keys\n  let getScrollRestorationKey = null;\n  // Externally-provided function to get current scroll position\n  let getScrollPosition = null;\n  // One-time flag to control the initial hydration scroll restoration.  Because\n  // we don't get the saved positions from <ScrollRestoration /> until _after_\n  // the initial render, we need to manually trigger a separate updateState to\n  // send along the restoreScrollPosition\n  // Set to true if we have `hydrationData` since we assume we were SSR'd and that\n  // SSR did the initial scroll restoration.\n  let initialScrollRestored = init.hydrationData != null;\n  let initialMatches = matchRoutes(dataRoutes, init.history.location, basename);\n  let initialMatchesIsFOW = false;\n  let initialErrors = null;\n  if (initialMatches == null && !patchRoutesOnNavigationImpl) {\n    // If we do not match a user-provided-route, fall back to the root\n    // to allow the error boundary to take over\n    let error = getInternalRouterError(404, {\n      pathname: init.history.location.pathname\n    });\n    let {\n      matches,\n      route\n    } = getShortCircuitMatches(dataRoutes);\n    initialMatches = matches;\n    initialErrors = {\n      [route.id]: error\n    };\n  }\n  // In SPA apps, if the user provided a patchRoutesOnNavigation implementation and\n  // our initial match is a splat route, clear them out so we run through lazy\n  // discovery on hydration in case there's a more accurate lazy route match.\n  // In SSR apps (with `hydrationData`), we expect that the server will send\n  // up the proper matched routes so we don't want to run lazy discovery on\n  // initial hydration and want to hydrate into the splat route.\n  if (initialMatches && !init.hydrationData) {\n    let fogOfWar = checkFogOfWar(initialMatches, dataRoutes, init.history.location.pathname);\n    if (fogOfWar.active) {\n      initialMatches = null;\n    }\n  }\n  let initialized;\n  if (!initialMatches) {\n    initialized = false;\n    initialMatches = [];\n    // If partial hydration and fog of war is enabled, we will be running\n    // `patchRoutesOnNavigation` during hydration so include any partial matches as\n    // the initial matches so we can properly render `HydrateFallback`'s\n    if (future.v7_partialHydration) {\n      let fogOfWar = checkFogOfWar(null, dataRoutes, init.history.location.pathname);\n      if (fogOfWar.active && fogOfWar.matches) {\n        initialMatchesIsFOW = true;\n        initialMatches = fogOfWar.matches;\n      }\n    }\n  } else if (initialMatches.some(m => m.route.lazy)) {\n    // All initialMatches need to be loaded before we're ready.  If we have lazy\n    // functions around still then we'll need to run them in initialize()\n    initialized = false;\n  } else if (!initialMatches.some(m => m.route.loader)) {\n    // If we've got no loaders to run, then we're good to go\n    initialized = true;\n  } else if (future.v7_partialHydration) {\n    // If partial hydration is enabled, we're initialized so long as we were\n    // provided with hydrationData for every route with a loader, and no loaders\n    // were marked for explicit hydration\n    let loaderData = init.hydrationData ? init.hydrationData.loaderData : null;\n    let errors = init.hydrationData ? init.hydrationData.errors : null;\n    // If errors exist, don't consider routes below the boundary\n    if (errors) {\n      let idx = initialMatches.findIndex(m => errors[m.route.id] !== undefined);\n      initialized = initialMatches.slice(0, idx + 1).every(m => !shouldLoadRouteOnHydration(m.route, loaderData, errors));\n    } else {\n      initialized = initialMatches.every(m => !shouldLoadRouteOnHydration(m.route, loaderData, errors));\n    }\n  } else {\n    // Without partial hydration - we're initialized if we were provided any\n    // hydrationData - which is expected to be complete\n    initialized = init.hydrationData != null;\n  }\n  let router;\n  let state = {\n    historyAction: init.history.action,\n    location: init.history.location,\n    matches: initialMatches,\n    initialized,\n    navigation: IDLE_NAVIGATION,\n    // Don't restore on initial updateState() if we were SSR'd\n    restoreScrollPosition: init.hydrationData != null ? false : null,\n    preventScrollReset: false,\n    revalidation: \"idle\",\n    loaderData: init.hydrationData && init.hydrationData.loaderData || {},\n    actionData: init.hydrationData && init.hydrationData.actionData || null,\n    errors: init.hydrationData && init.hydrationData.errors || initialErrors,\n    fetchers: new Map(),\n    blockers: new Map()\n  };\n  // -- Stateful internal variables to manage navigations --\n  // Current navigation in progress (to be committed in completeNavigation)\n  let pendingAction = Action.Pop;\n  // Should the current navigation prevent the scroll reset if scroll cannot\n  // be restored?\n  let pendingPreventScrollReset = false;\n  // AbortController for the active navigation\n  let pendingNavigationController;\n  // Should the current navigation enable document.startViewTransition?\n  let pendingViewTransitionEnabled = false;\n  // Store applied view transitions so we can apply them on POP\n  let appliedViewTransitions = new Map();\n  // Cleanup function for persisting applied transitions to sessionStorage\n  let removePageHideEventListener = null;\n  // We use this to avoid touching history in completeNavigation if a\n  // revalidation is entirely uninterrupted\n  let isUninterruptedRevalidation = false;\n  // Use this internal flag to force revalidation of all loaders:\n  //  - submissions (completed or interrupted)\n  //  - useRevalidator()\n  //  - X-Remix-Revalidate (from redirect)\n  let isRevalidationRequired = false;\n  // Use this internal array to capture routes that require revalidation due\n  // to a cancelled deferred on action submission\n  let cancelledDeferredRoutes = [];\n  // Use this internal array to capture fetcher loads that were cancelled by an\n  // action navigation and require revalidation\n  let cancelledFetcherLoads = new Set();\n  // AbortControllers for any in-flight fetchers\n  let fetchControllers = new Map();\n  // Track loads based on the order in which they started\n  let incrementingLoadId = 0;\n  // Track the outstanding pending navigation data load to be compared against\n  // the globally incrementing load when a fetcher load lands after a completed\n  // navigation\n  let pendingNavigationLoadId = -1;\n  // Fetchers that triggered data reloads as a result of their actions\n  let fetchReloadIds = new Map();\n  // Fetchers that triggered redirect navigations\n  let fetchRedirectIds = new Set();\n  // Most recent href/match for fetcher.load calls for fetchers\n  let fetchLoadMatches = new Map();\n  // Ref-count mounted fetchers so we know when it's ok to clean them up\n  let activeFetchers = new Map();\n  // Fetchers that have requested a delete when using v7_fetcherPersist,\n  // they'll be officially removed after they return to idle\n  let deletedFetchers = new Set();\n  // Store DeferredData instances for active route matches.  When a\n  // route loader returns defer() we stick one in here.  Then, when a nested\n  // promise resolves we update loaderData.  If a new navigation starts we\n  // cancel active deferreds for eliminated routes.\n  let activeDeferreds = new Map();\n  // Store blocker functions in a separate Map outside of router state since\n  // we don't need to update UI state if they change\n  let blockerFunctions = new Map();\n  // Flag to ignore the next history update, so we can revert the URL change on\n  // a POP navigation that was blocked by the user without touching router state\n  let unblockBlockerHistoryUpdate = undefined;\n  // Initialize the router, all side effects should be kicked off from here.\n  // Implemented as a Fluent API for ease of:\n  //   let router = createRouter(init).initialize();\n  function initialize() {\n    // If history informs us of a POP navigation, start the navigation but do not update\n    // state.  We'll update our own state once the navigation completes\n    unlistenHistory = init.history.listen(_ref => {\n      let {\n        action: historyAction,\n        location,\n        delta\n      } = _ref;\n      // Ignore this event if it was just us resetting the URL from a\n      // blocked POP navigation\n      if (unblockBlockerHistoryUpdate) {\n        unblockBlockerHistoryUpdate();\n        unblockBlockerHistoryUpdate = undefined;\n        return;\n      }\n      warning(blockerFunctions.size === 0 || delta != null, \"You are trying to use a blocker on a POP navigation to a location \" + \"that was not created by @remix-run/router. This will fail silently in \" + \"production. This can happen if you are navigating outside the router \" + \"via `window.history.pushState`/`window.location.hash` instead of using \" + \"router navigation APIs.  This can also happen if you are using \" + \"createHashRouter and the user manually changes the URL.\");\n      let blockerKey = shouldBlockNavigation({\n        currentLocation: state.location,\n        nextLocation: location,\n        historyAction\n      });\n      if (blockerKey && delta != null) {\n        // Restore the URL to match the current UI, but don't update router state\n        let nextHistoryUpdatePromise = new Promise(resolve => {\n          unblockBlockerHistoryUpdate = resolve;\n        });\n        init.history.go(delta * -1);\n        // Put the blocker into a blocked state\n        updateBlocker(blockerKey, {\n          state: \"blocked\",\n          location,\n          proceed() {\n            updateBlocker(blockerKey, {\n              state: \"proceeding\",\n              proceed: undefined,\n              reset: undefined,\n              location\n            });\n            // Re-do the same POP navigation we just blocked, after the url\n            // restoration is also complete.  See:\n            // https://github.com/remix-run/react-router/issues/11613\n            nextHistoryUpdatePromise.then(() => init.history.go(delta));\n          },\n          reset() {\n            let blockers = new Map(state.blockers);\n            blockers.set(blockerKey, IDLE_BLOCKER);\n            updateState({\n              blockers\n            });\n          }\n        });\n        return;\n      }\n      return startNavigation(historyAction, location);\n    });\n    if (isBrowser) {\n      // FIXME: This feels gross.  How can we cleanup the lines between\n      // scrollRestoration/appliedTransitions persistance?\n      restoreAppliedTransitions(routerWindow, appliedViewTransitions);\n      let _saveAppliedTransitions = () => persistAppliedTransitions(routerWindow, appliedViewTransitions);\n      routerWindow.addEventListener(\"pagehide\", _saveAppliedTransitions);\n      removePageHideEventListener = () => routerWindow.removeEventListener(\"pagehide\", _saveAppliedTransitions);\n    }\n    // Kick off initial data load if needed.  Use Pop to avoid modifying history\n    // Note we don't do any handling of lazy here.  For SPA's it'll get handled\n    // in the normal navigation flow.  For SSR it's expected that lazy modules are\n    // resolved prior to router creation since we can't go into a fallbackElement\n    // UI for SSR'd apps\n    if (!state.initialized) {\n      startNavigation(Action.Pop, state.location, {\n        initialHydration: true\n      });\n    }\n    return router;\n  }\n  // Clean up a router and it's side effects\n  function dispose() {\n    if (unlistenHistory) {\n      unlistenHistory();\n    }\n    if (removePageHideEventListener) {\n      removePageHideEventListener();\n    }\n    subscribers.clear();\n    pendingNavigationController && pendingNavigationController.abort();\n    state.fetchers.forEach((_, key) => deleteFetcher(key));\n    state.blockers.forEach((_, key) => deleteBlocker(key));\n  }\n  // Subscribe to state updates for the router\n  function subscribe(fn) {\n    subscribers.add(fn);\n    return () => subscribers.delete(fn);\n  }\n  // Update our state and notify the calling context of the change\n  function updateState(newState, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    state = _extends({}, state, newState);\n    // Prep fetcher cleanup so we can tell the UI which fetcher data entries\n    // can be removed\n    let completedFetchers = [];\n    let deletedFetchersKeys = [];\n    if (future.v7_fetcherPersist) {\n      state.fetchers.forEach((fetcher, key) => {\n        if (fetcher.state === \"idle\") {\n          if (deletedFetchers.has(key)) {\n            // Unmounted from the UI and can be totally removed\n            deletedFetchersKeys.push(key);\n          } else {\n            // Returned to idle but still mounted in the UI, so semi-remains for\n            // revalidations and such\n            completedFetchers.push(key);\n          }\n        }\n      });\n    }\n    // Remove any lingering deleted fetchers that have already been removed\n    // from state.fetchers\n    deletedFetchers.forEach(key => {\n      if (!state.fetchers.has(key) && !fetchControllers.has(key)) {\n        deletedFetchersKeys.push(key);\n      }\n    });\n    // Iterate over a local copy so that if flushSync is used and we end up\n    // removing and adding a new subscriber due to the useCallback dependencies,\n    // we don't get ourselves into a loop calling the new subscriber immediately\n    [...subscribers].forEach(subscriber => subscriber(state, {\n      deletedFetchers: deletedFetchersKeys,\n      viewTransitionOpts: opts.viewTransitionOpts,\n      flushSync: opts.flushSync === true\n    }));\n    // Remove idle fetchers from state since we only care about in-flight fetchers.\n    if (future.v7_fetcherPersist) {\n      completedFetchers.forEach(key => state.fetchers.delete(key));\n      deletedFetchersKeys.forEach(key => deleteFetcher(key));\n    } else {\n      // We already called deleteFetcher() on these, can remove them from this\n      // Set now that we've handed the keys off to the data layer\n      deletedFetchersKeys.forEach(key => deletedFetchers.delete(key));\n    }\n  }\n  // Complete a navigation returning the state.navigation back to the IDLE_NAVIGATION\n  // and setting state.[historyAction/location/matches] to the new route.\n  // - Location is a required param\n  // - Navigation will always be set to IDLE_NAVIGATION\n  // - Can pass any other state in newState\n  function completeNavigation(location, newState, _temp) {\n    var _location$state, _location$state2;\n    let {\n      flushSync\n    } = _temp === void 0 ? {} : _temp;\n    // Deduce if we're in a loading/actionReload state:\n    // - We have committed actionData in the store\n    // - The current navigation was a mutation submission\n    // - We're past the submitting state and into the loading state\n    // - The location being loaded is not the result of a redirect\n    let isActionReload = state.actionData != null && state.navigation.formMethod != null && isMutationMethod(state.navigation.formMethod) && state.navigation.state === \"loading\" && ((_location$state = location.state) == null ? void 0 : _location$state._isRedirect) !== true;\n    let actionData;\n    if (newState.actionData) {\n      if (Object.keys(newState.actionData).length > 0) {\n        actionData = newState.actionData;\n      } else {\n        // Empty actionData -> clear prior actionData due to an action error\n        actionData = null;\n      }\n    } else if (isActionReload) {\n      // Keep the current data if we're wrapping up the action reload\n      actionData = state.actionData;\n    } else {\n      // Clear actionData on any other completed navigations\n      actionData = null;\n    }\n    // Always preserve any existing loaderData from re-used routes\n    let loaderData = newState.loaderData ? mergeLoaderData(state.loaderData, newState.loaderData, newState.matches || [], newState.errors) : state.loaderData;\n    // On a successful navigation we can assume we got through all blockers\n    // so we can start fresh\n    let blockers = state.blockers;\n    if (blockers.size > 0) {\n      blockers = new Map(blockers);\n      blockers.forEach((_, k) => blockers.set(k, IDLE_BLOCKER));\n    }\n    // Always respect the user flag.  Otherwise don't reset on mutation\n    // submission navigations unless they redirect\n    let preventScrollReset = pendingPreventScrollReset === true || state.navigation.formMethod != null && isMutationMethod(state.navigation.formMethod) && ((_location$state2 = location.state) == null ? void 0 : _location$state2._isRedirect) !== true;\n    // Commit any in-flight routes at the end of the HMR revalidation \"navigation\"\n    if (inFlightDataRoutes) {\n      dataRoutes = inFlightDataRoutes;\n      inFlightDataRoutes = undefined;\n    }\n    if (isUninterruptedRevalidation) ; else if (pendingAction === Action.Pop) ; else if (pendingAction === Action.Push) {\n      init.history.push(location, location.state);\n    } else if (pendingAction === Action.Replace) {\n      init.history.replace(location, location.state);\n    }\n    let viewTransitionOpts;\n    // On POP, enable transitions if they were enabled on the original navigation\n    if (pendingAction === Action.Pop) {\n      // Forward takes precedence so they behave like the original navigation\n      let priorPaths = appliedViewTransitions.get(state.location.pathname);\n      if (priorPaths && priorPaths.has(location.pathname)) {\n        viewTransitionOpts = {\n          currentLocation: state.location,\n          nextLocation: location\n        };\n      } else if (appliedViewTransitions.has(location.pathname)) {\n        // If we don't have a previous forward nav, assume we're popping back to\n        // the new location and enable if that location previously enabled\n        viewTransitionOpts = {\n          currentLocation: location,\n          nextLocation: state.location\n        };\n      }\n    } else if (pendingViewTransitionEnabled) {\n      // Store the applied transition on PUSH/REPLACE\n      let toPaths = appliedViewTransitions.get(state.location.pathname);\n      if (toPaths) {\n        toPaths.add(location.pathname);\n      } else {\n        toPaths = new Set([location.pathname]);\n        appliedViewTransitions.set(state.location.pathname, toPaths);\n      }\n      viewTransitionOpts = {\n        currentLocation: state.location,\n        nextLocation: location\n      };\n    }\n    updateState(_extends({}, newState, {\n      actionData,\n      loaderData,\n      historyAction: pendingAction,\n      location,\n      initialized: true,\n      navigation: IDLE_NAVIGATION,\n      revalidation: \"idle\",\n      restoreScrollPosition: getSavedScrollPosition(location, newState.matches || state.matches),\n      preventScrollReset,\n      blockers\n    }), {\n      viewTransitionOpts,\n      flushSync: flushSync === true\n    });\n    // Reset stateful navigation vars\n    pendingAction = Action.Pop;\n    pendingPreventScrollReset = false;\n    pendingViewTransitionEnabled = false;\n    isUninterruptedRevalidation = false;\n    isRevalidationRequired = false;\n    cancelledDeferredRoutes = [];\n  }\n  // Trigger a navigation event, which can either be a numerical POP or a PUSH\n  // replace with an optional submission\n  async function navigate(to, opts) {\n    if (typeof to === \"number\") {\n      init.history.go(to);\n      return;\n    }\n    let normalizedPath = normalizeTo(state.location, state.matches, basename, future.v7_prependBasename, to, future.v7_relativeSplatPath, opts == null ? void 0 : opts.fromRouteId, opts == null ? void 0 : opts.relative);\n    let {\n      path,\n      submission,\n      error\n    } = normalizeNavigateOptions(future.v7_normalizeFormMethod, false, normalizedPath, opts);\n    let currentLocation = state.location;\n    let nextLocation = createLocation(state.location, path, opts && opts.state);\n    // When using navigate as a PUSH/REPLACE we aren't reading an already-encoded\n    // URL from window.location, so we need to encode it here so the behavior\n    // remains the same as POP and non-data-router usages.  new URL() does all\n    // the same encoding we'd get from a history.pushState/window.location read\n    // without having to touch history\n    nextLocation = _extends({}, nextLocation, init.history.encodeLocation(nextLocation));\n    let userReplace = opts && opts.replace != null ? opts.replace : undefined;\n    let historyAction = Action.Push;\n    if (userReplace === true) {\n      historyAction = Action.Replace;\n    } else if (userReplace === false) ; else if (submission != null && isMutationMethod(submission.formMethod) && submission.formAction === state.location.pathname + state.location.search) {\n      // By default on submissions to the current location we REPLACE so that\n      // users don't have to double-click the back button to get to the prior\n      // location.  If the user redirects to a different location from the\n      // action/loader this will be ignored and the redirect will be a PUSH\n      historyAction = Action.Replace;\n    }\n    let preventScrollReset = opts && \"preventScrollReset\" in opts ? opts.preventScrollReset === true : undefined;\n    let flushSync = (opts && opts.flushSync) === true;\n    let blockerKey = shouldBlockNavigation({\n      currentLocation,\n      nextLocation,\n      historyAction\n    });\n    if (blockerKey) {\n      // Put the blocker into a blocked state\n      updateBlocker(blockerKey, {\n        state: \"blocked\",\n        location: nextLocation,\n        proceed() {\n          updateBlocker(blockerKey, {\n            state: \"proceeding\",\n            proceed: undefined,\n            reset: undefined,\n            location: nextLocation\n          });\n          // Send the same navigation through\n          navigate(to, opts);\n        },\n        reset() {\n          let blockers = new Map(state.blockers);\n          blockers.set(blockerKey, IDLE_BLOCKER);\n          updateState({\n            blockers\n          });\n        }\n      });\n      return;\n    }\n    return await startNavigation(historyAction, nextLocation, {\n      submission,\n      // Send through the formData serialization error if we have one so we can\n      // render at the right error boundary after we match routes\n      pendingError: error,\n      preventScrollReset,\n      replace: opts && opts.replace,\n      enableViewTransition: opts && opts.viewTransition,\n      flushSync\n    });\n  }\n  // Revalidate all current loaders.  If a navigation is in progress or if this\n  // is interrupted by a navigation, allow this to \"succeed\" by calling all\n  // loaders during the next loader round\n  function revalidate() {\n    interruptActiveLoads();\n    updateState({\n      revalidation: \"loading\"\n    });\n    // If we're currently submitting an action, we don't need to start a new\n    // navigation, we'll just let the follow up loader execution call all loaders\n    if (state.navigation.state === \"submitting\") {\n      return;\n    }\n    // If we're currently in an idle state, start a new navigation for the current\n    // action/location and mark it as uninterrupted, which will skip the history\n    // update in completeNavigation\n    if (state.navigation.state === \"idle\") {\n      startNavigation(state.historyAction, state.location, {\n        startUninterruptedRevalidation: true\n      });\n      return;\n    }\n    // Otherwise, if we're currently in a loading state, just start a new\n    // navigation to the navigation.location but do not trigger an uninterrupted\n    // revalidation so that history correctly updates once the navigation completes\n    startNavigation(pendingAction || state.historyAction, state.navigation.location, {\n      overrideNavigation: state.navigation,\n      // Proxy through any rending view transition\n      enableViewTransition: pendingViewTransitionEnabled === true\n    });\n  }\n  // Start a navigation to the given action/location.  Can optionally provide a\n  // overrideNavigation which will override the normalLoad in the case of a redirect\n  // navigation\n  async function startNavigation(historyAction, location, opts) {\n    // Abort any in-progress navigations and start a new one. Unset any ongoing\n    // uninterrupted revalidations unless told otherwise, since we want this\n    // new navigation to update history normally\n    pendingNavigationController && pendingNavigationController.abort();\n    pendingNavigationController = null;\n    pendingAction = historyAction;\n    isUninterruptedRevalidation = (opts && opts.startUninterruptedRevalidation) === true;\n    // Save the current scroll position every time we start a new navigation,\n    // and track whether we should reset scroll on completion\n    saveScrollPosition(state.location, state.matches);\n    pendingPreventScrollReset = (opts && opts.preventScrollReset) === true;\n    pendingViewTransitionEnabled = (opts && opts.enableViewTransition) === true;\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let loadingNavigation = opts && opts.overrideNavigation;\n    let matches = opts != null && opts.initialHydration && state.matches && state.matches.length > 0 && !initialMatchesIsFOW ?\n    // `matchRoutes()` has already been called if we're in here via `router.initialize()`\n    state.matches : matchRoutes(routesToUse, location, basename);\n    let flushSync = (opts && opts.flushSync) === true;\n    // Short circuit if it's only a hash change and not a revalidation or\n    // mutation submission.\n    //\n    // Ignore on initial page loads because since the initial hydration will always\n    // be \"same hash\".  For example, on /page#hash and submit a <Form method=\"post\">\n    // which will default to a navigation to /page\n    if (matches && state.initialized && !isRevalidationRequired && isHashChangeOnly(state.location, location) && !(opts && opts.submission && isMutationMethod(opts.submission.formMethod))) {\n      completeNavigation(location, {\n        matches\n      }, {\n        flushSync\n      });\n      return;\n    }\n    let fogOfWar = checkFogOfWar(matches, routesToUse, location.pathname);\n    if (fogOfWar.active && fogOfWar.matches) {\n      matches = fogOfWar.matches;\n    }\n    // Short circuit with a 404 on the root error boundary if we match nothing\n    if (!matches) {\n      let {\n        error,\n        notFoundMatches,\n        route\n      } = handleNavigational404(location.pathname);\n      completeNavigation(location, {\n        matches: notFoundMatches,\n        loaderData: {},\n        errors: {\n          [route.id]: error\n        }\n      }, {\n        flushSync\n      });\n      return;\n    }\n    // Create a controller/Request for this navigation\n    pendingNavigationController = new AbortController();\n    let request = createClientSideRequest(init.history, location, pendingNavigationController.signal, opts && opts.submission);\n    let pendingActionResult;\n    if (opts && opts.pendingError) {\n      // If we have a pendingError, it means the user attempted a GET submission\n      // with binary FormData so assign here and skip to handleLoaders.  That\n      // way we handle calling loaders above the boundary etc.  It's not really\n      // different from an actionError in that sense.\n      pendingActionResult = [findNearestBoundary(matches).route.id, {\n        type: ResultType.error,\n        error: opts.pendingError\n      }];\n    } else if (opts && opts.submission && isMutationMethod(opts.submission.formMethod)) {\n      // Call action if we received an action submission\n      let actionResult = await handleAction(request, location, opts.submission, matches, fogOfWar.active, {\n        replace: opts.replace,\n        flushSync\n      });\n      if (actionResult.shortCircuited) {\n        return;\n      }\n      // If we received a 404 from handleAction, it's because we couldn't lazily\n      // discover the destination route so we don't want to call loaders\n      if (actionResult.pendingActionResult) {\n        let [routeId, result] = actionResult.pendingActionResult;\n        if (isErrorResult(result) && isRouteErrorResponse(result.error) && result.error.status === 404) {\n          pendingNavigationController = null;\n          completeNavigation(location, {\n            matches: actionResult.matches,\n            loaderData: {},\n            errors: {\n              [routeId]: result.error\n            }\n          });\n          return;\n        }\n      }\n      matches = actionResult.matches || matches;\n      pendingActionResult = actionResult.pendingActionResult;\n      loadingNavigation = getLoadingNavigation(location, opts.submission);\n      flushSync = false;\n      // No need to do fog of war matching again on loader execution\n      fogOfWar.active = false;\n      // Create a GET request for the loaders\n      request = createClientSideRequest(init.history, request.url, request.signal);\n    }\n    // Call loaders\n    let {\n      shortCircuited,\n      matches: updatedMatches,\n      loaderData,\n      errors\n    } = await handleLoaders(request, location, matches, fogOfWar.active, loadingNavigation, opts && opts.submission, opts && opts.fetcherSubmission, opts && opts.replace, opts && opts.initialHydration === true, flushSync, pendingActionResult);\n    if (shortCircuited) {\n      return;\n    }\n    // Clean up now that the action/loaders have completed.  Don't clean up if\n    // we short circuited because pendingNavigationController will have already\n    // been assigned to a new controller for the next navigation\n    pendingNavigationController = null;\n    completeNavigation(location, _extends({\n      matches: updatedMatches || matches\n    }, getActionDataForCommit(pendingActionResult), {\n      loaderData,\n      errors\n    }));\n  }\n  // Call the action matched by the leaf route for this navigation and handle\n  // redirects/errors\n  async function handleAction(request, location, submission, matches, isFogOfWar, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    interruptActiveLoads();\n    // Put us in a submitting state\n    let navigation = getSubmittingNavigation(location, submission);\n    updateState({\n      navigation\n    }, {\n      flushSync: opts.flushSync === true\n    });\n    if (isFogOfWar) {\n      let discoverResult = await discoverRoutes(matches, location.pathname, request.signal);\n      if (discoverResult.type === \"aborted\") {\n        return {\n          shortCircuited: true\n        };\n      } else if (discoverResult.type === \"error\") {\n        let boundaryId = findNearestBoundary(discoverResult.partialMatches).route.id;\n        return {\n          matches: discoverResult.partialMatches,\n          pendingActionResult: [boundaryId, {\n            type: ResultType.error,\n            error: discoverResult.error\n          }]\n        };\n      } else if (!discoverResult.matches) {\n        let {\n          notFoundMatches,\n          error,\n          route\n        } = handleNavigational404(location.pathname);\n        return {\n          matches: notFoundMatches,\n          pendingActionResult: [route.id, {\n            type: ResultType.error,\n            error\n          }]\n        };\n      } else {\n        matches = discoverResult.matches;\n      }\n    }\n    // Call our action and get the result\n    let result;\n    let actionMatch = getTargetMatch(matches, location);\n    if (!actionMatch.route.action && !actionMatch.route.lazy) {\n      result = {\n        type: ResultType.error,\n        error: getInternalRouterError(405, {\n          method: request.method,\n          pathname: location.pathname,\n          routeId: actionMatch.route.id\n        })\n      };\n    } else {\n      let results = await callDataStrategy(\"action\", state, request, [actionMatch], matches, null);\n      result = results[actionMatch.route.id];\n      if (request.signal.aborted) {\n        return {\n          shortCircuited: true\n        };\n      }\n    }\n    if (isRedirectResult(result)) {\n      let replace;\n      if (opts && opts.replace != null) {\n        replace = opts.replace;\n      } else {\n        // If the user didn't explicity indicate replace behavior, replace if\n        // we redirected to the exact same location we're currently at to avoid\n        // double back-buttons\n        let location = normalizeRedirectLocation(result.response.headers.get(\"Location\"), new URL(request.url), basename);\n        replace = location === state.location.pathname + state.location.search;\n      }\n      await startRedirectNavigation(request, result, true, {\n        submission,\n        replace\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    if (isDeferredResult(result)) {\n      throw getInternalRouterError(400, {\n        type: \"defer-action\"\n      });\n    }\n    if (isErrorResult(result)) {\n      // Store off the pending error - we use it to determine which loaders\n      // to call and will commit it when we complete the navigation\n      let boundaryMatch = findNearestBoundary(matches, actionMatch.route.id);\n      // By default, all submissions to the current location are REPLACE\n      // navigations, but if the action threw an error that'll be rendered in\n      // an errorElement, we fall back to PUSH so that the user can use the\n      // back button to get back to the pre-submission form location to try\n      // again\n      if ((opts && opts.replace) !== true) {\n        pendingAction = Action.Push;\n      }\n      return {\n        matches,\n        pendingActionResult: [boundaryMatch.route.id, result]\n      };\n    }\n    return {\n      matches,\n      pendingActionResult: [actionMatch.route.id, result]\n    };\n  }\n  // Call all applicable loaders for the given matches, handling redirects,\n  // errors, etc.\n  async function handleLoaders(request, location, matches, isFogOfWar, overrideNavigation, submission, fetcherSubmission, replace, initialHydration, flushSync, pendingActionResult) {\n    // Figure out the right navigation we want to use for data loading\n    let loadingNavigation = overrideNavigation || getLoadingNavigation(location, submission);\n    // If this was a redirect from an action we don't have a \"submission\" but\n    // we have it on the loading navigation so use that if available\n    let activeSubmission = submission || fetcherSubmission || getSubmissionFromNavigation(loadingNavigation);\n    // If this is an uninterrupted revalidation, we remain in our current idle\n    // state.  If not, we need to switch to our loading state and load data,\n    // preserving any new action data or existing action data (in the case of\n    // a revalidation interrupting an actionReload)\n    // If we have partialHydration enabled, then don't update the state for the\n    // initial data load since it's not a \"navigation\"\n    let shouldUpdateNavigationState = !isUninterruptedRevalidation && (!future.v7_partialHydration || !initialHydration);\n    // When fog of war is enabled, we enter our `loading` state earlier so we\n    // can discover new routes during the `loading` state.  We skip this if\n    // we've already run actions since we would have done our matching already.\n    // If the children() function threw then, we want to proceed with the\n    // partial matches it discovered.\n    if (isFogOfWar) {\n      if (shouldUpdateNavigationState) {\n        let actionData = getUpdatedActionData(pendingActionResult);\n        updateState(_extends({\n          navigation: loadingNavigation\n        }, actionData !== undefined ? {\n          actionData\n        } : {}), {\n          flushSync\n        });\n      }\n      let discoverResult = await discoverRoutes(matches, location.pathname, request.signal);\n      if (discoverResult.type === \"aborted\") {\n        return {\n          shortCircuited: true\n        };\n      } else if (discoverResult.type === \"error\") {\n        let boundaryId = findNearestBoundary(discoverResult.partialMatches).route.id;\n        return {\n          matches: discoverResult.partialMatches,\n          loaderData: {},\n          errors: {\n            [boundaryId]: discoverResult.error\n          }\n        };\n      } else if (!discoverResult.matches) {\n        let {\n          error,\n          notFoundMatches,\n          route\n        } = handleNavigational404(location.pathname);\n        return {\n          matches: notFoundMatches,\n          loaderData: {},\n          errors: {\n            [route.id]: error\n          }\n        };\n      } else {\n        matches = discoverResult.matches;\n      }\n    }\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let [matchesToLoad, revalidatingFetchers] = getMatchesToLoad(init.history, state, matches, activeSubmission, location, future.v7_partialHydration && initialHydration === true, future.v7_skipActionErrorRevalidation, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, deletedFetchers, fetchLoadMatches, fetchRedirectIds, routesToUse, basename, pendingActionResult);\n    // Cancel pending deferreds for no-longer-matched routes or routes we're\n    // about to reload.  Note that if this is an action reload we would have\n    // already cancelled all pending deferreds so this would be a no-op\n    cancelActiveDeferreds(routeId => !(matches && matches.some(m => m.route.id === routeId)) || matchesToLoad && matchesToLoad.some(m => m.route.id === routeId));\n    pendingNavigationLoadId = ++incrementingLoadId;\n    // Short circuit if we have no loaders to run\n    if (matchesToLoad.length === 0 && revalidatingFetchers.length === 0) {\n      let updatedFetchers = markFetchRedirectsDone();\n      completeNavigation(location, _extends({\n        matches,\n        loaderData: {},\n        // Commit pending error if we're short circuiting\n        errors: pendingActionResult && isErrorResult(pendingActionResult[1]) ? {\n          [pendingActionResult[0]]: pendingActionResult[1].error\n        } : null\n      }, getActionDataForCommit(pendingActionResult), updatedFetchers ? {\n        fetchers: new Map(state.fetchers)\n      } : {}), {\n        flushSync\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    if (shouldUpdateNavigationState) {\n      let updates = {};\n      if (!isFogOfWar) {\n        // Only update navigation/actionNData if we didn't already do it above\n        updates.navigation = loadingNavigation;\n        let actionData = getUpdatedActionData(pendingActionResult);\n        if (actionData !== undefined) {\n          updates.actionData = actionData;\n        }\n      }\n      if (revalidatingFetchers.length > 0) {\n        updates.fetchers = getUpdatedRevalidatingFetchers(revalidatingFetchers);\n      }\n      updateState(updates, {\n        flushSync\n      });\n    }\n    revalidatingFetchers.forEach(rf => {\n      abortFetcher(rf.key);\n      if (rf.controller) {\n        // Fetchers use an independent AbortController so that aborting a fetcher\n        // (via deleteFetcher) does not abort the triggering navigation that\n        // triggered the revalidation\n        fetchControllers.set(rf.key, rf.controller);\n      }\n    });\n    // Proxy navigation abort through to revalidation fetchers\n    let abortPendingFetchRevalidations = () => revalidatingFetchers.forEach(f => abortFetcher(f.key));\n    if (pendingNavigationController) {\n      pendingNavigationController.signal.addEventListener(\"abort\", abortPendingFetchRevalidations);\n    }\n    let {\n      loaderResults,\n      fetcherResults\n    } = await callLoadersAndMaybeResolveData(state, matches, matchesToLoad, revalidatingFetchers, request);\n    if (request.signal.aborted) {\n      return {\n        shortCircuited: true\n      };\n    }\n    // Clean up _after_ loaders have completed.  Don't clean up if we short\n    // circuited because fetchControllers would have been aborted and\n    // reassigned to new controllers for the next navigation\n    if (pendingNavigationController) {\n      pendingNavigationController.signal.removeEventListener(\"abort\", abortPendingFetchRevalidations);\n    }\n    revalidatingFetchers.forEach(rf => fetchControllers.delete(rf.key));\n    // If any loaders returned a redirect Response, start a new REPLACE navigation\n    let redirect = findRedirect(loaderResults);\n    if (redirect) {\n      await startRedirectNavigation(request, redirect.result, true, {\n        replace\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    redirect = findRedirect(fetcherResults);\n    if (redirect) {\n      // If this redirect came from a fetcher make sure we mark it in\n      // fetchRedirectIds so it doesn't get revalidated on the next set of\n      // loader executions\n      fetchRedirectIds.add(redirect.key);\n      await startRedirectNavigation(request, redirect.result, true, {\n        replace\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    // Process and commit output from loaders\n    let {\n      loaderData,\n      errors\n    } = processLoaderData(state, matches, loaderResults, pendingActionResult, revalidatingFetchers, fetcherResults, activeDeferreds);\n    // Wire up subscribers to update loaderData as promises settle\n    activeDeferreds.forEach((deferredData, routeId) => {\n      deferredData.subscribe(aborted => {\n        // Note: No need to updateState here since the TrackedPromise on\n        // loaderData is stable across resolve/reject\n        // Remove this instance if we were aborted or if promises have settled\n        if (aborted || deferredData.done) {\n          activeDeferreds.delete(routeId);\n        }\n      });\n    });\n    // Preserve SSR errors during partial hydration\n    if (future.v7_partialHydration && initialHydration && state.errors) {\n      errors = _extends({}, state.errors, errors);\n    }\n    let updatedFetchers = markFetchRedirectsDone();\n    let didAbortFetchLoads = abortStaleFetchLoads(pendingNavigationLoadId);\n    let shouldUpdateFetchers = updatedFetchers || didAbortFetchLoads || revalidatingFetchers.length > 0;\n    return _extends({\n      matches,\n      loaderData,\n      errors\n    }, shouldUpdateFetchers ? {\n      fetchers: new Map(state.fetchers)\n    } : {});\n  }\n  function getUpdatedActionData(pendingActionResult) {\n    if (pendingActionResult && !isErrorResult(pendingActionResult[1])) {\n      // This is cast to `any` currently because `RouteData`uses any and it\n      // would be a breaking change to use any.\n      // TODO: v7 - change `RouteData` to use `unknown` instead of `any`\n      return {\n        [pendingActionResult[0]]: pendingActionResult[1].data\n      };\n    } else if (state.actionData) {\n      if (Object.keys(state.actionData).length === 0) {\n        return null;\n      } else {\n        return state.actionData;\n      }\n    }\n  }\n  function getUpdatedRevalidatingFetchers(revalidatingFetchers) {\n    revalidatingFetchers.forEach(rf => {\n      let fetcher = state.fetchers.get(rf.key);\n      let revalidatingFetcher = getLoadingFetcher(undefined, fetcher ? fetcher.data : undefined);\n      state.fetchers.set(rf.key, revalidatingFetcher);\n    });\n    return new Map(state.fetchers);\n  }\n  // Trigger a fetcher load/submit for the given fetcher key\n  function fetch(key, routeId, href, opts) {\n    if (isServer) {\n      throw new Error(\"router.fetch() was called during the server render, but it shouldn't be. \" + \"You are likely calling a useFetcher() method in the body of your component. \" + \"Try moving it to a useEffect or a callback.\");\n    }\n    abortFetcher(key);\n    let flushSync = (opts && opts.flushSync) === true;\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let normalizedPath = normalizeTo(state.location, state.matches, basename, future.v7_prependBasename, href, future.v7_relativeSplatPath, routeId, opts == null ? void 0 : opts.relative);\n    let matches = matchRoutes(routesToUse, normalizedPath, basename);\n    let fogOfWar = checkFogOfWar(matches, routesToUse, normalizedPath);\n    if (fogOfWar.active && fogOfWar.matches) {\n      matches = fogOfWar.matches;\n    }\n    if (!matches) {\n      setFetcherError(key, routeId, getInternalRouterError(404, {\n        pathname: normalizedPath\n      }), {\n        flushSync\n      });\n      return;\n    }\n    let {\n      path,\n      submission,\n      error\n    } = normalizeNavigateOptions(future.v7_normalizeFormMethod, true, normalizedPath, opts);\n    if (error) {\n      setFetcherError(key, routeId, error, {\n        flushSync\n      });\n      return;\n    }\n    let match = getTargetMatch(matches, path);\n    let preventScrollReset = (opts && opts.preventScrollReset) === true;\n    if (submission && isMutationMethod(submission.formMethod)) {\n      handleFetcherAction(key, routeId, path, match, matches, fogOfWar.active, flushSync, preventScrollReset, submission);\n      return;\n    }\n    // Store off the match so we can call it's shouldRevalidate on subsequent\n    // revalidations\n    fetchLoadMatches.set(key, {\n      routeId,\n      path\n    });\n    handleFetcherLoader(key, routeId, path, match, matches, fogOfWar.active, flushSync, preventScrollReset, submission);\n  }\n  // Call the action for the matched fetcher.submit(), and then handle redirects,\n  // errors, and revalidation\n  async function handleFetcherAction(key, routeId, path, match, requestMatches, isFogOfWar, flushSync, preventScrollReset, submission) {\n    interruptActiveLoads();\n    fetchLoadMatches.delete(key);\n    function detectAndHandle405Error(m) {\n      if (!m.route.action && !m.route.lazy) {\n        let error = getInternalRouterError(405, {\n          method: submission.formMethod,\n          pathname: path,\n          routeId: routeId\n        });\n        setFetcherError(key, routeId, error, {\n          flushSync\n        });\n        return true;\n      }\n      return false;\n    }\n    if (!isFogOfWar && detectAndHandle405Error(match)) {\n      return;\n    }\n    // Put this fetcher into it's submitting state\n    let existingFetcher = state.fetchers.get(key);\n    updateFetcherState(key, getSubmittingFetcher(submission, existingFetcher), {\n      flushSync\n    });\n    let abortController = new AbortController();\n    let fetchRequest = createClientSideRequest(init.history, path, abortController.signal, submission);\n    if (isFogOfWar) {\n      let discoverResult = await discoverRoutes(requestMatches, new URL(fetchRequest.url).pathname, fetchRequest.signal, key);\n      if (discoverResult.type === \"aborted\") {\n        return;\n      } else if (discoverResult.type === \"error\") {\n        setFetcherError(key, routeId, discoverResult.error, {\n          flushSync\n        });\n        return;\n      } else if (!discoverResult.matches) {\n        setFetcherError(key, routeId, getInternalRouterError(404, {\n          pathname: path\n        }), {\n          flushSync\n        });\n        return;\n      } else {\n        requestMatches = discoverResult.matches;\n        match = getTargetMatch(requestMatches, path);\n        if (detectAndHandle405Error(match)) {\n          return;\n        }\n      }\n    }\n    // Call the action for the fetcher\n    fetchControllers.set(key, abortController);\n    let originatingLoadId = incrementingLoadId;\n    let actionResults = await callDataStrategy(\"action\", state, fetchRequest, [match], requestMatches, key);\n    let actionResult = actionResults[match.route.id];\n    if (fetchRequest.signal.aborted) {\n      // We can delete this so long as we weren't aborted by our own fetcher\n      // re-submit which would have put _new_ controller is in fetchControllers\n      if (fetchControllers.get(key) === abortController) {\n        fetchControllers.delete(key);\n      }\n      return;\n    }\n    // When using v7_fetcherPersist, we don't want errors bubbling up to the UI\n    // or redirects processed for unmounted fetchers so we just revert them to\n    // idle\n    if (future.v7_fetcherPersist && deletedFetchers.has(key)) {\n      if (isRedirectResult(actionResult) || isErrorResult(actionResult)) {\n        updateFetcherState(key, getDoneFetcher(undefined));\n        return;\n      }\n      // Let SuccessResult's fall through for revalidation\n    } else {\n      if (isRedirectResult(actionResult)) {\n        fetchControllers.delete(key);\n        if (pendingNavigationLoadId > originatingLoadId) {\n          // A new navigation was kicked off after our action started, so that\n          // should take precedence over this redirect navigation.  We already\n          // set isRevalidationRequired so all loaders for the new route should\n          // fire unless opted out via shouldRevalidate\n          updateFetcherState(key, getDoneFetcher(undefined));\n          return;\n        } else {\n          fetchRedirectIds.add(key);\n          updateFetcherState(key, getLoadingFetcher(submission));\n          return startRedirectNavigation(fetchRequest, actionResult, false, {\n            fetcherSubmission: submission,\n            preventScrollReset\n          });\n        }\n      }\n      // Process any non-redirect errors thrown\n      if (isErrorResult(actionResult)) {\n        setFetcherError(key, routeId, actionResult.error);\n        return;\n      }\n    }\n    if (isDeferredResult(actionResult)) {\n      throw getInternalRouterError(400, {\n        type: \"defer-action\"\n      });\n    }\n    // Start the data load for current matches, or the next location if we're\n    // in the middle of a navigation\n    let nextLocation = state.navigation.location || state.location;\n    let revalidationRequest = createClientSideRequest(init.history, nextLocation, abortController.signal);\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let matches = state.navigation.state !== \"idle\" ? matchRoutes(routesToUse, state.navigation.location, basename) : state.matches;\n    invariant(matches, \"Didn't find any matches after fetcher action\");\n    let loadId = ++incrementingLoadId;\n    fetchReloadIds.set(key, loadId);\n    let loadFetcher = getLoadingFetcher(submission, actionResult.data);\n    state.fetchers.set(key, loadFetcher);\n    let [matchesToLoad, revalidatingFetchers] = getMatchesToLoad(init.history, state, matches, submission, nextLocation, false, future.v7_skipActionErrorRevalidation, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, deletedFetchers, fetchLoadMatches, fetchRedirectIds, routesToUse, basename, [match.route.id, actionResult]);\n    // Put all revalidating fetchers into the loading state, except for the\n    // current fetcher which we want to keep in it's current loading state which\n    // contains it's action submission info + action data\n    revalidatingFetchers.filter(rf => rf.key !== key).forEach(rf => {\n      let staleKey = rf.key;\n      let existingFetcher = state.fetchers.get(staleKey);\n      let revalidatingFetcher = getLoadingFetcher(undefined, existingFetcher ? existingFetcher.data : undefined);\n      state.fetchers.set(staleKey, revalidatingFetcher);\n      abortFetcher(staleKey);\n      if (rf.controller) {\n        fetchControllers.set(staleKey, rf.controller);\n      }\n    });\n    updateState({\n      fetchers: new Map(state.fetchers)\n    });\n    let abortPendingFetchRevalidations = () => revalidatingFetchers.forEach(rf => abortFetcher(rf.key));\n    abortController.signal.addEventListener(\"abort\", abortPendingFetchRevalidations);\n    let {\n      loaderResults,\n      fetcherResults\n    } = await callLoadersAndMaybeResolveData(state, matches, matchesToLoad, revalidatingFetchers, revalidationRequest);\n    if (abortController.signal.aborted) {\n      return;\n    }\n    abortController.signal.removeEventListener(\"abort\", abortPendingFetchRevalidations);\n    fetchReloadIds.delete(key);\n    fetchControllers.delete(key);\n    revalidatingFetchers.forEach(r => fetchControllers.delete(r.key));\n    let redirect = findRedirect(loaderResults);\n    if (redirect) {\n      return startRedirectNavigation(revalidationRequest, redirect.result, false, {\n        preventScrollReset\n      });\n    }\n    redirect = findRedirect(fetcherResults);\n    if (redirect) {\n      // If this redirect came from a fetcher make sure we mark it in\n      // fetchRedirectIds so it doesn't get revalidated on the next set of\n      // loader executions\n      fetchRedirectIds.add(redirect.key);\n      return startRedirectNavigation(revalidationRequest, redirect.result, false, {\n        preventScrollReset\n      });\n    }\n    // Process and commit output from loaders\n    let {\n      loaderData,\n      errors\n    } = processLoaderData(state, matches, loaderResults, undefined, revalidatingFetchers, fetcherResults, activeDeferreds);\n    // Since we let revalidations complete even if the submitting fetcher was\n    // deleted, only put it back to idle if it hasn't been deleted\n    if (state.fetchers.has(key)) {\n      let doneFetcher = getDoneFetcher(actionResult.data);\n      state.fetchers.set(key, doneFetcher);\n    }\n    abortStaleFetchLoads(loadId);\n    // If we are currently in a navigation loading state and this fetcher is\n    // more recent than the navigation, we want the newer data so abort the\n    // navigation and complete it with the fetcher data\n    if (state.navigation.state === \"loading\" && loadId > pendingNavigationLoadId) {\n      invariant(pendingAction, \"Expected pending action\");\n      pendingNavigationController && pendingNavigationController.abort();\n      completeNavigation(state.navigation.location, {\n        matches,\n        loaderData,\n        errors,\n        fetchers: new Map(state.fetchers)\n      });\n    } else {\n      // otherwise just update with the fetcher data, preserving any existing\n      // loaderData for loaders that did not need to reload.  We have to\n      // manually merge here since we aren't going through completeNavigation\n      updateState({\n        errors,\n        loaderData: mergeLoaderData(state.loaderData, loaderData, matches, errors),\n        fetchers: new Map(state.fetchers)\n      });\n      isRevalidationRequired = false;\n    }\n  }\n  // Call the matched loader for fetcher.load(), handling redirects, errors, etc.\n  async function handleFetcherLoader(key, routeId, path, match, matches, isFogOfWar, flushSync, preventScrollReset, submission) {\n    let existingFetcher = state.fetchers.get(key);\n    updateFetcherState(key, getLoadingFetcher(submission, existingFetcher ? existingFetcher.data : undefined), {\n      flushSync\n    });\n    let abortController = new AbortController();\n    let fetchRequest = createClientSideRequest(init.history, path, abortController.signal);\n    if (isFogOfWar) {\n      let discoverResult = await discoverRoutes(matches, new URL(fetchRequest.url).pathname, fetchRequest.signal, key);\n      if (discoverResult.type === \"aborted\") {\n        return;\n      } else if (discoverResult.type === \"error\") {\n        setFetcherError(key, routeId, discoverResult.error, {\n          flushSync\n        });\n        return;\n      } else if (!discoverResult.matches) {\n        setFetcherError(key, routeId, getInternalRouterError(404, {\n          pathname: path\n        }), {\n          flushSync\n        });\n        return;\n      } else {\n        matches = discoverResult.matches;\n        match = getTargetMatch(matches, path);\n      }\n    }\n    // Call the loader for this fetcher route match\n    fetchControllers.set(key, abortController);\n    let originatingLoadId = incrementingLoadId;\n    let results = await callDataStrategy(\"loader\", state, fetchRequest, [match], matches, key);\n    let result = results[match.route.id];\n    // Deferred isn't supported for fetcher loads, await everything and treat it\n    // as a normal load.  resolveDeferredData will return undefined if this\n    // fetcher gets aborted, so we just leave result untouched and short circuit\n    // below if that happens\n    if (isDeferredResult(result)) {\n      result = (await resolveDeferredData(result, fetchRequest.signal, true)) || result;\n    }\n    // We can delete this so long as we weren't aborted by our our own fetcher\n    // re-load which would have put _new_ controller is in fetchControllers\n    if (fetchControllers.get(key) === abortController) {\n      fetchControllers.delete(key);\n    }\n    if (fetchRequest.signal.aborted) {\n      return;\n    }\n    // We don't want errors bubbling up or redirects followed for unmounted\n    // fetchers, so short circuit here if it was removed from the UI\n    if (deletedFetchers.has(key)) {\n      updateFetcherState(key, getDoneFetcher(undefined));\n      return;\n    }\n    // If the loader threw a redirect Response, start a new REPLACE navigation\n    if (isRedirectResult(result)) {\n      if (pendingNavigationLoadId > originatingLoadId) {\n        // A new navigation was kicked off after our loader started, so that\n        // should take precedence over this redirect navigation\n        updateFetcherState(key, getDoneFetcher(undefined));\n        return;\n      } else {\n        fetchRedirectIds.add(key);\n        await startRedirectNavigation(fetchRequest, result, false, {\n          preventScrollReset\n        });\n        return;\n      }\n    }\n    // Process any non-redirect errors thrown\n    if (isErrorResult(result)) {\n      setFetcherError(key, routeId, result.error);\n      return;\n    }\n    invariant(!isDeferredResult(result), \"Unhandled fetcher deferred data\");\n    // Put the fetcher back into an idle state\n    updateFetcherState(key, getDoneFetcher(result.data));\n  }\n  /**\n   * Utility function to handle redirects returned from an action or loader.\n   * Normally, a redirect \"replaces\" the navigation that triggered it.  So, for\n   * example:\n   *\n   *  - user is on /a\n   *  - user clicks a link to /b\n   *  - loader for /b redirects to /c\n   *\n   * In a non-JS app the browser would track the in-flight navigation to /b and\n   * then replace it with /c when it encountered the redirect response.  In\n   * the end it would only ever update the URL bar with /c.\n   *\n   * In client-side routing using pushState/replaceState, we aim to emulate\n   * this behavior and we also do not update history until the end of the\n   * navigation (including processed redirects).  This means that we never\n   * actually touch history until we've processed redirects, so we just use\n   * the history action from the original navigation (PUSH or REPLACE).\n   */\n  async function startRedirectNavigation(request, redirect, isNavigation, _temp2) {\n    let {\n      submission,\n      fetcherSubmission,\n      preventScrollReset,\n      replace\n    } = _temp2 === void 0 ? {} : _temp2;\n    if (redirect.response.headers.has(\"X-Remix-Revalidate\")) {\n      isRevalidationRequired = true;\n    }\n    let location = redirect.response.headers.get(\"Location\");\n    invariant(location, \"Expected a Location header on the redirect Response\");\n    location = normalizeRedirectLocation(location, new URL(request.url), basename);\n    let redirectLocation = createLocation(state.location, location, {\n      _isRedirect: true\n    });\n    if (isBrowser) {\n      let isDocumentReload = false;\n      if (redirect.response.headers.has(\"X-Remix-Reload-Document\")) {\n        // Hard reload if the response contained X-Remix-Reload-Document\n        isDocumentReload = true;\n      } else if (ABSOLUTE_URL_REGEX.test(location)) {\n        const url = init.history.createURL(location);\n        isDocumentReload =\n        // Hard reload if it's an absolute URL to a new origin\n        url.origin !== routerWindow.location.origin ||\n        // Hard reload if it's an absolute URL that does not match our basename\n        stripBasename(url.pathname, basename) == null;\n      }\n      if (isDocumentReload) {\n        if (replace) {\n          routerWindow.location.replace(location);\n        } else {\n          routerWindow.location.assign(location);\n        }\n        return;\n      }\n    }\n    // There's no need to abort on redirects, since we don't detect the\n    // redirect until the action/loaders have settled\n    pendingNavigationController = null;\n    let redirectHistoryAction = replace === true || redirect.response.headers.has(\"X-Remix-Replace\") ? Action.Replace : Action.Push;\n    // Use the incoming submission if provided, fallback on the active one in\n    // state.navigation\n    let {\n      formMethod,\n      formAction,\n      formEncType\n    } = state.navigation;\n    if (!submission && !fetcherSubmission && formMethod && formAction && formEncType) {\n      submission = getSubmissionFromNavigation(state.navigation);\n    }\n    // If this was a 307/308 submission we want to preserve the HTTP method and\n    // re-submit the GET/POST/PUT/PATCH/DELETE as a submission navigation to the\n    // redirected location\n    let activeSubmission = submission || fetcherSubmission;\n    if (redirectPreserveMethodStatusCodes.has(redirect.response.status) && activeSubmission && isMutationMethod(activeSubmission.formMethod)) {\n      await startNavigation(redirectHistoryAction, redirectLocation, {\n        submission: _extends({}, activeSubmission, {\n          formAction: location\n        }),\n        // Preserve these flags across redirects\n        preventScrollReset: preventScrollReset || pendingPreventScrollReset,\n        enableViewTransition: isNavigation ? pendingViewTransitionEnabled : undefined\n      });\n    } else {\n      // If we have a navigation submission, we will preserve it through the\n      // redirect navigation\n      let overrideNavigation = getLoadingNavigation(redirectLocation, submission);\n      await startNavigation(redirectHistoryAction, redirectLocation, {\n        overrideNavigation,\n        // Send fetcher submissions through for shouldRevalidate\n        fetcherSubmission,\n        // Preserve these flags across redirects\n        preventScrollReset: preventScrollReset || pendingPreventScrollReset,\n        enableViewTransition: isNavigation ? pendingViewTransitionEnabled : undefined\n      });\n    }\n  }\n  // Utility wrapper for calling dataStrategy client-side without having to\n  // pass around the manifest, mapRouteProperties, etc.\n  async function callDataStrategy(type, state, request, matchesToLoad, matches, fetcherKey) {\n    let results;\n    let dataResults = {};\n    try {\n      results = await callDataStrategyImpl(dataStrategyImpl, type, state, request, matchesToLoad, matches, fetcherKey, manifest, mapRouteProperties);\n    } catch (e) {\n      // If the outer dataStrategy method throws, just return the error for all\n      // matches - and it'll naturally bubble to the root\n      matchesToLoad.forEach(m => {\n        dataResults[m.route.id] = {\n          type: ResultType.error,\n          error: e\n        };\n      });\n      return dataResults;\n    }\n    for (let [routeId, result] of Object.entries(results)) {\n      if (isRedirectDataStrategyResultResult(result)) {\n        let response = result.result;\n        dataResults[routeId] = {\n          type: ResultType.redirect,\n          response: normalizeRelativeRoutingRedirectResponse(response, request, routeId, matches, basename, future.v7_relativeSplatPath)\n        };\n      } else {\n        dataResults[routeId] = await convertDataStrategyResultToDataResult(result);\n      }\n    }\n    return dataResults;\n  }\n  async function callLoadersAndMaybeResolveData(state, matches, matchesToLoad, fetchersToLoad, request) {\n    let currentMatches = state.matches;\n    // Kick off loaders and fetchers in parallel\n    let loaderResultsPromise = callDataStrategy(\"loader\", state, request, matchesToLoad, matches, null);\n    let fetcherResultsPromise = Promise.all(fetchersToLoad.map(async f => {\n      if (f.matches && f.match && f.controller) {\n        let results = await callDataStrategy(\"loader\", state, createClientSideRequest(init.history, f.path, f.controller.signal), [f.match], f.matches, f.key);\n        let result = results[f.match.route.id];\n        // Fetcher results are keyed by fetcher key from here on out, not routeId\n        return {\n          [f.key]: result\n        };\n      } else {\n        return Promise.resolve({\n          [f.key]: {\n            type: ResultType.error,\n            error: getInternalRouterError(404, {\n              pathname: f.path\n            })\n          }\n        });\n      }\n    }));\n    let loaderResults = await loaderResultsPromise;\n    let fetcherResults = (await fetcherResultsPromise).reduce((acc, r) => Object.assign(acc, r), {});\n    await Promise.all([resolveNavigationDeferredResults(matches, loaderResults, request.signal, currentMatches, state.loaderData), resolveFetcherDeferredResults(matches, fetcherResults, fetchersToLoad)]);\n    return {\n      loaderResults,\n      fetcherResults\n    };\n  }\n  function interruptActiveLoads() {\n    // Every interruption triggers a revalidation\n    isRevalidationRequired = true;\n    // Cancel pending route-level deferreds and mark cancelled routes for\n    // revalidation\n    cancelledDeferredRoutes.push(...cancelActiveDeferreds());\n    // Abort in-flight fetcher loads\n    fetchLoadMatches.forEach((_, key) => {\n      if (fetchControllers.has(key)) {\n        cancelledFetcherLoads.add(key);\n      }\n      abortFetcher(key);\n    });\n  }\n  function updateFetcherState(key, fetcher, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    state.fetchers.set(key, fetcher);\n    updateState({\n      fetchers: new Map(state.fetchers)\n    }, {\n      flushSync: (opts && opts.flushSync) === true\n    });\n  }\n  function setFetcherError(key, routeId, error, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    let boundaryMatch = findNearestBoundary(state.matches, routeId);\n    deleteFetcher(key);\n    updateState({\n      errors: {\n        [boundaryMatch.route.id]: error\n      },\n      fetchers: new Map(state.fetchers)\n    }, {\n      flushSync: (opts && opts.flushSync) === true\n    });\n  }\n  function getFetcher(key) {\n    activeFetchers.set(key, (activeFetchers.get(key) || 0) + 1);\n    // If this fetcher was previously marked for deletion, unmark it since we\n    // have a new instance\n    if (deletedFetchers.has(key)) {\n      deletedFetchers.delete(key);\n    }\n    return state.fetchers.get(key) || IDLE_FETCHER;\n  }\n  function deleteFetcher(key) {\n    let fetcher = state.fetchers.get(key);\n    // Don't abort the controller if this is a deletion of a fetcher.submit()\n    // in it's loading phase since - we don't want to abort the corresponding\n    // revalidation and want them to complete and land\n    if (fetchControllers.has(key) && !(fetcher && fetcher.state === \"loading\" && fetchReloadIds.has(key))) {\n      abortFetcher(key);\n    }\n    fetchLoadMatches.delete(key);\n    fetchReloadIds.delete(key);\n    fetchRedirectIds.delete(key);\n    // If we opted into the flag we can clear this now since we're calling\n    // deleteFetcher() at the end of updateState() and we've already handed the\n    // deleted fetcher keys off to the data layer.\n    // If not, we're eagerly calling deleteFetcher() and we need to keep this\n    // Set populated until the next updateState call, and we'll clear\n    // `deletedFetchers` then\n    if (future.v7_fetcherPersist) {\n      deletedFetchers.delete(key);\n    }\n    cancelledFetcherLoads.delete(key);\n    state.fetchers.delete(key);\n  }\n  function deleteFetcherAndUpdateState(key) {\n    let count = (activeFetchers.get(key) || 0) - 1;\n    if (count <= 0) {\n      activeFetchers.delete(key);\n      deletedFetchers.add(key);\n      if (!future.v7_fetcherPersist) {\n        deleteFetcher(key);\n      }\n    } else {\n      activeFetchers.set(key, count);\n    }\n    updateState({\n      fetchers: new Map(state.fetchers)\n    });\n  }\n  function abortFetcher(key) {\n    let controller = fetchControllers.get(key);\n    if (controller) {\n      controller.abort();\n      fetchControllers.delete(key);\n    }\n  }\n  function markFetchersDone(keys) {\n    for (let key of keys) {\n      let fetcher = getFetcher(key);\n      let doneFetcher = getDoneFetcher(fetcher.data);\n      state.fetchers.set(key, doneFetcher);\n    }\n  }\n  function markFetchRedirectsDone() {\n    let doneKeys = [];\n    let updatedFetchers = false;\n    for (let key of fetchRedirectIds) {\n      let fetcher = state.fetchers.get(key);\n      invariant(fetcher, \"Expected fetcher: \" + key);\n      if (fetcher.state === \"loading\") {\n        fetchRedirectIds.delete(key);\n        doneKeys.push(key);\n        updatedFetchers = true;\n      }\n    }\n    markFetchersDone(doneKeys);\n    return updatedFetchers;\n  }\n  function abortStaleFetchLoads(landedId) {\n    let yeetedKeys = [];\n    for (let [key, id] of fetchReloadIds) {\n      if (id < landedId) {\n        let fetcher = state.fetchers.get(key);\n        invariant(fetcher, \"Expected fetcher: \" + key);\n        if (fetcher.state === \"loading\") {\n          abortFetcher(key);\n          fetchReloadIds.delete(key);\n          yeetedKeys.push(key);\n        }\n      }\n    }\n    markFetchersDone(yeetedKeys);\n    return yeetedKeys.length > 0;\n  }\n  function getBlocker(key, fn) {\n    let blocker = state.blockers.get(key) || IDLE_BLOCKER;\n    if (blockerFunctions.get(key) !== fn) {\n      blockerFunctions.set(key, fn);\n    }\n    return blocker;\n  }\n  function deleteBlocker(key) {\n    state.blockers.delete(key);\n    blockerFunctions.delete(key);\n  }\n  // Utility function to update blockers, ensuring valid state transitions\n  function updateBlocker(key, newBlocker) {\n    let blocker = state.blockers.get(key) || IDLE_BLOCKER;\n    // Poor mans state machine :)\n    // https://mermaid.live/edit#pako:eNqVkc9OwzAMxl8l8nnjAYrEtDIOHEBIgwvKJTReGy3_lDpIqO27k6awMG0XcrLlnz87nwdonESogKXXBuE79rq75XZO3-yHds0RJVuv70YrPlUrCEe2HfrORS3rubqZfuhtpg5C9wk5tZ4VKcRUq88q9Z8RS0-48cE1iHJkL0ugbHuFLus9L6spZy8nX9MP2CNdomVaposqu3fGayT8T8-jJQwhepo_UtpgBQaDEUom04dZhAN1aJBDlUKJBxE1ceB2Smj0Mln-IBW5AFU2dwUiktt_2Qaq2dBfaKdEup85UV7Yd-dKjlnkabl2Pvr0DTkTreM\n    invariant(blocker.state === \"unblocked\" && newBlocker.state === \"blocked\" || blocker.state === \"blocked\" && newBlocker.state === \"blocked\" || blocker.state === \"blocked\" && newBlocker.state === \"proceeding\" || blocker.state === \"blocked\" && newBlocker.state === \"unblocked\" || blocker.state === \"proceeding\" && newBlocker.state === \"unblocked\", \"Invalid blocker state transition: \" + blocker.state + \" -> \" + newBlocker.state);\n    let blockers = new Map(state.blockers);\n    blockers.set(key, newBlocker);\n    updateState({\n      blockers\n    });\n  }\n  function shouldBlockNavigation(_ref2) {\n    let {\n      currentLocation,\n      nextLocation,\n      historyAction\n    } = _ref2;\n    if (blockerFunctions.size === 0) {\n      return;\n    }\n    // We ony support a single active blocker at the moment since we don't have\n    // any compelling use cases for multi-blocker yet\n    if (blockerFunctions.size > 1) {\n      warning(false, \"A router only supports one blocker at a time\");\n    }\n    let entries = Array.from(blockerFunctions.entries());\n    let [blockerKey, blockerFunction] = entries[entries.length - 1];\n    let blocker = state.blockers.get(blockerKey);\n    if (blocker && blocker.state === \"proceeding\") {\n      // If the blocker is currently proceeding, we don't need to re-check\n      // it and can let this navigation continue\n      return;\n    }\n    // At this point, we know we're unblocked/blocked so we need to check the\n    // user-provided blocker function\n    if (blockerFunction({\n      currentLocation,\n      nextLocation,\n      historyAction\n    })) {\n      return blockerKey;\n    }\n  }\n  function handleNavigational404(pathname) {\n    let error = getInternalRouterError(404, {\n      pathname\n    });\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let {\n      matches,\n      route\n    } = getShortCircuitMatches(routesToUse);\n    // Cancel all pending deferred on 404s since we don't keep any routes\n    cancelActiveDeferreds();\n    return {\n      notFoundMatches: matches,\n      route,\n      error\n    };\n  }\n  function cancelActiveDeferreds(predicate) {\n    let cancelledRouteIds = [];\n    activeDeferreds.forEach((dfd, routeId) => {\n      if (!predicate || predicate(routeId)) {\n        // Cancel the deferred - but do not remove from activeDeferreds here -\n        // we rely on the subscribers to do that so our tests can assert proper\n        // cleanup via _internalActiveDeferreds\n        dfd.cancel();\n        cancelledRouteIds.push(routeId);\n        activeDeferreds.delete(routeId);\n      }\n    });\n    return cancelledRouteIds;\n  }\n  // Opt in to capturing and reporting scroll positions during navigations,\n  // used by the <ScrollRestoration> component\n  function enableScrollRestoration(positions, getPosition, getKey) {\n    savedScrollPositions = positions;\n    getScrollPosition = getPosition;\n    getScrollRestorationKey = getKey || null;\n    // Perform initial hydration scroll restoration, since we miss the boat on\n    // the initial updateState() because we've not yet rendered <ScrollRestoration/>\n    // and therefore have no savedScrollPositions available\n    if (!initialScrollRestored && state.navigation === IDLE_NAVIGATION) {\n      initialScrollRestored = true;\n      let y = getSavedScrollPosition(state.location, state.matches);\n      if (y != null) {\n        updateState({\n          restoreScrollPosition: y\n        });\n      }\n    }\n    return () => {\n      savedScrollPositions = null;\n      getScrollPosition = null;\n      getScrollRestorationKey = null;\n    };\n  }\n  function getScrollKey(location, matches) {\n    if (getScrollRestorationKey) {\n      let key = getScrollRestorationKey(location, matches.map(m => convertRouteMatchToUiMatch(m, state.loaderData)));\n      return key || location.key;\n    }\n    return location.key;\n  }\n  function saveScrollPosition(location, matches) {\n    if (savedScrollPositions && getScrollPosition) {\n      let key = getScrollKey(location, matches);\n      savedScrollPositions[key] = getScrollPosition();\n    }\n  }\n  function getSavedScrollPosition(location, matches) {\n    if (savedScrollPositions) {\n      let key = getScrollKey(location, matches);\n      let y = savedScrollPositions[key];\n      if (typeof y === \"number\") {\n        return y;\n      }\n    }\n    return null;\n  }\n  function checkFogOfWar(matches, routesToUse, pathname) {\n    if (patchRoutesOnNavigationImpl) {\n      if (!matches) {\n        let fogMatches = matchRoutesImpl(routesToUse, pathname, basename, true);\n        return {\n          active: true,\n          matches: fogMatches || []\n        };\n      } else {\n        if (Object.keys(matches[0].params).length > 0) {\n          // If we matched a dynamic param or a splat, it might only be because\n          // we haven't yet discovered other routes that would match with a\n          // higher score.  Call patchRoutesOnNavigation just to be sure\n          let partialMatches = matchRoutesImpl(routesToUse, pathname, basename, true);\n          return {\n            active: true,\n            matches: partialMatches\n          };\n        }\n      }\n    }\n    return {\n      active: false,\n      matches: null\n    };\n  }\n  async function discoverRoutes(matches, pathname, signal, fetcherKey) {\n    if (!patchRoutesOnNavigationImpl) {\n      return {\n        type: \"success\",\n        matches\n      };\n    }\n    let partialMatches = matches;\n    while (true) {\n      let isNonHMR = inFlightDataRoutes == null;\n      let routesToUse = inFlightDataRoutes || dataRoutes;\n      let localManifest = manifest;\n      try {\n        await patchRoutesOnNavigationImpl({\n          signal,\n          path: pathname,\n          matches: partialMatches,\n          fetcherKey,\n          patch: (routeId, children) => {\n            if (signal.aborted) return;\n            patchRoutesImpl(routeId, children, routesToUse, localManifest, mapRouteProperties);\n          }\n        });\n      } catch (e) {\n        return {\n          type: \"error\",\n          error: e,\n          partialMatches\n        };\n      } finally {\n        // If we are not in the middle of an HMR revalidation and we changed the\n        // routes, provide a new identity so when we `updateState` at the end of\n        // this navigation/fetch `router.routes` will be a new identity and\n        // trigger a re-run of memoized `router.routes` dependencies.\n        // HMR will already update the identity and reflow when it lands\n        // `inFlightDataRoutes` in `completeNavigation`\n        if (isNonHMR && !signal.aborted) {\n          dataRoutes = [...dataRoutes];\n        }\n      }\n      if (signal.aborted) {\n        return {\n          type: \"aborted\"\n        };\n      }\n      let newMatches = matchRoutes(routesToUse, pathname, basename);\n      if (newMatches) {\n        return {\n          type: \"success\",\n          matches: newMatches\n        };\n      }\n      let newPartialMatches = matchRoutesImpl(routesToUse, pathname, basename, true);\n      // Avoid loops if the second pass results in the same partial matches\n      if (!newPartialMatches || partialMatches.length === newPartialMatches.length && partialMatches.every((m, i) => m.route.id === newPartialMatches[i].route.id)) {\n        return {\n          type: \"success\",\n          matches: null\n        };\n      }\n      partialMatches = newPartialMatches;\n    }\n  }\n  function _internalSetRoutes(newRoutes) {\n    manifest = {};\n    inFlightDataRoutes = convertRoutesToDataRoutes(newRoutes, mapRouteProperties, undefined, manifest);\n  }\n  function patchRoutes(routeId, children) {\n    let isNonHMR = inFlightDataRoutes == null;\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    patchRoutesImpl(routeId, children, routesToUse, manifest, mapRouteProperties);\n    // If we are not in the middle of an HMR revalidation and we changed the\n    // routes, provide a new identity and trigger a reflow via `updateState`\n    // to re-run memoized `router.routes` dependencies.\n    // HMR will already update the identity and reflow when it lands\n    // `inFlightDataRoutes` in `completeNavigation`\n    if (isNonHMR) {\n      dataRoutes = [...dataRoutes];\n      updateState({});\n    }\n  }\n  router = {\n    get basename() {\n      return basename;\n    },\n    get future() {\n      return future;\n    },\n    get state() {\n      return state;\n    },\n    get routes() {\n      return dataRoutes;\n    },\n    get window() {\n      return routerWindow;\n    },\n    initialize,\n    subscribe,\n    enableScrollRestoration,\n    navigate,\n    fetch,\n    revalidate,\n    // Passthrough to history-aware createHref used by useHref so we get proper\n    // hash-aware URLs in DOM paths\n    createHref: to => init.history.createHref(to),\n    encodeLocation: to => init.history.encodeLocation(to),\n    getFetcher,\n    deleteFetcher: deleteFetcherAndUpdateState,\n    dispose,\n    getBlocker,\n    deleteBlocker,\n    patchRoutes,\n    _internalFetchControllers: fetchControllers,\n    _internalActiveDeferreds: activeDeferreds,\n    // TODO: Remove setRoutes, it's temporary to avoid dealing with\n    // updating the tree while validating the update algorithm.\n    _internalSetRoutes\n  };\n  return router;\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region createStaticHandler\n////////////////////////////////////////////////////////////////////////////////\nconst UNSAFE_DEFERRED_SYMBOL = Symbol(\"deferred\");\nfunction createStaticHandler(routes, opts) {\n  invariant(routes.length > 0, \"You must provide a non-empty routes array to createStaticHandler\");\n  let manifest = {};\n  let basename = (opts ? opts.basename : null) || \"/\";\n  let mapRouteProperties;\n  if (opts != null && opts.mapRouteProperties) {\n    mapRouteProperties = opts.mapRouteProperties;\n  } else if (opts != null && opts.detectErrorBoundary) {\n    // If they are still using the deprecated version, wrap it with the new API\n    let detectErrorBoundary = opts.detectErrorBoundary;\n    mapRouteProperties = route => ({\n      hasErrorBoundary: detectErrorBoundary(route)\n    });\n  } else {\n    mapRouteProperties = defaultMapRouteProperties;\n  }\n  // Config driven behavior flags\n  let future = _extends({\n    v7_relativeSplatPath: false,\n    v7_throwAbortReason: false\n  }, opts ? opts.future : null);\n  let dataRoutes = convertRoutesToDataRoutes(routes, mapRouteProperties, undefined, manifest);\n  /**\n   * The query() method is intended for document requests, in which we want to\n   * call an optional action and potentially multiple loaders for all nested\n   * routes.  It returns a StaticHandlerContext object, which is very similar\n   * to the router state (location, loaderData, actionData, errors, etc.) and\n   * also adds SSR-specific information such as the statusCode and headers\n   * from action/loaders Responses.\n   *\n   * It _should_ never throw and should report all errors through the\n   * returned context.errors object, properly associating errors to their error\n   * boundary.  Additionally, it tracks _deepestRenderedBoundaryId which can be\n   * used to emulate React error boundaries during SSr by performing a second\n   * pass only down to the boundaryId.\n   *\n   * The one exception where we do not return a StaticHandlerContext is when a\n   * redirect response is returned or thrown from any action/loader.  We\n   * propagate that out and return the raw Response so the HTTP server can\n   * return it directly.\n   *\n   * - `opts.requestContext` is an optional server context that will be passed\n   *   to actions/loaders in the `context` parameter\n   * - `opts.skipLoaderErrorBubbling` is an optional parameter that will prevent\n   *   the bubbling of errors which allows single-fetch-type implementations\n   *   where the client will handle the bubbling and we may need to return data\n   *   for the handling route\n   */\n  async function query(request, _temp3) {\n    let {\n      requestContext,\n      skipLoaderErrorBubbling,\n      dataStrategy\n    } = _temp3 === void 0 ? {} : _temp3;\n    let url = new URL(request.url);\n    let method = request.method;\n    let location = createLocation(\"\", createPath(url), null, \"default\");\n    let matches = matchRoutes(dataRoutes, location, basename);\n    // SSR supports HEAD requests while SPA doesn't\n    if (!isValidMethod(method) && method !== \"HEAD\") {\n      let error = getInternalRouterError(405, {\n        method\n      });\n      let {\n        matches: methodNotAllowedMatches,\n        route\n      } = getShortCircuitMatches(dataRoutes);\n      return {\n        basename,\n        location,\n        matches: methodNotAllowedMatches,\n        loaderData: {},\n        actionData: null,\n        errors: {\n          [route.id]: error\n        },\n        statusCode: error.status,\n        loaderHeaders: {},\n        actionHeaders: {},\n        activeDeferreds: null\n      };\n    } else if (!matches) {\n      let error = getInternalRouterError(404, {\n        pathname: location.pathname\n      });\n      let {\n        matches: notFoundMatches,\n        route\n      } = getShortCircuitMatches(dataRoutes);\n      return {\n        basename,\n        location,\n        matches: notFoundMatches,\n        loaderData: {},\n        actionData: null,\n        errors: {\n          [route.id]: error\n        },\n        statusCode: error.status,\n        loaderHeaders: {},\n        actionHeaders: {},\n        activeDeferreds: null\n      };\n    }\n    let result = await queryImpl(request, location, matches, requestContext, dataStrategy || null, skipLoaderErrorBubbling === true, null);\n    if (isResponse(result)) {\n      return result;\n    }\n    // When returning StaticHandlerContext, we patch back in the location here\n    // since we need it for React Context.  But this helps keep our submit and\n    // loadRouteData operating on a Request instead of a Location\n    return _extends({\n      location,\n      basename\n    }, result);\n  }\n  /**\n   * The queryRoute() method is intended for targeted route requests, either\n   * for fetch ?_data requests or resource route requests.  In this case, we\n   * are only ever calling a single action or loader, and we are returning the\n   * returned value directly.  In most cases, this will be a Response returned\n   * from the action/loader, but it may be a primitive or other value as well -\n   * and in such cases the calling context should handle that accordingly.\n   *\n   * We do respect the throw/return differentiation, so if an action/loader\n   * throws, then this method will throw the value.  This is important so we\n   * can do proper boundary identification in Remix where a thrown Response\n   * must go to the Catch Boundary but a returned Response is happy-path.\n   *\n   * One thing to note is that any Router-initiated Errors that make sense\n   * to associate with a status code will be thrown as an ErrorResponse\n   * instance which include the raw Error, such that the calling context can\n   * serialize the error as they see fit while including the proper response\n   * code.  Examples here are 404 and 405 errors that occur prior to reaching\n   * any user-defined loaders.\n   *\n   * - `opts.routeId` allows you to specify the specific route handler to call.\n   *   If not provided the handler will determine the proper route by matching\n   *   against `request.url`\n   * - `opts.requestContext` is an optional server context that will be passed\n   *    to actions/loaders in the `context` parameter\n   */\n  async function queryRoute(request, _temp4) {\n    let {\n      routeId,\n      requestContext,\n      dataStrategy\n    } = _temp4 === void 0 ? {} : _temp4;\n    let url = new URL(request.url);\n    let method = request.method;\n    let location = createLocation(\"\", createPath(url), null, \"default\");\n    let matches = matchRoutes(dataRoutes, location, basename);\n    // SSR supports HEAD requests while SPA doesn't\n    if (!isValidMethod(method) && method !== \"HEAD\" && method !== \"OPTIONS\") {\n      throw getInternalRouterError(405, {\n        method\n      });\n    } else if (!matches) {\n      throw getInternalRouterError(404, {\n        pathname: location.pathname\n      });\n    }\n    let match = routeId ? matches.find(m => m.route.id === routeId) : getTargetMatch(matches, location);\n    if (routeId && !match) {\n      throw getInternalRouterError(403, {\n        pathname: location.pathname,\n        routeId\n      });\n    } else if (!match) {\n      // This should never hit I don't think?\n      throw getInternalRouterError(404, {\n        pathname: location.pathname\n      });\n    }\n    let result = await queryImpl(request, location, matches, requestContext, dataStrategy || null, false, match);\n    if (isResponse(result)) {\n      return result;\n    }\n    let error = result.errors ? Object.values(result.errors)[0] : undefined;\n    if (error !== undefined) {\n      // If we got back result.errors, that means the loader/action threw\n      // _something_ that wasn't a Response, but it's not guaranteed/required\n      // to be an `instanceof Error` either, so we have to use throw here to\n      // preserve the \"error\" state outside of queryImpl.\n      throw error;\n    }\n    // Pick off the right state value to return\n    if (result.actionData) {\n      return Object.values(result.actionData)[0];\n    }\n    if (result.loaderData) {\n      var _result$activeDeferre;\n      let data = Object.values(result.loaderData)[0];\n      if ((_result$activeDeferre = result.activeDeferreds) != null && _result$activeDeferre[match.route.id]) {\n        data[UNSAFE_DEFERRED_SYMBOL] = result.activeDeferreds[match.route.id];\n      }\n      return data;\n    }\n    return undefined;\n  }\n  async function queryImpl(request, location, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch) {\n    invariant(request.signal, \"query()/queryRoute() requests must contain an AbortController signal\");\n    try {\n      if (isMutationMethod(request.method.toLowerCase())) {\n        let result = await submit(request, matches, routeMatch || getTargetMatch(matches, location), requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch != null);\n        return result;\n      }\n      let result = await loadRouteData(request, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch);\n      return isResponse(result) ? result : _extends({}, result, {\n        actionData: null,\n        actionHeaders: {}\n      });\n    } catch (e) {\n      // If the user threw/returned a Response in callLoaderOrAction for a\n      // `queryRoute` call, we throw the `DataStrategyResult` to bail out early\n      // and then return or throw the raw Response here accordingly\n      if (isDataStrategyResult(e) && isResponse(e.result)) {\n        if (e.type === ResultType.error) {\n          throw e.result;\n        }\n        return e.result;\n      }\n      // Redirects are always returned since they don't propagate to catch\n      // boundaries\n      if (isRedirectResponse(e)) {\n        return e;\n      }\n      throw e;\n    }\n  }\n  async function submit(request, matches, actionMatch, requestContext, dataStrategy, skipLoaderErrorBubbling, isRouteRequest) {\n    let result;\n    if (!actionMatch.route.action && !actionMatch.route.lazy) {\n      let error = getInternalRouterError(405, {\n        method: request.method,\n        pathname: new URL(request.url).pathname,\n        routeId: actionMatch.route.id\n      });\n      if (isRouteRequest) {\n        throw error;\n      }\n      result = {\n        type: ResultType.error,\n        error\n      };\n    } else {\n      let results = await callDataStrategy(\"action\", request, [actionMatch], matches, isRouteRequest, requestContext, dataStrategy);\n      result = results[actionMatch.route.id];\n      if (request.signal.aborted) {\n        throwStaticHandlerAbortedError(request, isRouteRequest, future);\n      }\n    }\n    if (isRedirectResult(result)) {\n      // Uhhhh - this should never happen, we should always throw these from\n      // callLoaderOrAction, but the type narrowing here keeps TS happy and we\n      // can get back on the \"throw all redirect responses\" train here should\n      // this ever happen :/\n      throw new Response(null, {\n        status: result.response.status,\n        headers: {\n          Location: result.response.headers.get(\"Location\")\n        }\n      });\n    }\n    if (isDeferredResult(result)) {\n      let error = getInternalRouterError(400, {\n        type: \"defer-action\"\n      });\n      if (isRouteRequest) {\n        throw error;\n      }\n      result = {\n        type: ResultType.error,\n        error\n      };\n    }\n    if (isRouteRequest) {\n      // Note: This should only be non-Response values if we get here, since\n      // isRouteRequest should throw any Response received in callLoaderOrAction\n      if (isErrorResult(result)) {\n        throw result.error;\n      }\n      return {\n        matches: [actionMatch],\n        loaderData: {},\n        actionData: {\n          [actionMatch.route.id]: result.data\n        },\n        errors: null,\n        // Note: statusCode + headers are unused here since queryRoute will\n        // return the raw Response or value\n        statusCode: 200,\n        loaderHeaders: {},\n        actionHeaders: {},\n        activeDeferreds: null\n      };\n    }\n    // Create a GET request for the loaders\n    let loaderRequest = new Request(request.url, {\n      headers: request.headers,\n      redirect: request.redirect,\n      signal: request.signal\n    });\n    if (isErrorResult(result)) {\n      // Store off the pending error - we use it to determine which loaders\n      // to call and will commit it when we complete the navigation\n      let boundaryMatch = skipLoaderErrorBubbling ? actionMatch : findNearestBoundary(matches, actionMatch.route.id);\n      let context = await loadRouteData(loaderRequest, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, null, [boundaryMatch.route.id, result]);\n      // action status codes take precedence over loader status codes\n      return _extends({}, context, {\n        statusCode: isRouteErrorResponse(result.error) ? result.error.status : result.statusCode != null ? result.statusCode : 500,\n        actionData: null,\n        actionHeaders: _extends({}, result.headers ? {\n          [actionMatch.route.id]: result.headers\n        } : {})\n      });\n    }\n    let context = await loadRouteData(loaderRequest, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, null);\n    return _extends({}, context, {\n      actionData: {\n        [actionMatch.route.id]: result.data\n      }\n    }, result.statusCode ? {\n      statusCode: result.statusCode\n    } : {}, {\n      actionHeaders: result.headers ? {\n        [actionMatch.route.id]: result.headers\n      } : {}\n    });\n  }\n  async function loadRouteData(request, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch, pendingActionResult) {\n    let isRouteRequest = routeMatch != null;\n    // Short circuit if we have no loaders to run (queryRoute())\n    if (isRouteRequest && !(routeMatch != null && routeMatch.route.loader) && !(routeMatch != null && routeMatch.route.lazy)) {\n      throw getInternalRouterError(400, {\n        method: request.method,\n        pathname: new URL(request.url).pathname,\n        routeId: routeMatch == null ? void 0 : routeMatch.route.id\n      });\n    }\n    let requestMatches = routeMatch ? [routeMatch] : pendingActionResult && isErrorResult(pendingActionResult[1]) ? getLoaderMatchesUntilBoundary(matches, pendingActionResult[0]) : matches;\n    let matchesToLoad = requestMatches.filter(m => m.route.loader || m.route.lazy);\n    // Short circuit if we have no loaders to run (query())\n    if (matchesToLoad.length === 0) {\n      return {\n        matches,\n        // Add a null for all matched routes for proper revalidation on the client\n        loaderData: matches.reduce((acc, m) => Object.assign(acc, {\n          [m.route.id]: null\n        }), {}),\n        errors: pendingActionResult && isErrorResult(pendingActionResult[1]) ? {\n          [pendingActionResult[0]]: pendingActionResult[1].error\n        } : null,\n        statusCode: 200,\n        loaderHeaders: {},\n        activeDeferreds: null\n      };\n    }\n    let results = await callDataStrategy(\"loader\", request, matchesToLoad, matches, isRouteRequest, requestContext, dataStrategy);\n    if (request.signal.aborted) {\n      throwStaticHandlerAbortedError(request, isRouteRequest, future);\n    }\n    // Process and commit output from loaders\n    let activeDeferreds = new Map();\n    let context = processRouteLoaderData(matches, results, pendingActionResult, activeDeferreds, skipLoaderErrorBubbling);\n    // Add a null for any non-loader matches for proper revalidation on the client\n    let executedLoaders = new Set(matchesToLoad.map(match => match.route.id));\n    matches.forEach(match => {\n      if (!executedLoaders.has(match.route.id)) {\n        context.loaderData[match.route.id] = null;\n      }\n    });\n    return _extends({}, context, {\n      matches,\n      activeDeferreds: activeDeferreds.size > 0 ? Object.fromEntries(activeDeferreds.entries()) : null\n    });\n  }\n  // Utility wrapper for calling dataStrategy server-side without having to\n  // pass around the manifest, mapRouteProperties, etc.\n  async function callDataStrategy(type, request, matchesToLoad, matches, isRouteRequest, requestContext, dataStrategy) {\n    let results = await callDataStrategyImpl(dataStrategy || defaultDataStrategy, type, null, request, matchesToLoad, matches, null, manifest, mapRouteProperties, requestContext);\n    let dataResults = {};\n    await Promise.all(matches.map(async match => {\n      if (!(match.route.id in results)) {\n        return;\n      }\n      let result = results[match.route.id];\n      if (isRedirectDataStrategyResultResult(result)) {\n        let response = result.result;\n        // Throw redirects and let the server handle them with an HTTP redirect\n        throw normalizeRelativeRoutingRedirectResponse(response, request, match.route.id, matches, basename, future.v7_relativeSplatPath);\n      }\n      if (isResponse(result.result) && isRouteRequest) {\n        // For SSR single-route requests, we want to hand Responses back\n        // directly without unwrapping\n        throw result;\n      }\n      dataResults[match.route.id] = await convertDataStrategyResultToDataResult(result);\n    }));\n    return dataResults;\n  }\n  return {\n    dataRoutes,\n    query,\n    queryRoute\n  };\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Helpers\n////////////////////////////////////////////////////////////////////////////////\n/**\n * Given an existing StaticHandlerContext and an error thrown at render time,\n * provide an updated StaticHandlerContext suitable for a second SSR render\n */\nfunction getStaticContextFromError(routes, context, error) {\n  let newContext = _extends({}, context, {\n    statusCode: isRouteErrorResponse(error) ? error.status : 500,\n    errors: {\n      [context._deepestRenderedBoundaryId || routes[0].id]: error\n    }\n  });\n  return newContext;\n}\nfunction throwStaticHandlerAbortedError(request, isRouteRequest, future) {\n  if (future.v7_throwAbortReason && request.signal.reason !== undefined) {\n    throw request.signal.reason;\n  }\n  let method = isRouteRequest ? \"queryRoute\" : \"query\";\n  throw new Error(method + \"() call aborted: \" + request.method + \" \" + request.url);\n}\nfunction isSubmissionNavigation(opts) {\n  return opts != null && (\"formData\" in opts && opts.formData != null || \"body\" in opts && opts.body !== undefined);\n}\nfunction normalizeTo(location, matches, basename, prependBasename, to, v7_relativeSplatPath, fromRouteId, relative) {\n  let contextualMatches;\n  let activeRouteMatch;\n  if (fromRouteId) {\n    // Grab matches up to the calling route so our route-relative logic is\n    // relative to the correct source route\n    contextualMatches = [];\n    for (let match of matches) {\n      contextualMatches.push(match);\n      if (match.route.id === fromRouteId) {\n        activeRouteMatch = match;\n        break;\n      }\n    }\n  } else {\n    contextualMatches = matches;\n    activeRouteMatch = matches[matches.length - 1];\n  }\n  // Resolve the relative path\n  let path = resolveTo(to ? to : \".\", getResolveToMatches(contextualMatches, v7_relativeSplatPath), stripBasename(location.pathname, basename) || location.pathname, relative === \"path\");\n  // When `to` is not specified we inherit search/hash from the current\n  // location, unlike when to=\".\" and we just inherit the path.\n  // See https://github.com/remix-run/remix/issues/927\n  if (to == null) {\n    path.search = location.search;\n    path.hash = location.hash;\n  }\n  // Account for `?index` params when routing to the current location\n  if ((to == null || to === \"\" || to === \".\") && activeRouteMatch) {\n    let nakedIndex = hasNakedIndexQuery(path.search);\n    if (activeRouteMatch.route.index && !nakedIndex) {\n      // Add one when we're targeting an index route\n      path.search = path.search ? path.search.replace(/^\\?/, \"?index&\") : \"?index\";\n    } else if (!activeRouteMatch.route.index && nakedIndex) {\n      // Remove existing ones when we're not\n      let params = new URLSearchParams(path.search);\n      let indexValues = params.getAll(\"index\");\n      params.delete(\"index\");\n      indexValues.filter(v => v).forEach(v => params.append(\"index\", v));\n      let qs = params.toString();\n      path.search = qs ? \"?\" + qs : \"\";\n    }\n  }\n  // If we're operating within a basename, prepend it to the pathname.  If\n  // this is a root navigation, then just use the raw basename which allows\n  // the basename to have full control over the presence of a trailing slash\n  // on root actions\n  if (prependBasename && basename !== \"/\") {\n    path.pathname = path.pathname === \"/\" ? basename : joinPaths([basename, path.pathname]);\n  }\n  return createPath(path);\n}\n// Normalize navigation options by converting formMethod=GET formData objects to\n// URLSearchParams so they behave identically to links with query params\nfunction normalizeNavigateOptions(normalizeFormMethod, isFetcher, path, opts) {\n  // Return location verbatim on non-submission navigations\n  if (!opts || !isSubmissionNavigation(opts)) {\n    return {\n      path\n    };\n  }\n  if (opts.formMethod && !isValidMethod(opts.formMethod)) {\n    return {\n      path,\n      error: getInternalRouterError(405, {\n        method: opts.formMethod\n      })\n    };\n  }\n  let getInvalidBodyError = () => ({\n    path,\n    error: getInternalRouterError(400, {\n      type: \"invalid-body\"\n    })\n  });\n  // Create a Submission on non-GET navigations\n  let rawFormMethod = opts.formMethod || \"get\";\n  let formMethod = normalizeFormMethod ? rawFormMethod.toUpperCase() : rawFormMethod.toLowerCase();\n  let formAction = stripHashFromPath(path);\n  if (opts.body !== undefined) {\n    if (opts.formEncType === \"text/plain\") {\n      // text only support POST/PUT/PATCH/DELETE submissions\n      if (!isMutationMethod(formMethod)) {\n        return getInvalidBodyError();\n      }\n      let text = typeof opts.body === \"string\" ? opts.body : opts.body instanceof FormData || opts.body instanceof URLSearchParams ?\n      // https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#plain-text-form-data\n      Array.from(opts.body.entries()).reduce((acc, _ref3) => {\n        let [name, value] = _ref3;\n        return \"\" + acc + name + \"=\" + value + \"\\n\";\n      }, \"\") : String(opts.body);\n      return {\n        path,\n        submission: {\n          formMethod,\n          formAction,\n          formEncType: opts.formEncType,\n          formData: undefined,\n          json: undefined,\n          text\n        }\n      };\n    } else if (opts.formEncType === \"application/json\") {\n      // json only supports POST/PUT/PATCH/DELETE submissions\n      if (!isMutationMethod(formMethod)) {\n        return getInvalidBodyError();\n      }\n      try {\n        let json = typeof opts.body === \"string\" ? JSON.parse(opts.body) : opts.body;\n        return {\n          path,\n          submission: {\n            formMethod,\n            formAction,\n            formEncType: opts.formEncType,\n            formData: undefined,\n            json,\n            text: undefined\n          }\n        };\n      } catch (e) {\n        return getInvalidBodyError();\n      }\n    }\n  }\n  invariant(typeof FormData === \"function\", \"FormData is not available in this environment\");\n  let searchParams;\n  let formData;\n  if (opts.formData) {\n    searchParams = convertFormDataToSearchParams(opts.formData);\n    formData = opts.formData;\n  } else if (opts.body instanceof FormData) {\n    searchParams = convertFormDataToSearchParams(opts.body);\n    formData = opts.body;\n  } else if (opts.body instanceof URLSearchParams) {\n    searchParams = opts.body;\n    formData = convertSearchParamsToFormData(searchParams);\n  } else if (opts.body == null) {\n    searchParams = new URLSearchParams();\n    formData = new FormData();\n  } else {\n    try {\n      searchParams = new URLSearchParams(opts.body);\n      formData = convertSearchParamsToFormData(searchParams);\n    } catch (e) {\n      return getInvalidBodyError();\n    }\n  }\n  let submission = {\n    formMethod,\n    formAction,\n    formEncType: opts && opts.formEncType || \"application/x-www-form-urlencoded\",\n    formData,\n    json: undefined,\n    text: undefined\n  };\n  if (isMutationMethod(submission.formMethod)) {\n    return {\n      path,\n      submission\n    };\n  }\n  // Flatten submission onto URLSearchParams for GET submissions\n  let parsedPath = parsePath(path);\n  // On GET navigation submissions we can drop the ?index param from the\n  // resulting location since all loaders will run.  But fetcher GET submissions\n  // only run a single loader so we need to preserve any incoming ?index params\n  if (isFetcher && parsedPath.search && hasNakedIndexQuery(parsedPath.search)) {\n    searchParams.append(\"index\", \"\");\n  }\n  parsedPath.search = \"?\" + searchParams;\n  return {\n    path: createPath(parsedPath),\n    submission\n  };\n}\n// Filter out all routes at/below any caught error as they aren't going to\n// render so we don't need to load them\nfunction getLoaderMatchesUntilBoundary(matches, boundaryId, includeBoundary) {\n  if (includeBoundary === void 0) {\n    includeBoundary = false;\n  }\n  let index = matches.findIndex(m => m.route.id === boundaryId);\n  if (index >= 0) {\n    return matches.slice(0, includeBoundary ? index + 1 : index);\n  }\n  return matches;\n}\nfunction getMatchesToLoad(history, state, matches, submission, location, initialHydration, skipActionErrorRevalidation, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, deletedFetchers, fetchLoadMatches, fetchRedirectIds, routesToUse, basename, pendingActionResult) {\n  let actionResult = pendingActionResult ? isErrorResult(pendingActionResult[1]) ? pendingActionResult[1].error : pendingActionResult[1].data : undefined;\n  let currentUrl = history.createURL(state.location);\n  let nextUrl = history.createURL(location);\n  // Pick navigation matches that are net-new or qualify for revalidation\n  let boundaryMatches = matches;\n  if (initialHydration && state.errors) {\n    // On initial hydration, only consider matches up to _and including_ the boundary.\n    // This is inclusive to handle cases where a server loader ran successfully,\n    // a child server loader bubbled up to this route, but this route has\n    // `clientLoader.hydrate` so we want to still run the `clientLoader` so that\n    // we have a complete version of `loaderData`\n    boundaryMatches = getLoaderMatchesUntilBoundary(matches, Object.keys(state.errors)[0], true);\n  } else if (pendingActionResult && isErrorResult(pendingActionResult[1])) {\n    // If an action threw an error, we call loaders up to, but not including the\n    // boundary\n    boundaryMatches = getLoaderMatchesUntilBoundary(matches, pendingActionResult[0]);\n  }\n  // Don't revalidate loaders by default after action 4xx/5xx responses\n  // when the flag is enabled.  They can still opt-into revalidation via\n  // `shouldRevalidate` via `actionResult`\n  let actionStatus = pendingActionResult ? pendingActionResult[1].statusCode : undefined;\n  let shouldSkipRevalidation = skipActionErrorRevalidation && actionStatus && actionStatus >= 400;\n  let navigationMatches = boundaryMatches.filter((match, index) => {\n    let {\n      route\n    } = match;\n    if (route.lazy) {\n      // We haven't loaded this route yet so we don't know if it's got a loader!\n      return true;\n    }\n    if (route.loader == null) {\n      return false;\n    }\n    if (initialHydration) {\n      return shouldLoadRouteOnHydration(route, state.loaderData, state.errors);\n    }\n    // Always call the loader on new route instances and pending defer cancellations\n    if (isNewLoader(state.loaderData, state.matches[index], match) || cancelledDeferredRoutes.some(id => id === match.route.id)) {\n      return true;\n    }\n    // This is the default implementation for when we revalidate.  If the route\n    // provides it's own implementation, then we give them full control but\n    // provide this value so they can leverage it if needed after they check\n    // their own specific use cases\n    let currentRouteMatch = state.matches[index];\n    let nextRouteMatch = match;\n    return shouldRevalidateLoader(match, _extends({\n      currentUrl,\n      currentParams: currentRouteMatch.params,\n      nextUrl,\n      nextParams: nextRouteMatch.params\n    }, submission, {\n      actionResult,\n      actionStatus,\n      defaultShouldRevalidate: shouldSkipRevalidation ? false :\n      // Forced revalidation due to submission, useRevalidator, or X-Remix-Revalidate\n      isRevalidationRequired || currentUrl.pathname + currentUrl.search === nextUrl.pathname + nextUrl.search ||\n      // Search params affect all loaders\n      currentUrl.search !== nextUrl.search || isNewRouteInstance(currentRouteMatch, nextRouteMatch)\n    }));\n  });\n  // Pick fetcher.loads that need to be revalidated\n  let revalidatingFetchers = [];\n  fetchLoadMatches.forEach((f, key) => {\n    // Don't revalidate:\n    //  - on initial hydration (shouldn't be any fetchers then anyway)\n    //  - if fetcher won't be present in the subsequent render\n    //    - no longer matches the URL (v7_fetcherPersist=false)\n    //    - was unmounted but persisted due to v7_fetcherPersist=true\n    if (initialHydration || !matches.some(m => m.route.id === f.routeId) || deletedFetchers.has(key)) {\n      return;\n    }\n    let fetcherMatches = matchRoutes(routesToUse, f.path, basename);\n    // If the fetcher path no longer matches, push it in with null matches so\n    // we can trigger a 404 in callLoadersAndMaybeResolveData.  Note this is\n    // currently only a use-case for Remix HMR where the route tree can change\n    // at runtime and remove a route previously loaded via a fetcher\n    if (!fetcherMatches) {\n      revalidatingFetchers.push({\n        key,\n        routeId: f.routeId,\n        path: f.path,\n        matches: null,\n        match: null,\n        controller: null\n      });\n      return;\n    }\n    // Revalidating fetchers are decoupled from the route matches since they\n    // load from a static href.  They revalidate based on explicit revalidation\n    // (submission, useRevalidator, or X-Remix-Revalidate)\n    let fetcher = state.fetchers.get(key);\n    let fetcherMatch = getTargetMatch(fetcherMatches, f.path);\n    let shouldRevalidate = false;\n    if (fetchRedirectIds.has(key)) {\n      // Never trigger a revalidation of an actively redirecting fetcher\n      shouldRevalidate = false;\n    } else if (cancelledFetcherLoads.has(key)) {\n      // Always mark for revalidation if the fetcher was cancelled\n      cancelledFetcherLoads.delete(key);\n      shouldRevalidate = true;\n    } else if (fetcher && fetcher.state !== \"idle\" && fetcher.data === undefined) {\n      // If the fetcher hasn't ever completed loading yet, then this isn't a\n      // revalidation, it would just be a brand new load if an explicit\n      // revalidation is required\n      shouldRevalidate = isRevalidationRequired;\n    } else {\n      // Otherwise fall back on any user-defined shouldRevalidate, defaulting\n      // to explicit revalidations only\n      shouldRevalidate = shouldRevalidateLoader(fetcherMatch, _extends({\n        currentUrl,\n        currentParams: state.matches[state.matches.length - 1].params,\n        nextUrl,\n        nextParams: matches[matches.length - 1].params\n      }, submission, {\n        actionResult,\n        actionStatus,\n        defaultShouldRevalidate: shouldSkipRevalidation ? false : isRevalidationRequired\n      }));\n    }\n    if (shouldRevalidate) {\n      revalidatingFetchers.push({\n        key,\n        routeId: f.routeId,\n        path: f.path,\n        matches: fetcherMatches,\n        match: fetcherMatch,\n        controller: new AbortController()\n      });\n    }\n  });\n  return [navigationMatches, revalidatingFetchers];\n}\nfunction shouldLoadRouteOnHydration(route, loaderData, errors) {\n  // We dunno if we have a loader - gotta find out!\n  if (route.lazy) {\n    return true;\n  }\n  // No loader, nothing to initialize\n  if (!route.loader) {\n    return false;\n  }\n  let hasData = loaderData != null && loaderData[route.id] !== undefined;\n  let hasError = errors != null && errors[route.id] !== undefined;\n  // Don't run if we error'd during SSR\n  if (!hasData && hasError) {\n    return false;\n  }\n  // Explicitly opting-in to running on hydration\n  if (typeof route.loader === \"function\" && route.loader.hydrate === true) {\n    return true;\n  }\n  // Otherwise, run if we're not yet initialized with anything\n  return !hasData && !hasError;\n}\nfunction isNewLoader(currentLoaderData, currentMatch, match) {\n  let isNew =\n  // [a] -> [a, b]\n  !currentMatch ||\n  // [a, b] -> [a, c]\n  match.route.id !== currentMatch.route.id;\n  // Handle the case that we don't have data for a re-used route, potentially\n  // from a prior error or from a cancelled pending deferred\n  let isMissingData = currentLoaderData[match.route.id] === undefined;\n  // Always load if this is a net-new route or we don't yet have data\n  return isNew || isMissingData;\n}\nfunction isNewRouteInstance(currentMatch, match) {\n  let currentPath = currentMatch.route.path;\n  return (\n    // param change for this match, /users/123 -> /users/456\n    currentMatch.pathname !== match.pathname ||\n    // splat param changed, which is not present in match.path\n    // e.g. /files/images/avatar.jpg -> files/finances.xls\n    currentPath != null && currentPath.endsWith(\"*\") && currentMatch.params[\"*\"] !== match.params[\"*\"]\n  );\n}\nfunction shouldRevalidateLoader(loaderMatch, arg) {\n  if (loaderMatch.route.shouldRevalidate) {\n    let routeChoice = loaderMatch.route.shouldRevalidate(arg);\n    if (typeof routeChoice === \"boolean\") {\n      return routeChoice;\n    }\n  }\n  return arg.defaultShouldRevalidate;\n}\nfunction patchRoutesImpl(routeId, children, routesToUse, manifest, mapRouteProperties) {\n  var _childrenToPatch;\n  let childrenToPatch;\n  if (routeId) {\n    let route = manifest[routeId];\n    invariant(route, \"No route found to patch children into: routeId = \" + routeId);\n    if (!route.children) {\n      route.children = [];\n    }\n    childrenToPatch = route.children;\n  } else {\n    childrenToPatch = routesToUse;\n  }\n  // Don't patch in routes we already know about so that `patch` is idempotent\n  // to simplify user-land code. This is useful because we re-call the\n  // `patchRoutesOnNavigation` function for matched routes with params.\n  let uniqueChildren = children.filter(newRoute => !childrenToPatch.some(existingRoute => isSameRoute(newRoute, existingRoute)));\n  let newRoutes = convertRoutesToDataRoutes(uniqueChildren, mapRouteProperties, [routeId || \"_\", \"patch\", String(((_childrenToPatch = childrenToPatch) == null ? void 0 : _childrenToPatch.length) || \"0\")], manifest);\n  childrenToPatch.push(...newRoutes);\n}\nfunction isSameRoute(newRoute, existingRoute) {\n  // Most optimal check is by id\n  if (\"id\" in newRoute && \"id\" in existingRoute && newRoute.id === existingRoute.id) {\n    return true;\n  }\n  // Second is by pathing differences\n  if (!(newRoute.index === existingRoute.index && newRoute.path === existingRoute.path && newRoute.caseSensitive === existingRoute.caseSensitive)) {\n    return false;\n  }\n  // Pathless layout routes are trickier since we need to check children.\n  // If they have no children then they're the same as far as we can tell\n  if ((!newRoute.children || newRoute.children.length === 0) && (!existingRoute.children || existingRoute.children.length === 0)) {\n    return true;\n  }\n  // Otherwise, we look to see if every child in the new route is already\n  // represented in the existing route's children\n  return newRoute.children.every((aChild, i) => {\n    var _existingRoute$childr;\n    return (_existingRoute$childr = existingRoute.children) == null ? void 0 : _existingRoute$childr.some(bChild => isSameRoute(aChild, bChild));\n  });\n}\n/**\n * Execute route.lazy() methods to lazily load route modules (loader, action,\n * shouldRevalidate) and update the routeManifest in place which shares objects\n * with dataRoutes so those get updated as well.\n */\nasync function loadLazyRouteModule(route, mapRouteProperties, manifest) {\n  if (!route.lazy) {\n    return;\n  }\n  let lazyRoute = await route.lazy();\n  // If the lazy route function was executed and removed by another parallel\n  // call then we can return - first lazy() to finish wins because the return\n  // value of lazy is expected to be static\n  if (!route.lazy) {\n    return;\n  }\n  let routeToUpdate = manifest[route.id];\n  invariant(routeToUpdate, \"No route found in manifest\");\n  // Update the route in place.  This should be safe because there's no way\n  // we could yet be sitting on this route as we can't get there without\n  // resolving lazy() first.\n  //\n  // This is different than the HMR \"update\" use-case where we may actively be\n  // on the route being updated.  The main concern boils down to \"does this\n  // mutation affect any ongoing navigations or any current state.matches\n  // values?\".  If not, it should be safe to update in place.\n  let routeUpdates = {};\n  for (let lazyRouteProperty in lazyRoute) {\n    let staticRouteValue = routeToUpdate[lazyRouteProperty];\n    let isPropertyStaticallyDefined = staticRouteValue !== undefined &&\n    // This property isn't static since it should always be updated based\n    // on the route updates\n    lazyRouteProperty !== \"hasErrorBoundary\";\n    warning(!isPropertyStaticallyDefined, \"Route \\\"\" + routeToUpdate.id + \"\\\" has a static property \\\"\" + lazyRouteProperty + \"\\\" \" + \"defined but its lazy function is also returning a value for this property. \" + (\"The lazy route property \\\"\" + lazyRouteProperty + \"\\\" will be ignored.\"));\n    if (!isPropertyStaticallyDefined && !immutableRouteKeys.has(lazyRouteProperty)) {\n      routeUpdates[lazyRouteProperty] = lazyRoute[lazyRouteProperty];\n    }\n  }\n  // Mutate the route with the provided updates.  Do this first so we pass\n  // the updated version to mapRouteProperties\n  Object.assign(routeToUpdate, routeUpdates);\n  // Mutate the `hasErrorBoundary` property on the route based on the route\n  // updates and remove the `lazy` function so we don't resolve the lazy\n  // route again.\n  Object.assign(routeToUpdate, _extends({}, mapRouteProperties(routeToUpdate), {\n    lazy: undefined\n  }));\n}\n// Default implementation of `dataStrategy` which fetches all loaders in parallel\nasync function defaultDataStrategy(_ref4) {\n  let {\n    matches\n  } = _ref4;\n  let matchesToLoad = matches.filter(m => m.shouldLoad);\n  let results = await Promise.all(matchesToLoad.map(m => m.resolve()));\n  return results.reduce((acc, result, i) => Object.assign(acc, {\n    [matchesToLoad[i].route.id]: result\n  }), {});\n}\nasync function callDataStrategyImpl(dataStrategyImpl, type, state, request, matchesToLoad, matches, fetcherKey, manifest, mapRouteProperties, requestContext) {\n  let loadRouteDefinitionsPromises = matches.map(m => m.route.lazy ? loadLazyRouteModule(m.route, mapRouteProperties, manifest) : undefined);\n  let dsMatches = matches.map((match, i) => {\n    let loadRoutePromise = loadRouteDefinitionsPromises[i];\n    let shouldLoad = matchesToLoad.some(m => m.route.id === match.route.id);\n    // `resolve` encapsulates route.lazy(), executing the loader/action,\n    // and mapping return values/thrown errors to a `DataStrategyResult`.  Users\n    // can pass a callback to take fine-grained control over the execution\n    // of the loader/action\n    let resolve = async handlerOverride => {\n      if (handlerOverride && request.method === \"GET\" && (match.route.lazy || match.route.loader)) {\n        shouldLoad = true;\n      }\n      return shouldLoad ? callLoaderOrAction(type, request, match, loadRoutePromise, handlerOverride, requestContext) : Promise.resolve({\n        type: ResultType.data,\n        result: undefined\n      });\n    };\n    return _extends({}, match, {\n      shouldLoad,\n      resolve\n    });\n  });\n  // Send all matches here to allow for a middleware-type implementation.\n  // handler will be a no-op for unneeded routes and we filter those results\n  // back out below.\n  let results = await dataStrategyImpl({\n    matches: dsMatches,\n    request,\n    params: matches[0].params,\n    fetcherKey,\n    context: requestContext\n  });\n  // Wait for all routes to load here but 'swallow the error since we want\n  // it to bubble up from the `await loadRoutePromise` in `callLoaderOrAction` -\n  // called from `match.resolve()`\n  try {\n    await Promise.all(loadRouteDefinitionsPromises);\n  } catch (e) {\n    // No-op\n  }\n  return results;\n}\n// Default logic for calling a loader/action is the user has no specified a dataStrategy\nasync function callLoaderOrAction(type, request, match, loadRoutePromise, handlerOverride, staticContext) {\n  let result;\n  let onReject;\n  let runHandler = handler => {\n    // Setup a promise we can race against so that abort signals short circuit\n    let reject;\n    // This will never resolve so safe to type it as Promise<DataStrategyResult> to\n    // satisfy the function return value\n    let abortPromise = new Promise((_, r) => reject = r);\n    onReject = () => reject();\n    request.signal.addEventListener(\"abort\", onReject);\n    let actualHandler = ctx => {\n      if (typeof handler !== \"function\") {\n        return Promise.reject(new Error(\"You cannot call the handler for a route which defines a boolean \" + (\"\\\"\" + type + \"\\\" [routeId: \" + match.route.id + \"]\")));\n      }\n      return handler({\n        request,\n        params: match.params,\n        context: staticContext\n      }, ...(ctx !== undefined ? [ctx] : []));\n    };\n    let handlerPromise = (async () => {\n      try {\n        let val = await (handlerOverride ? handlerOverride(ctx => actualHandler(ctx)) : actualHandler());\n        return {\n          type: \"data\",\n          result: val\n        };\n      } catch (e) {\n        return {\n          type: \"error\",\n          result: e\n        };\n      }\n    })();\n    return Promise.race([handlerPromise, abortPromise]);\n  };\n  try {\n    let handler = match.route[type];\n    // If we have a route.lazy promise, await that first\n    if (loadRoutePromise) {\n      if (handler) {\n        // Run statically defined handler in parallel with lazy()\n        let handlerError;\n        let [value] = await Promise.all([\n        // If the handler throws, don't let it immediately bubble out,\n        // since we need to let the lazy() execution finish so we know if this\n        // route has a boundary that can handle the error\n        runHandler(handler).catch(e => {\n          handlerError = e;\n        }), loadRoutePromise]);\n        if (handlerError !== undefined) {\n          throw handlerError;\n        }\n        result = value;\n      } else {\n        // Load lazy route module, then run any returned handler\n        await loadRoutePromise;\n        handler = match.route[type];\n        if (handler) {\n          // Handler still runs even if we got interrupted to maintain consistency\n          // with un-abortable behavior of handler execution on non-lazy or\n          // previously-lazy-loaded routes\n          result = await runHandler(handler);\n        } else if (type === \"action\") {\n          let url = new URL(request.url);\n          let pathname = url.pathname + url.search;\n          throw getInternalRouterError(405, {\n            method: request.method,\n            pathname,\n            routeId: match.route.id\n          });\n        } else {\n          // lazy() route has no loader to run.  Short circuit here so we don't\n          // hit the invariant below that errors on returning undefined.\n          return {\n            type: ResultType.data,\n            result: undefined\n          };\n        }\n      }\n    } else if (!handler) {\n      let url = new URL(request.url);\n      let pathname = url.pathname + url.search;\n      throw getInternalRouterError(404, {\n        pathname\n      });\n    } else {\n      result = await runHandler(handler);\n    }\n    invariant(result.result !== undefined, \"You defined \" + (type === \"action\" ? \"an action\" : \"a loader\") + \" for route \" + (\"\\\"\" + match.route.id + \"\\\" but didn't return anything from your `\" + type + \"` \") + \"function. Please return a value or `null`.\");\n  } catch (e) {\n    // We should already be catching and converting normal handler executions to\n    // DataStrategyResults and returning them, so anything that throws here is an\n    // unexpected error we still need to wrap\n    return {\n      type: ResultType.error,\n      result: e\n    };\n  } finally {\n    if (onReject) {\n      request.signal.removeEventListener(\"abort\", onReject);\n    }\n  }\n  return result;\n}\nasync function convertDataStrategyResultToDataResult(dataStrategyResult) {\n  let {\n    result,\n    type\n  } = dataStrategyResult;\n  if (isResponse(result)) {\n    let data;\n    try {\n      let contentType = result.headers.get(\"Content-Type\");\n      // Check between word boundaries instead of startsWith() due to the last\n      // paragraph of https://httpwg.org/specs/rfc9110.html#field.content-type\n      if (contentType && /\\bapplication\\/json\\b/.test(contentType)) {\n        if (result.body == null) {\n          data = null;\n        } else {\n          data = await result.json();\n        }\n      } else {\n        data = await result.text();\n      }\n    } catch (e) {\n      return {\n        type: ResultType.error,\n        error: e\n      };\n    }\n    if (type === ResultType.error) {\n      return {\n        type: ResultType.error,\n        error: new ErrorResponseImpl(result.status, result.statusText, data),\n        statusCode: result.status,\n        headers: result.headers\n      };\n    }\n    return {\n      type: ResultType.data,\n      data,\n      statusCode: result.status,\n      headers: result.headers\n    };\n  }\n  if (type === ResultType.error) {\n    if (isDataWithResponseInit(result)) {\n      var _result$init3, _result$init4;\n      if (result.data instanceof Error) {\n        var _result$init, _result$init2;\n        return {\n          type: ResultType.error,\n          error: result.data,\n          statusCode: (_result$init = result.init) == null ? void 0 : _result$init.status,\n          headers: (_result$init2 = result.init) != null && _result$init2.headers ? new Headers(result.init.headers) : undefined\n        };\n      }\n      // Convert thrown data() to ErrorResponse instances\n      return {\n        type: ResultType.error,\n        error: new ErrorResponseImpl(((_result$init3 = result.init) == null ? void 0 : _result$init3.status) || 500, undefined, result.data),\n        statusCode: isRouteErrorResponse(result) ? result.status : undefined,\n        headers: (_result$init4 = result.init) != null && _result$init4.headers ? new Headers(result.init.headers) : undefined\n      };\n    }\n    return {\n      type: ResultType.error,\n      error: result,\n      statusCode: isRouteErrorResponse(result) ? result.status : undefined\n    };\n  }\n  if (isDeferredData(result)) {\n    var _result$init5, _result$init6;\n    return {\n      type: ResultType.deferred,\n      deferredData: result,\n      statusCode: (_result$init5 = result.init) == null ? void 0 : _result$init5.status,\n      headers: ((_result$init6 = result.init) == null ? void 0 : _result$init6.headers) && new Headers(result.init.headers)\n    };\n  }\n  if (isDataWithResponseInit(result)) {\n    var _result$init7, _result$init8;\n    return {\n      type: ResultType.data,\n      data: result.data,\n      statusCode: (_result$init7 = result.init) == null ? void 0 : _result$init7.status,\n      headers: (_result$init8 = result.init) != null && _result$init8.headers ? new Headers(result.init.headers) : undefined\n    };\n  }\n  return {\n    type: ResultType.data,\n    data: result\n  };\n}\n// Support relative routing in internal redirects\nfunction normalizeRelativeRoutingRedirectResponse(response, request, routeId, matches, basename, v7_relativeSplatPath) {\n  let location = response.headers.get(\"Location\");\n  invariant(location, \"Redirects returned/thrown from loaders/actions must have a Location header\");\n  if (!ABSOLUTE_URL_REGEX.test(location)) {\n    let trimmedMatches = matches.slice(0, matches.findIndex(m => m.route.id === routeId) + 1);\n    location = normalizeTo(new URL(request.url), trimmedMatches, basename, true, location, v7_relativeSplatPath);\n    response.headers.set(\"Location\", location);\n  }\n  return response;\n}\nfunction normalizeRedirectLocation(location, currentUrl, basename) {\n  if (ABSOLUTE_URL_REGEX.test(location)) {\n    // Strip off the protocol+origin for same-origin + same-basename absolute redirects\n    let normalizedLocation = location;\n    let url = normalizedLocation.startsWith(\"//\") ? new URL(currentUrl.protocol + normalizedLocation) : new URL(normalizedLocation);\n    let isSameBasename = stripBasename(url.pathname, basename) != null;\n    if (url.origin === currentUrl.origin && isSameBasename) {\n      return url.pathname + url.search + url.hash;\n    }\n  }\n  return location;\n}\n// Utility method for creating the Request instances for loaders/actions during\n// client-side navigations and fetches.  During SSR we will always have a\n// Request instance from the static handler (query/queryRoute)\nfunction createClientSideRequest(history, location, signal, submission) {\n  let url = history.createURL(stripHashFromPath(location)).toString();\n  let init = {\n    signal\n  };\n  if (submission && isMutationMethod(submission.formMethod)) {\n    let {\n      formMethod,\n      formEncType\n    } = submission;\n    // Didn't think we needed this but it turns out unlike other methods, patch\n    // won't be properly normalized to uppercase and results in a 405 error.\n    // See: https://fetch.spec.whatwg.org/#concept-method\n    init.method = formMethod.toUpperCase();\n    if (formEncType === \"application/json\") {\n      init.headers = new Headers({\n        \"Content-Type\": formEncType\n      });\n      init.body = JSON.stringify(submission.json);\n    } else if (formEncType === \"text/plain\") {\n      // Content-Type is inferred (https://fetch.spec.whatwg.org/#dom-request)\n      init.body = submission.text;\n    } else if (formEncType === \"application/x-www-form-urlencoded\" && submission.formData) {\n      // Content-Type is inferred (https://fetch.spec.whatwg.org/#dom-request)\n      init.body = convertFormDataToSearchParams(submission.formData);\n    } else {\n      // Content-Type is inferred (https://fetch.spec.whatwg.org/#dom-request)\n      init.body = submission.formData;\n    }\n  }\n  return new Request(url, init);\n}\nfunction convertFormDataToSearchParams(formData) {\n  let searchParams = new URLSearchParams();\n  for (let [key, value] of formData.entries()) {\n    // https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#converting-an-entry-list-to-a-list-of-name-value-pairs\n    searchParams.append(key, typeof value === \"string\" ? value : value.name);\n  }\n  return searchParams;\n}\nfunction convertSearchParamsToFormData(searchParams) {\n  let formData = new FormData();\n  for (let [key, value] of searchParams.entries()) {\n    formData.append(key, value);\n  }\n  return formData;\n}\nfunction processRouteLoaderData(matches, results, pendingActionResult, activeDeferreds, skipLoaderErrorBubbling) {\n  // Fill in loaderData/errors from our loaders\n  let loaderData = {};\n  let errors = null;\n  let statusCode;\n  let foundError = false;\n  let loaderHeaders = {};\n  let pendingError = pendingActionResult && isErrorResult(pendingActionResult[1]) ? pendingActionResult[1].error : undefined;\n  // Process loader results into state.loaderData/state.errors\n  matches.forEach(match => {\n    if (!(match.route.id in results)) {\n      return;\n    }\n    let id = match.route.id;\n    let result = results[id];\n    invariant(!isRedirectResult(result), \"Cannot handle redirect results in processLoaderData\");\n    if (isErrorResult(result)) {\n      let error = result.error;\n      // If we have a pending action error, we report it at the highest-route\n      // that throws a loader error, and then clear it out to indicate that\n      // it was consumed\n      if (pendingError !== undefined) {\n        error = pendingError;\n        pendingError = undefined;\n      }\n      errors = errors || {};\n      if (skipLoaderErrorBubbling) {\n        errors[id] = error;\n      } else {\n        // Look upwards from the matched route for the closest ancestor error\n        // boundary, defaulting to the root match.  Prefer higher error values\n        // if lower errors bubble to the same boundary\n        let boundaryMatch = findNearestBoundary(matches, id);\n        if (errors[boundaryMatch.route.id] == null) {\n          errors[boundaryMatch.route.id] = error;\n        }\n      }\n      // Clear our any prior loaderData for the throwing route\n      loaderData[id] = undefined;\n      // Once we find our first (highest) error, we set the status code and\n      // prevent deeper status codes from overriding\n      if (!foundError) {\n        foundError = true;\n        statusCode = isRouteErrorResponse(result.error) ? result.error.status : 500;\n      }\n      if (result.headers) {\n        loaderHeaders[id] = result.headers;\n      }\n    } else {\n      if (isDeferredResult(result)) {\n        activeDeferreds.set(id, result.deferredData);\n        loaderData[id] = result.deferredData.data;\n        // Error status codes always override success status codes, but if all\n        // loaders are successful we take the deepest status code.\n        if (result.statusCode != null && result.statusCode !== 200 && !foundError) {\n          statusCode = result.statusCode;\n        }\n        if (result.headers) {\n          loaderHeaders[id] = result.headers;\n        }\n      } else {\n        loaderData[id] = result.data;\n        // Error status codes always override success status codes, but if all\n        // loaders are successful we take the deepest status code.\n        if (result.statusCode && result.statusCode !== 200 && !foundError) {\n          statusCode = result.statusCode;\n        }\n        if (result.headers) {\n          loaderHeaders[id] = result.headers;\n        }\n      }\n    }\n  });\n  // If we didn't consume the pending action error (i.e., all loaders\n  // resolved), then consume it here.  Also clear out any loaderData for the\n  // throwing route\n  if (pendingError !== undefined && pendingActionResult) {\n    errors = {\n      [pendingActionResult[0]]: pendingError\n    };\n    loaderData[pendingActionResult[0]] = undefined;\n  }\n  return {\n    loaderData,\n    errors,\n    statusCode: statusCode || 200,\n    loaderHeaders\n  };\n}\nfunction processLoaderData(state, matches, results, pendingActionResult, revalidatingFetchers, fetcherResults, activeDeferreds) {\n  let {\n    loaderData,\n    errors\n  } = processRouteLoaderData(matches, results, pendingActionResult, activeDeferreds, false // This method is only called client side so we always want to bubble\n  );\n  // Process results from our revalidating fetchers\n  revalidatingFetchers.forEach(rf => {\n    let {\n      key,\n      match,\n      controller\n    } = rf;\n    let result = fetcherResults[key];\n    invariant(result, \"Did not find corresponding fetcher result\");\n    // Process fetcher non-redirect errors\n    if (controller && controller.signal.aborted) {\n      // Nothing to do for aborted fetchers\n      return;\n    } else if (isErrorResult(result)) {\n      let boundaryMatch = findNearestBoundary(state.matches, match == null ? void 0 : match.route.id);\n      if (!(errors && errors[boundaryMatch.route.id])) {\n        errors = _extends({}, errors, {\n          [boundaryMatch.route.id]: result.error\n        });\n      }\n      state.fetchers.delete(key);\n    } else if (isRedirectResult(result)) {\n      // Should never get here, redirects should get processed above, but we\n      // keep this to type narrow to a success result in the else\n      invariant(false, \"Unhandled fetcher revalidation redirect\");\n    } else if (isDeferredResult(result)) {\n      // Should never get here, deferred data should be awaited for fetchers\n      // in resolveDeferredResults\n      invariant(false, \"Unhandled fetcher deferred data\");\n    } else {\n      let doneFetcher = getDoneFetcher(result.data);\n      state.fetchers.set(key, doneFetcher);\n    }\n  });\n  return {\n    loaderData,\n    errors\n  };\n}\nfunction mergeLoaderData(loaderData, newLoaderData, matches, errors) {\n  let mergedLoaderData = _extends({}, newLoaderData);\n  for (let match of matches) {\n    let id = match.route.id;\n    if (newLoaderData.hasOwnProperty(id)) {\n      if (newLoaderData[id] !== undefined) {\n        mergedLoaderData[id] = newLoaderData[id];\n      }\n    } else if (loaderData[id] !== undefined && match.route.loader) {\n      // Preserve existing keys not included in newLoaderData and where a loader\n      // wasn't removed by HMR\n      mergedLoaderData[id] = loaderData[id];\n    }\n    if (errors && errors.hasOwnProperty(id)) {\n      // Don't keep any loader data below the boundary\n      break;\n    }\n  }\n  return mergedLoaderData;\n}\nfunction getActionDataForCommit(pendingActionResult) {\n  if (!pendingActionResult) {\n    return {};\n  }\n  return isErrorResult(pendingActionResult[1]) ? {\n    // Clear out prior actionData on errors\n    actionData: {}\n  } : {\n    actionData: {\n      [pendingActionResult[0]]: pendingActionResult[1].data\n    }\n  };\n}\n// Find the nearest error boundary, looking upwards from the leaf route (or the\n// route specified by routeId) for the closest ancestor error boundary,\n// defaulting to the root match\nfunction findNearestBoundary(matches, routeId) {\n  let eligibleMatches = routeId ? matches.slice(0, matches.findIndex(m => m.route.id === routeId) + 1) : [...matches];\n  return eligibleMatches.reverse().find(m => m.route.hasErrorBoundary === true) || matches[0];\n}\nfunction getShortCircuitMatches(routes) {\n  // Prefer a root layout route if present, otherwise shim in a route object\n  let route = routes.length === 1 ? routes[0] : routes.find(r => r.index || !r.path || r.path === \"/\") || {\n    id: \"__shim-error-route__\"\n  };\n  return {\n    matches: [{\n      params: {},\n      pathname: \"\",\n      pathnameBase: \"\",\n      route\n    }],\n    route\n  };\n}\nfunction getInternalRouterError(status, _temp5) {\n  let {\n    pathname,\n    routeId,\n    method,\n    type,\n    message\n  } = _temp5 === void 0 ? {} : _temp5;\n  let statusText = \"Unknown Server Error\";\n  let errorMessage = \"Unknown @remix-run/router error\";\n  if (status === 400) {\n    statusText = \"Bad Request\";\n    if (method && pathname && routeId) {\n      errorMessage = \"You made a \" + method + \" request to \\\"\" + pathname + \"\\\" but \" + (\"did not provide a `loader` for route \\\"\" + routeId + \"\\\", \") + \"so there is no way to handle the request.\";\n    } else if (type === \"defer-action\") {\n      errorMessage = \"defer() is not supported in actions\";\n    } else if (type === \"invalid-body\") {\n      errorMessage = \"Unable to encode submission body\";\n    }\n  } else if (status === 403) {\n    statusText = \"Forbidden\";\n    errorMessage = \"Route \\\"\" + routeId + \"\\\" does not match URL \\\"\" + pathname + \"\\\"\";\n  } else if (status === 404) {\n    statusText = \"Not Found\";\n    errorMessage = \"No route matches URL \\\"\" + pathname + \"\\\"\";\n  } else if (status === 405) {\n    statusText = \"Method Not Allowed\";\n    if (method && pathname && routeId) {\n      errorMessage = \"You made a \" + method.toUpperCase() + \" request to \\\"\" + pathname + \"\\\" but \" + (\"did not provide an `action` for route \\\"\" + routeId + \"\\\", \") + \"so there is no way to handle the request.\";\n    } else if (method) {\n      errorMessage = \"Invalid request method \\\"\" + method.toUpperCase() + \"\\\"\";\n    }\n  }\n  return new ErrorResponseImpl(status || 500, statusText, new Error(errorMessage), true);\n}\n// Find any returned redirect errors, starting from the lowest match\nfunction findRedirect(results) {\n  let entries = Object.entries(results);\n  for (let i = entries.length - 1; i >= 0; i--) {\n    let [key, result] = entries[i];\n    if (isRedirectResult(result)) {\n      return {\n        key,\n        result\n      };\n    }\n  }\n}\nfunction stripHashFromPath(path) {\n  let parsedPath = typeof path === \"string\" ? parsePath(path) : path;\n  return createPath(_extends({}, parsedPath, {\n    hash: \"\"\n  }));\n}\nfunction isHashChangeOnly(a, b) {\n  if (a.pathname !== b.pathname || a.search !== b.search) {\n    return false;\n  }\n  if (a.hash === \"\") {\n    // /page -> /page#hash\n    return b.hash !== \"\";\n  } else if (a.hash === b.hash) {\n    // /page#hash -> /page#hash\n    return true;\n  } else if (b.hash !== \"\") {\n    // /page#hash -> /page#other\n    return true;\n  }\n  // If the hash is removed the browser will re-perform a request to the server\n  // /page#hash -> /page\n  return false;\n}\nfunction isDataStrategyResult(result) {\n  return result != null && typeof result === \"object\" && \"type\" in result && \"result\" in result && (result.type === ResultType.data || result.type === ResultType.error);\n}\nfunction isRedirectDataStrategyResultResult(result) {\n  return isResponse(result.result) && redirectStatusCodes.has(result.result.status);\n}\nfunction isDeferredResult(result) {\n  return result.type === ResultType.deferred;\n}\nfunction isErrorResult(result) {\n  return result.type === ResultType.error;\n}\nfunction isRedirectResult(result) {\n  return (result && result.type) === ResultType.redirect;\n}\nfunction isDataWithResponseInit(value) {\n  return typeof value === \"object\" && value != null && \"type\" in value && \"data\" in value && \"init\" in value && value.type === \"DataWithResponseInit\";\n}\nfunction isDeferredData(value) {\n  let deferred = value;\n  return deferred && typeof deferred === \"object\" && typeof deferred.data === \"object\" && typeof deferred.subscribe === \"function\" && typeof deferred.cancel === \"function\" && typeof deferred.resolveData === \"function\";\n}\nfunction isResponse(value) {\n  return value != null && typeof value.status === \"number\" && typeof value.statusText === \"string\" && typeof value.headers === \"object\" && typeof value.body !== \"undefined\";\n}\nfunction isRedirectResponse(result) {\n  if (!isResponse(result)) {\n    return false;\n  }\n  let status = result.status;\n  let location = result.headers.get(\"Location\");\n  return status >= 300 && status <= 399 && location != null;\n}\nfunction isValidMethod(method) {\n  return validRequestMethods.has(method.toLowerCase());\n}\nfunction isMutationMethod(method) {\n  return validMutationMethods.has(method.toLowerCase());\n}\nasync function resolveNavigationDeferredResults(matches, results, signal, currentMatches, currentLoaderData) {\n  let entries = Object.entries(results);\n  for (let index = 0; index < entries.length; index++) {\n    let [routeId, result] = entries[index];\n    let match = matches.find(m => (m == null ? void 0 : m.route.id) === routeId);\n    // If we don't have a match, then we can have a deferred result to do\n    // anything with.  This is for revalidating fetchers where the route was\n    // removed during HMR\n    if (!match) {\n      continue;\n    }\n    let currentMatch = currentMatches.find(m => m.route.id === match.route.id);\n    let isRevalidatingLoader = currentMatch != null && !isNewRouteInstance(currentMatch, match) && (currentLoaderData && currentLoaderData[match.route.id]) !== undefined;\n    if (isDeferredResult(result) && isRevalidatingLoader) {\n      // Note: we do not have to touch activeDeferreds here since we race them\n      // against the signal in resolveDeferredData and they'll get aborted\n      // there if needed\n      await resolveDeferredData(result, signal, false).then(result => {\n        if (result) {\n          results[routeId] = result;\n        }\n      });\n    }\n  }\n}\nasync function resolveFetcherDeferredResults(matches, results, revalidatingFetchers) {\n  for (let index = 0; index < revalidatingFetchers.length; index++) {\n    let {\n      key,\n      routeId,\n      controller\n    } = revalidatingFetchers[index];\n    let result = results[key];\n    let match = matches.find(m => (m == null ? void 0 : m.route.id) === routeId);\n    // If we don't have a match, then we can have a deferred result to do\n    // anything with.  This is for revalidating fetchers where the route was\n    // removed during HMR\n    if (!match) {\n      continue;\n    }\n    if (isDeferredResult(result)) {\n      // Note: we do not have to touch activeDeferreds here since we race them\n      // against the signal in resolveDeferredData and they'll get aborted\n      // there if needed\n      invariant(controller, \"Expected an AbortController for revalidating fetcher deferred result\");\n      await resolveDeferredData(result, controller.signal, true).then(result => {\n        if (result) {\n          results[key] = result;\n        }\n      });\n    }\n  }\n}\nasync function resolveDeferredData(result, signal, unwrap) {\n  if (unwrap === void 0) {\n    unwrap = false;\n  }\n  let aborted = await result.deferredData.resolveData(signal);\n  if (aborted) {\n    return;\n  }\n  if (unwrap) {\n    try {\n      return {\n        type: ResultType.data,\n        data: result.deferredData.unwrappedData\n      };\n    } catch (e) {\n      // Handle any TrackedPromise._error values encountered while unwrapping\n      return {\n        type: ResultType.error,\n        error: e\n      };\n    }\n  }\n  return {\n    type: ResultType.data,\n    data: result.deferredData.data\n  };\n}\nfunction hasNakedIndexQuery(search) {\n  return new URLSearchParams(search).getAll(\"index\").some(v => v === \"\");\n}\nfunction getTargetMatch(matches, location) {\n  let search = typeof location === \"string\" ? parsePath(location).search : location.search;\n  if (matches[matches.length - 1].route.index && hasNakedIndexQuery(search || \"\")) {\n    // Return the leaf index route when index is present\n    return matches[matches.length - 1];\n  }\n  // Otherwise grab the deepest \"path contributing\" match (ignoring index and\n  // pathless layout routes)\n  let pathMatches = getPathContributingMatches(matches);\n  return pathMatches[pathMatches.length - 1];\n}\nfunction getSubmissionFromNavigation(navigation) {\n  let {\n    formMethod,\n    formAction,\n    formEncType,\n    text,\n    formData,\n    json\n  } = navigation;\n  if (!formMethod || !formAction || !formEncType) {\n    return;\n  }\n  if (text != null) {\n    return {\n      formMethod,\n      formAction,\n      formEncType,\n      formData: undefined,\n      json: undefined,\n      text\n    };\n  } else if (formData != null) {\n    return {\n      formMethod,\n      formAction,\n      formEncType,\n      formData,\n      json: undefined,\n      text: undefined\n    };\n  } else if (json !== undefined) {\n    return {\n      formMethod,\n      formAction,\n      formEncType,\n      formData: undefined,\n      json,\n      text: undefined\n    };\n  }\n}\nfunction getLoadingNavigation(location, submission) {\n  if (submission) {\n    let navigation = {\n      state: \"loading\",\n      location,\n      formMethod: submission.formMethod,\n      formAction: submission.formAction,\n      formEncType: submission.formEncType,\n      formData: submission.formData,\n      json: submission.json,\n      text: submission.text\n    };\n    return navigation;\n  } else {\n    let navigation = {\n      state: \"loading\",\n      location,\n      formMethod: undefined,\n      formAction: undefined,\n      formEncType: undefined,\n      formData: undefined,\n      json: undefined,\n      text: undefined\n    };\n    return navigation;\n  }\n}\nfunction getSubmittingNavigation(location, submission) {\n  let navigation = {\n    state: \"submitting\",\n    location,\n    formMethod: submission.formMethod,\n    formAction: submission.formAction,\n    formEncType: submission.formEncType,\n    formData: submission.formData,\n    json: submission.json,\n    text: submission.text\n  };\n  return navigation;\n}\nfunction getLoadingFetcher(submission, data) {\n  if (submission) {\n    let fetcher = {\n      state: \"loading\",\n      formMethod: submission.formMethod,\n      formAction: submission.formAction,\n      formEncType: submission.formEncType,\n      formData: submission.formData,\n      json: submission.json,\n      text: submission.text,\n      data\n    };\n    return fetcher;\n  } else {\n    let fetcher = {\n      state: \"loading\",\n      formMethod: undefined,\n      formAction: undefined,\n      formEncType: undefined,\n      formData: undefined,\n      json: undefined,\n      text: undefined,\n      data\n    };\n    return fetcher;\n  }\n}\nfunction getSubmittingFetcher(submission, existingFetcher) {\n  let fetcher = {\n    state: \"submitting\",\n    formMethod: submission.formMethod,\n    formAction: submission.formAction,\n    formEncType: submission.formEncType,\n    formData: submission.formData,\n    json: submission.json,\n    text: submission.text,\n    data: existingFetcher ? existingFetcher.data : undefined\n  };\n  return fetcher;\n}\nfunction getDoneFetcher(data) {\n  let fetcher = {\n    state: \"idle\",\n    formMethod: undefined,\n    formAction: undefined,\n    formEncType: undefined,\n    formData: undefined,\n    json: undefined,\n    text: undefined,\n    data\n  };\n  return fetcher;\n}\nfunction restoreAppliedTransitions(_window, transitions) {\n  try {\n    let sessionPositions = _window.sessionStorage.getItem(TRANSITIONS_STORAGE_KEY);\n    if (sessionPositions) {\n      let json = JSON.parse(sessionPositions);\n      for (let [k, v] of Object.entries(json || {})) {\n        if (v && Array.isArray(v)) {\n          transitions.set(k, new Set(v || []));\n        }\n      }\n    }\n  } catch (e) {\n    // no-op, use default empty object\n  }\n}\nfunction persistAppliedTransitions(_window, transitions) {\n  if (transitions.size > 0) {\n    let json = {};\n    for (let [k, v] of transitions) {\n      json[k] = [...v];\n    }\n    try {\n      _window.sessionStorage.setItem(TRANSITIONS_STORAGE_KEY, JSON.stringify(json));\n    } catch (error) {\n      warning(false, \"Failed to save applied view transitions in sessionStorage (\" + error + \").\");\n    }\n  }\n}\n//#endregion\n\nexport { AbortedDeferredError, Action, IDLE_BLOCKER, IDLE_FETCHER, IDLE_NAVIGATION, UNSAFE_DEFERRED_SYMBOL, DeferredData as UNSAFE_DeferredData, ErrorResponseImpl as UNSAFE_ErrorResponseImpl, convertRouteMatchToUiMatch as UNSAFE_convertRouteMatchToUiMatch, convertRoutesToDataRoutes as UNSAFE_convertRoutesToDataRoutes, decodePath as UNSAFE_decodePath, getResolveToMatches as UNSAFE_getResolveToMatches, invariant as UNSAFE_invariant, warning as UNSAFE_warning, createBrowserHistory, createHashHistory, createMemoryHistory, createPath, createRouter, createStaticHandler, data, defer, generatePath, getStaticContextFromError, getToPathname, isDataWithResponseInit, isDeferredData, isRouteErrorResponse, joinPaths, json, matchPath, matchRoutes, normalizePathname, parsePath, redirect, redirectDocument, replace, resolvePath, resolveTo, stripBasename };\n//# sourceMappingURL=router.js.map\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * React Router v6.30.1\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport * as React from 'react';\nimport { UNSAFE_invariant, joinPaths, matchPath, UNSAFE_decodePath, UNSAFE_getResolveToMatches, UNSAFE_warning, resolveTo, parsePath, matchRoutes, Action, UNSAFE_convertRouteMatchToUiMatch, stripBasename, IDLE_BLOCKER, isRouteErrorResponse, createMemoryHistory, AbortedDeferredError, createRouter } from '@remix-run/router';\nexport { AbortedDeferredError, Action as NavigationType, createPath, defer, generatePath, isRouteErrorResponse, json, matchPath, matchRoutes, parsePath, redirect, redirectDocument, replace, resolvePath } from '@remix-run/router';\n\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\n// Create react-specific types from the agnostic types in @remix-run/router to\n// export from react-router\nconst DataRouterContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  DataRouterContext.displayName = \"DataRouter\";\n}\nconst DataRouterStateContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  DataRouterStateContext.displayName = \"DataRouterState\";\n}\nconst AwaitContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  AwaitContext.displayName = \"Await\";\n}\n\n/**\n * A Navigator is a \"location changer\"; it's how you get to different locations.\n *\n * Every history instance conforms to the Navigator interface, but the\n * distinction is useful primarily when it comes to the low-level `<Router>` API\n * where both the location and a navigator must be provided separately in order\n * to avoid \"tearing\" that may occur in a suspense-enabled app if the action\n * and/or location were to be read directly from the history instance.\n */\n\nconst NavigationContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  NavigationContext.displayName = \"Navigation\";\n}\nconst LocationContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  LocationContext.displayName = \"Location\";\n}\nconst RouteContext = /*#__PURE__*/React.createContext({\n  outlet: null,\n  matches: [],\n  isDataRoute: false\n});\nif (process.env.NODE_ENV !== \"production\") {\n  RouteContext.displayName = \"Route\";\n}\nconst RouteErrorContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  RouteErrorContext.displayName = \"RouteError\";\n}\n\n/**\n * Returns the full href for the given \"to\" value. This is useful for building\n * custom links that are also accessible and preserve right-click behavior.\n *\n * @see https://reactrouter.com/v6/hooks/use-href\n */\nfunction useHref(to, _temp) {\n  let {\n    relative\n  } = _temp === void 0 ? {} : _temp;\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useHref() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    basename,\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    hash,\n    pathname,\n    search\n  } = useResolvedPath(to, {\n    relative\n  });\n  let joinedPathname = pathname;\n\n  // If we're operating within a basename, prepend it to the pathname prior\n  // to creating the href.  If this is a root navigation, then just use the raw\n  // basename which allows the basename to have full control over the presence\n  // of a trailing slash on root links\n  if (basename !== \"/\") {\n    joinedPathname = pathname === \"/\" ? basename : joinPaths([basename, pathname]);\n  }\n  return navigator.createHref({\n    pathname: joinedPathname,\n    search,\n    hash\n  });\n}\n\n/**\n * Returns true if this component is a descendant of a `<Router>`.\n *\n * @see https://reactrouter.com/v6/hooks/use-in-router-context\n */\nfunction useInRouterContext() {\n  return React.useContext(LocationContext) != null;\n}\n\n/**\n * Returns the current location object, which represents the current URL in web\n * browsers.\n *\n * Note: If you're using this it may mean you're doing some of your own\n * \"routing\" in your app, and we'd like to know what your use case is. We may\n * be able to provide something higher-level to better suit your needs.\n *\n * @see https://reactrouter.com/v6/hooks/use-location\n */\nfunction useLocation() {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useLocation() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  return React.useContext(LocationContext).location;\n}\n\n/**\n * Returns the current navigation action which describes how the router came to\n * the current location, either by a pop, push, or replace on the history stack.\n *\n * @see https://reactrouter.com/v6/hooks/use-navigation-type\n */\nfunction useNavigationType() {\n  return React.useContext(LocationContext).navigationType;\n}\n\n/**\n * Returns a PathMatch object if the given pattern matches the current URL.\n * This is useful for components that need to know \"active\" state, e.g.\n * `<NavLink>`.\n *\n * @see https://reactrouter.com/v6/hooks/use-match\n */\nfunction useMatch(pattern) {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useMatch() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    pathname\n  } = useLocation();\n  return React.useMemo(() => matchPath(pattern, UNSAFE_decodePath(pathname)), [pathname, pattern]);\n}\n\n/**\n * The interface for the navigate() function returned from useNavigate().\n */\n\nconst navigateEffectWarning = \"You should call navigate() in a React.useEffect(), not when \" + \"your component is first rendered.\";\n\n// Mute warnings for calls to useNavigate in SSR environments\nfunction useIsomorphicLayoutEffect(cb) {\n  let isStatic = React.useContext(NavigationContext).static;\n  if (!isStatic) {\n    // We should be able to get rid of this once react 18.3 is released\n    // See: https://github.com/facebook/react/pull/26395\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(cb);\n  }\n}\n\n/**\n * Returns an imperative method for changing the location. Used by `<Link>`s, but\n * may also be used by other elements to change the location.\n *\n * @see https://reactrouter.com/v6/hooks/use-navigate\n */\nfunction useNavigate() {\n  let {\n    isDataRoute\n  } = React.useContext(RouteContext);\n  // Conditional usage is OK here because the usage of a data router is static\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  return isDataRoute ? useNavigateStable() : useNavigateUnstable();\n}\nfunction useNavigateUnstable() {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useNavigate() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let dataRouterContext = React.useContext(DataRouterContext);\n  let {\n    basename,\n    future,\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let routePathnamesJson = JSON.stringify(UNSAFE_getResolveToMatches(matches, future.v7_relativeSplatPath));\n  let activeRef = React.useRef(false);\n  useIsomorphicLayoutEffect(() => {\n    activeRef.current = true;\n  });\n  let navigate = React.useCallback(function (to, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(activeRef.current, navigateEffectWarning) : void 0;\n\n    // Short circuit here since if this happens on first render the navigate\n    // is useless because we haven't wired up our history listener yet\n    if (!activeRef.current) return;\n    if (typeof to === \"number\") {\n      navigator.go(to);\n      return;\n    }\n    let path = resolveTo(to, JSON.parse(routePathnamesJson), locationPathname, options.relative === \"path\");\n\n    // If we're operating within a basename, prepend it to the pathname prior\n    // to handing off to history (but only if we're not in a data router,\n    // otherwise it'll prepend the basename inside of the router).\n    // If this is a root navigation, then we navigate to the raw basename\n    // which allows the basename to have full control over the presence of a\n    // trailing slash on root links\n    if (dataRouterContext == null && basename !== \"/\") {\n      path.pathname = path.pathname === \"/\" ? basename : joinPaths([basename, path.pathname]);\n    }\n    (!!options.replace ? navigator.replace : navigator.push)(path, options.state, options);\n  }, [basename, navigator, routePathnamesJson, locationPathname, dataRouterContext]);\n  return navigate;\n}\nconst OutletContext = /*#__PURE__*/React.createContext(null);\n\n/**\n * Returns the context (if provided) for the child route at this level of the route\n * hierarchy.\n * @see https://reactrouter.com/v6/hooks/use-outlet-context\n */\nfunction useOutletContext() {\n  return React.useContext(OutletContext);\n}\n\n/**\n * Returns the element for the child route at this level of the route\n * hierarchy. Used internally by `<Outlet>` to render child routes.\n *\n * @see https://reactrouter.com/v6/hooks/use-outlet\n */\nfunction useOutlet(context) {\n  let outlet = React.useContext(RouteContext).outlet;\n  if (outlet) {\n    return /*#__PURE__*/React.createElement(OutletContext.Provider, {\n      value: context\n    }, outlet);\n  }\n  return outlet;\n}\n\n/**\n * Returns an object of key/value pairs of the dynamic params from the current\n * URL that were matched by the route path.\n *\n * @see https://reactrouter.com/v6/hooks/use-params\n */\nfunction useParams() {\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let routeMatch = matches[matches.length - 1];\n  return routeMatch ? routeMatch.params : {};\n}\n\n/**\n * Resolves the pathname of the given `to` value against the current location.\n *\n * @see https://reactrouter.com/v6/hooks/use-resolved-path\n */\nfunction useResolvedPath(to, _temp2) {\n  let {\n    relative\n  } = _temp2 === void 0 ? {} : _temp2;\n  let {\n    future\n  } = React.useContext(NavigationContext);\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let routePathnamesJson = JSON.stringify(UNSAFE_getResolveToMatches(matches, future.v7_relativeSplatPath));\n  return React.useMemo(() => resolveTo(to, JSON.parse(routePathnamesJson), locationPathname, relative === \"path\"), [to, routePathnamesJson, locationPathname, relative]);\n}\n\n/**\n * Returns the element of the route that matched the current location, prepared\n * with the correct context to render the remainder of the route tree. Route\n * elements in the tree must render an `<Outlet>` to render their child route's\n * element.\n *\n * @see https://reactrouter.com/v6/hooks/use-routes\n */\nfunction useRoutes(routes, locationArg) {\n  return useRoutesImpl(routes, locationArg);\n}\n\n// Internal implementation with accept optional param for RouterProvider usage\nfunction useRoutesImpl(routes, locationArg, dataRouterState, future) {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useRoutes() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    matches: parentMatches\n  } = React.useContext(RouteContext);\n  let routeMatch = parentMatches[parentMatches.length - 1];\n  let parentParams = routeMatch ? routeMatch.params : {};\n  let parentPathname = routeMatch ? routeMatch.pathname : \"/\";\n  let parentPathnameBase = routeMatch ? routeMatch.pathnameBase : \"/\";\n  let parentRoute = routeMatch && routeMatch.route;\n  if (process.env.NODE_ENV !== \"production\") {\n    // You won't get a warning about 2 different <Routes> under a <Route>\n    // without a trailing *, but this is a best-effort warning anyway since we\n    // cannot even give the warning unless they land at the parent route.\n    //\n    // Example:\n    //\n    // <Routes>\n    //   {/* This route path MUST end with /* because otherwise\n    //       it will never match /blog/post/123 */}\n    //   <Route path=\"blog\" element={<Blog />} />\n    //   <Route path=\"blog/feed\" element={<BlogFeed />} />\n    // </Routes>\n    //\n    // function Blog() {\n    //   return (\n    //     <Routes>\n    //       <Route path=\"post/:id\" element={<Post />} />\n    //     </Routes>\n    //   );\n    // }\n    let parentPath = parentRoute && parentRoute.path || \"\";\n    warningOnce(parentPathname, !parentRoute || parentPath.endsWith(\"*\"), \"You rendered descendant <Routes> (or called `useRoutes()`) at \" + (\"\\\"\" + parentPathname + \"\\\" (under <Route path=\\\"\" + parentPath + \"\\\">) but the \") + \"parent route path has no trailing \\\"*\\\". This means if you navigate \" + \"deeper, the parent won't match anymore and therefore the child \" + \"routes will never render.\\n\\n\" + (\"Please change the parent <Route path=\\\"\" + parentPath + \"\\\"> to <Route \") + (\"path=\\\"\" + (parentPath === \"/\" ? \"*\" : parentPath + \"/*\") + \"\\\">.\"));\n  }\n  let locationFromContext = useLocation();\n  let location;\n  if (locationArg) {\n    var _parsedLocationArg$pa;\n    let parsedLocationArg = typeof locationArg === \"string\" ? parsePath(locationArg) : locationArg;\n    !(parentPathnameBase === \"/\" || ((_parsedLocationArg$pa = parsedLocationArg.pathname) == null ? void 0 : _parsedLocationArg$pa.startsWith(parentPathnameBase))) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, \" + \"the location pathname must begin with the portion of the URL pathname that was \" + (\"matched by all parent routes. The current pathname base is \\\"\" + parentPathnameBase + \"\\\" \") + (\"but pathname \\\"\" + parsedLocationArg.pathname + \"\\\" was given in the `location` prop.\")) : UNSAFE_invariant(false) : void 0;\n    location = parsedLocationArg;\n  } else {\n    location = locationFromContext;\n  }\n  let pathname = location.pathname || \"/\";\n  let remainingPathname = pathname;\n  if (parentPathnameBase !== \"/\") {\n    // Determine the remaining pathname by removing the # of URL segments the\n    // parentPathnameBase has, instead of removing based on character count.\n    // This is because we can't guarantee that incoming/outgoing encodings/\n    // decodings will match exactly.\n    // We decode paths before matching on a per-segment basis with\n    // decodeURIComponent(), but we re-encode pathnames via `new URL()` so they\n    // match what `window.location.pathname` would reflect.  Those don't 100%\n    // align when it comes to encoded URI characters such as % and &.\n    //\n    // So we may end up with:\n    //   pathname:           \"/descendant/a%25b/match\"\n    //   parentPathnameBase: \"/descendant/a%b\"\n    //\n    // And the direct substring removal approach won't work :/\n    let parentSegments = parentPathnameBase.replace(/^\\//, \"\").split(\"/\");\n    let segments = pathname.replace(/^\\//, \"\").split(\"/\");\n    remainingPathname = \"/\" + segments.slice(parentSegments.length).join(\"/\");\n  }\n  let matches = matchRoutes(routes, {\n    pathname: remainingPathname\n  });\n  if (process.env.NODE_ENV !== \"production\") {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(parentRoute || matches != null, \"No routes matched location \\\"\" + location.pathname + location.search + location.hash + \"\\\" \") : void 0;\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(matches == null || matches[matches.length - 1].route.element !== undefined || matches[matches.length - 1].route.Component !== undefined || matches[matches.length - 1].route.lazy !== undefined, \"Matched leaf route at location \\\"\" + location.pathname + location.search + location.hash + \"\\\" \" + \"does not have an element or Component. This means it will render an <Outlet /> with a \" + \"null value by default resulting in an \\\"empty\\\" page.\") : void 0;\n  }\n  let renderedMatches = _renderMatches(matches && matches.map(match => Object.assign({}, match, {\n    params: Object.assign({}, parentParams, match.params),\n    pathname: joinPaths([parentPathnameBase,\n    // Re-encode pathnames that were decoded inside matchRoutes\n    navigator.encodeLocation ? navigator.encodeLocation(match.pathname).pathname : match.pathname]),\n    pathnameBase: match.pathnameBase === \"/\" ? parentPathnameBase : joinPaths([parentPathnameBase,\n    // Re-encode pathnames that were decoded inside matchRoutes\n    navigator.encodeLocation ? navigator.encodeLocation(match.pathnameBase).pathname : match.pathnameBase])\n  })), parentMatches, dataRouterState, future);\n\n  // When a user passes in a `locationArg`, the associated routes need to\n  // be wrapped in a new `LocationContext.Provider` in order for `useLocation`\n  // to use the scoped location instead of the global location.\n  if (locationArg && renderedMatches) {\n    return /*#__PURE__*/React.createElement(LocationContext.Provider, {\n      value: {\n        location: _extends({\n          pathname: \"/\",\n          search: \"\",\n          hash: \"\",\n          state: null,\n          key: \"default\"\n        }, location),\n        navigationType: Action.Pop\n      }\n    }, renderedMatches);\n  }\n  return renderedMatches;\n}\nfunction DefaultErrorComponent() {\n  let error = useRouteError();\n  let message = isRouteErrorResponse(error) ? error.status + \" \" + error.statusText : error instanceof Error ? error.message : JSON.stringify(error);\n  let stack = error instanceof Error ? error.stack : null;\n  let lightgrey = \"rgba(200,200,200, 0.5)\";\n  let preStyles = {\n    padding: \"0.5rem\",\n    backgroundColor: lightgrey\n  };\n  let codeStyles = {\n    padding: \"2px 4px\",\n    backgroundColor: lightgrey\n  };\n  let devInfo = null;\n  if (process.env.NODE_ENV !== \"production\") {\n    console.error(\"Error handled by React Router default ErrorBoundary:\", error);\n    devInfo = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"p\", null, \"\\uD83D\\uDCBF Hey developer \\uD83D\\uDC4B\"), /*#__PURE__*/React.createElement(\"p\", null, \"You can provide a way better UX than this when your app throws errors by providing your own \", /*#__PURE__*/React.createElement(\"code\", {\n      style: codeStyles\n    }, \"ErrorBoundary\"), \" or\", \" \", /*#__PURE__*/React.createElement(\"code\", {\n      style: codeStyles\n    }, \"errorElement\"), \" prop on your route.\"));\n  }\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h2\", null, \"Unexpected Application Error!\"), /*#__PURE__*/React.createElement(\"h3\", {\n    style: {\n      fontStyle: \"italic\"\n    }\n  }, message), stack ? /*#__PURE__*/React.createElement(\"pre\", {\n    style: preStyles\n  }, stack) : null, devInfo);\n}\nconst defaultErrorElement = /*#__PURE__*/React.createElement(DefaultErrorComponent, null);\nclass RenderErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      location: props.location,\n      revalidation: props.revalidation,\n      error: props.error\n    };\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      error: error\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    // When we get into an error state, the user will likely click \"back\" to the\n    // previous page that didn't have an error. Because this wraps the entire\n    // application, that will have no effect--the error page continues to display.\n    // This gives us a mechanism to recover from the error when the location changes.\n    //\n    // Whether we're in an error state or not, we update the location in state\n    // so that when we are in an error state, it gets reset when a new location\n    // comes in and the user recovers from the error.\n    if (state.location !== props.location || state.revalidation !== \"idle\" && props.revalidation === \"idle\") {\n      return {\n        error: props.error,\n        location: props.location,\n        revalidation: props.revalidation\n      };\n    }\n\n    // If we're not changing locations, preserve the location but still surface\n    // any new errors that may come through. We retain the existing error, we do\n    // this because the error provided from the app state may be cleared without\n    // the location changing.\n    return {\n      error: props.error !== undefined ? props.error : state.error,\n      location: state.location,\n      revalidation: props.revalidation || state.revalidation\n    };\n  }\n  componentDidCatch(error, errorInfo) {\n    console.error(\"React Router caught the following error during render\", error, errorInfo);\n  }\n  render() {\n    return this.state.error !== undefined ? /*#__PURE__*/React.createElement(RouteContext.Provider, {\n      value: this.props.routeContext\n    }, /*#__PURE__*/React.createElement(RouteErrorContext.Provider, {\n      value: this.state.error,\n      children: this.props.component\n    })) : this.props.children;\n  }\n}\nfunction RenderedRoute(_ref) {\n  let {\n    routeContext,\n    match,\n    children\n  } = _ref;\n  let dataRouterContext = React.useContext(DataRouterContext);\n\n  // Track how deep we got in our render pass to emulate SSR componentDidCatch\n  // in a DataStaticRouter\n  if (dataRouterContext && dataRouterContext.static && dataRouterContext.staticContext && (match.route.errorElement || match.route.ErrorBoundary)) {\n    dataRouterContext.staticContext._deepestRenderedBoundaryId = match.route.id;\n  }\n  return /*#__PURE__*/React.createElement(RouteContext.Provider, {\n    value: routeContext\n  }, children);\n}\nfunction _renderMatches(matches, parentMatches, dataRouterState, future) {\n  var _dataRouterState;\n  if (parentMatches === void 0) {\n    parentMatches = [];\n  }\n  if (dataRouterState === void 0) {\n    dataRouterState = null;\n  }\n  if (future === void 0) {\n    future = null;\n  }\n  if (matches == null) {\n    var _future;\n    if (!dataRouterState) {\n      return null;\n    }\n    if (dataRouterState.errors) {\n      // Don't bail if we have data router errors so we can render them in the\n      // boundary.  Use the pre-matched (or shimmed) matches\n      matches = dataRouterState.matches;\n    } else if ((_future = future) != null && _future.v7_partialHydration && parentMatches.length === 0 && !dataRouterState.initialized && dataRouterState.matches.length > 0) {\n      // Don't bail if we're initializing with partial hydration and we have\n      // router matches.  That means we're actively running `patchRoutesOnNavigation`\n      // so we should render down the partial matches to the appropriate\n      // `HydrateFallback`.  We only do this if `parentMatches` is empty so it\n      // only impacts the root matches for `RouterProvider` and no descendant\n      // `<Routes>`\n      matches = dataRouterState.matches;\n    } else {\n      return null;\n    }\n  }\n  let renderedMatches = matches;\n\n  // If we have data errors, trim matches to the highest error boundary\n  let errors = (_dataRouterState = dataRouterState) == null ? void 0 : _dataRouterState.errors;\n  if (errors != null) {\n    let errorIndex = renderedMatches.findIndex(m => m.route.id && (errors == null ? void 0 : errors[m.route.id]) !== undefined);\n    !(errorIndex >= 0) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"Could not find a matching route for errors on route IDs: \" + Object.keys(errors).join(\",\")) : UNSAFE_invariant(false) : void 0;\n    renderedMatches = renderedMatches.slice(0, Math.min(renderedMatches.length, errorIndex + 1));\n  }\n\n  // If we're in a partial hydration mode, detect if we need to render down to\n  // a given HydrateFallback while we load the rest of the hydration data\n  let renderFallback = false;\n  let fallbackIndex = -1;\n  if (dataRouterState && future && future.v7_partialHydration) {\n    for (let i = 0; i < renderedMatches.length; i++) {\n      let match = renderedMatches[i];\n      // Track the deepest fallback up until the first route without data\n      if (match.route.HydrateFallback || match.route.hydrateFallbackElement) {\n        fallbackIndex = i;\n      }\n      if (match.route.id) {\n        let {\n          loaderData,\n          errors\n        } = dataRouterState;\n        let needsToRunLoader = match.route.loader && loaderData[match.route.id] === undefined && (!errors || errors[match.route.id] === undefined);\n        if (match.route.lazy || needsToRunLoader) {\n          // We found the first route that's not ready to render (waiting on\n          // lazy, or has a loader that hasn't run yet).  Flag that we need to\n          // render a fallback and render up until the appropriate fallback\n          renderFallback = true;\n          if (fallbackIndex >= 0) {\n            renderedMatches = renderedMatches.slice(0, fallbackIndex + 1);\n          } else {\n            renderedMatches = [renderedMatches[0]];\n          }\n          break;\n        }\n      }\n    }\n  }\n  return renderedMatches.reduceRight((outlet, match, index) => {\n    // Only data routers handle errors/fallbacks\n    let error;\n    let shouldRenderHydrateFallback = false;\n    let errorElement = null;\n    let hydrateFallbackElement = null;\n    if (dataRouterState) {\n      error = errors && match.route.id ? errors[match.route.id] : undefined;\n      errorElement = match.route.errorElement || defaultErrorElement;\n      if (renderFallback) {\n        if (fallbackIndex < 0 && index === 0) {\n          warningOnce(\"route-fallback\", false, \"No `HydrateFallback` element provided to render during initial hydration\");\n          shouldRenderHydrateFallback = true;\n          hydrateFallbackElement = null;\n        } else if (fallbackIndex === index) {\n          shouldRenderHydrateFallback = true;\n          hydrateFallbackElement = match.route.hydrateFallbackElement || null;\n        }\n      }\n    }\n    let matches = parentMatches.concat(renderedMatches.slice(0, index + 1));\n    let getChildren = () => {\n      let children;\n      if (error) {\n        children = errorElement;\n      } else if (shouldRenderHydrateFallback) {\n        children = hydrateFallbackElement;\n      } else if (match.route.Component) {\n        // Note: This is a de-optimized path since React won't re-use the\n        // ReactElement since it's identity changes with each new\n        // React.createElement call.  We keep this so folks can use\n        // `<Route Component={...}>` in `<Routes>` but generally `Component`\n        // usage is only advised in `RouterProvider` when we can convert it to\n        // `element` ahead of time.\n        children = /*#__PURE__*/React.createElement(match.route.Component, null);\n      } else if (match.route.element) {\n        children = match.route.element;\n      } else {\n        children = outlet;\n      }\n      return /*#__PURE__*/React.createElement(RenderedRoute, {\n        match: match,\n        routeContext: {\n          outlet,\n          matches,\n          isDataRoute: dataRouterState != null\n        },\n        children: children\n      });\n    };\n    // Only wrap in an error boundary within data router usages when we have an\n    // ErrorBoundary/errorElement on this route.  Otherwise let it bubble up to\n    // an ancestor ErrorBoundary/errorElement\n    return dataRouterState && (match.route.ErrorBoundary || match.route.errorElement || index === 0) ? /*#__PURE__*/React.createElement(RenderErrorBoundary, {\n      location: dataRouterState.location,\n      revalidation: dataRouterState.revalidation,\n      component: errorElement,\n      error: error,\n      children: getChildren(),\n      routeContext: {\n        outlet: null,\n        matches,\n        isDataRoute: true\n      }\n    }) : getChildren();\n  }, null);\n}\nvar DataRouterHook = /*#__PURE__*/function (DataRouterHook) {\n  DataRouterHook[\"UseBlocker\"] = \"useBlocker\";\n  DataRouterHook[\"UseRevalidator\"] = \"useRevalidator\";\n  DataRouterHook[\"UseNavigateStable\"] = \"useNavigate\";\n  return DataRouterHook;\n}(DataRouterHook || {});\nvar DataRouterStateHook = /*#__PURE__*/function (DataRouterStateHook) {\n  DataRouterStateHook[\"UseBlocker\"] = \"useBlocker\";\n  DataRouterStateHook[\"UseLoaderData\"] = \"useLoaderData\";\n  DataRouterStateHook[\"UseActionData\"] = \"useActionData\";\n  DataRouterStateHook[\"UseRouteError\"] = \"useRouteError\";\n  DataRouterStateHook[\"UseNavigation\"] = \"useNavigation\";\n  DataRouterStateHook[\"UseRouteLoaderData\"] = \"useRouteLoaderData\";\n  DataRouterStateHook[\"UseMatches\"] = \"useMatches\";\n  DataRouterStateHook[\"UseRevalidator\"] = \"useRevalidator\";\n  DataRouterStateHook[\"UseNavigateStable\"] = \"useNavigate\";\n  DataRouterStateHook[\"UseRouteId\"] = \"useRouteId\";\n  return DataRouterStateHook;\n}(DataRouterStateHook || {});\nfunction getDataRouterConsoleError(hookName) {\n  return hookName + \" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router.\";\n}\nfunction useDataRouterContext(hookName) {\n  let ctx = React.useContext(DataRouterContext);\n  !ctx ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return ctx;\n}\nfunction useDataRouterState(hookName) {\n  let state = React.useContext(DataRouterStateContext);\n  !state ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return state;\n}\nfunction useRouteContext(hookName) {\n  let route = React.useContext(RouteContext);\n  !route ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return route;\n}\n\n// Internal version with hookName-aware debugging\nfunction useCurrentRouteId(hookName) {\n  let route = useRouteContext(hookName);\n  let thisRoute = route.matches[route.matches.length - 1];\n  !thisRoute.route.id ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, hookName + \" can only be used on routes that contain a unique \\\"id\\\"\") : UNSAFE_invariant(false) : void 0;\n  return thisRoute.route.id;\n}\n\n/**\n * Returns the ID for the nearest contextual route\n */\nfunction useRouteId() {\n  return useCurrentRouteId(DataRouterStateHook.UseRouteId);\n}\n\n/**\n * Returns the current navigation, defaulting to an \"idle\" navigation when\n * no navigation is in progress\n */\nfunction useNavigation() {\n  let state = useDataRouterState(DataRouterStateHook.UseNavigation);\n  return state.navigation;\n}\n\n/**\n * Returns a revalidate function for manually triggering revalidation, as well\n * as the current state of any manual revalidations\n */\nfunction useRevalidator() {\n  let dataRouterContext = useDataRouterContext(DataRouterHook.UseRevalidator);\n  let state = useDataRouterState(DataRouterStateHook.UseRevalidator);\n  return React.useMemo(() => ({\n    revalidate: dataRouterContext.router.revalidate,\n    state: state.revalidation\n  }), [dataRouterContext.router.revalidate, state.revalidation]);\n}\n\n/**\n * Returns the active route matches, useful for accessing loaderData for\n * parent/child routes or the route \"handle\" property\n */\nfunction useMatches() {\n  let {\n    matches,\n    loaderData\n  } = useDataRouterState(DataRouterStateHook.UseMatches);\n  return React.useMemo(() => matches.map(m => UNSAFE_convertRouteMatchToUiMatch(m, loaderData)), [matches, loaderData]);\n}\n\n/**\n * Returns the loader data for the nearest ancestor Route loader\n */\nfunction useLoaderData() {\n  let state = useDataRouterState(DataRouterStateHook.UseLoaderData);\n  let routeId = useCurrentRouteId(DataRouterStateHook.UseLoaderData);\n  if (state.errors && state.errors[routeId] != null) {\n    console.error(\"You cannot `useLoaderData` in an errorElement (routeId: \" + routeId + \")\");\n    return undefined;\n  }\n  return state.loaderData[routeId];\n}\n\n/**\n * Returns the loaderData for the given routeId\n */\nfunction useRouteLoaderData(routeId) {\n  let state = useDataRouterState(DataRouterStateHook.UseRouteLoaderData);\n  return state.loaderData[routeId];\n}\n\n/**\n * Returns the action data for the nearest ancestor Route action\n */\nfunction useActionData() {\n  let state = useDataRouterState(DataRouterStateHook.UseActionData);\n  let routeId = useCurrentRouteId(DataRouterStateHook.UseLoaderData);\n  return state.actionData ? state.actionData[routeId] : undefined;\n}\n\n/**\n * Returns the nearest ancestor Route error, which could be a loader/action\n * error or a render error.  This is intended to be called from your\n * ErrorBoundary/errorElement to display a proper error message.\n */\nfunction useRouteError() {\n  var _state$errors;\n  let error = React.useContext(RouteErrorContext);\n  let state = useDataRouterState(DataRouterStateHook.UseRouteError);\n  let routeId = useCurrentRouteId(DataRouterStateHook.UseRouteError);\n\n  // If this was a render error, we put it in a RouteError context inside\n  // of RenderErrorBoundary\n  if (error !== undefined) {\n    return error;\n  }\n\n  // Otherwise look for errors from our data router state\n  return (_state$errors = state.errors) == null ? void 0 : _state$errors[routeId];\n}\n\n/**\n * Returns the happy-path data from the nearest ancestor `<Await />` value\n */\nfunction useAsyncValue() {\n  let value = React.useContext(AwaitContext);\n  return value == null ? void 0 : value._data;\n}\n\n/**\n * Returns the error from the nearest ancestor `<Await />` value\n */\nfunction useAsyncError() {\n  let value = React.useContext(AwaitContext);\n  return value == null ? void 0 : value._error;\n}\nlet blockerId = 0;\n\n/**\n * Allow the application to block navigations within the SPA and present the\n * user a confirmation dialog to confirm the navigation.  Mostly used to avoid\n * using half-filled form data.  This does not handle hard-reloads or\n * cross-origin navigations.\n */\nfunction useBlocker(shouldBlock) {\n  let {\n    router,\n    basename\n  } = useDataRouterContext(DataRouterHook.UseBlocker);\n  let state = useDataRouterState(DataRouterStateHook.UseBlocker);\n  let [blockerKey, setBlockerKey] = React.useState(\"\");\n  let blockerFunction = React.useCallback(arg => {\n    if (typeof shouldBlock !== \"function\") {\n      return !!shouldBlock;\n    }\n    if (basename === \"/\") {\n      return shouldBlock(arg);\n    }\n\n    // If they provided us a function and we've got an active basename, strip\n    // it from the locations we expose to the user to match the behavior of\n    // useLocation\n    let {\n      currentLocation,\n      nextLocation,\n      historyAction\n    } = arg;\n    return shouldBlock({\n      currentLocation: _extends({}, currentLocation, {\n        pathname: stripBasename(currentLocation.pathname, basename) || currentLocation.pathname\n      }),\n      nextLocation: _extends({}, nextLocation, {\n        pathname: stripBasename(nextLocation.pathname, basename) || nextLocation.pathname\n      }),\n      historyAction\n    });\n  }, [basename, shouldBlock]);\n\n  // This effect is in charge of blocker key assignment and deletion (which is\n  // tightly coupled to the key)\n  React.useEffect(() => {\n    let key = String(++blockerId);\n    setBlockerKey(key);\n    return () => router.deleteBlocker(key);\n  }, [router]);\n\n  // This effect handles assigning the blockerFunction.  This is to handle\n  // unstable blocker function identities, and happens only after the prior\n  // effect so we don't get an orphaned blockerFunction in the router with a\n  // key of \"\".  Until then we just have the IDLE_BLOCKER.\n  React.useEffect(() => {\n    if (blockerKey !== \"\") {\n      router.getBlocker(blockerKey, blockerFunction);\n    }\n  }, [router, blockerKey, blockerFunction]);\n\n  // Prefer the blocker from `state` not `router.state` since DataRouterContext\n  // is memoized so this ensures we update on blocker state updates\n  return blockerKey && state.blockers.has(blockerKey) ? state.blockers.get(blockerKey) : IDLE_BLOCKER;\n}\n\n/**\n * Stable version of useNavigate that is used when we are in the context of\n * a RouterProvider.\n */\nfunction useNavigateStable() {\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseNavigateStable);\n  let id = useCurrentRouteId(DataRouterStateHook.UseNavigateStable);\n  let activeRef = React.useRef(false);\n  useIsomorphicLayoutEffect(() => {\n    activeRef.current = true;\n  });\n  let navigate = React.useCallback(function (to, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(activeRef.current, navigateEffectWarning) : void 0;\n\n    // Short circuit here since if this happens on first render the navigate\n    // is useless because we haven't wired up our router subscriber yet\n    if (!activeRef.current) return;\n    if (typeof to === \"number\") {\n      router.navigate(to);\n    } else {\n      router.navigate(to, _extends({\n        fromRouteId: id\n      }, options));\n    }\n  }, [router, id]);\n  return navigate;\n}\nconst alreadyWarned$1 = {};\nfunction warningOnce(key, cond, message) {\n  if (!cond && !alreadyWarned$1[key]) {\n    alreadyWarned$1[key] = true;\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, message) : void 0;\n  }\n}\n\nconst alreadyWarned = {};\nfunction warnOnce(key, message) {\n  if (process.env.NODE_ENV !== \"production\" && !alreadyWarned[message]) {\n    alreadyWarned[message] = true;\n    console.warn(message);\n  }\n}\nconst logDeprecation = (flag, msg, link) => warnOnce(flag, \"\\u26A0\\uFE0F React Router Future Flag Warning: \" + msg + \". \" + (\"You can use the `\" + flag + \"` future flag to opt-in early. \") + (\"For more information, see \" + link + \".\"));\nfunction logV6DeprecationWarnings(renderFuture, routerFuture) {\n  if ((renderFuture == null ? void 0 : renderFuture.v7_startTransition) === undefined) {\n    logDeprecation(\"v7_startTransition\", \"React Router will begin wrapping state updates in `React.startTransition` in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_starttransition\");\n  }\n  if ((renderFuture == null ? void 0 : renderFuture.v7_relativeSplatPath) === undefined && (!routerFuture || routerFuture.v7_relativeSplatPath === undefined)) {\n    logDeprecation(\"v7_relativeSplatPath\", \"Relative route resolution within Splat routes is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath\");\n  }\n  if (routerFuture) {\n    if (routerFuture.v7_fetcherPersist === undefined) {\n      logDeprecation(\"v7_fetcherPersist\", \"The persistence behavior of fetchers is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist\");\n    }\n    if (routerFuture.v7_normalizeFormMethod === undefined) {\n      logDeprecation(\"v7_normalizeFormMethod\", \"Casing of `formMethod` fields is being normalized to uppercase in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod\");\n    }\n    if (routerFuture.v7_partialHydration === undefined) {\n      logDeprecation(\"v7_partialHydration\", \"`RouterProvider` hydration behavior is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_partialhydration\");\n    }\n    if (routerFuture.v7_skipActionErrorRevalidation === undefined) {\n      logDeprecation(\"v7_skipActionErrorRevalidation\", \"The revalidation behavior after 4xx/5xx `action` responses is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation\");\n    }\n  }\n}\n\n/**\n  Webpack + React 17 fails to compile on any of the following because webpack\n  complains that `startTransition` doesn't exist in `React`:\n  * import { startTransition } from \"react\"\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React.startTransition(() => setState()) : setState()\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React[\"startTransition\"](() => setState()) : setState()\n\n  Moving it to a constant such as the following solves the Webpack/React 17 issue:\n  * import * as React from from \"react\";\n    const START_TRANSITION = \"startTransition\";\n    START_TRANSITION in React ? React[START_TRANSITION](() => setState()) : setState()\n\n  However, that introduces webpack/terser minification issues in production builds\n  in React 18 where minification/obfuscation ends up removing the call of\n  React.startTransition entirely from the first half of the ternary.  Grabbing\n  this exported reference once up front resolves that issue.\n\n  See https://github.com/remix-run/react-router/issues/10579\n*/\nconst START_TRANSITION = \"startTransition\";\nconst startTransitionImpl = React[START_TRANSITION];\n\n/**\n * Given a Remix Router instance, render the appropriate UI\n */\nfunction RouterProvider(_ref) {\n  let {\n    fallbackElement,\n    router,\n    future\n  } = _ref;\n  let [state, setStateImpl] = React.useState(router.state);\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    if (v7_startTransition && startTransitionImpl) {\n      startTransitionImpl(() => setStateImpl(newState));\n    } else {\n      setStateImpl(newState);\n    }\n  }, [setStateImpl, v7_startTransition]);\n\n  // Need to use a layout effect here so we are subscribed early enough to\n  // pick up on any render-driven redirects/navigations (useEffect/<Navigate>)\n  React.useLayoutEffect(() => router.subscribe(setState), [router, setState]);\n  React.useEffect(() => {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(fallbackElement == null || !router.future.v7_partialHydration, \"`<RouterProvider fallbackElement>` is deprecated when using \" + \"`v7_partialHydration`, use a `HydrateFallback` component instead\") : void 0;\n    // Only log this once on initial mount\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  let navigator = React.useMemo(() => {\n    return {\n      createHref: router.createHref,\n      encodeLocation: router.encodeLocation,\n      go: n => router.navigate(n),\n      push: (to, state, opts) => router.navigate(to, {\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      }),\n      replace: (to, state, opts) => router.navigate(to, {\n        replace: true,\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      })\n    };\n  }, [router]);\n  let basename = router.basename || \"/\";\n  let dataRouterContext = React.useMemo(() => ({\n    router,\n    navigator,\n    static: false,\n    basename\n  }), [router, navigator, basename]);\n  React.useEffect(() => logV6DeprecationWarnings(future, router.future), [router, future]);\n\n  // The fragment and {null} here are important!  We need them to keep React 18's\n  // useId happy when we are server-rendering since we may have a <script> here\n  // containing the hydrated server-side staticContext (from StaticRouterProvider).\n  // useId relies on the component tree structure to generate deterministic id's\n  // so we need to ensure it remains the same on the client even though\n  // we don't need the <script> tag\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(DataRouterContext.Provider, {\n    value: dataRouterContext\n  }, /*#__PURE__*/React.createElement(DataRouterStateContext.Provider, {\n    value: state\n  }, /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    location: state.location,\n    navigationType: state.historyAction,\n    navigator: navigator,\n    future: {\n      v7_relativeSplatPath: router.future.v7_relativeSplatPath\n    }\n  }, state.initialized || router.future.v7_partialHydration ? /*#__PURE__*/React.createElement(DataRoutes, {\n    routes: router.routes,\n    future: router.future,\n    state: state\n  }) : fallbackElement))), null);\n}\nfunction DataRoutes(_ref2) {\n  let {\n    routes,\n    future,\n    state\n  } = _ref2;\n  return useRoutesImpl(routes, undefined, state, future);\n}\n/**\n * A `<Router>` that stores all entries in memory.\n *\n * @see https://reactrouter.com/v6/router-components/memory-router\n */\nfunction MemoryRouter(_ref3) {\n  let {\n    basename,\n    children,\n    initialEntries,\n    initialIndex,\n    future\n  } = _ref3;\n  let historyRef = React.useRef();\n  if (historyRef.current == null) {\n    historyRef.current = createMemoryHistory({\n      initialEntries,\n      initialIndex,\n      v5Compat: true\n    });\n  }\n  let history = historyRef.current;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\n/**\n * Changes the current location.\n *\n * Note: This API is mostly useful in React.Component subclasses that are not\n * able to use hooks. In functional components, we recommend you use the\n * `useNavigate` hook instead.\n *\n * @see https://reactrouter.com/v6/components/navigate\n */\nfunction Navigate(_ref4) {\n  let {\n    to,\n    replace,\n    state,\n    relative\n  } = _ref4;\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of\n  // the router loaded. We can help them understand how to avoid that.\n  \"<Navigate> may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    future,\n    static: isStatic\n  } = React.useContext(NavigationContext);\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(!isStatic, \"<Navigate> must not be used on the initial render in a <StaticRouter>. \" + \"This is a no-op, but you should modify your code so the <Navigate> is \" + \"only ever rendered in response to some user interaction or state change.\") : void 0;\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let navigate = useNavigate();\n\n  // Resolve the path outside of the effect so that when effects run twice in\n  // StrictMode they navigate to the same place\n  let path = resolveTo(to, UNSAFE_getResolveToMatches(matches, future.v7_relativeSplatPath), locationPathname, relative === \"path\");\n  let jsonPath = JSON.stringify(path);\n  React.useEffect(() => navigate(JSON.parse(jsonPath), {\n    replace,\n    state,\n    relative\n  }), [navigate, jsonPath, relative, replace, state]);\n  return null;\n}\n/**\n * Renders the child route's element, if there is one.\n *\n * @see https://reactrouter.com/v6/components/outlet\n */\nfunction Outlet(props) {\n  return useOutlet(props.context);\n}\n/**\n * Declares an element that should be rendered at a certain URL path.\n *\n * @see https://reactrouter.com/v6/components/route\n */\nfunction Route(_props) {\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"A <Route> is only ever to be used as the child of <Routes> element, \" + \"never rendered directly. Please wrap your <Route> in a <Routes>.\") : UNSAFE_invariant(false) ;\n}\n/**\n * Provides location context for the rest of the app.\n *\n * Note: You usually won't render a `<Router>` directly. Instead, you'll render a\n * router that is more specific to your environment such as a `<BrowserRouter>`\n * in web browsers or a `<StaticRouter>` for server rendering.\n *\n * @see https://reactrouter.com/v6/router-components/router\n */\nfunction Router(_ref5) {\n  let {\n    basename: basenameProp = \"/\",\n    children = null,\n    location: locationProp,\n    navigationType = Action.Pop,\n    navigator,\n    static: staticProp = false,\n    future\n  } = _ref5;\n  !!useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"You cannot render a <Router> inside another <Router>.\" + \" You should never have more than one in your app.\") : UNSAFE_invariant(false) : void 0;\n\n  // Preserve trailing slashes on basename, so we can let the user control\n  // the enforcement of trailing slashes throughout the app\n  let basename = basenameProp.replace(/^\\/*/, \"/\");\n  let navigationContext = React.useMemo(() => ({\n    basename,\n    navigator,\n    static: staticProp,\n    future: _extends({\n      v7_relativeSplatPath: false\n    }, future)\n  }), [basename, future, navigator, staticProp]);\n  if (typeof locationProp === \"string\") {\n    locationProp = parsePath(locationProp);\n  }\n  let {\n    pathname = \"/\",\n    search = \"\",\n    hash = \"\",\n    state = null,\n    key = \"default\"\n  } = locationProp;\n  let locationContext = React.useMemo(() => {\n    let trailingPathname = stripBasename(pathname, basename);\n    if (trailingPathname == null) {\n      return null;\n    }\n    return {\n      location: {\n        pathname: trailingPathname,\n        search,\n        hash,\n        state,\n        key\n      },\n      navigationType\n    };\n  }, [basename, pathname, search, hash, state, key, navigationType]);\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(locationContext != null, \"<Router basename=\\\"\" + basename + \"\\\"> is not able to match the URL \" + (\"\\\"\" + pathname + search + hash + \"\\\" because it does not start with the \") + \"basename, so the <Router> won't render anything.\") : void 0;\n  if (locationContext == null) {\n    return null;\n  }\n  return /*#__PURE__*/React.createElement(NavigationContext.Provider, {\n    value: navigationContext\n  }, /*#__PURE__*/React.createElement(LocationContext.Provider, {\n    children: children,\n    value: locationContext\n  }));\n}\n/**\n * A container for a nested tree of `<Route>` elements that renders the branch\n * that best matches the current location.\n *\n * @see https://reactrouter.com/v6/components/routes\n */\nfunction Routes(_ref6) {\n  let {\n    children,\n    location\n  } = _ref6;\n  return useRoutes(createRoutesFromChildren(children), location);\n}\n/**\n * Component to use for rendering lazily loaded data from returning defer()\n * in a loader function\n */\nfunction Await(_ref7) {\n  let {\n    children,\n    errorElement,\n    resolve\n  } = _ref7;\n  return /*#__PURE__*/React.createElement(AwaitErrorBoundary, {\n    resolve: resolve,\n    errorElement: errorElement\n  }, /*#__PURE__*/React.createElement(ResolveAwait, null, children));\n}\nvar AwaitRenderStatus = /*#__PURE__*/function (AwaitRenderStatus) {\n  AwaitRenderStatus[AwaitRenderStatus[\"pending\"] = 0] = \"pending\";\n  AwaitRenderStatus[AwaitRenderStatus[\"success\"] = 1] = \"success\";\n  AwaitRenderStatus[AwaitRenderStatus[\"error\"] = 2] = \"error\";\n  return AwaitRenderStatus;\n}(AwaitRenderStatus || {});\nconst neverSettledPromise = new Promise(() => {});\nclass AwaitErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      error: null\n    };\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      error\n    };\n  }\n  componentDidCatch(error, errorInfo) {\n    console.error(\"<Await> caught the following error during render\", error, errorInfo);\n  }\n  render() {\n    let {\n      children,\n      errorElement,\n      resolve\n    } = this.props;\n    let promise = null;\n    let status = AwaitRenderStatus.pending;\n    if (!(resolve instanceof Promise)) {\n      // Didn't get a promise - provide as a resolved promise\n      status = AwaitRenderStatus.success;\n      promise = Promise.resolve();\n      Object.defineProperty(promise, \"_tracked\", {\n        get: () => true\n      });\n      Object.defineProperty(promise, \"_data\", {\n        get: () => resolve\n      });\n    } else if (this.state.error) {\n      // Caught a render error, provide it as a rejected promise\n      status = AwaitRenderStatus.error;\n      let renderError = this.state.error;\n      promise = Promise.reject().catch(() => {}); // Avoid unhandled rejection warnings\n      Object.defineProperty(promise, \"_tracked\", {\n        get: () => true\n      });\n      Object.defineProperty(promise, \"_error\", {\n        get: () => renderError\n      });\n    } else if (resolve._tracked) {\n      // Already tracked promise - check contents\n      promise = resolve;\n      status = \"_error\" in promise ? AwaitRenderStatus.error : \"_data\" in promise ? AwaitRenderStatus.success : AwaitRenderStatus.pending;\n    } else {\n      // Raw (untracked) promise - track it\n      status = AwaitRenderStatus.pending;\n      Object.defineProperty(resolve, \"_tracked\", {\n        get: () => true\n      });\n      promise = resolve.then(data => Object.defineProperty(resolve, \"_data\", {\n        get: () => data\n      }), error => Object.defineProperty(resolve, \"_error\", {\n        get: () => error\n      }));\n    }\n    if (status === AwaitRenderStatus.error && promise._error instanceof AbortedDeferredError) {\n      // Freeze the UI by throwing a never resolved promise\n      throw neverSettledPromise;\n    }\n    if (status === AwaitRenderStatus.error && !errorElement) {\n      // No errorElement, throw to the nearest route-level error boundary\n      throw promise._error;\n    }\n    if (status === AwaitRenderStatus.error) {\n      // Render via our errorElement\n      return /*#__PURE__*/React.createElement(AwaitContext.Provider, {\n        value: promise,\n        children: errorElement\n      });\n    }\n    if (status === AwaitRenderStatus.success) {\n      // Render children with resolved value\n      return /*#__PURE__*/React.createElement(AwaitContext.Provider, {\n        value: promise,\n        children: children\n      });\n    }\n\n    // Throw to the suspense boundary\n    throw promise;\n  }\n}\n\n/**\n * @private\n * Indirection to leverage useAsyncValue for a render-prop API on `<Await>`\n */\nfunction ResolveAwait(_ref8) {\n  let {\n    children\n  } = _ref8;\n  let data = useAsyncValue();\n  let toRender = typeof children === \"function\" ? children(data) : children;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, toRender);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n// UTILS\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Creates a route config from a React \"children\" object, which is usually\n * either a `<Route>` element or an array of them. Used internally by\n * `<Routes>` to create a route config from its children.\n *\n * @see https://reactrouter.com/v6/utils/create-routes-from-children\n */\nfunction createRoutesFromChildren(children, parentPath) {\n  if (parentPath === void 0) {\n    parentPath = [];\n  }\n  let routes = [];\n  React.Children.forEach(children, (element, index) => {\n    if (! /*#__PURE__*/React.isValidElement(element)) {\n      // Ignore non-elements. This allows people to more easily inline\n      // conditionals in their route config.\n      return;\n    }\n    let treePath = [...parentPath, index];\n    if (element.type === React.Fragment) {\n      // Transparently support React.Fragment and its children.\n      routes.push.apply(routes, createRoutesFromChildren(element.props.children, treePath));\n      return;\n    }\n    !(element.type === Route) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"[\" + (typeof element.type === \"string\" ? element.type : element.type.name) + \"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>\") : UNSAFE_invariant(false) : void 0;\n    !(!element.props.index || !element.props.children) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"An index route cannot have child routes.\") : UNSAFE_invariant(false) : void 0;\n    let route = {\n      id: element.props.id || treePath.join(\"-\"),\n      caseSensitive: element.props.caseSensitive,\n      element: element.props.element,\n      Component: element.props.Component,\n      index: element.props.index,\n      path: element.props.path,\n      loader: element.props.loader,\n      action: element.props.action,\n      errorElement: element.props.errorElement,\n      ErrorBoundary: element.props.ErrorBoundary,\n      hasErrorBoundary: element.props.ErrorBoundary != null || element.props.errorElement != null,\n      shouldRevalidate: element.props.shouldRevalidate,\n      handle: element.props.handle,\n      lazy: element.props.lazy\n    };\n    if (element.props.children) {\n      route.children = createRoutesFromChildren(element.props.children, treePath);\n    }\n    routes.push(route);\n  });\n  return routes;\n}\n\n/**\n * Renders the result of `matchRoutes()` into a React element.\n */\nfunction renderMatches(matches) {\n  return _renderMatches(matches);\n}\n\nfunction mapRouteProperties(route) {\n  let updates = {\n    // Note: this check also occurs in createRoutesFromChildren so update\n    // there if you change this -- please and thank you!\n    hasErrorBoundary: route.ErrorBoundary != null || route.errorElement != null\n  };\n  if (route.Component) {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (route.element) {\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"You should not include both `Component` and `element` on your route - \" + \"`Component` will be used.\") : void 0;\n      }\n    }\n    Object.assign(updates, {\n      element: /*#__PURE__*/React.createElement(route.Component),\n      Component: undefined\n    });\n  }\n  if (route.HydrateFallback) {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (route.hydrateFallbackElement) {\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - \" + \"`HydrateFallback` will be used.\") : void 0;\n      }\n    }\n    Object.assign(updates, {\n      hydrateFallbackElement: /*#__PURE__*/React.createElement(route.HydrateFallback),\n      HydrateFallback: undefined\n    });\n  }\n  if (route.ErrorBoundary) {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (route.errorElement) {\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"You should not include both `ErrorBoundary` and `errorElement` on your route - \" + \"`ErrorBoundary` will be used.\") : void 0;\n      }\n    }\n    Object.assign(updates, {\n      errorElement: /*#__PURE__*/React.createElement(route.ErrorBoundary),\n      ErrorBoundary: undefined\n    });\n  }\n  return updates;\n}\nfunction createMemoryRouter(routes, opts) {\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    future: _extends({}, opts == null ? void 0 : opts.future, {\n      v7_prependBasename: true\n    }),\n    history: createMemoryHistory({\n      initialEntries: opts == null ? void 0 : opts.initialEntries,\n      initialIndex: opts == null ? void 0 : opts.initialIndex\n    }),\n    hydrationData: opts == null ? void 0 : opts.hydrationData,\n    routes,\n    mapRouteProperties,\n    dataStrategy: opts == null ? void 0 : opts.dataStrategy,\n    patchRoutesOnNavigation: opts == null ? void 0 : opts.patchRoutesOnNavigation\n  }).initialize();\n}\n\nexport { Await, MemoryRouter, Navigate, Outlet, Route, Router, RouterProvider, Routes, DataRouterContext as UNSAFE_DataRouterContext, DataRouterStateContext as UNSAFE_DataRouterStateContext, LocationContext as UNSAFE_LocationContext, NavigationContext as UNSAFE_NavigationContext, RouteContext as UNSAFE_RouteContext, logV6DeprecationWarnings as UNSAFE_logV6DeprecationWarnings, mapRouteProperties as UNSAFE_mapRouteProperties, useRouteId as UNSAFE_useRouteId, useRoutesImpl as UNSAFE_useRoutesImpl, createMemoryRouter, createRoutesFromChildren, createRoutesFromChildren as createRoutesFromElements, renderMatches, useActionData, useAsyncError, useAsyncValue, useBlocker, useHref, useInRouterContext, useLoaderData, useLocation, useMatch, useMatches, useNavigate, useNavigation, useNavigationType, useOutlet, useOutletContext, useParams, useResolvedPath, useRevalidator, useRouteError, useRouteLoaderData, useRoutes };\n//# sourceMappingURL=index.js.map\n","/**\n * React Router DOM v6.30.1\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { UNSAFE_mapRouteProperties, UNSAFE_logV6DeprecationWarnings, UNSAFE_DataRouterContext, UNSAFE_DataRouterStateContext, Router, UNSAFE_useRoutesImpl, UNSAFE_NavigationContext, useHref, useResolvedPath, useLocation, useNavigate, createPath, UNSAFE_useRouteId, UNSAFE_RouteContext, useMatches, useNavigation, useBlocker } from 'react-router';\nexport { AbortedDeferredError, Await, MemoryRouter, Navigate, NavigationType, Outlet, Route, Router, Routes, UNSAFE_DataRouterContext, UNSAFE_DataRouterStateContext, UNSAFE_LocationContext, UNSAFE_NavigationContext, UNSAFE_RouteContext, UNSAFE_useRouteId, createMemoryRouter, createPath, createRoutesFromChildren, createRoutesFromElements, defer, generatePath, isRouteErrorResponse, json, matchPath, matchRoutes, parsePath, redirect, redirectDocument, renderMatches, replace, resolvePath, useActionData, useAsyncError, useAsyncValue, useBlocker, useHref, useInRouterContext, useLoaderData, useLocation, useMatch, useMatches, useNavigate, useNavigation, useNavigationType, useOutlet, useOutletContext, useParams, useResolvedPath, useRevalidator, useRouteError, useRouteLoaderData, useRoutes } from 'react-router';\nimport { stripBasename, UNSAFE_warning, createRouter, createBrowserHistory, createHashHistory, UNSAFE_ErrorResponseImpl, UNSAFE_invariant, joinPaths, IDLE_FETCHER, matchPath } from '@remix-run/router';\nexport { UNSAFE_ErrorResponseImpl } from '@remix-run/router';\n\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\n\nconst defaultMethod = \"get\";\nconst defaultEncType = \"application/x-www-form-urlencoded\";\nfunction isHtmlElement(object) {\n  return object != null && typeof object.tagName === \"string\";\n}\nfunction isButtonElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"button\";\n}\nfunction isFormElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"form\";\n}\nfunction isInputElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"input\";\n}\nfunction isModifiedEvent(event) {\n  return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);\n}\nfunction shouldProcessLinkClick(event, target) {\n  return event.button === 0 && (\n  // Ignore everything but left clicks\n  !target || target === \"_self\") &&\n  // Let browser handle \"target=_blank\" etc.\n  !isModifiedEvent(event) // Ignore clicks with modifier keys\n  ;\n}\n/**\n * Creates a URLSearchParams object using the given initializer.\n *\n * This is identical to `new URLSearchParams(init)` except it also\n * supports arrays as values in the object form of the initializer\n * instead of just strings. This is convenient when you need multiple\n * values for a given key, but don't want to use an array initializer.\n *\n * For example, instead of:\n *\n *   let searchParams = new URLSearchParams([\n *     ['sort', 'name'],\n *     ['sort', 'price']\n *   ]);\n *\n * you can do:\n *\n *   let searchParams = createSearchParams({\n *     sort: ['name', 'price']\n *   });\n */\nfunction createSearchParams(init) {\n  if (init === void 0) {\n    init = \"\";\n  }\n  return new URLSearchParams(typeof init === \"string\" || Array.isArray(init) || init instanceof URLSearchParams ? init : Object.keys(init).reduce((memo, key) => {\n    let value = init[key];\n    return memo.concat(Array.isArray(value) ? value.map(v => [key, v]) : [[key, value]]);\n  }, []));\n}\nfunction getSearchParamsForLocation(locationSearch, defaultSearchParams) {\n  let searchParams = createSearchParams(locationSearch);\n  if (defaultSearchParams) {\n    // Use `defaultSearchParams.forEach(...)` here instead of iterating of\n    // `defaultSearchParams.keys()` to work-around a bug in Firefox related to\n    // web extensions. Relevant Bugzilla tickets:\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1414602\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1023984\n    defaultSearchParams.forEach((_, key) => {\n      if (!searchParams.has(key)) {\n        defaultSearchParams.getAll(key).forEach(value => {\n          searchParams.append(key, value);\n        });\n      }\n    });\n  }\n  return searchParams;\n}\n// One-time check for submitter support\nlet _formDataSupportsSubmitter = null;\nfunction isFormDataSubmitterSupported() {\n  if (_formDataSupportsSubmitter === null) {\n    try {\n      new FormData(document.createElement(\"form\"),\n      // @ts-expect-error if FormData supports the submitter parameter, this will throw\n      0);\n      _formDataSupportsSubmitter = false;\n    } catch (e) {\n      _formDataSupportsSubmitter = true;\n    }\n  }\n  return _formDataSupportsSubmitter;\n}\nconst supportedFormEncTypes = new Set([\"application/x-www-form-urlencoded\", \"multipart/form-data\", \"text/plain\"]);\nfunction getFormEncType(encType) {\n  if (encType != null && !supportedFormEncTypes.has(encType)) {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"\\\"\" + encType + \"\\\" is not a valid `encType` for `<Form>`/`<fetcher.Form>` \" + (\"and will default to \\\"\" + defaultEncType + \"\\\"\")) : void 0;\n    return null;\n  }\n  return encType;\n}\nfunction getFormSubmissionInfo(target, basename) {\n  let method;\n  let action;\n  let encType;\n  let formData;\n  let body;\n  if (isFormElement(target)) {\n    // When grabbing the action from the element, it will have had the basename\n    // prefixed to ensure non-JS scenarios work, so strip it since we'll\n    // re-prefix in the router\n    let attr = target.getAttribute(\"action\");\n    action = attr ? stripBasename(attr, basename) : null;\n    method = target.getAttribute(\"method\") || defaultMethod;\n    encType = getFormEncType(target.getAttribute(\"enctype\")) || defaultEncType;\n    formData = new FormData(target);\n  } else if (isButtonElement(target) || isInputElement(target) && (target.type === \"submit\" || target.type === \"image\")) {\n    let form = target.form;\n    if (form == null) {\n      throw new Error(\"Cannot submit a <button> or <input type=\\\"submit\\\"> without a <form>\");\n    }\n    // <button>/<input type=\"submit\"> may override attributes of <form>\n    // When grabbing the action from the element, it will have had the basename\n    // prefixed to ensure non-JS scenarios work, so strip it since we'll\n    // re-prefix in the router\n    let attr = target.getAttribute(\"formaction\") || form.getAttribute(\"action\");\n    action = attr ? stripBasename(attr, basename) : null;\n    method = target.getAttribute(\"formmethod\") || form.getAttribute(\"method\") || defaultMethod;\n    encType = getFormEncType(target.getAttribute(\"formenctype\")) || getFormEncType(form.getAttribute(\"enctype\")) || defaultEncType;\n    // Build a FormData object populated from a form and submitter\n    formData = new FormData(form, target);\n    // If this browser doesn't support the `FormData(el, submitter)` format,\n    // then tack on the submitter value at the end.  This is a lightweight\n    // solution that is not 100% spec compliant.  For complete support in older\n    // browsers, consider using the `formdata-submitter-polyfill` package\n    if (!isFormDataSubmitterSupported()) {\n      let {\n        name,\n        type,\n        value\n      } = target;\n      if (type === \"image\") {\n        let prefix = name ? name + \".\" : \"\";\n        formData.append(prefix + \"x\", \"0\");\n        formData.append(prefix + \"y\", \"0\");\n      } else if (name) {\n        formData.append(name, value);\n      }\n    }\n  } else if (isHtmlElement(target)) {\n    throw new Error(\"Cannot submit element that is not <form>, <button>, or \" + \"<input type=\\\"submit|image\\\">\");\n  } else {\n    method = defaultMethod;\n    action = null;\n    encType = defaultEncType;\n    body = target;\n  }\n  // Send body for <Form encType=\"text/plain\" so we encode it into text\n  if (formData && encType === \"text/plain\") {\n    body = formData;\n    formData = undefined;\n  }\n  return {\n    action,\n    method: method.toLowerCase(),\n    encType,\n    formData,\n    body\n  };\n}\n\nconst _excluded = [\"onClick\", \"relative\", \"reloadDocument\", \"replace\", \"state\", \"target\", \"to\", \"preventScrollReset\", \"viewTransition\"],\n  _excluded2 = [\"aria-current\", \"caseSensitive\", \"className\", \"end\", \"style\", \"to\", \"viewTransition\", \"children\"],\n  _excluded3 = [\"fetcherKey\", \"navigate\", \"reloadDocument\", \"replace\", \"state\", \"method\", \"action\", \"onSubmit\", \"relative\", \"preventScrollReset\", \"viewTransition\"];\n// HEY YOU! DON'T TOUCH THIS VARIABLE!\n//\n// It is replaced with the proper version at build time via a babel plugin in\n// the rollup config.\n//\n// Export a global property onto the window for React Router detection by the\n// Core Web Vitals Technology Report.  This way they can configure the `wappalyzer`\n// to detect and properly classify live websites as being built with React Router:\n// https://github.com/HTTPArchive/wappalyzer/blob/main/src/technologies/r.json\nconst REACT_ROUTER_VERSION = \"6\";\ntry {\n  window.__reactRouterVersion = REACT_ROUTER_VERSION;\n} catch (e) {\n  // no-op\n}\nfunction createBrowserRouter(routes, opts) {\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    future: _extends({}, opts == null ? void 0 : opts.future, {\n      v7_prependBasename: true\n    }),\n    history: createBrowserHistory({\n      window: opts == null ? void 0 : opts.window\n    }),\n    hydrationData: (opts == null ? void 0 : opts.hydrationData) || parseHydrationData(),\n    routes,\n    mapRouteProperties: UNSAFE_mapRouteProperties,\n    dataStrategy: opts == null ? void 0 : opts.dataStrategy,\n    patchRoutesOnNavigation: opts == null ? void 0 : opts.patchRoutesOnNavigation,\n    window: opts == null ? void 0 : opts.window\n  }).initialize();\n}\nfunction createHashRouter(routes, opts) {\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    future: _extends({}, opts == null ? void 0 : opts.future, {\n      v7_prependBasename: true\n    }),\n    history: createHashHistory({\n      window: opts == null ? void 0 : opts.window\n    }),\n    hydrationData: (opts == null ? void 0 : opts.hydrationData) || parseHydrationData(),\n    routes,\n    mapRouteProperties: UNSAFE_mapRouteProperties,\n    dataStrategy: opts == null ? void 0 : opts.dataStrategy,\n    patchRoutesOnNavigation: opts == null ? void 0 : opts.patchRoutesOnNavigation,\n    window: opts == null ? void 0 : opts.window\n  }).initialize();\n}\nfunction parseHydrationData() {\n  var _window;\n  let state = (_window = window) == null ? void 0 : _window.__staticRouterHydrationData;\n  if (state && state.errors) {\n    state = _extends({}, state, {\n      errors: deserializeErrors(state.errors)\n    });\n  }\n  return state;\n}\nfunction deserializeErrors(errors) {\n  if (!errors) return null;\n  let entries = Object.entries(errors);\n  let serialized = {};\n  for (let [key, val] of entries) {\n    // Hey you!  If you change this, please change the corresponding logic in\n    // serializeErrors in react-router-dom/server.tsx :)\n    if (val && val.__type === \"RouteErrorResponse\") {\n      serialized[key] = new UNSAFE_ErrorResponseImpl(val.status, val.statusText, val.data, val.internal === true);\n    } else if (val && val.__type === \"Error\") {\n      // Attempt to reconstruct the right type of Error (i.e., ReferenceError)\n      if (val.__subType) {\n        let ErrorConstructor = window[val.__subType];\n        if (typeof ErrorConstructor === \"function\") {\n          try {\n            // @ts-expect-error\n            let error = new ErrorConstructor(val.message);\n            // Wipe away the client-side stack trace.  Nothing to fill it in with\n            // because we don't serialize SSR stack traces for security reasons\n            error.stack = \"\";\n            serialized[key] = error;\n          } catch (e) {\n            // no-op - fall through and create a normal Error\n          }\n        }\n      }\n      if (serialized[key] == null) {\n        let error = new Error(val.message);\n        // Wipe away the client-side stack trace.  Nothing to fill it in with\n        // because we don't serialize SSR stack traces for security reasons\n        error.stack = \"\";\n        serialized[key] = error;\n      }\n    } else {\n      serialized[key] = val;\n    }\n  }\n  return serialized;\n}\nconst ViewTransitionContext = /*#__PURE__*/React.createContext({\n  isTransitioning: false\n});\nif (process.env.NODE_ENV !== \"production\") {\n  ViewTransitionContext.displayName = \"ViewTransition\";\n}\nconst FetchersContext = /*#__PURE__*/React.createContext(new Map());\nif (process.env.NODE_ENV !== \"production\") {\n  FetchersContext.displayName = \"Fetchers\";\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Components\n////////////////////////////////////////////////////////////////////////////////\n/**\n  Webpack + React 17 fails to compile on any of the following because webpack\n  complains that `startTransition` doesn't exist in `React`:\n  * import { startTransition } from \"react\"\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React.startTransition(() => setState()) : setState()\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React[\"startTransition\"](() => setState()) : setState()\n\n  Moving it to a constant such as the following solves the Webpack/React 17 issue:\n  * import * as React from from \"react\";\n    const START_TRANSITION = \"startTransition\";\n    START_TRANSITION in React ? React[START_TRANSITION](() => setState()) : setState()\n\n  However, that introduces webpack/terser minification issues in production builds\n  in React 18 where minification/obfuscation ends up removing the call of\n  React.startTransition entirely from the first half of the ternary.  Grabbing\n  this exported reference once up front resolves that issue.\n\n  See https://github.com/remix-run/react-router/issues/10579\n*/\nconst START_TRANSITION = \"startTransition\";\nconst startTransitionImpl = React[START_TRANSITION];\nconst FLUSH_SYNC = \"flushSync\";\nconst flushSyncImpl = ReactDOM[FLUSH_SYNC];\nconst USE_ID = \"useId\";\nconst useIdImpl = React[USE_ID];\nfunction startTransitionSafe(cb) {\n  if (startTransitionImpl) {\n    startTransitionImpl(cb);\n  } else {\n    cb();\n  }\n}\nfunction flushSyncSafe(cb) {\n  if (flushSyncImpl) {\n    flushSyncImpl(cb);\n  } else {\n    cb();\n  }\n}\nclass Deferred {\n  constructor() {\n    this.status = \"pending\";\n    this.promise = new Promise((resolve, reject) => {\n      this.resolve = value => {\n        if (this.status === \"pending\") {\n          this.status = \"resolved\";\n          resolve(value);\n        }\n      };\n      this.reject = reason => {\n        if (this.status === \"pending\") {\n          this.status = \"rejected\";\n          reject(reason);\n        }\n      };\n    });\n  }\n}\n/**\n * Given a Remix Router instance, render the appropriate UI\n */\nfunction RouterProvider(_ref) {\n  let {\n    fallbackElement,\n    router,\n    future\n  } = _ref;\n  let [state, setStateImpl] = React.useState(router.state);\n  let [pendingState, setPendingState] = React.useState();\n  let [vtContext, setVtContext] = React.useState({\n    isTransitioning: false\n  });\n  let [renderDfd, setRenderDfd] = React.useState();\n  let [transition, setTransition] = React.useState();\n  let [interruption, setInterruption] = React.useState();\n  let fetcherData = React.useRef(new Map());\n  let {\n    v7_startTransition\n  } = future || {};\n  let optInStartTransition = React.useCallback(cb => {\n    if (v7_startTransition) {\n      startTransitionSafe(cb);\n    } else {\n      cb();\n    }\n  }, [v7_startTransition]);\n  let setState = React.useCallback((newState, _ref2) => {\n    let {\n      deletedFetchers,\n      flushSync: flushSync,\n      viewTransitionOpts: viewTransitionOpts\n    } = _ref2;\n    newState.fetchers.forEach((fetcher, key) => {\n      if (fetcher.data !== undefined) {\n        fetcherData.current.set(key, fetcher.data);\n      }\n    });\n    deletedFetchers.forEach(key => fetcherData.current.delete(key));\n    let isViewTransitionUnavailable = router.window == null || router.window.document == null || typeof router.window.document.startViewTransition !== \"function\";\n    // If this isn't a view transition or it's not available in this browser,\n    // just update and be done with it\n    if (!viewTransitionOpts || isViewTransitionUnavailable) {\n      if (flushSync) {\n        flushSyncSafe(() => setStateImpl(newState));\n      } else {\n        optInStartTransition(() => setStateImpl(newState));\n      }\n      return;\n    }\n    // flushSync + startViewTransition\n    if (flushSync) {\n      // Flush through the context to mark DOM elements as transition=ing\n      flushSyncSafe(() => {\n        // Cancel any pending transitions\n        if (transition) {\n          renderDfd && renderDfd.resolve();\n          transition.skipTransition();\n        }\n        setVtContext({\n          isTransitioning: true,\n          flushSync: true,\n          currentLocation: viewTransitionOpts.currentLocation,\n          nextLocation: viewTransitionOpts.nextLocation\n        });\n      });\n      // Update the DOM\n      let t = router.window.document.startViewTransition(() => {\n        flushSyncSafe(() => setStateImpl(newState));\n      });\n      // Clean up after the animation completes\n      t.finished.finally(() => {\n        flushSyncSafe(() => {\n          setRenderDfd(undefined);\n          setTransition(undefined);\n          setPendingState(undefined);\n          setVtContext({\n            isTransitioning: false\n          });\n        });\n      });\n      flushSyncSafe(() => setTransition(t));\n      return;\n    }\n    // startTransition + startViewTransition\n    if (transition) {\n      // Interrupting an in-progress transition, cancel and let everything flush\n      // out, and then kick off a new transition from the interruption state\n      renderDfd && renderDfd.resolve();\n      transition.skipTransition();\n      setInterruption({\n        state: newState,\n        currentLocation: viewTransitionOpts.currentLocation,\n        nextLocation: viewTransitionOpts.nextLocation\n      });\n    } else {\n      // Completed navigation update with opted-in view transitions, let 'er rip\n      setPendingState(newState);\n      setVtContext({\n        isTransitioning: true,\n        flushSync: false,\n        currentLocation: viewTransitionOpts.currentLocation,\n        nextLocation: viewTransitionOpts.nextLocation\n      });\n    }\n  }, [router.window, transition, renderDfd, fetcherData, optInStartTransition]);\n  // Need to use a layout effect here so we are subscribed early enough to\n  // pick up on any render-driven redirects/navigations (useEffect/<Navigate>)\n  React.useLayoutEffect(() => router.subscribe(setState), [router, setState]);\n  // When we start a view transition, create a Deferred we can use for the\n  // eventual \"completed\" render\n  React.useEffect(() => {\n    if (vtContext.isTransitioning && !vtContext.flushSync) {\n      setRenderDfd(new Deferred());\n    }\n  }, [vtContext]);\n  // Once the deferred is created, kick off startViewTransition() to update the\n  // DOM and then wait on the Deferred to resolve (indicating the DOM update has\n  // happened)\n  React.useEffect(() => {\n    if (renderDfd && pendingState && router.window) {\n      let newState = pendingState;\n      let renderPromise = renderDfd.promise;\n      let transition = router.window.document.startViewTransition(async () => {\n        optInStartTransition(() => setStateImpl(newState));\n        await renderPromise;\n      });\n      transition.finished.finally(() => {\n        setRenderDfd(undefined);\n        setTransition(undefined);\n        setPendingState(undefined);\n        setVtContext({\n          isTransitioning: false\n        });\n      });\n      setTransition(transition);\n    }\n  }, [optInStartTransition, pendingState, renderDfd, router.window]);\n  // When the new location finally renders and is committed to the DOM, this\n  // effect will run to resolve the transition\n  React.useEffect(() => {\n    if (renderDfd && pendingState && state.location.key === pendingState.location.key) {\n      renderDfd.resolve();\n    }\n  }, [renderDfd, transition, state.location, pendingState]);\n  // If we get interrupted with a new navigation during a transition, we skip\n  // the active transition, let it cleanup, then kick it off again here\n  React.useEffect(() => {\n    if (!vtContext.isTransitioning && interruption) {\n      setPendingState(interruption.state);\n      setVtContext({\n        isTransitioning: true,\n        flushSync: false,\n        currentLocation: interruption.currentLocation,\n        nextLocation: interruption.nextLocation\n      });\n      setInterruption(undefined);\n    }\n  }, [vtContext.isTransitioning, interruption]);\n  React.useEffect(() => {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(fallbackElement == null || !router.future.v7_partialHydration, \"`<RouterProvider fallbackElement>` is deprecated when using \" + \"`v7_partialHydration`, use a `HydrateFallback` component instead\") : void 0;\n    // Only log this once on initial mount\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  let navigator = React.useMemo(() => {\n    return {\n      createHref: router.createHref,\n      encodeLocation: router.encodeLocation,\n      go: n => router.navigate(n),\n      push: (to, state, opts) => router.navigate(to, {\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      }),\n      replace: (to, state, opts) => router.navigate(to, {\n        replace: true,\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      })\n    };\n  }, [router]);\n  let basename = router.basename || \"/\";\n  let dataRouterContext = React.useMemo(() => ({\n    router,\n    navigator,\n    static: false,\n    basename\n  }), [router, navigator, basename]);\n  let routerFuture = React.useMemo(() => ({\n    v7_relativeSplatPath: router.future.v7_relativeSplatPath\n  }), [router.future.v7_relativeSplatPath]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future, router.future), [future, router.future]);\n  // The fragment and {null} here are important!  We need them to keep React 18's\n  // useId happy when we are server-rendering since we may have a <script> here\n  // containing the hydrated server-side staticContext (from StaticRouterProvider).\n  // useId relies on the component tree structure to generate deterministic id's\n  // so we need to ensure it remains the same on the client even though\n  // we don't need the <script> tag\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(UNSAFE_DataRouterContext.Provider, {\n    value: dataRouterContext\n  }, /*#__PURE__*/React.createElement(UNSAFE_DataRouterStateContext.Provider, {\n    value: state\n  }, /*#__PURE__*/React.createElement(FetchersContext.Provider, {\n    value: fetcherData.current\n  }, /*#__PURE__*/React.createElement(ViewTransitionContext.Provider, {\n    value: vtContext\n  }, /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    location: state.location,\n    navigationType: state.historyAction,\n    navigator: navigator,\n    future: routerFuture\n  }, state.initialized || router.future.v7_partialHydration ? /*#__PURE__*/React.createElement(MemoizedDataRoutes, {\n    routes: router.routes,\n    future: router.future,\n    state: state\n  }) : fallbackElement))))), null);\n}\n// Memoize to avoid re-renders when updating `ViewTransitionContext`\nconst MemoizedDataRoutes = /*#__PURE__*/React.memo(DataRoutes);\nfunction DataRoutes(_ref3) {\n  let {\n    routes,\n    future,\n    state\n  } = _ref3;\n  return UNSAFE_useRoutesImpl(routes, undefined, state, future);\n}\n/**\n * A `<Router>` for use in web browsers. Provides the cleanest URLs.\n */\nfunction BrowserRouter(_ref4) {\n  let {\n    basename,\n    children,\n    future,\n    window\n  } = _ref4;\n  let historyRef = React.useRef();\n  if (historyRef.current == null) {\n    historyRef.current = createBrowserHistory({\n      window,\n      v5Compat: true\n    });\n  }\n  let history = historyRef.current;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\n/**\n * A `<Router>` for use in web browsers. Stores the location in the hash\n * portion of the URL so it is not sent to the server.\n */\nfunction HashRouter(_ref5) {\n  let {\n    basename,\n    children,\n    future,\n    window\n  } = _ref5;\n  let historyRef = React.useRef();\n  if (historyRef.current == null) {\n    historyRef.current = createHashHistory({\n      window,\n      v5Compat: true\n    });\n  }\n  let history = historyRef.current;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\n/**\n * A `<Router>` that accepts a pre-instantiated history object. It's important\n * to note that using your own history object is highly discouraged and may add\n * two versions of the history library to your bundles unless you use the same\n * version of the history library that React Router uses internally.\n */\nfunction HistoryRouter(_ref6) {\n  let {\n    basename,\n    children,\n    future,\n    history\n  } = _ref6;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\nif (process.env.NODE_ENV !== \"production\") {\n  HistoryRouter.displayName = \"unstable_HistoryRouter\";\n}\nconst isBrowser = typeof window !== \"undefined\" && typeof window.document !== \"undefined\" && typeof window.document.createElement !== \"undefined\";\nconst ABSOLUTE_URL_REGEX = /^(?:[a-z][a-z0-9+.-]*:|\\/\\/)/i;\n/**\n * The public API for rendering a history-aware `<a>`.\n */\nconst Link = /*#__PURE__*/React.forwardRef(function LinkWithRef(_ref7, ref) {\n  let {\n      onClick,\n      relative,\n      reloadDocument,\n      replace,\n      state,\n      target,\n      to,\n      preventScrollReset,\n      viewTransition\n    } = _ref7,\n    rest = _objectWithoutPropertiesLoose(_ref7, _excluded);\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  // Rendered into <a href> for absolute URLs\n  let absoluteHref;\n  let isExternal = false;\n  if (typeof to === \"string\" && ABSOLUTE_URL_REGEX.test(to)) {\n    // Render the absolute href server- and client-side\n    absoluteHref = to;\n    // Only check for external origins client-side\n    if (isBrowser) {\n      try {\n        let currentUrl = new URL(window.location.href);\n        let targetUrl = to.startsWith(\"//\") ? new URL(currentUrl.protocol + to) : new URL(to);\n        let path = stripBasename(targetUrl.pathname, basename);\n        if (targetUrl.origin === currentUrl.origin && path != null) {\n          // Strip the protocol/origin/basename for same-origin absolute URLs\n          to = path + targetUrl.search + targetUrl.hash;\n        } else {\n          isExternal = true;\n        }\n      } catch (e) {\n        // We can't do external URL detection without a valid URL\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"<Link to=\\\"\" + to + \"\\\"> contains an invalid URL which will probably break \" + \"when clicked - please update to a valid URL path.\") : void 0;\n      }\n    }\n  }\n  // Rendered into <a href> for relative URLs\n  let href = useHref(to, {\n    relative\n  });\n  let internalOnClick = useLinkClickHandler(to, {\n    replace,\n    state,\n    target,\n    preventScrollReset,\n    relative,\n    viewTransition\n  });\n  function handleClick(event) {\n    if (onClick) onClick(event);\n    if (!event.defaultPrevented) {\n      internalOnClick(event);\n    }\n  }\n  return (\n    /*#__PURE__*/\n    // eslint-disable-next-line jsx-a11y/anchor-has-content\n    React.createElement(\"a\", _extends({}, rest, {\n      href: absoluteHref || href,\n      onClick: isExternal || reloadDocument ? onClick : handleClick,\n      ref: ref,\n      target: target\n    }))\n  );\n});\nif (process.env.NODE_ENV !== \"production\") {\n  Link.displayName = \"Link\";\n}\n/**\n * A `<Link>` wrapper that knows if it's \"active\" or not.\n */\nconst NavLink = /*#__PURE__*/React.forwardRef(function NavLinkWithRef(_ref8, ref) {\n  let {\n      \"aria-current\": ariaCurrentProp = \"page\",\n      caseSensitive = false,\n      className: classNameProp = \"\",\n      end = false,\n      style: styleProp,\n      to,\n      viewTransition,\n      children\n    } = _ref8,\n    rest = _objectWithoutPropertiesLoose(_ref8, _excluded2);\n  let path = useResolvedPath(to, {\n    relative: rest.relative\n  });\n  let location = useLocation();\n  let routerState = React.useContext(UNSAFE_DataRouterStateContext);\n  let {\n    navigator,\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let isTransitioning = routerState != null &&\n  // Conditional usage is OK here because the usage of a data router is static\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useViewTransitionState(path) && viewTransition === true;\n  let toPathname = navigator.encodeLocation ? navigator.encodeLocation(path).pathname : path.pathname;\n  let locationPathname = location.pathname;\n  let nextLocationPathname = routerState && routerState.navigation && routerState.navigation.location ? routerState.navigation.location.pathname : null;\n  if (!caseSensitive) {\n    locationPathname = locationPathname.toLowerCase();\n    nextLocationPathname = nextLocationPathname ? nextLocationPathname.toLowerCase() : null;\n    toPathname = toPathname.toLowerCase();\n  }\n  if (nextLocationPathname && basename) {\n    nextLocationPathname = stripBasename(nextLocationPathname, basename) || nextLocationPathname;\n  }\n  // If the `to` has a trailing slash, look at that exact spot.  Otherwise,\n  // we're looking for a slash _after_ what's in `to`.  For example:\n  //\n  // <NavLink to=\"/users\"> and <NavLink to=\"/users/\">\n  // both want to look for a / at index 6 to match URL `/users/matt`\n  const endSlashPosition = toPathname !== \"/\" && toPathname.endsWith(\"/\") ? toPathname.length - 1 : toPathname.length;\n  let isActive = locationPathname === toPathname || !end && locationPathname.startsWith(toPathname) && locationPathname.charAt(endSlashPosition) === \"/\";\n  let isPending = nextLocationPathname != null && (nextLocationPathname === toPathname || !end && nextLocationPathname.startsWith(toPathname) && nextLocationPathname.charAt(toPathname.length) === \"/\");\n  let renderProps = {\n    isActive,\n    isPending,\n    isTransitioning\n  };\n  let ariaCurrent = isActive ? ariaCurrentProp : undefined;\n  let className;\n  if (typeof classNameProp === \"function\") {\n    className = classNameProp(renderProps);\n  } else {\n    // If the className prop is not a function, we use a default `active`\n    // class for <NavLink />s that are active. In v5 `active` was the default\n    // value for `activeClassName`, but we are removing that API and can still\n    // use the old default behavior for a cleaner upgrade path and keep the\n    // simple styling rules working as they currently do.\n    className = [classNameProp, isActive ? \"active\" : null, isPending ? \"pending\" : null, isTransitioning ? \"transitioning\" : null].filter(Boolean).join(\" \");\n  }\n  let style = typeof styleProp === \"function\" ? styleProp(renderProps) : styleProp;\n  return /*#__PURE__*/React.createElement(Link, _extends({}, rest, {\n    \"aria-current\": ariaCurrent,\n    className: className,\n    ref: ref,\n    style: style,\n    to: to,\n    viewTransition: viewTransition\n  }), typeof children === \"function\" ? children(renderProps) : children);\n});\nif (process.env.NODE_ENV !== \"production\") {\n  NavLink.displayName = \"NavLink\";\n}\n/**\n * A `@remix-run/router`-aware `<form>`. It behaves like a normal form except\n * that the interaction with the server is with `fetch` instead of new document\n * requests, allowing components to add nicer UX to the page as the form is\n * submitted and returns with data.\n */\nconst Form = /*#__PURE__*/React.forwardRef((_ref9, forwardedRef) => {\n  let {\n      fetcherKey,\n      navigate,\n      reloadDocument,\n      replace,\n      state,\n      method = defaultMethod,\n      action,\n      onSubmit,\n      relative,\n      preventScrollReset,\n      viewTransition\n    } = _ref9,\n    props = _objectWithoutPropertiesLoose(_ref9, _excluded3);\n  let submit = useSubmit();\n  let formAction = useFormAction(action, {\n    relative\n  });\n  let formMethod = method.toLowerCase() === \"get\" ? \"get\" : \"post\";\n  let submitHandler = event => {\n    onSubmit && onSubmit(event);\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n    let submitter = event.nativeEvent.submitter;\n    let submitMethod = (submitter == null ? void 0 : submitter.getAttribute(\"formmethod\")) || method;\n    submit(submitter || event.currentTarget, {\n      fetcherKey,\n      method: submitMethod,\n      navigate,\n      replace,\n      state,\n      relative,\n      preventScrollReset,\n      viewTransition\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"form\", _extends({\n    ref: forwardedRef,\n    method: formMethod,\n    action: formAction,\n    onSubmit: reloadDocument ? onSubmit : submitHandler\n  }, props));\n});\nif (process.env.NODE_ENV !== \"production\") {\n  Form.displayName = \"Form\";\n}\n/**\n * This component will emulate the browser's scroll restoration on location\n * changes.\n */\nfunction ScrollRestoration(_ref10) {\n  let {\n    getKey,\n    storageKey\n  } = _ref10;\n  useScrollRestoration({\n    getKey,\n    storageKey\n  });\n  return null;\n}\nif (process.env.NODE_ENV !== \"production\") {\n  ScrollRestoration.displayName = \"ScrollRestoration\";\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Hooks\n////////////////////////////////////////////////////////////////////////////////\nvar DataRouterHook;\n(function (DataRouterHook) {\n  DataRouterHook[\"UseScrollRestoration\"] = \"useScrollRestoration\";\n  DataRouterHook[\"UseSubmit\"] = \"useSubmit\";\n  DataRouterHook[\"UseSubmitFetcher\"] = \"useSubmitFetcher\";\n  DataRouterHook[\"UseFetcher\"] = \"useFetcher\";\n  DataRouterHook[\"useViewTransitionState\"] = \"useViewTransitionState\";\n})(DataRouterHook || (DataRouterHook = {}));\nvar DataRouterStateHook;\n(function (DataRouterStateHook) {\n  DataRouterStateHook[\"UseFetcher\"] = \"useFetcher\";\n  DataRouterStateHook[\"UseFetchers\"] = \"useFetchers\";\n  DataRouterStateHook[\"UseScrollRestoration\"] = \"useScrollRestoration\";\n})(DataRouterStateHook || (DataRouterStateHook = {}));\n// Internal hooks\nfunction getDataRouterConsoleError(hookName) {\n  return hookName + \" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router.\";\n}\nfunction useDataRouterContext(hookName) {\n  let ctx = React.useContext(UNSAFE_DataRouterContext);\n  !ctx ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return ctx;\n}\nfunction useDataRouterState(hookName) {\n  let state = React.useContext(UNSAFE_DataRouterStateContext);\n  !state ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return state;\n}\n// External hooks\n/**\n * Handles the click behavior for router `<Link>` components. This is useful if\n * you need to create custom `<Link>` components with the same click behavior we\n * use in our exported `<Link>`.\n */\nfunction useLinkClickHandler(to, _temp) {\n  let {\n    target,\n    replace: replaceProp,\n    state,\n    preventScrollReset,\n    relative,\n    viewTransition\n  } = _temp === void 0 ? {} : _temp;\n  let navigate = useNavigate();\n  let location = useLocation();\n  let path = useResolvedPath(to, {\n    relative\n  });\n  return React.useCallback(event => {\n    if (shouldProcessLinkClick(event, target)) {\n      event.preventDefault();\n      // If the URL hasn't changed, a regular <a> will do a replace instead of\n      // a push, so do the same here unless the replace prop is explicitly set\n      let replace = replaceProp !== undefined ? replaceProp : createPath(location) === createPath(path);\n      navigate(to, {\n        replace,\n        state,\n        preventScrollReset,\n        relative,\n        viewTransition\n      });\n    }\n  }, [location, navigate, path, replaceProp, state, target, to, preventScrollReset, relative, viewTransition]);\n}\n/**\n * A convenient wrapper for reading and writing search parameters via the\n * URLSearchParams interface.\n */\nfunction useSearchParams(defaultInit) {\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(typeof URLSearchParams !== \"undefined\", \"You cannot use the `useSearchParams` hook in a browser that does not \" + \"support the URLSearchParams API. If you need to support Internet \" + \"Explorer 11, we recommend you load a polyfill such as \" + \"https://github.com/ungap/url-search-params.\") : void 0;\n  let defaultSearchParamsRef = React.useRef(createSearchParams(defaultInit));\n  let hasSetSearchParamsRef = React.useRef(false);\n  let location = useLocation();\n  let searchParams = React.useMemo(() =>\n  // Only merge in the defaults if we haven't yet called setSearchParams.\n  // Once we call that we want those to take precedence, otherwise you can't\n  // remove a param with setSearchParams({}) if it has an initial value\n  getSearchParamsForLocation(location.search, hasSetSearchParamsRef.current ? null : defaultSearchParamsRef.current), [location.search]);\n  let navigate = useNavigate();\n  let setSearchParams = React.useCallback((nextInit, navigateOptions) => {\n    const newSearchParams = createSearchParams(typeof nextInit === \"function\" ? nextInit(searchParams) : nextInit);\n    hasSetSearchParamsRef.current = true;\n    navigate(\"?\" + newSearchParams, navigateOptions);\n  }, [navigate, searchParams]);\n  return [searchParams, setSearchParams];\n}\nfunction validateClientSideSubmission() {\n  if (typeof document === \"undefined\") {\n    throw new Error(\"You are calling submit during the server render. \" + \"Try calling submit within a `useEffect` or callback instead.\");\n  }\n}\nlet fetcherId = 0;\nlet getUniqueFetcherId = () => \"__\" + String(++fetcherId) + \"__\";\n/**\n * Returns a function that may be used to programmatically submit a form (or\n * some arbitrary data) to the server.\n */\nfunction useSubmit() {\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseSubmit);\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let currentRouteId = UNSAFE_useRouteId();\n  return React.useCallback(function (target, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    validateClientSideSubmission();\n    let {\n      action,\n      method,\n      encType,\n      formData,\n      body\n    } = getFormSubmissionInfo(target, basename);\n    if (options.navigate === false) {\n      let key = options.fetcherKey || getUniqueFetcherId();\n      router.fetch(key, currentRouteId, options.action || action, {\n        preventScrollReset: options.preventScrollReset,\n        formData,\n        body,\n        formMethod: options.method || method,\n        formEncType: options.encType || encType,\n        flushSync: options.flushSync\n      });\n    } else {\n      router.navigate(options.action || action, {\n        preventScrollReset: options.preventScrollReset,\n        formData,\n        body,\n        formMethod: options.method || method,\n        formEncType: options.encType || encType,\n        replace: options.replace,\n        state: options.state,\n        fromRouteId: currentRouteId,\n        flushSync: options.flushSync,\n        viewTransition: options.viewTransition\n      });\n    }\n  }, [router, basename, currentRouteId]);\n}\n// v7: Eventually we should deprecate this entirely in favor of using the\n// router method directly?\nfunction useFormAction(action, _temp2) {\n  let {\n    relative\n  } = _temp2 === void 0 ? {} : _temp2;\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let routeContext = React.useContext(UNSAFE_RouteContext);\n  !routeContext ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFormAction must be used inside a RouteContext\") : UNSAFE_invariant(false) : void 0;\n  let [match] = routeContext.matches.slice(-1);\n  // Shallow clone path so we can modify it below, otherwise we modify the\n  // object referenced by useMemo inside useResolvedPath\n  let path = _extends({}, useResolvedPath(action ? action : \".\", {\n    relative\n  }));\n  // If no action was specified, browsers will persist current search params\n  // when determining the path, so match that behavior\n  // https://github.com/remix-run/remix/issues/927\n  let location = useLocation();\n  if (action == null) {\n    // Safe to write to this directly here since if action was undefined, we\n    // would have called useResolvedPath(\".\") which will never include a search\n    path.search = location.search;\n    // When grabbing search params from the URL, remove any included ?index param\n    // since it might not apply to our contextual route.  We add it back based\n    // on match.route.index below\n    let params = new URLSearchParams(path.search);\n    let indexValues = params.getAll(\"index\");\n    let hasNakedIndexParam = indexValues.some(v => v === \"\");\n    if (hasNakedIndexParam) {\n      params.delete(\"index\");\n      indexValues.filter(v => v).forEach(v => params.append(\"index\", v));\n      let qs = params.toString();\n      path.search = qs ? \"?\" + qs : \"\";\n    }\n  }\n  if ((!action || action === \".\") && match.route.index) {\n    path.search = path.search ? path.search.replace(/^\\?/, \"?index&\") : \"?index\";\n  }\n  // If we're operating within a basename, prepend it to the pathname prior\n  // to creating the form action.  If this is a root navigation, then just use\n  // the raw basename which allows the basename to have full control over the\n  // presence of a trailing slash on root actions\n  if (basename !== \"/\") {\n    path.pathname = path.pathname === \"/\" ? basename : joinPaths([basename, path.pathname]);\n  }\n  return createPath(path);\n}\n// TODO: (v7) Change the useFetcher generic default from `any` to `unknown`\n/**\n * Interacts with route loaders and actions without causing a navigation. Great\n * for any interaction that stays on the same page.\n */\nfunction useFetcher(_temp3) {\n  var _route$matches;\n  let {\n    key\n  } = _temp3 === void 0 ? {} : _temp3;\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseFetcher);\n  let state = useDataRouterState(DataRouterStateHook.UseFetcher);\n  let fetcherData = React.useContext(FetchersContext);\n  let route = React.useContext(UNSAFE_RouteContext);\n  let routeId = (_route$matches = route.matches[route.matches.length - 1]) == null ? void 0 : _route$matches.route.id;\n  !fetcherData ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFetcher must be used inside a FetchersContext\") : UNSAFE_invariant(false) : void 0;\n  !route ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFetcher must be used inside a RouteContext\") : UNSAFE_invariant(false) : void 0;\n  !(routeId != null) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFetcher can only be used on routes that contain a unique \\\"id\\\"\") : UNSAFE_invariant(false) : void 0;\n  // Fetcher key handling\n  // OK to call conditionally to feature detect `useId`\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  let defaultKey = useIdImpl ? useIdImpl() : \"\";\n  let [fetcherKey, setFetcherKey] = React.useState(key || defaultKey);\n  if (key && key !== fetcherKey) {\n    setFetcherKey(key);\n  } else if (!fetcherKey) {\n    // We will only fall through here when `useId` is not available\n    setFetcherKey(getUniqueFetcherId());\n  }\n  // Registration/cleanup\n  React.useEffect(() => {\n    router.getFetcher(fetcherKey);\n    return () => {\n      // Tell the router we've unmounted - if v7_fetcherPersist is enabled this\n      // will not delete immediately but instead queue up a delete after the\n      // fetcher returns to an `idle` state\n      router.deleteFetcher(fetcherKey);\n    };\n  }, [router, fetcherKey]);\n  // Fetcher additions\n  let load = React.useCallback((href, opts) => {\n    !routeId ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"No routeId available for fetcher.load()\") : UNSAFE_invariant(false) : void 0;\n    router.fetch(fetcherKey, routeId, href, opts);\n  }, [fetcherKey, routeId, router]);\n  let submitImpl = useSubmit();\n  let submit = React.useCallback((target, opts) => {\n    submitImpl(target, _extends({}, opts, {\n      navigate: false,\n      fetcherKey\n    }));\n  }, [fetcherKey, submitImpl]);\n  let FetcherForm = React.useMemo(() => {\n    let FetcherForm = /*#__PURE__*/React.forwardRef((props, ref) => {\n      return /*#__PURE__*/React.createElement(Form, _extends({}, props, {\n        navigate: false,\n        fetcherKey: fetcherKey,\n        ref: ref\n      }));\n    });\n    if (process.env.NODE_ENV !== \"production\") {\n      FetcherForm.displayName = \"fetcher.Form\";\n    }\n    return FetcherForm;\n  }, [fetcherKey]);\n  // Exposed FetcherWithComponents\n  let fetcher = state.fetchers.get(fetcherKey) || IDLE_FETCHER;\n  let data = fetcherData.get(fetcherKey);\n  let fetcherWithComponents = React.useMemo(() => _extends({\n    Form: FetcherForm,\n    submit,\n    load\n  }, fetcher, {\n    data\n  }), [FetcherForm, submit, load, fetcher, data]);\n  return fetcherWithComponents;\n}\n/**\n * Provides all fetchers currently on the page. Useful for layouts and parent\n * routes that need to provide pending/optimistic UI regarding the fetch.\n */\nfunction useFetchers() {\n  let state = useDataRouterState(DataRouterStateHook.UseFetchers);\n  return Array.from(state.fetchers.entries()).map(_ref11 => {\n    let [key, fetcher] = _ref11;\n    return _extends({}, fetcher, {\n      key\n    });\n  });\n}\nconst SCROLL_RESTORATION_STORAGE_KEY = \"react-router-scroll-positions\";\nlet savedScrollPositions = {};\n/**\n * When rendered inside a RouterProvider, will restore scroll positions on navigations\n */\nfunction useScrollRestoration(_temp4) {\n  let {\n    getKey,\n    storageKey\n  } = _temp4 === void 0 ? {} : _temp4;\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseScrollRestoration);\n  let {\n    restoreScrollPosition,\n    preventScrollReset\n  } = useDataRouterState(DataRouterStateHook.UseScrollRestoration);\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let location = useLocation();\n  let matches = useMatches();\n  let navigation = useNavigation();\n  // Trigger manual scroll restoration while we're active\n  React.useEffect(() => {\n    window.history.scrollRestoration = \"manual\";\n    return () => {\n      window.history.scrollRestoration = \"auto\";\n    };\n  }, []);\n  // Save positions on pagehide\n  usePageHide(React.useCallback(() => {\n    if (navigation.state === \"idle\") {\n      let key = (getKey ? getKey(location, matches) : null) || location.key;\n      savedScrollPositions[key] = window.scrollY;\n    }\n    try {\n      sessionStorage.setItem(storageKey || SCROLL_RESTORATION_STORAGE_KEY, JSON.stringify(savedScrollPositions));\n    } catch (error) {\n      process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"Failed to save scroll positions in sessionStorage, <ScrollRestoration /> will not work properly (\" + error + \").\") : void 0;\n    }\n    window.history.scrollRestoration = \"auto\";\n  }, [storageKey, getKey, navigation.state, location, matches]));\n  // Read in any saved scroll locations\n  if (typeof document !== \"undefined\") {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(() => {\n      try {\n        let sessionPositions = sessionStorage.getItem(storageKey || SCROLL_RESTORATION_STORAGE_KEY);\n        if (sessionPositions) {\n          savedScrollPositions = JSON.parse(sessionPositions);\n        }\n      } catch (e) {\n        // no-op, use default empty object\n      }\n    }, [storageKey]);\n    // Enable scroll restoration in the router\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(() => {\n      let getKeyWithoutBasename = getKey && basename !== \"/\" ? (location, matches) => getKey( // Strip the basename to match useLocation()\n      _extends({}, location, {\n        pathname: stripBasename(location.pathname, basename) || location.pathname\n      }), matches) : getKey;\n      let disableScrollRestoration = router == null ? void 0 : router.enableScrollRestoration(savedScrollPositions, () => window.scrollY, getKeyWithoutBasename);\n      return () => disableScrollRestoration && disableScrollRestoration();\n    }, [router, basename, getKey]);\n    // Restore scrolling when state.restoreScrollPosition changes\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(() => {\n      // Explicit false means don't do anything (used for submissions)\n      if (restoreScrollPosition === false) {\n        return;\n      }\n      // been here before, scroll to it\n      if (typeof restoreScrollPosition === \"number\") {\n        window.scrollTo(0, restoreScrollPosition);\n        return;\n      }\n      // try to scroll to the hash\n      if (location.hash) {\n        let el = document.getElementById(decodeURIComponent(location.hash.slice(1)));\n        if (el) {\n          el.scrollIntoView();\n          return;\n        }\n      }\n      // Don't reset if this navigation opted out\n      if (preventScrollReset === true) {\n        return;\n      }\n      // otherwise go to the top on new locations\n      window.scrollTo(0, 0);\n    }, [location, restoreScrollPosition, preventScrollReset]);\n  }\n}\n/**\n * Setup a callback to be fired on the window's `beforeunload` event. This is\n * useful for saving some data to `window.localStorage` just before the page\n * refreshes.\n *\n * Note: The `callback` argument should be a function created with\n * `React.useCallback()`.\n */\nfunction useBeforeUnload(callback, options) {\n  let {\n    capture\n  } = options || {};\n  React.useEffect(() => {\n    let opts = capture != null ? {\n      capture\n    } : undefined;\n    window.addEventListener(\"beforeunload\", callback, opts);\n    return () => {\n      window.removeEventListener(\"beforeunload\", callback, opts);\n    };\n  }, [callback, capture]);\n}\n/**\n * Setup a callback to be fired on the window's `pagehide` event. This is\n * useful for saving some data to `window.localStorage` just before the page\n * refreshes.  This event is better supported than beforeunload across browsers.\n *\n * Note: The `callback` argument should be a function created with\n * `React.useCallback()`.\n */\nfunction usePageHide(callback, options) {\n  let {\n    capture\n  } = options || {};\n  React.useEffect(() => {\n    let opts = capture != null ? {\n      capture\n    } : undefined;\n    window.addEventListener(\"pagehide\", callback, opts);\n    return () => {\n      window.removeEventListener(\"pagehide\", callback, opts);\n    };\n  }, [callback, capture]);\n}\n/**\n * Wrapper around useBlocker to show a window.confirm prompt to users instead\n * of building a custom UI with useBlocker.\n *\n * Warning: This has *a lot of rough edges* and behaves very differently (and\n * very incorrectly in some cases) across browsers if user click addition\n * back/forward navigations while the confirm is open.  Use at your own risk.\n */\nfunction usePrompt(_ref12) {\n  let {\n    when,\n    message\n  } = _ref12;\n  let blocker = useBlocker(when);\n  React.useEffect(() => {\n    if (blocker.state === \"blocked\") {\n      let proceed = window.confirm(message);\n      if (proceed) {\n        // This timeout is needed to avoid a weird \"race\" on POP navigations\n        // between the `window.history` revert navigation and the result of\n        // `window.confirm`\n        setTimeout(blocker.proceed, 0);\n      } else {\n        blocker.reset();\n      }\n    }\n  }, [blocker, message]);\n  React.useEffect(() => {\n    if (blocker.state === \"blocked\" && !when) {\n      blocker.reset();\n    }\n  }, [blocker, when]);\n}\n/**\n * Return a boolean indicating if there is an active view transition to the\n * given href.  You can use this value to render CSS classes or viewTransitionName\n * styles onto your elements\n *\n * @param href The destination href\n * @param [opts.relative] Relative routing type (\"route\" | \"path\")\n */\nfunction useViewTransitionState(to, opts) {\n  if (opts === void 0) {\n    opts = {};\n  }\n  let vtContext = React.useContext(ViewTransitionContext);\n  !(vtContext != null) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  \" + \"Did you accidentally import `RouterProvider` from `react-router`?\") : UNSAFE_invariant(false) : void 0;\n  let {\n    basename\n  } = useDataRouterContext(DataRouterHook.useViewTransitionState);\n  let path = useResolvedPath(to, {\n    relative: opts.relative\n  });\n  if (!vtContext.isTransitioning) {\n    return false;\n  }\n  let currentPath = stripBasename(vtContext.currentLocation.pathname, basename) || vtContext.currentLocation.pathname;\n  let nextPath = stripBasename(vtContext.nextLocation.pathname, basename) || vtContext.nextLocation.pathname;\n  // Transition is active if we're going to or coming from the indicated\n  // destination.  This ensures that other PUSH navigations that reverse\n  // an indicated transition apply.  I.e., on the list view you have:\n  //\n  //   <NavLink to=\"/details/1\" viewTransition>\n  //\n  // If you click the breadcrumb back to the list view:\n  //\n  //   <NavLink to=\"/list\" viewTransition>\n  //\n  // We should apply the transition because it's indicated as active going\n  // from /list -> /details/1 and therefore should be active on the reverse\n  // (even though this isn't strictly a POP reverse)\n  return matchPath(path.pathname, nextPath) != null || matchPath(path.pathname, currentPath) != null;\n}\n//#endregion\n\nexport { BrowserRouter, Form, HashRouter, Link, NavLink, RouterProvider, ScrollRestoration, FetchersContext as UNSAFE_FetchersContext, ViewTransitionContext as UNSAFE_ViewTransitionContext, useScrollRestoration as UNSAFE_useScrollRestoration, createBrowserRouter, createHashRouter, createSearchParams, HistoryRouter as unstable_HistoryRouter, usePrompt as unstable_usePrompt, useBeforeUnload, useFetcher, useFetchers, useFormAction, useLinkClickHandler, useSearchParams, useSubmit, useViewTransitionState };\n//# sourceMappingURL=index.js.map\n","const reduxImpl = (reducer, initial) => (set, _get, api) => {\n  api.dispatch = (action) => {\n    set((state) => reducer(state, action), false, action);\n    return action;\n  };\n  api.dispatchFromDevtools = true;\n  return { dispatch: (...a) => api.dispatch(...a), ...initial };\n};\nconst redux = reduxImpl;\n\nconst trackedConnections = /* @__PURE__ */ new Map();\nconst getTrackedConnectionState = (name) => {\n  const api = trackedConnections.get(name);\n  if (!api) return {};\n  return Object.fromEntries(\n    Object.entries(api.stores).map(([key, api2]) => [key, api2.getState()])\n  );\n};\nconst extractConnectionInformation = (store, extensionConnector, options) => {\n  if (store === void 0) {\n    return {\n      type: \"untracked\",\n      connection: extensionConnector.connect(options)\n    };\n  }\n  const existingConnection = trackedConnections.get(options.name);\n  if (existingConnection) {\n    return { type: \"tracked\", store, ...existingConnection };\n  }\n  const newConnection = {\n    connection: extensionConnector.connect(options),\n    stores: {}\n  };\n  trackedConnections.set(options.name, newConnection);\n  return { type: \"tracked\", store, ...newConnection };\n};\nconst devtoolsImpl = (fn, devtoolsOptions = {}) => (set, get, api) => {\n  const { enabled, anonymousActionType, store, ...options } = devtoolsOptions;\n  let extensionConnector;\n  try {\n    extensionConnector = (enabled != null ? enabled : (import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") && window.__REDUX_DEVTOOLS_EXTENSION__;\n  } catch (_e) {\n  }\n  if (!extensionConnector) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && enabled) {\n      console.warn(\n        \"[zustand devtools middleware] Please install/enable Redux devtools extension\"\n      );\n    }\n    return fn(set, get, api);\n  }\n  const { connection, ...connectionInformation } = extractConnectionInformation(store, extensionConnector, options);\n  let isRecording = true;\n  api.setState = (state, replace, nameOrAction) => {\n    const r = set(state, replace);\n    if (!isRecording) return r;\n    const action = nameOrAction === void 0 ? { type: anonymousActionType || \"anonymous\" } : typeof nameOrAction === \"string\" ? { type: nameOrAction } : nameOrAction;\n    if (store === void 0) {\n      connection == null ? void 0 : connection.send(action, get());\n      return r;\n    }\n    connection == null ? void 0 : connection.send(\n      {\n        ...action,\n        type: `${store}/${action.type}`\n      },\n      {\n        ...getTrackedConnectionState(options.name),\n        [store]: api.getState()\n      }\n    );\n    return r;\n  };\n  const setStateFromDevtools = (...a) => {\n    const originalIsRecording = isRecording;\n    isRecording = false;\n    set(...a);\n    isRecording = originalIsRecording;\n  };\n  const initialState = fn(api.setState, get, api);\n  if (connectionInformation.type === \"untracked\") {\n    connection == null ? void 0 : connection.init(initialState);\n  } else {\n    connectionInformation.stores[connectionInformation.store] = api;\n    connection == null ? void 0 : connection.init(\n      Object.fromEntries(\n        Object.entries(connectionInformation.stores).map(([key, store2]) => [\n          key,\n          key === connectionInformation.store ? initialState : store2.getState()\n        ])\n      )\n    );\n  }\n  if (api.dispatchFromDevtools && typeof api.dispatch === \"function\") {\n    let didWarnAboutReservedActionType = false;\n    const originalDispatch = api.dispatch;\n    api.dispatch = (...a) => {\n      if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\" && a[0].type === \"__setState\" && !didWarnAboutReservedActionType) {\n        console.warn(\n          '[zustand devtools middleware] \"__setState\" action type is reserved to set state from the devtools. Avoid using it.'\n        );\n        didWarnAboutReservedActionType = true;\n      }\n      originalDispatch(...a);\n    };\n  }\n  connection.subscribe((message) => {\n    var _a;\n    switch (message.type) {\n      case \"ACTION\":\n        if (typeof message.payload !== \"string\") {\n          console.error(\n            \"[zustand devtools middleware] Unsupported action format\"\n          );\n          return;\n        }\n        return parseJsonThen(\n          message.payload,\n          (action) => {\n            if (action.type === \"__setState\") {\n              if (store === void 0) {\n                setStateFromDevtools(action.state);\n                return;\n              }\n              if (Object.keys(action.state).length !== 1) {\n                console.error(\n                  `\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { \"type\": \"__setState\", \"state\": { \"abc123Store\": { \"foo\": \"bar\" } } }\n                    `\n                );\n              }\n              const stateFromDevtools = action.state[store];\n              if (stateFromDevtools === void 0 || stateFromDevtools === null) {\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(stateFromDevtools)) {\n                setStateFromDevtools(stateFromDevtools);\n              }\n              return;\n            }\n            if (!api.dispatchFromDevtools) return;\n            if (typeof api.dispatch !== \"function\") return;\n            api.dispatch(action);\n          }\n        );\n      case \"DISPATCH\":\n        switch (message.payload.type) {\n          case \"RESET\":\n            setStateFromDevtools(initialState);\n            if (store === void 0) {\n              return connection == null ? void 0 : connection.init(api.getState());\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"COMMIT\":\n            if (store === void 0) {\n              connection == null ? void 0 : connection.init(api.getState());\n              return;\n            }\n            return connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n          case \"ROLLBACK\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                connection == null ? void 0 : connection.init(api.getState());\n                return;\n              }\n              setStateFromDevtools(state[store]);\n              connection == null ? void 0 : connection.init(getTrackedConnectionState(options.name));\n            });\n          case \"JUMP_TO_STATE\":\n          case \"JUMP_TO_ACTION\":\n            return parseJsonThen(message.state, (state) => {\n              if (store === void 0) {\n                setStateFromDevtools(state);\n                return;\n              }\n              if (JSON.stringify(api.getState()) !== JSON.stringify(state[store])) {\n                setStateFromDevtools(state[store]);\n              }\n            });\n          case \"IMPORT_STATE\": {\n            const { nextLiftedState } = message.payload;\n            const lastComputedState = (_a = nextLiftedState.computedStates.slice(-1)[0]) == null ? void 0 : _a.state;\n            if (!lastComputedState) return;\n            if (store === void 0) {\n              setStateFromDevtools(lastComputedState);\n            } else {\n              setStateFromDevtools(lastComputedState[store]);\n            }\n            connection == null ? void 0 : connection.send(\n              null,\n              // FIXME no-any\n              nextLiftedState\n            );\n            return;\n          }\n          case \"PAUSE_RECORDING\":\n            return isRecording = !isRecording;\n        }\n        return;\n    }\n  });\n  return initialState;\n};\nconst devtools = devtoolsImpl;\nconst parseJsonThen = (stringified, f) => {\n  let parsed;\n  try {\n    parsed = JSON.parse(stringified);\n  } catch (e) {\n    console.error(\n      \"[zustand devtools middleware] Could not parse the received json\",\n      e\n    );\n  }\n  if (parsed !== void 0) f(parsed);\n};\n\nconst subscribeWithSelectorImpl = (fn) => (set, get, api) => {\n  const origSubscribe = api.subscribe;\n  api.subscribe = (selector, optListener, options) => {\n    let listener = selector;\n    if (optListener) {\n      const equalityFn = (options == null ? void 0 : options.equalityFn) || Object.is;\n      let currentSlice = selector(api.getState());\n      listener = (state) => {\n        const nextSlice = selector(state);\n        if (!equalityFn(currentSlice, nextSlice)) {\n          const previousSlice = currentSlice;\n          optListener(currentSlice = nextSlice, previousSlice);\n        }\n      };\n      if (options == null ? void 0 : options.fireImmediately) {\n        optListener(currentSlice, currentSlice);\n      }\n    }\n    return origSubscribe(listener);\n  };\n  const initialState = fn(set, get, api);\n  return initialState;\n};\nconst subscribeWithSelector = subscribeWithSelectorImpl;\n\nconst combine = (initialState, create) => (...a) => Object.assign({}, initialState, create(...a));\n\nfunction createJSONStorage(getStorage, options) {\n  let storage;\n  try {\n    storage = getStorage();\n  } catch (_e) {\n    return;\n  }\n  const persistStorage = {\n    getItem: (name) => {\n      var _a;\n      const parse = (str2) => {\n        if (str2 === null) {\n          return null;\n        }\n        return JSON.parse(str2, options == null ? void 0 : options.reviver);\n      };\n      const str = (_a = storage.getItem(name)) != null ? _a : null;\n      if (str instanceof Promise) {\n        return str.then(parse);\n      }\n      return parse(str);\n    },\n    setItem: (name, newValue) => storage.setItem(\n      name,\n      JSON.stringify(newValue, options == null ? void 0 : options.replacer)\n    ),\n    removeItem: (name) => storage.removeItem(name)\n  };\n  return persistStorage;\n}\nconst toThenable = (fn) => (input) => {\n  try {\n    const result = fn(input);\n    if (result instanceof Promise) {\n      return result;\n    }\n    return {\n      then(onFulfilled) {\n        return toThenable(onFulfilled)(result);\n      },\n      catch(_onRejected) {\n        return this;\n      }\n    };\n  } catch (e) {\n    return {\n      then(_onFulfilled) {\n        return this;\n      },\n      catch(onRejected) {\n        return toThenable(onRejected)(e);\n      }\n    };\n  }\n};\nconst oldImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    getStorage: () => localStorage,\n    serialize: JSON.stringify,\n    deserialize: JSON.parse,\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage;\n  try {\n    storage = options.getStorage();\n  } catch (_e) {\n  }\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const thenableSerialize = toThenable(options.serialize);\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    let errorInSync;\n    const thenable = thenableSerialize({ state, version: options.version }).then(\n      (serializedValue) => storage.setItem(options.name, serializedValue)\n    ).catch((e) => {\n      errorInSync = e;\n    });\n    if (errorInSync) {\n      throw errorInSync;\n    }\n    return thenable;\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => cb(get()));\n    const postRehydrationCallback = ((_a = options.onRehydrateStorage) == null ? void 0 : _a.call(options, get())) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((storageValue) => {\n      if (storageValue) {\n        return options.deserialize(storageValue);\n      }\n    }).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return options.migrate(\n              deserializedStorageValue.state,\n              deserializedStorageValue.version\n            );\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return deserializedStorageValue.state;\n        }\n      }\n    }).then((migratedState) => {\n      var _a2;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      return setItem();\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.getStorage) {\n        storage = newOptions.getStorage();\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  hydrate();\n  return stateFromStorage || configResult;\n};\nconst newImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    storage: createJSONStorage(() => localStorage),\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage = options.storage;\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    return storage.setItem(options.name, {\n      state,\n      version: options.version\n    });\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  api.getInitialState = () => configResult;\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a, _b;\n    if (!storage) return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => {\n      var _a2;\n      return cb((_a2 = get()) != null ? _a2 : configResult);\n    });\n    const postRehydrationCallback = ((_b = options.onRehydrateStorage) == null ? void 0 : _b.call(options, (_a = get()) != null ? _a : configResult)) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return [\n              true,\n              options.migrate(\n                deserializedStorageValue.state,\n                deserializedStorageValue.version\n              )\n            ];\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return [false, deserializedStorageValue.state];\n        }\n      }\n      return [false, void 0];\n    }).then((migrationResult) => {\n      var _a2;\n      const [migrated, migratedState] = migrationResult;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      if (migrated) {\n        return setItem();\n      }\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      stateFromStorage = get();\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.storage) {\n        storage = newOptions.storage;\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  if (!options.skipHydration) {\n    hydrate();\n  }\n  return stateFromStorage || configResult;\n};\nconst persistImpl = (config, baseOptions) => {\n  if (\"getStorage\" in baseOptions || \"serialize\" in baseOptions || \"deserialize\" in baseOptions) {\n    if ((import.meta.env ? import.meta.env.MODE : void 0) !== \"production\") {\n      console.warn(\n        \"[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead.\"\n      );\n    }\n    return oldImpl(config, baseOptions);\n  }\n  return newImpl(config, baseOptions);\n};\nconst persist = persistImpl;\n\nexport { combine, createJSONStorage, devtools, persist, redux, subscribeWithSelector };\n","import type { AxiosInstance, AxiosRequestConfig, AxiosResponse } from \"axios\";\r\n\r\n/**\r\n * DEV-only Axios metrics instrumentation.\r\n * - Logs bursts of identical requests within a short window.\r\n * - Counts in-flight per URL.\r\n * - No-ops in production.\r\n */\r\n\r\ntype Counters = {\r\n  inflight: number;\r\n  recentTimestamps: number[]; // unix ms\r\n};\r\n\r\nconst registry: Record<string, Counters> = {};\r\nconst WINDOW_MS = 2000; // burst window\r\nconst BURST_THRESHOLD = 5;\r\n\r\nfunction getKey(config: AxiosRequestConfig): string {\r\n  const method = (config.method || \"get\").toUpperCase();\r\n  const url = config.baseURL ? `${config.baseURL}${config.url}` : config.url || \"\";\r\n  return `${method} ${url}`;\r\n}\r\n\r\nfunction pruneOld(timestamps: number[], now: number) {\r\n  while (timestamps.length > 0 && now - timestamps[0] > WINDOW_MS) {\r\n    timestamps.shift();\r\n  }\r\n}\r\n\r\nexport function attachMetrics(api: AxiosInstance, name: string) {\r\n  // Jest/Node-safe dev check (avoid import.meta which breaks CJS parsing)\r\n  const isProd =\r\n    (typeof process !== \"undefined\" && (process as any)?.env?.NODE_ENV === \"production\") || false;\r\n  if (isProd) {\r\n    // Only instrument in dev\r\n    return;\r\n  }\r\n\r\n  // Attach once per instance\r\n  const anyApi = api as any;\r\n  if (anyApi.__metricsAttached) return;\r\n  anyApi.__metricsAttached = true;\r\n\r\n  api.interceptors.request.use((config) => {\r\n    const key = getKey(config);\r\n    const now = Date.now();\r\n\r\n    if (!registry[key]) {\r\n      registry[key] = { inflight: 0, recentTimestamps: [] };\r\n    }\r\n    const entry = registry[key];\r\n    entry.inflight += 1;\r\n    entry.recentTimestamps.push(now);\r\n    pruneOld(entry.recentTimestamps, now);\r\n\r\n    if (entry.recentTimestamps.length >= BURST_THRESHOLD) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn(\r\n        `[http-metrics:${name}] Burst detected: ${entry.recentTimestamps.length} requests in ${WINDOW_MS}ms for ${key}`\r\n      );\r\n    }\r\n\r\n    // eslint-disable-next-line no-console\r\n    console.debug(`[http-metrics:${name}] > start (${entry.inflight} inflight) ${key}`);\r\n    return config;\r\n  });\r\n\r\n  api.interceptors.response.use(\r\n    (response: AxiosResponse) => {\r\n      const key = getKey(response.config);\r\n      const entry = registry[key];\r\n      if (entry) {\r\n        entry.inflight = Math.max(0, entry.inflight - 1);\r\n        // eslint-disable-next-line no-console\r\n        console.debug(`[http-metrics:${name}] < ok (${entry.inflight} inflight) ${key} [${response.status}]`);\r\n      }\r\n      return response;\r\n    },\r\n    (error) => {\r\n      try {\r\n        const cfg: AxiosRequestConfig | undefined = error?.config;\r\n        if (cfg) {\r\n          const key = getKey(cfg);\r\n          const entry = registry[key];\r\n          if (entry) {\r\n            entry.inflight = Math.max(0, entry.inflight - 1);\r\n            const status = error?.response?.status ?? \"ERR\";\r\n            // eslint-disable-next-line no-console\r\n            console.debug(`[http-metrics:${name}] < err (${entry.inflight} inflight) ${key} [${status}]`);\r\n          }\r\n        }\r\n      } catch {\r\n        // ignore\r\n      }\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n}\r\n","/**\r\n * In-memory access token provider for the renderer process.\r\n * Do NOT persist tokens to disk. Desktop refresh token lives in OS keychain (via Electron main).\r\n */\r\nlet currentToken: string | null = null;\r\n\r\nexport function setToken(token: string | null) {\r\n  currentToken = token ?? null;\r\n}\r\n\r\nexport function getToken(): string | null {\r\n  return currentToken;\r\n}\r\n\r\nexport function clearToken() {\r\n  currentToken = null;\r\n}\r\n","import axios from 'axios';\r\nimport { ApiResponse, AuthResponse } from '@game/shared';\r\nimport { attachMetrics } from './httpInstrumentation';\r\nimport { getToken as getMemToken, setToken as setMemToken, clearToken as clearMemToken } from './tokenProvider';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\n/* Create axios instance with default config */\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\nattachMetrics(api, 'auth');\r\n\r\nlet isRefreshing = false;\r\nlet tokenExpiry: number | null = null;\r\nlet proactiveRefreshTimer: NodeJS.Timeout | null = null;\r\n\r\n// Decode JWT token to get expiration\r\nconst decodeToken = (token: string): { exp?: number; iat?: number } | null => {\r\n  try {\r\n    const base64Url = token.split('.')[1];\r\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\r\n      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r\n    }).join(''));\r\n    return JSON.parse(jsonPayload);\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\n// Set up proactive token refresh (5 minutes before expiration)\r\nconst scheduleTokenRefresh = (token: string) => {\r\n  if (proactiveRefreshTimer) {\r\n    clearTimeout(proactiveRefreshTimer);\r\n    proactiveRefreshTimer = null;\r\n  }\r\n  \r\n  const decoded = decodeToken(token);\r\n  if (decoded?.exp) {\r\n    tokenExpiry = decoded.exp * 1000; // Convert to milliseconds\r\n    const now = Date.now();\r\n    const refreshTime = tokenExpiry - (5 * 60 * 1000); // 5 minutes before expiration\r\n    const delay = refreshTime - now;\r\n    \r\n    if (delay > 0 && delay < (24 * 60 * 60 * 1000)) { // Don't schedule more than 24 hours ahead\r\n      console.log(`[AUTH] Scheduling proactive token refresh in ${Math.round(delay / 1000)}s`);\r\n      proactiveRefreshTimer = setTimeout(async () => {\r\n        console.log('[AUTH] Proactive token refresh triggered');\r\n        await performTokenRefresh();\r\n      }, delay);\r\n    }\r\n  }\r\n};\r\n\r\n// Enhanced token refresh function\r\nconst performTokenRefresh = async (): Promise<string | null> => {\r\n  if (isRefreshing) {\r\n    console.log('[AUTH] Refresh already in progress, waiting...');\r\n    return null;\r\n  }\r\n  \r\n  try {\r\n    isRefreshing = true;\r\n    console.log('[AUTH] Performing token refresh...');\r\n    \r\n    if (typeof window !== 'undefined' && window.desktop?.auth?.refresh) {\r\n      const result = await window.desktop.auth.refresh();\r\n      if (result?.ok && result.token) {\r\n        setMemToken(result.token);\r\n        scheduleTokenRefresh(result.token);\r\n        console.log('[AUTH] Token refreshed successfully');\r\n        return result.token;\r\n      }\r\n    }\r\n    \r\n    console.warn('[AUTH] Token refresh failed');\r\n    return null;\r\n  } catch (error) {\r\n    console.error('[AUTH] Token refresh error:', error);\r\n    return null;\r\n  } finally {\r\n    isRefreshing = false;\r\n  }\r\n};\r\n\r\n// Enhanced setToken function that schedules refresh\r\nconst setTokenWithScheduling = (token: string) => {\r\n  setMemToken(token);\r\n  scheduleTokenRefresh(token);\r\n};\r\n\r\napi.interceptors.request.use(async (config) => {\r\n  // Access token lives in memory only for desktop\r\n  const bearer = getMemToken();\r\n  \r\n  if (bearer) {\r\n    // Check if token is close to expiring (within 2 minutes)\r\n    const decoded = decodeToken(bearer);\r\n    if (decoded?.exp) {\r\n      const now = Date.now() / 1000;\r\n      const timeLeft = decoded.exp - now;\r\n      \r\n      // If token expires in less than 2 minutes, try to refresh it\r\n      if (timeLeft < 120 && !isRefreshing) {\r\n        console.log(`[AUTH] Token expires in ${Math.round(timeLeft)}s, attempting refresh...`);\r\n        const newToken = await performTokenRefresh();\r\n        if (newToken) {\r\n          config.headers = config.headers ?? {};\r\n          (config.headers as any).Authorization = `Bearer ${newToken}`;\r\n          return config;\r\n        }\r\n      }\r\n    }\r\n    \r\n    config.headers = config.headers ?? {};\r\n    (config.headers as any).Authorization = `Bearer ${bearer}`;\r\n  }\r\n  \r\n  return config;\r\n});\r\n\r\n// Handle auth errors (attempt desktop refresh once, then redirect)\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    const status = error?.response?.status;\r\n    const original = error?.config || {};\r\n    \r\n    // Enhanced 401 handling with better retry logic\r\n    if (status === 401 && !original._retry && typeof window !== 'undefined' && window.desktop?.auth?.refresh) {\r\n      original._retry = true;\r\n      \r\n      console.log('[AUTH] 401 response, attempting token refresh...');\r\n      const newToken = await performTokenRefresh();\r\n      \r\n      if (newToken) {\r\n        console.log('[AUTH] Retrying original request with new token');\r\n        // Retry original request with new token\r\n        original.headers = original.headers || {};\r\n        (original.headers as any).Authorization = `Bearer ${newToken}`;\r\n        return api.request(original);\r\n      }\r\n    }\r\n\r\n    if (status === 401) {\r\n      // Clear any persisted web storage (if present) and memory token, then navigate to login\r\n      try { localStorage.removeItem('auth-storage'); } catch {}\r\n      try { clearMemToken(); } catch {}\r\n      try {\r\n        if (window.desktop?.tokens?.deleteRefresh) {\r\n          await window.desktop.tokens.deleteRefresh();\r\n        }\r\n      } catch {}\r\n      if (typeof window !== 'undefined') {\r\n        if (window.location.protocol === 'file:') {\r\n          // Electron/desktop uses HashRouter; avoid file:///C:/login\r\n          window.location.hash = '#/login';\r\n        } else {\r\n          window.location.href = '/login';\r\n        }\r\n      }\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n/* In-flight and TTL cache for getProfile */\r\nlet inflightGetProfile: Promise<ApiResponse<{ user: any; empire: any }>> | null = null;\r\nlet lastProfile: ApiResponse<{ user: any; empire: any }> | null = null;\r\nlet lastProfileTs = 0;\r\nconst PROFILE_TTL_MS = 5000;\r\n\r\nexport const authService = {\r\n  async login(email: string, password: string): Promise<ApiResponse<AuthResponse>> {\r\n    try {\r\n      // Desktop path: perform login via main IPC so refresh token never touches renderer\r\n      if (typeof window !== 'undefined' && window.desktop?.auth?.login) {\r\n        const resp = await window.desktop.auth.login(email, password);\r\n      if (resp?.success && (resp as any).data?.token) {\r\n        setTokenWithScheduling((resp as any).data.token as string);\r\n      }\r\n        return resp as ApiResponse<AuthResponse>;\r\n      }\r\n\r\n      // Web fallback: call API directly\r\n      const response = await api.post<ApiResponse<AuthResponse>>('/auth/login', {\r\n        email,\r\n        password,\r\n      });\r\n\r\n      const data = response.data;\r\n      // Keep access token in memory only\r\n      if (data?.success && (data as any).data?.token) {\r\n        setTokenWithScheduling((data as any).data.token as string);\r\n      }\r\n      return data;\r\n    } catch (error) {\r\n      if (axios.isAxiosError(error) && error.response) {\r\n        return error.response.data;\r\n      }\r\n      throw new Error('Network error occurred');\r\n    }\r\n  },\r\n\r\n  async register(email: string, username: string, password: string): Promise<ApiResponse<AuthResponse>> {\r\n    try {\r\n      // Desktop path: perform register via main IPC so refresh token never touches renderer\r\n      if (typeof window !== 'undefined' && window.desktop?.auth?.register) {\r\n        const resp = await window.desktop.auth.register(email, username, password);\r\n      if (resp?.success && (resp as any).data?.token) {\r\n        setTokenWithScheduling((resp as any).data.token as string);\r\n      }\r\n        return resp as ApiResponse<AuthResponse>;\r\n      }\r\n\r\n      // Web fallback: call API directly\r\n      const response = await api.post<ApiResponse<AuthResponse>>('/auth/register', {\r\n        email,\r\n        username,\r\n        password,\r\n      });\r\n      const data = response.data;\r\n      if (data?.success && (data as any).data?.token) {\r\n        setTokenWithScheduling((data as any).data.token as string);\r\n      }\r\n      return data;\r\n    } catch (error) {\r\n      if (axios.isAxiosError(error) && error.response) {\r\n        return error.response.data;\r\n      }\r\n      throw new Error('Network error occurred');\r\n    }\r\n  },\r\n\r\n  async getProfile(force: boolean = false): Promise<ApiResponse<{ user: any; empire: any }>> {\r\n    const now = Date.now();\r\n\r\n    // Serve from short TTL cache to prevent bursts\r\n    if (!force && lastProfile && now - lastProfileTs < PROFILE_TTL_MS) {\r\n      return lastProfile;\r\n    }\r\n\r\n    // Coalesce concurrent /auth/me calls\r\n    if (!force && inflightGetProfile) {\r\n      return await inflightGetProfile;\r\n    }\r\n\r\n    if (force) {\r\n      inflightGetProfile = null;\r\n    }\r\n    inflightGetProfile = (async () => {\r\n      try {\r\n        const response = await api.get<ApiResponse<{ user: any; empire: any }>>('/auth/me');\r\n        const data = response.data;\r\n        if (data && data.success) {\r\n          lastProfile = data;\r\n          lastProfileTs = Date.now();\r\n        }\r\n        return data;\r\n      } catch (error) {\r\n        if (axios.isAxiosError(error) && error.response) {\r\n          return error.response.data as ApiResponse<{ user: any; empire: any }>;\r\n        }\r\n        throw new Error('Network error occurred');\r\n      } finally {\r\n        inflightGetProfile = null;\r\n      }\r\n    })();\r\n\r\n    return await inflightGetProfile;\r\n  },\r\n\r\n  async logout(): Promise<void> {\r\n    try {\r\n      await api.post('/auth/logout');\r\n    } catch (error) {\r\n      // Ignore logout errors, just clear local storage\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      // Clear token refresh timer\r\n      if (proactiveRefreshTimer) {\r\n        clearTimeout(proactiveRefreshTimer);\r\n        proactiveRefreshTimer = null;\r\n      }\r\n      tokenExpiry = null;\r\n      \r\n      // Clear tokens\r\n      clearMemToken();\r\n      localStorage.removeItem('auth-storage');\r\n      \r\n      // Clear refresh token from desktop\r\n      if (typeof window !== 'undefined' && window.desktop?.tokens?.deleteRefresh) {\r\n        try {\r\n          await window.desktop.tokens.deleteRefresh();\r\n        } catch (error) {\r\n          console.error('Error clearing refresh token:', error);\r\n        }\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nexport default authService;\r\n","const PACKET_TYPES = Object.create(null); // no Map = no polyfill\nPACKET_TYPES[\"open\"] = \"0\";\nPACKET_TYPES[\"close\"] = \"1\";\nPACKET_TYPES[\"ping\"] = \"2\";\nPACKET_TYPES[\"pong\"] = \"3\";\nPACKET_TYPES[\"message\"] = \"4\";\nPACKET_TYPES[\"upgrade\"] = \"5\";\nPACKET_TYPES[\"noop\"] = \"6\";\nconst PACKET_TYPES_REVERSE = Object.create(null);\nObject.keys(PACKET_TYPES).forEach((key) => {\n    PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;\n});\nconst ERROR_PACKET = { type: \"error\", data: \"parser error\" };\nexport { PACKET_TYPES, PACKET_TYPES_REVERSE, ERROR_PACKET };\n","import { PACKET_TYPES } from \"./commons.js\";\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        Object.prototype.toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\n// ArrayBuffer.isView method is not defined in IE10\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj && obj.buffer instanceof ArrayBuffer;\n};\nconst encodePacket = ({ type, data }, supportsBinary, callback) => {\n    if (withNativeBlob && data instanceof Blob) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(data, callback);\n        }\n    }\n    else if (withNativeArrayBuffer &&\n        (data instanceof ArrayBuffer || isView(data))) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(new Blob([data]), callback);\n        }\n    }\n    // plain string\n    return callback(PACKET_TYPES[type] + (data || \"\"));\n};\nconst encodeBlobAsBase64 = (data, callback) => {\n    const fileReader = new FileReader();\n    fileReader.onload = function () {\n        const content = fileReader.result.split(\",\")[1];\n        callback(\"b\" + (content || \"\"));\n    };\n    return fileReader.readAsDataURL(data);\n};\nfunction toArray(data) {\n    if (data instanceof Uint8Array) {\n        return data;\n    }\n    else if (data instanceof ArrayBuffer) {\n        return new Uint8Array(data);\n    }\n    else {\n        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n}\nlet TEXT_ENCODER;\nexport function encodePacketToBinary(packet, callback) {\n    if (withNativeBlob && packet.data instanceof Blob) {\n        return packet.data.arrayBuffer().then(toArray).then(callback);\n    }\n    else if (withNativeArrayBuffer &&\n        (packet.data instanceof ArrayBuffer || isView(packet.data))) {\n        return callback(toArray(packet.data));\n    }\n    encodePacket(packet, false, (encoded) => {\n        if (!TEXT_ENCODER) {\n            TEXT_ENCODER = new TextEncoder();\n        }\n        callback(TEXT_ENCODER.encode(encoded));\n    });\n}\nexport { encodePacket };\n","// imported from https://github.com/socketio/base64-arraybuffer\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nconst lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (let i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nexport const encode = (arraybuffer) => {\n    let bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nexport const decode = (base64) => {\n    let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\n","import { ERROR_PACKET, PACKET_TYPES_REVERSE, } from \"./commons.js\";\nimport { decode } from \"./contrib/base64-arraybuffer.js\";\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nexport const decodePacket = (encodedPacket, binaryType) => {\n    if (typeof encodedPacket !== \"string\") {\n        return {\n            type: \"message\",\n            data: mapBinary(encodedPacket, binaryType),\n        };\n    }\n    const type = encodedPacket.charAt(0);\n    if (type === \"b\") {\n        return {\n            type: \"message\",\n            data: decodeBase64Packet(encodedPacket.substring(1), binaryType),\n        };\n    }\n    const packetType = PACKET_TYPES_REVERSE[type];\n    if (!packetType) {\n        return ERROR_PACKET;\n    }\n    return encodedPacket.length > 1\n        ? {\n            type: PACKET_TYPES_REVERSE[type],\n            data: encodedPacket.substring(1),\n        }\n        : {\n            type: PACKET_TYPES_REVERSE[type],\n        };\n};\nconst decodeBase64Packet = (data, binaryType) => {\n    if (withNativeArrayBuffer) {\n        const decoded = decode(data);\n        return mapBinary(decoded, binaryType);\n    }\n    else {\n        return { base64: true, data }; // fallback for old browsers\n    }\n};\nconst mapBinary = (data, binaryType) => {\n    switch (binaryType) {\n        case \"blob\":\n            if (data instanceof Blob) {\n                // from WebSocket + binaryType \"blob\"\n                return data;\n            }\n            else {\n                // from HTTP long-polling or WebTransport\n                return new Blob([data]);\n            }\n        case \"arraybuffer\":\n        default:\n            if (data instanceof ArrayBuffer) {\n                // from HTTP long-polling (base64) or WebSocket + binaryType \"arraybuffer\"\n                return data;\n            }\n            else {\n                // from WebTransport (Uint8Array)\n                return data.buffer;\n            }\n    }\n};\n","import { encodePacket, encodePacketToBinary } from \"./encodePacket.js\";\nimport { decodePacket } from \"./decodePacket.js\";\nimport { ERROR_PACKET, } from \"./commons.js\";\nconst SEPARATOR = String.fromCharCode(30); // see https://en.wikipedia.org/wiki/Delimiter#ASCII_delimited_text\nconst encodePayload = (packets, callback) => {\n    // some packets may be added to the array while encoding, so the initial length must be saved\n    const length = packets.length;\n    const encodedPackets = new Array(length);\n    let count = 0;\n    packets.forEach((packet, i) => {\n        // force base64 encoding for binary packets\n        encodePacket(packet, false, (encodedPacket) => {\n            encodedPackets[i] = encodedPacket;\n            if (++count === length) {\n                callback(encodedPackets.join(SEPARATOR));\n            }\n        });\n    });\n};\nconst decodePayload = (encodedPayload, binaryType) => {\n    const encodedPackets = encodedPayload.split(SEPARATOR);\n    const packets = [];\n    for (let i = 0; i < encodedPackets.length; i++) {\n        const decodedPacket = decodePacket(encodedPackets[i], binaryType);\n        packets.push(decodedPacket);\n        if (decodedPacket.type === \"error\") {\n            break;\n        }\n    }\n    return packets;\n};\nexport function createPacketEncoderStream() {\n    return new TransformStream({\n        transform(packet, controller) {\n            encodePacketToBinary(packet, (encodedPacket) => {\n                const payloadLength = encodedPacket.length;\n                let header;\n                // inspired by the WebSocket format: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#decoding_payload_length\n                if (payloadLength < 126) {\n                    header = new Uint8Array(1);\n                    new DataView(header.buffer).setUint8(0, payloadLength);\n                }\n                else if (payloadLength < 65536) {\n                    header = new Uint8Array(3);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 126);\n                    view.setUint16(1, payloadLength);\n                }\n                else {\n                    header = new Uint8Array(9);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 127);\n                    view.setBigUint64(1, BigInt(payloadLength));\n                }\n                // first bit indicates whether the payload is plain text (0) or binary (1)\n                if (packet.data && typeof packet.data !== \"string\") {\n                    header[0] |= 0x80;\n                }\n                controller.enqueue(header);\n                controller.enqueue(encodedPacket);\n            });\n        },\n    });\n}\nlet TEXT_DECODER;\nfunction totalLength(chunks) {\n    return chunks.reduce((acc, chunk) => acc + chunk.length, 0);\n}\nfunction concatChunks(chunks, size) {\n    if (chunks[0].length === size) {\n        return chunks.shift();\n    }\n    const buffer = new Uint8Array(size);\n    let j = 0;\n    for (let i = 0; i < size; i++) {\n        buffer[i] = chunks[0][j++];\n        if (j === chunks[0].length) {\n            chunks.shift();\n            j = 0;\n        }\n    }\n    if (chunks.length && j < chunks[0].length) {\n        chunks[0] = chunks[0].slice(j);\n    }\n    return buffer;\n}\nexport function createPacketDecoderStream(maxPayload, binaryType) {\n    if (!TEXT_DECODER) {\n        TEXT_DECODER = new TextDecoder();\n    }\n    const chunks = [];\n    let state = 0 /* State.READ_HEADER */;\n    let expectedLength = -1;\n    let isBinary = false;\n    return new TransformStream({\n        transform(chunk, controller) {\n            chunks.push(chunk);\n            while (true) {\n                if (state === 0 /* State.READ_HEADER */) {\n                    if (totalLength(chunks) < 1) {\n                        break;\n                    }\n                    const header = concatChunks(chunks, 1);\n                    isBinary = (header[0] & 0x80) === 0x80;\n                    expectedLength = header[0] & 0x7f;\n                    if (expectedLength < 126) {\n                        state = 3 /* State.READ_PAYLOAD */;\n                    }\n                    else if (expectedLength === 126) {\n                        state = 1 /* State.READ_EXTENDED_LENGTH_16 */;\n                    }\n                    else {\n                        state = 2 /* State.READ_EXTENDED_LENGTH_64 */;\n                    }\n                }\n                else if (state === 1 /* State.READ_EXTENDED_LENGTH_16 */) {\n                    if (totalLength(chunks) < 2) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 2);\n                    expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else if (state === 2 /* State.READ_EXTENDED_LENGTH_64 */) {\n                    if (totalLength(chunks) < 8) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 8);\n                    const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);\n                    const n = view.getUint32(0);\n                    if (n > Math.pow(2, 53 - 32) - 1) {\n                        // the maximum safe integer in JavaScript is 2^53 - 1\n                        controller.enqueue(ERROR_PACKET);\n                        break;\n                    }\n                    expectedLength = n * Math.pow(2, 32) + view.getUint32(4);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else {\n                    if (totalLength(chunks) < expectedLength) {\n                        break;\n                    }\n                    const data = concatChunks(chunks, expectedLength);\n                    controller.enqueue(decodePacket(isBinary ? data : TEXT_DECODER.decode(data), binaryType));\n                    state = 0 /* State.READ_HEADER */;\n                }\n                if (expectedLength === 0 || expectedLength > maxPayload) {\n                    controller.enqueue(ERROR_PACKET);\n                    break;\n                }\n            }\n        },\n    });\n}\nexport const protocol = 4;\nexport { encodePacket, encodePayload, decodePacket, decodePayload, };\n","/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nexport function Emitter(obj) {\n  if (obj) return mixin(obj);\n}\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n\n  // Remove event specific arrays for event types that no\n  // one is subscribed for to avoid memory leak.\n  if (callbacks.length === 0) {\n    delete this._callbacks['$' + event];\n  }\n\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n\n  var args = new Array(arguments.length - 1)\n    , callbacks = this._callbacks['$' + event];\n\n  for (var i = 1; i < arguments.length; i++) {\n    args[i - 1] = arguments[i];\n  }\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n// alias used for reserved events (protected method)\nEmitter.prototype.emitReserved = Emitter.prototype.emit;\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n","export const nextTick = (() => {\n    const isPromiseAvailable = typeof Promise === \"function\" && typeof Promise.resolve === \"function\";\n    if (isPromiseAvailable) {\n        return (cb) => Promise.resolve().then(cb);\n    }\n    else {\n        return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);\n    }\n})();\nexport const globalThisShim = (() => {\n    if (typeof self !== \"undefined\") {\n        return self;\n    }\n    else if (typeof window !== \"undefined\") {\n        return window;\n    }\n    else {\n        return Function(\"return this\")();\n    }\n})();\nexport const defaultBinaryType = \"arraybuffer\";\nexport function createCookieJar() { }\n","import { globalThisShim as globalThis } from \"./globals.node.js\";\nexport function pick(obj, ...attr) {\n    return attr.reduce((acc, k) => {\n        if (obj.hasOwnProperty(k)) {\n            acc[k] = obj[k];\n        }\n        return acc;\n    }, {});\n}\n// Keep a reference to the real timeout functions so they can be used when overridden\nconst NATIVE_SET_TIMEOUT = globalThis.setTimeout;\nconst NATIVE_CLEAR_TIMEOUT = globalThis.clearTimeout;\nexport function installTimerFunctions(obj, opts) {\n    if (opts.useNativeTimers) {\n        obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globalThis);\n        obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globalThis);\n    }\n    else {\n        obj.setTimeoutFn = globalThis.setTimeout.bind(globalThis);\n        obj.clearTimeoutFn = globalThis.clearTimeout.bind(globalThis);\n    }\n}\n// base64 encoded buffers are about 33% bigger (https://en.wikipedia.org/wiki/Base64)\nconst BASE64_OVERHEAD = 1.33;\n// we could also have used `new Blob([obj]).size`, but it isn't supported in IE9\nexport function byteLength(obj) {\n    if (typeof obj === \"string\") {\n        return utf8Length(obj);\n    }\n    // arraybuffer or blob\n    return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);\n}\nfunction utf8Length(str) {\n    let c = 0, length = 0;\n    for (let i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length;\n}\n/**\n * Generates a random 8-characters string.\n */\nexport function randomString() {\n    return (Date.now().toString(36).substring(3) +\n        Math.random().toString(36).substring(2, 5));\n}\n","import { decodePacket } from \"engine.io-parser\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions } from \"./util.js\";\nimport { encode } from \"./contrib/parseqs.js\";\nexport class TransportError extends Error {\n    constructor(reason, description, context) {\n        super(reason);\n        this.description = description;\n        this.context = context;\n        this.type = \"TransportError\";\n    }\n}\nexport class Transport extends Emitter {\n    /**\n     * Transport abstract constructor.\n     *\n     * @param {Object} opts - options\n     * @protected\n     */\n    constructor(opts) {\n        super();\n        this.writable = false;\n        installTimerFunctions(this, opts);\n        this.opts = opts;\n        this.query = opts.query;\n        this.socket = opts.socket;\n        this.supportsBinary = !opts.forceBase64;\n    }\n    /**\n     * Emits an error.\n     *\n     * @param {String} reason\n     * @param description\n     * @param context - the error context\n     * @return {Transport} for chaining\n     * @protected\n     */\n    onError(reason, description, context) {\n        super.emitReserved(\"error\", new TransportError(reason, description, context));\n        return this;\n    }\n    /**\n     * Opens the transport.\n     */\n    open() {\n        this.readyState = \"opening\";\n        this.doOpen();\n        return this;\n    }\n    /**\n     * Closes the transport.\n     */\n    close() {\n        if (this.readyState === \"opening\" || this.readyState === \"open\") {\n            this.doClose();\n            this.onClose();\n        }\n        return this;\n    }\n    /**\n     * Sends multiple packets.\n     *\n     * @param {Array} packets\n     */\n    send(packets) {\n        if (this.readyState === \"open\") {\n            this.write(packets);\n        }\n        else {\n            // this might happen if the transport was silently closed in the beforeunload event handler\n        }\n    }\n    /**\n     * Called upon open\n     *\n     * @protected\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        this.writable = true;\n        super.emitReserved(\"open\");\n    }\n    /**\n     * Called with data.\n     *\n     * @param {String} data\n     * @protected\n     */\n    onData(data) {\n        const packet = decodePacket(data, this.socket.binaryType);\n        this.onPacket(packet);\n    }\n    /**\n     * Called with a decoded packet.\n     *\n     * @protected\n     */\n    onPacket(packet) {\n        super.emitReserved(\"packet\", packet);\n    }\n    /**\n     * Called upon close.\n     *\n     * @protected\n     */\n    onClose(details) {\n        this.readyState = \"closed\";\n        super.emitReserved(\"close\", details);\n    }\n    /**\n     * Pauses the transport, in order not to lose packets during an upgrade.\n     *\n     * @param onPause\n     */\n    pause(onPause) { }\n    createUri(schema, query = {}) {\n        return (schema +\n            \"://\" +\n            this._hostname() +\n            this._port() +\n            this.opts.path +\n            this._query(query));\n    }\n    _hostname() {\n        const hostname = this.opts.hostname;\n        return hostname.indexOf(\":\") === -1 ? hostname : \"[\" + hostname + \"]\";\n    }\n    _port() {\n        if (this.opts.port &&\n            ((this.opts.secure && Number(this.opts.port !== 443)) ||\n                (!this.opts.secure && Number(this.opts.port) !== 80))) {\n            return \":\" + this.opts.port;\n        }\n        else {\n            return \"\";\n        }\n    }\n    _query(query) {\n        const encodedQuery = encode(query);\n        return encodedQuery.length ? \"?\" + encodedQuery : \"\";\n    }\n}\n","// imported from https://github.com/galkn/querystring\n/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\nexport function encode(obj) {\n    let str = '';\n    for (let i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (str.length)\n                str += '&';\n            str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n        }\n    }\n    return str;\n}\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\nexport function decode(qs) {\n    let qry = {};\n    let pairs = qs.split('&');\n    for (let i = 0, l = pairs.length; i < l; i++) {\n        let pair = pairs[i].split('=');\n        qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n    return qry;\n}\n","import { Transport } from \"../transport.js\";\nimport { randomString } from \"../util.js\";\nimport { encodePayload, decodePayload } from \"engine.io-parser\";\nexport class Polling extends Transport {\n    constructor() {\n        super(...arguments);\n        this._polling = false;\n    }\n    get name() {\n        return \"polling\";\n    }\n    /**\n     * Opens the socket (triggers polling). We write a PING message to determine\n     * when the transport is open.\n     *\n     * @protected\n     */\n    doOpen() {\n        this._poll();\n    }\n    /**\n     * Pauses polling.\n     *\n     * @param {Function} onPause - callback upon buffers are flushed and transport is paused\n     * @package\n     */\n    pause(onPause) {\n        this.readyState = \"pausing\";\n        const pause = () => {\n            this.readyState = \"paused\";\n            onPause();\n        };\n        if (this._polling || !this.writable) {\n            let total = 0;\n            if (this._polling) {\n                total++;\n                this.once(\"pollComplete\", function () {\n                    --total || pause();\n                });\n            }\n            if (!this.writable) {\n                total++;\n                this.once(\"drain\", function () {\n                    --total || pause();\n                });\n            }\n        }\n        else {\n            pause();\n        }\n    }\n    /**\n     * Starts polling cycle.\n     *\n     * @private\n     */\n    _poll() {\n        this._polling = true;\n        this.doPoll();\n        this.emitReserved(\"poll\");\n    }\n    /**\n     * Overloads onData to detect payloads.\n     *\n     * @protected\n     */\n    onData(data) {\n        const callback = (packet) => {\n            // if its the first message we consider the transport open\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\n                this.onOpen();\n            }\n            // if its a close packet, we close the ongoing requests\n            if (\"close\" === packet.type) {\n                this.onClose({ description: \"transport closed by the server\" });\n                return false;\n            }\n            // otherwise bypass onData and handle the message\n            this.onPacket(packet);\n        };\n        // decode payload\n        decodePayload(data, this.socket.binaryType).forEach(callback);\n        // if an event did not trigger closing\n        if (\"closed\" !== this.readyState) {\n            // if we got data we're not polling\n            this._polling = false;\n            this.emitReserved(\"pollComplete\");\n            if (\"open\" === this.readyState) {\n                this._poll();\n            }\n            else {\n            }\n        }\n    }\n    /**\n     * For polling, send a close packet.\n     *\n     * @protected\n     */\n    doClose() {\n        const close = () => {\n            this.write([{ type: \"close\" }]);\n        };\n        if (\"open\" === this.readyState) {\n            close();\n        }\n        else {\n            // in case we're trying to close while\n            // handshaking is in progress (GH-164)\n            this.once(\"open\", close);\n        }\n    }\n    /**\n     * Writes a packets payload.\n     *\n     * @param {Array} packets - data packets\n     * @protected\n     */\n    write(packets) {\n        this.writable = false;\n        encodePayload(packets, (data) => {\n            this.doWrite(data, () => {\n                this.writable = true;\n                this.emitReserved(\"drain\");\n            });\n        });\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"https\" : \"http\";\n        const query = this.query || {};\n        // cache busting is forced\n        if (false !== this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = randomString();\n        }\n        if (!this.supportsBinary && !query.sid) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\n","// imported from https://github.com/component/has-cors\nlet value = false;\ntry {\n    value = typeof XMLHttpRequest !== 'undefined' &&\n        'withCredentials' in new XMLHttpRequest();\n}\ncatch (err) {\n    // if XMLHttp support is disabled in IE then it will throw\n    // when trying to create\n}\nexport const hasCORS = value;\n","import { Polling } from \"./polling.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions, pick } from \"../util.js\";\nimport { globalThisShim as globalThis } from \"../globals.node.js\";\nimport { hasCORS } from \"../contrib/has-cors.js\";\nfunction empty() { }\nexport class BaseXHR extends Polling {\n    /**\n     * XHR Polling constructor.\n     *\n     * @param {Object} opts\n     * @package\n     */\n    constructor(opts) {\n        super(opts);\n        if (typeof location !== \"undefined\") {\n            const isSSL = \"https:\" === location.protocol;\n            let port = location.port;\n            // some user agents have empty `location.port`\n            if (!port) {\n                port = isSSL ? \"443\" : \"80\";\n            }\n            this.xd =\n                (typeof location !== \"undefined\" &&\n                    opts.hostname !== location.hostname) ||\n                    port !== opts.port;\n        }\n    }\n    /**\n     * Sends data.\n     *\n     * @param {String} data to send.\n     * @param {Function} called upon flush.\n     * @private\n     */\n    doWrite(data, fn) {\n        const req = this.request({\n            method: \"POST\",\n            data: data,\n        });\n        req.on(\"success\", fn);\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr post error\", xhrStatus, context);\n        });\n    }\n    /**\n     * Starts a poll cycle.\n     *\n     * @private\n     */\n    doPoll() {\n        const req = this.request();\n        req.on(\"data\", this.onData.bind(this));\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr poll error\", xhrStatus, context);\n        });\n        this.pollXhr = req;\n    }\n}\nexport class Request extends Emitter {\n    /**\n     * Request constructor\n     *\n     * @param {Object} options\n     * @package\n     */\n    constructor(createRequest, uri, opts) {\n        super();\n        this.createRequest = createRequest;\n        installTimerFunctions(this, opts);\n        this._opts = opts;\n        this._method = opts.method || \"GET\";\n        this._uri = uri;\n        this._data = undefined !== opts.data ? opts.data : null;\n        this._create();\n    }\n    /**\n     * Creates the XHR object and sends the request.\n     *\n     * @private\n     */\n    _create() {\n        var _a;\n        const opts = pick(this._opts, \"agent\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"autoUnref\");\n        opts.xdomain = !!this._opts.xd;\n        const xhr = (this._xhr = this.createRequest(opts));\n        try {\n            xhr.open(this._method, this._uri, true);\n            try {\n                if (this._opts.extraHeaders) {\n                    // @ts-ignore\n                    xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);\n                    for (let i in this._opts.extraHeaders) {\n                        if (this._opts.extraHeaders.hasOwnProperty(i)) {\n                            xhr.setRequestHeader(i, this._opts.extraHeaders[i]);\n                        }\n                    }\n                }\n            }\n            catch (e) { }\n            if (\"POST\" === this._method) {\n                try {\n                    xhr.setRequestHeader(\"Content-type\", \"text/plain;charset=UTF-8\");\n                }\n                catch (e) { }\n            }\n            try {\n                xhr.setRequestHeader(\"Accept\", \"*/*\");\n            }\n            catch (e) { }\n            (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);\n            // ie6 check\n            if (\"withCredentials\" in xhr) {\n                xhr.withCredentials = this._opts.withCredentials;\n            }\n            if (this._opts.requestTimeout) {\n                xhr.timeout = this._opts.requestTimeout;\n            }\n            xhr.onreadystatechange = () => {\n                var _a;\n                if (xhr.readyState === 3) {\n                    (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(\n                    // @ts-ignore\n                    xhr.getResponseHeader(\"set-cookie\"));\n                }\n                if (4 !== xhr.readyState)\n                    return;\n                if (200 === xhr.status || 1223 === xhr.status) {\n                    this._onLoad();\n                }\n                else {\n                    // make sure the `error` event handler that's user-set\n                    // does not throw in the same tick and gets caught here\n                    this.setTimeoutFn(() => {\n                        this._onError(typeof xhr.status === \"number\" ? xhr.status : 0);\n                    }, 0);\n                }\n            };\n            xhr.send(this._data);\n        }\n        catch (e) {\n            // Need to defer since .create() is called directly from the constructor\n            // and thus the 'error' event can only be only bound *after* this exception\n            // occurs.  Therefore, also, we cannot throw here at all.\n            this.setTimeoutFn(() => {\n                this._onError(e);\n            }, 0);\n            return;\n        }\n        if (typeof document !== \"undefined\") {\n            this._index = Request.requestsCount++;\n            Request.requests[this._index] = this;\n        }\n    }\n    /**\n     * Called upon error.\n     *\n     * @private\n     */\n    _onError(err) {\n        this.emitReserved(\"error\", err, this._xhr);\n        this._cleanup(true);\n    }\n    /**\n     * Cleans up house.\n     *\n     * @private\n     */\n    _cleanup(fromError) {\n        if (\"undefined\" === typeof this._xhr || null === this._xhr) {\n            return;\n        }\n        this._xhr.onreadystatechange = empty;\n        if (fromError) {\n            try {\n                this._xhr.abort();\n            }\n            catch (e) { }\n        }\n        if (typeof document !== \"undefined\") {\n            delete Request.requests[this._index];\n        }\n        this._xhr = null;\n    }\n    /**\n     * Called upon load.\n     *\n     * @private\n     */\n    _onLoad() {\n        const data = this._xhr.responseText;\n        if (data !== null) {\n            this.emitReserved(\"data\", data);\n            this.emitReserved(\"success\");\n            this._cleanup();\n        }\n    }\n    /**\n     * Aborts the request.\n     *\n     * @package\n     */\n    abort() {\n        this._cleanup();\n    }\n}\nRequest.requestsCount = 0;\nRequest.requests = {};\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\nif (typeof document !== \"undefined\") {\n    // @ts-ignore\n    if (typeof attachEvent === \"function\") {\n        // @ts-ignore\n        attachEvent(\"onunload\", unloadHandler);\n    }\n    else if (typeof addEventListener === \"function\") {\n        const terminationEvent = \"onpagehide\" in globalThis ? \"pagehide\" : \"unload\";\n        addEventListener(terminationEvent, unloadHandler, false);\n    }\n}\nfunction unloadHandler() {\n    for (let i in Request.requests) {\n        if (Request.requests.hasOwnProperty(i)) {\n            Request.requests[i].abort();\n        }\n    }\n}\nconst hasXHR2 = (function () {\n    const xhr = newRequest({\n        xdomain: false,\n    });\n    return xhr && xhr.responseType !== null;\n})();\n/**\n * HTTP long-polling based on the built-in `XMLHttpRequest` object.\n *\n * Usage: browser\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n */\nexport class XHR extends BaseXHR {\n    constructor(opts) {\n        super(opts);\n        const forceBase64 = opts && opts.forceBase64;\n        this.supportsBinary = hasXHR2 && !forceBase64;\n    }\n    request(opts = {}) {\n        Object.assign(opts, { xd: this.xd }, this.opts);\n        return new Request(newRequest, this.uri(), opts);\n    }\n}\nfunction newRequest(opts) {\n    const xdomain = opts.xdomain;\n    // XMLHttpRequest can be disabled on IE\n    try {\n        if (\"undefined\" !== typeof XMLHttpRequest && (!xdomain || hasCORS)) {\n            return new XMLHttpRequest();\n        }\n    }\n    catch (e) { }\n    if (!xdomain) {\n        try {\n            return new globalThis[[\"Active\"].concat(\"Object\").join(\"X\")](\"Microsoft.XMLHTTP\");\n        }\n        catch (e) { }\n    }\n}\n","import { Transport } from \"../transport.js\";\nimport { pick, randomString } from \"../util.js\";\nimport { encodePacket } from \"engine.io-parser\";\nimport { globalThisShim as globalThis, nextTick } from \"../globals.node.js\";\n// detect ReactNative environment\nconst isReactNative = typeof navigator !== \"undefined\" &&\n    typeof navigator.product === \"string\" &&\n    navigator.product.toLowerCase() === \"reactnative\";\nexport class BaseWS extends Transport {\n    get name() {\n        return \"websocket\";\n    }\n    doOpen() {\n        const uri = this.uri();\n        const protocols = this.opts.protocols;\n        // React Native only supports the 'headers' option, and will print a warning if anything else is passed\n        const opts = isReactNative\n            ? {}\n            : pick(this.opts, \"agent\", \"perMessageDeflate\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"localAddress\", \"protocolVersion\", \"origin\", \"maxPayload\", \"family\", \"checkServerIdentity\");\n        if (this.opts.extraHeaders) {\n            opts.headers = this.opts.extraHeaders;\n        }\n        try {\n            this.ws = this.createSocket(uri, protocols, opts);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this.ws.binaryType = this.socket.binaryType;\n        this.addEventListeners();\n    }\n    /**\n     * Adds event listeners to the socket\n     *\n     * @private\n     */\n    addEventListeners() {\n        this.ws.onopen = () => {\n            if (this.opts.autoUnref) {\n                this.ws._socket.unref();\n            }\n            this.onOpen();\n        };\n        this.ws.onclose = (closeEvent) => this.onClose({\n            description: \"websocket connection closed\",\n            context: closeEvent,\n        });\n        this.ws.onmessage = (ev) => this.onData(ev.data);\n        this.ws.onerror = (e) => this.onError(\"websocket error\", e);\n    }\n    write(packets) {\n        this.writable = false;\n        // encodePacket efficient as it uses WS framing\n        // no need for encodePayload\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            encodePacket(packet, this.supportsBinary, (data) => {\n                // Sometimes the websocket has already been closed but the browser didn't\n                // have a chance of informing us about it yet, in that case send will\n                // throw an error\n                try {\n                    this.doWrite(packet, data);\n                }\n                catch (e) {\n                }\n                if (lastPacket) {\n                    // fake drain\n                    // defer to next tick to allow Socket to clear writeBuffer\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        if (typeof this.ws !== \"undefined\") {\n            this.ws.onerror = () => { };\n            this.ws.close();\n            this.ws = null;\n        }\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"wss\" : \"ws\";\n        const query = this.query || {};\n        // append timestamp to URI\n        if (this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = randomString();\n        }\n        // communicate binary support capabilities\n        if (!this.supportsBinary) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\nconst WebSocketCtor = globalThis.WebSocket || globalThis.MozWebSocket;\n/**\n * WebSocket transport based on the built-in `WebSocket` object.\n *\n * Usage: browser, Node.js (since v21), Deno, Bun\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n * @see https://caniuse.com/mdn-api_websocket\n * @see https://nodejs.org/api/globals.html#websocket\n */\nexport class WS extends BaseWS {\n    createSocket(uri, protocols, opts) {\n        return !isReactNative\n            ? protocols\n                ? new WebSocketCtor(uri, protocols)\n                : new WebSocketCtor(uri)\n            : new WebSocketCtor(uri, protocols, opts);\n    }\n    doWrite(_packet, data) {\n        this.ws.send(data);\n    }\n}\n","import { XHR } from \"./polling-xhr.node.js\";\nimport { WS } from \"./websocket.node.js\";\nimport { WT } from \"./webtransport.js\";\nexport const transports = {\n    websocket: WS,\n    webtransport: WT,\n    polling: XHR,\n};\n","import { Transport } from \"../transport.js\";\nimport { nextTick } from \"../globals.node.js\";\nimport { createPacketDecoderStream, createPacketEncoderStream, } from \"engine.io-parser\";\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nexport class WT extends Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        try {\n            // @ts-ignore\n            this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed\n            .then(() => {\n            this.onClose();\n        })\n            .catch((err) => {\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n            this._transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = createPacketEncoderStream();\n                encoderStream.readable.pipeTo(stream.writable);\n                this._writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            return;\n                        }\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this._writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this._writer.write(packet).then(() => {\n                if (lastPacket) {\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\n","// imported from https://github.com/galkn/parseuri\n/**\n * Parses a URI\n *\n * Note: we could also have used the built-in URL object, but it isn't supported on all platforms.\n *\n * See:\n * - https://developer.mozilla.org/en-US/docs/Web/API/URL\n * - https://caniuse.com/url\n * - https://www.rfc-editor.org/rfc/rfc3986#appendix-B\n *\n * History of the parse() method:\n * - first commit: https://github.com/socketio/socket.io-client/commit/4ee1d5d94b3906a9c052b459f1a818b15f38f91c\n * - export into its own module: https://github.com/socketio/engine.io-client/commit/de2c561e4564efeb78f1bdb1ba39ef81b2822cb3\n * - reimport: https://github.com/socketio/engine.io-client/commit/df32277c3f6d622eec5ed09f493cae3f3391d242\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\nconst re = /^(?:(?![^:@\\/?#]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@\\/?#]*)(?::([^:@\\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nconst parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\nexport function parse(str) {\n    if (str.length > 8000) {\n        throw \"URI too long\";\n    }\n    const src = str, b = str.indexOf('['), e = str.indexOf(']');\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n    let m = re.exec(str || ''), uri = {}, i = 14;\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n    uri.pathNames = pathNames(uri, uri['path']);\n    uri.queryKey = queryKey(uri, uri['query']);\n    return uri;\n}\nfunction pathNames(obj, path) {\n    const regx = /\\/{2,9}/g, names = path.replace(regx, \"/\").split(\"/\");\n    if (path.slice(0, 1) == '/' || path.length === 0) {\n        names.splice(0, 1);\n    }\n    if (path.slice(-1) == '/') {\n        names.splice(names.length - 1, 1);\n    }\n    return names;\n}\nfunction queryKey(uri, query) {\n    const data = {};\n    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {\n        if ($1) {\n            data[$1] = $2;\n        }\n    });\n    return data;\n}\n","import { transports as DEFAULT_TRANSPORTS } from \"./transports/index.js\";\nimport { installTimerFunctions, byteLength } from \"./util.js\";\nimport { decode } from \"./contrib/parseqs.js\";\nimport { parse } from \"./contrib/parseuri.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { protocol } from \"engine.io-parser\";\nimport { createCookieJar, defaultBinaryType, nextTick, } from \"./globals.node.js\";\nconst withEventListeners = typeof addEventListener === \"function\" &&\n    typeof removeEventListener === \"function\";\nconst OFFLINE_EVENT_LISTENERS = [];\nif (withEventListeners) {\n    // within a ServiceWorker, any event handler for the 'offline' event must be added on the initial evaluation of the\n    // script, so we create one single event listener here which will forward the event to the socket instances\n    addEventListener(\"offline\", () => {\n        OFFLINE_EVENT_LISTENERS.forEach((listener) => listener());\n    }, false);\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes without upgrade mechanism, which means that it will keep the first low-level transport that\n * successfully establishes the connection.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithoutUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithoutUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithUpgrade\n * @see Socket\n */\nexport class SocketWithoutUpgrade extends Emitter {\n    /**\n     * Socket constructor.\n     *\n     * @param {String|Object} uri - uri or options\n     * @param {Object} opts - options\n     */\n    constructor(uri, opts) {\n        super();\n        this.binaryType = defaultBinaryType;\n        this.writeBuffer = [];\n        this._prevBufferLen = 0;\n        this._pingInterval = -1;\n        this._pingTimeout = -1;\n        this._maxPayload = -1;\n        /**\n         * The expiration timestamp of the {@link _pingTimeoutTimer} object is tracked, in case the timer is throttled and the\n         * callback is not fired on time. This can happen for example when a laptop is suspended or when a phone is locked.\n         */\n        this._pingTimeoutTime = Infinity;\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = null;\n        }\n        if (uri) {\n            const parsedUri = parse(uri);\n            opts.hostname = parsedUri.host;\n            opts.secure =\n                parsedUri.protocol === \"https\" || parsedUri.protocol === \"wss\";\n            opts.port = parsedUri.port;\n            if (parsedUri.query)\n                opts.query = parsedUri.query;\n        }\n        else if (opts.host) {\n            opts.hostname = parse(opts.host).host;\n        }\n        installTimerFunctions(this, opts);\n        this.secure =\n            null != opts.secure\n                ? opts.secure\n                : typeof location !== \"undefined\" && \"https:\" === location.protocol;\n        if (opts.hostname && !opts.port) {\n            // if no port is specified manually, use the protocol default\n            opts.port = this.secure ? \"443\" : \"80\";\n        }\n        this.hostname =\n            opts.hostname ||\n                (typeof location !== \"undefined\" ? location.hostname : \"localhost\");\n        this.port =\n            opts.port ||\n                (typeof location !== \"undefined\" && location.port\n                    ? location.port\n                    : this.secure\n                        ? \"443\"\n                        : \"80\");\n        this.transports = [];\n        this._transportsByName = {};\n        opts.transports.forEach((t) => {\n            const transportName = t.prototype.name;\n            this.transports.push(transportName);\n            this._transportsByName[transportName] = t;\n        });\n        this.opts = Object.assign({\n            path: \"/engine.io\",\n            agent: false,\n            withCredentials: false,\n            upgrade: true,\n            timestampParam: \"t\",\n            rememberUpgrade: false,\n            addTrailingSlash: true,\n            rejectUnauthorized: true,\n            perMessageDeflate: {\n                threshold: 1024,\n            },\n            transportOptions: {},\n            closeOnBeforeunload: false,\n        }, opts);\n        this.opts.path =\n            this.opts.path.replace(/\\/$/, \"\") +\n                (this.opts.addTrailingSlash ? \"/\" : \"\");\n        if (typeof this.opts.query === \"string\") {\n            this.opts.query = decode(this.opts.query);\n        }\n        if (withEventListeners) {\n            if (this.opts.closeOnBeforeunload) {\n                // Firefox closes the connection when the \"beforeunload\" event is emitted but not Chrome. This event listener\n                // ensures every browser behaves the same (no \"disconnect\" event at the Socket.IO level when the page is\n                // closed/reloaded)\n                this._beforeunloadEventListener = () => {\n                    if (this.transport) {\n                        // silently close the transport\n                        this.transport.removeAllListeners();\n                        this.transport.close();\n                    }\n                };\n                addEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n            }\n            if (this.hostname !== \"localhost\") {\n                this._offlineEventListener = () => {\n                    this._onClose(\"transport close\", {\n                        description: \"network connection lost\",\n                    });\n                };\n                OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener);\n            }\n        }\n        if (this.opts.withCredentials) {\n            this._cookieJar = createCookieJar();\n        }\n        this._open();\n    }\n    /**\n     * Creates transport of the given type.\n     *\n     * @param {String} name - transport name\n     * @return {Transport}\n     * @private\n     */\n    createTransport(name) {\n        const query = Object.assign({}, this.opts.query);\n        // append engine.io protocol identifier\n        query.EIO = protocol;\n        // transport name\n        query.transport = name;\n        // session id if we already have one\n        if (this.id)\n            query.sid = this.id;\n        const opts = Object.assign({}, this.opts, {\n            query,\n            socket: this,\n            hostname: this.hostname,\n            secure: this.secure,\n            port: this.port,\n        }, this.opts.transportOptions[name]);\n        return new this._transportsByName[name](opts);\n    }\n    /**\n     * Initializes transport to use and starts probe.\n     *\n     * @private\n     */\n    _open() {\n        if (this.transports.length === 0) {\n            // Emit error on next tick so it can be listened to\n            this.setTimeoutFn(() => {\n                this.emitReserved(\"error\", \"No transports available\");\n            }, 0);\n            return;\n        }\n        const transportName = this.opts.rememberUpgrade &&\n            SocketWithoutUpgrade.priorWebsocketSuccess &&\n            this.transports.indexOf(\"websocket\") !== -1\n            ? \"websocket\"\n            : this.transports[0];\n        this.readyState = \"opening\";\n        const transport = this.createTransport(transportName);\n        transport.open();\n        this.setTransport(transport);\n    }\n    /**\n     * Sets the current transport. Disables the existing one (if any).\n     *\n     * @private\n     */\n    setTransport(transport) {\n        if (this.transport) {\n            this.transport.removeAllListeners();\n        }\n        // set up transport\n        this.transport = transport;\n        // set up transport listeners\n        transport\n            .on(\"drain\", this._onDrain.bind(this))\n            .on(\"packet\", this._onPacket.bind(this))\n            .on(\"error\", this._onError.bind(this))\n            .on(\"close\", (reason) => this._onClose(\"transport close\", reason));\n    }\n    /**\n     * Called when connection is deemed open.\n     *\n     * @private\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        SocketWithoutUpgrade.priorWebsocketSuccess =\n            \"websocket\" === this.transport.name;\n        this.emitReserved(\"open\");\n        this.flush();\n    }\n    /**\n     * Handles a packet.\n     *\n     * @private\n     */\n    _onPacket(packet) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            this.emitReserved(\"packet\", packet);\n            // Socket is live - any packet counts\n            this.emitReserved(\"heartbeat\");\n            switch (packet.type) {\n                case \"open\":\n                    this.onHandshake(JSON.parse(packet.data));\n                    break;\n                case \"ping\":\n                    this._sendPacket(\"pong\");\n                    this.emitReserved(\"ping\");\n                    this.emitReserved(\"pong\");\n                    this._resetPingTimeout();\n                    break;\n                case \"error\":\n                    const err = new Error(\"server error\");\n                    // @ts-ignore\n                    err.code = packet.data;\n                    this._onError(err);\n                    break;\n                case \"message\":\n                    this.emitReserved(\"data\", packet.data);\n                    this.emitReserved(\"message\", packet.data);\n                    break;\n            }\n        }\n        else {\n        }\n    }\n    /**\n     * Called upon handshake completion.\n     *\n     * @param {Object} data - handshake obj\n     * @private\n     */\n    onHandshake(data) {\n        this.emitReserved(\"handshake\", data);\n        this.id = data.sid;\n        this.transport.query.sid = data.sid;\n        this._pingInterval = data.pingInterval;\n        this._pingTimeout = data.pingTimeout;\n        this._maxPayload = data.maxPayload;\n        this.onOpen();\n        // In case open handler closes socket\n        if (\"closed\" === this.readyState)\n            return;\n        this._resetPingTimeout();\n    }\n    /**\n     * Sets and resets ping timeout timer based on server pings.\n     *\n     * @private\n     */\n    _resetPingTimeout() {\n        this.clearTimeoutFn(this._pingTimeoutTimer);\n        const delay = this._pingInterval + this._pingTimeout;\n        this._pingTimeoutTime = Date.now() + delay;\n        this._pingTimeoutTimer = this.setTimeoutFn(() => {\n            this._onClose(\"ping timeout\");\n        }, delay);\n        if (this.opts.autoUnref) {\n            this._pingTimeoutTimer.unref();\n        }\n    }\n    /**\n     * Called on `drain` event\n     *\n     * @private\n     */\n    _onDrain() {\n        this.writeBuffer.splice(0, this._prevBufferLen);\n        // setting prevBufferLen = 0 is very important\n        // for example, when upgrading, upgrade packet is sent over,\n        // and a nonzero prevBufferLen could cause problems on `drain`\n        this._prevBufferLen = 0;\n        if (0 === this.writeBuffer.length) {\n            this.emitReserved(\"drain\");\n        }\n        else {\n            this.flush();\n        }\n    }\n    /**\n     * Flush write buffers.\n     *\n     * @private\n     */\n    flush() {\n        if (\"closed\" !== this.readyState &&\n            this.transport.writable &&\n            !this.upgrading &&\n            this.writeBuffer.length) {\n            const packets = this._getWritablePackets();\n            this.transport.send(packets);\n            // keep track of current length of writeBuffer\n            // splice writeBuffer and callbackBuffer on `drain`\n            this._prevBufferLen = packets.length;\n            this.emitReserved(\"flush\");\n        }\n    }\n    /**\n     * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP\n     * long-polling)\n     *\n     * @private\n     */\n    _getWritablePackets() {\n        const shouldCheckPayloadSize = this._maxPayload &&\n            this.transport.name === \"polling\" &&\n            this.writeBuffer.length > 1;\n        if (!shouldCheckPayloadSize) {\n            return this.writeBuffer;\n        }\n        let payloadSize = 1; // first packet type\n        for (let i = 0; i < this.writeBuffer.length; i++) {\n            const data = this.writeBuffer[i].data;\n            if (data) {\n                payloadSize += byteLength(data);\n            }\n            if (i > 0 && payloadSize > this._maxPayload) {\n                return this.writeBuffer.slice(0, i);\n            }\n            payloadSize += 2; // separator + packet type\n        }\n        return this.writeBuffer;\n    }\n    /**\n     * Checks whether the heartbeat timer has expired but the socket has not yet been notified.\n     *\n     * Note: this method is private for now because it does not really fit the WebSocket API, but if we put it in the\n     * `write()` method then the message would not be buffered by the Socket.IO client.\n     *\n     * @return {boolean}\n     * @private\n     */\n    /* private */ _hasPingExpired() {\n        if (!this._pingTimeoutTime)\n            return true;\n        const hasExpired = Date.now() > this._pingTimeoutTime;\n        if (hasExpired) {\n            this._pingTimeoutTime = 0;\n            nextTick(() => {\n                this._onClose(\"ping timeout\");\n            }, this.setTimeoutFn);\n        }\n        return hasExpired;\n    }\n    /**\n     * Sends a message.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    write(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a message. Alias of {@link Socket#write}.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    send(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param {String} type: packet type.\n     * @param {String} data.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @private\n     */\n    _sendPacket(type, data, options, fn) {\n        if (\"function\" === typeof data) {\n            fn = data;\n            data = undefined;\n        }\n        if (\"function\" === typeof options) {\n            fn = options;\n            options = null;\n        }\n        if (\"closing\" === this.readyState || \"closed\" === this.readyState) {\n            return;\n        }\n        options = options || {};\n        options.compress = false !== options.compress;\n        const packet = {\n            type: type,\n            data: data,\n            options: options,\n        };\n        this.emitReserved(\"packetCreate\", packet);\n        this.writeBuffer.push(packet);\n        if (fn)\n            this.once(\"flush\", fn);\n        this.flush();\n    }\n    /**\n     * Closes the connection.\n     */\n    close() {\n        const close = () => {\n            this._onClose(\"forced close\");\n            this.transport.close();\n        };\n        const cleanupAndClose = () => {\n            this.off(\"upgrade\", cleanupAndClose);\n            this.off(\"upgradeError\", cleanupAndClose);\n            close();\n        };\n        const waitForUpgrade = () => {\n            // wait for upgrade to finish since we can't send packets while pausing a transport\n            this.once(\"upgrade\", cleanupAndClose);\n            this.once(\"upgradeError\", cleanupAndClose);\n        };\n        if (\"opening\" === this.readyState || \"open\" === this.readyState) {\n            this.readyState = \"closing\";\n            if (this.writeBuffer.length) {\n                this.once(\"drain\", () => {\n                    if (this.upgrading) {\n                        waitForUpgrade();\n                    }\n                    else {\n                        close();\n                    }\n                });\n            }\n            else if (this.upgrading) {\n                waitForUpgrade();\n            }\n            else {\n                close();\n            }\n        }\n        return this;\n    }\n    /**\n     * Called upon transport error\n     *\n     * @private\n     */\n    _onError(err) {\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        if (this.opts.tryAllTransports &&\n            this.transports.length > 1 &&\n            this.readyState === \"opening\") {\n            this.transports.shift();\n            return this._open();\n        }\n        this.emitReserved(\"error\", err);\n        this._onClose(\"transport error\", err);\n    }\n    /**\n     * Called upon transport close.\n     *\n     * @private\n     */\n    _onClose(reason, description) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            // clear timers\n            this.clearTimeoutFn(this._pingTimeoutTimer);\n            // stop event from firing again for transport\n            this.transport.removeAllListeners(\"close\");\n            // ensure transport won't stay open\n            this.transport.close();\n            // ignore further transport communication\n            this.transport.removeAllListeners();\n            if (withEventListeners) {\n                if (this._beforeunloadEventListener) {\n                    removeEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n                }\n                if (this._offlineEventListener) {\n                    const i = OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);\n                    if (i !== -1) {\n                        OFFLINE_EVENT_LISTENERS.splice(i, 1);\n                    }\n                }\n            }\n            // set ready state\n            this.readyState = \"closed\";\n            // clear session id\n            this.id = null;\n            // emit close event\n            this.emitReserved(\"close\", reason, description);\n            // clean buffers after, so users can still\n            // grab the buffers on `close` event\n            this.writeBuffer = [];\n            this._prevBufferLen = 0;\n        }\n    }\n}\nSocketWithoutUpgrade.protocol = protocol;\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see Socket\n */\nexport class SocketWithUpgrade extends SocketWithoutUpgrade {\n    constructor() {\n        super(...arguments);\n        this._upgrades = [];\n    }\n    onOpen() {\n        super.onOpen();\n        if (\"open\" === this.readyState && this.opts.upgrade) {\n            for (let i = 0; i < this._upgrades.length; i++) {\n                this._probe(this._upgrades[i]);\n            }\n        }\n    }\n    /**\n     * Probes a transport.\n     *\n     * @param {String} name - transport name\n     * @private\n     */\n    _probe(name) {\n        let transport = this.createTransport(name);\n        let failed = false;\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        const onTransportOpen = () => {\n            if (failed)\n                return;\n            transport.send([{ type: \"ping\", data: \"probe\" }]);\n            transport.once(\"packet\", (msg) => {\n                if (failed)\n                    return;\n                if (\"pong\" === msg.type && \"probe\" === msg.data) {\n                    this.upgrading = true;\n                    this.emitReserved(\"upgrading\", transport);\n                    if (!transport)\n                        return;\n                    SocketWithoutUpgrade.priorWebsocketSuccess =\n                        \"websocket\" === transport.name;\n                    this.transport.pause(() => {\n                        if (failed)\n                            return;\n                        if (\"closed\" === this.readyState)\n                            return;\n                        cleanup();\n                        this.setTransport(transport);\n                        transport.send([{ type: \"upgrade\" }]);\n                        this.emitReserved(\"upgrade\", transport);\n                        transport = null;\n                        this.upgrading = false;\n                        this.flush();\n                    });\n                }\n                else {\n                    const err = new Error(\"probe error\");\n                    // @ts-ignore\n                    err.transport = transport.name;\n                    this.emitReserved(\"upgradeError\", err);\n                }\n            });\n        };\n        function freezeTransport() {\n            if (failed)\n                return;\n            // Any callback called by transport should be ignored since now\n            failed = true;\n            cleanup();\n            transport.close();\n            transport = null;\n        }\n        // Handle any error that happens while probing\n        const onerror = (err) => {\n            const error = new Error(\"probe error: \" + err);\n            // @ts-ignore\n            error.transport = transport.name;\n            freezeTransport();\n            this.emitReserved(\"upgradeError\", error);\n        };\n        function onTransportClose() {\n            onerror(\"transport closed\");\n        }\n        // When the socket is closed while we're probing\n        function onclose() {\n            onerror(\"socket closed\");\n        }\n        // When the socket is upgraded while we're probing\n        function onupgrade(to) {\n            if (transport && to.name !== transport.name) {\n                freezeTransport();\n            }\n        }\n        // Remove all listeners on the transport and on self\n        const cleanup = () => {\n            transport.removeListener(\"open\", onTransportOpen);\n            transport.removeListener(\"error\", onerror);\n            transport.removeListener(\"close\", onTransportClose);\n            this.off(\"close\", onclose);\n            this.off(\"upgrading\", onupgrade);\n        };\n        transport.once(\"open\", onTransportOpen);\n        transport.once(\"error\", onerror);\n        transport.once(\"close\", onTransportClose);\n        this.once(\"close\", onclose);\n        this.once(\"upgrading\", onupgrade);\n        if (this._upgrades.indexOf(\"webtransport\") !== -1 &&\n            name !== \"webtransport\") {\n            // favor WebTransport\n            this.setTimeoutFn(() => {\n                if (!failed) {\n                    transport.open();\n                }\n            }, 200);\n        }\n        else {\n            transport.open();\n        }\n    }\n    onHandshake(data) {\n        this._upgrades = this._filterUpgrades(data.upgrades);\n        super.onHandshake(data);\n    }\n    /**\n     * Filters upgrades, returning only those matching client transports.\n     *\n     * @param {Array} upgrades - server upgrades\n     * @private\n     */\n    _filterUpgrades(upgrades) {\n        const filteredUpgrades = [];\n        for (let i = 0; i < upgrades.length; i++) {\n            if (~this.transports.indexOf(upgrades[i]))\n                filteredUpgrades.push(upgrades[i]);\n        }\n        return filteredUpgrades;\n    }\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * @example\n * import { Socket } from \"engine.io-client\";\n *\n * const socket = new Socket();\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see SocketWithUpgrade\n */\nexport class Socket extends SocketWithUpgrade {\n    constructor(uri, opts = {}) {\n        const o = typeof uri === \"object\" ? uri : opts;\n        if (!o.transports ||\n            (o.transports && typeof o.transports[0] === \"string\")) {\n            o.transports = (o.transports || [\"polling\", \"websocket\", \"webtransport\"])\n                .map((transportName) => DEFAULT_TRANSPORTS[transportName])\n                .filter((t) => !!t);\n        }\n        super(uri, o);\n    }\n}\n","const withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj.buffer instanceof ArrayBuffer;\n};\nconst toString = Object.prototype.toString;\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeFile = typeof File === \"function\" ||\n    (typeof File !== \"undefined\" &&\n        toString.call(File) === \"[object FileConstructor]\");\n/**\n * Returns true if obj is a Buffer, an ArrayBuffer, a Blob or a File.\n *\n * @private\n */\nexport function isBinary(obj) {\n    return ((withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj))) ||\n        (withNativeBlob && obj instanceof Blob) ||\n        (withNativeFile && obj instanceof File));\n}\nexport function hasBinary(obj, toJSON) {\n    if (!obj || typeof obj !== \"object\") {\n        return false;\n    }\n    if (Array.isArray(obj)) {\n        for (let i = 0, l = obj.length; i < l; i++) {\n            if (hasBinary(obj[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    if (isBinary(obj)) {\n        return true;\n    }\n    if (obj.toJSON &&\n        typeof obj.toJSON === \"function\" &&\n        arguments.length === 1) {\n        return hasBinary(obj.toJSON(), true);\n    }\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {\n            return true;\n        }\n    }\n    return false;\n}\n","import { isBinary } from \"./is-binary.js\";\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nexport function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (isBinary(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nexport function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n}\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n","import { Emitter } from \"@socket.io/component-emitter\";\nimport { deconstructPacket, reconstructPacket } from \"./binary.js\";\nimport { isBinary, hasBinary } from \"./is-binary.js\";\n/**\n * These strings must not be used as event names, as they have a special meaning.\n */\nconst RESERVED_EVENTS = [\n    \"connect\",\n    \"connect_error\",\n    \"disconnect\",\n    \"disconnecting\",\n    \"newListener\",\n    \"removeListener\", // used by the Node.js EventEmitter\n];\n/**\n * Protocol version.\n *\n * @public\n */\nexport const protocol = 5;\nexport var PacketType;\n(function (PacketType) {\n    PacketType[PacketType[\"CONNECT\"] = 0] = \"CONNECT\";\n    PacketType[PacketType[\"DISCONNECT\"] = 1] = \"DISCONNECT\";\n    PacketType[PacketType[\"EVENT\"] = 2] = \"EVENT\";\n    PacketType[PacketType[\"ACK\"] = 3] = \"ACK\";\n    PacketType[PacketType[\"CONNECT_ERROR\"] = 4] = \"CONNECT_ERROR\";\n    PacketType[PacketType[\"BINARY_EVENT\"] = 5] = \"BINARY_EVENT\";\n    PacketType[PacketType[\"BINARY_ACK\"] = 6] = \"BINARY_ACK\";\n})(PacketType || (PacketType = {}));\n/**\n * A socket.io Encoder instance\n */\nexport class Encoder {\n    /**\n     * Encoder constructor\n     *\n     * @param {function} replacer - custom replacer to pass down to JSON.parse\n     */\n    constructor(replacer) {\n        this.replacer = replacer;\n    }\n    /**\n     * Encode a packet as a single string if non-binary, or as a\n     * buffer sequence, depending on packet type.\n     *\n     * @param {Object} obj - packet object\n     */\n    encode(obj) {\n        if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {\n            if (hasBinary(obj)) {\n                return this.encodeAsBinary({\n                    type: obj.type === PacketType.EVENT\n                        ? PacketType.BINARY_EVENT\n                        : PacketType.BINARY_ACK,\n                    nsp: obj.nsp,\n                    data: obj.data,\n                    id: obj.id,\n                });\n            }\n        }\n        return [this.encodeAsString(obj)];\n    }\n    /**\n     * Encode packet as string.\n     */\n    encodeAsString(obj) {\n        // first is type\n        let str = \"\" + obj.type;\n        // attachments if we have them\n        if (obj.type === PacketType.BINARY_EVENT ||\n            obj.type === PacketType.BINARY_ACK) {\n            str += obj.attachments + \"-\";\n        }\n        // if we have a namespace other than `/`\n        // we append it followed by a comma `,`\n        if (obj.nsp && \"/\" !== obj.nsp) {\n            str += obj.nsp + \",\";\n        }\n        // immediately followed by the id\n        if (null != obj.id) {\n            str += obj.id;\n        }\n        // json data\n        if (null != obj.data) {\n            str += JSON.stringify(obj.data, this.replacer);\n        }\n        return str;\n    }\n    /**\n     * Encode packet as 'buffer sequence' by removing blobs, and\n     * deconstructing packet into object with placeholders and\n     * a list of buffers.\n     */\n    encodeAsBinary(obj) {\n        const deconstruction = deconstructPacket(obj);\n        const pack = this.encodeAsString(deconstruction.packet);\n        const buffers = deconstruction.buffers;\n        buffers.unshift(pack); // add packet info to beginning of data list\n        return buffers; // write all the buffers\n    }\n}\n// see https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript\nfunction isObject(value) {\n    return Object.prototype.toString.call(value) === \"[object Object]\";\n}\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n */\nexport class Decoder extends Emitter {\n    /**\n     * Decoder constructor\n     *\n     * @param {function} reviver - custom reviver to pass down to JSON.stringify\n     */\n    constructor(reviver) {\n        super();\n        this.reviver = reviver;\n    }\n    /**\n     * Decodes an encoded packet string into packet JSON.\n     *\n     * @param {String} obj - encoded packet\n     */\n    add(obj) {\n        let packet;\n        if (typeof obj === \"string\") {\n            if (this.reconstructor) {\n                throw new Error(\"got plaintext data when reconstructing a packet\");\n            }\n            packet = this.decodeString(obj);\n            const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;\n            if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {\n                packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;\n                // binary packet's json\n                this.reconstructor = new BinaryReconstructor(packet);\n                // no attachments, labeled binary but no binary data to follow\n                if (packet.attachments === 0) {\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n            else {\n                // non-binary full packet\n                super.emitReserved(\"decoded\", packet);\n            }\n        }\n        else if (isBinary(obj) || obj.base64) {\n            // raw binary data\n            if (!this.reconstructor) {\n                throw new Error(\"got binary data when not reconstructing a packet\");\n            }\n            else {\n                packet = this.reconstructor.takeBinaryData(obj);\n                if (packet) {\n                    // received final buffer\n                    this.reconstructor = null;\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n        }\n        else {\n            throw new Error(\"Unknown type: \" + obj);\n        }\n    }\n    /**\n     * Decode a packet String (JSON data)\n     *\n     * @param {String} str\n     * @return {Object} packet\n     */\n    decodeString(str) {\n        let i = 0;\n        // look up type\n        const p = {\n            type: Number(str.charAt(0)),\n        };\n        if (PacketType[p.type] === undefined) {\n            throw new Error(\"unknown packet type \" + p.type);\n        }\n        // look up attachments if type binary\n        if (p.type === PacketType.BINARY_EVENT ||\n            p.type === PacketType.BINARY_ACK) {\n            const start = i + 1;\n            while (str.charAt(++i) !== \"-\" && i != str.length) { }\n            const buf = str.substring(start, i);\n            if (buf != Number(buf) || str.charAt(i) !== \"-\") {\n                throw new Error(\"Illegal attachments\");\n            }\n            p.attachments = Number(buf);\n        }\n        // look up namespace (if any)\n        if (\"/\" === str.charAt(i + 1)) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (\",\" === c)\n                    break;\n                if (i === str.length)\n                    break;\n            }\n            p.nsp = str.substring(start, i);\n        }\n        else {\n            p.nsp = \"/\";\n        }\n        // look up id\n        const next = str.charAt(i + 1);\n        if (\"\" !== next && Number(next) == next) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (null == c || Number(c) != c) {\n                    --i;\n                    break;\n                }\n                if (i === str.length)\n                    break;\n            }\n            p.id = Number(str.substring(start, i + 1));\n        }\n        // look up json data\n        if (str.charAt(++i)) {\n            const payload = this.tryParse(str.substr(i));\n            if (Decoder.isPayloadValid(p.type, payload)) {\n                p.data = payload;\n            }\n            else {\n                throw new Error(\"invalid payload\");\n            }\n        }\n        return p;\n    }\n    tryParse(str) {\n        try {\n            return JSON.parse(str, this.reviver);\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    static isPayloadValid(type, payload) {\n        switch (type) {\n            case PacketType.CONNECT:\n                return isObject(payload);\n            case PacketType.DISCONNECT:\n                return payload === undefined;\n            case PacketType.CONNECT_ERROR:\n                return typeof payload === \"string\" || isObject(payload);\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                return (Array.isArray(payload) &&\n                    (typeof payload[0] === \"number\" ||\n                        (typeof payload[0] === \"string\" &&\n                            RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                return Array.isArray(payload);\n        }\n    }\n    /**\n     * Deallocates a parser's resources\n     */\n    destroy() {\n        if (this.reconstructor) {\n            this.reconstructor.finishedReconstruction();\n            this.reconstructor = null;\n        }\n    }\n}\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n */\nclass BinaryReconstructor {\n    constructor(packet) {\n        this.packet = packet;\n        this.buffers = [];\n        this.reconPack = packet;\n    }\n    /**\n     * Method to be called when binary data received from connection\n     * after a BINARY_EVENT packet.\n     *\n     * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n     * @return {null | Object} returns null if more binary data is expected or\n     *   a reconstructed packet object if all buffers have been received.\n     */\n    takeBinaryData(binData) {\n        this.buffers.push(binData);\n        if (this.buffers.length === this.reconPack.attachments) {\n            // done with buffer list\n            const packet = reconstructPacket(this.reconPack, this.buffers);\n            this.finishedReconstruction();\n            return packet;\n        }\n        return null;\n    }\n    /**\n     * Cleans up binary packet reconstruction variables.\n     */\n    finishedReconstruction() {\n        this.reconPack = null;\n        this.buffers = [];\n    }\n}\n","export function on(obj, ev, fn) {\n    obj.on(ev, fn);\n    return function subDestroy() {\n        obj.off(ev, fn);\n    };\n}\n","import { PacketType } from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\n/**\n * Internal events.\n * These events can't be emitted by the user.\n */\nconst RESERVED_EVENTS = Object.freeze({\n    connect: 1,\n    connect_error: 1,\n    disconnect: 1,\n    disconnecting: 1,\n    // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener\n    newListener: 1,\n    removeListener: 1,\n});\n/**\n * A Socket is the fundamental class for interacting with the server.\n *\n * A Socket belongs to a certain Namespace (by default /) and uses an underlying {@link Manager} to communicate.\n *\n * @example\n * const socket = io();\n *\n * socket.on(\"connect\", () => {\n *   console.log(\"connected\");\n * });\n *\n * // send an event to the server\n * socket.emit(\"foo\", \"bar\");\n *\n * socket.on(\"foobar\", () => {\n *   // an event was received from the server\n * });\n *\n * // upon disconnection\n * socket.on(\"disconnect\", (reason) => {\n *   console.log(`disconnected due to ${reason}`);\n * });\n */\nexport class Socket extends Emitter {\n    /**\n     * `Socket` constructor.\n     */\n    constructor(io, nsp, opts) {\n        super();\n        /**\n         * Whether the socket is currently connected to the server.\n         *\n         * @example\n         * const socket = io();\n         *\n         * socket.on(\"connect\", () => {\n         *   console.log(socket.connected); // true\n         * });\n         *\n         * socket.on(\"disconnect\", () => {\n         *   console.log(socket.connected); // false\n         * });\n         */\n        this.connected = false;\n        /**\n         * Whether the connection state was recovered after a temporary disconnection. In that case, any missed packets will\n         * be transmitted by the server.\n         */\n        this.recovered = false;\n        /**\n         * Buffer for packets received before the CONNECT packet\n         */\n        this.receiveBuffer = [];\n        /**\n         * Buffer for packets that will be sent once the socket is connected\n         */\n        this.sendBuffer = [];\n        /**\n         * The queue of packets to be sent with retry in case of failure.\n         *\n         * Packets are sent one by one, each waiting for the server acknowledgement, in order to guarantee the delivery order.\n         * @private\n         */\n        this._queue = [];\n        /**\n         * A sequence to generate the ID of the {@link QueuedPacket}.\n         * @private\n         */\n        this._queueSeq = 0;\n        this.ids = 0;\n        /**\n         * A map containing acknowledgement handlers.\n         *\n         * The `withError` attribute is used to differentiate handlers that accept an error as first argument:\n         *\n         * - `socket.emit(\"test\", (err, value) => { ... })` with `ackTimeout` option\n         * - `socket.timeout(5000).emit(\"test\", (err, value) => { ... })`\n         * - `const value = await socket.emitWithAck(\"test\")`\n         *\n         * From those that don't:\n         *\n         * - `socket.emit(\"test\", (value) => { ... });`\n         *\n         * In the first case, the handlers will be called with an error when:\n         *\n         * - the timeout is reached\n         * - the socket gets disconnected\n         *\n         * In the second case, the handlers will be simply discarded upon disconnection, since the client will never receive\n         * an acknowledgement from the server.\n         *\n         * @private\n         */\n        this.acks = {};\n        this.flags = {};\n        this.io = io;\n        this.nsp = nsp;\n        if (opts && opts.auth) {\n            this.auth = opts.auth;\n        }\n        this._opts = Object.assign({}, opts);\n        if (this.io._autoConnect)\n            this.open();\n    }\n    /**\n     * Whether the socket is currently disconnected\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"connect\", () => {\n     *   console.log(socket.disconnected); // false\n     * });\n     *\n     * socket.on(\"disconnect\", () => {\n     *   console.log(socket.disconnected); // true\n     * });\n     */\n    get disconnected() {\n        return !this.connected;\n    }\n    /**\n     * Subscribe to open, close and packet events\n     *\n     * @private\n     */\n    subEvents() {\n        if (this.subs)\n            return;\n        const io = this.io;\n        this.subs = [\n            on(io, \"open\", this.onopen.bind(this)),\n            on(io, \"packet\", this.onpacket.bind(this)),\n            on(io, \"error\", this.onerror.bind(this)),\n            on(io, \"close\", this.onclose.bind(this)),\n        ];\n    }\n    /**\n     * Whether the Socket will try to reconnect when its Manager connects or reconnects.\n     *\n     * @example\n     * const socket = io();\n     *\n     * console.log(socket.active); // true\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   if (reason === \"io server disconnect\") {\n     *     // the disconnection was initiated by the server, you need to manually reconnect\n     *     console.log(socket.active); // false\n     *   }\n     *   // else the socket will automatically try to reconnect\n     *   console.log(socket.active); // true\n     * });\n     */\n    get active() {\n        return !!this.subs;\n    }\n    /**\n     * \"Opens\" the socket.\n     *\n     * @example\n     * const socket = io({\n     *   autoConnect: false\n     * });\n     *\n     * socket.connect();\n     */\n    connect() {\n        if (this.connected)\n            return this;\n        this.subEvents();\n        if (!this.io[\"_reconnecting\"])\n            this.io.open(); // ensure open\n        if (\"open\" === this.io._readyState)\n            this.onopen();\n        return this;\n    }\n    /**\n     * Alias for {@link connect()}.\n     */\n    open() {\n        return this.connect();\n    }\n    /**\n     * Sends a `message` event.\n     *\n     * This method mimics the WebSocket.send() method.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send\n     *\n     * @example\n     * socket.send(\"hello\");\n     *\n     * // this is equivalent to\n     * socket.emit(\"message\", \"hello\");\n     *\n     * @return self\n     */\n    send(...args) {\n        args.unshift(\"message\");\n        this.emit.apply(this, args);\n        return this;\n    }\n    /**\n     * Override `emit`.\n     * If the event is in `events`, it's emitted normally.\n     *\n     * @example\n     * socket.emit(\"hello\", \"world\");\n     *\n     * // all serializable datastructures are supported (no need to call JSON.stringify)\n     * socket.emit(\"hello\", 1, \"2\", { 3: [\"4\"], 5: Uint8Array.from([6]) });\n     *\n     * // with an acknowledgement from the server\n     * socket.emit(\"hello\", \"world\", (val) => {\n     *   // ...\n     * });\n     *\n     * @return self\n     */\n    emit(ev, ...args) {\n        var _a, _b, _c;\n        if (RESERVED_EVENTS.hasOwnProperty(ev)) {\n            throw new Error('\"' + ev.toString() + '\" is a reserved event name');\n        }\n        args.unshift(ev);\n        if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {\n            this._addToQueue(args);\n            return this;\n        }\n        const packet = {\n            type: PacketType.EVENT,\n            data: args,\n        };\n        packet.options = {};\n        packet.options.compress = this.flags.compress !== false;\n        // event ack callback\n        if (\"function\" === typeof args[args.length - 1]) {\n            const id = this.ids++;\n            const ack = args.pop();\n            this._registerAckCallback(id, ack);\n            packet.id = id;\n        }\n        const isTransportWritable = (_b = (_a = this.io.engine) === null || _a === void 0 ? void 0 : _a.transport) === null || _b === void 0 ? void 0 : _b.writable;\n        const isConnected = this.connected && !((_c = this.io.engine) === null || _c === void 0 ? void 0 : _c._hasPingExpired());\n        const discardPacket = this.flags.volatile && !isTransportWritable;\n        if (discardPacket) {\n        }\n        else if (isConnected) {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        }\n        else {\n            this.sendBuffer.push(packet);\n        }\n        this.flags = {};\n        return this;\n    }\n    /**\n     * @private\n     */\n    _registerAckCallback(id, ack) {\n        var _a;\n        const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;\n        if (timeout === undefined) {\n            this.acks[id] = ack;\n            return;\n        }\n        // @ts-ignore\n        const timer = this.io.setTimeoutFn(() => {\n            delete this.acks[id];\n            for (let i = 0; i < this.sendBuffer.length; i++) {\n                if (this.sendBuffer[i].id === id) {\n                    this.sendBuffer.splice(i, 1);\n                }\n            }\n            ack.call(this, new Error(\"operation has timed out\"));\n        }, timeout);\n        const fn = (...args) => {\n            // @ts-ignore\n            this.io.clearTimeoutFn(timer);\n            ack.apply(this, args);\n        };\n        fn.withError = true;\n        this.acks[id] = fn;\n    }\n    /**\n     * Emits an event and waits for an acknowledgement\n     *\n     * @example\n     * // without timeout\n     * const response = await socket.emitWithAck(\"hello\", \"world\");\n     *\n     * // with a specific timeout\n     * try {\n     *   const response = await socket.timeout(1000).emitWithAck(\"hello\", \"world\");\n     * } catch (err) {\n     *   // the server did not acknowledge the event in the given delay\n     * }\n     *\n     * @return a Promise that will be fulfilled when the server acknowledges the event\n     */\n    emitWithAck(ev, ...args) {\n        return new Promise((resolve, reject) => {\n            const fn = (arg1, arg2) => {\n                return arg1 ? reject(arg1) : resolve(arg2);\n            };\n            fn.withError = true;\n            args.push(fn);\n            this.emit(ev, ...args);\n        });\n    }\n    /**\n     * Add the packet to the queue.\n     * @param args\n     * @private\n     */\n    _addToQueue(args) {\n        let ack;\n        if (typeof args[args.length - 1] === \"function\") {\n            ack = args.pop();\n        }\n        const packet = {\n            id: this._queueSeq++,\n            tryCount: 0,\n            pending: false,\n            args,\n            flags: Object.assign({ fromQueue: true }, this.flags),\n        };\n        args.push((err, ...responseArgs) => {\n            if (packet !== this._queue[0]) {\n                // the packet has already been acknowledged\n                return;\n            }\n            const hasError = err !== null;\n            if (hasError) {\n                if (packet.tryCount > this._opts.retries) {\n                    this._queue.shift();\n                    if (ack) {\n                        ack(err);\n                    }\n                }\n            }\n            else {\n                this._queue.shift();\n                if (ack) {\n                    ack(null, ...responseArgs);\n                }\n            }\n            packet.pending = false;\n            return this._drainQueue();\n        });\n        this._queue.push(packet);\n        this._drainQueue();\n    }\n    /**\n     * Send the first packet of the queue, and wait for an acknowledgement from the server.\n     * @param force - whether to resend a packet that has not been acknowledged yet\n     *\n     * @private\n     */\n    _drainQueue(force = false) {\n        if (!this.connected || this._queue.length === 0) {\n            return;\n        }\n        const packet = this._queue[0];\n        if (packet.pending && !force) {\n            return;\n        }\n        packet.pending = true;\n        packet.tryCount++;\n        this.flags = packet.flags;\n        this.emit.apply(this, packet.args);\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param packet\n     * @private\n     */\n    packet(packet) {\n        packet.nsp = this.nsp;\n        this.io._packet(packet);\n    }\n    /**\n     * Called upon engine `open`.\n     *\n     * @private\n     */\n    onopen() {\n        if (typeof this.auth == \"function\") {\n            this.auth((data) => {\n                this._sendConnectPacket(data);\n            });\n        }\n        else {\n            this._sendConnectPacket(this.auth);\n        }\n    }\n    /**\n     * Sends a CONNECT packet to initiate the Socket.IO session.\n     *\n     * @param data\n     * @private\n     */\n    _sendConnectPacket(data) {\n        this.packet({\n            type: PacketType.CONNECT,\n            data: this._pid\n                ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data)\n                : data,\n        });\n    }\n    /**\n     * Called upon engine or manager `error`.\n     *\n     * @param err\n     * @private\n     */\n    onerror(err) {\n        if (!this.connected) {\n            this.emitReserved(\"connect_error\", err);\n        }\n    }\n    /**\n     * Called upon engine `close`.\n     *\n     * @param reason\n     * @param description\n     * @private\n     */\n    onclose(reason, description) {\n        this.connected = false;\n        delete this.id;\n        this.emitReserved(\"disconnect\", reason, description);\n        this._clearAcks();\n    }\n    /**\n     * Clears the acknowledgement handlers upon disconnection, since the client will never receive an acknowledgement from\n     * the server.\n     *\n     * @private\n     */\n    _clearAcks() {\n        Object.keys(this.acks).forEach((id) => {\n            const isBuffered = this.sendBuffer.some((packet) => String(packet.id) === id);\n            if (!isBuffered) {\n                // note: handlers that do not accept an error as first argument are ignored here\n                const ack = this.acks[id];\n                delete this.acks[id];\n                if (ack.withError) {\n                    ack.call(this, new Error(\"socket has been disconnected\"));\n                }\n            }\n        });\n    }\n    /**\n     * Called with socket packet.\n     *\n     * @param packet\n     * @private\n     */\n    onpacket(packet) {\n        const sameNamespace = packet.nsp === this.nsp;\n        if (!sameNamespace)\n            return;\n        switch (packet.type) {\n            case PacketType.CONNECT:\n                if (packet.data && packet.data.sid) {\n                    this.onconnect(packet.data.sid, packet.data.pid);\n                }\n                else {\n                    this.emitReserved(\"connect_error\", new Error(\"It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)\"));\n                }\n                break;\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                this.onevent(packet);\n                break;\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                this.onack(packet);\n                break;\n            case PacketType.DISCONNECT:\n                this.ondisconnect();\n                break;\n            case PacketType.CONNECT_ERROR:\n                this.destroy();\n                const err = new Error(packet.data.message);\n                // @ts-ignore\n                err.data = packet.data.data;\n                this.emitReserved(\"connect_error\", err);\n                break;\n        }\n    }\n    /**\n     * Called upon a server event.\n     *\n     * @param packet\n     * @private\n     */\n    onevent(packet) {\n        const args = packet.data || [];\n        if (null != packet.id) {\n            args.push(this.ack(packet.id));\n        }\n        if (this.connected) {\n            this.emitEvent(args);\n        }\n        else {\n            this.receiveBuffer.push(Object.freeze(args));\n        }\n    }\n    emitEvent(args) {\n        if (this._anyListeners && this._anyListeners.length) {\n            const listeners = this._anyListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, args);\n            }\n        }\n        super.emit.apply(this, args);\n        if (this._pid && args.length && typeof args[args.length - 1] === \"string\") {\n            this._lastOffset = args[args.length - 1];\n        }\n    }\n    /**\n     * Produces an ack callback to emit with an event.\n     *\n     * @private\n     */\n    ack(id) {\n        const self = this;\n        let sent = false;\n        return function (...args) {\n            // prevent double callbacks\n            if (sent)\n                return;\n            sent = true;\n            self.packet({\n                type: PacketType.ACK,\n                id: id,\n                data: args,\n            });\n        };\n    }\n    /**\n     * Called upon a server acknowledgement.\n     *\n     * @param packet\n     * @private\n     */\n    onack(packet) {\n        const ack = this.acks[packet.id];\n        if (typeof ack !== \"function\") {\n            return;\n        }\n        delete this.acks[packet.id];\n        // @ts-ignore FIXME ack is incorrectly inferred as 'never'\n        if (ack.withError) {\n            packet.data.unshift(null);\n        }\n        // @ts-ignore\n        ack.apply(this, packet.data);\n    }\n    /**\n     * Called upon server connect.\n     *\n     * @private\n     */\n    onconnect(id, pid) {\n        this.id = id;\n        this.recovered = pid && this._pid === pid;\n        this._pid = pid; // defined only if connection state recovery is enabled\n        this.connected = true;\n        this.emitBuffered();\n        this.emitReserved(\"connect\");\n        this._drainQueue(true);\n    }\n    /**\n     * Emit buffered events (received and emitted).\n     *\n     * @private\n     */\n    emitBuffered() {\n        this.receiveBuffer.forEach((args) => this.emitEvent(args));\n        this.receiveBuffer = [];\n        this.sendBuffer.forEach((packet) => {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        });\n        this.sendBuffer = [];\n    }\n    /**\n     * Called upon server disconnect.\n     *\n     * @private\n     */\n    ondisconnect() {\n        this.destroy();\n        this.onclose(\"io server disconnect\");\n    }\n    /**\n     * Called upon forced client/server side disconnections,\n     * this method ensures the manager stops tracking us and\n     * that reconnections don't get triggered for this.\n     *\n     * @private\n     */\n    destroy() {\n        if (this.subs) {\n            // clean subscriptions to avoid reconnections\n            this.subs.forEach((subDestroy) => subDestroy());\n            this.subs = undefined;\n        }\n        this.io[\"_destroy\"](this);\n    }\n    /**\n     * Disconnects the socket manually. In that case, the socket will not try to reconnect.\n     *\n     * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   // console.log(reason); prints \"io client disconnect\"\n     * });\n     *\n     * socket.disconnect();\n     *\n     * @return self\n     */\n    disconnect() {\n        if (this.connected) {\n            this.packet({ type: PacketType.DISCONNECT });\n        }\n        // remove socket from pool\n        this.destroy();\n        if (this.connected) {\n            // fire events\n            this.onclose(\"io client disconnect\");\n        }\n        return this;\n    }\n    /**\n     * Alias for {@link disconnect()}.\n     *\n     * @return self\n     */\n    close() {\n        return this.disconnect();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @example\n     * socket.compress(false).emit(\"hello\");\n     *\n     * @param compress - if `true`, compresses the sending data\n     * @return self\n     */\n    compress(compress) {\n        this.flags.compress = compress;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not\n     * ready to send messages.\n     *\n     * @example\n     * socket.volatile.emit(\"hello\"); // the server may or may not receive it\n     *\n     * @returns self\n     */\n    get volatile() {\n        this.flags.volatile = true;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the callback will be called with an error when the\n     * given number of milliseconds have elapsed without an acknowledgement from the server:\n     *\n     * @example\n     * socket.timeout(5000).emit(\"my-event\", (err) => {\n     *   if (err) {\n     *     // the server did not acknowledge the event in the given delay\n     *   }\n     * });\n     *\n     * @returns self\n     */\n    timeout(timeout) {\n        this.flags.timeout = timeout;\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * @example\n     * socket.onAny((event, ...args) => {\n     *   console.log(`got ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * @example\n     * socket.prependAny((event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * }\n     *\n     * socket.onAny(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAny(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAny();\n     *\n     * @param listener\n     */\n    offAny(listener) {\n        if (!this._anyListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAny() {\n        return this._anyListeners || [];\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.onAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.prependAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * }\n     *\n     * socket.onAnyOutgoing(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAnyOutgoing(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAnyOutgoing();\n     *\n     * @param [listener] - the catch-all listener (optional)\n     */\n    offAnyOutgoing(listener) {\n        if (!this._anyOutgoingListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyOutgoingListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyOutgoingListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAnyOutgoing() {\n        return this._anyOutgoingListeners || [];\n    }\n    /**\n     * Notify the listeners for each packet sent\n     *\n     * @param packet\n     *\n     * @private\n     */\n    notifyOutgoingListeners(packet) {\n        if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {\n            const listeners = this._anyOutgoingListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, packet.data);\n            }\n        }\n    }\n}\n","/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\nexport function Backoff(opts) {\n    opts = opts || {};\n    this.ms = opts.min || 100;\n    this.max = opts.max || 10000;\n    this.factor = opts.factor || 2;\n    this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n    this.attempts = 0;\n}\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\nBackoff.prototype.duration = function () {\n    var ms = this.ms * Math.pow(this.factor, this.attempts++);\n    if (this.jitter) {\n        var rand = Math.random();\n        var deviation = Math.floor(rand * this.jitter * ms);\n        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;\n    }\n    return Math.min(ms, this.max) | 0;\n};\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\nBackoff.prototype.reset = function () {\n    this.attempts = 0;\n};\n/**\n * Set the minimum duration\n *\n * @api public\n */\nBackoff.prototype.setMin = function (min) {\n    this.ms = min;\n};\n/**\n * Set the maximum duration\n *\n * @api public\n */\nBackoff.prototype.setMax = function (max) {\n    this.max = max;\n};\n/**\n * Set the jitter\n *\n * @api public\n */\nBackoff.prototype.setJitter = function (jitter) {\n    this.jitter = jitter;\n};\n","import { Socket as Engine, installTimerFunctions, nextTick, } from \"engine.io-client\";\nimport { Socket } from \"./socket.js\";\nimport * as parser from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Backoff } from \"./contrib/backo2.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\nexport class Manager extends Emitter {\n    constructor(uri, opts) {\n        var _a;\n        super();\n        this.nsps = {};\n        this.subs = [];\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = undefined;\n        }\n        opts = opts || {};\n        opts.path = opts.path || \"/socket.io\";\n        this.opts = opts;\n        installTimerFunctions(this, opts);\n        this.reconnection(opts.reconnection !== false);\n        this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n        this.reconnectionDelay(opts.reconnectionDelay || 1000);\n        this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n        this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);\n        this.backoff = new Backoff({\n            min: this.reconnectionDelay(),\n            max: this.reconnectionDelayMax(),\n            jitter: this.randomizationFactor(),\n        });\n        this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n        this._readyState = \"closed\";\n        this.uri = uri;\n        const _parser = opts.parser || parser;\n        this.encoder = new _parser.Encoder();\n        this.decoder = new _parser.Decoder();\n        this._autoConnect = opts.autoConnect !== false;\n        if (this._autoConnect)\n            this.open();\n    }\n    reconnection(v) {\n        if (!arguments.length)\n            return this._reconnection;\n        this._reconnection = !!v;\n        if (!v) {\n            this.skipReconnect = true;\n        }\n        return this;\n    }\n    reconnectionAttempts(v) {\n        if (v === undefined)\n            return this._reconnectionAttempts;\n        this._reconnectionAttempts = v;\n        return this;\n    }\n    reconnectionDelay(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelay;\n        this._reconnectionDelay = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);\n        return this;\n    }\n    randomizationFactor(v) {\n        var _a;\n        if (v === undefined)\n            return this._randomizationFactor;\n        this._randomizationFactor = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);\n        return this;\n    }\n    reconnectionDelayMax(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelayMax;\n        this._reconnectionDelayMax = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);\n        return this;\n    }\n    timeout(v) {\n        if (!arguments.length)\n            return this._timeout;\n        this._timeout = v;\n        return this;\n    }\n    /**\n     * Starts trying to reconnect if reconnection is enabled and we have not\n     * started reconnecting yet\n     *\n     * @private\n     */\n    maybeReconnectOnOpen() {\n        // Only try to reconnect if it's the first time we're connecting\n        if (!this._reconnecting &&\n            this._reconnection &&\n            this.backoff.attempts === 0) {\n            // keeps reconnection from firing twice for the same reconnection loop\n            this.reconnect();\n        }\n    }\n    /**\n     * Sets the current transport `socket`.\n     *\n     * @param {Function} fn - optional, callback\n     * @return self\n     * @public\n     */\n    open(fn) {\n        if (~this._readyState.indexOf(\"open\"))\n            return this;\n        this.engine = new Engine(this.uri, this.opts);\n        const socket = this.engine;\n        const self = this;\n        this._readyState = \"opening\";\n        this.skipReconnect = false;\n        // emit `open`\n        const openSubDestroy = on(socket, \"open\", function () {\n            self.onopen();\n            fn && fn();\n        });\n        const onError = (err) => {\n            this.cleanup();\n            this._readyState = \"closed\";\n            this.emitReserved(\"error\", err);\n            if (fn) {\n                fn(err);\n            }\n            else {\n                // Only do this if there is no fn to handle the error\n                this.maybeReconnectOnOpen();\n            }\n        };\n        // emit `error`\n        const errorSub = on(socket, \"error\", onError);\n        if (false !== this._timeout) {\n            const timeout = this._timeout;\n            // set timer\n            const timer = this.setTimeoutFn(() => {\n                openSubDestroy();\n                onError(new Error(\"timeout\"));\n                socket.close();\n            }, timeout);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n        this.subs.push(openSubDestroy);\n        this.subs.push(errorSub);\n        return this;\n    }\n    /**\n     * Alias for open()\n     *\n     * @return self\n     * @public\n     */\n    connect(fn) {\n        return this.open(fn);\n    }\n    /**\n     * Called upon transport open.\n     *\n     * @private\n     */\n    onopen() {\n        // clear old subs\n        this.cleanup();\n        // mark as open\n        this._readyState = \"open\";\n        this.emitReserved(\"open\");\n        // add new subs\n        const socket = this.engine;\n        this.subs.push(on(socket, \"ping\", this.onping.bind(this)), on(socket, \"data\", this.ondata.bind(this)), on(socket, \"error\", this.onerror.bind(this)), on(socket, \"close\", this.onclose.bind(this)), \n        // @ts-ignore\n        on(this.decoder, \"decoded\", this.ondecoded.bind(this)));\n    }\n    /**\n     * Called upon a ping.\n     *\n     * @private\n     */\n    onping() {\n        this.emitReserved(\"ping\");\n    }\n    /**\n     * Called with data.\n     *\n     * @private\n     */\n    ondata(data) {\n        try {\n            this.decoder.add(data);\n        }\n        catch (e) {\n            this.onclose(\"parse error\", e);\n        }\n    }\n    /**\n     * Called when parser fully decodes a packet.\n     *\n     * @private\n     */\n    ondecoded(packet) {\n        // the nextTick call prevents an exception in a user-provided event listener from triggering a disconnection due to a \"parse error\"\n        nextTick(() => {\n            this.emitReserved(\"packet\", packet);\n        }, this.setTimeoutFn);\n    }\n    /**\n     * Called upon socket error.\n     *\n     * @private\n     */\n    onerror(err) {\n        this.emitReserved(\"error\", err);\n    }\n    /**\n     * Creates a new socket for the given `nsp`.\n     *\n     * @return {Socket}\n     * @public\n     */\n    socket(nsp, opts) {\n        let socket = this.nsps[nsp];\n        if (!socket) {\n            socket = new Socket(this, nsp, opts);\n            this.nsps[nsp] = socket;\n        }\n        else if (this._autoConnect && !socket.active) {\n            socket.connect();\n        }\n        return socket;\n    }\n    /**\n     * Called upon a socket close.\n     *\n     * @param socket\n     * @private\n     */\n    _destroy(socket) {\n        const nsps = Object.keys(this.nsps);\n        for (const nsp of nsps) {\n            const socket = this.nsps[nsp];\n            if (socket.active) {\n                return;\n            }\n        }\n        this._close();\n    }\n    /**\n     * Writes a packet.\n     *\n     * @param packet\n     * @private\n     */\n    _packet(packet) {\n        const encodedPackets = this.encoder.encode(packet);\n        for (let i = 0; i < encodedPackets.length; i++) {\n            this.engine.write(encodedPackets[i], packet.options);\n        }\n    }\n    /**\n     * Clean up transport subscriptions and packet buffer.\n     *\n     * @private\n     */\n    cleanup() {\n        this.subs.forEach((subDestroy) => subDestroy());\n        this.subs.length = 0;\n        this.decoder.destroy();\n    }\n    /**\n     * Close the current socket.\n     *\n     * @private\n     */\n    _close() {\n        this.skipReconnect = true;\n        this._reconnecting = false;\n        this.onclose(\"forced close\");\n    }\n    /**\n     * Alias for close()\n     *\n     * @private\n     */\n    disconnect() {\n        return this._close();\n    }\n    /**\n     * Called when:\n     *\n     * - the low-level engine is closed\n     * - the parser encountered a badly formatted packet\n     * - all sockets are disconnected\n     *\n     * @private\n     */\n    onclose(reason, description) {\n        var _a;\n        this.cleanup();\n        (_a = this.engine) === null || _a === void 0 ? void 0 : _a.close();\n        this.backoff.reset();\n        this._readyState = \"closed\";\n        this.emitReserved(\"close\", reason, description);\n        if (this._reconnection && !this.skipReconnect) {\n            this.reconnect();\n        }\n    }\n    /**\n     * Attempt a reconnection.\n     *\n     * @private\n     */\n    reconnect() {\n        if (this._reconnecting || this.skipReconnect)\n            return this;\n        const self = this;\n        if (this.backoff.attempts >= this._reconnectionAttempts) {\n            this.backoff.reset();\n            this.emitReserved(\"reconnect_failed\");\n            this._reconnecting = false;\n        }\n        else {\n            const delay = this.backoff.duration();\n            this._reconnecting = true;\n            const timer = this.setTimeoutFn(() => {\n                if (self.skipReconnect)\n                    return;\n                this.emitReserved(\"reconnect_attempt\", self.backoff.attempts);\n                // check again for the case socket closed in above events\n                if (self.skipReconnect)\n                    return;\n                self.open((err) => {\n                    if (err) {\n                        self._reconnecting = false;\n                        self.reconnect();\n                        this.emitReserved(\"reconnect_error\", err);\n                    }\n                    else {\n                        self.onreconnect();\n                    }\n                });\n            }, delay);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n    }\n    /**\n     * Called upon successful reconnect.\n     *\n     * @private\n     */\n    onreconnect() {\n        const attempt = this.backoff.attempts;\n        this._reconnecting = false;\n        this.backoff.reset();\n        this.emitReserved(\"reconnect\", attempt);\n    }\n}\n","import { url } from \"./url.js\";\nimport { Manager } from \"./manager.js\";\nimport { Socket } from \"./socket.js\";\n/**\n * Managers cache.\n */\nconst cache = {};\nfunction lookup(uri, opts) {\n    if (typeof uri === \"object\") {\n        opts = uri;\n        uri = undefined;\n    }\n    opts = opts || {};\n    const parsed = url(uri, opts.path || \"/socket.io\");\n    const source = parsed.source;\n    const id = parsed.id;\n    const path = parsed.path;\n    const sameNamespace = cache[id] && path in cache[id][\"nsps\"];\n    const newConnection = opts.forceNew ||\n        opts[\"force new connection\"] ||\n        false === opts.multiplex ||\n        sameNamespace;\n    let io;\n    if (newConnection) {\n        io = new Manager(source, opts);\n    }\n    else {\n        if (!cache[id]) {\n            cache[id] = new Manager(source, opts);\n        }\n        io = cache[id];\n    }\n    if (parsed.query && !opts.query) {\n        opts.query = parsed.queryKey;\n    }\n    return io.socket(parsed.path, opts);\n}\n// so that \"lookup\" can be used both as a function (e.g. `io(...)`) and as a\n// namespace (e.g. `io.connect(...)`), for backward compatibility\nObject.assign(lookup, {\n    Manager,\n    Socket,\n    io: lookup,\n    connect: lookup,\n});\n/**\n * Protocol version.\n *\n * @public\n */\nexport { protocol } from \"socket.io-parser\";\n/**\n * Expose constructors for standalone build.\n *\n * @public\n */\nexport { Manager, Socket, lookup as io, lookup as connect, lookup as default, };\nexport { Fetch, NodeXHR, XHR, NodeWebSocket, WebSocket, WebTransport, } from \"engine.io-client\";\n","import { parse } from \"engine.io-client\";\n/**\n * URL parser.\n *\n * @param uri - url\n * @param path - the request path of the connection\n * @param loc - An object meant to mimic window.location.\n *        Defaults to window.location.\n * @public\n */\nexport function url(uri, path = \"\", loc) {\n    let obj = uri;\n    // default to window.location\n    loc = loc || (typeof location !== \"undefined\" && location);\n    if (null == uri)\n        uri = loc.protocol + \"//\" + loc.host;\n    // relative path support\n    if (typeof uri === \"string\") {\n        if (\"/\" === uri.charAt(0)) {\n            if (\"/\" === uri.charAt(1)) {\n                uri = loc.protocol + uri;\n            }\n            else {\n                uri = loc.host + uri;\n            }\n        }\n        if (!/^(https?|wss?):\\/\\//.test(uri)) {\n            if (\"undefined\" !== typeof loc) {\n                uri = loc.protocol + \"//\" + uri;\n            }\n            else {\n                uri = \"https://\" + uri;\n            }\n        }\n        // parse\n        obj = parse(uri);\n    }\n    // make sure we treat `localhost:80` and `localhost` equally\n    if (!obj.port) {\n        if (/^(http|ws)$/.test(obj.protocol)) {\n            obj.port = \"80\";\n        }\n        else if (/^(http|ws)s$/.test(obj.protocol)) {\n            obj.port = \"443\";\n        }\n    }\n    obj.path = obj.path || \"/\";\n    const ipv6 = obj.host.indexOf(\":\") !== -1;\n    const host = ipv6 ? \"[\" + obj.host + \"]\" : obj.host;\n    // define unique id\n    obj.id = obj.protocol + \"://\" + host + \":\" + obj.port + path;\n    // define href\n    obj.href =\n        obj.protocol +\n            \"://\" +\n            host +\n            (loc && loc.port === obj.port ? \"\" : \":\" + obj.port);\n    return obj;\n}\n","/**\r\n * Desktop API Configuration\r\n * \r\n * Provides configuration for API connections in the desktop Electron app.\r\n * This is NOT a browser application - it runs embedded in Electron.\r\n */\r\n\r\nexport interface ApiConfig {\r\n  /** API base URL */\r\n  apiUrl: string;\r\n  /** WebSocket base URL */\r\n  socketUrl: string;\r\n  /** Whether HTTPS is enforced */\r\n  httpsEnforced: boolean;\r\n  /** Whether this is a production build */\r\n  isProduction: boolean;\r\n  /** Whether this is a desktop app */\r\n  isDesktop: boolean;\r\n  /** Environment name */\r\n  environment: string;\r\n}\r\n\r\n/**\r\n * Determine if we're running in production mode\r\n * For desktop development, force development mode\r\n */\r\nfunction isProductionBuild(): boolean {\r\n  // Force development mode for desktop builds during development\r\n  // This ensures local server is used even when built with vite build\r\n  const forceDevMode = import.meta.env.VITE_FORCE_DEV_MODE === 'true';\r\n  if (forceDevMode) {\r\n    return false;\r\n  }\r\n  \r\n  // Vite sets NODE_ENV to 'production' for production builds\r\n  return import.meta.env.MODE === 'production' || \r\n         import.meta.env.PROD === true ||\r\n         (typeof process !== 'undefined' && process.env?.NODE_ENV === 'production');\r\n}\r\n\r\n\r\n/**\r\n * Get environment name from various sources\r\n */\r\nfunction getEnvironment(): string {\r\n  return import.meta.env.VITE_ENVIRONMENT || \r\n         import.meta.env.MODE || \r\n         (typeof process !== 'undefined' ? process.env?.NODE_ENV : undefined) || \r\n         'development';\r\n}\r\n\r\n\r\n/**\r\n * Get the API base URL for desktop app\r\n */\r\nfunction getApiBaseUrl(): string {\r\n  const isProduction = isProductionBuild();\r\n  \r\n  // Desktop app API configuration\r\n  let baseUrl: string;\r\n  \r\n  if (import.meta.env.VITE_API_URL) {\r\n    baseUrl = import.meta.env.VITE_API_URL;\r\n  } else if (isProduction) {\r\n    // Production: Use HTTPS with configurable host\r\n    const productionHost = import.meta.env.VITE_PRODUCTION_HOST || 'attrition-game.onrender.com';\r\n    baseUrl = `https://${productionHost}/api`;\r\n    console.log(` Desktop Production API: ${baseUrl}`);\r\n  } else {\r\n    // Development: Local server\r\n    baseUrl = 'http://localhost:3001/api';\r\n    console.log(` Desktop Development API: ${baseUrl}`);\r\n  }\r\n  \r\n  return baseUrl;\r\n}\r\n\r\n/**\r\n * Get the WebSocket base URL derived from API URL\r\n */\r\nfunction getSocketBaseUrl(apiUrl: string): string {\r\n  // Remove /api suffix and use same protocol/host for WebSocket\r\n  const socketUrl = apiUrl.replace(/\\/api\\/?$/, '');\r\n  \r\n  // Ensure WebSocket URL protocol matches API URL protocol\r\n  // This is critical for localhost development where we need ws:// not wss://\r\n  if (apiUrl.startsWith('http://') && !socketUrl.startsWith('http://')) {\r\n    return socketUrl.replace(/^https:/, 'http:');\r\n  }\r\n  \r\n  return socketUrl;\r\n}\r\n\r\n/**\r\n * Get desktop API configuration\r\n */\r\nexport function getApiConfig(): ApiConfig {\r\n  const isProduction = isProductionBuild();\r\n  const environment = getEnvironment();\r\n  \r\n  // Get API URL\r\n  const apiUrl = getApiBaseUrl();\r\n  const socketUrl = getSocketBaseUrl(apiUrl);\r\n  \r\n  // Always desktop mode, HTTPS enforced in production\r\n  const httpsEnforced = isProduction;\r\n  \r\n  const config: ApiConfig = {\r\n    apiUrl,\r\n    socketUrl,\r\n    httpsEnforced,\r\n    isProduction,\r\n    isDesktop: true, // Always desktop\r\n    environment\r\n  };\r\n  \r\n  // Log configuration with enhanced debugging\r\n  console.log(' Desktop API Configuration:', {\r\n    environment,\r\n    isProduction,\r\n    httpsEnforced,\r\n    apiUrl,\r\n    socketUrl,\r\n    forceDevMode: import.meta.env.VITE_FORCE_DEV_MODE\r\n  });\r\n  \r\n  // Security validation for production\r\n  if (isProduction && !apiUrl.startsWith('https://')) {\r\n    console.warn(' Desktop Production Warning: Consider using HTTPS for security');\r\n  }\r\n  \r\n  return config;\r\n}\r\n\r\n/**\r\n * Validate that the current configuration meets security requirements\r\n */\r\nexport function validateApiSecurity(config: ApiConfig): { isSecure: boolean; warnings: string[] } {\r\n  const warnings: string[] = [];\r\n  let isSecure = true;\r\n  \r\n  // Check HTTPS usage in production\r\n  if (config.isProduction && !config.apiUrl.startsWith('https://')) {\r\n    warnings.push('Using HTTP in production build - HTTPS recommended');\r\n    isSecure = false;\r\n  }\r\n  \r\n  // Check localhost usage in production\r\n  if (config.isProduction && (\r\n    config.apiUrl.includes('localhost') || \r\n    config.apiUrl.includes('127.0.0.1')\r\n  )) {\r\n    warnings.push('Using localhost in production build - production server recommended');\r\n    isSecure = false;\r\n  }\r\n  \r\n  // Check WebSocket security\r\n  if (config.httpsEnforced && !config.socketUrl.startsWith('https://')) {\r\n    warnings.push('WebSocket URL should use HTTPS when HTTPS is enforced');\r\n    isSecure = false;\r\n  }\r\n  \r\n  // Log warnings\r\n  if (warnings.length > 0) {\r\n    console.warn('  API Security Warnings:', warnings);\r\n  }\r\n  \r\n  return { isSecure, warnings };\r\n}\r\n\r\n/**\r\n * Get the current API configuration (singleton pattern)\r\n */\r\nlet cachedConfig: ApiConfig | null = null;\r\n\r\nexport function getCurrentApiConfig(): ApiConfig {\r\n  if (!cachedConfig) {\r\n    cachedConfig = getApiConfig();\r\n    \r\n    // Validate security\r\n    const securityCheck = validateApiSecurity(cachedConfig);\r\n    if (!securityCheck.isSecure && cachedConfig.isProduction) {\r\n      console.error(' API configuration failed security validation in production');\r\n    }\r\n  }\r\n  \r\n  return cachedConfig;\r\n}\r\n\r\n/**\r\n * Clear cached configuration (useful for testing or environment changes)\r\n */\r\nexport function clearApiConfigCache(): void {\r\n  cachedConfig = null;\r\n}\r\n\r\n// Export individual URL getters for backward compatibility\r\nexport const API_BASE_URL = getApiBaseUrl();\r\nexport const SOCKET_BASE_URL = getSocketBaseUrl(API_BASE_URL);\r\n\r\nexport default {\r\n  getApiConfig,\r\n  getCurrentApiConfig,\r\n  validateApiSecurity,\r\n  clearApiConfigCache,\r\n  API_BASE_URL,\r\n  SOCKET_BASE_URL\r\n};\r\n","import axios, {\r\n  AxiosError,\r\n  AxiosInstance,\r\n  AxiosResponse,\r\n  InternalAxiosRequestConfig,\r\n} from \"axios\";\r\nimport { attachMetrics } from \"./httpInstrumentation\";\r\nimport { getToken, setToken, clearToken } from \"./tokenProvider\";\r\nimport { getCurrentApiConfig } from \"../utils/apiConfig\";\r\n\r\nconst IS_TEST =\r\n  typeof process !== \"undefined\" && (process as any)?.env?.NODE_ENV === \"test\";\r\n\r\n// Get API configuration with HTTPS enforcement\r\nconst apiConfig = getCurrentApiConfig();\r\nexport const API_BASE_URL: string = apiConfig.apiUrl;\r\n\r\n// Log HTTPS enforcement status\r\nif (apiConfig.httpsEnforced) {\r\n  console.log(' API Service: HTTPS enforcement active for production build');\r\n} else if (apiConfig.isProduction && !apiConfig.apiUrl.startsWith('https://')) {\r\n  console.warn('  API Service: Production build using HTTP - HTTPS recommended');\r\n}\r\n\r\n// Public ApiError shape for callers/UI\r\nexport interface ApiError {\r\n  code: string; // e.g., 'INVALID_REQUEST', 'HTTP_500', 'NETWORK_ERROR', 'TIMEOUT', 'UNAUTHORIZED'\r\n  message: string;\r\n  status?: number;\r\n  details?: any;\r\n}\r\n\r\n// Axios instance\r\nconst api: AxiosInstance = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  timeout: 10000,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\n// Attach dev-only HTTP metrics\r\nattachMetrics(api, \"api\");\r\n\r\n// Optional request id generator (simple, no deps)\r\nfunction createRequestId(): string {\r\n  // time-base + random suffix\r\n  return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`;\r\n}\r\n\r\ntype RetriableConfig = InternalAxiosRequestConfig & {\r\n  _retry401?: boolean;\r\n  _retriedOnce?: boolean;\r\n};\r\n\r\n// Inject Authorization and x-request-id (axios v1 headers support set/get)\r\napi.interceptors.request.use((config: InternalAxiosRequestConfig) => {\r\n  const token = getToken();\r\n\r\n  // Ensure headers exists and handle AxiosHeaders vs plain object\r\n  const h: any = config.headers ?? {};\r\n  if (token) {\r\n    if (typeof h.set === \"function\") {\r\n      h.set(\"Authorization\", `Bearer ${token}`);\r\n    } else {\r\n      h[\"Authorization\"] = `Bearer ${token}`;\r\n    }\r\n  }\r\n\r\n  const existingReqId =\r\n    (typeof h.get === \"function\" ? h.get(\"x-request-id\") : h[\"x-request-id\"]) ||\r\n    undefined;\r\n  if (!existingReqId) {\r\n    const rid = createRequestId();\r\n    if (typeof h.set === \"function\") {\r\n      h.set(\"x-request-id\", rid);\r\n    } else {\r\n      h[\"x-request-id\"] = rid;\r\n    }\r\n  }\r\n\r\n  config.headers = h;\r\n  return config;\r\n});\r\n\r\n// Single-flight 401 refresh machinery\r\nlet refreshPromise: Promise<string | null> | null = null;\r\n\r\nexport let refreshAccessToken: () => Promise<string | null> = async () => {\r\n  try {\r\n    const refreshFn = (window as any)?.desktop?.auth?.refresh as\r\n      | (() => Promise<{\r\n          ok: boolean;\r\n          token?: string;\r\n          error?: string;\r\n          status?: number;\r\n          details?: any;\r\n        }>)\r\n      | undefined;\r\n\r\n    if (!refreshFn) return null;\r\n\r\n    const res = await refreshFn();\r\n    if (res && res.ok && res.token) {\r\n      setToken(res.token);\r\n      return res.token;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\n\r\nexport function toApiErrorFromAxiosError(error: AxiosError): ApiError {\r\n  // HTTP response present\r\n  if (error.response) {\r\n    const status = error.response.status;\r\n    const payload: any = error.response.data;\r\n\r\n    // Prefer canonical server DTO (success:false)\r\n    if (payload && payload.success === false) {\r\n      return {\r\n        code: payload.code || \"SERVER_ERROR\",\r\n        message: payload.message || \"Request failed\",\r\n        details: payload.details ?? payload,\r\n        status,\r\n      };\r\n    }\r\n\r\n    // Fallback: HTTP_{status} + message\r\n    return {\r\n      code: `HTTP_${status}`,\r\n      message:\r\n        (payload && (payload.message || payload.error)) ||\r\n        error.response.statusText ||\r\n        \"HTTP Error\",\r\n      details: payload,\r\n      status,\r\n    };\r\n  }\r\n\r\n  // No response: timeout or network\r\n  // Axios sets error.code === 'ECONNABORTED' on timeout\r\n  const codeVal = (error as any)?.code;\r\n  const msgVal = (error as any)?.message;\r\n  if (\r\n    codeVal === \"ECONNABORTED\" ||\r\n    (typeof msgVal === \"string\" && msgVal.toLowerCase().includes(\"timeout\"))\r\n  ) {\r\n    return {\r\n      code: \"TIMEOUT\",\r\n      message: \"Request timed out\",\r\n    };\r\n  }\r\n\r\n  return {\r\n    code: \"NETWORK_ERROR\",\r\n    message: \"Network error\",\r\n  };\r\n}\r\n\r\n// Response path: normalize server-declared failures even when HTTP 200\r\napi.interceptors.response.use(\r\n  (resp: AxiosResponse) => {\r\n    const data = resp?.data;\r\n    if (data && data.success === false) {\r\n      const normalized: ApiError = {\r\n        code: data.code || \"SERVER_ERROR\",\r\n        message: data.message || \"Request failed\",\r\n        details: data.details,\r\n        status: resp.status,\r\n      };\r\n      return Promise.reject(normalized);\r\n    }\r\n    return resp;\r\n  },\r\n  async (error: any) => {\r\n    // Ensure AxiosError typing when possible\r\n    const axErr: AxiosError = error;\r\n\r\n    // Early TIMEOUT mapping for transport-level timeouts (no HTTP response)\r\n    if (\r\n      !(axErr as any)?.response &&\r\n      (\r\n        (axErr as any)?.code === \"ECONNABORTED\" ||\r\n        (typeof (axErr as any)?.message === \"string\" &&\r\n          (axErr as any).message.toLowerCase().includes(\"timeout\"))\r\n      )\r\n    ) {\r\n      return Promise.reject<ApiError>({\r\n        code: \"TIMEOUT\",\r\n        message: \"Request timed out\",\r\n      });\r\n    }\r\n\r\n    // 401 handling with single-flight refresh\r\n    const status = axErr?.response?.status;\r\n    const cfg = (axErr?.config || {}) as RetriableConfig;\r\n\r\n    if (status === 401) {\r\n      // Prevent infinite loops only after we've already replayed once\r\n      if ((cfg as any)._retry401Replayed) {\r\n        clearToken();\r\n        if (!IS_TEST && typeof window !== \"undefined\") {\r\n          try {\r\n            // Notify app-wide auth layer to clear any persisted user before navigating\r\n            try { window.dispatchEvent(new CustomEvent(\"auth:unauthorized\")); } catch {}\r\n            if (window.location.protocol === \"file:\") {\r\n              window.location.hash = \"#/login\";\r\n            } else {\r\n              window.location.href = \"/login\";\r\n            }\r\n          } catch {\r\n            // noop\r\n          }\r\n        }\r\n        return Promise.reject<ApiError>({\r\n          code: \"UNAUTHORIZED\",\r\n          message: \"Session expired\",\r\n          status: 401,\r\n        });\r\n      }\r\n\r\n      // Single-flight refresh\r\n      if (!refreshPromise) {\r\n        refreshPromise = refreshAccessToken().finally(() => {\r\n          refreshPromise = null;\r\n        });\r\n      }\r\n\r\n      const newToken = await refreshPromise;\r\n      if (newToken) {\r\n        // Replay original request once with new token\r\n        const nextCfg: any = {\r\n          ...cfg,\r\n          _retry401: true,\r\n          _retry401Replayed: true,\r\n          headers: { ...(cfg.headers || {}), Authorization: `Bearer ${newToken}` },\r\n        };\r\n        try {\r\n          return await api.request(nextCfg);\r\n        } catch (replayErr) {\r\n          // If replay fails, surface normalized error\r\n          const norm =\r\n            axios.isAxiosError(replayErr)\r\n              ? toApiErrorFromAxiosError(replayErr)\r\n              : ({\r\n                  code: \"NETWORK_ERROR\",\r\n                  message: \"Network error\",\r\n                } as ApiError);\r\n          return Promise.reject(norm);\r\n        }\r\n      } else {\r\n        // Refresh failed - clear and send to login\r\n        clearToken();\r\n        if (!IS_TEST && typeof window !== \"undefined\") {\r\n          try {\r\n            // Notify app-wide auth layer to clear any persisted user before navigating\r\n            try { window.dispatchEvent(new CustomEvent(\"auth:unauthorized\")); } catch {}\r\n            if (window.location.protocol === \"file:\") {\r\n              window.location.hash = \"#/login\";\r\n            } else {\r\n              window.location.href = \"/login\";\r\n            }\r\n          } catch {\r\n            // noop\r\n          }\r\n        }\r\n        return Promise.reject<ApiError>({\r\n          code: \"UNAUTHORIZED\",\r\n          message: \"Session expired\",\r\n          status: 401,\r\n        });\r\n      }\r\n    }\r\n\r\n    // Optional: one retry for GET on transient errors (no 401)\r\n    const method = ((cfg.method || \"get\") as string).toLowerCase();\r\n    const transientStatus = axErr?.response?.status;\r\n    const isTransientHttp =\r\n      transientStatus === 502 ||\r\n      transientStatus === 503 ||\r\n      transientStatus === 504;\r\n    const isNetworkLike =\r\n      !axErr?.response &&\r\n      (((axErr as any)?.code === \"ECONNABORTED\") ||\r\n        (typeof axErr?.message === \"string\" &&\r\n          axErr.message.toLowerCase().includes(\"network\")));\r\n\r\n    if (\r\n      method === \"get\" &&\r\n      !cfg._retriedOnce &&\r\n      (isTransientHttp || isNetworkLike)\r\n    ) {\r\n      cfg._retriedOnce = true;\r\n      // brief backoff\r\n      await new Promise((r) => setTimeout(r, 200));\r\n      try {\r\n        return await api.request(cfg);\r\n      } catch (retryErr) {\r\n        const r = retryErr as any;\r\n        const norm =\r\n          axios.isAxiosError(retryErr)\r\n            ? toApiErrorFromAxiosError(retryErr)\r\n            : (r?.code === \"ECONNABORTED\" ||\r\n                (typeof r?.message === \"string\" &&\r\n                  r.message.toLowerCase().includes(\"timeout\")))\r\n            ? ({ code: \"TIMEOUT\", message: \"Request timed out\" } as ApiError)\r\n            : ({ code: \"NETWORK_ERROR\", message: \"Network error\" } as ApiError);\r\n        return Promise.reject(norm);\r\n      }\r\n    }\r\n\r\n    // Normalize remaining errors\r\n    const normalized: ApiError = axios.isAxiosError(axErr)\r\n      ? toApiErrorFromAxiosError(axErr)\r\n      : ((axErr as any)?.code === \"ECONNABORTED\" ||\r\n          (typeof (axErr as any)?.message === \"string\" &&\r\n            (axErr as any).message.toLowerCase().includes(\"timeout\")))\r\n        ? { code: \"TIMEOUT\", message: \"Request timed out\" }\r\n        : { code: \"NETWORK_ERROR\", message: \"Network error\" };\r\n\r\n    return Promise.reject(normalized);\r\n  }\r\n);\r\n\r\nexport default api;\r\n","import { io, Socket } from \"socket.io-client\";\r\nimport {\r\n  getToken as getMemToken,\r\n  setToken as setMemToken,\r\n  clearToken as clearMemToken,\r\n} from \"./tokenProvider\";\r\nimport { refreshAccessToken } from \"./api\";\r\nimport { getCurrentApiConfig } from \"../utils/apiConfig\";\r\n\r\nconst IS_TEST =\r\n  typeof process !== \"undefined\" && (process as any)?.env?.NODE_ENV === \"test\";\r\n\r\nlet socket: Socket | null = null;\r\n\r\n// Single-flight refresh guard for Socket auth failures\r\nlet refreshPromise: Promise<string | null> | null = null;\r\nlet lastRefreshFailAt = 0;\r\n\r\n// Get socket configuration with HTTPS enforcement\r\nconst apiConfig = getCurrentApiConfig();\r\nconsole.log(' Socket Debug - API Config:', {\r\n  socketUrl: apiConfig.socketUrl,\r\n  httpsEnforced: apiConfig.httpsEnforced,\r\n  isProduction: apiConfig.isProduction,\r\n  isDesktop: apiConfig.isDesktop\r\n});\r\n\r\nfunction getApiBase(): string {\r\n  // Use the HTTPS-enforced socket URL from configuration\r\n  return apiConfig.socketUrl;\r\n}\r\n\r\nfunction getStoredToken(): string | null {\r\n  // Prefer in-memory token (desktop). Fallback to persisted for web.\r\n  const mem = getMemToken();\r\n  if (mem) return mem;\r\n  try {\r\n    const raw = localStorage.getItem(\"auth-storage\");\r\n    if (!raw) return null;\r\n    const parsed = JSON.parse(raw);\r\n    return parsed?.state?.token || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function connectSocket(provideToken?: () => string | null): Socket {\r\n  const baseUrl = getApiBase();\r\n  const token = (provideToken ? provideToken() : null) ?? getStoredToken();\r\n\r\n  // Idempotent connect\r\n  if (socket && socket.connected) {\r\n    return socket;\r\n  }\r\n\r\n  // Configure transports based on HTTPS enforcement\r\n  const socketOptions: any = {\r\n    transports: [\"websocket\", \"polling\"],\r\n    auth: {\r\n      token: token || \"\",\r\n    },\r\n    autoConnect: true,\r\n  };\r\n\r\n  // Enhanced security for HTTPS-enforced connections\r\n  if (apiConfig.httpsEnforced) {\r\n    socketOptions.secure = true; // Force secure connection\r\n    socketOptions.rejectUnauthorized = true; // Validate SSL certificates\r\n    socketOptions.transports = [\"websocket\"]; // Prefer WebSocket over polling for security\r\n    \r\n    console.log(' Socket: HTTPS enforcement active - using secure WebSocket connection');\r\n  } else {\r\n    // Development mode: force HTTP WebSocket connection\r\n    socketOptions.secure = false; // Force insecure connection for localhost\r\n    socketOptions.transports = [\"websocket\", \"polling\"]; // Allow both transports for reliability\r\n    \r\n    console.log(' Socket: Development mode - using insecure WebSocket connection to', baseUrl);\r\n  }\r\n\r\n  // Log WebSocket connection security status\r\n  if (apiConfig.isProduction && !baseUrl.startsWith('https://')) {\r\n    console.warn('  Socket: Production build using insecure WebSocket connection');\r\n  }\r\n\r\n  console.log(' Attempting WebSocket connection to:', baseUrl, 'with options:', socketOptions);\r\n  socket = io(baseUrl, socketOptions);\r\n\r\n  socket.on(\"connect\", () => {\r\n    console.log(' WebSocket connected successfully! Socket ID:', socket?.id);\r\n  });\r\n\r\n  socket.on(\"disconnect\", (reason) => {\r\n    console.log(' WebSocket disconnected. Reason:', reason);\r\n  });\r\n\r\n  socket.on(\"connect_error\", (error) => {\r\n    console.log(' WebSocket connection error:', error.message, error);\r\n  });\r\n\r\n  // Additional connect_error handler for auth token refresh\r\n  socket.on(\"connect_error\", async (error) => {\r\n    // Log the error first\r\n    console.log(' WebSocket auth error, attempting token refresh:', error?.message);\r\n    \r\n    // Avoid hammering refresh if it just failed within 5s\r\n    if (Date.now() - lastRefreshFailAt < 5000) {\r\n      console.log(' Skipping refresh - too recent');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if (!refreshPromise) {\r\n        refreshPromise = refreshAccessToken().finally(() => {\r\n          refreshPromise = null;\r\n        });\r\n      }\r\n      const newToken = await refreshPromise;\r\n      if (newToken) {\r\n        setMemToken(newToken);\r\n        if (socket) {\r\n          socket.auth = { ...(socket.auth || {}), token: newToken };\r\n          // If not connected, trigger reconnect with fresh token\r\n          if (!socket.connected) {\r\n            socket.connect();\r\n          }\r\n        }\r\n      } else {\r\n        // Refresh failed  clear token and let app route guards/UI handle re-login\r\n        lastRefreshFailAt = Date.now();\r\n        clearMemToken();\r\n        // Optional: force navigation for immediate UX (skip during tests)\r\n        try {\r\n          if (!IS_TEST && typeof window !== \"undefined\") {\r\n            try { window.dispatchEvent(new CustomEvent(\"auth:unauthorized\")); } catch {}\r\n            if (window.location.protocol === \"file:\") {\r\n              window.location.hash = \"#/login\";\r\n            } else {\r\n              window.location.href = \"/login\";\r\n            }\r\n          }\r\n        } catch {\r\n          // ignore\r\n        }\r\n      }\r\n    } catch {\r\n      // ignore; allow normal reconnect/backoff\r\n    }\r\n  });\r\n\r\n  socket.on(\"disconnect\", () => {\r\n    // console.debug(\"[socket] disconnected\");\r\n  });\r\n\r\n  return socket;\r\n}\r\n\r\nexport function getSocket(): Socket | null {\r\n  return socket;\r\n}\r\n\r\nexport function disconnectSocket(): void {\r\n  try {\r\n    if (socket) {\r\n      socket.removeAllListeners();\r\n      socket.disconnect();\r\n      socket = null;\r\n    }\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { User, Empire } from '@game/shared';\r\nimport { authService } from '../services/authService';\r\nimport { connectSocket, disconnectSocket } from '../services/socket';\r\nimport { setToken as setMemToken, clearToken as clearMemToken } from '../services/tokenProvider';\r\n\r\ninterface AuthState {\r\n  user: Omit<User, 'passwordHash'> | null;\r\n  empire: Empire | null;\r\n  token: string | null;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n}\r\n\r\ninterface AuthActions {\r\n  login: (email: string, password: string) => Promise<void>;\r\n  register: (email: string, username: string, password: string) => Promise<void>;\r\n  logout: () => void;\r\n  unauthorize: () => void;\r\n  clearError: () => void;\r\n  setLoading: (loading: boolean) => void;\r\n  checkAuth: (force?: boolean) => Promise<void>;\r\n  getIsAuthed: () => boolean;\r\n}\r\n\r\nexport const useAuthStore = create<AuthState & AuthActions>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // State\r\n      user: null,\r\n      empire: null,\r\n      token: null,\r\n      isLoading: true,\r\n      error: null,\r\n\r\n      // Actions\r\n      login: async (email: string, password: string) => {\r\n        try {\r\n          set({ isLoading: true, error: null });\r\n\r\n          const response = await authService.login(email, password);\r\n\r\n          if (response.success && response.data) {\r\n            set({\r\n              user: response.data.user,\r\n              empire: response.data.empire || null,\r\n              token: response.data.token,\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n            // Keep access token in-memory only\r\n            try {\r\n              setMemToken(response.data.token);\r\n            } catch {}\r\n            // Save refresh token securely in desktop keychain (best-effort)\r\n            try {\r\n              const rt = (response.data as any)?.refreshToken;\r\n              if (typeof window !== 'undefined' && window.desktop?.tokens?.saveRefresh && rt) {\r\n                await window.desktop.tokens.saveRefresh(rt);\r\n              }\r\n            } catch {\r\n              // ignore secure storage errors\r\n            }\r\n            // Establish authenticated Socket.IO connection\r\n            try {\r\n              connectSocket(() => get().token);\r\n            } catch {\r\n              // ignore socket errors\r\n            }\r\n          } else {\r\n            set({\r\n              error: response.error || 'Login failed',\r\n              isLoading: false,\r\n            });\r\n          }\r\n        } catch (error) {\r\n          set({\r\n            error: error instanceof Error ? error.message : 'Login failed',\r\n            isLoading: false,\r\n          });\r\n        }\r\n      },\r\n\r\n      register: async (email: string, username: string, password: string) => {\r\n        try {\r\n          set({ isLoading: true, error: null });\r\n\r\n          const response = await authService.register(email, username, password);\r\n\r\n          if (response.success && response.data) {\r\n            set({\r\n              user: response.data.user,\r\n              empire: response.data.empire || null,\r\n              token: response.data.token,\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n            // Keep access token in-memory only\r\n            try {\r\n              setMemToken(response.data.token);\r\n            } catch {}\r\n            // Save refresh token securely in desktop keychain (best-effort)\r\n            try {\r\n              const rt = (response.data as any)?.refreshToken;\r\n              if (typeof window !== 'undefined' && window.desktop?.tokens?.saveRefresh && rt) {\r\n                await window.desktop.tokens.saveRefresh(rt);\r\n              }\r\n            } catch {\r\n              // ignore secure storage errors\r\n            }\r\n            // Establish authenticated Socket.IO connection\r\n            try {\r\n              connectSocket(() => get().token);\r\n            } catch {\r\n              // ignore socket errors\r\n            }\r\n          } else {\r\n            set({\r\n              error: response.error || 'Registration failed',\r\n              isLoading: false,\r\n            });\r\n          }\r\n        } catch (error) {\r\n          set({\r\n            error: error instanceof Error ? error.message : 'Registration failed',\r\n            isLoading: false,\r\n          });\r\n        }\r\n      },\r\n\r\n      logout: () => {\r\n        authService.logout();\r\n        // Best-effort secure token cleanup on desktop and memory\r\n        try {\r\n          if (typeof window !== 'undefined' && window.desktop?.tokens?.deleteRefresh) {\r\n            window.desktop.tokens.deleteRefresh();\r\n          }\r\n        } catch {\r\n          // ignore\r\n        }\r\n        try { clearMemToken(); } catch {}\r\n        try {\r\n          disconnectSocket();\r\n        } catch {\r\n          // ignore\r\n        }\r\n        set({\r\n          user: null,\r\n          empire: null,\r\n          token: null,\r\n          error: null,\r\n        });\r\n      },\r\n\r\n      // Clear auth state on unauthorized responses without making network calls\r\n      unauthorize: () => {\r\n        try { clearMemToken(); } catch {}\r\n        try { disconnectSocket(); } catch {}\r\n        set({\r\n          user: null,\r\n          empire: null,\r\n          token: null,\r\n          isLoading: false,\r\n          error: null,\r\n        });\r\n      },\r\n\r\n      clearError: () => {\r\n        set({ error: null });\r\n      },\r\n\r\n      setLoading: (loading: boolean) => {\r\n        set({ isLoading: loading });\r\n      },\r\n\r\n      getIsAuthed: () => {\r\n        const { token, user } = get();\r\n        return !!token && !!user;\r\n      },\r\n\r\n      checkAuth: async (force: boolean = false) => {\r\n        let { token } = get();\r\n\r\n        // If no token in memory/state, attempt desktop refresh using stored refresh token\r\n        if (!token && typeof window !== 'undefined' && window.desktop?.tokens?.hasRefresh && window.desktop?.auth?.refresh) {\r\n          try {\r\n            const probe = await window.desktop.tokens.hasRefresh();\r\n            if (probe?.ok && probe.has) {\r\n              const result = await window.desktop.auth.refresh();\r\n              if (result?.ok && result.token) {\r\n                setMemToken(result.token);\r\n                set({ token: result.token });\r\n                token = result.token;\r\n              }\r\n            }\r\n          } catch {\r\n            // ignore\r\n          }\r\n        }\r\n\r\n        if (!token) {\r\n          set({ user: null, empire: null, isLoading: false, error: null });\r\n          try {\r\n            disconnectSocket();\r\n          } catch {\r\n            // ignore\r\n          }\r\n          return;\r\n        }\r\n\r\n        try {\r\n          set({ isLoading: true });\r\n\r\n          const response = await authService.getProfile(force);\r\n\r\n          if (response.success && response.data) {\r\n            set({\r\n              user: response.data.user,\r\n              empire: response.data.empire || null,\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n            // Ensure socket is connected when a valid session exists\r\n            try {\r\n              connectSocket(() => get().token);\r\n            } catch {\r\n              // ignore\r\n            }\r\n          } else {\r\n            // Token is invalid, clear auth state\r\n            set({\r\n              user: null,\r\n              empire: null,\r\n              token: null,\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n            try {\r\n              disconnectSocket();\r\n            } catch {\r\n              // ignore\r\n            }\r\n          }\r\n        } catch {\r\n          // Token is invalid or network error, clear auth state\r\n          set({\r\n            user: null,\r\n            empire: null,\r\n            token: null,\r\n            isLoading: false,\r\n            error: null,\r\n          });\r\n          try {\r\n            disconnectSocket();\r\n          } catch {\r\n            // ignore\r\n          }\r\n        }\r\n      },\r\n    }),\r\n    {\r\n      name: 'auth-storage',\r\n      partialize: (state) => ({\r\n        // Do NOT persist access token\r\n        user: state.user,\r\n        empire: state.empire,\r\n      }),\r\n    }\r\n  )\r\n);\r\n\r\n/**\r\n * Initialize auth check on app start (HMR-safe).\r\n * Prevent multiple /auth/me storms by guarding with a window-level flag.\r\n */\r\nif (typeof window !== 'undefined') {\r\n  const w = window as any;\r\n  if (!w.__AUTH_CHECK_RAN__) {\r\n    w.__AUTH_CHECK_RAN__ = true;\r\n    useAuthStore.getState().checkAuth();\r\n  }\r\n}\r\n","import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { getCurrentApiConfig } from '../utils/apiConfig';\r\n\r\nexport interface NetworkStatus {\r\n  isOnline: boolean;\r\n  isApiReachable: boolean;\r\n  lastChecked: number;\r\n  latencyMs?: number;\r\n  error?: string;\r\n}\r\n\r\ninterface NetworkContextType {\r\n  status: NetworkStatus;\r\n  isFullyConnected: boolean;\r\n}\r\n\r\nconst NetworkContext = createContext<NetworkContextType | undefined>(undefined);\r\n\r\nexport const useNetwork = (): NetworkContextType => {\r\n  const context = useContext(NetworkContext);\r\n  if (!context) {\r\n    throw new Error('useNetwork must be used within a NetworkProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface NetworkProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const NetworkProvider: React.FC<NetworkProviderProps> = ({ children }) => {\r\n  const [status, setStatus] = useState<NetworkStatus>({\r\n    isOnline: navigator.onLine,\r\n    isApiReachable: true,\r\n    lastChecked: Date.now(),\r\n  });\r\n\r\n  const isFullyConnected = status.isOnline && status.isApiReachable;\r\n\r\n  useEffect(() => {\r\n    // Check network connectivity\r\n    const checkConnectivity = async () => {\r\n      try {\r\n        const startTime = Date.now();\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\r\n        \r\n        // Use the full API URL for desktop app\r\n        const apiConfig = getCurrentApiConfig();\r\n        const statusUrl = `${apiConfig.apiUrl.replace('/api', '')}/api/status`;\r\n        console.log(' NetworkContext: Checking connectivity to:', statusUrl);\r\n\r\n        const response = await fetch(statusUrl, {\r\n          method: 'GET',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          signal: controller.signal,\r\n        });\r\n\r\n        clearTimeout(timeoutId);\r\n\r\n        const endTime = Date.now();\r\n        const latencyMs = endTime - startTime;\r\n        \r\n        console.log(' NetworkContext: API connectivity check result:', {\r\n          ok: response.ok,\r\n          status: response.status,\r\n          latencyMs\r\n        });\r\n\r\n        setStatus({\r\n          isOnline: true,\r\n          isApiReachable: response.ok,\r\n          lastChecked: Date.now(),\r\n          latencyMs: response.ok ? latencyMs : undefined,\r\n          error: response.ok ? undefined : `HTTP ${response.status}`,\r\n        });\r\n      } catch (error: any) {\r\n        setStatus({\r\n          isOnline: true,\r\n          isApiReachable: false,\r\n          lastChecked: Date.now(),\r\n          error: error.name === 'AbortError' ? 'timeout' : error.message || 'network_error',\r\n        });\r\n      }\r\n    };\r\n\r\n    // Initial check\r\n    checkConnectivity();\r\n\r\n    // Browser online/offline events\r\n    const handleOnline = () => {\r\n      setStatus(prev => ({\r\n        ...prev,\r\n        isOnline: true,\r\n        lastChecked: Date.now(),\r\n      }));\r\n      checkConnectivity();\r\n    };\r\n\r\n    const handleOffline = () => {\r\n      setStatus({\r\n        isOnline: false,\r\n        isApiReachable: false,\r\n        lastChecked: Date.now(),\r\n      });\r\n    };\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    // Periodic checks every 30 seconds\r\n    const intervalId = setInterval(checkConnectivity, 30000);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n      clearInterval(intervalId);\r\n    };\r\n  }, []);\r\n\r\n  const contextValue: NetworkContextType = {\r\n    status,\r\n    isFullyConnected,\r\n  };\r\n\r\n  return (\r\n    <NetworkContext.Provider value={contextValue}>\r\n      {children}\r\n    </NetworkContext.Provider>\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport { useNetwork } from \"./NetworkContext\";\r\n\r\nexport type SyncState = \"idle\" | \"syncing\" | \"error\";\r\n\r\nexport interface SyncStatus {\r\n  state: SyncState;\r\n  queuedCount: number;\r\n  lastRunAt?: number;\r\n  lastDurationMs?: number;\r\n  lastError?: string;\r\n}\r\n\r\ninterface SyncContextType {\r\n  status: SyncStatus;\r\n}\r\n\r\nconst SyncContext = React.createContext<SyncContextType | undefined>(undefined);\r\n\r\nexport const useSync = (): SyncContextType => {\r\n  const ctx = React.useContext(SyncContext);\r\n  if (!ctx) {\r\n    throw new Error(\"useSync must be used within a SyncProvider\");\r\n  }\r\n  return ctx;\r\n};\r\n\r\ninterface SyncProviderProps {\r\n  children: React.ReactNode;\r\n  pollMs?: number;\r\n}\r\n\r\nfunction getIsDesktop(): boolean {\r\n  return typeof window !== \"undefined\" && !!(window as any).desktop;\r\n}\r\n\r\n/**\r\n * Determine sync state from queued items, network state, and recent perf metrics.\r\n * Priority: error > syncing > idle\r\n */\r\nfunction computeState(params: {\r\n  queuedCount: number;\r\n  isFullyConnected: boolean;\r\n  recentError?: string | undefined;\r\n}): SyncState {\r\n  if (params.recentError) return \"error\";\r\n  if (params.queuedCount > 0 && params.isFullyConnected) return \"syncing\";\r\n  return \"idle\";\r\n}\r\n\r\nexport const SyncProvider: React.FC<SyncProviderProps> = ({ children, pollMs = 5000 }) => {\r\n  const { isFullyConnected } = useNetwork();\r\n\r\n  const [status, setStatus] = React.useState<SyncStatus>({\r\n    state: \"idle\",\r\n    queuedCount: 0,\r\n  });\r\n\r\n  // Poll desktop IPC for queue count and recent perf errors when running in Electron\r\n  React.useEffect(() => {\r\n    let timer: number | undefined;\r\n\r\n    const tick = async () => {\r\n      try {\r\n        const isDesktop = getIsDesktop();\r\n        let queuedCount = 0;\r\n        let recentError: string | undefined;\r\n        let lastRunAt: number | undefined;\r\n        let lastDurationMs: number | undefined;\r\n\r\n        if (isDesktop) {\r\n          // 1) Pending queue count\r\n          try {\r\n            const resp = await (window as any).desktop?.db?.events?.getPendingCount?.(null);\r\n            if (resp && resp.success) {\r\n              queuedCount = typeof resp.count === \"number\" ? resp.count : 0;\r\n            }\r\n          } catch {\r\n            // ignore and keep queuedCount = 0\r\n          }\r\n\r\n          // 2) Recent performance metrics (lookback ~1 hour, then filter to last 2 minutes)\r\n          try {\r\n            const perf = await (window as any).desktop?.perf?.getMetrics?.(1);\r\n            if (perf && perf.success && Array.isArray(perf.data)) {\r\n              const metrics: Array<any> = perf.data;\r\n\r\n              // Find the latest flush/boot completion metric\r\n              const interesting = metrics\r\n                .filter((m) =>\r\n                  m &&\r\n                  typeof m === \"object\" &&\r\n                  (m.operation === \"flush_cycle_complete\" || m.operation === \"bootstrap_complete\")\r\n                )\r\n                .sort((a, b) => (b.timestamp ?? 0) - (a.timestamp ?? 0));\r\n\r\n              if (interesting.length > 0) {\r\n                const latest = interesting[0];\r\n                lastRunAt = typeof latest.timestamp === \"number\"\r\n                  ? latest.timestamp\r\n                  : (latest.timestamp ? new Date(latest.timestamp).getTime() : undefined);\r\n                lastDurationMs = typeof latest.durationMs === \"number\" ? latest.durationMs : undefined;\r\n\r\n                // Consider an error \"recent\" if within the last 2 minutes\r\n                const now = Date.now();\r\n                const windowMs = 2 * 60 * 1000;\r\n                const withinWindow = lastRunAt ? (now - lastRunAt) <= windowMs : false;\r\n\r\n                if (withinWindow && latest.success === false) {\r\n                  recentError = latest.error || \"sync_failed\";\r\n                }\r\n              }\r\n            }\r\n          } catch {\r\n            // ignore perf errors; we can still show queued count\r\n          }\r\n        }\r\n\r\n        const nextState = computeState({ queuedCount, isFullyConnected, recentError });\r\n        setStatus({\r\n          state: nextState,\r\n          queuedCount,\r\n          lastRunAt,\r\n          lastDurationMs,\r\n          lastError: recentError,\r\n        });\r\n      } catch {\r\n        // On any exception, keep previous status but don't crash provider\r\n      } finally {\r\n        timer = window.setTimeout(tick, pollMs);\r\n      }\r\n    };\r\n\r\n    // Start polling\r\n    tick();\r\n\r\n    return () => {\r\n      if (timer) window.clearTimeout(timer);\r\n    };\r\n  }, [isFullyConnected, pollMs]);\r\n\r\n  const value: SyncContextType = React.useMemo(() => ({ status }), [status]);\r\n\r\n  return <SyncContext.Provider value={value}>{children}</SyncContext.Provider>;\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useNetwork } from '../../contexts/NetworkContext';\r\n\r\nconst ConnectionBanner: React.FC = () => {\r\n  const { status: networkStatus, isFullyConnected } = useNetwork();\r\n  const [isVisible, setIsVisible] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Show banner when connection state changes\r\n    if (!isFullyConnected) {\r\n      setIsVisible(true);\r\n      // Auto-hide success banner after 3 seconds\r\n      const timer = setTimeout(() => {\r\n        if (isFullyConnected) {\r\n          setIsVisible(false);\r\n        }\r\n      }, 3000);\r\n      return () => clearTimeout(timer);\r\n    } else {\r\n      // Hide immediately when connected\r\n      setIsVisible(false);\r\n    }\r\n  }, [isFullyConnected]);\r\n\r\n  if (!isVisible) return null;\r\n\r\n  const getMessage = () => {\r\n    if (!networkStatus.isOnline) return 'No internet connection';\r\n    if (!networkStatus.isApiReachable) return 'Server unreachable';\r\n    return 'Connected to server';\r\n  };\r\n\r\n  const getType = () => {\r\n    if (!networkStatus.isOnline) return 'offline';\r\n    if (!networkStatus.isApiReachable) return 'degraded';\r\n    return 'online';\r\n  };\r\n\r\n  const type = getType();\r\n  const message = getMessage();\r\n  const isSuccess = type === 'online';\r\n  const isWarning = type === 'degraded';\r\n  const isError = type === 'offline';\r\n\r\n  return (\r\n    <div className=\"fixed top-0 left-0 right-0 z-50\">\r\n      <div\r\n        className={`\r\n          flex items-center justify-between px-4 py-2 text-sm font-medium transition-all duration-300 ease-in-out\r\n          ${isSuccess ? 'bg-green-600' : ''}\r\n          ${isWarning ? 'bg-yellow-600' : ''}\r\n          ${isError ? 'bg-red-600' : ''}\r\n        `}\r\n      >\r\n        <div className=\"flex items-center space-x-2\">\r\n          <div className={`w-2 h-2 rounded-full ${isSuccess ? 'bg-green-200' : isWarning ? 'bg-yellow-200' : 'bg-red-200'}`} />\r\n          <span>{message}</span>\r\n          {networkStatus.latencyMs && (\r\n            <span className=\"text-xs opacity-75\">\r\n              ({networkStatus.latencyMs}ms)\r\n            </span>\r\n          )}\r\n        </div>\r\n        <div className=\"flex items-center space-x-2\">\r\n          {!isSuccess && networkStatus.lastChecked && (\r\n            <span className=\"text-xs opacity-75\">\r\n              Last checked: {new Date(networkStatus.lastChecked).toLocaleTimeString()}\r\n            </span>\r\n          )}\r\n          <button\r\n            onClick={() => setIsVisible(false)}\r\n            className=\"opacity-75 hover:opacity-100 transition-opacity\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConnectionBanner;\r\n","import React, { useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { useAuthStore } from '../../stores/authStore';\r\n\r\nconst Login: React.FC = () => {\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const { login, isLoading, error, clearError } = useAuthStore();\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    clearError();\r\n    await login(email, password);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-900\">\r\n      <div className=\"max-w-md w-full space-y-8\">\r\n        <div>\r\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-white\">\r\n            Welcome to Attrition\r\n          </h2>\r\n          <p className=\"mt-2 text-center text-sm text-gray-400\">\r\n            Sign in to your account\r\n          </p>\r\n        </div>\r\n        \r\n        <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit}>\r\n          <div className=\"game-card\">\r\n            {error && (\r\n              <div className=\"mb-4 p-3 bg-red-600 bg-opacity-20 border border-red-600 rounded text-red-400 text-sm\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n                  Email Address\r\n                </label>\r\n                <input\r\n                  id=\"email\"\r\n                  data-testid=\"login-email\"\r\n                  name=\"email\"\r\n                  type=\"email\"\r\n                  autoComplete=\"email\"\r\n                  required\r\n                  className=\"game-input w-full\"\r\n                  placeholder=\"Enter your email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n                  Password\r\n                </label>\r\n                <input\r\n                  id=\"password\"\r\n                  data-testid=\"login-password\"\r\n                  name=\"password\"\r\n                  type=\"password\"\r\n                  autoComplete=\"current-password\"\r\n                  required\r\n                  className=\"game-input w-full\"\r\n                  placeholder=\"Enter your password\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-6\">\r\n              <button\r\n                type=\"submit\"\r\n                data-testid=\"login-submit\"\r\n                disabled={isLoading}\r\n                className=\"game-button w-full\"\r\n              >\r\n                {isLoading ? (\r\n                  <div className=\"flex items-center justify-center\">\r\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                    Signing in...\r\n                  </div>\r\n                ) : (\r\n                  'Sign in'\r\n                )}\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"mt-4 text-center\">\r\n              <p className=\"text-sm text-gray-400\">\r\n                Don't have an account?{' '}\r\n                <Link to=\"/register\" className=\"text-blue-400 hover:text-blue-300\">\r\n                  Create one here\r\n                </Link>\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n","import React, { useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { useAuthStore } from '../../stores/authStore';\r\n\r\nconst Register: React.FC = () => {\r\n  const [email, setEmail] = useState('');\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const { register, isLoading, error, clearError } = useAuthStore();\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    clearError();\r\n    \r\n    if (password !== confirmPassword) {\r\n      // Handle password mismatch locally\r\n      return;\r\n    }\r\n    \r\n    await register(email, username, password);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-900\">\r\n      <div className=\"max-w-md w-full space-y-8\">\r\n        <div>\r\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-white\">\r\n            Join Attrition\r\n          </h2>\r\n          <p className=\"mt-2 text-center text-sm text-gray-400\">\r\n            Create your account and build your empire\r\n          </p>\r\n        </div>\r\n        \r\n        <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit}>\r\n          <div className=\"game-card\">\r\n            {error && (\r\n              <div className=\"mb-4 p-3 bg-red-600 bg-opacity-20 border border-red-600 rounded text-red-400 text-sm\">\r\n                {error}\r\n              </div>\r\n            )}\r\n            \r\n            {password !== confirmPassword && confirmPassword && (\r\n              <div className=\"mb-4 p-3 bg-red-600 bg-opacity-20 border border-red-600 rounded text-red-400 text-sm\">\r\n                Passwords do not match\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n                  Email Address\r\n                </label>\r\n                <input\r\n                  id=\"email\"\r\n                  name=\"email\"\r\n                  type=\"email\"\r\n                  autoComplete=\"email\"\r\n                  required\r\n                  className=\"game-input w-full\"\r\n                  placeholder=\"Enter your email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"username\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n                  Username\r\n                </label>\r\n                <input\r\n                  id=\"username\"\r\n                  name=\"username\"\r\n                  type=\"text\"\r\n                  autoComplete=\"username\"\r\n                  required\r\n                  className=\"game-input w-full\"\r\n                  placeholder=\"Choose a username\"\r\n                  value={username}\r\n                  onChange={(e) => setUsername(e.target.value)}\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n                  Password\r\n                </label>\r\n                <input\r\n                  id=\"password\"\r\n                  name=\"password\"\r\n                  type=\"password\"\r\n                  autoComplete=\"new-password\"\r\n                  required\r\n                  className=\"game-input w-full\"\r\n                  placeholder=\"Create a password\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n                  Confirm Password\r\n                </label>\r\n                <input\r\n                  id=\"confirmPassword\"\r\n                  name=\"confirmPassword\"\r\n                  type=\"password\"\r\n                  autoComplete=\"new-password\"\r\n                  required\r\n                  className=\"game-input w-full\"\r\n                  placeholder=\"Confirm your password\"\r\n                  value={confirmPassword}\r\n                  onChange={(e) => setConfirmPassword(e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-6\">\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading || password !== confirmPassword}\r\n                className=\"game-button w-full\"\r\n              >\r\n                {isLoading ? (\r\n                  <div className=\"flex items-center justify-center\">\r\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                    Creating account...\r\n                  </div>\r\n                ) : (\r\n                  'Create Account'\r\n                )}\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"mt-4 text-center\">\r\n              <p className=\"text-sm text-gray-400\">\r\n                Already have an account?{' '}\r\n                <Link to=\"/login\" className=\"text-blue-400 hover:text-blue-300\">\r\n                  Sign in here\r\n                </Link>\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Register;\r\n","import { create } from 'zustand';\r\n\r\nexport type ModalType = 'research' | 'galaxy' | 'fleet' | 'game_info' | 'capacity_breakdown' | 'energy_breakdown' | 'area_breakdown' | 'population_breakdown' | 'levels_table' | 'research_levels_table' | null;\r\n\r\ninterface ModalState {\r\n  isOpen: boolean;\r\n  type: ModalType;\r\n  data?: any;\r\n}\r\n\r\ninterface ModalActions {\r\n  openModal: (type: ModalType, data?: any) => void;\r\n  closeModal: () => void;\r\n}\r\n\r\nexport const useModalStore = create<ModalState & ModalActions>((set) => ({\r\n  isOpen: false,\r\n  type: null,\r\n  data: null,\r\n  openModal: (type: ModalType, data?: any) => set({ isOpen: true, type, data }),\r\n  closeModal: () => set({ isOpen: false, type: null, data: null })\r\n}));\r\n","import React, { useEffect } from 'react';\r\n\r\ninterface ModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  title: string;\r\n  children: React.ReactNode;\r\n  size?: 'sm' | 'md' | 'lg' | 'xl' | '2xl';\r\n}\r\n\r\nconst Modal: React.FC<ModalProps> = ({ isOpen, onClose, title, children, size = 'lg' }) => {\r\n  // Handle escape key\r\n  useEffect(() => {\r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleEscape);\r\n      document.body.style.overflow = 'hidden';\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleEscape);\r\n      document.body.style.overflow = 'unset';\r\n    };\r\n  }, [isOpen, onClose]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const sizeClasses: Record<'sm' | 'md' | 'lg' | 'xl' | '2xl', string> = {\r\n    sm: 'max-w-md',\r\n    md: 'max-w-lg',\r\n    lg: 'max-w-2xl',\r\n    xl: 'max-w-4xl',\r\n    '2xl': 'max-w-6xl'\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n      {/* Backdrop */}\r\n      <div \r\n        className=\"absolute inset-0 bg-black bg-opacity-75 backdrop-blur-sm\"\r\n        onClick={onClose}\r\n      />\r\n      \r\n      {/* Modal Content */}\r\n      <div className={`relative bg-gray-800 rounded-lg shadow-2xl border border-gray-600 w-full mx-4 ${sizeClasses[size]} max-h-[90vh] overflow-hidden`}>\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-600\">\r\n          <h2 className=\"text-xl font-semibold text-white\">{title}</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-white transition-colors p-1 rounded-md hover:bg-gray-700\"\r\n          >\r\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Content */}\r\n        <div className=\"p-4 overflow-y-auto max-h-[calc(90vh-80px)]\">\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Modal;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Empire, ResearchProject } from '@game/shared';\r\nimport axios from 'axios';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\ninterface ResearchTemplate {\r\n  type: 'military' | 'economic' | 'exploration';\r\n  name: string;\r\n  description: string;\r\n  researchCost: number;\r\n  benefits: {\r\n    resourceBonus?: {\r\n      creditsPerHour?: number;\r\n    };\r\n    buildingUnlock?: string[];\r\n    shipUnlock?: string[];\r\n    other?: string[];\r\n  };\r\n}\r\n\r\ninterface ResearchModalProps {\r\n  empire: Empire;\r\n  onUpdate: () => void;\r\n}\r\n\r\nconst ResearchModal: React.FC<ResearchModalProps> = ({ empire, onUpdate }) => {\r\n  const [activeTab, setActiveTab] = useState<'available' | 'active' | 'completed'>('available');\r\n  const [researchProjects, setResearchProjects] = useState<ResearchProject[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Predefined research templates\r\n  const researchTemplates: ResearchTemplate[] = [\r\n    // Military Research\r\n    {\r\n      type: 'military',\r\n      name: 'Advanced Weaponry',\r\n      description: 'Develop more powerful weapons for your defense stations and fleets.',\r\n      researchCost: 500,\r\n      benefits: {\r\n        other: ['Increases defense station effectiveness by 25%', 'Unlocks advanced weapon systems']\r\n      }\r\n    },\r\n    {\r\n      type: 'military',\r\n      name: 'Shield Technology',\r\n      description: 'Research protective shield systems for buildings and ships.',\r\n      researchCost: 750,\r\n      benefits: {\r\n        other: ['Reduces building damage by 20%', 'Unlocks shield generators']\r\n      }\r\n    },\r\n    {\r\n      type: 'military',\r\n      name: 'Tactical Systems',\r\n      description: 'Improve command and control systems for better military coordination.',\r\n      researchCost: 1000,\r\n      benefits: {\r\n        other: ['Increases fleet coordination', 'Unlocks advanced military buildings']\r\n      }\r\n    },\r\n\r\n    // Economic Research\r\n    {\r\n      type: 'economic',\r\n      name: 'Mining Efficiency',\r\n      description: 'Improve mining techniques to extract more resources from deposits.',\r\n      researchCost: 300,\r\n      benefits: {\r\n        resourceBonus: {\r\n          creditsPerHour: 10\r\n        },\r\n        other: ['Increases all mine production by 20%']\r\n      }\r\n    },\r\n    {\r\n      type: 'economic',\r\n      name: 'Energy Optimization',\r\n      description: 'Develop more efficient energy production and distribution systems.',\r\n      researchCost: 400,\r\n      benefits: {\r\n        resourceBonus: {\r\n          creditsPerHour: 15\r\n        },\r\n        other: ['Increases all energy plant production by 20%']\r\n      }\r\n    },\r\n    {\r\n      type: 'economic',\r\n      name: 'Industrial Automation',\r\n      description: 'Automate production processes to increase factory output.',\r\n      researchCost: 600,\r\n      benefits: {\r\n        other: ['Increases factory production by 30%', 'Reduces construction time by 10%']\r\n      }\r\n    },\r\n    {\r\n      type: 'economic',\r\n      name: 'Trade Networks',\r\n      description: 'Establish efficient trade routes to boost economic growth.',\r\n      researchCost: 800,\r\n      benefits: {\r\n        other: ['Increases credit generation by 25%', 'Unlocks trade buildings']\r\n      }\r\n    },\r\n\r\n    // Exploration Research\r\n    {\r\n      type: 'exploration',\r\n      name: 'Advanced Sensors',\r\n      description: 'Develop better scanning technology to explore the galaxy more effectively.',\r\n      researchCost: 350,\r\n      benefits: {\r\n        other: ['Reveals more information about locations', 'Increases exploration range']\r\n      }\r\n    },\r\n    {\r\n      type: 'exploration',\r\n      name: 'Faster-Than-Light Travel',\r\n      description: 'Research improved propulsion systems for faster interstellar travel.',\r\n      researchCost: 1200,\r\n      benefits: {\r\n        other: ['Reduces fleet travel time by 50%', 'Unlocks advanced ship designs']\r\n      }\r\n    },\r\n    {\r\n      type: 'exploration',\r\n      name: 'Xenobiology',\r\n      description: 'Study alien life forms and ecosystems for scientific advancement.',\r\n      researchCost: 500,\r\n      benefits: {\r\n        resourceBonus: {\r\n          creditsPerHour: 20\r\n        },\r\n        other: ['Increases research lab efficiency by 25%']\r\n      }\r\n    },\r\n    {\r\n      type: 'exploration',\r\n      name: 'Terraforming Technology',\r\n      description: 'Develop the ability to transform hostile worlds into habitable colonies.',\r\n      researchCost: 1500,\r\n      benefits: {\r\n        other: ['Unlocks terraforming equipment', 'Increases colony growth rate']\r\n      }\r\n    }\r\n  ];\r\n\r\n  // Create authenticated API instance\r\n  const createAuthenticatedApi = () => {\r\n    const api = axios.create({\r\n      baseURL: API_BASE_URL,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    api.interceptors.request.use((config) => {\r\n      const token = localStorage.getItem('auth-storage');\r\n      if (token) {\r\n        try {\r\n          const parsed = JSON.parse(token);\r\n          if (parsed.state?.token) {\r\n            config.headers.Authorization = `Bearer ${parsed.state.token}`;\r\n          }\r\n        } catch (error) {\r\n          console.error('Error parsing auth token:', error);\r\n        }\r\n      }\r\n      return config;\r\n    });\r\n\r\n    return api;\r\n  };\r\n\r\n  const api = createAuthenticatedApi();\r\n\r\n  // Fetch research projects\r\n  const fetchResearchProjects = async () => {\r\n    try {\r\n      const response = await api.get('/game/research');\r\n      if (response.data.success) {\r\n        setResearchProjects(response.data.data.researchProjects);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching research projects:', err);\r\n      setError('Failed to load research projects');\r\n    }\r\n  };\r\n\r\n  // Start research project\r\n  const handleStartResearch = async (template: ResearchTemplate) => {\r\n    if (empire.resources.credits < template.researchCost) {\r\n      setError('Insufficient credits');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await api.post('/game/research/start', {\r\n        type: template.type,\r\n        name: template.name,\r\n        description: template.description,\r\n        researchCost: template.researchCost\r\n      });\r\n\r\n      if (response.data.success) {\r\n        await fetchResearchProjects();\r\n        onUpdate(); // Update dashboard\r\n        setActiveTab('active');\r\n      } else {\r\n        setError(response.data.error || 'Failed to start research');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || 'Network error. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Get research type icon\r\n  const getResearchIcon = (type: string) => {\r\n    const icons: { [key: string]: string } = {\r\n      military: '',\r\n      economic: '',\r\n      exploration: ''\r\n    };\r\n    return icons[type] || '';\r\n  };\r\n\r\n  // Get research type color\r\n  const getResearchColor = (type: string) => {\r\n    const colors: { [key: string]: string } = {\r\n      military: 'text-red-400',\r\n      economic: 'text-yellow-400',\r\n      exploration: 'text-blue-400'\r\n    };\r\n    return colors[type] || 'text-purple-400';\r\n  };\r\n\r\n  // Check if research is already completed or in progress\r\n  const isResearchAvailable = (template: ResearchTemplate) => {\r\n    return !researchProjects.some(project => \r\n      project.name === template.name && (project.isCompleted || !project.isCompleted)\r\n    );\r\n  };\r\n\r\n  // Calculate research progress percentage\r\n  const getResearchProgress = (project: ResearchProject) => {\r\n    return Math.min(100, (project.researchProgress / project.researchCost) * 100);\r\n  };\r\n\r\n  // Estimate completion time\r\n  const estimateCompletionTime = (project: ResearchProject) => {\r\n    const remaining = project.researchCost - project.researchProgress;\r\n    // For now, use a default research rate until we implement the new capacity system\r\n    const researchPerHour = 10; // Default research production\r\n\r\n    if (researchPerHour <= 0) return 'Never (no research production)';\r\n\r\n    const hoursRemaining = remaining / researchPerHour;\r\n\r\n    if (hoursRemaining < 1) return 'Less than 1 hour';\r\n    if (hoursRemaining < 24) return `${Math.ceil(hoursRemaining)} hours`;\r\n\r\n    const daysRemaining = Math.ceil(hoursRemaining / 24);\r\n    return `${daysRemaining} days`;\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchResearchProjects();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Tab Navigation */}\r\n      <div className=\"flex space-x-1 bg-gray-700 p-1 rounded-lg\">\r\n        <button\r\n          onClick={() => setActiveTab('available')}\r\n          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n            activeTab === 'available'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n          }`}\r\n        >\r\n           Available\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('active')}\r\n          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n            activeTab === 'active'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n          }`}\r\n        >\r\n           In Progress\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('completed')}\r\n          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n            activeTab === 'completed'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n          }`}\r\n        >\r\n           Completed\r\n        </button>\r\n      </div>\r\n\r\n      {/* Error Display */}\r\n      {error && (\r\n        <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* Research Funding Display */}\r\n      <div className=\"p-3 bg-gray-700 rounded-lg border border-gray-600\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span className=\"text-gray-300\">Available Credits for Research:</span>\r\n          <span className=\"text-yellow-400 font-mono text-lg\">\r\n             {empire.resources.credits.toLocaleString()}\r\n          </span>\r\n        </div>\r\n        <div className=\"flex items-center justify-between mt-1\">\r\n          <span className=\"text-gray-400 text-sm\">Research funded by credits</span>\r\n          <span className=\"text-blue-400 text-sm\">\r\n            Pay per project\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Tab Content */}\r\n      {activeTab === 'available' && (\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-white\">Available Research Projects</h3>\r\n          \r\n          {/* Research Categories */}\r\n          {['military', 'economic', 'exploration'].map((category) => (\r\n            <div key={category} className=\"space-y-3\">\r\n              <h4 className={`font-medium capitalize flex items-center gap-2 ${getResearchColor(category)}`}>\r\n                {getResearchIcon(category)} {category} Research\r\n              </h4>\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {researchTemplates\r\n                  .filter(template => template.type === category && isResearchAvailable(template))\r\n                  .map((template) => {\r\n                    const canAfford = empire.resources.credits >= template.researchCost;\r\n\r\n                    return (\r\n                      <div\r\n                        key={template.name}\r\n                        className={`p-4 rounded-lg border ${\r\n                          canAfford ? 'border-gray-600 bg-gray-700' : 'border-red-600 bg-red-900/20'\r\n                        }`}\r\n                      >\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                          <h5 className=\"font-medium text-white flex items-center gap-2\">\r\n                            {getResearchIcon(template.type)} {template.name}\r\n                          </h5>\r\n                          <span className={`text-xs px-2 py-1 rounded ${\r\n                            canAfford ? 'bg-yellow-600 text-white' : 'bg-red-600 text-white'\r\n                          }`}>\r\n                             {template.researchCost.toLocaleString()}\r\n                          </span>\r\n                        </div>\r\n                        \r\n                        <p className=\"text-sm text-gray-400 mb-3\">{template.description}</p>\r\n                        \r\n                        <div className=\"space-y-2\">\r\n                          <div className=\"text-xs\">\r\n                            <span className=\"text-gray-400\">Benefits:</span>\r\n                            <ul className=\"mt-1 space-y-1\">\r\n                              {template.benefits.resourceBonus && (\r\n                                <li className=\"text-green-400\">\r\n                                  {template.benefits.resourceBonus.creditsPerHour && `+${template.benefits.resourceBonus.creditsPerHour} Credits/hour`}\r\n                                </li>\r\n                              )}\r\n                              {template.benefits.other?.map((benefit, index) => (\r\n                                <li key={index} className=\"text-blue-400\"> {benefit}</li>\r\n                              ))}\r\n                            </ul>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        <button\r\n                          onClick={() => handleStartResearch(template)}\r\n                          disabled={!canAfford || loading}\r\n                          className={`w-full mt-3 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n                            canAfford\r\n                              ? 'bg-blue-600 hover:bg-blue-700 text-white'\r\n                              : 'bg-gray-600 text-gray-400 cursor-not-allowed'\r\n                          }`}\r\n                        >\r\n                          {loading ? 'Starting Research...' : 'Fund Research'}\r\n                        </button>\r\n                      </div>\r\n                    );\r\n                  })}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {activeTab === 'active' && (\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-white\">Active Research Projects</h3>\r\n          {researchProjects.filter(p => !p.isCompleted).length === 0 ? (\r\n            <p className=\"text-gray-400\">No active research projects. Start a new research project to see progress here!</p>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {researchProjects.filter(p => !p.isCompleted).map((project) => {\r\n                const progress = getResearchProgress(project);\r\n                const estimatedTime = estimateCompletionTime(project);\r\n\r\n                return (\r\n                  <div key={project._id} className=\"p-4 bg-gray-700 rounded-lg border border-gray-600\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <h4 className=\"font-medium text-white flex items-center gap-2\">\r\n                        {getResearchIcon(project.type)} {project.name}\r\n                      </h4>\r\n                      <span className={`text-xs px-2 py-1 rounded ${getResearchColor(project.type)} bg-gray-800`}>\r\n                        {project.type}\r\n                      </span>\r\n                    </div>\r\n                    \r\n                    <p className=\"text-sm text-gray-400 mb-3\">{project.description}</p>\r\n                    \r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex justify-between text-sm\">\r\n                        <span className=\"text-gray-400\">Progress:</span>\r\n                        <span className=\"text-white\">\r\n                          {project.researchProgress.toLocaleString()} / {project.researchCost.toLocaleString()}\r\n                        </span>\r\n                      </div>\r\n                      \r\n                      <div className=\"w-full bg-gray-600 rounded-full h-2\">\r\n                        <div\r\n                          className=\"bg-purple-600 h-2 rounded-full transition-all duration-300\"\r\n                          style={{ width: `${progress}%` }}\r\n                        />\r\n                      </div>\r\n                      \r\n                      <div className=\"flex justify-between text-xs text-gray-400\">\r\n                        <span>{progress.toFixed(1)}% complete</span>\r\n                        <span>ETA: {estimatedTime}</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {activeTab === 'completed' && (\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-white\">Completed Research</h3>\r\n          {researchProjects.filter(p => p.isCompleted).length === 0 ? (\r\n            <p className=\"text-gray-400\">No completed research yet. Complete research projects to see them here!</p>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {researchProjects.filter(p => p.isCompleted).map((project) => (\r\n                <div key={project._id} className=\"p-4 bg-green-900/20 rounded-lg border border-green-600\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <h4 className=\"font-medium text-white flex items-center gap-2\">\r\n                       {getResearchIcon(project.type)} {project.name}\r\n                    </h4>\r\n                    <span className=\"text-xs text-green-400\">\r\n                      Completed {project.completedAt ? new Date(project.completedAt).toLocaleDateString() : 'Recently'}\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  <p className=\"text-sm text-gray-400 mb-2\">{project.description}</p>\r\n                  \r\n                  <div className=\"text-xs text-green-400\">\r\n                     Research benefits are now active across your empire!\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResearchModal;\r\n","// Utility functions for the game\n/**\n * Calculate distance between two coordinates\n */\nexport function calculateDistance(coord1, coord2) {\n    const dx = coord2.x - coord1.x;\n    const dy = coord2.y - coord1.y;\n    return Math.sqrt(dx * dx + dy * dy);\n}\n/**\n * Generate a random coordinate within bounds\n */\nexport function generateRandomCoordinate(maxX, maxY) {\n    return {\n        x: Math.floor(Math.random() * maxX),\n        y: Math.floor(Math.random() * maxY)\n    };\n}\n/**\n * Check if coordinates are within bounds\n */\nexport function isWithinBounds(coord, maxX, maxY) {\n    return coord.x >= 0 && coord.x < maxX && coord.y >= 0 && coord.y < maxY;\n}\n/**\n * Generate a unique name for star systems\n */\nexport function generateSystemName() {\n    const prefixes = ['Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta', 'Theta'];\n    const suffixes = ['Centauri', 'Draconis', 'Orionis', 'Cygni', 'Lyrae', 'Vega', 'Sirius', 'Rigel'];\n    const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];\n    const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];\n    const number = Math.floor(Math.random() * 999) + 1;\n    return `${prefix} ${suffix} ${number}`;\n}\n/**\n * Generate a unique name for planets\n */\nexport function generatePlanetName() {\n    const names = [\n        'Kepler', 'Proxima', 'Gliese', 'Trappist', 'HD', 'K2', 'TOI', 'WASP',\n        'HAT-P', 'XO', 'TrES', 'CoRoT', 'Qatar', 'KELT', 'MASCARA'\n    ];\n    const name = names[Math.floor(Math.random() * names.length)];\n    const number = Math.floor(Math.random() * 9999) + 1;\n    const letter = String.fromCharCode(97 + Math.floor(Math.random() * 26)); // a-z\n    return `${name}-${number}${letter}`;\n}\n/**\n * Calculate travel time between two coordinates\n */\nexport function calculateTravelTime(from, to, speed) {\n    const distance = calculateDistance(from, to);\n    return Math.ceil(distance / speed);\n}\n/**\n * Format large numbers with suffixes (K, M, B)\n */\nexport function formatNumber(num) {\n    if (num >= 1000000000) {\n        return (num / 1000000000).toFixed(1) + 'B';\n    }\n    if (num >= 1000000) {\n        return (num / 1000000).toFixed(1) + 'M';\n    }\n    if (num >= 1000) {\n        return (num / 1000).toFixed(1) + 'K';\n    }\n    return num.toString();\n}\n/**\n * Generate a random integer between min and max (inclusive)\n */\nexport function randomInt(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n/**\n * Generate a random float between min and max\n */\nexport function randomFloat(min, max) {\n    return Math.random() * (max - min) + min;\n}\n/**\n * Clamp a value between min and max\n */\nexport function clamp(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n}\n/**\n * Check if two coordinates are adjacent (within 1 unit)\n */\nexport function areAdjacent(coord1, coord2) {\n    const distance = calculateDistance(coord1, coord2);\n    return distance <= 1.5; // Allow for diagonal adjacency\n}\n/**\n * Get all coordinates within a certain radius\n */\nexport function getCoordinatesInRadius(center, radius, maxX, maxY) {\n    const coordinates = [];\n    for (let x = Math.max(0, center.x - radius); x <= Math.min(maxX - 1, center.x + radius); x++) {\n        for (let y = Math.max(0, center.y - radius); y <= Math.min(maxY - 1, center.y + radius); y++) {\n            const coord = { x, y };\n            if (calculateDistance(center, coord) <= radius) {\n                coordinates.push(coord);\n            }\n        }\n    }\n    return coordinates;\n}\n// ===== NEW HIERARCHICAL COORDINATE SYSTEM UTILITIES =====\n/**\n * Parse coordinate string into components\n * Format: \"A00:10:22:10\" (server:galaxy:region:system:body)\n */\nexport function parseCoord(coordStr) {\n    const coordRegex = /^([A-Z])(\\d{2}):(\\d{2}):(\\d{2}):(\\d{2})$/;\n    const match = coordStr.match(coordRegex);\n    if (!match) {\n        throw new Error(`Invalid coordinate format: ${coordStr}. Expected format: A00:10:22:10`);\n    }\n    return {\n        server: match[1],\n        galaxy: parseInt(match[2], 10),\n        region: parseInt(match[3], 10),\n        system: parseInt(match[4], 10),\n        body: parseInt(match[5], 10)\n    };\n}\n/**\n * Format coordinate components into string\n */\nexport function formatCoord(coord) {\n    return `${coord.server}${coord.galaxy.toString().padStart(2, '0')}:${coord.region.toString().padStart(2, '0')}:${coord.system.toString().padStart(2, '0')}:${coord.body.toString().padStart(2, '0')}`;\n}\n/**\n * Calculate hierarchical distance between two coordinates\n * Distance formula: |galaxy1 - galaxy2| * 10000 + regionGridDist * 1000 + systemGridDist * 100 + |body1 - body2|\n */\nexport function calculateHierarchicalDistance(coord1, coord2) {\n    // Different servers are infinitely far apart\n    if (coord1.server !== coord2.server) {\n        return Infinity;\n    }\n    const galaxyDist = Math.abs(coord1.galaxy - coord2.galaxy) * 10000;\n    // If different galaxies, only galaxy distance matters\n    if (coord1.galaxy !== coord2.galaxy) {\n        return galaxyDist;\n    }\n    // Calculate Manhattan distance in 10x10 region grid\n    const region1X = coord1.region % 10;\n    const region1Y = Math.floor(coord1.region / 10);\n    const region2X = coord2.region % 10;\n    const region2Y = Math.floor(coord2.region / 10);\n    const regionGridDist = (Math.abs(region1X - region2X) + Math.abs(region1Y - region2Y)) * 1000;\n    // If different regions, add region distance\n    if (coord1.region !== coord2.region) {\n        return galaxyDist + regionGridDist;\n    }\n    // Calculate Manhattan distance in 10x10 system grid\n    const system1X = coord1.system % 10;\n    const system1Y = Math.floor(coord1.system / 10);\n    const system2X = coord2.system % 10;\n    const system2Y = Math.floor(coord2.system / 10);\n    const systemGridDist = (Math.abs(system1X - system2X) + Math.abs(system1Y - system2Y)) * 100;\n    // If different systems, add system distance\n    if (coord1.system !== coord2.system) {\n        return galaxyDist + regionGridDist + systemGridDist;\n    }\n    // Same system, just body distance\n    const bodyDist = Math.abs(coord1.body - coord2.body);\n    return galaxyDist + regionGridDist + systemGridDist + bodyDist;\n}\n/**\n * Validate coordinate string format\n */\nexport function isValidCoordinate(coordStr) {\n    try {\n        const coord = parseCoord(coordStr);\n        return (coord.galaxy >= 0 && coord.galaxy <= 39 &&\n            coord.region >= 0 && coord.region <= 99 &&\n            coord.system >= 0 && coord.system <= 99 &&\n            coord.body >= 0 && coord.body <= 19);\n    }\n    catch {\n        return false;\n    }\n}\n/**\n * Generate a random coordinate within valid ranges\n */\nexport function generateRandomHierarchicalCoordinate(server = 'A') {\n    return {\n        server,\n        galaxy: randomInt(0, 39),\n        region: randomInt(0, 99),\n        system: randomInt(0, 99),\n        body: randomInt(0, 19)\n    };\n}\n// ===== COLONIZATION COST UTILITIES =====\n/**\n * Progressive colonization costs based on game mechanics\n * Costs: 100, 200, 500, 1k, 2k, 5k, 10k, 20k, 50k, 100k, 200k, 400k, 650k, 1M, 1.5M, 2.5M, 4M, 6.5M, 10M, 15M, 25M, 40M, 65M, 100M, 150M, 250M, 400M, 650M, ...\n */\nconst COLONIZATION_COSTS = [\n    100, 200, 500, 1000, 2000, 5000, 10000, 20000, 50000, 100000,\n    200000, 400000, 650000, 1000000, 1500000, 2500000, 4000000, 6500000, 10000000, 15000000,\n    25000000, 40000000, 65000000, 100000000, 150000000, 250000000, 400000000, 650000000\n];\n/**\n * Calculate colonization cost based on empire base count and deletion discount\n * @param baseCount Current number of bases the empire owns\n * @param hasDeletedBase Whether empire gets 25% discount from deleting a base\n * @returns Credits cost for next colonization\n */\nexport function getColonizationCost(baseCount, hasDeletedBase) {\n    // Get base cost from progression table\n    const baseCost = COLONIZATION_COSTS[Math.min(baseCount, COLONIZATION_COSTS.length - 1)] || 650000000;\n    // Apply 25% discount if empire has deleted a base\n    return hasDeletedBase ? Math.floor(baseCost * 0.25) : baseCost;\n}\n/**\n * Format credits with appropriate suffixes for display\n * @param amount Credits amount to format\n * @returns Formatted string (e.g., \"1.5K\", \"2.5M\", \"650M\")\n */\nexport function formatCredits(amount) {\n    if (amount >= 1000000000) {\n        return `${(amount / 1000000000).toFixed(1)}B`;\n    }\n    else if (amount >= 1000000) {\n        return `${(amount / 1000000).toFixed(1)}M`;\n    }\n    else if (amount >= 1000) {\n        return `${(amount / 1000).toFixed(1)}K`;\n    }\n    return amount.toString();\n}\n//# sourceMappingURL=utils.js.map","export var util;\n(function (util) {\n    util.assertEqual = (_) => { };\n    function assertIs(_arg) { }\n    util.assertIs = assertIs;\n    function assertNever(_x) {\n        throw new Error();\n    }\n    util.assertNever = assertNever;\n    util.arrayToEnum = (items) => {\n        const obj = {};\n        for (const item of items) {\n            obj[item] = item;\n        }\n        return obj;\n    };\n    util.getValidEnumValues = (obj) => {\n        const validKeys = util.objectKeys(obj).filter((k) => typeof obj[obj[k]] !== \"number\");\n        const filtered = {};\n        for (const k of validKeys) {\n            filtered[k] = obj[k];\n        }\n        return util.objectValues(filtered);\n    };\n    util.objectValues = (obj) => {\n        return util.objectKeys(obj).map(function (e) {\n            return obj[e];\n        });\n    };\n    util.objectKeys = typeof Object.keys === \"function\" // eslint-disable-line ban/ban\n        ? (obj) => Object.keys(obj) // eslint-disable-line ban/ban\n        : (object) => {\n            const keys = [];\n            for (const key in object) {\n                if (Object.prototype.hasOwnProperty.call(object, key)) {\n                    keys.push(key);\n                }\n            }\n            return keys;\n        };\n    util.find = (arr, checker) => {\n        for (const item of arr) {\n            if (checker(item))\n                return item;\n        }\n        return undefined;\n    };\n    util.isInteger = typeof Number.isInteger === \"function\"\n        ? (val) => Number.isInteger(val) // eslint-disable-line ban/ban\n        : (val) => typeof val === \"number\" && Number.isFinite(val) && Math.floor(val) === val;\n    function joinValues(array, separator = \" | \") {\n        return array.map((val) => (typeof val === \"string\" ? `'${val}'` : val)).join(separator);\n    }\n    util.joinValues = joinValues;\n    util.jsonStringifyReplacer = (_, value) => {\n        if (typeof value === \"bigint\") {\n            return value.toString();\n        }\n        return value;\n    };\n})(util || (util = {}));\nexport var objectUtil;\n(function (objectUtil) {\n    objectUtil.mergeShapes = (first, second) => {\n        return {\n            ...first,\n            ...second, // second overwrites first\n        };\n    };\n})(objectUtil || (objectUtil = {}));\nexport const ZodParsedType = util.arrayToEnum([\n    \"string\",\n    \"nan\",\n    \"number\",\n    \"integer\",\n    \"float\",\n    \"boolean\",\n    \"date\",\n    \"bigint\",\n    \"symbol\",\n    \"function\",\n    \"undefined\",\n    \"null\",\n    \"array\",\n    \"object\",\n    \"unknown\",\n    \"promise\",\n    \"void\",\n    \"never\",\n    \"map\",\n    \"set\",\n]);\nexport const getParsedType = (data) => {\n    const t = typeof data;\n    switch (t) {\n        case \"undefined\":\n            return ZodParsedType.undefined;\n        case \"string\":\n            return ZodParsedType.string;\n        case \"number\":\n            return Number.isNaN(data) ? ZodParsedType.nan : ZodParsedType.number;\n        case \"boolean\":\n            return ZodParsedType.boolean;\n        case \"function\":\n            return ZodParsedType.function;\n        case \"bigint\":\n            return ZodParsedType.bigint;\n        case \"symbol\":\n            return ZodParsedType.symbol;\n        case \"object\":\n            if (Array.isArray(data)) {\n                return ZodParsedType.array;\n            }\n            if (data === null) {\n                return ZodParsedType.null;\n            }\n            if (data.then && typeof data.then === \"function\" && data.catch && typeof data.catch === \"function\") {\n                return ZodParsedType.promise;\n            }\n            if (typeof Map !== \"undefined\" && data instanceof Map) {\n                return ZodParsedType.map;\n            }\n            if (typeof Set !== \"undefined\" && data instanceof Set) {\n                return ZodParsedType.set;\n            }\n            if (typeof Date !== \"undefined\" && data instanceof Date) {\n                return ZodParsedType.date;\n            }\n            return ZodParsedType.object;\n        default:\n            return ZodParsedType.unknown;\n    }\n};\n","import { util } from \"./helpers/util.js\";\nexport const ZodIssueCode = util.arrayToEnum([\n    \"invalid_type\",\n    \"invalid_literal\",\n    \"custom\",\n    \"invalid_union\",\n    \"invalid_union_discriminator\",\n    \"invalid_enum_value\",\n    \"unrecognized_keys\",\n    \"invalid_arguments\",\n    \"invalid_return_type\",\n    \"invalid_date\",\n    \"invalid_string\",\n    \"too_small\",\n    \"too_big\",\n    \"invalid_intersection_types\",\n    \"not_multiple_of\",\n    \"not_finite\",\n]);\nexport const quotelessJson = (obj) => {\n    const json = JSON.stringify(obj, null, 2);\n    return json.replace(/\"([^\"]+)\":/g, \"$1:\");\n};\nexport class ZodError extends Error {\n    get errors() {\n        return this.issues;\n    }\n    constructor(issues) {\n        super();\n        this.issues = [];\n        this.addIssue = (sub) => {\n            this.issues = [...this.issues, sub];\n        };\n        this.addIssues = (subs = []) => {\n            this.issues = [...this.issues, ...subs];\n        };\n        const actualProto = new.target.prototype;\n        if (Object.setPrototypeOf) {\n            // eslint-disable-next-line ban/ban\n            Object.setPrototypeOf(this, actualProto);\n        }\n        else {\n            this.__proto__ = actualProto;\n        }\n        this.name = \"ZodError\";\n        this.issues = issues;\n    }\n    format(_mapper) {\n        const mapper = _mapper ||\n            function (issue) {\n                return issue.message;\n            };\n        const fieldErrors = { _errors: [] };\n        const processError = (error) => {\n            for (const issue of error.issues) {\n                if (issue.code === \"invalid_union\") {\n                    issue.unionErrors.map(processError);\n                }\n                else if (issue.code === \"invalid_return_type\") {\n                    processError(issue.returnTypeError);\n                }\n                else if (issue.code === \"invalid_arguments\") {\n                    processError(issue.argumentsError);\n                }\n                else if (issue.path.length === 0) {\n                    fieldErrors._errors.push(mapper(issue));\n                }\n                else {\n                    let curr = fieldErrors;\n                    let i = 0;\n                    while (i < issue.path.length) {\n                        const el = issue.path[i];\n                        const terminal = i === issue.path.length - 1;\n                        if (!terminal) {\n                            curr[el] = curr[el] || { _errors: [] };\n                            // if (typeof el === \"string\") {\n                            //   curr[el] = curr[el] || { _errors: [] };\n                            // } else if (typeof el === \"number\") {\n                            //   const errorArray: any = [];\n                            //   errorArray._errors = [];\n                            //   curr[el] = curr[el] || errorArray;\n                            // }\n                        }\n                        else {\n                            curr[el] = curr[el] || { _errors: [] };\n                            curr[el]._errors.push(mapper(issue));\n                        }\n                        curr = curr[el];\n                        i++;\n                    }\n                }\n            }\n        };\n        processError(this);\n        return fieldErrors;\n    }\n    static assert(value) {\n        if (!(value instanceof ZodError)) {\n            throw new Error(`Not a ZodError: ${value}`);\n        }\n    }\n    toString() {\n        return this.message;\n    }\n    get message() {\n        return JSON.stringify(this.issues, util.jsonStringifyReplacer, 2);\n    }\n    get isEmpty() {\n        return this.issues.length === 0;\n    }\n    flatten(mapper = (issue) => issue.message) {\n        const fieldErrors = {};\n        const formErrors = [];\n        for (const sub of this.issues) {\n            if (sub.path.length > 0) {\n                const firstEl = sub.path[0];\n                fieldErrors[firstEl] = fieldErrors[firstEl] || [];\n                fieldErrors[firstEl].push(mapper(sub));\n            }\n            else {\n                formErrors.push(mapper(sub));\n            }\n        }\n        return { formErrors, fieldErrors };\n    }\n    get formErrors() {\n        return this.flatten();\n    }\n}\nZodError.create = (issues) => {\n    const error = new ZodError(issues);\n    return error;\n};\n","import { ZodIssueCode } from \"../ZodError.js\";\nimport { util, ZodParsedType } from \"../helpers/util.js\";\nconst errorMap = (issue, _ctx) => {\n    let message;\n    switch (issue.code) {\n        case ZodIssueCode.invalid_type:\n            if (issue.received === ZodParsedType.undefined) {\n                message = \"Required\";\n            }\n            else {\n                message = `Expected ${issue.expected}, received ${issue.received}`;\n            }\n            break;\n        case ZodIssueCode.invalid_literal:\n            message = `Invalid literal value, expected ${JSON.stringify(issue.expected, util.jsonStringifyReplacer)}`;\n            break;\n        case ZodIssueCode.unrecognized_keys:\n            message = `Unrecognized key(s) in object: ${util.joinValues(issue.keys, \", \")}`;\n            break;\n        case ZodIssueCode.invalid_union:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_union_discriminator:\n            message = `Invalid discriminator value. Expected ${util.joinValues(issue.options)}`;\n            break;\n        case ZodIssueCode.invalid_enum_value:\n            message = `Invalid enum value. Expected ${util.joinValues(issue.options)}, received '${issue.received}'`;\n            break;\n        case ZodIssueCode.invalid_arguments:\n            message = `Invalid function arguments`;\n            break;\n        case ZodIssueCode.invalid_return_type:\n            message = `Invalid function return type`;\n            break;\n        case ZodIssueCode.invalid_date:\n            message = `Invalid date`;\n            break;\n        case ZodIssueCode.invalid_string:\n            if (typeof issue.validation === \"object\") {\n                if (\"includes\" in issue.validation) {\n                    message = `Invalid input: must include \"${issue.validation.includes}\"`;\n                    if (typeof issue.validation.position === \"number\") {\n                        message = `${message} at one or more positions greater than or equal to ${issue.validation.position}`;\n                    }\n                }\n                else if (\"startsWith\" in issue.validation) {\n                    message = `Invalid input: must start with \"${issue.validation.startsWith}\"`;\n                }\n                else if (\"endsWith\" in issue.validation) {\n                    message = `Invalid input: must end with \"${issue.validation.endsWith}\"`;\n                }\n                else {\n                    util.assertNever(issue.validation);\n                }\n            }\n            else if (issue.validation !== \"regex\") {\n                message = `Invalid ${issue.validation}`;\n            }\n            else {\n                message = \"Invalid\";\n            }\n            break;\n        case ZodIssueCode.too_small:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `more than`} ${issue.minimum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? \"exactly\" : issue.inclusive ? `at least` : `over`} ${issue.minimum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"bigint\")\n                message = `Number must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${issue.minimum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly equal to ` : issue.inclusive ? `greater than or equal to ` : `greater than `}${new Date(Number(issue.minimum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.too_big:\n            if (issue.type === \"array\")\n                message = `Array must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `less than`} ${issue.maximum} element(s)`;\n            else if (issue.type === \"string\")\n                message = `String must contain ${issue.exact ? `exactly` : issue.inclusive ? `at most` : `under`} ${issue.maximum} character(s)`;\n            else if (issue.type === \"number\")\n                message = `Number must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"bigint\")\n                message = `BigInt must be ${issue.exact ? `exactly` : issue.inclusive ? `less than or equal to` : `less than`} ${issue.maximum}`;\n            else if (issue.type === \"date\")\n                message = `Date must be ${issue.exact ? `exactly` : issue.inclusive ? `smaller than or equal to` : `smaller than`} ${new Date(Number(issue.maximum))}`;\n            else\n                message = \"Invalid input\";\n            break;\n        case ZodIssueCode.custom:\n            message = `Invalid input`;\n            break;\n        case ZodIssueCode.invalid_intersection_types:\n            message = `Intersection results could not be merged`;\n            break;\n        case ZodIssueCode.not_multiple_of:\n            message = `Number must be a multiple of ${issue.multipleOf}`;\n            break;\n        case ZodIssueCode.not_finite:\n            message = \"Number must be finite\";\n            break;\n        default:\n            message = _ctx.defaultError;\n            util.assertNever(issue);\n    }\n    return { message };\n};\nexport default errorMap;\n","import defaultErrorMap from \"./locales/en.js\";\nlet overrideErrorMap = defaultErrorMap;\nexport { defaultErrorMap };\nexport function setErrorMap(map) {\n    overrideErrorMap = map;\n}\nexport function getErrorMap() {\n    return overrideErrorMap;\n}\n","import { getErrorMap } from \"../errors.js\";\nimport defaultErrorMap from \"../locales/en.js\";\nexport const makeIssue = (params) => {\n    const { data, path, errorMaps, issueData } = params;\n    const fullPath = [...path, ...(issueData.path || [])];\n    const fullIssue = {\n        ...issueData,\n        path: fullPath,\n    };\n    if (issueData.message !== undefined) {\n        return {\n            ...issueData,\n            path: fullPath,\n            message: issueData.message,\n        };\n    }\n    let errorMessage = \"\";\n    const maps = errorMaps\n        .filter((m) => !!m)\n        .slice()\n        .reverse();\n    for (const map of maps) {\n        errorMessage = map(fullIssue, { data, defaultError: errorMessage }).message;\n    }\n    return {\n        ...issueData,\n        path: fullPath,\n        message: errorMessage,\n    };\n};\nexport const EMPTY_PATH = [];\nexport function addIssueToContext(ctx, issueData) {\n    const overrideMap = getErrorMap();\n    const issue = makeIssue({\n        issueData: issueData,\n        data: ctx.data,\n        path: ctx.path,\n        errorMaps: [\n            ctx.common.contextualErrorMap, // contextual error map is first priority\n            ctx.schemaErrorMap, // then schema-bound map if available\n            overrideMap, // then global override map\n            overrideMap === defaultErrorMap ? undefined : defaultErrorMap, // then global default map\n        ].filter((x) => !!x),\n    });\n    ctx.common.issues.push(issue);\n}\nexport class ParseStatus {\n    constructor() {\n        this.value = \"valid\";\n    }\n    dirty() {\n        if (this.value === \"valid\")\n            this.value = \"dirty\";\n    }\n    abort() {\n        if (this.value !== \"aborted\")\n            this.value = \"aborted\";\n    }\n    static mergeArray(status, results) {\n        const arrayValue = [];\n        for (const s of results) {\n            if (s.status === \"aborted\")\n                return INVALID;\n            if (s.status === \"dirty\")\n                status.dirty();\n            arrayValue.push(s.value);\n        }\n        return { status: status.value, value: arrayValue };\n    }\n    static async mergeObjectAsync(status, pairs) {\n        const syncPairs = [];\n        for (const pair of pairs) {\n            const key = await pair.key;\n            const value = await pair.value;\n            syncPairs.push({\n                key,\n                value,\n            });\n        }\n        return ParseStatus.mergeObjectSync(status, syncPairs);\n    }\n    static mergeObjectSync(status, pairs) {\n        const finalObject = {};\n        for (const pair of pairs) {\n            const { key, value } = pair;\n            if (key.status === \"aborted\")\n                return INVALID;\n            if (value.status === \"aborted\")\n                return INVALID;\n            if (key.status === \"dirty\")\n                status.dirty();\n            if (value.status === \"dirty\")\n                status.dirty();\n            if (key.value !== \"__proto__\" && (typeof value.value !== \"undefined\" || pair.alwaysSet)) {\n                finalObject[key.value] = value.value;\n            }\n        }\n        return { status: status.value, value: finalObject };\n    }\n}\nexport const INVALID = Object.freeze({\n    status: \"aborted\",\n});\nexport const DIRTY = (value) => ({ status: \"dirty\", value });\nexport const OK = (value) => ({ status: \"valid\", value });\nexport const isAborted = (x) => x.status === \"aborted\";\nexport const isDirty = (x) => x.status === \"dirty\";\nexport const isValid = (x) => x.status === \"valid\";\nexport const isAsync = (x) => typeof Promise !== \"undefined\" && x instanceof Promise;\n","export var errorUtil;\n(function (errorUtil) {\n    errorUtil.errToObj = (message) => typeof message === \"string\" ? { message } : message || {};\n    // biome-ignore lint:\n    errorUtil.toString = (message) => typeof message === \"string\" ? message : message?.message;\n})(errorUtil || (errorUtil = {}));\n","import { ZodError, ZodIssueCode, } from \"./ZodError.js\";\nimport { defaultErrorMap, getErrorMap } from \"./errors.js\";\nimport { errorUtil } from \"./helpers/errorUtil.js\";\nimport { DIRTY, INVALID, OK, ParseStatus, addIssueToContext, isAborted, isAsync, isDirty, isValid, makeIssue, } from \"./helpers/parseUtil.js\";\nimport { util, ZodParsedType, getParsedType } from \"./helpers/util.js\";\nclass ParseInputLazyPath {\n    constructor(parent, value, path, key) {\n        this._cachedPath = [];\n        this.parent = parent;\n        this.data = value;\n        this._path = path;\n        this._key = key;\n    }\n    get path() {\n        if (!this._cachedPath.length) {\n            if (Array.isArray(this._key)) {\n                this._cachedPath.push(...this._path, ...this._key);\n            }\n            else {\n                this._cachedPath.push(...this._path, this._key);\n            }\n        }\n        return this._cachedPath;\n    }\n}\nconst handleResult = (ctx, result) => {\n    if (isValid(result)) {\n        return { success: true, data: result.value };\n    }\n    else {\n        if (!ctx.common.issues.length) {\n            throw new Error(\"Validation failed but no issues detected.\");\n        }\n        return {\n            success: false,\n            get error() {\n                if (this._error)\n                    return this._error;\n                const error = new ZodError(ctx.common.issues);\n                this._error = error;\n                return this._error;\n            },\n        };\n    }\n};\nfunction processCreateParams(params) {\n    if (!params)\n        return {};\n    const { errorMap, invalid_type_error, required_error, description } = params;\n    if (errorMap && (invalid_type_error || required_error)) {\n        throw new Error(`Can't use \"invalid_type_error\" or \"required_error\" in conjunction with custom error map.`);\n    }\n    if (errorMap)\n        return { errorMap: errorMap, description };\n    const customMap = (iss, ctx) => {\n        const { message } = params;\n        if (iss.code === \"invalid_enum_value\") {\n            return { message: message ?? ctx.defaultError };\n        }\n        if (typeof ctx.data === \"undefined\") {\n            return { message: message ?? required_error ?? ctx.defaultError };\n        }\n        if (iss.code !== \"invalid_type\")\n            return { message: ctx.defaultError };\n        return { message: message ?? invalid_type_error ?? ctx.defaultError };\n    };\n    return { errorMap: customMap, description };\n}\nexport class ZodType {\n    get description() {\n        return this._def.description;\n    }\n    _getType(input) {\n        return getParsedType(input.data);\n    }\n    _getOrReturnCtx(input, ctx) {\n        return (ctx || {\n            common: input.parent.common,\n            data: input.data,\n            parsedType: getParsedType(input.data),\n            schemaErrorMap: this._def.errorMap,\n            path: input.path,\n            parent: input.parent,\n        });\n    }\n    _processInputParams(input) {\n        return {\n            status: new ParseStatus(),\n            ctx: {\n                common: input.parent.common,\n                data: input.data,\n                parsedType: getParsedType(input.data),\n                schemaErrorMap: this._def.errorMap,\n                path: input.path,\n                parent: input.parent,\n            },\n        };\n    }\n    _parseSync(input) {\n        const result = this._parse(input);\n        if (isAsync(result)) {\n            throw new Error(\"Synchronous parse encountered promise.\");\n        }\n        return result;\n    }\n    _parseAsync(input) {\n        const result = this._parse(input);\n        return Promise.resolve(result);\n    }\n    parse(data, params) {\n        const result = this.safeParse(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    safeParse(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: params?.async ?? false,\n                contextualErrorMap: params?.errorMap,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const result = this._parseSync({ data, path: ctx.path, parent: ctx });\n        return handleResult(ctx, result);\n    }\n    \"~validate\"(data) {\n        const ctx = {\n            common: {\n                issues: [],\n                async: !!this[\"~standard\"].async,\n            },\n            path: [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        if (!this[\"~standard\"].async) {\n            try {\n                const result = this._parseSync({ data, path: [], parent: ctx });\n                return isValid(result)\n                    ? {\n                        value: result.value,\n                    }\n                    : {\n                        issues: ctx.common.issues,\n                    };\n            }\n            catch (err) {\n                if (err?.message?.toLowerCase()?.includes(\"encountered\")) {\n                    this[\"~standard\"].async = true;\n                }\n                ctx.common = {\n                    issues: [],\n                    async: true,\n                };\n            }\n        }\n        return this._parseAsync({ data, path: [], parent: ctx }).then((result) => isValid(result)\n            ? {\n                value: result.value,\n            }\n            : {\n                issues: ctx.common.issues,\n            });\n    }\n    async parseAsync(data, params) {\n        const result = await this.safeParseAsync(data, params);\n        if (result.success)\n            return result.data;\n        throw result.error;\n    }\n    async safeParseAsync(data, params) {\n        const ctx = {\n            common: {\n                issues: [],\n                contextualErrorMap: params?.errorMap,\n                async: true,\n            },\n            path: params?.path || [],\n            schemaErrorMap: this._def.errorMap,\n            parent: null,\n            data,\n            parsedType: getParsedType(data),\n        };\n        const maybeAsyncResult = this._parse({ data, path: ctx.path, parent: ctx });\n        const result = await (isAsync(maybeAsyncResult) ? maybeAsyncResult : Promise.resolve(maybeAsyncResult));\n        return handleResult(ctx, result);\n    }\n    refine(check, message) {\n        const getIssueProperties = (val) => {\n            if (typeof message === \"string\" || typeof message === \"undefined\") {\n                return { message };\n            }\n            else if (typeof message === \"function\") {\n                return message(val);\n            }\n            else {\n                return message;\n            }\n        };\n        return this._refinement((val, ctx) => {\n            const result = check(val);\n            const setError = () => ctx.addIssue({\n                code: ZodIssueCode.custom,\n                ...getIssueProperties(val),\n            });\n            if (typeof Promise !== \"undefined\" && result instanceof Promise) {\n                return result.then((data) => {\n                    if (!data) {\n                        setError();\n                        return false;\n                    }\n                    else {\n                        return true;\n                    }\n                });\n            }\n            if (!result) {\n                setError();\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    refinement(check, refinementData) {\n        return this._refinement((val, ctx) => {\n            if (!check(val)) {\n                ctx.addIssue(typeof refinementData === \"function\" ? refinementData(val, ctx) : refinementData);\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n    }\n    _refinement(refinement) {\n        return new ZodEffects({\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"refinement\", refinement },\n        });\n    }\n    superRefine(refinement) {\n        return this._refinement(refinement);\n    }\n    constructor(def) {\n        /** Alias of safeParseAsync */\n        this.spa = this.safeParseAsync;\n        this._def = def;\n        this.parse = this.parse.bind(this);\n        this.safeParse = this.safeParse.bind(this);\n        this.parseAsync = this.parseAsync.bind(this);\n        this.safeParseAsync = this.safeParseAsync.bind(this);\n        this.spa = this.spa.bind(this);\n        this.refine = this.refine.bind(this);\n        this.refinement = this.refinement.bind(this);\n        this.superRefine = this.superRefine.bind(this);\n        this.optional = this.optional.bind(this);\n        this.nullable = this.nullable.bind(this);\n        this.nullish = this.nullish.bind(this);\n        this.array = this.array.bind(this);\n        this.promise = this.promise.bind(this);\n        this.or = this.or.bind(this);\n        this.and = this.and.bind(this);\n        this.transform = this.transform.bind(this);\n        this.brand = this.brand.bind(this);\n        this.default = this.default.bind(this);\n        this.catch = this.catch.bind(this);\n        this.describe = this.describe.bind(this);\n        this.pipe = this.pipe.bind(this);\n        this.readonly = this.readonly.bind(this);\n        this.isNullable = this.isNullable.bind(this);\n        this.isOptional = this.isOptional.bind(this);\n        this[\"~standard\"] = {\n            version: 1,\n            vendor: \"zod\",\n            validate: (data) => this[\"~validate\"](data),\n        };\n    }\n    optional() {\n        return ZodOptional.create(this, this._def);\n    }\n    nullable() {\n        return ZodNullable.create(this, this._def);\n    }\n    nullish() {\n        return this.nullable().optional();\n    }\n    array() {\n        return ZodArray.create(this);\n    }\n    promise() {\n        return ZodPromise.create(this, this._def);\n    }\n    or(option) {\n        return ZodUnion.create([this, option], this._def);\n    }\n    and(incoming) {\n        return ZodIntersection.create(this, incoming, this._def);\n    }\n    transform(transform) {\n        return new ZodEffects({\n            ...processCreateParams(this._def),\n            schema: this,\n            typeName: ZodFirstPartyTypeKind.ZodEffects,\n            effect: { type: \"transform\", transform },\n        });\n    }\n    default(def) {\n        const defaultValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodDefault({\n            ...processCreateParams(this._def),\n            innerType: this,\n            defaultValue: defaultValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodDefault,\n        });\n    }\n    brand() {\n        return new ZodBranded({\n            typeName: ZodFirstPartyTypeKind.ZodBranded,\n            type: this,\n            ...processCreateParams(this._def),\n        });\n    }\n    catch(def) {\n        const catchValueFunc = typeof def === \"function\" ? def : () => def;\n        return new ZodCatch({\n            ...processCreateParams(this._def),\n            innerType: this,\n            catchValue: catchValueFunc,\n            typeName: ZodFirstPartyTypeKind.ZodCatch,\n        });\n    }\n    describe(description) {\n        const This = this.constructor;\n        return new This({\n            ...this._def,\n            description,\n        });\n    }\n    pipe(target) {\n        return ZodPipeline.create(this, target);\n    }\n    readonly() {\n        return ZodReadonly.create(this);\n    }\n    isOptional() {\n        return this.safeParse(undefined).success;\n    }\n    isNullable() {\n        return this.safeParse(null).success;\n    }\n}\nconst cuidRegex = /^c[^\\s-]{8,}$/i;\nconst cuid2Regex = /^[0-9a-z]+$/;\nconst ulidRegex = /^[0-9A-HJKMNP-TV-Z]{26}$/i;\n// const uuidRegex =\n//   /^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i;\nconst uuidRegex = /^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/i;\nconst nanoidRegex = /^[a-z0-9_-]{21}$/i;\nconst jwtRegex = /^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]*$/;\nconst durationRegex = /^[-+]?P(?!$)(?:(?:[-+]?\\d+Y)|(?:[-+]?\\d+[.,]\\d+Y$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:(?:[-+]?\\d+W)|(?:[-+]?\\d+[.,]\\d+W$))?(?:(?:[-+]?\\d+D)|(?:[-+]?\\d+[.,]\\d+D$))?(?:T(?=[\\d+-])(?:(?:[-+]?\\d+H)|(?:[-+]?\\d+[.,]\\d+H$))?(?:(?:[-+]?\\d+M)|(?:[-+]?\\d+[.,]\\d+M$))?(?:[-+]?\\d+(?:[.,]\\d+)?S)?)??$/;\n// from https://stackoverflow.com/a/46181/1550155\n// old version: too slow, didn't support unicode\n// const emailRegex = /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i;\n//old email regex\n// const emailRegex = /^(([^<>()[\\].,;:\\s@\"]+(\\.[^<>()[\\].,;:\\s@\"]+)*)|(\".+\"))@((?!-)([^<>()[\\].,;:\\s@\"]+\\.)+[^<>()[\\].,;:\\s@\"]{1,})[^-<>()[\\].,;:\\s@\"]$/i;\n// eslint-disable-next-line\n// const emailRegex =\n//   /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\])|(\\[IPv6:(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))\\])|([A-Za-z0-9]([A-Za-z0-9-]*[A-Za-z0-9])*(\\.[A-Za-z]{2,})+))$/;\n// const emailRegex =\n//   /^[a-zA-Z0-9\\.\\!\\#\\$\\%\\&\\'\\*\\+\\/\\=\\?\\^\\_\\`\\{\\|\\}\\~\\-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n// const emailRegex =\n//   /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])$/i;\nconst emailRegex = /^(?!\\.)(?!.*\\.\\.)([A-Z0-9_'+\\-\\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\\-]*\\.)+[A-Z]{2,}$/i;\n// const emailRegex =\n//   /^[a-z0-9.!#$%&*+/=?^_`{|}~-]+@[a-z0-9-]+(?:\\.[a-z0-9\\-]+)*$/i;\n// from https://thekevinscott.com/emojis-in-javascript/#writing-a-regular-expression\nconst _emojiRegex = `^(\\\\p{Extended_Pictographic}|\\\\p{Emoji_Component})+$`;\nlet emojiRegex;\n// faster, simpler, safer\nconst ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/;\nconst ipv4CidrRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\/(3[0-2]|[12]?[0-9])$/;\n// const ipv6Regex =\n// /^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;\nconst ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;\nconst ipv6CidrRegex = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/;\n// https://stackoverflow.com/questions/7860392/determine-if-string-is-in-base64-using-javascript\nconst base64Regex = /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n// https://base64.guru/standards/base64url\nconst base64urlRegex = /^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/;\n// simple\n// const dateRegexSource = `\\\\d{4}-\\\\d{2}-\\\\d{2}`;\n// no leap year validation\n// const dateRegexSource = `\\\\d{4}-((0[13578]|10|12)-31|(0[13-9]|1[0-2])-30|(0[1-9]|1[0-2])-(0[1-9]|1\\\\d|2\\\\d))`;\n// with leap year validation\nconst dateRegexSource = `((\\\\d\\\\d[2468][048]|\\\\d\\\\d[13579][26]|\\\\d\\\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\\\d|30)|(02)-(0[1-9]|1\\\\d|2[0-8])))`;\nconst dateRegex = new RegExp(`^${dateRegexSource}$`);\nfunction timeRegexSource(args) {\n    let secondsRegexSource = `[0-5]\\\\d`;\n    if (args.precision) {\n        secondsRegexSource = `${secondsRegexSource}\\\\.\\\\d{${args.precision}}`;\n    }\n    else if (args.precision == null) {\n        secondsRegexSource = `${secondsRegexSource}(\\\\.\\\\d+)?`;\n    }\n    const secondsQuantifier = args.precision ? \"+\" : \"?\"; // require seconds if precision is nonzero\n    return `([01]\\\\d|2[0-3]):[0-5]\\\\d(:${secondsRegexSource})${secondsQuantifier}`;\n}\nfunction timeRegex(args) {\n    return new RegExp(`^${timeRegexSource(args)}$`);\n}\n// Adapted from https://stackoverflow.com/a/3143231\nexport function datetimeRegex(args) {\n    let regex = `${dateRegexSource}T${timeRegexSource(args)}`;\n    const opts = [];\n    opts.push(args.local ? `Z?` : `Z`);\n    if (args.offset)\n        opts.push(`([+-]\\\\d{2}:?\\\\d{2})`);\n    regex = `${regex}(${opts.join(\"|\")})`;\n    return new RegExp(`^${regex}$`);\n}\nfunction isValidIP(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4Regex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6Regex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nfunction isValidJWT(jwt, alg) {\n    if (!jwtRegex.test(jwt))\n        return false;\n    try {\n        const [header] = jwt.split(\".\");\n        if (!header)\n            return false;\n        // Convert base64url to base64\n        const base64 = header\n            .replace(/-/g, \"+\")\n            .replace(/_/g, \"/\")\n            .padEnd(header.length + ((4 - (header.length % 4)) % 4), \"=\");\n        const decoded = JSON.parse(atob(base64));\n        if (typeof decoded !== \"object\" || decoded === null)\n            return false;\n        if (\"typ\" in decoded && decoded?.typ !== \"JWT\")\n            return false;\n        if (!decoded.alg)\n            return false;\n        if (alg && decoded.alg !== alg)\n            return false;\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\nfunction isValidCidr(ip, version) {\n    if ((version === \"v4\" || !version) && ipv4CidrRegex.test(ip)) {\n        return true;\n    }\n    if ((version === \"v6\" || !version) && ipv6CidrRegex.test(ip)) {\n        return true;\n    }\n    return false;\n}\nexport class ZodString extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = String(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.string) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.string,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.length < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.length > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"string\",\n                        inclusive: true,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"length\") {\n                const tooBig = input.data.length > check.value;\n                const tooSmall = input.data.length < check.value;\n                if (tooBig || tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    if (tooBig) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_big,\n                            maximum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    else if (tooSmall) {\n                        addIssueToContext(ctx, {\n                            code: ZodIssueCode.too_small,\n                            minimum: check.value,\n                            type: \"string\",\n                            inclusive: true,\n                            exact: true,\n                            message: check.message,\n                        });\n                    }\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"email\") {\n                if (!emailRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"email\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"emoji\") {\n                if (!emojiRegex) {\n                    emojiRegex = new RegExp(_emojiRegex, \"u\");\n                }\n                if (!emojiRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"emoji\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"uuid\") {\n                if (!uuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"uuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"nanoid\") {\n                if (!nanoidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"nanoid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid\") {\n                if (!cuidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cuid2\") {\n                if (!cuid2Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cuid2\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ulid\") {\n                if (!ulidRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ulid\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"url\") {\n                try {\n                    new URL(input.data);\n                }\n                catch {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"regex\") {\n                check.regex.lastIndex = 0;\n                const testResult = check.regex.test(input.data);\n                if (!testResult) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"regex\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"trim\") {\n                input.data = input.data.trim();\n            }\n            else if (check.kind === \"includes\") {\n                if (!input.data.includes(check.value, check.position)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { includes: check.value, position: check.position },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"toLowerCase\") {\n                input.data = input.data.toLowerCase();\n            }\n            else if (check.kind === \"toUpperCase\") {\n                input.data = input.data.toUpperCase();\n            }\n            else if (check.kind === \"startsWith\") {\n                if (!input.data.startsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { startsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"endsWith\") {\n                if (!input.data.endsWith(check.value)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: { endsWith: check.value },\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"datetime\") {\n                const regex = datetimeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"datetime\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"date\") {\n                const regex = dateRegex;\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"date\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"time\") {\n                const regex = timeRegex(check);\n                if (!regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_string,\n                        validation: \"time\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"duration\") {\n                if (!durationRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"duration\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"ip\") {\n                if (!isValidIP(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"ip\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"jwt\") {\n                if (!isValidJWT(input.data, check.alg)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"jwt\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"cidr\") {\n                if (!isValidCidr(input.data, check.version)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"cidr\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64\") {\n                if (!base64Regex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"base64url\") {\n                if (!base64urlRegex.test(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        validation: \"base64url\",\n                        code: ZodIssueCode.invalid_string,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _regex(regex, validation, message) {\n        return this.refinement((data) => regex.test(data), {\n            validation,\n            code: ZodIssueCode.invalid_string,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    _addCheck(check) {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    email(message) {\n        return this._addCheck({ kind: \"email\", ...errorUtil.errToObj(message) });\n    }\n    url(message) {\n        return this._addCheck({ kind: \"url\", ...errorUtil.errToObj(message) });\n    }\n    emoji(message) {\n        return this._addCheck({ kind: \"emoji\", ...errorUtil.errToObj(message) });\n    }\n    uuid(message) {\n        return this._addCheck({ kind: \"uuid\", ...errorUtil.errToObj(message) });\n    }\n    nanoid(message) {\n        return this._addCheck({ kind: \"nanoid\", ...errorUtil.errToObj(message) });\n    }\n    cuid(message) {\n        return this._addCheck({ kind: \"cuid\", ...errorUtil.errToObj(message) });\n    }\n    cuid2(message) {\n        return this._addCheck({ kind: \"cuid2\", ...errorUtil.errToObj(message) });\n    }\n    ulid(message) {\n        return this._addCheck({ kind: \"ulid\", ...errorUtil.errToObj(message) });\n    }\n    base64(message) {\n        return this._addCheck({ kind: \"base64\", ...errorUtil.errToObj(message) });\n    }\n    base64url(message) {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return this._addCheck({\n            kind: \"base64url\",\n            ...errorUtil.errToObj(message),\n        });\n    }\n    jwt(options) {\n        return this._addCheck({ kind: \"jwt\", ...errorUtil.errToObj(options) });\n    }\n    ip(options) {\n        return this._addCheck({ kind: \"ip\", ...errorUtil.errToObj(options) });\n    }\n    cidr(options) {\n        return this._addCheck({ kind: \"cidr\", ...errorUtil.errToObj(options) });\n    }\n    datetime(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"datetime\",\n                precision: null,\n                offset: false,\n                local: false,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"datetime\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            offset: options?.offset ?? false,\n            local: options?.local ?? false,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    date(message) {\n        return this._addCheck({ kind: \"date\", message });\n    }\n    time(options) {\n        if (typeof options === \"string\") {\n            return this._addCheck({\n                kind: \"time\",\n                precision: null,\n                message: options,\n            });\n        }\n        return this._addCheck({\n            kind: \"time\",\n            precision: typeof options?.precision === \"undefined\" ? null : options?.precision,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    duration(message) {\n        return this._addCheck({ kind: \"duration\", ...errorUtil.errToObj(message) });\n    }\n    regex(regex, message) {\n        return this._addCheck({\n            kind: \"regex\",\n            regex: regex,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    includes(value, options) {\n        return this._addCheck({\n            kind: \"includes\",\n            value: value,\n            position: options?.position,\n            ...errorUtil.errToObj(options?.message),\n        });\n    }\n    startsWith(value, message) {\n        return this._addCheck({\n            kind: \"startsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    endsWith(value, message) {\n        return this._addCheck({\n            kind: \"endsWith\",\n            value: value,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    min(minLength, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    max(maxLength, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxLength,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    length(len, message) {\n        return this._addCheck({\n            kind: \"length\",\n            value: len,\n            ...errorUtil.errToObj(message),\n        });\n    }\n    /**\n     * Equivalent to `.min(1)`\n     */\n    nonempty(message) {\n        return this.min(1, errorUtil.errToObj(message));\n    }\n    trim() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"trim\" }],\n        });\n    }\n    toLowerCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toLowerCase\" }],\n        });\n    }\n    toUpperCase() {\n        return new ZodString({\n            ...this._def,\n            checks: [...this._def.checks, { kind: \"toUpperCase\" }],\n        });\n    }\n    get isDatetime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"datetime\");\n    }\n    get isDate() {\n        return !!this._def.checks.find((ch) => ch.kind === \"date\");\n    }\n    get isTime() {\n        return !!this._def.checks.find((ch) => ch.kind === \"time\");\n    }\n    get isDuration() {\n        return !!this._def.checks.find((ch) => ch.kind === \"duration\");\n    }\n    get isEmail() {\n        return !!this._def.checks.find((ch) => ch.kind === \"email\");\n    }\n    get isURL() {\n        return !!this._def.checks.find((ch) => ch.kind === \"url\");\n    }\n    get isEmoji() {\n        return !!this._def.checks.find((ch) => ch.kind === \"emoji\");\n    }\n    get isUUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"uuid\");\n    }\n    get isNANOID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"nanoid\");\n    }\n    get isCUID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid\");\n    }\n    get isCUID2() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cuid2\");\n    }\n    get isULID() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ulid\");\n    }\n    get isIP() {\n        return !!this._def.checks.find((ch) => ch.kind === \"ip\");\n    }\n    get isCIDR() {\n        return !!this._def.checks.find((ch) => ch.kind === \"cidr\");\n    }\n    get isBase64() {\n        return !!this._def.checks.find((ch) => ch.kind === \"base64\");\n    }\n    get isBase64url() {\n        // base64url encoding is a modification of base64 that can safely be used in URLs and filenames\n        return !!this._def.checks.find((ch) => ch.kind === \"base64url\");\n    }\n    get minLength() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxLength() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodString.create = (params) => {\n    return new ZodString({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodString,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\n// https://stackoverflow.com/questions/3966484/why-does-modulus-operator-return-fractional-number-in-javascript/31711034#31711034\nfunction floatSafeRemainder(val, step) {\n    const valDecCount = (val.toString().split(\".\")[1] || \"\").length;\n    const stepDecCount = (step.toString().split(\".\")[1] || \"\").length;\n    const decCount = valDecCount > stepDecCount ? valDecCount : stepDecCount;\n    const valInt = Number.parseInt(val.toFixed(decCount).replace(\".\", \"\"));\n    const stepInt = Number.parseInt(step.toFixed(decCount).replace(\".\", \"\"));\n    return (valInt % stepInt) / 10 ** decCount;\n}\nexport class ZodNumber extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n        this.step = this.multipleOf;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Number(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.number) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.number,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"int\") {\n                if (!util.isInteger(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.invalid_type,\n                        expected: \"integer\",\n                        received: \"float\",\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        minimum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        maximum: check.value,\n                        type: \"number\",\n                        inclusive: check.inclusive,\n                        exact: false,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (floatSafeRemainder(input.data, check.value) !== 0) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"finite\") {\n                if (!Number.isFinite(input.data)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_finite,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodNumber({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    int(message) {\n        return this._addCheck({\n            kind: \"int\",\n            message: errorUtil.toString(message),\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: 0,\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value: value,\n            message: errorUtil.toString(message),\n        });\n    }\n    finite(message) {\n        return this._addCheck({\n            kind: \"finite\",\n            message: errorUtil.toString(message),\n        });\n    }\n    safe(message) {\n        return this._addCheck({\n            kind: \"min\",\n            inclusive: true,\n            value: Number.MIN_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        })._addCheck({\n            kind: \"max\",\n            inclusive: true,\n            value: Number.MAX_SAFE_INTEGER,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n    get isInt() {\n        return !!this._def.checks.find((ch) => ch.kind === \"int\" || (ch.kind === \"multipleOf\" && util.isInteger(ch.value)));\n    }\n    get isFinite() {\n        let max = null;\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"finite\" || ch.kind === \"int\" || ch.kind === \"multipleOf\") {\n                return true;\n            }\n            else if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n            else if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return Number.isFinite(min) && Number.isFinite(max);\n    }\n}\nZodNumber.create = (params) => {\n    return new ZodNumber({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodNumber,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBigInt extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.min = this.gte;\n        this.max = this.lte;\n    }\n    _parse(input) {\n        if (this._def.coerce) {\n            try {\n                input.data = BigInt(input.data);\n            }\n            catch {\n                return this._getInvalidInput(input);\n            }\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.bigint) {\n            return this._getInvalidInput(input);\n        }\n        let ctx = undefined;\n        const status = new ParseStatus();\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                const tooSmall = check.inclusive ? input.data < check.value : input.data <= check.value;\n                if (tooSmall) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        type: \"bigint\",\n                        minimum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                const tooBig = check.inclusive ? input.data > check.value : input.data >= check.value;\n                if (tooBig) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        type: \"bigint\",\n                        maximum: check.value,\n                        inclusive: check.inclusive,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"multipleOf\") {\n                if (input.data % check.value !== BigInt(0)) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.not_multiple_of,\n                        multipleOf: check.value,\n                        message: check.message,\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return { status: status.value, value: input.data };\n    }\n    _getInvalidInput(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.bigint,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n    gte(value, message) {\n        return this.setLimit(\"min\", value, true, errorUtil.toString(message));\n    }\n    gt(value, message) {\n        return this.setLimit(\"min\", value, false, errorUtil.toString(message));\n    }\n    lte(value, message) {\n        return this.setLimit(\"max\", value, true, errorUtil.toString(message));\n    }\n    lt(value, message) {\n        return this.setLimit(\"max\", value, false, errorUtil.toString(message));\n    }\n    setLimit(kind, value, inclusive, message) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [\n                ...this._def.checks,\n                {\n                    kind,\n                    value,\n                    inclusive,\n                    message: errorUtil.toString(message),\n                },\n            ],\n        });\n    }\n    _addCheck(check) {\n        return new ZodBigInt({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    positive(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    negative(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: false,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonpositive(message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    nonnegative(message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: BigInt(0),\n            inclusive: true,\n            message: errorUtil.toString(message),\n        });\n    }\n    multipleOf(value, message) {\n        return this._addCheck({\n            kind: \"multipleOf\",\n            value,\n            message: errorUtil.toString(message),\n        });\n    }\n    get minValue() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min;\n    }\n    get maxValue() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max;\n    }\n}\nZodBigInt.create = (params) => {\n    return new ZodBigInt({\n        checks: [],\n        typeName: ZodFirstPartyTypeKind.ZodBigInt,\n        coerce: params?.coerce ?? false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodBoolean extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = Boolean(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.boolean) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.boolean,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodBoolean.create = (params) => {\n    return new ZodBoolean({\n        typeName: ZodFirstPartyTypeKind.ZodBoolean,\n        coerce: params?.coerce || false,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDate extends ZodType {\n    _parse(input) {\n        if (this._def.coerce) {\n            input.data = new Date(input.data);\n        }\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.date) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.date,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (Number.isNaN(input.data.getTime())) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_date,\n            });\n            return INVALID;\n        }\n        const status = new ParseStatus();\n        let ctx = undefined;\n        for (const check of this._def.checks) {\n            if (check.kind === \"min\") {\n                if (input.data.getTime() < check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_small,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        minimum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else if (check.kind === \"max\") {\n                if (input.data.getTime() > check.value) {\n                    ctx = this._getOrReturnCtx(input, ctx);\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.too_big,\n                        message: check.message,\n                        inclusive: true,\n                        exact: false,\n                        maximum: check.value,\n                        type: \"date\",\n                    });\n                    status.dirty();\n                }\n            }\n            else {\n                util.assertNever(check);\n            }\n        }\n        return {\n            status: status.value,\n            value: new Date(input.data.getTime()),\n        };\n    }\n    _addCheck(check) {\n        return new ZodDate({\n            ...this._def,\n            checks: [...this._def.checks, check],\n        });\n    }\n    min(minDate, message) {\n        return this._addCheck({\n            kind: \"min\",\n            value: minDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    max(maxDate, message) {\n        return this._addCheck({\n            kind: \"max\",\n            value: maxDate.getTime(),\n            message: errorUtil.toString(message),\n        });\n    }\n    get minDate() {\n        let min = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"min\") {\n                if (min === null || ch.value > min)\n                    min = ch.value;\n            }\n        }\n        return min != null ? new Date(min) : null;\n    }\n    get maxDate() {\n        let max = null;\n        for (const ch of this._def.checks) {\n            if (ch.kind === \"max\") {\n                if (max === null || ch.value < max)\n                    max = ch.value;\n            }\n        }\n        return max != null ? new Date(max) : null;\n    }\n}\nZodDate.create = (params) => {\n    return new ZodDate({\n        checks: [],\n        coerce: params?.coerce || false,\n        typeName: ZodFirstPartyTypeKind.ZodDate,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSymbol extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.symbol) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.symbol,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodSymbol.create = (params) => {\n    return new ZodSymbol({\n        typeName: ZodFirstPartyTypeKind.ZodSymbol,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUndefined extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.undefined,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodUndefined.create = (params) => {\n    return new ZodUndefined({\n        typeName: ZodFirstPartyTypeKind.ZodUndefined,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNull extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.null) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.null,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodNull.create = (params) => {\n    return new ZodNull({\n        typeName: ZodFirstPartyTypeKind.ZodNull,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodAny extends ZodType {\n    constructor() {\n        super(...arguments);\n        // to prevent instances of other classes from extending ZodAny. this causes issues with catchall in ZodObject.\n        this._any = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodAny.create = (params) => {\n    return new ZodAny({\n        typeName: ZodFirstPartyTypeKind.ZodAny,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnknown extends ZodType {\n    constructor() {\n        super(...arguments);\n        // required\n        this._unknown = true;\n    }\n    _parse(input) {\n        return OK(input.data);\n    }\n}\nZodUnknown.create = (params) => {\n    return new ZodUnknown({\n        typeName: ZodFirstPartyTypeKind.ZodUnknown,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNever extends ZodType {\n    _parse(input) {\n        const ctx = this._getOrReturnCtx(input);\n        addIssueToContext(ctx, {\n            code: ZodIssueCode.invalid_type,\n            expected: ZodParsedType.never,\n            received: ctx.parsedType,\n        });\n        return INVALID;\n    }\n}\nZodNever.create = (params) => {\n    return new ZodNever({\n        typeName: ZodFirstPartyTypeKind.ZodNever,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodVoid extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.undefined) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.void,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n}\nZodVoid.create = (params) => {\n    return new ZodVoid({\n        typeName: ZodFirstPartyTypeKind.ZodVoid,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodArray extends ZodType {\n    _parse(input) {\n        const { ctx, status } = this._processInputParams(input);\n        const def = this._def;\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (def.exactLength !== null) {\n            const tooBig = ctx.data.length > def.exactLength.value;\n            const tooSmall = ctx.data.length < def.exactLength.value;\n            if (tooBig || tooSmall) {\n                addIssueToContext(ctx, {\n                    code: tooBig ? ZodIssueCode.too_big : ZodIssueCode.too_small,\n                    minimum: (tooSmall ? def.exactLength.value : undefined),\n                    maximum: (tooBig ? def.exactLength.value : undefined),\n                    type: \"array\",\n                    inclusive: true,\n                    exact: true,\n                    message: def.exactLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.minLength !== null) {\n            if (ctx.data.length < def.minLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxLength !== null) {\n            if (ctx.data.length > def.maxLength.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxLength.value,\n                    type: \"array\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxLength.message,\n                });\n                status.dirty();\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.all([...ctx.data].map((item, i) => {\n                return def.type._parseAsync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n            })).then((result) => {\n                return ParseStatus.mergeArray(status, result);\n            });\n        }\n        const result = [...ctx.data].map((item, i) => {\n            return def.type._parseSync(new ParseInputLazyPath(ctx, item, ctx.path, i));\n        });\n        return ParseStatus.mergeArray(status, result);\n    }\n    get element() {\n        return this._def.type;\n    }\n    min(minLength, message) {\n        return new ZodArray({\n            ...this._def,\n            minLength: { value: minLength, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxLength, message) {\n        return new ZodArray({\n            ...this._def,\n            maxLength: { value: maxLength, message: errorUtil.toString(message) },\n        });\n    }\n    length(len, message) {\n        return new ZodArray({\n            ...this._def,\n            exactLength: { value: len, message: errorUtil.toString(message) },\n        });\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodArray.create = (schema, params) => {\n    return new ZodArray({\n        type: schema,\n        minLength: null,\n        maxLength: null,\n        exactLength: null,\n        typeName: ZodFirstPartyTypeKind.ZodArray,\n        ...processCreateParams(params),\n    });\n};\nfunction deepPartialify(schema) {\n    if (schema instanceof ZodObject) {\n        const newShape = {};\n        for (const key in schema.shape) {\n            const fieldSchema = schema.shape[key];\n            newShape[key] = ZodOptional.create(deepPartialify(fieldSchema));\n        }\n        return new ZodObject({\n            ...schema._def,\n            shape: () => newShape,\n        });\n    }\n    else if (schema instanceof ZodArray) {\n        return new ZodArray({\n            ...schema._def,\n            type: deepPartialify(schema.element),\n        });\n    }\n    else if (schema instanceof ZodOptional) {\n        return ZodOptional.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodNullable) {\n        return ZodNullable.create(deepPartialify(schema.unwrap()));\n    }\n    else if (schema instanceof ZodTuple) {\n        return ZodTuple.create(schema.items.map((item) => deepPartialify(item)));\n    }\n    else {\n        return schema;\n    }\n}\nexport class ZodObject extends ZodType {\n    constructor() {\n        super(...arguments);\n        this._cached = null;\n        /**\n         * @deprecated In most cases, this is no longer needed - unknown properties are now silently stripped.\n         * If you want to pass through unknown properties, use `.passthrough()` instead.\n         */\n        this.nonstrict = this.passthrough;\n        // extend<\n        //   Augmentation extends ZodRawShape,\n        //   NewOutput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_output\"]\n        //       : k extends keyof Output\n        //       ? Output[k]\n        //       : never;\n        //   }>,\n        //   NewInput extends util.flatten<{\n        //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n        //       ? Augmentation[k][\"_input\"]\n        //       : k extends keyof Input\n        //       ? Input[k]\n        //       : never;\n        //   }>\n        // >(\n        //   augmentation: Augmentation\n        // ): ZodObject<\n        //   extendShape<T, Augmentation>,\n        //   UnknownKeys,\n        //   Catchall,\n        //   NewOutput,\n        //   NewInput\n        // > {\n        //   return new ZodObject({\n        //     ...this._def,\n        //     shape: () => ({\n        //       ...this._def.shape(),\n        //       ...augmentation,\n        //     }),\n        //   }) as any;\n        // }\n        /**\n         * @deprecated Use `.extend` instead\n         *  */\n        this.augment = this.extend;\n    }\n    _getCached() {\n        if (this._cached !== null)\n            return this._cached;\n        const shape = this._def.shape();\n        const keys = util.objectKeys(shape);\n        this._cached = { shape, keys };\n        return this._cached;\n    }\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.object) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const { status, ctx } = this._processInputParams(input);\n        const { shape, keys: shapeKeys } = this._getCached();\n        const extraKeys = [];\n        if (!(this._def.catchall instanceof ZodNever && this._def.unknownKeys === \"strip\")) {\n            for (const key in ctx.data) {\n                if (!shapeKeys.includes(key)) {\n                    extraKeys.push(key);\n                }\n            }\n        }\n        const pairs = [];\n        for (const key of shapeKeys) {\n            const keyValidator = shape[key];\n            const value = ctx.data[key];\n            pairs.push({\n                key: { status: \"valid\", value: key },\n                value: keyValidator._parse(new ParseInputLazyPath(ctx, value, ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (this._def.catchall instanceof ZodNever) {\n            const unknownKeys = this._def.unknownKeys;\n            if (unknownKeys === \"passthrough\") {\n                for (const key of extraKeys) {\n                    pairs.push({\n                        key: { status: \"valid\", value: key },\n                        value: { status: \"valid\", value: ctx.data[key] },\n                    });\n                }\n            }\n            else if (unknownKeys === \"strict\") {\n                if (extraKeys.length > 0) {\n                    addIssueToContext(ctx, {\n                        code: ZodIssueCode.unrecognized_keys,\n                        keys: extraKeys,\n                    });\n                    status.dirty();\n                }\n            }\n            else if (unknownKeys === \"strip\") {\n            }\n            else {\n                throw new Error(`Internal ZodObject error: invalid unknownKeys value.`);\n            }\n        }\n        else {\n            // run catchall validation\n            const catchall = this._def.catchall;\n            for (const key of extraKeys) {\n                const value = ctx.data[key];\n                pairs.push({\n                    key: { status: \"valid\", value: key },\n                    value: catchall._parse(new ParseInputLazyPath(ctx, value, ctx.path, key) //, ctx.child(key), value, getParsedType(value)\n                    ),\n                    alwaysSet: key in ctx.data,\n                });\n            }\n        }\n        if (ctx.common.async) {\n            return Promise.resolve()\n                .then(async () => {\n                const syncPairs = [];\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    syncPairs.push({\n                        key,\n                        value,\n                        alwaysSet: pair.alwaysSet,\n                    });\n                }\n                return syncPairs;\n            })\n                .then((syncPairs) => {\n                return ParseStatus.mergeObjectSync(status, syncPairs);\n            });\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get shape() {\n        return this._def.shape();\n    }\n    strict(message) {\n        errorUtil.errToObj;\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strict\",\n            ...(message !== undefined\n                ? {\n                    errorMap: (issue, ctx) => {\n                        const defaultError = this._def.errorMap?.(issue, ctx).message ?? ctx.defaultError;\n                        if (issue.code === \"unrecognized_keys\")\n                            return {\n                                message: errorUtil.errToObj(message).message ?? defaultError,\n                            };\n                        return {\n                            message: defaultError,\n                        };\n                    },\n                }\n                : {}),\n        });\n    }\n    strip() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"strip\",\n        });\n    }\n    passthrough() {\n        return new ZodObject({\n            ...this._def,\n            unknownKeys: \"passthrough\",\n        });\n    }\n    // const AugmentFactory =\n    //   <Def extends ZodObjectDef>(def: Def) =>\n    //   <Augmentation extends ZodRawShape>(\n    //     augmentation: Augmentation\n    //   ): ZodObject<\n    //     extendShape<ReturnType<Def[\"shape\"]>, Augmentation>,\n    //     Def[\"unknownKeys\"],\n    //     Def[\"catchall\"]\n    //   > => {\n    //     return new ZodObject({\n    //       ...def,\n    //       shape: () => ({\n    //         ...def.shape(),\n    //         ...augmentation,\n    //       }),\n    //     }) as any;\n    //   };\n    extend(augmentation) {\n        return new ZodObject({\n            ...this._def,\n            shape: () => ({\n                ...this._def.shape(),\n                ...augmentation,\n            }),\n        });\n    }\n    /**\n     * Prior to zod@1.0.12 there was a bug in the\n     * inferred type of merged objects. Please\n     * upgrade if you are experiencing issues.\n     */\n    merge(merging) {\n        const merged = new ZodObject({\n            unknownKeys: merging._def.unknownKeys,\n            catchall: merging._def.catchall,\n            shape: () => ({\n                ...this._def.shape(),\n                ...merging._def.shape(),\n            }),\n            typeName: ZodFirstPartyTypeKind.ZodObject,\n        });\n        return merged;\n    }\n    // merge<\n    //   Incoming extends AnyZodObject,\n    //   Augmentation extends Incoming[\"shape\"],\n    //   NewOutput extends {\n    //     [k in keyof Augmentation | keyof Output]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_output\"]\n    //       : k extends keyof Output\n    //       ? Output[k]\n    //       : never;\n    //   },\n    //   NewInput extends {\n    //     [k in keyof Augmentation | keyof Input]: k extends keyof Augmentation\n    //       ? Augmentation[k][\"_input\"]\n    //       : k extends keyof Input\n    //       ? Input[k]\n    //       : never;\n    //   }\n    // >(\n    //   merging: Incoming\n    // ): ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"],\n    //   NewOutput,\n    //   NewInput\n    // > {\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    setKey(key, schema) {\n        return this.augment({ [key]: schema });\n    }\n    // merge<Incoming extends AnyZodObject>(\n    //   merging: Incoming\n    // ): //ZodObject<T & Incoming[\"_shape\"], UnknownKeys, Catchall> = (merging) => {\n    // ZodObject<\n    //   extendShape<T, ReturnType<Incoming[\"_def\"][\"shape\"]>>,\n    //   Incoming[\"_def\"][\"unknownKeys\"],\n    //   Incoming[\"_def\"][\"catchall\"]\n    // > {\n    //   // const mergedShape = objectUtil.mergeShapes(\n    //   //   this._def.shape(),\n    //   //   merging._def.shape()\n    //   // );\n    //   const merged: any = new ZodObject({\n    //     unknownKeys: merging._def.unknownKeys,\n    //     catchall: merging._def.catchall,\n    //     shape: () =>\n    //       objectUtil.mergeShapes(this._def.shape(), merging._def.shape()),\n    //     typeName: ZodFirstPartyTypeKind.ZodObject,\n    //   }) as any;\n    //   return merged;\n    // }\n    catchall(index) {\n        return new ZodObject({\n            ...this._def,\n            catchall: index,\n        });\n    }\n    pick(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(mask)) {\n            if (mask[key] && this.shape[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    omit(mask) {\n        const shape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (!mask[key]) {\n                shape[key] = this.shape[key];\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => shape,\n        });\n    }\n    /**\n     * @deprecated\n     */\n    deepPartial() {\n        return deepPartialify(this);\n    }\n    partial(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            const fieldSchema = this.shape[key];\n            if (mask && !mask[key]) {\n                newShape[key] = fieldSchema;\n            }\n            else {\n                newShape[key] = fieldSchema.optional();\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    required(mask) {\n        const newShape = {};\n        for (const key of util.objectKeys(this.shape)) {\n            if (mask && !mask[key]) {\n                newShape[key] = this.shape[key];\n            }\n            else {\n                const fieldSchema = this.shape[key];\n                let newField = fieldSchema;\n                while (newField instanceof ZodOptional) {\n                    newField = newField._def.innerType;\n                }\n                newShape[key] = newField;\n            }\n        }\n        return new ZodObject({\n            ...this._def,\n            shape: () => newShape,\n        });\n    }\n    keyof() {\n        return createZodEnum(util.objectKeys(this.shape));\n    }\n}\nZodObject.create = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.strictCreate = (shape, params) => {\n    return new ZodObject({\n        shape: () => shape,\n        unknownKeys: \"strict\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nZodObject.lazycreate = (shape, params) => {\n    return new ZodObject({\n        shape,\n        unknownKeys: \"strip\",\n        catchall: ZodNever.create(),\n        typeName: ZodFirstPartyTypeKind.ZodObject,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const options = this._def.options;\n        function handleResults(results) {\n            // return first issue-free validation if it exists\n            for (const result of results) {\n                if (result.result.status === \"valid\") {\n                    return result.result;\n                }\n            }\n            for (const result of results) {\n                if (result.result.status === \"dirty\") {\n                    // add issues from dirty option\n                    ctx.common.issues.push(...result.ctx.common.issues);\n                    return result.result;\n                }\n            }\n            // return invalid\n            const unionErrors = results.map((result) => new ZodError(result.ctx.common.issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return Promise.all(options.map(async (option) => {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                return {\n                    result: await option._parseAsync({\n                        data: ctx.data,\n                        path: ctx.path,\n                        parent: childCtx,\n                    }),\n                    ctx: childCtx,\n                };\n            })).then(handleResults);\n        }\n        else {\n            let dirty = undefined;\n            const issues = [];\n            for (const option of options) {\n                const childCtx = {\n                    ...ctx,\n                    common: {\n                        ...ctx.common,\n                        issues: [],\n                    },\n                    parent: null,\n                };\n                const result = option._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: childCtx,\n                });\n                if (result.status === \"valid\") {\n                    return result;\n                }\n                else if (result.status === \"dirty\" && !dirty) {\n                    dirty = { result, ctx: childCtx };\n                }\n                if (childCtx.common.issues.length) {\n                    issues.push(childCtx.common.issues);\n                }\n            }\n            if (dirty) {\n                ctx.common.issues.push(...dirty.ctx.common.issues);\n                return dirty.result;\n            }\n            const unionErrors = issues.map((issues) => new ZodError(issues));\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union,\n                unionErrors,\n            });\n            return INVALID;\n        }\n    }\n    get options() {\n        return this._def.options;\n    }\n}\nZodUnion.create = (types, params) => {\n    return new ZodUnion({\n        options: types,\n        typeName: ZodFirstPartyTypeKind.ZodUnion,\n        ...processCreateParams(params),\n    });\n};\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\n//////////                                 //////////\n//////////      ZodDiscriminatedUnion      //////////\n//////////                                 //////////\n/////////////////////////////////////////////////////\n/////////////////////////////////////////////////////\nconst getDiscriminator = (type) => {\n    if (type instanceof ZodLazy) {\n        return getDiscriminator(type.schema);\n    }\n    else if (type instanceof ZodEffects) {\n        return getDiscriminator(type.innerType());\n    }\n    else if (type instanceof ZodLiteral) {\n        return [type.value];\n    }\n    else if (type instanceof ZodEnum) {\n        return type.options;\n    }\n    else if (type instanceof ZodNativeEnum) {\n        // eslint-disable-next-line ban/ban\n        return util.objectValues(type.enum);\n    }\n    else if (type instanceof ZodDefault) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else if (type instanceof ZodUndefined) {\n        return [undefined];\n    }\n    else if (type instanceof ZodNull) {\n        return [null];\n    }\n    else if (type instanceof ZodOptional) {\n        return [undefined, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodNullable) {\n        return [null, ...getDiscriminator(type.unwrap())];\n    }\n    else if (type instanceof ZodBranded) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodReadonly) {\n        return getDiscriminator(type.unwrap());\n    }\n    else if (type instanceof ZodCatch) {\n        return getDiscriminator(type._def.innerType);\n    }\n    else {\n        return [];\n    }\n};\nexport class ZodDiscriminatedUnion extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const discriminator = this.discriminator;\n        const discriminatorValue = ctx.data[discriminator];\n        const option = this.optionsMap.get(discriminatorValue);\n        if (!option) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_union_discriminator,\n                options: Array.from(this.optionsMap.keys()),\n                path: [discriminator],\n            });\n            return INVALID;\n        }\n        if (ctx.common.async) {\n            return option._parseAsync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n        else {\n            return option._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n        }\n    }\n    get discriminator() {\n        return this._def.discriminator;\n    }\n    get options() {\n        return this._def.options;\n    }\n    get optionsMap() {\n        return this._def.optionsMap;\n    }\n    /**\n     * The constructor of the discriminated union schema. Its behaviour is very similar to that of the normal z.union() constructor.\n     * However, it only allows a union of objects, all of which need to share a discriminator property. This property must\n     * have a different value for each object in the union.\n     * @param discriminator the name of the discriminator property\n     * @param types an array of object schemas\n     * @param params\n     */\n    static create(discriminator, options, params) {\n        // Get all the valid discriminator values\n        const optionsMap = new Map();\n        // try {\n        for (const type of options) {\n            const discriminatorValues = getDiscriminator(type.shape[discriminator]);\n            if (!discriminatorValues.length) {\n                throw new Error(`A discriminator value for key \\`${discriminator}\\` could not be extracted from all schema options`);\n            }\n            for (const value of discriminatorValues) {\n                if (optionsMap.has(value)) {\n                    throw new Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);\n                }\n                optionsMap.set(value, type);\n            }\n        }\n        return new ZodDiscriminatedUnion({\n            typeName: ZodFirstPartyTypeKind.ZodDiscriminatedUnion,\n            discriminator,\n            options,\n            optionsMap,\n            ...processCreateParams(params),\n        });\n    }\n}\nfunction mergeValues(a, b) {\n    const aType = getParsedType(a);\n    const bType = getParsedType(b);\n    if (a === b) {\n        return { valid: true, data: a };\n    }\n    else if (aType === ZodParsedType.object && bType === ZodParsedType.object) {\n        const bKeys = util.objectKeys(b);\n        const sharedKeys = util.objectKeys(a).filter((key) => bKeys.indexOf(key) !== -1);\n        const newObj = { ...a, ...b };\n        for (const key of sharedKeys) {\n            const sharedValue = mergeValues(a[key], b[key]);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newObj[key] = sharedValue.data;\n        }\n        return { valid: true, data: newObj };\n    }\n    else if (aType === ZodParsedType.array && bType === ZodParsedType.array) {\n        if (a.length !== b.length) {\n            return { valid: false };\n        }\n        const newArray = [];\n        for (let index = 0; index < a.length; index++) {\n            const itemA = a[index];\n            const itemB = b[index];\n            const sharedValue = mergeValues(itemA, itemB);\n            if (!sharedValue.valid) {\n                return { valid: false };\n            }\n            newArray.push(sharedValue.data);\n        }\n        return { valid: true, data: newArray };\n    }\n    else if (aType === ZodParsedType.date && bType === ZodParsedType.date && +a === +b) {\n        return { valid: true, data: a };\n    }\n    else {\n        return { valid: false };\n    }\n}\nexport class ZodIntersection extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const handleParsed = (parsedLeft, parsedRight) => {\n            if (isAborted(parsedLeft) || isAborted(parsedRight)) {\n                return INVALID;\n            }\n            const merged = mergeValues(parsedLeft.value, parsedRight.value);\n            if (!merged.valid) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.invalid_intersection_types,\n                });\n                return INVALID;\n            }\n            if (isDirty(parsedLeft) || isDirty(parsedRight)) {\n                status.dirty();\n            }\n            return { status: status.value, value: merged.data };\n        };\n        if (ctx.common.async) {\n            return Promise.all([\n                this._def.left._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n                this._def.right._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                }),\n            ]).then(([left, right]) => handleParsed(left, right));\n        }\n        else {\n            return handleParsed(this._def.left._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }), this._def.right._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            }));\n        }\n    }\n}\nZodIntersection.create = (left, right, params) => {\n    return new ZodIntersection({\n        left: left,\n        right: right,\n        typeName: ZodFirstPartyTypeKind.ZodIntersection,\n        ...processCreateParams(params),\n    });\n};\n// type ZodTupleItems = [ZodTypeAny, ...ZodTypeAny[]];\nexport class ZodTuple extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.array) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.array,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        if (ctx.data.length < this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_small,\n                minimum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            return INVALID;\n        }\n        const rest = this._def.rest;\n        if (!rest && ctx.data.length > this._def.items.length) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.too_big,\n                maximum: this._def.items.length,\n                inclusive: true,\n                exact: false,\n                type: \"array\",\n            });\n            status.dirty();\n        }\n        const items = [...ctx.data]\n            .map((item, itemIndex) => {\n            const schema = this._def.items[itemIndex] || this._def.rest;\n            if (!schema)\n                return null;\n            return schema._parse(new ParseInputLazyPath(ctx, item, ctx.path, itemIndex));\n        })\n            .filter((x) => !!x); // filter nulls\n        if (ctx.common.async) {\n            return Promise.all(items).then((results) => {\n                return ParseStatus.mergeArray(status, results);\n            });\n        }\n        else {\n            return ParseStatus.mergeArray(status, items);\n        }\n    }\n    get items() {\n        return this._def.items;\n    }\n    rest(rest) {\n        return new ZodTuple({\n            ...this._def,\n            rest,\n        });\n    }\n}\nZodTuple.create = (schemas, params) => {\n    if (!Array.isArray(schemas)) {\n        throw new Error(\"You must pass an array of schemas to z.tuple([ ... ])\");\n    }\n    return new ZodTuple({\n        items: schemas,\n        typeName: ZodFirstPartyTypeKind.ZodTuple,\n        rest: null,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodRecord extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.object) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.object,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const pairs = [];\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        for (const key in ctx.data) {\n            pairs.push({\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, key)),\n                value: valueType._parse(new ParseInputLazyPath(ctx, ctx.data[key], ctx.path, key)),\n                alwaysSet: key in ctx.data,\n            });\n        }\n        if (ctx.common.async) {\n            return ParseStatus.mergeObjectAsync(status, pairs);\n        }\n        else {\n            return ParseStatus.mergeObjectSync(status, pairs);\n        }\n    }\n    get element() {\n        return this._def.valueType;\n    }\n    static create(first, second, third) {\n        if (second instanceof ZodType) {\n            return new ZodRecord({\n                keyType: first,\n                valueType: second,\n                typeName: ZodFirstPartyTypeKind.ZodRecord,\n                ...processCreateParams(third),\n            });\n        }\n        return new ZodRecord({\n            keyType: ZodString.create(),\n            valueType: first,\n            typeName: ZodFirstPartyTypeKind.ZodRecord,\n            ...processCreateParams(second),\n        });\n    }\n}\nexport class ZodMap extends ZodType {\n    get keySchema() {\n        return this._def.keyType;\n    }\n    get valueSchema() {\n        return this._def.valueType;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.map) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.map,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const keyType = this._def.keyType;\n        const valueType = this._def.valueType;\n        const pairs = [...ctx.data.entries()].map(([key, value], index) => {\n            return {\n                key: keyType._parse(new ParseInputLazyPath(ctx, key, ctx.path, [index, \"key\"])),\n                value: valueType._parse(new ParseInputLazyPath(ctx, value, ctx.path, [index, \"value\"])),\n            };\n        });\n        if (ctx.common.async) {\n            const finalMap = new Map();\n            return Promise.resolve().then(async () => {\n                for (const pair of pairs) {\n                    const key = await pair.key;\n                    const value = await pair.value;\n                    if (key.status === \"aborted\" || value.status === \"aborted\") {\n                        return INVALID;\n                    }\n                    if (key.status === \"dirty\" || value.status === \"dirty\") {\n                        status.dirty();\n                    }\n                    finalMap.set(key.value, value.value);\n                }\n                return { status: status.value, value: finalMap };\n            });\n        }\n        else {\n            const finalMap = new Map();\n            for (const pair of pairs) {\n                const key = pair.key;\n                const value = pair.value;\n                if (key.status === \"aborted\" || value.status === \"aborted\") {\n                    return INVALID;\n                }\n                if (key.status === \"dirty\" || value.status === \"dirty\") {\n                    status.dirty();\n                }\n                finalMap.set(key.value, value.value);\n            }\n            return { status: status.value, value: finalMap };\n        }\n    }\n}\nZodMap.create = (keyType, valueType, params) => {\n    return new ZodMap({\n        valueType,\n        keyType,\n        typeName: ZodFirstPartyTypeKind.ZodMap,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodSet extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.set) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.set,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const def = this._def;\n        if (def.minSize !== null) {\n            if (ctx.data.size < def.minSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_small,\n                    minimum: def.minSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.minSize.message,\n                });\n                status.dirty();\n            }\n        }\n        if (def.maxSize !== null) {\n            if (ctx.data.size > def.maxSize.value) {\n                addIssueToContext(ctx, {\n                    code: ZodIssueCode.too_big,\n                    maximum: def.maxSize.value,\n                    type: \"set\",\n                    inclusive: true,\n                    exact: false,\n                    message: def.maxSize.message,\n                });\n                status.dirty();\n            }\n        }\n        const valueType = this._def.valueType;\n        function finalizeSet(elements) {\n            const parsedSet = new Set();\n            for (const element of elements) {\n                if (element.status === \"aborted\")\n                    return INVALID;\n                if (element.status === \"dirty\")\n                    status.dirty();\n                parsedSet.add(element.value);\n            }\n            return { status: status.value, value: parsedSet };\n        }\n        const elements = [...ctx.data.values()].map((item, i) => valueType._parse(new ParseInputLazyPath(ctx, item, ctx.path, i)));\n        if (ctx.common.async) {\n            return Promise.all(elements).then((elements) => finalizeSet(elements));\n        }\n        else {\n            return finalizeSet(elements);\n        }\n    }\n    min(minSize, message) {\n        return new ZodSet({\n            ...this._def,\n            minSize: { value: minSize, message: errorUtil.toString(message) },\n        });\n    }\n    max(maxSize, message) {\n        return new ZodSet({\n            ...this._def,\n            maxSize: { value: maxSize, message: errorUtil.toString(message) },\n        });\n    }\n    size(size, message) {\n        return this.min(size, message).max(size, message);\n    }\n    nonempty(message) {\n        return this.min(1, message);\n    }\n}\nZodSet.create = (valueType, params) => {\n    return new ZodSet({\n        valueType,\n        minSize: null,\n        maxSize: null,\n        typeName: ZodFirstPartyTypeKind.ZodSet,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodFunction extends ZodType {\n    constructor() {\n        super(...arguments);\n        this.validate = this.implement;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.function) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.function,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        function makeArgsIssue(args, error) {\n            return makeIssue({\n                data: args,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_arguments,\n                    argumentsError: error,\n                },\n            });\n        }\n        function makeReturnsIssue(returns, error) {\n            return makeIssue({\n                data: returns,\n                path: ctx.path,\n                errorMaps: [ctx.common.contextualErrorMap, ctx.schemaErrorMap, getErrorMap(), defaultErrorMap].filter((x) => !!x),\n                issueData: {\n                    code: ZodIssueCode.invalid_return_type,\n                    returnTypeError: error,\n                },\n            });\n        }\n        const params = { errorMap: ctx.common.contextualErrorMap };\n        const fn = ctx.data;\n        if (this._def.returns instanceof ZodPromise) {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(async function (...args) {\n                const error = new ZodError([]);\n                const parsedArgs = await me._def.args.parseAsync(args, params).catch((e) => {\n                    error.addIssue(makeArgsIssue(args, e));\n                    throw error;\n                });\n                const result = await Reflect.apply(fn, this, parsedArgs);\n                const parsedReturns = await me._def.returns._def.type\n                    .parseAsync(result, params)\n                    .catch((e) => {\n                    error.addIssue(makeReturnsIssue(result, e));\n                    throw error;\n                });\n                return parsedReturns;\n            });\n        }\n        else {\n            // Would love a way to avoid disabling this rule, but we need\n            // an alias (using an arrow function was what caused 2651).\n            // eslint-disable-next-line @typescript-eslint/no-this-alias\n            const me = this;\n            return OK(function (...args) {\n                const parsedArgs = me._def.args.safeParse(args, params);\n                if (!parsedArgs.success) {\n                    throw new ZodError([makeArgsIssue(args, parsedArgs.error)]);\n                }\n                const result = Reflect.apply(fn, this, parsedArgs.data);\n                const parsedReturns = me._def.returns.safeParse(result, params);\n                if (!parsedReturns.success) {\n                    throw new ZodError([makeReturnsIssue(result, parsedReturns.error)]);\n                }\n                return parsedReturns.data;\n            });\n        }\n    }\n    parameters() {\n        return this._def.args;\n    }\n    returnType() {\n        return this._def.returns;\n    }\n    args(...items) {\n        return new ZodFunction({\n            ...this._def,\n            args: ZodTuple.create(items).rest(ZodUnknown.create()),\n        });\n    }\n    returns(returnType) {\n        return new ZodFunction({\n            ...this._def,\n            returns: returnType,\n        });\n    }\n    implement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    strictImplement(func) {\n        const validatedFunc = this.parse(func);\n        return validatedFunc;\n    }\n    static create(args, returns, params) {\n        return new ZodFunction({\n            args: (args ? args : ZodTuple.create([]).rest(ZodUnknown.create())),\n            returns: returns || ZodUnknown.create(),\n            typeName: ZodFirstPartyTypeKind.ZodFunction,\n            ...processCreateParams(params),\n        });\n    }\n}\nexport class ZodLazy extends ZodType {\n    get schema() {\n        return this._def.getter();\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const lazySchema = this._def.getter();\n        return lazySchema._parse({ data: ctx.data, path: ctx.path, parent: ctx });\n    }\n}\nZodLazy.create = (getter, params) => {\n    return new ZodLazy({\n        getter: getter,\n        typeName: ZodFirstPartyTypeKind.ZodLazy,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodLiteral extends ZodType {\n    _parse(input) {\n        if (input.data !== this._def.value) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_literal,\n                expected: this._def.value,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n    get value() {\n        return this._def.value;\n    }\n}\nZodLiteral.create = (value, params) => {\n    return new ZodLiteral({\n        value: value,\n        typeName: ZodFirstPartyTypeKind.ZodLiteral,\n        ...processCreateParams(params),\n    });\n};\nfunction createZodEnum(values, params) {\n    return new ZodEnum({\n        values,\n        typeName: ZodFirstPartyTypeKind.ZodEnum,\n        ...processCreateParams(params),\n    });\n}\nexport class ZodEnum extends ZodType {\n    _parse(input) {\n        if (typeof input.data !== \"string\") {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(this._def.values);\n        }\n        if (!this._cache.has(input.data)) {\n            const ctx = this._getOrReturnCtx(input);\n            const expectedValues = this._def.values;\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get options() {\n        return this._def.values;\n    }\n    get enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Values() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    get Enum() {\n        const enumValues = {};\n        for (const val of this._def.values) {\n            enumValues[val] = val;\n        }\n        return enumValues;\n    }\n    extract(values, newDef = this._def) {\n        return ZodEnum.create(values, {\n            ...this._def,\n            ...newDef,\n        });\n    }\n    exclude(values, newDef = this._def) {\n        return ZodEnum.create(this.options.filter((opt) => !values.includes(opt)), {\n            ...this._def,\n            ...newDef,\n        });\n    }\n}\nZodEnum.create = createZodEnum;\nexport class ZodNativeEnum extends ZodType {\n    _parse(input) {\n        const nativeEnumValues = util.getValidEnumValues(this._def.values);\n        const ctx = this._getOrReturnCtx(input);\n        if (ctx.parsedType !== ZodParsedType.string && ctx.parsedType !== ZodParsedType.number) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                expected: util.joinValues(expectedValues),\n                received: ctx.parsedType,\n                code: ZodIssueCode.invalid_type,\n            });\n            return INVALID;\n        }\n        if (!this._cache) {\n            this._cache = new Set(util.getValidEnumValues(this._def.values));\n        }\n        if (!this._cache.has(input.data)) {\n            const expectedValues = util.objectValues(nativeEnumValues);\n            addIssueToContext(ctx, {\n                received: ctx.data,\n                code: ZodIssueCode.invalid_enum_value,\n                options: expectedValues,\n            });\n            return INVALID;\n        }\n        return OK(input.data);\n    }\n    get enum() {\n        return this._def.values;\n    }\n}\nZodNativeEnum.create = (values, params) => {\n    return new ZodNativeEnum({\n        values: values,\n        typeName: ZodFirstPartyTypeKind.ZodNativeEnum,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodPromise extends ZodType {\n    unwrap() {\n        return this._def.type;\n    }\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        if (ctx.parsedType !== ZodParsedType.promise && ctx.common.async === false) {\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.promise,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        const promisified = ctx.parsedType === ZodParsedType.promise ? ctx.data : Promise.resolve(ctx.data);\n        return OK(promisified.then((data) => {\n            return this._def.type.parseAsync(data, {\n                path: ctx.path,\n                errorMap: ctx.common.contextualErrorMap,\n            });\n        }));\n    }\n}\nZodPromise.create = (schema, params) => {\n    return new ZodPromise({\n        type: schema,\n        typeName: ZodFirstPartyTypeKind.ZodPromise,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodEffects extends ZodType {\n    innerType() {\n        return this._def.schema;\n    }\n    sourceType() {\n        return this._def.schema._def.typeName === ZodFirstPartyTypeKind.ZodEffects\n            ? this._def.schema.sourceType()\n            : this._def.schema;\n    }\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        const effect = this._def.effect || null;\n        const checkCtx = {\n            addIssue: (arg) => {\n                addIssueToContext(ctx, arg);\n                if (arg.fatal) {\n                    status.abort();\n                }\n                else {\n                    status.dirty();\n                }\n            },\n            get path() {\n                return ctx.path;\n            },\n        };\n        checkCtx.addIssue = checkCtx.addIssue.bind(checkCtx);\n        if (effect.type === \"preprocess\") {\n            const processed = effect.transform(ctx.data, checkCtx);\n            if (ctx.common.async) {\n                return Promise.resolve(processed).then(async (processed) => {\n                    if (status.value === \"aborted\")\n                        return INVALID;\n                    const result = await this._def.schema._parseAsync({\n                        data: processed,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                    if (result.status === \"aborted\")\n                        return INVALID;\n                    if (result.status === \"dirty\")\n                        return DIRTY(result.value);\n                    if (status.value === \"dirty\")\n                        return DIRTY(result.value);\n                    return result;\n                });\n            }\n            else {\n                if (status.value === \"aborted\")\n                    return INVALID;\n                const result = this._def.schema._parseSync({\n                    data: processed,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (result.status === \"aborted\")\n                    return INVALID;\n                if (result.status === \"dirty\")\n                    return DIRTY(result.value);\n                if (status.value === \"dirty\")\n                    return DIRTY(result.value);\n                return result;\n            }\n        }\n        if (effect.type === \"refinement\") {\n            const executeRefinement = (acc) => {\n                const result = effect.refinement(acc, checkCtx);\n                if (ctx.common.async) {\n                    return Promise.resolve(result);\n                }\n                if (result instanceof Promise) {\n                    throw new Error(\"Async refinement encountered during synchronous parse operation. Use .parseAsync instead.\");\n                }\n                return acc;\n            };\n            if (ctx.common.async === false) {\n                const inner = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inner.status === \"aborted\")\n                    return INVALID;\n                if (inner.status === \"dirty\")\n                    status.dirty();\n                // return value is ignored\n                executeRefinement(inner.value);\n                return { status: status.value, value: inner.value };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((inner) => {\n                    if (inner.status === \"aborted\")\n                        return INVALID;\n                    if (inner.status === \"dirty\")\n                        status.dirty();\n                    return executeRefinement(inner.value).then(() => {\n                        return { status: status.value, value: inner.value };\n                    });\n                });\n            }\n        }\n        if (effect.type === \"transform\") {\n            if (ctx.common.async === false) {\n                const base = this._def.schema._parseSync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (!isValid(base))\n                    return INVALID;\n                const result = effect.transform(base.value, checkCtx);\n                if (result instanceof Promise) {\n                    throw new Error(`Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.`);\n                }\n                return { status: status.value, value: result };\n            }\n            else {\n                return this._def.schema._parseAsync({ data: ctx.data, path: ctx.path, parent: ctx }).then((base) => {\n                    if (!isValid(base))\n                        return INVALID;\n                    return Promise.resolve(effect.transform(base.value, checkCtx)).then((result) => ({\n                        status: status.value,\n                        value: result,\n                    }));\n                });\n            }\n        }\n        util.assertNever(effect);\n    }\n}\nZodEffects.create = (schema, effect, params) => {\n    return new ZodEffects({\n        schema,\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        effect,\n        ...processCreateParams(params),\n    });\n};\nZodEffects.createWithPreprocess = (preprocess, schema, params) => {\n    return new ZodEffects({\n        schema,\n        effect: { type: \"preprocess\", transform: preprocess },\n        typeName: ZodFirstPartyTypeKind.ZodEffects,\n        ...processCreateParams(params),\n    });\n};\nexport { ZodEffects as ZodTransformer };\nexport class ZodOptional extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.undefined) {\n            return OK(undefined);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodOptional.create = (type, params) => {\n    return new ZodOptional({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodOptional,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNullable extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType === ZodParsedType.null) {\n            return OK(null);\n        }\n        return this._def.innerType._parse(input);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodNullable.create = (type, params) => {\n    return new ZodNullable({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodNullable,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodDefault extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        let data = ctx.data;\n        if (ctx.parsedType === ZodParsedType.undefined) {\n            data = this._def.defaultValue();\n        }\n        return this._def.innerType._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    removeDefault() {\n        return this._def.innerType;\n    }\n}\nZodDefault.create = (type, params) => {\n    return new ZodDefault({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodDefault,\n        defaultValue: typeof params.default === \"function\" ? params.default : () => params.default,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodCatch extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        // newCtx is used to not collect issues from inner types in ctx\n        const newCtx = {\n            ...ctx,\n            common: {\n                ...ctx.common,\n                issues: [],\n            },\n        };\n        const result = this._def.innerType._parse({\n            data: newCtx.data,\n            path: newCtx.path,\n            parent: {\n                ...newCtx,\n            },\n        });\n        if (isAsync(result)) {\n            return result.then((result) => {\n                return {\n                    status: \"valid\",\n                    value: result.status === \"valid\"\n                        ? result.value\n                        : this._def.catchValue({\n                            get error() {\n                                return new ZodError(newCtx.common.issues);\n                            },\n                            input: newCtx.data,\n                        }),\n                };\n            });\n        }\n        else {\n            return {\n                status: \"valid\",\n                value: result.status === \"valid\"\n                    ? result.value\n                    : this._def.catchValue({\n                        get error() {\n                            return new ZodError(newCtx.common.issues);\n                        },\n                        input: newCtx.data,\n                    }),\n            };\n        }\n    }\n    removeCatch() {\n        return this._def.innerType;\n    }\n}\nZodCatch.create = (type, params) => {\n    return new ZodCatch({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodCatch,\n        catchValue: typeof params.catch === \"function\" ? params.catch : () => params.catch,\n        ...processCreateParams(params),\n    });\n};\nexport class ZodNaN extends ZodType {\n    _parse(input) {\n        const parsedType = this._getType(input);\n        if (parsedType !== ZodParsedType.nan) {\n            const ctx = this._getOrReturnCtx(input);\n            addIssueToContext(ctx, {\n                code: ZodIssueCode.invalid_type,\n                expected: ZodParsedType.nan,\n                received: ctx.parsedType,\n            });\n            return INVALID;\n        }\n        return { status: \"valid\", value: input.data };\n    }\n}\nZodNaN.create = (params) => {\n    return new ZodNaN({\n        typeName: ZodFirstPartyTypeKind.ZodNaN,\n        ...processCreateParams(params),\n    });\n};\nexport const BRAND = Symbol(\"zod_brand\");\nexport class ZodBranded extends ZodType {\n    _parse(input) {\n        const { ctx } = this._processInputParams(input);\n        const data = ctx.data;\n        return this._def.type._parse({\n            data,\n            path: ctx.path,\n            parent: ctx,\n        });\n    }\n    unwrap() {\n        return this._def.type;\n    }\n}\nexport class ZodPipeline extends ZodType {\n    _parse(input) {\n        const { status, ctx } = this._processInputParams(input);\n        if (ctx.common.async) {\n            const handleAsync = async () => {\n                const inResult = await this._def.in._parseAsync({\n                    data: ctx.data,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n                if (inResult.status === \"aborted\")\n                    return INVALID;\n                if (inResult.status === \"dirty\") {\n                    status.dirty();\n                    return DIRTY(inResult.value);\n                }\n                else {\n                    return this._def.out._parseAsync({\n                        data: inResult.value,\n                        path: ctx.path,\n                        parent: ctx,\n                    });\n                }\n            };\n            return handleAsync();\n        }\n        else {\n            const inResult = this._def.in._parseSync({\n                data: ctx.data,\n                path: ctx.path,\n                parent: ctx,\n            });\n            if (inResult.status === \"aborted\")\n                return INVALID;\n            if (inResult.status === \"dirty\") {\n                status.dirty();\n                return {\n                    status: \"dirty\",\n                    value: inResult.value,\n                };\n            }\n            else {\n                return this._def.out._parseSync({\n                    data: inResult.value,\n                    path: ctx.path,\n                    parent: ctx,\n                });\n            }\n        }\n    }\n    static create(a, b) {\n        return new ZodPipeline({\n            in: a,\n            out: b,\n            typeName: ZodFirstPartyTypeKind.ZodPipeline,\n        });\n    }\n}\nexport class ZodReadonly extends ZodType {\n    _parse(input) {\n        const result = this._def.innerType._parse(input);\n        const freeze = (data) => {\n            if (isValid(data)) {\n                data.value = Object.freeze(data.value);\n            }\n            return data;\n        };\n        return isAsync(result) ? result.then((data) => freeze(data)) : freeze(result);\n    }\n    unwrap() {\n        return this._def.innerType;\n    }\n}\nZodReadonly.create = (type, params) => {\n    return new ZodReadonly({\n        innerType: type,\n        typeName: ZodFirstPartyTypeKind.ZodReadonly,\n        ...processCreateParams(params),\n    });\n};\n////////////////////////////////////////\n////////////////////////////////////////\n//////////                    //////////\n//////////      z.custom      //////////\n//////////                    //////////\n////////////////////////////////////////\n////////////////////////////////////////\nfunction cleanParams(params, data) {\n    const p = typeof params === \"function\" ? params(data) : typeof params === \"string\" ? { message: params } : params;\n    const p2 = typeof p === \"string\" ? { message: p } : p;\n    return p2;\n}\nexport function custom(check, _params = {}, \n/**\n * @deprecated\n *\n * Pass `fatal` into the params object instead:\n *\n * ```ts\n * z.string().custom((val) => val.length > 5, { fatal: false })\n * ```\n *\n */\nfatal) {\n    if (check)\n        return ZodAny.create().superRefine((data, ctx) => {\n            const r = check(data);\n            if (r instanceof Promise) {\n                return r.then((r) => {\n                    if (!r) {\n                        const params = cleanParams(_params, data);\n                        const _fatal = params.fatal ?? fatal ?? true;\n                        ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n                    }\n                });\n            }\n            if (!r) {\n                const params = cleanParams(_params, data);\n                const _fatal = params.fatal ?? fatal ?? true;\n                ctx.addIssue({ code: \"custom\", ...params, fatal: _fatal });\n            }\n            return;\n        });\n    return ZodAny.create();\n}\nexport { ZodType as Schema, ZodType as ZodSchema };\nexport const late = {\n    object: ZodObject.lazycreate,\n};\nexport var ZodFirstPartyTypeKind;\n(function (ZodFirstPartyTypeKind) {\n    ZodFirstPartyTypeKind[\"ZodString\"] = \"ZodString\";\n    ZodFirstPartyTypeKind[\"ZodNumber\"] = \"ZodNumber\";\n    ZodFirstPartyTypeKind[\"ZodNaN\"] = \"ZodNaN\";\n    ZodFirstPartyTypeKind[\"ZodBigInt\"] = \"ZodBigInt\";\n    ZodFirstPartyTypeKind[\"ZodBoolean\"] = \"ZodBoolean\";\n    ZodFirstPartyTypeKind[\"ZodDate\"] = \"ZodDate\";\n    ZodFirstPartyTypeKind[\"ZodSymbol\"] = \"ZodSymbol\";\n    ZodFirstPartyTypeKind[\"ZodUndefined\"] = \"ZodUndefined\";\n    ZodFirstPartyTypeKind[\"ZodNull\"] = \"ZodNull\";\n    ZodFirstPartyTypeKind[\"ZodAny\"] = \"ZodAny\";\n    ZodFirstPartyTypeKind[\"ZodUnknown\"] = \"ZodUnknown\";\n    ZodFirstPartyTypeKind[\"ZodNever\"] = \"ZodNever\";\n    ZodFirstPartyTypeKind[\"ZodVoid\"] = \"ZodVoid\";\n    ZodFirstPartyTypeKind[\"ZodArray\"] = \"ZodArray\";\n    ZodFirstPartyTypeKind[\"ZodObject\"] = \"ZodObject\";\n    ZodFirstPartyTypeKind[\"ZodUnion\"] = \"ZodUnion\";\n    ZodFirstPartyTypeKind[\"ZodDiscriminatedUnion\"] = \"ZodDiscriminatedUnion\";\n    ZodFirstPartyTypeKind[\"ZodIntersection\"] = \"ZodIntersection\";\n    ZodFirstPartyTypeKind[\"ZodTuple\"] = \"ZodTuple\";\n    ZodFirstPartyTypeKind[\"ZodRecord\"] = \"ZodRecord\";\n    ZodFirstPartyTypeKind[\"ZodMap\"] = \"ZodMap\";\n    ZodFirstPartyTypeKind[\"ZodSet\"] = \"ZodSet\";\n    ZodFirstPartyTypeKind[\"ZodFunction\"] = \"ZodFunction\";\n    ZodFirstPartyTypeKind[\"ZodLazy\"] = \"ZodLazy\";\n    ZodFirstPartyTypeKind[\"ZodLiteral\"] = \"ZodLiteral\";\n    ZodFirstPartyTypeKind[\"ZodEnum\"] = \"ZodEnum\";\n    ZodFirstPartyTypeKind[\"ZodEffects\"] = \"ZodEffects\";\n    ZodFirstPartyTypeKind[\"ZodNativeEnum\"] = \"ZodNativeEnum\";\n    ZodFirstPartyTypeKind[\"ZodOptional\"] = \"ZodOptional\";\n    ZodFirstPartyTypeKind[\"ZodNullable\"] = \"ZodNullable\";\n    ZodFirstPartyTypeKind[\"ZodDefault\"] = \"ZodDefault\";\n    ZodFirstPartyTypeKind[\"ZodCatch\"] = \"ZodCatch\";\n    ZodFirstPartyTypeKind[\"ZodPromise\"] = \"ZodPromise\";\n    ZodFirstPartyTypeKind[\"ZodBranded\"] = \"ZodBranded\";\n    ZodFirstPartyTypeKind[\"ZodPipeline\"] = \"ZodPipeline\";\n    ZodFirstPartyTypeKind[\"ZodReadonly\"] = \"ZodReadonly\";\n})(ZodFirstPartyTypeKind || (ZodFirstPartyTypeKind = {}));\n// requires TS 4.4+\nclass Class {\n    constructor(..._) { }\n}\nconst instanceOfType = (\n// const instanceOfType = <T extends new (...args: any[]) => any>(\ncls, params = {\n    message: `Input not instance of ${cls.name}`,\n}) => custom((data) => data instanceof cls, params);\nconst stringType = ZodString.create;\nconst numberType = ZodNumber.create;\nconst nanType = ZodNaN.create;\nconst bigIntType = ZodBigInt.create;\nconst booleanType = ZodBoolean.create;\nconst dateType = ZodDate.create;\nconst symbolType = ZodSymbol.create;\nconst undefinedType = ZodUndefined.create;\nconst nullType = ZodNull.create;\nconst anyType = ZodAny.create;\nconst unknownType = ZodUnknown.create;\nconst neverType = ZodNever.create;\nconst voidType = ZodVoid.create;\nconst arrayType = ZodArray.create;\nconst objectType = ZodObject.create;\nconst strictObjectType = ZodObject.strictCreate;\nconst unionType = ZodUnion.create;\nconst discriminatedUnionType = ZodDiscriminatedUnion.create;\nconst intersectionType = ZodIntersection.create;\nconst tupleType = ZodTuple.create;\nconst recordType = ZodRecord.create;\nconst mapType = ZodMap.create;\nconst setType = ZodSet.create;\nconst functionType = ZodFunction.create;\nconst lazyType = ZodLazy.create;\nconst literalType = ZodLiteral.create;\nconst enumType = ZodEnum.create;\nconst nativeEnumType = ZodNativeEnum.create;\nconst promiseType = ZodPromise.create;\nconst effectsType = ZodEffects.create;\nconst optionalType = ZodOptional.create;\nconst nullableType = ZodNullable.create;\nconst preprocessType = ZodEffects.createWithPreprocess;\nconst pipelineType = ZodPipeline.create;\nconst ostring = () => stringType().optional();\nconst onumber = () => numberType().optional();\nconst oboolean = () => booleanType().optional();\nexport const coerce = {\n    string: ((arg) => ZodString.create({ ...arg, coerce: true })),\n    number: ((arg) => ZodNumber.create({ ...arg, coerce: true })),\n    boolean: ((arg) => ZodBoolean.create({\n        ...arg,\n        coerce: true,\n    })),\n    bigint: ((arg) => ZodBigInt.create({ ...arg, coerce: true })),\n    date: ((arg) => ZodDate.create({ ...arg, coerce: true })),\n};\nexport { anyType as any, arrayType as array, bigIntType as bigint, booleanType as boolean, dateType as date, discriminatedUnionType as discriminatedUnion, effectsType as effect, enumType as enum, functionType as function, instanceOfType as instanceof, intersectionType as intersection, lazyType as lazy, literalType as literal, mapType as map, nanType as nan, nativeEnumType as nativeEnum, neverType as never, nullType as null, nullableType as nullable, numberType as number, objectType as object, oboolean, onumber, optionalType as optional, ostring, pipelineType as pipeline, preprocessType as preprocess, promiseType as promise, recordType as record, setType as set, strictObjectType as strictObject, stringType as string, symbolType as symbol, effectsType as transformer, tupleType as tuple, undefinedType as undefined, unionType as union, unknownType as unknown, voidType as void, };\nexport const NEVER = INVALID;\n","// Validation schemas using Zod\nimport { z } from 'zod';\n// User validation schemas\nexport const loginSchema = z.object({\n    email: z.string().email('Invalid email format'),\n    password: z.string().min(6, 'Password must be at least 6 characters')\n});\nexport const registerSchema = z.object({\n    email: z.string().email('Invalid email format'),\n    username: z.string()\n        .min(3, 'Username must be at least 3 characters')\n        .max(20, 'Username must be less than 20 characters')\n        .regex(/^[a-zA-Z0-9_]+$/, 'Username can only contain letters, numbers, and underscores'),\n    password: z.string()\n        .min(6, 'Password must be at least 6 characters')\n        .max(100, 'Password must be less than 100 characters')\n});\n// Coordinate validation\nexport const coordinateSchema = z.object({\n    x: z.number().int().min(0),\n    y: z.number().int().min(0)\n});\n// Empire validation schemas\nexport const empireCreationSchema = z.object({\n    name: z.string()\n        .min(3, 'Empire name must be at least 3 characters')\n        .max(30, 'Empire name must be less than 30 characters')\n        .regex(/^[a-zA-Z0-9\\s]+$/, 'Empire name can only contain letters, numbers, and spaces')\n});\nexport const empireUpdateSchema = z.object({\n    name: z.string()\n        .min(3, 'Empire name must be at least 3 characters')\n        .max(30, 'Empire name must be less than 30 characters')\n        .regex(/^[a-zA-Z0-9\\s]+$/, 'Empire name can only contain letters, numbers, and spaces')\n        .optional()\n});\n// Fleet validation schemas\nexport const fleetCreationSchema = z.object({\n    name: z.string()\n        .min(3, 'Fleet name must be at least 3 characters')\n        .max(20, 'Fleet name must be less than 20 characters'),\n    systemId: z.string().min(1, 'System ID is required')\n});\nexport const fleetMoveSchema = z.object({\n    fleetId: z.string().min(1, 'Fleet ID is required'),\n    destination: coordinateSchema\n});\n// Game action validation\nexport const gameActionSchema = z.object({\n    type: z.string().min(1, 'Action type is required'),\n    payload: z.any(),\n    empireId: z.string().min(1, 'Empire ID is required')\n});\n// Universe settings validation\nexport const universeSettingsSchema = z.object({\n    maxPlayers: z.number().int().min(2).max(1000),\n    gameSpeed: z.number().min(0.1).max(10),\n    startingResources: z.object({\n        credits: z.number().int().min(0),\n        minerals: z.number().int().min(0),\n        energy: z.number().int().min(0)\n    })\n});\n// Planet validation\nexport const planetSchema = z.object({\n    name: z.string().min(1).max(50),\n    type: z.enum(['terrestrial', 'gas_giant', 'ice', 'desert', 'volcanic']),\n    size: z.enum(['small', 'medium', 'large']),\n    population: z.number().int().min(0),\n    infrastructure: z.object({\n        mines: z.number().int().min(0),\n        factories: z.number().int().min(0),\n        research_labs: z.number().int().min(0),\n        defense_stations: z.number().int().min(0)\n    }),\n    resources: z.object({\n        minerals: z.number().int().min(0),\n        energy: z.number().int().min(0)\n    })\n});\n// Star system validation\nexport const starSystemSchema = z.object({\n    name: z.string().min(1).max(50),\n    coordinates: coordinateSchema,\n    planets: z.array(planetSchema),\n    owner: z.string().optional(),\n    resources: z.object({\n        minerals: z.number().int().min(0),\n        energy: z.number().int().min(0)\n    }),\n    defenseLevel: z.number().int().min(0)\n});\n// Ship validation\nexport const shipSchema = z.object({\n    type: z.enum(['scout', 'fighter', 'cruiser', 'battleship', 'transport']),\n    health: z.number().int().min(0),\n    maxHealth: z.number().int().min(1),\n    attack: z.number().int().min(0),\n    defense: z.number().int().min(0),\n    speed: z.number().min(0),\n    cargo: z.object({\n        minerals: z.number().int().min(0),\n        energy: z.number().int().min(0),\n        capacity: z.number().int().min(0)\n    }).optional()\n});\n// Validation helper functions\nexport function validateLogin(data) {\n    return loginSchema.safeParse(data);\n}\nexport function validateRegister(data) {\n    return registerSchema.safeParse(data);\n}\nexport function validateCoordinates(data) {\n    return coordinateSchema.safeParse(data);\n}\nexport function validateEmpireCreation(data) {\n    return empireCreationSchema.safeParse(data);\n}\nexport function validateFleetCreation(data) {\n    return fleetCreationSchema.safeParse(data);\n}\nexport function validateFleetMove(data) {\n    return fleetMoveSchema.safeParse(data);\n}\nexport function validateGameAction(data) {\n    return gameActionSchema.safeParse(data);\n}\n/* ============================================\n * Desktop cache validation & normalization (Phase 4)\n * ============================================\n * These helpers validate and normalize bootstrap payloads and cached content\n * so the Electron app can safely persist and read catalogs/profile data.\n */\n// Catalog entry: preferred form used by desktop cache\nexport const CatalogEntrySchema = z.object({\n    data: z.unknown(),\n    version: z.string().optional(),\n    contentHash: z.string().optional()\n});\n// Catalogs container: keys are optional to allow partial caching\nexport const CatalogsSchema = z.object({\n    technologies: z.unknown().optional(),\n    buildings: z.unknown().optional(),\n    defenses: z.unknown().optional(),\n    units: z.unknown().optional()\n});\n// Server-side profile snapshot (from /sync/bootstrap)\nexport const ProfileSnapshotServerSchema = z.object({\n    user: z.object({\n        _id: z.any(),\n        username: z.string(),\n        email: z.string().email()\n    }).passthrough(),\n    empire: z.any(),\n    profile: z.object({\n        economyPerHour: z.number(),\n        fleetScore: z.number(),\n        technologyScore: z.number(),\n        level: z.number()\n    }).passthrough(),\n    // Allow additional fields like lastResourceUpdate, creditsPerHour, serverInfo\n}).passthrough();\n// Desktop cache profile entry (normalized form)\nexport const ProfileCacheEntrySchema = z.object({\n    userId: z.string(),\n    deviceId: z.string(),\n    data: z.unknown(),\n    schemaVersion: z.number().int().min(1).optional()\n});\n// Version payload is flexible server-side; desktop normalizes to a string\nexport const BootstrapVersionSchema = z.object({\n    catalogs: z.string().optional(),\n    profile: z.string().optional(),\n    timestamp: z.string().optional()\n}).optional();\n/**\n * Normalize any catalog value into a CatalogEntry shape.\n * - If already in { data, version?, contentHash? } form, validate and return.\n * - Otherwise, wrap raw value as { data: raw, version?: defaultVersion }.\n */\nexport function parseCatalogEntry(value, defaultVersion) {\n    if (value && typeof value === 'object' && ('data' in value)) {\n        const parsed = CatalogEntrySchema.safeParse(value);\n        if (parsed.success)\n            return parsed.data;\n        // Fall through to wrapping if validation failed\n    }\n    return {\n        data: value,\n        version: defaultVersion\n    };\n}\n/**\n * Validate and normalize a catalogs object, wrapping each present catalog\n * into a CatalogEntry shape.\n */\nexport function normalizeCatalogs(input, defaultVersion) {\n    const parsed = CatalogsSchema.safeParse(input);\n    if (!parsed.success) {\n        throw parsed.error;\n    }\n    const src = parsed.data;\n    const out = {};\n    for (const key of ['technologies', 'buildings', 'defenses', 'units']) {\n        if (key in src && src[key] !== undefined) {\n            out[key] = parseCatalogEntry(src[key], defaultVersion);\n        }\n    }\n    return out;\n}\n/**\n * Convert a server ProfileSnapshot into a desktop ProfileCacheEntry.\n */\nexport function fromServerProfileSnapshot(snap, deviceId) {\n    const parsed = ProfileSnapshotServerSchema.safeParse(snap);\n    if (!parsed.success) {\n        throw parsed.error;\n    }\n    const userId = String(parsed.data.user._id);\n    return {\n        userId,\n        deviceId,\n        data: parsed.data,\n        schemaVersion: 1\n    };\n}\n/**\n * Parse and normalize the /sync/bootstrap payload into desktop-friendly shapes.\n * Accepts either:\n * - Desktop-expected: { version, catalogs: { key: CatalogEntry|raw }, profile: ProfileCacheEntry }\n * - Server form:      { version, catalogs: raw arrays/objects, profileSnapshot: ServerSnapshot }\n */\nexport function parseAndNormalizeBootstrap(input, opts) {\n    if (!input || typeof input !== 'object') {\n        throw new Error('Bootstrap payload must be an object');\n    }\n    const obj = input;\n    // Determine version string\n    // Prefer server version.catalogs, else version string, else fallback\n    const versionValue = (obj?.version && typeof obj.version === 'object' && typeof obj.version.catalogs === 'string'\n        ? obj.version.catalogs\n        : (typeof obj.version === 'string' ? obj.version : undefined))\n        || opts?.fallbackVersion\n        || '1.0.0';\n    // Catalogs (tolerate both desktop and server shapes)\n    let catalogs = undefined;\n    if (obj?.catalogs) {\n        catalogs = normalizeCatalogs(obj.catalogs, versionValue);\n    }\n    // Profile (tolerate desktop 'profile' or server 'profileSnapshot')\n    let profile = undefined;\n    if (obj?.profile) {\n        const p = ProfileCacheEntrySchema.safeParse(obj.profile);\n        if (!p.success) {\n            throw p.error;\n        }\n        profile = p.data;\n    }\n    else if (obj?.profileSnapshot) {\n        const deviceId = opts?.deviceId || 'unknown-device';\n        profile = fromServerProfileSnapshot(obj.profileSnapshot, deviceId);\n    }\n    return {\n        version: String(versionValue),\n        catalogs,\n        profile\n    };\n}\n//# sourceMappingURL=validation.js.map","// Deterministic random helpers (decoupled from legacy MK star module)\n// This module centralizes coordinate-based seeding so other modules\n// (e.g., overhaul.ts) don't depend on ./astro and can outlive its deprecation.\n/**\n * Generate deterministic seed from coordinate string (+ optional index)\n * Ensures the same coordinate/stream always produces the same value.\n *\n * Example:\n *  const seed = generateSeedFromCoordinate(\"A00:10:22:10\", 101)\n */\nexport const generateSeedFromCoordinate = (coordinate, index = 0) => {\n    let hash = 0;\n    const str = coordinate + index.toString();\n    for (let i = 0; i < str.length; i++) {\n        const char = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + char;\n        hash = hash & hash; // Convert to 32-bit integer\n    }\n    return Math.abs(hash);\n};\n//# sourceMappingURL=random.js.map","// Technology catalog and helpers for Phase A (level 1 unlocks with credits and lab gating)\n// Catalog derived from the provided screenshot. Values are for Level 1 unlocks.\nexport const technologyCatalog = {\n    energy: {\n        key: 'energy',\n        name: 'Energy',\n        description: 'Increases all bases energy output by 5%.',\n        creditsCost: 2,\n        requiredLabs: 1,\n        prerequisites: [],\n    },\n    computer: {\n        key: 'computer',\n        name: 'Computer',\n        description: 'Allows one campaign fleet per level.',\n        creditsCost: 2,\n        requiredLabs: 1,\n        prerequisites: [],\n    },\n    armour: {\n        key: 'armour',\n        name: 'Armour',\n        description: 'Increases units and defenses armour by 5%.',\n        creditsCost: 4,\n        requiredLabs: 2,\n        prerequisites: [],\n    },\n    laser: {\n        key: 'laser',\n        name: 'Laser',\n        description: 'Increases laser weapons power by 5%.',\n        creditsCost: 4,\n        requiredLabs: 2,\n        prerequisites: [{ key: 'energy', level: 2 }],\n    },\n    missiles: {\n        key: 'missiles',\n        name: 'Missiles',\n        description: 'Increases missile weapons power by 5%.',\n        creditsCost: 8,\n        requiredLabs: 4,\n        prerequisites: [{ key: 'computer', level: 4 }],\n    },\n    stellar_drive: {\n        key: 'stellar_drive',\n        name: 'Stellar Drive',\n        description: 'Increases stellar units speed by 5%.',\n        creditsCost: 16,\n        requiredLabs: 5,\n        prerequisites: [{ key: 'energy', level: 6 }],\n    },\n    plasma: {\n        key: 'plasma',\n        name: 'Plasma',\n        description: 'Increases plasma weapons power by 5%.',\n        creditsCost: 32,\n        requiredLabs: 6,\n        prerequisites: [\n            { key: 'energy', level: 6 },\n            { key: 'laser', level: 4 },\n        ],\n    },\n    warp_drive: {\n        key: 'warp_drive',\n        name: 'Warp Drive',\n        description: 'Increases warp units speed by 5%.',\n        creditsCost: 64,\n        requiredLabs: 8,\n        prerequisites: [\n            { key: 'energy', level: 8 },\n            { key: 'stellar_drive', level: 4 },\n        ],\n    },\n    shielding: {\n        key: 'shielding',\n        name: 'Shielding',\n        description: 'Increases units and defenses shield by 5%.',\n        creditsCost: 128,\n        requiredLabs: 10,\n        prerequisites: [{ key: 'energy', level: 10 }],\n    },\n    ion: {\n        key: 'ion',\n        name: 'Ion',\n        description: 'Increases ion weapons power by 5%.',\n        creditsCost: 256,\n        requiredLabs: 12,\n        prerequisites: [\n            { key: 'energy', level: 12 },\n            { key: 'laser', level: 10 },\n        ],\n    },\n    stealth: {\n        key: 'stealth',\n        name: 'Stealth',\n        description: 'Decreases the time your own fleets can be detected before they arrive.',\n        creditsCost: 512,\n        requiredLabs: 14,\n        prerequisites: [{ key: 'energy', level: 14 }],\n    },\n    photon: {\n        key: 'photon',\n        name: 'Photon',\n        description: 'Increases photon weapons power by 5%.',\n        creditsCost: 1024,\n        requiredLabs: 16,\n        prerequisites: [\n            { key: 'energy', level: 16 },\n            { key: 'plasma', level: 8 },\n        ],\n    },\n    artificial_intelligence: {\n        key: 'artificial_intelligence',\n        name: 'Artificial Intelligence',\n        description: 'Increases all bases research output by 5%.',\n        creditsCost: 2048,\n        requiredLabs: 18,\n        prerequisites: [{ key: 'computer', level: 20 }],\n    },\n    disruptor: {\n        key: 'disruptor',\n        name: 'Disruptor',\n        description: 'Increases disruptor weapons power by 5%.',\n        creditsCost: 4096,\n        requiredLabs: 20,\n        prerequisites: [\n            { key: 'energy', level: 20 },\n            { key: 'laser', level: 18 },\n        ],\n    },\n    cybernetics: {\n        key: 'cybernetics',\n        name: 'Cybernetics',\n        description: 'Increases all bases construction and production by 5%.',\n        creditsCost: 8192,\n        requiredLabs: 22,\n        prerequisites: [{ key: 'artificial_intelligence', level: 6 }],\n    },\n    tachyon_communications: {\n        key: 'tachyon_communications',\n        name: 'Tachyon Communications',\n        description: 'Allows 1 research link between 2 bases (min labs 20).',\n        creditsCost: 32768,\n        requiredLabs: 24,\n        prerequisites: [\n            { key: 'energy', level: 24 },\n            { key: 'computer', level: 24 },\n        ],\n    },\n    anti_gravity: {\n        key: 'anti_gravity',\n        name: 'Anti-Gravity',\n        description: 'Decreases orbital structures construction time by 5% and increases Death Star speed by 5%.',\n        creditsCost: 100000,\n        requiredLabs: 26,\n        prerequisites: [\n            { key: 'energy', level: 26 },\n            { key: 'computer', level: 26 },\n        ],\n    },\n};\n// Helpers\nexport function getTechnologyList() {\n    return Object.values(technologyCatalog);\n}\nexport function getTechSpec(key) {\n    return technologyCatalog[key];\n}\nexport function evaluatePrereqs(techLevels, prerequisites) {\n    const unmet = [];\n    for (const req of prerequisites) {\n        const current = Math.max(0, techLevels[req.key] ?? 0);\n        if (current < req.level) {\n            unmet.push({ key: req.key, requiredLevel: req.level, currentLevel: current });\n        }\n    }\n    return { ok: unmet.length === 0, unmet };\n}\nexport function canStartTech(params, spec) {\n    const reasons = [];\n    // Already unlocked (Phase A: only level 1)\n    const currentLevel = Math.max(0, params.techLevels[spec.key] ?? 0);\n    if (currentLevel >= 1) {\n        reasons.push('Already unlocked.');\n    }\n    // Labs\n    if (params.baseLabTotal < spec.requiredLabs) {\n        reasons.push(`Requires ${spec.requiredLabs} lab levels at this base (have ${params.baseLabTotal}).`);\n    }\n    // Credits\n    if (params.credits < spec.creditsCost) {\n        reasons.push(`Requires ${spec.creditsCost.toLocaleString()} credits (have ${params.credits.toLocaleString()}).`);\n    }\n    // Prerequisites\n    const { ok, unmet } = evaluatePrereqs(params.techLevels, spec.prerequisites);\n    if (!ok) {\n        for (const u of unmet) {\n            const prereqSpec = getTechSpec(u.key);\n            reasons.push(`Requires ${prereqSpec.name} ${u.requiredLevel} (current ${u.currentLevel}).`);\n        }\n    }\n    return { canStart: reasons.length === 0, reasons };\n}\n/**\n * Compute the credit cost for a specific technology level.\n * - Level 1 uses the catalog's creditsCost\n * - Higher levels use a geometric progression with ratio ~1.5, rounded each step\n *   This matches the general pattern used across level tables (2,3,5,7,11,16,23,...).\n */\nexport function getTechCreditCostForLevel(specOrKey, level) {\n    const spec = typeof specOrKey === 'string' ? getTechSpec(specOrKey) : specOrKey;\n    const base = Math.max(0, Number(spec.creditsCost || 0));\n    const targetLevel = Math.max(1, Math.floor(level || 1));\n    if (targetLevel <= 1)\n        return base;\n    // Geometric growth with ratio 1.5, rounding each step\n    let cost = base;\n    for (let l = 2; l <= targetLevel; l++) {\n        cost = Math.round(cost * 1.5);\n    }\n    return Math.max(1, cost);\n}\n/**\n * Multi-level gating that considers the TARGET level being researched.\n * - Uses getTechCreditCostForLevel(spec, targetLevel) for credits\n * - Uses spec.requiredLabs for lab requirement (constant for all levels in Phase A)\n * - Uses spec.prerequisites (treated as global requirements independent of target level)\n */\nexport function canStartTechLevel(params, spec, targetLevel) {\n    const reasons = [];\n    const currentLevel = Math.max(0, params.techLevels[spec.key] ?? 0);\n    const desired = Math.max(1, Math.floor(targetLevel || 1));\n    // Already at or above desired level\n    if (currentLevel >= desired) {\n        reasons.push(`Already unlocked (current ${currentLevel}).`);\n    }\n    // Labs (Phase A: spec.requiredLabs applies to all levels)\n    if (params.baseLabTotal < spec.requiredLabs) {\n        reasons.push(`Requires ${spec.requiredLabs} lab levels at this base (have ${params.baseLabTotal}).`);\n    }\n    // Credits for the desired level\n    const cost = getTechCreditCostForLevel(spec, desired);\n    if (params.credits < cost) {\n        reasons.push(`Requires ${cost.toLocaleString()} credits (have ${params.credits.toLocaleString()}).`);\n    }\n    // Prerequisites (treated as global requirements)\n    const { ok, unmet } = evaluatePrereqs(params.techLevels, spec.prerequisites);\n    if (!ok) {\n        for (const u of unmet) {\n            const prereqSpec = getTechSpec(u.key);\n            reasons.push(`Requires ${prereqSpec.name} ${u.requiredLevel} (current ${u.currentLevel}).`);\n        }\n    }\n    return { canStart: reasons.length === 0, reasons };\n}\n//# sourceMappingURL=tech.js.map","// Buildings catalog (Phase A subset) + helpers.\n// Note: For Phase A we primarily gate by technology prerequisites.\n// Credits/energy/economy/pop/area are included for future use but not fully enforced yet.\n// Minimal best-guess subset derived from screenshot.\n// Many items map to existing generic types to avoid schema changes in Phase A.\nexport const buildingsCatalog = {\n    urban_structures: {\n        key: 'urban_structures',\n        name: 'Urban Structures',\n        creditsCost: 1,\n        energyDelta: 0,\n        economy: 0,\n        populationRequired: 0,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'habitat',\n    },\n    solar_plants: {\n        key: 'solar_plants',\n        name: 'Solar Plants',\n        creditsCost: 1,\n        energyDelta: 1,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'energy_plant',\n    },\n    gas_plants: {\n        key: 'gas_plants',\n        name: 'Gas Plants',\n        creditsCost: 1,\n        energyDelta: 1,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'energy_plant',\n    },\n    fusion_plants: {\n        key: 'fusion_plants',\n        name: 'Fusion Plants',\n        creditsCost: 20,\n        energyDelta: 4,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [{ key: 'energy', level: 6 }],\n        mappedType: 'energy_plant',\n    },\n    antimatter_plants: {\n        key: 'antimatter_plants',\n        name: 'Antimatter Plants',\n        creditsCost: 2000,\n        energyDelta: 10,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 1,\n        advanced: true,\n        techPrereqs: [{ key: 'energy', level: 20 }],\n        mappedType: 'energy_plant',\n    },\n    orbital_plants: {\n        key: 'orbital_plants',\n        name: 'Orbital Plants',\n        creditsCost: 40000,\n        energyDelta: 12,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 0,\n        advanced: true,\n        techPrereqs: [{ key: 'energy', level: 25 }],\n        mappedType: 'energy_plant',\n    },\n    research_labs: {\n        key: 'research_labs',\n        name: 'Research Labs',\n        creditsCost: 2,\n        energyDelta: -1,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'research_lab',\n    },\n    metal_refineries: {\n        key: 'metal_refineries',\n        name: 'Metal Refineries',\n        creditsCost: 1,\n        energyDelta: -1,\n        economy: 1,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'factory',\n    },\n    crystal_mines: {\n        key: 'crystal_mines',\n        name: 'Crystal Mines',\n        creditsCost: 2,\n        energyDelta: -1,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'habitat',\n    },\n    robotic_factories: {\n        key: 'robotic_factories',\n        name: 'Robotic Factories',\n        creditsCost: 5,\n        energyDelta: -1,\n        economy: 1,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [{ key: 'computer', level: 2 }],\n        mappedType: 'factory',\n    },\n    command_centers: {\n        key: 'command_centers',\n        name: 'Command Centers',\n        creditsCost: 20,\n        energyDelta: -1,\n        economy: 0,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [{ key: 'computer', level: 6 }],\n        mappedType: 'command_center',\n    },\n    shipyards: {\n        key: 'shipyards',\n        name: 'Shipyards',\n        creditsCost: 5, // placeholder\n        energyDelta: -1,\n        economy: 1,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'shipyard',\n    },\n    orbital_shipyards: {\n        key: 'orbital_shipyards',\n        name: 'Orbital Shipyards',\n        creditsCost: 10000,\n        energyDelta: -12,\n        economy: 2,\n        populationRequired: 1,\n        areaRequired: 0,\n        techPrereqs: [{ key: 'cybernetics', level: 2 }],\n        mappedType: 'shipyard',\n    },\n    spaceports: {\n        key: 'spaceports',\n        name: 'Spaceports',\n        creditsCost: 5,\n        energyDelta: -1,\n        economy: 2,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [],\n        mappedType: 'habitat',\n    },\n    nanite_factories: {\n        key: 'nanite_factories',\n        name: 'Nanite Factories',\n        creditsCost: 80,\n        energyDelta: -2,\n        economy: 2,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [\n            { key: 'computer', level: 10 },\n            { key: 'laser', level: 8 },\n        ],\n        mappedType: 'factory',\n    },\n    android_factories: {\n        key: 'android_factories',\n        name: 'Android Factories',\n        creditsCost: 1000,\n        energyDelta: -4,\n        economy: 2,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [{ key: 'artificial_intelligence', level: 4 }],\n        mappedType: 'factory',\n    },\n    economic_centers: {\n        key: 'economic_centers',\n        name: 'Economic Centers',\n        creditsCost: 80,\n        energyDelta: -2,\n        economy: 3,\n        populationRequired: 1,\n        areaRequired: 1,\n        techPrereqs: [{ key: 'computer', level: 10 }],\n        mappedType: 'habitat', // best mapping to produce credits/hour in current model\n    },\n    terraform: {\n        key: 'terraform',\n        name: 'Terraform',\n        creditsCost: 80,\n        energyDelta: 0,\n        economy: 0,\n        populationRequired: 0,\n        areaRequired: 1,\n        techPrereqs: [\n            { key: 'computer', level: 10 },\n            { key: 'energy', level: 10 },\n        ],\n        mappedType: 'habitat',\n    },\n    multi_level_platforms: {\n        key: 'multi_level_platforms',\n        name: 'Multi-Level Platforms',\n        creditsCost: 10000,\n        energyDelta: 0,\n        economy: 0,\n        populationRequired: 0,\n        advanced: true,\n        techPrereqs: [{ key: 'armour', level: 22 }],\n        mappedType: 'habitat',\n    },\n    orbital_base: {\n        key: 'orbital_base',\n        name: 'Orbital Base',\n        creditsCost: 2000,\n        energyDelta: 0,\n        economy: 0,\n        populationRequired: 0,\n        advanced: true,\n        techPrereqs: [{ key: 'computer', level: 20 }],\n        mappedType: 'habitat',\n    },\n    jump_gate: {\n        key: 'jump_gate',\n        name: 'Jump Gate',\n        creditsCost: 5000,\n        energyDelta: -12,\n        economy: 0,\n        populationRequired: 1,\n        advanced: true,\n        techPrereqs: [\n            { key: 'warp_drive', level: 12 },\n            { key: 'energy', level: 20 },\n        ],\n        mappedType: 'defense_station',\n    },\n    biosphere_modification: {\n        key: 'biosphere_modification',\n        name: 'Biosphere Modification',\n        creditsCost: 20000,\n        energyDelta: -24,\n        economy: 0,\n        populationRequired: 1,\n        advanced: true,\n        techPrereqs: [\n            { key: 'computer', level: 24 },\n            { key: 'energy', level: 24 },\n        ],\n        mappedType: 'habitat',\n    },\n    capital: {\n        key: 'capital',\n        name: 'Capital',\n        creditsCost: 15000,\n        energyDelta: -12,\n        economy: 10,\n        populationRequired: 1,\n        advanced: true,\n        techPrereqs: [{ key: 'tachyon_communications', level: 1 }],\n        mappedType: 'command_center',\n    },\n};\nexport function getBuildingsList() {\n    return Object.values(buildingsCatalog);\n}\nexport function getBuildingSpec(key) {\n    return buildingsCatalog[key];\n}\n// Simple tech-gating helper (Phase A):\nexport function canStartBuildingByTech(techLevels, spec) {\n    const unmet = [];\n    for (const req of spec.techPrereqs) {\n        const curr = Math.max(0, techLevels[req.key] ?? 0);\n        if (curr < req.level) {\n            unmet.push({ key: req.key, requiredLevel: req.level, currentLevel: curr });\n        }\n    }\n    return { ok: unmet.length === 0, unmet };\n}\n//# sourceMappingURL=buildings.js.map","// Universe Overhaul: shared data tables and computation helpers\n// Implements star kinds, planetary terrains, base position modifiers, and deterministic selection.\n// This module is framework-agnostic and can be used by both server and client.\nimport { generateSeedFromCoordinate } from \"./random\";\n// Helper to accumulate resource deltas safely\nconst addResourceDelta = (existing, delta) => ({\n    metal: (existing?.metal ?? 0) + (delta.metal ?? 0),\n    gas: (existing?.gas ?? 0) + (delta.gas ?? 0),\n    crystals: (existing?.crystals ?? 0) + (delta.crystals ?? 0),\n});\n// -------------------------\n// Tables\n// -------------------------\n// Terrain baselines (Planetary and Asteroid) from spec\nexport const TERRAIN_BASELINES = {\n    Arid: { metal: 3, gas: 3, crystals: 0, fertility: 5, areaPlanet: 95, areaMoon: 83 },\n    Asteroid: { metal: 4, gas: 2, crystals: 2, fertility: 4, areaMoon: 65 },\n    Craters: { metal: 4, gas: 2, crystals: 2, fertility: 4, areaPlanet: 85, areaMoon: 75 },\n    Crystalline: { metal: 3, gas: 2, crystals: 3, fertility: 4, areaPlanet: 80, areaMoon: 71 },\n    Earthly: { metal: 3, gas: 3, crystals: 0, fertility: 6, areaPlanet: 85, areaMoon: 75 },\n    Gaia: { metal: 3, gas: 2, crystals: 0, fertility: 6, areaPlanet: 90, areaMoon: 79 },\n    Glacial: { metal: 2, gas: 4, crystals: 0, fertility: 5, areaPlanet: 95, areaMoon: 83 },\n    Magma: { metal: 3, gas: 5, crystals: 0, fertility: 5, areaPlanet: 80, areaMoon: 71 },\n    Metallic: { metal: 4, gas: 2, crystals: 2, fertility: 4, areaPlanet: 85, areaMoon: 75 },\n    Oceanic: { metal: 2, gas: 4, crystals: 0, fertility: 6, areaPlanet: 80, areaMoon: 71 },\n    Radioactive: { metal: 3, gas: 4, crystals: 0, fertility: 4, areaPlanet: 90, areaMoon: 79 },\n    Rocky: { metal: 4, gas: 2, crystals: 0, fertility: 5, areaPlanet: 85, areaMoon: 75 },\n    Toxic: { metal: 3, gas: 5, crystals: 0, fertility: 4, areaPlanet: 90, areaMoon: 79 },\n    Tundra: { metal: 3, gas: 3, crystals: 0, fertility: 5, areaPlanet: 95, areaMoon: 83 },\n    Volcanic: { metal: 3, gas: 5, crystals: 0, fertility: 5, areaPlanet: 80, areaMoon: 71 },\n};\n// Base Astro Position Modifiers (Standard System) P1..P8\n// Solar Energy:  [5,4,3,2,1,0,0,0]\n// Fertility:     [-1,0,1,1,2,2,3,3]\nconst BASE_SOLAR_ENERGY = [5, 4, 3, 2, 1, 0, 0, 0];\nconst BASE_FERTILITY = [-1, 0, 1, 1, 2, 2, 3, 3];\nexport const getBasePosition = (position) => {\n    const p = clampPosition(position);\n    return {\n        solarEnergy: BASE_SOLAR_ENERGY[p - 1],\n        fertility: BASE_FERTILITY[p - 1],\n    };\n};\n// -------------------------\n// Star kind modifier rules (per spec)\n// -------------------------\nconst isEven = (n) => n % 2 === 0;\nexport const getStarKindModifiers = (kind, position) => {\n    const p = clampPosition(position);\n    // Defaults\n    let solarEnergyDelta = 0;\n    let fertilityDelta = 0;\n    let resourceDelta = undefined;\n    switch (kind) {\n        case \"RED_GIANT\":\n            // Fertility: P13: 1; P58: +1\n            if (p >= 1 && p <= 3)\n                fertilityDelta += -1;\n            if (p >= 5 && p <= 8)\n                fertilityDelta += 1;\n            // Solar Energy: P14: 1\n            if (p >= 1 && p <= 4)\n                solarEnergyDelta += -1;\n            // Resources: Gas +2 (all)\n            resourceDelta = addResourceDelta(resourceDelta, { gas: 2 });\n            break;\n        case \"SUPER_GIANT\":\n            // Solar Energy: P14: +2\n            if (p >= 1 && p <= 4)\n                solarEnergyDelta += 2;\n            // Fertility: P14: 2\n            if (p >= 1 && p <= 4)\n                fertilityDelta += -2;\n            // Resources: Crystals +1 (all)\n            resourceDelta = addResourceDelta(resourceDelta, { crystals: 1 });\n            break;\n        case \"BLUE\":\n            // Solar Energy: P13: +2\n            if (p >= 1 && p <= 3)\n                solarEnergyDelta += 2;\n            // Fertility: P13: 2\n            if (p >= 1 && p <= 3)\n                fertilityDelta += -2;\n            // Resources: P46: +1 Metal, +1 Gas\n            if (p >= 4 && p <= 6) {\n                resourceDelta = addResourceDelta(resourceDelta, { metal: 1, gas: 1 });\n            }\n            break;\n        case \"NEUTRON\":\n            // Fertility: P13: 3\n            if (p >= 1 && p <= 3)\n                fertilityDelta += -3;\n            // Solar Energy: Even +2; Odd 2\n            solarEnergyDelta += isEven(p) ? 2 : -2;\n            // Resources: P48: +3 Metal\n            if (p >= 4 && p <= 8) {\n                resourceDelta = addResourceDelta(resourceDelta, { metal: 3 });\n            }\n            break;\n        case \"WHITE\":\n            // Solar Energy: P15: +1\n            if (p >= 1 && p <= 5)\n                solarEnergyDelta += 1;\n            // Fertility: P24: +1\n            if (p >= 2 && p <= 4)\n                fertilityDelta += 1;\n            // Resources: P36: +1 Gas; All: 1 Crystals\n            if (p >= 3 && p <= 6) {\n                resourceDelta = addResourceDelta(resourceDelta, { gas: 1 });\n            }\n            resourceDelta = addResourceDelta(resourceDelta, { crystals: -1 });\n            break;\n        case \"WHITE_DWARF\":\n            // Solar Energy: All 2\n            solarEnergyDelta += -2;\n            // Fertility: P58: +2\n            if (p >= 5 && p <= 8)\n                fertilityDelta += 2;\n            // Resources: P14: +2 Metal; All: 1 Gas\n            if (p >= 1 && p <= 4) {\n                resourceDelta = addResourceDelta(resourceDelta, { metal: 2 });\n            }\n            resourceDelta = addResourceDelta(resourceDelta, { gas: -1 });\n            break;\n        case \"ORANGE\":\n            // Fertility: P36: +1\n            if (p >= 3 && p <= 6)\n                fertilityDelta += 1;\n            // Solar Energy: No change\n            // Resources: P13: +1 Gas\n            if (p >= 1 && p <= 3) {\n                resourceDelta = addResourceDelta(resourceDelta, { gas: 1 });\n            }\n            break;\n        case \"YELLOW\":\n            // Solar Energy: P24: +1\n            if (p >= 2 && p <= 4)\n                solarEnergyDelta += 1;\n            // Fertility: All +1\n            fertilityDelta += 1;\n            // Resources: P68: 1 Gas\n            if (p >= 6 && p <= 8) {\n                resourceDelta = addResourceDelta(resourceDelta, { gas: -1 });\n            }\n            break;\n    }\n    return { solarEnergyDelta, fertilityDelta, resourceDelta };\n};\n// -------------------------\n// Deterministic selection (independent randomization)\n// -------------------------\n// Proposed default distribution for star kinds (tunable):\n// Yellow: 0.35, Orange: 0.30, White: 0.12, Blue: 0.08, Red Giant: 0.06, Super Giant: 0.03, White Dwarf: 0.04, Neutron: 0.02\nexport const STAR_KIND_WEIGHTS = [\n    { kind: \"YELLOW\", weight: 0.35 },\n    { kind: \"ORANGE\", weight: 0.30 },\n    { kind: \"WHITE\", weight: 0.12 },\n    { kind: \"BLUE\", weight: 0.08 },\n    { kind: \"RED_GIANT\", weight: 0.06 },\n    { kind: \"SUPER_GIANT\", weight: 0.03 },\n    { kind: \"WHITE_DWARF\", weight: 0.04 },\n    { kind: \"NEUTRON\", weight: 0.02 },\n];\nconst cumulativeWeights = (() => {\n    const arr = [];\n    let sum = 0;\n    for (const e of STAR_KIND_WEIGHTS) {\n        sum += e.weight;\n        arr.push(sum);\n    }\n    // Normalize to 1.0 if necessary\n    const last = arr[arr.length - 1];\n    if (Math.abs(last - 1) > 1e-6) {\n        for (let i = 0; i < arr.length; i++) {\n            arr[i] = arr[i] / last;\n        }\n    }\n    return arr;\n})();\n/**\n * Deterministic normalized random in [0,1) from a numeric seed.\n */\nexport const normalizedFromSeed = (seed) => {\n    // Use a large modulus to improve distribution then normalize\n    const n = Math.abs(seed % 1000000);\n    return n / 1000000;\n};\n/**\n * Pick a StarKind deterministically from coord and an index (to disambiguate streams).\n */\nexport const pickStarKindFromCoord = (coord, indexForKind = 101) => {\n    const seed = generateSeedFromCoordinate(coord, indexForKind);\n    const r = normalizedFromSeed(seed);\n    for (let i = 0; i < cumulativeWeights.length; i++) {\n        if (r <= cumulativeWeights[i])\n            return STAR_KIND_WEIGHTS[i].kind;\n    }\n    return STAR_KIND_WEIGHTS[STAR_KIND_WEIGHTS.length - 1].kind;\n};\nconst PLANET_TERRAINS = [\n    \"Arid\",\n    \"Craters\",\n    \"Crystalline\",\n    \"Earthly\",\n    \"Gaia\",\n    \"Glacial\",\n    \"Magma\",\n    \"Metallic\",\n    \"Oceanic\",\n    \"Radioactive\",\n    \"Rocky\",\n    \"Toxic\",\n    \"Tundra\",\n    \"Volcanic\",\n];\n/**\n * Pick terrain deterministically. If isAsteroid is true, returns \"Asteroid\".\n * Otherwise chooses equally among non-asteroid terrains.\n */\nexport const pickTerrainFromCoord = (coord, bodyId, isAsteroid) => {\n    if (isAsteroid)\n        return \"Asteroid\";\n    const seed = generateSeedFromCoordinate(coord, 202 + bodyId);\n    const r = normalizedFromSeed(seed);\n    const idx = Math.floor(r * PLANET_TERRAINS.length);\n    return PLANET_TERRAINS[Math.min(Math.max(idx, 0), PLANET_TERRAINS.length - 1)];\n};\n// -------------------------\n// Computation\n// -------------------------\nconst clampNonNegative = (n) => (n < 0 ? 0 : n);\nconst clampPosition = (p) => Math.min(8, Math.max(1, Math.floor(p || 1)));\nexport const computePlanetStats = (inputs) => {\n    const position = clampPosition(inputs.position);\n    const baselineTerrain = TERRAIN_BASELINES[inputs.terrain];\n    const basePosition = getBasePosition(position);\n    const starMods = getStarKindModifiers(inputs.kind, position);\n    const metal = clampNonNegative((baselineTerrain.metal || 0) + (starMods.resourceDelta?.metal || 0));\n    const gas = clampNonNegative((baselineTerrain.gas || 0) + (starMods.resourceDelta?.gas || 0));\n    const crystals = clampNonNegative((baselineTerrain.crystals || 0) + (starMods.resourceDelta?.crystals || 0));\n    const fertility = Math.max(0, (baselineTerrain.fertility || 0) + basePosition.fertility + (starMods.fertilityDelta || 0));\n    const solarEnergy = basePosition.solarEnergy + (starMods.solarEnergyDelta || 0);\n    const area = baselineTerrain.areaPlanet; // Future: moons not yet generated\n    return {\n        baselineTerrain,\n        basePosition,\n        starMods,\n        result: {\n            solarEnergy,\n            fertility,\n            yields: { metal, gas, crystals },\n            area,\n        },\n    };\n};\n//# sourceMappingURL=overhaul.js.map","export const defensesCatalog = {\n    barracks: {\n        key: 'barracks',\n        name: 'Barracks',\n        creditsCost: 5,\n        energyDelta: -1,\n        techPrereqs: [],\n        mappedType: 'defense_station',\n        weapon: 'laser',\n        attack: 4,\n        armour: 4,\n        shield: 0,\n        areaRequired: 1,\n    },\n    laser_turrets: {\n        key: 'laser_turrets',\n        name: 'Laser Turrets',\n        creditsCost: 10,\n        energyDelta: -1,\n        techPrereqs: [{ key: 'laser', level: 1 }],\n        mappedType: 'defense_station',\n        weapon: 'laser',\n        attack: 8,\n        armour: 8,\n        shield: 0,\n        areaRequired: 1,\n    },\n    missile_turrets: {\n        key: 'missile_turrets',\n        name: 'Missile Turrets',\n        creditsCost: 20,\n        energyDelta: -1,\n        techPrereqs: [{ key: 'missiles', level: 1 }],\n        mappedType: 'defense_station',\n        weapon: 'missiles',\n        attack: 16,\n        armour: 16,\n        shield: 0,\n        areaRequired: 1,\n    },\n    plasma_turrets: {\n        key: 'plasma_turrets',\n        name: 'Plasma Turrets',\n        creditsCost: 100,\n        energyDelta: -2,\n        techPrereqs: [\n            { key: 'plasma', level: 1 },\n            { key: 'armour', level: 6 },\n        ],\n        mappedType: 'defense_station',\n        weapon: 'plasma',\n        attack: 24,\n        armour: 24,\n        shield: 0,\n        areaRequired: 1,\n    },\n    ion_turrets: {\n        key: 'ion_turrets',\n        name: 'Ion Turrets',\n        creditsCost: 250,\n        energyDelta: -3,\n        techPrereqs: [\n            { key: 'ion', level: 1 },\n            { key: 'armour', level: 10 },\n            { key: 'shielding', level: 2 },\n        ],\n        mappedType: 'defense_station',\n        weapon: 'ion',\n        attack: 40,\n        armour: 40,\n        shield: 2,\n        areaRequired: 1,\n    },\n    photon_turrets: {\n        key: 'photon_turrets',\n        name: 'Photon Turrets',\n        creditsCost: 1000,\n        energyDelta: -4,\n        techPrereqs: [\n            { key: 'photon', level: 1 },\n            { key: 'armour', level: 14 },\n            { key: 'shielding', level: 6 },\n        ],\n        mappedType: 'defense_station',\n        weapon: 'photon',\n        attack: 80,\n        armour: 80,\n        shield: 6,\n        areaRequired: 1,\n    },\n    disruptor_turrets: {\n        key: 'disruptor_turrets',\n        name: 'Disruptor Turrets',\n        creditsCost: 4000,\n        energyDelta: -8,\n        techPrereqs: [\n            { key: 'disruptor', level: 1 },\n            { key: 'armour', level: 18 },\n            { key: 'shielding', level: 8 },\n        ],\n        mappedType: 'defense_station',\n        weapon: 'disruptor',\n        attack: 320,\n        armour: 320,\n        shield: 8,\n        areaRequired: 1,\n    },\n    deflection_shields: {\n        key: 'deflection_shields',\n        name: 'Deflection Shields',\n        creditsCost: 4000,\n        energyDelta: -8,\n        techPrereqs: [\n            { key: 'ion', level: 6 },\n            { key: 'shielding', level: 10 },\n        ],\n        mappedType: 'defense_station',\n        weapon: 'ion',\n        attack: 2,\n        armour: 640,\n        shield: 16,\n        areaRequired: 1,\n    },\n    planetary_shield: {\n        key: 'planetary_shield',\n        name: 'Planetary Shield',\n        creditsCost: 25000,\n        energyDelta: -16,\n        techPrereqs: [\n            { key: 'ion', level: 10 },\n            { key: 'shielding', level: 14 },\n        ],\n        mappedType: 'defense_station',\n        weapon: 'ion',\n        attack: 4,\n        armour: 2000,\n        shield: 20,\n        areaRequired: 1,\n    },\n    planetary_ring: {\n        key: 'planetary_ring',\n        name: 'Planetary Ring',\n        creditsCost: 50000,\n        energyDelta: -24,\n        techPrereqs: [\n            { key: 'photon', level: 10 },\n            { key: 'armour', level: 22 },\n            { key: 'shielding', level: 12 },\n        ],\n        mappedType: 'defense_station',\n        weapon: 'photon',\n        attack: 1600,\n        armour: 1000,\n        shield: 12,\n        areaRequired: 1,\n    },\n};\nexport function getDefensesList() {\n    return Object.values(defensesCatalog);\n}\n//# sourceMappingURL=defenses.js.map","// Units catalog and helpers for Phase A (tech-gated).\n// Values set to match provided screenshots for Units tab. UI reads these canonically.\n// Catalog populated per screenshots\nexport const unitsCatalog = {\n    fighter: {\n        key: 'fighter',\n        name: 'Fighter',\n        creditsCost: 5,\n        drive: 'Inter',\n        weapon: 'laser',\n        attack: 2,\n        armour: 2,\n        shield: 0,\n        hangar: -1,\n        speed: 0,\n        requiredShipyardLevel: 1,\n        techPrereqs: [{ key: 'laser', level: 1 }],\n        description: 'Good fighting unit against unshielded units.',\n    },\n    bomber: {\n        key: 'bomber',\n        name: 'Bomber',\n        creditsCost: 10,\n        drive: 'Inter',\n        weapon: 'missiles',\n        attack: 4,\n        armour: 2,\n        shield: 0,\n        hangar: -1,\n        speed: 0,\n        requiredShipyardLevel: 2,\n        techPrereqs: [{ key: 'missiles', level: 1 }],\n        description: 'Good fighting unit against unshielded and low shield units.',\n    },\n    heavy_bomber: {\n        key: 'heavy_bomber',\n        name: 'Heavy Bomber',\n        creditsCost: 30,\n        drive: 'Inter',\n        weapon: 'plasma',\n        attack: 10,\n        armour: 4,\n        shield: 0,\n        hangar: -2,\n        speed: 0,\n        requiredShipyardLevel: 3,\n        techPrereqs: [{ key: 'plasma', level: 14 }],\n        description: 'Good fighting unit against medium shielded units.',\n    },\n    ion_bomber: {\n        key: 'ion_bomber',\n        name: 'Ion Bomber',\n        creditsCost: 60,\n        drive: 'Inter',\n        weapon: 'ion',\n        attack: 12,\n        armour: 4,\n        shield: 1,\n        hangar: -2,\n        speed: 3,\n        techPrereqs: [\n            { key: 'ion', level: 10 },\n            { key: 'shielding', level: 10 },\n        ],\n        description: 'Good against high shielded units, 50% power cross shields.',\n    },\n    corvette: {\n        key: 'corvette',\n        name: 'Corvette',\n        creditsCost: 20,\n        drive: 'Stellar',\n        weapon: 'laser',\n        attack: 4,\n        armour: 4,\n        shield: 0,\n        hangar: 0,\n        speed: 10,\n        requiredShipyardLevel: 4,\n        techPrereqs: [\n            { key: 'laser', level: 2 },\n            { key: 'stellar_drive', level: 1 },\n            { key: 'armour', level: 2 },\n        ],\n        description: 'Very fast unit, good against unshielded units.',\n    },\n    recycler: {\n        key: 'recycler',\n        name: 'Recycler',\n        creditsCost: 30,\n        drive: 'Stellar*', // annotated as per screenshot\n        weapon: 'laser',\n        attack: 2,\n        armour: 2,\n        shield: 0,\n        hangar: 0,\n        speed: 8,\n        requiredShipyardLevel: 5,\n        techPrereqs: [\n            { key: 'laser', level: 1 },\n            { key: 'stellar_drive', level: 1 },\n            { key: 'armour', level: 2 },\n        ],\n        description: 'Can collect debris and convert them into credits.',\n    },\n    destroyer: {\n        key: 'destroyer',\n        name: 'Destroyer',\n        creditsCost: 40,\n        drive: 'Stellar',\n        weapon: 'plasma',\n        attack: 8,\n        armour: 8,\n        shield: 0,\n        hangar: 0,\n        speed: 8,\n        requiredShipyardLevel: 6,\n        techPrereqs: [\n            { key: 'plasma', level: 1 },\n            { key: 'stellar_drive', level: 2 },\n            { key: 'armour', level: 6 },\n        ],\n        description: 'Fast unit, good against low shielded units.',\n    },\n    frigate: {\n        key: 'frigate',\n        name: 'Frigate',\n        creditsCost: 80,\n        drive: 'Stellar',\n        weapon: 'missiles',\n        attack: 12,\n        armour: 12,\n        shield: 0,\n        hangar: 4,\n        speed: 6,\n        requiredShipyardLevel: 8,\n        techPrereqs: [\n            { key: 'missiles', level: 6 },\n            { key: 'stellar_drive', level: 4 },\n            { key: 'armour', level: 8 },\n        ],\n        description: 'Versatile unit, has 4 hangar space.',\n    },\n    ion_frigate: {\n        key: 'ion_frigate',\n        name: 'Ion Frigate',\n        creditsCost: 120,\n        drive: 'Stellar',\n        weapon: 'ion',\n        attack: 14,\n        armour: 12,\n        shield: 1,\n        hangar: 4,\n        speed: 6,\n        requiredShipyardLevel: 8,\n        techPrereqs: [\n            { key: 'ion', level: 10 },\n            { key: 'stellar_drive', level: 4 },\n            { key: 'armour', level: 8 },\n            { key: 'shielding', level: 10 },\n        ],\n        description: 'Versatile unit, 50% power cross shields.',\n    },\n    scout_ship: {\n        key: 'scout_ship',\n        name: 'Scout Ship',\n        creditsCost: 40,\n        drive: 'Warp',\n        weapon: 'laser',\n        attack: 1,\n        armour: 2,\n        shield: 0,\n        hangar: 0,\n        speed: 12,\n        requiredShipyardLevel: 4,\n        techPrereqs: [{ key: 'warp_drive', level: 1 }],\n        description: 'Faster ship, good for scouting.',\n    },\n    outpost_ship: {\n        key: 'outpost_ship',\n        name: 'Outpost Ship',\n        creditsCost: 100,\n        drive: 'Warp',\n        weapon: 'laser',\n        attack: 2,\n        armour: 4,\n        shield: 0,\n        hangar: 0,\n        speed: 4,\n        requiredShipyardLevel: 8,\n        techPrereqs: [{ key: 'warp_drive', level: 1 }],\n        description: 'Warp unit that can build a new base.',\n    },\n    cruiser: {\n        key: 'cruiser',\n        name: 'Cruiser',\n        creditsCost: 200,\n        drive: 'Warp',\n        weapon: 'plasma',\n        attack: 24,\n        armour: 24,\n        shield: 2,\n        hangar: 4,\n        speed: 5,\n        requiredShipyardLevel: 10,\n        techPrereqs: [\n            { key: 'plasma', level: 4 },\n            { key: 'warp_drive', level: 2 },\n            { key: 'armour', level: 10 },\n            { key: 'shielding', level: 2 },\n        ],\n        description: 'Versatile unit, good for long range action and escort.',\n    },\n    carrier: {\n        key: 'carrier',\n        name: 'Carrier',\n        creditsCost: 400,\n        drive: 'Warp',\n        weapon: 'missiles',\n        attack: 12,\n        armour: 24,\n        shield: 2,\n        hangar: 80,\n        speed: 5,\n        requiredShipyardLevel: 12,\n        techPrereqs: [\n            { key: 'missiles', level: 6 },\n            { key: 'warp_drive', level: 4 },\n            { key: 'armour', level: 10 },\n            { key: 'shielding', level: 2 },\n        ],\n        description: 'Unit with 80 hangar spaces.',\n    },\n    heavy_cruiser: {\n        key: 'heavy_cruiser',\n        name: 'Heavy Cruiser',\n        creditsCost: 500,\n        drive: 'Warp',\n        weapon: 'plasma',\n        attack: 48,\n        armour: 48,\n        shield: 4,\n        hangar: 8,\n        speed: 4,\n        requiredShipyardLevel: 12,\n        techPrereqs: [\n            { key: 'plasma', level: 6 },\n            { key: 'warp_drive', level: 4 },\n            { key: 'armour', level: 12 },\n            { key: 'shielding', level: 4 },\n        ],\n        description: 'Strong unit, good against large units.',\n    },\n    battleship: {\n        key: 'battleship',\n        name: 'Battleship',\n        creditsCost: 2000,\n        drive: 'Warp',\n        weapon: 'ion',\n        attack: 168,\n        armour: 128,\n        shield: 10,\n        hangar: 40,\n        speed: 4,\n        requiredShipyardLevel: 16,\n        techPrereqs: [\n            { key: 'ion', level: 6 },\n            { key: 'warp_drive', level: 8 },\n            { key: 'armour', level: 16 },\n            { key: 'shielding', level: 8 },\n        ],\n        description: 'Strong unit, good against large units.',\n    },\n    fleet_carrier: {\n        key: 'fleet_carrier',\n        name: 'Fleet Carrier',\n        creditsCost: 2500,\n        drive: 'Warp',\n        weapon: 'ion',\n        attack: 64,\n        armour: 96,\n        shield: 8,\n        hangar: 500,\n        speed: 4,\n        requiredShipyardLevel: 16,\n        techPrereqs: [\n            { key: 'ion', level: 4 },\n            { key: 'warp_drive', level: 8 },\n            { key: 'armour', level: 14 },\n            { key: 'shielding', level: 6 },\n        ],\n        description: 'Large carrier with 500 hangar spaces.',\n    },\n    dreadnought: {\n        key: 'dreadnought',\n        name: 'Dreadnought',\n        creditsCost: 10000,\n        drive: 'Warp',\n        weapon: 'photon',\n        attack: 756,\n        armour: 512,\n        shield: 20,\n        hangar: 200,\n        speed: 3,\n        requiredShipyardLevel: 20,\n        requiredOrbitalShipyardLevel: 1,\n        techPrereqs: [\n            { key: 'photon', level: 6 },\n            { key: 'warp_drive', level: 12 },\n            { key: 'armour', level: 20 },\n            { key: 'shielding', level: 10 },\n        ],\n        description: 'Very strong combat unit.',\n    },\n    titan: {\n        key: 'titan',\n        name: 'Titan',\n        creditsCost: 50000,\n        drive: 'Warp',\n        weapon: 'disruptor',\n        attack: 3500,\n        armour: 2048,\n        shield: 30,\n        hangar: 1000,\n        speed: 3,\n        requiredShipyardLevel: 22,\n        requiredOrbitalShipyardLevel: 3,\n        techPrereqs: [\n            { key: 'disruptor', level: 6 },\n            { key: 'warp_drive', level: 14 },\n            { key: 'armour', level: 22 },\n            { key: 'shielding', level: 14 },\n        ],\n        description: 'Very large and strong combat unit.',\n    },\n    leviathan: {\n        key: 'leviathan',\n        name: 'Leviathan',\n        creditsCost: 200000,\n        drive: 'Warp',\n        weapon: 'photon',\n        attack: 10000,\n        armour: 6600,\n        shield: 40,\n        hangar: 4000,\n        speed: 2,\n        requiredShipyardLevel: 24,\n        requiredOrbitalShipyardLevel: 5,\n        techPrereqs: [\n            { key: 'photon', level: 12 },\n            { key: 'warp_drive', level: 18 },\n            { key: 'armour', level: 24 },\n            { key: 'shielding', level: 16 },\n        ],\n        description: 'Huge combat unit, gives +5% power and armour to fleet.',\n    },\n    death_star: {\n        key: 'death_star',\n        name: 'Death Star',\n        creditsCost: 500000,\n        drive: 'Warp',\n        weapon: 'disruptor',\n        attack: 26500,\n        armour: 14000,\n        shield: 60,\n        hangar: 10000,\n        speed: 2,\n        requiredShipyardLevel: 26,\n        requiredOrbitalShipyardLevel: 7,\n        techPrereqs: [\n            { key: 'disruptor', level: 10 },\n            { key: 'warp_drive', level: 20 },\n            { key: 'armour', level: 26 },\n            { key: 'shielding', level: 18 },\n        ],\n        description: 'Biggest unit, cant use jump gates, gives +10% power and armour to fleet.',\n    },\n};\nexport function getUnitsList() {\n    return Object.values(unitsCatalog);\n}\nexport function getUnitSpec(key) {\n    return unitsCatalog[key];\n}\n//# sourceMappingURL=units.js.map","// Canonical per-level structure credit costs (authoritative shared source).\n// These tables are progressively migrated from client-level display tables\n// to ensure both client and server use identical upgrade costs.\n//\n// Conventions:\n// - Level is 1-based: level 1 means first construction from level 0 -> 1.\n// - If a table isn't present for a key and level === 1, we fall back to the\n//   BuildingSpec.creditsCost (Phase A behavior).\n// - If a table isn't present for a key and level > 1, we currently throw to\n//   avoid inventing a non-canonical formula. Add the table here to enable upgrades.\nimport { getBuildingSpec } from './buildings';\nconst LEVEL_CREDITS = {\n    // Urban Structures: Level -> Credits\n    urban_structures: [\n        1, 2, 3, 4, 6, 8, 12, 18, 26, 39, 58, 87, 130, 195, 292, 438, 657, 986, 1478, 2217,\n    ],\n    // Solar Plants: Level -> Credits\n    solar_plants: [\n        1, 2, 3, 4, 6, 8, 12, 18, 26, 39, 58, 87, 130,\n    ],\n    // Gas Plants: Level -> Credits\n    gas_plants: [\n        1, 2, 3, 4, 6, 8, 12, 18, 26, 39, 58, 87, 130, 195,\n    ],\n    // Metal Refineries: Level -> Credits\n    metal_refineries: [\n        1, 2, 3, 4, 6, 8, 12, 18, 26, 39, 58, 87, 130, 195, 292, 438, 657, 986, 1478, 2217, 3326,\n    ],\n    // Fusion Plants: Level -> Credits\n    fusion_plants: [\n        20, 30, 45, 68, 102, 152, 228, 342, 513, 769, 1154, 1730, 2595, 3893, 5839, 8758, 13137, 19706, 29558,\n    ],\n    // Research Labs: Level -> Credits\n    research_labs: [\n        2, 3, 5, 7, 11, 16, 23, 35, 52, 77, 116, 173, 260, 390, 584, 876, 1314, 1971, 2956, 4434, 6651, 9976, 14944, 22446, 33669, 50503, 75754, 113631, 170446, 255669,\n    ],\n    // Robotic Factories: Level -> Credits\n    robotic_factories: [\n        5, 8, 12, 17, 26, 38, 57, 86, 129, 193, 289, 433, 649, 974, 1460, 2190, 3285,\n    ],\n    // Shipyards: Level -> Credits\n    shipyards: [\n        5, 8, 12, 17, 26, 38, 57, 86, 129, 193, 289, 433, 649, 974, 1460, 2190, 3285, 4927, 7390, 11085, 16627, 24940, 37410, 56114, 84171, 126256, 189384, 284076, 426114,\n    ],\n    // Orbital Shipyards: Level -> Credits\n    orbital_shipyards: [\n        10000, 15000, 22500, 33750, 50625, 75938, 113907, 170860, 256290,\n    ],\n    // Spaceports: Level -> Credits\n    spaceports: [\n        5, 8, 12, 17, 26, 38, 57, 86, 129, 193, 289, 433, 649, 974, 1460, 2190, 3285, 4927, 7390, 11085,\n    ],\n    // Command Centers: Level -> Credits\n    command_centers: [\n        20, 30, 45, 68, 102, 152, 228, 342, 513, 769, 1154, 1730, 2595, 3893,\n    ],\n    // Android Factories: Level -> Credits\n    android_factories: [\n        1000, 1500, 2250, 3375, 5063, 7594, 11391, 17086, 25629, 38444, 57666, 86498,\n    ],\n    // Economic Centers: Level -> Credits\n    economic_centers: [\n        80, 120, 180, 270, 405, 608, 912, 1367, 2051, 3076, 4614, 6920, 10380,\n    ],\n    // Terraform: Level -> Credits\n    terraform: [\n        80, 120, 180, 270, 405, 608, 912, 1367, 2051, 3076, 4614, 6920, 10380,\n    ],\n    // Multi-Level Platforms: Level -> Credits\n    multi_level_platforms: [\n        10000, 15000, 22500, 33750, 50625, 75938, 113907, 170860, 256290, 384434, 576651,\n    ],\n    // Orbital Base: Level -> Credits\n    orbital_base: [\n        2000, 3000, 4500, 6750, 10125, 15188, 22782, 34172, 51258,\n    ],\n    // Crystal Mines: Level -> Credits\n    crystal_mines: [\n        2, 3, 5, 7, 11, 16, 23, 35,\n    ],\n    // Antimatter Plants: Level -> Credits\n    antimatter_plants: [\n        2000, 3000, 4500, 6750, 10125, 15188, 22782, 34172, 51258,\n    ],\n    // Orbital Plants: Level -> Credits\n    orbital_plants: [\n        40000, 60000, 90000, 135000, 202500, 303750, 455625, 683438, 1025157,\n    ],\n    // Nanite Factories: Level -> Credits (matches economic/terraform sequence)\n    nanite_factories: [\n        80, 120, 180, 270, 405, 608, 912, 1367, 2051, 3076, 4614, 6920, 10380,\n    ],\n    // Jump Gate: Level -> Credits\n    jump_gate: [\n        5000, 7500, 11250, 16875, 25313, 37970, 56955, 85433, 128150,\n    ],\n    // Biosphere Modification: Level -> Credits\n    biosphere_modification: [\n        20000, 30000, 45000, 67500, 101250, 151875, 227813, 341720, 512580,\n    ],\n    // Capital: Level -> Credits\n    capital: [\n        15000, 22500, 33750, 50625, 75938, 113907, 170861, 256292, 384438,\n    ],\n};\n/**\n * Returns the canonical credits cost for constructing or upgrading a structure\n * to the target level. If the current level is N, the next level is N+1 and\n * this function should be called with level = N+1.\n *\n * Behavior:\n * - If a per-level table exists for the building key and covers the level,\n *   returns that value.\n * - If no table exists but level === 1, falls back to BuildingSpec.creditsCost.\n * - Otherwise throws an Error to indicate the upgrade cost is undefined.\n */\nexport function getStructureCreditCostForLevel(key, level) {\n    if (!Number.isFinite(level) || level <= 0) {\n        throw new Error(`Invalid level ${level} for building ${key}`);\n    }\n    const table = LEVEL_CREDITS[key];\n    if (table && level <= table.length) {\n        const cost = table[level - 1];\n        if (Number.isFinite(cost) && cost >= 0)\n            return cost;\n    }\n    // Fallback for level 1 when no table is present: use spec.creditsCost\n    if (level === 1) {\n        const spec = getBuildingSpec(key);\n        const cost = Number(spec?.creditsCost ?? NaN);\n        if (Number.isFinite(cost) && cost >= 0)\n            return cost;\n    }\n    throw new Error(`No canonical cost defined for ${key} at level ${level}`);\n}\n/**\n * Utility to check if a given key/level combination has a canonical cost defined.\n * Useful for gating upgrade UI or returning a cleaner server error before attempting to charge.\n */\nexport function hasCanonicalStructureCostForLevel(key, level) {\n    try {\n        getStructureCreditCostForLevel(key, level);\n        return true;\n    }\n    catch {\n        return false;\n    }\n}\n//# sourceMappingURL=structureLevels.js.map","/**\n * Shared Energy Budget helper\n *\n * Single source of truth for computing energy production/consumption/balance and queued reservations.\n * Mirrors server semantics currently implemented in StructuresService.start:\n *  - Baseline +2 per base\n *  - Solar plants: +level  solarEnergy\n *  - Gas plants: +level  gasYield\n *  - Other buildings: BuildingSpec.energyDelta per level (>=0 -> produced, <0 -> consumed)\n *  - Reservations: include only queued/inactive negative items (consumers) and DO NOT pre-count queued producers\n *\n * Important parity note:\n *  - For reservedNegative, the current server sums the catalog delta (d) for queued items directly, without multiplying by level\n *    (each queue entry represents a single upgrade step). We preserve that parity here to avoid UI/server drift.\n */\nimport { getBuildingSpec } from \"./buildings\";\n/**\n * Computes the energy budget according to canonical rules and current server behavior.\n */\nexport function computeEnergyBalance(input) {\n    const { buildingsAtBase, location, includeQueuedReservations = true, baseline = 2, } = input;\n    const solarEnergy = Math.max(0, Number(location?.solarEnergy ?? 0));\n    const gasYield = Math.max(0, Number(location?.gasYield ?? 0));\n    let produced = baseline; // innate baseline per base\n    let consumed = 0;\n    // Active buildings contribute to produced/consumed\n    for (const b of buildingsAtBase || []) {\n        if (!b?.isActive)\n            continue;\n        const key = String(b.key);\n        const level = Math.max(1, Number(b.level || 1));\n        if (key === \"solar_plants\") {\n            produced += level * solarEnergy;\n            continue;\n        }\n        if (key === \"gas_plants\") {\n            produced += level * gasYield;\n            continue;\n        }\n        const spec = safeGetSpec(key);\n        const d = Number(spec?.energyDelta || 0);\n        if (d >= 0)\n            produced += level * d;\n        else\n            consumed += level * Math.abs(d);\n    }\n    // Queued reservations (only negative deltas; do not pre-count producers)\n    let reservedNegative = 0;\n    if (includeQueuedReservations) {\n        for (const b of buildingsAtBase || []) {\n            if (!b?.isQueuedConsumer)\n                continue;\n            const key = String(b.key);\n            const spec = safeGetSpec(key);\n            const d = Number(spec?.energyDelta || 0);\n            // Preserve server parity: do NOT multiply by level for reservation\n            if (d < 0) {\n                reservedNegative += d; // d is negative\n            }\n        }\n    }\n    const balance = produced - consumed;\n    return { produced, consumed, balance, reservedNegative };\n}\n/**\n * Start feasibility rule:\n *  - Producers (delta >= 0) are always allowed.\n *  - Consumers (delta < 0) only if balance + reservedNegative + delta >= 0.\n */\nexport function canStartWithDelta(args) {\n    const { balance, reservedNegative, delta } = args;\n    if (delta >= 0)\n        return true;\n    const projectedEnergy = balance + reservedNegative + delta;\n    return projectedEnergy >= 0;\n}\nfunction safeGetSpec(key) {\n    try {\n        return getBuildingSpec(key);\n    }\n    catch {\n        // Unknown/missing spec: treat as neutral\n        return undefined;\n    }\n}\n//# sourceMappingURL=energyBudget.js.map","import axios from 'axios';\r\nimport { ApiResponse } from '@game/shared';\r\nimport { attachMetrics } from './httpInstrumentation';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\n// Create axios instance with default config (mirrors authService)\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n});\r\nattachMetrics(api, 'universe');\r\n\r\n// Add auth token to requests\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem('auth-storage');\r\n  if (token) {\r\n    try {\r\n      const parsed = JSON.parse(token);\r\n      if (parsed.state?.token) {\r\n        (config.headers as any).Authorization = `Bearer ${parsed.state.token}`;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error parsing auth token:', error);\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\n// Handle auth errors\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem('auth-storage');\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// Types for universe API\r\nexport interface UniverseLocationData {\r\n  coord: string;\r\n  type: 'planet' | 'asteroid' | 'star';\r\n  starProperties?: {\r\n    spectralClass: 'O' | 'B' | 'A' | 'F' | 'G' | 'K' | 'M';\r\n    color: string;\r\n    temperatureK: number;\r\n    massSolar: number;\r\n    luminositySolar: number;\r\n    effects?: {\r\n      fertilityMultiplier?: number;\r\n      energyMultiplier?: number;\r\n      researchMultiplier?: number;\r\n    };\r\n  };\r\n  orbitPosition?: number;\r\n  terrain?: {\r\n    type: string;\r\n    baseline: {\r\n      metal: number;\r\n      gas: number;\r\n      crystals: number;\r\n      fertility: number;\r\n      areaPlanet?: number;\r\n      areaMoon?: number;\r\n    };\r\n  };\r\n  positionBase?: { solarEnergy: number; fertility: number };\r\n  starApplied?: {\r\n    solarEnergyDelta: number;\r\n    fertilityDelta: number;\r\n    resourceDelta: { metal: number; gas: number; crystals: number };\r\n  };\r\n  result?: {\r\n    solarEnergy: number;\r\n    fertility: number;\r\n    yields: { metal: number; gas: number; crystals: number };\r\n    area?: number;\r\n  };\r\n  starOverhaul?: {\r\n    kind: 'RED_GIANT' | 'SUPER_GIANT' | 'BLUE' | 'NEUTRON' | 'WHITE' | 'WHITE_DWARF' | 'ORANGE' | 'YELLOW';\r\n    orbitModifiers?: Array<{\r\n      position: number;\r\n      solarEnergyDelta: number;\r\n      fertilityDelta: number;\r\n      resourceDelta: { metal: number; gas: number; crystals: number };\r\n    }>;\r\n    notes?: string;\r\n  };\r\n  owner: { id: string; username: string } | null;\r\n  context?: {\r\n    server: string;\r\n    galaxy: number;\r\n    region: number;\r\n    system: number;\r\n    body: number;\r\n  };\r\n  createdAt?: string;\r\n}\r\n\r\nexport interface UniverseSystemBodiesData {\r\n  system: {\r\n    server: string;\r\n    galaxy: number;\r\n    region: number;\r\n    system: number;\r\n  };\r\n  bodies: Array<{\r\n    coord: string;\r\n    type: 'planet' | 'asteroid' | 'star';\r\n    owner: UniverseLocationData['owner'];\r\n    // Overhaul fields (optional)\r\n    orbitPosition?: number;\r\n    terrain?: UniverseLocationData['terrain'];\r\n    positionBase?: UniverseLocationData['positionBase'];\r\n    starApplied?: UniverseLocationData['starApplied'];\r\n    result?: UniverseLocationData['result'];\r\n    starOverhaul?: UniverseLocationData['starOverhaul'];\r\n  }>;\r\n}\r\n\r\nexport interface UniverseRegionSystemsData {\r\n  region: {\r\n    server: string;\r\n    galaxy: number;\r\n    region: number;\r\n  };\r\n  systems: Array<{\r\n    system: number;\r\n    coord: string;\r\n    star: { spectralClass: 'O' | 'B' | 'A' | 'F' | 'G' | 'K' | 'M'; color: string } | null;\r\n    hasOwned: boolean;\r\n  }>;\r\n}\r\n\r\nexport interface GalaxyRegionSummariesData {\r\n  server: string;\r\n  galaxy: number;\r\n  regions: Array<{\r\n    region: number;\r\n    systemsWithStars: number[];\r\n  }>;\r\n}\r\n\r\nexport interface GalaxyRegionStarColorsData {\r\n  server: string;\r\n  galaxy: number;\r\n  regions: Array<{\r\n    region: number;\r\n    systems: Array<{ system: number; color: string }>;\r\n  }>;\r\n}\r\n\r\n/**\r\n * Lightweight in-flight dedupe and short TTL cache for GETs.\r\n */\r\nconst inFlightByUrl = new Map<string, Promise<ApiResponse<any>>>();\r\nconst resultCache = new Map<string, { ts: number; data: ApiResponse<any> }>();\r\nconst CACHE_TTL_MS = 3000;\r\n\r\nasync function getWithDedupe<T>(url: string): Promise<ApiResponse<T>> {\r\n  const now = Date.now();\r\n\r\n  const cached = resultCache.get(url);\r\n  if (cached && now - cached.ts < CACHE_TTL_MS) {\r\n    return cached.data as ApiResponse<T>;\r\n  }\r\n\r\n  const existing = inFlightByUrl.get(url);\r\n  if (existing) {\r\n    return (await existing) as ApiResponse<T>;\r\n  }\r\n\r\n  const p = (async () => {\r\n    try {\r\n      const response = await api.get<ApiResponse<T>>(url);\r\n      const data = response.data;\r\n      if (data && data.success) {\r\n        resultCache.set(url, { ts: Date.now(), data });\r\n      }\r\n      return data;\r\n    } catch (error) {\r\n      if (axios.isAxiosError(error) && error.response) {\r\n        return error.response.data as ApiResponse<T>;\r\n      }\r\n      throw new Error('Network error occurred');\r\n    } finally {\r\n      inFlightByUrl.delete(url);\r\n    }\r\n  })();\r\n\r\n  inFlightByUrl.set(url, p);\r\n  return (await p) as ApiResponse<T>;\r\n}\r\n\r\nexport const universeService = {\r\n  async getLocationByCoord(coord: string): Promise<ApiResponse<UniverseLocationData>> {\r\n    const url = `/universe/coord/${encodeURIComponent(coord)}`;\r\n    return await getWithDedupe<UniverseLocationData>(url);\r\n  },\r\n\r\n  async getSystemBodies(server: string, galaxy: number, region: number, system: number): Promise<ApiResponse<UniverseSystemBodiesData>> {\r\n    const url = `/universe/system/${encodeURIComponent(server)}/${galaxy}/${region}/${system}`;\r\n    return await getWithDedupe<UniverseSystemBodiesData>(url);\r\n  },\r\n\r\n  async getGalaxyRegionSummaries(server: string, galaxy: number): Promise<ApiResponse<GalaxyRegionSummariesData>> {\r\n    const url = `/universe/galaxy/${encodeURIComponent(server)}/${galaxy}/regions`;\r\n    return await getWithDedupe<GalaxyRegionSummariesData>(url);\r\n  },\r\n  async getGalaxyRegionStarColors(server: string, galaxy: number): Promise<ApiResponse<GalaxyRegionStarColorsData>> {\r\n    const url = `/universe/galaxy/${encodeURIComponent(server)}/${galaxy}/region-stars`;\r\n    return await getWithDedupe<GalaxyRegionStarColorsData>(url);\r\n  },\r\n  async getRegionSystems(server: string, galaxy: number, region: number): Promise<ApiResponse<UniverseRegionSystemsData>> {\r\n    const url = `/universe/region/${encodeURIComponent(server)}/${galaxy}/${region}`;\r\n    return await getWithDedupe<UniverseRegionSystemsData>(url);\r\n  }\r\n};\r\n\r\nexport default universeService;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Empire, getColonizationCost } from '@game/shared';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useModalStore } from '../../stores/modalStore';\r\nimport universeService, { UniverseLocationData } from '../../services/universeService';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\n\r\ninterface Territory {\r\n  coord: string;\r\n  type: 'planet' | 'asteroid';\r\n  result?: {\r\n    fertility: number;\r\n    solarEnergy: number;\r\n    yields: {\r\n      metal: number;\r\n      gas: number;\r\n      crystals: number;\r\n    };\r\n  };\r\n  owner: string;\r\n}\r\n\r\ninterface GalaxyModalProps {\r\n  empire: Empire;\r\n  onUpdate: () => void;\r\n}\r\n\r\nconst GalaxyModal: React.FC<GalaxyModalProps> = ({ empire, onUpdate }) => {\r\n  const [activeTab, setActiveTab] = useState<'territories' | 'explore' | 'colonize' | 'map'>('map');\r\n  const [territories, setTerritories] = useState<Territory[]>([]);\r\n  const [coordinateInput, setCoordinateInput] = useState('');\r\n  const [locationData, setLocationData] = useState<UniverseLocationData | null>(null);\r\n  const [colonyName, setColonyName] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Get progressive colonization cost based on empire base count\r\n  const colonizationCostCredits = getColonizationCost(empire.baseCount || 0, empire.hasDeletedBase || false);\r\n\r\n  // Create authenticated API instance\r\n  const createAuthenticatedApi = () => {\r\n    const api = axios.create({\r\n      baseURL: API_BASE_URL,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n\r\n    api.interceptors.request.use((config) => {\r\n      const token = localStorage.getItem('auth-storage');\r\n      if (token) {\r\n        try {\r\n          const parsed = JSON.parse(token);\r\n          if (parsed.state?.token) {\r\n            config.headers.Authorization = `Bearer ${parsed.state.token}`;\r\n          }\r\n        } catch (error) {\r\n          console.error('Error parsing auth token:', error);\r\n        }\r\n      }\r\n      return config;\r\n    });\r\n\r\n    return api;\r\n  };\r\n\r\n  const api = createAuthenticatedApi();\r\n  const navigate = useNavigate();\r\n  const { closeModal } = useModalStore();\r\n\r\n  // Fetch empire territories\r\n  const fetchTerritories = async () => {\r\n    try {\r\n      const response = await api.get('/game/territories');\r\n      if (response.data.success) {\r\n        setTerritories(response.data.data.territories);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching territories:', err);\r\n      setError('Failed to load territories');\r\n    }\r\n  };\r\n\r\n  // Search for location\r\n  const handleLocationSearch = async () => {\r\n    const coord = coordinateInput.trim().toUpperCase();\r\n    if (!coord) {\r\n      setError('Please enter a coordinate');\r\n      return;\r\n    }\r\n    const isValid = /^[A-Z]\\d{2}:\\d{2}:\\d{2}:\\d{2}$/.test(coord);\r\n    if (!isValid) {\r\n      setError('Invalid coordinate format. Use A00:10:22:10');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n    setLocationData(null);\r\n\r\n    try {\r\n      const resp = await universeService.getLocationByCoord(coord);\r\n      if (resp.success && resp.data) {\r\n        setLocationData(resp.data);\r\n      } else {\r\n        setLocationData(null);\r\n        setError(resp.error || 'Location not found');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || 'Network error. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Colonize location\r\n  const handleColonize = async () => {\r\n    if (!locationData) {\r\n      setError('No location selected');\r\n      return;\r\n    }\r\n\r\n    if (!colonyName.trim()) {\r\n      setError('Please enter a colony name');\r\n      return;\r\n    }\r\n\r\n    if (locationData.owner) {\r\n      setError('Location is already owned');\r\n      return;\r\n    }\r\n\r\n    // Check if empire can afford colonization (credits only)\r\n    const canAfford = empire.resources.credits >= colonizationCostCredits;\r\n\r\n    if (!canAfford) {\r\n      setError('Insufficient resources for colonization');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await api.post('/game/territories/colonize', {\r\n        locationCoord: locationData.coord,\r\n        colonyName: colonyName.trim()\r\n      });\r\n\r\n      if (response.data.success) {\r\n        await fetchTerritories();\r\n        onUpdate(); // Update dashboard\r\n        setActiveTab('territories');\r\n        setLocationData(null);\r\n        setColonyName('');\r\n        setCoordinateInput('');\r\n      } else {\r\n        setError(response.data.error || 'Failed to colonize location');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || 'Network error. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Generate random coordinate for exploration\r\n  const generateRandomCoordinate = () => {\r\n    const servers = ['A', 'B', 'C'];\r\n    const server = servers[Math.floor(Math.random() * servers.length)];\r\n    const galaxy = Math.floor(Math.random() * 10).toString().padStart(2, '0');\r\n    const region = Math.floor(Math.random() * 100).toString().padStart(2, '0');\r\n    const system = Math.floor(Math.random() * 100).toString().padStart(2, '0');\r\n    const body = Math.floor(Math.random() * 20).toString().padStart(2, '0');\r\n    \r\n    return `${server}${galaxy}:${region}:${system}:${body}`;\r\n  };\r\n\r\n  // Get location type icon\r\n  const getLocationIcon = (type: string) => {\r\n    return type === 'planet' ? '' : '';\r\n  };\r\n\r\n  // Get fertility color\r\n  const getFertilityColor = (fertility: number) => {\r\n    if (fertility >= 8) return 'text-green-400';\r\n    if (fertility >= 6) return 'text-yellow-400';\r\n    if (fertility >= 4) return 'text-orange-400';\r\n    return 'text-red-400';\r\n  };\r\n\r\n  // Get resource quality color\r\n  const getResourceColor = (value: number) => {\r\n    if (value >= 8) return 'text-green-400';\r\n    if (value >= 6) return 'text-yellow-400';\r\n    if (value >= 4) return 'text-orange-400';\r\n    return 'text-red-400';\r\n  };\r\n\r\n  // Check if empire can afford colonization (credits only)\r\n  const canAffordColonization = () => {\r\n    return empire.resources.credits >= colonizationCostCredits;\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchTerritories();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Tab Navigation */}\r\n      <div className=\"flex space-x-1 bg-gray-700 p-1 rounded-lg\">\r\n        <button\r\n          onClick={() => {\r\n            closeModal();\r\n            navigate('/galaxy');\r\n          }}\r\n          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n            activeTab === 'map'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n          }`}\r\n        >\r\n           Universe Map\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('territories')}\r\n          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n            activeTab === 'territories'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n          }`}\r\n        >\r\n           My Territories\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('explore')}\r\n          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n            activeTab === 'explore'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n          }`}\r\n        >\r\n           Explore\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('colonize')}\r\n          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${\r\n            activeTab === 'colonize'\r\n              ? 'bg-blue-600 text-white'\r\n              : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n          }`}\r\n        >\r\n           Colonize\r\n        </button>\r\n      </div>\r\n\r\n      {/* Error Display */}\r\n      {error && (\r\n        <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* Tab Content */}\r\n\r\n      {activeTab === 'territories' && (\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-white\">Empire Territories</h3>\r\n          \r\n          <div className=\"p-3 bg-gray-700 rounded-lg border border-gray-600\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-gray-300\">Total Territories:</span>\r\n              <span className=\"text-blue-400 font-mono text-lg\">\r\n                {territories.length}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          {territories.length === 0 ? (\r\n            <p className=\"text-gray-400\">No territories found. Start exploring to find new worlds to colonize!</p>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {territories.map((territory) => (\r\n                <div key={territory.coord} className=\"p-4 bg-gray-700 rounded-lg border border-gray-600\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <h4 className=\"font-medium text-white flex items-center gap-2\">\r\n                      {getLocationIcon(territory.type)} {territory.coord}\r\n                    </h4>\r\n                    <span className=\"text-xs px-2 py-1 bg-blue-600 text-white rounded capitalize\">\r\n                      {territory.type}\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                    <div>\r\n                      <span className=\"text-gray-400\">Fertility:</span>\r\n                      <div className={`font-mono ${getFertilityColor(territory.result?.fertility || 0)}`}>\r\n                        {territory.result?.fertility || ''}/10\r\n                      </div>\r\n                    </div>\r\n                    <div>\r\n                      <span className=\"text-gray-400\">Solar Energy:</span>\r\n                      <div className={`font-mono ${getResourceColor(territory.result?.solarEnergy || 0)}`}>\r\n                        {territory.result?.solarEnergy || ''}/10\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {activeTab === 'explore' && (\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-white\">Galaxy Explorer</h3>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-2 text-gray-300\">\r\n                Enter Coordinate (Format: A00:10:22:10)\r\n              </label>\r\n              <div className=\"flex gap-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={coordinateInput}\r\n                  onChange={(e) => setCoordinateInput(e.target.value.toUpperCase())}\r\n                  placeholder=\"A00:10:22:10\"\r\n                  className=\"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  maxLength={12}\r\n                />\r\n                <button\r\n                  onClick={handleLocationSearch}\r\n                  disabled={loading || !coordinateInput.trim()}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  {loading ? 'Searching...' : 'Explore'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={() => setCoordinateInput(generateRandomCoordinate())}\r\n                className=\"px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 text-sm\"\r\n              >\r\n                 Random Location\r\n              </button>\r\n              <button\r\n                onClick={() => setCoordinateInput(empire.homeSystem || '')}\r\n                className=\"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm\"\r\n              >\r\n                 Home System\r\n              </button>\r\n            </div>\r\n            \r\n            {locationData && (\r\n              <div className=\"p-4 bg-gray-700 rounded-lg border border-gray-600\">\r\n                <h4 className=\"font-semibold mb-3 text-blue-400 flex items-center gap-2\">\r\n                  {getLocationIcon(locationData.type)} Location Details\r\n                </h4>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4\">\r\n                  <div>\r\n                    <p><span className=\"text-gray-400\">Coordinate:</span> {locationData.coord}</p>\r\n                    <p><span className=\"text-gray-400\">Type:</span> <span className=\"capitalize\">{locationData.type}</span></p>\r\n                    <p>\r\n                      <span className=\"text-gray-400\">Fertility:</span> \r\n                      <span className=\"ml-1 text-gray-200\">\r\n                        {locationData.result?.fertility ?? ''}\r\n                      </span>\r\n                    </p>\r\n                    <p>\r\n                      <span className=\"text-gray-400\">Owner:</span> \r\n                      <span className={locationData.owner ? 'text-red-400' : 'text-green-400'}>\r\n                        {locationData.owner ? locationData.owner.username : 'Unowned'}\r\n                      </span>\r\n                    </p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-gray-400 mb-1\">Overhaul:</p>\r\n                    <p className=\"text-gray-200\">\r\n                      Terrain: {locationData.terrain?.type ?? ''}\r\n                    </p>\r\n                    <p className=\"text-gray-200\">\r\n                      Orbit Pos: {locationData.orbitPosition ?? ''}\r\n                    </p>\r\n                    <p className=\"text-gray-200\">\r\n                      Solar Energy: {locationData.result?.solarEnergy ?? ''}\r\n                    </p>\r\n                    {locationData.result?.yields && (\r\n                      <p className=\"text-gray-200\">\r\n                        Yields (M/G/C): {locationData.result.yields.metal}/{locationData.result.yields.gas}/{locationData.result.yields.crystals}\r\n                      </p>\r\n                    )}\r\n                    {typeof locationData.result?.area === 'number' && (\r\n                      <p className=\"text-gray-200\">Area: {locationData.result.area}</p>\r\n                    )}\r\n                    {locationData.starOverhaul?.kind && (\r\n                      <p className=\"text-yellow-300\">Star Kind: {locationData.starOverhaul.kind}</p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                \r\n                {locationData.context && (\r\n                  <div className=\"text-xs text-gray-400 border-t border-gray-600 pt-3\">\r\n                    Galaxy {locationData.context.galaxy}  Region {locationData.context.region}  System {locationData.context.system}  Body {locationData.context.body}\r\n                  </div>\r\n                )}\r\n\r\n                {!locationData.owner && (\r\n                  <button\r\n                    onClick={() => {\r\n                      setActiveTab('colonize');\r\n                      setCoordinateInput(locationData.coord);\r\n                    }}\r\n                    className=\"w-full mt-3 py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors\"\r\n                  >\r\n                     Colonize This Location\r\n                  </button>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {activeTab === 'colonize' && (\r\n        <div className=\"space-y-4\">\r\n          <h3 className=\"text-lg font-semibold text-white\">Establish New Colony</h3>\r\n          \r\n          {/* Colonization Cost Display */}\r\n          <div className=\"p-4 bg-gray-700 rounded-lg border border-gray-600\">\r\n            <h4 className=\"font-medium text-white mb-3\">Colonization Cost</h4>\r\n            <div className=\"text-center\">\r\n              <div className={empire.resources.credits >= colonizationCostCredits ? 'text-yellow-400' : 'text-red-400'}>\r\n                 {colonizationCostCredits.toLocaleString()}\r\n              </div>\r\n              <div className=\"text-xs text-gray-400\">Credits</div>\r\n              <div className=\"text-xs text-gray-500 mt-2\">\r\n                Base #{(empire.baseCount || 0) + 1}  {empire.hasDeletedBase ? '25% Discount Applied' : 'No Discount'}\r\n              </div>\r\n            </div>\r\n            \r\n            {!canAffordColonization() && (\r\n              <div className=\"mt-3 p-2 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm\">\r\n                 Insufficient resources for colonization\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-2 text-gray-300\">\r\n                Target Location Coordinate\r\n              </label>\r\n              <div className=\"flex gap-2\">\r\n                <input\r\n                  type=\"text\"\r\n                  value={coordinateInput}\r\n                  onChange={(e) => setCoordinateInput(e.target.value.toUpperCase())}\r\n                  placeholder=\"A00:10:22:10\"\r\n                  className=\"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                  maxLength={12}\r\n                />\r\n                <button\r\n                  onClick={handleLocationSearch}\r\n                  disabled={loading || !coordinateInput.trim()}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                  {loading ? 'Checking...' : 'Check'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {locationData && (\r\n              <>\r\n                <div className=\"p-4 bg-gray-700 rounded-lg border border-gray-600\">\r\n                  <h4 className=\"font-semibold mb-3 text-blue-400\">Target Location</h4>\r\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                    <div>\r\n                      <p><span className=\"text-gray-400\">Coordinate:</span> {locationData.coord}</p>\r\n                      <p><span className=\"text-gray-400\">Type:</span> <span className=\"capitalize\">{locationData.type}</span></p>\r\n                      <p>\r\n                        <span className=\"text-gray-400\">Status:</span> \r\n                        <span className={locationData.owner ? 'text-red-400' : 'text-green-400'}>\r\n                          {locationData.owner ? 'Owned' : 'Available'}\r\n                        </span>\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-gray-400 mb-1\">Overhaul:</p>\r\n                      <p className=\"text-gray-200\">\r\n                        Fertility: {locationData.result?.fertility ?? ''}\r\n                      </p>\r\n                      {locationData.result?.yields && (\r\n                        <p className=\"text-gray-200\">\r\n                          Yields (M/G/C): {locationData.result.yields.metal}/{locationData.result.yields.gas}/{locationData.result.yields.crystals}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {!locationData.owner && (\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2 text-gray-300\">\r\n                      Colony Name\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={colonyName}\r\n                      onChange={(e) => setColonyName(e.target.value)}\r\n                      placeholder=\"Enter colony name...\"\r\n                      className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500\"\r\n                      maxLength={30}\r\n                    />\r\n                    \r\n                    <button\r\n                      onClick={handleColonize}\r\n                      disabled={loading || !colonyName.trim() || !canAffordColonization()}\r\n                      className={`w-full mt-3 py-3 px-4 rounded-md font-medium transition-colors ${\r\n                        canAffordColonization() && colonyName.trim()\r\n                          ? 'bg-green-600 hover:bg-green-700 text-white'\r\n                          : 'bg-gray-600 text-gray-400 cursor-not-allowed'\r\n                      }`}\r\n                    >\r\n                      {loading ? 'Establishing Colony...' : ' Establish Colony'}\r\n                    </button>\r\n                  </div>\r\n                )}\r\n\r\n                {locationData.owner && (\r\n                  <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200\">\r\n                    This location is already owned by {locationData.owner.username}. Find another location to colonize.\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GalaxyModal;\r\n","import React from 'react';\r\nimport { Empire } from '@game/shared';\r\n\r\ninterface FleetModalProps {\r\n  empire: Empire;\r\n  onUpdate: () => void;\r\n}\r\n\r\nconst FleetModal: React.FC<FleetModalProps> = () => {\r\n  // This is a placeholder component for future fleet management features\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-center py-8\">\r\n        <div className=\"text-6xl mb-4\"></div>\r\n        <h3 className=\"text-xl font-semibold text-white mb-2\">Fleet Management</h3>\r\n        <p className=\"text-gray-400 mb-4\">\r\n          Fleet management features are coming soon! This will include ship construction, \r\n          fleet deployment, and interstellar warfare capabilities.\r\n        </p>\r\n        \r\n        <div className=\"p-4 bg-gray-700 rounded-lg border border-gray-600 text-left\">\r\n          <h4 className=\"font-medium text-white mb-3\">Planned Features:</h4>\r\n          <ul className=\"space-y-2 text-sm text-gray-300\">\r\n            <li className=\"flex items-center gap-2\">\r\n              <span className=\"text-blue-400\"></span>\r\n              Ship construction and customization\r\n            </li>\r\n            <li className=\"flex items-center gap-2\">\r\n              <span className=\"text-green-400\"></span>\r\n              Fleet deployment and movement\r\n            </li>\r\n            <li className=\"flex items-center gap-2\">\r\n              <span className=\"text-red-400\"></span>\r\n              Combat and warfare systems\r\n            </li>\r\n            <li className=\"flex items-center gap-2\">\r\n              <span className=\"text-yellow-400\"></span>\r\n              Defense coordination\r\n            </li>\r\n            <li className=\"flex items-center gap-2\">\r\n              <span className=\"text-purple-400\"></span>\r\n              Exploration missions\r\n            </li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"mt-6 p-3 bg-blue-900/30 border border-blue-700 rounded-md\">\r\n          <p className=\"text-blue-200 text-sm\">\r\n            <span className=\"font-medium\"> Tip:</span> Focus on building your economy and research capabilities first. \r\n            Strong infrastructure will be essential for supporting powerful fleets!\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FleetModal;\r\n","import React, { useMemo, useState } from 'react';\r\nimport { Empire, getTechnologyList, getTechSpec, TechnologySpec, getBuildingsList, BuildingSpec, getDefensesList, DefenseSpec, getUnitsList, UnitSpec, TERRAIN_BASELINES, getBasePosition, getStarKindModifiers, STAR_KIND_WEIGHTS } from '@game/shared';\r\nimport type { StarKind } from '@game/shared';\r\n\r\ntype InfoTab = 'technologies' | 'structures' | 'defenses' | 'units' | 'capacities' | 'terrains' | 'all';\r\n\r\ninterface GameInfoModalProps {\r\n  empire: Empire;\r\n  onUpdate: () => void;\r\n  initialTab?: InfoTab;\r\n}\r\n\r\nconst tabs: { key: InfoTab; label: string }[] = [\r\n  { key: 'technologies', label: 'Technologies' },\r\n  { key: 'structures', label: 'Structures' },\r\n  { key: 'defenses', label: 'Defenses' },\r\n  { key: 'units', label: 'Units' },\r\n  { key: 'capacities', label: 'Capacities' },\r\n  { key: 'terrains', label: 'Terrains' },\r\n  { key: 'all', label: 'All' }\r\n];\r\n\r\nconst SectionHeaderStrip: React.FC<{ active: InfoTab; setActive: (k: InfoTab) => void }> = ({ active, setActive }) => {\r\n  return (\r\n    <div className=\"mb-4\">\r\n      <div className=\"flex gap-1 bg-gray-700 p-1 rounded-lg border border-gray-600\">\r\n        {tabs.map(t => (\r\n          <button\r\n            key={t.key}\r\n            onClick={() => setActive(t.key)}\r\n            className={`px-3 py-2 text-sm font-medium rounded-md transition-colors ${\r\n              active === t.key\r\n                ? 'bg-blue-600 text-white'\r\n                : 'text-gray-300 hover:text-white hover:bg-gray-600'\r\n            }`}\r\n          >\r\n            {t.label}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst TechnologiesTable: React.FC = () => {\r\n  const techs = useMemo<TechnologySpec[]>(\r\n    () => getTechnologyList().slice().sort((a, b) => a.creditsCost - b.creditsCost),\r\n    []\r\n  );\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Technologies</h3>\r\n      </div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Technology</th>\r\n              <th className=\"py-2 px-3 text-left\">Credits</th>\r\n              <th className=\"py-2 px-3 text-left\">Labs Level</th>\r\n              <th className=\"py-2 px-3 text-left\">Requires</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {techs.map((t) => {\r\n              const requires =\r\n                t.prerequisites.length === 0\r\n                  ? ''\r\n                  : t.prerequisites\r\n                      .map((p) => `${getTechSpec(p.key).name} ${p.level}`)\r\n                      .join(', ');\r\n              return (\r\n                <tr key={t.key} className=\"border-b border-gray-800 hover:bg-gray-800/60\">\r\n                  <td className=\"py-2 px-3\">\r\n                    <div className=\"text-white\">{t.name}</div>\r\n                    {t.description ? (\r\n                      <div className=\"text-xs text-gray-400\">{t.description}</div>\r\n                    ) : null}\r\n                  </td>\r\n                  <td className=\"py-2 px-3 text-gray-200\">{t.creditsCost.toLocaleString()}</td>\r\n                  <td className=\"py-2 px-3 text-gray-200\">{t.requiredLabs}</td>\r\n                  <td className={`py-2 px-3 ${t.prerequisites.length ? 'text-red-400' : 'text-gray-400'}`}>\r\n                    {requires}\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst StructuresTable: React.FC = () => {\r\n  const structs = useMemo<BuildingSpec[]>(\r\n    () => getBuildingsList().slice().sort((a, b) => a.creditsCost - b.creditsCost),\r\n    []\r\n  );\r\n\r\n  const getStructureEffect = (s: BuildingSpec): string => {\r\n    switch (s.key) {\r\n      case 'urban_structures':\r\n        return 'Increases population capacity by base fertility.';\r\n      case 'solar_plants':\r\n        return 'Increases base energy output by base solar energy.';\r\n      case 'gas_plants':\r\n        return 'Increases base energy output by base gas resource.';\r\n      case 'fusion_plants':\r\n      case 'antimatter_plants':\r\n      case 'orbital_plants':\r\n        return `Increases base energy output by ${s.energyDelta}.`;\r\n      case 'research_labs':\r\n        return 'Increases bases research by 8, allows new technologies.';\r\n      case 'metal_refineries':\r\n        return 'Increases production and construction by base metal resource.';\r\n      case 'crystal_mines':\r\n        return 'Increases economy by base crystals resource.';\r\n      case 'robotic_factories':\r\n        return 'Increases production and construction by 2.';\r\n      case 'shipyards':\r\n        return 'Increases production by 2 and allows new units.';\r\n      case 'orbital_shipyards':\r\n        return 'Increases production by 8 and allows new units.';\r\n      case 'spaceports':\r\n        return `Increases economy by ${s.economy} and allows trade routes.`;\r\n      case 'command_centers':\r\n        return 'Adds 5% fleet attack power at base and allows 1 occupation.';\r\n      case 'nanite_factories':\r\n        return 'Increases production and construction by 4.';\r\n      case 'android_factories':\r\n        return 'Increases production and construction by 6.';\r\n      case 'economic_centers':\r\n        return `Increases economy by ${s.economy}.`;\r\n      case 'terraform':\r\n        return 'Increases base area by 5.';\r\n      case 'multi_level_platforms':\r\n        return 'Increases base area by 10.';\r\n      case 'orbital_base':\r\n        return 'Increases population capacity by 10.';\r\n      case 'jump_gate':\r\n        return 'Increases fleet speed by 70% and allows travel between galaxies.';\r\n      case 'biosphere_modification':\r\n        return 'Increases planet fertility by 1.';\r\n      case 'capital':\r\n        return 'Increases economy by 10 and other bases by 1. -15% empire income while occupied.';\r\n      default:\r\n        if (s.energyDelta > 0) return `Increases base energy output by ${s.energyDelta}.`;\r\n        if (s.energyDelta < 0) return `Consumes ${Math.abs(s.energyDelta)} energy.`;\r\n        if (s.economy > 0) return `Increases economy by ${s.economy}.`;\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const NO_AREA_KEYS: Array<BuildingSpec['key']> = ['orbital_base', 'jump_gate'];\r\n\r\n  const AREA_INCREASE: Partial<Record<BuildingSpec['key'], number>> = {\r\n    terraform: 5,\r\n    multi_level_platforms: 10,\r\n  };\r\n\r\n  const renderArea = (s: BuildingSpec): string => {\r\n    if (NO_AREA_KEYS.includes(s.key)) return '';\r\n    const inc = AREA_INCREASE[s.key as keyof typeof AREA_INCREASE];\r\n    if (typeof inc === 'number') return `+${inc}`;\r\n    if (typeof s.areaRequired === 'number') {\r\n      return s.areaRequired === 0 ? '' : `-${s.areaRequired}`;\r\n    }\r\n    // Default: most items cost 1 area\r\n    return '-1';\r\n  };\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Structures</h3>\r\n      </div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Structure</th>\r\n              <th className=\"py-2 px-3 text-left\">Credits</th>\r\n              <th className=\"py-2 px-3 text-left\">Energy</th>\r\n              <th className=\"py-2 px-3 text-left\">Economy</th>\r\n              <th className=\"py-2 px-3 text-left\">Population</th>\r\n              <th className=\"py-2 px-3 text-left\">Area</th>\r\n              <th className=\"py-2 px-3 text-left\">Advanced</th>\r\n              <th className=\"py-2 px-3 text-left\">Requires</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {structs.map((s) => {\r\n              const requires =\r\n                s.techPrereqs.length === 0\r\n                  ? ''\r\n                  : s.techPrereqs\r\n                      .map((p) => `${getTechSpec(p.key).name} ${p.level}`)\r\n                      .join(', ');\r\n              return (\r\n                <tr key={s.key} className=\"border-b border-gray-800 hover:bg-gray-800/60\">\r\n                  <td className=\"py-2 px-3\">\r\n                    <div className=\"text-white\">{s.name}</div>\r\n                    <div className=\"text-xs text-gray-400\">{getStructureEffect(s)}</div>\r\n                  </td>\r\n                  <td className=\"py-2 px-3 text-gray-200\">{s.creditsCost.toLocaleString()}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">\r\n                    {\r\n                      (s.key === 'solar_plants' || s.key === 'gas_plants')\r\n                        ? ''\r\n                        : (s.energyDelta === 0 ? '' : String(s.energyDelta))\r\n                    }\r\n                  </td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{s.economy === 0 ? '' : s.economy}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{s.key === 'orbital_base' ? '+10' : (s.populationRequired === 0 ? '' : `-${s.populationRequired}`)}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{renderArea(s)}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{s.advanced ? 'x' : ''}</td>\r\n                  <td className={`py-2 px-3 ${s.techPrereqs.length ? 'text-red-400' : 'text-gray-400'}`}>\r\n                    {requires}\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst DefensesTable: React.FC = () => {\r\n  const defs = useMemo<DefenseSpec[]>(\r\n    () => getDefensesList().slice().sort((a, b) => a.creditsCost - b.creditsCost),\r\n    []\r\n  );\r\n\r\n  const getDefenseDescription = (key: DefenseSpec['key']): string => {\r\n    switch (key) {\r\n      case 'barracks':\r\n        return 'Help protect your bases, the cheapest defense.';\r\n      case 'laser_turrets':\r\n        return 'Small defenses, good against small units.';\r\n      case 'missile_turrets':\r\n        return 'Small defenses, good against small and medium units.';\r\n      case 'plasma_turrets':\r\n        return 'Average defenses, good against medium units.';\r\n      case 'ion_turrets':\r\n        return 'Average defenses, good against medium units.';\r\n      case 'photon_turrets':\r\n        return 'Big defenses, good against large units.';\r\n      case 'disruptor_turrets':\r\n        return 'Biggest turrets, good against large units.';\r\n      case 'deflection_shields':\r\n        return 'Strong shields that increase bases protection.';\r\n      case 'planetary_shield':\r\n        return 'Planetary shields that increases bases protection.';\r\n      case 'planetary_ring':\r\n        return 'Planetary defensive ring.';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const renderArea = (d: DefenseSpec): string => {\r\n    if (typeof d.areaRequired === 'number') {\r\n      return d.areaRequired === 0 ? '' : `-${d.areaRequired}`;\r\n    }\r\n    // Default: most items cost 1 area\r\n    return '-1';\r\n  };\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Defenses</h3>\r\n      </div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Defense</th>\r\n              <th className=\"py-2 px-3 text-left\">Credits</th>\r\n              <th className=\"py-2 px-3 text-left\">Weapon</th>\r\n              <th className=\"py-2 px-3 text-left\">Attack</th>\r\n              <th className=\"py-2 px-3 text-left\">Armour</th>\r\n              <th className=\"py-2 px-3 text-left\">Shield</th>\r\n              <th className=\"py-2 px-3 text-left\">Energy</th>\r\n              <th className=\"py-2 px-3 text-left\">Area</th>\r\n              <th className=\"py-2 px-3 text-left\">Requires</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {defs.map((d) => {\r\n              const requires =\r\n                d.techPrereqs.length === 0\r\n                  ? ''\r\n                  : d.techPrereqs\r\n                      .map((p) => `${getTechSpec(p.key).name} ${p.level}`)\r\n                      .join(', ');\r\n              return (\r\n                <tr key={d.key} className=\"border-b border-gray-800 hover:bg-gray-800/60\">\r\n                  <td className=\"py-2 px-3\">\r\n                    <div className=\"text-white\">{d.name}</div>\r\n                    <div className=\"text-xs text-gray-400\">{getDefenseDescription(d.key)}</div>\r\n                  </td>\r\n                  <td className=\"py-2 px-3 text-gray-200\">{d.creditsCost.toLocaleString()}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{d.weapon ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{d.attack ? d.attack : ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{d.armour ? d.armour : ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">\r\n                    {typeof d.shield === 'number' && d.shield !== 0 ? d.shield : ''}\r\n                  </td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{d.energyDelta === 0 ? '' : String(d.energyDelta)}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{renderArea(d)}</td>\r\n                  <td className={`py-2 px-3 ${d.techPrereqs.length ? 'text-red-400' : 'text-gray-400'}`}>\r\n                    {requires}\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <p className=\"mt-2 text-xs text-gray-400\">\r\n        Each level of defenses requires 1 Population.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst UnitsTable: React.FC = () => {\r\n  const units = useMemo<UnitSpec[]>(\r\n    () => getUnitsList().slice().sort((a, b) => a.creditsCost - b.creditsCost),\r\n    []\r\n  );\r\n\r\n  const renderShipyardReq = (u: UnitSpec) => {\r\n    if (u.requiredShipyardLevel && u.requiredOrbitalShipyardLevel) {\r\n      return `${u.requiredShipyardLevel} (${u.requiredOrbitalShipyardLevel})`;\r\n    }\r\n    if (u.requiredShipyardLevel) {\r\n      return `${u.requiredShipyardLevel}`;\r\n    }\r\n    return '';\r\n  };\r\n\r\n  // Fallback description mapping to ensure subtitle shows even if catalog omits description\r\n  const getUnitDescription = (key: UnitSpec['key']): string => {\r\n    switch (key) {\r\n      case 'fighter':\r\n        return 'Good fighting unit against unshielded units.';\r\n      case 'bomber':\r\n        return 'Good fighting unit against unshielded and low shield units.';\r\n      case 'cruiser':\r\n        return 'Versatile unit, good for long range action and escort.';\r\n      case 'carrier':\r\n        return 'Unit with 80 hangar spaces.';\r\n      case 'fleet_carrier':\r\n        return 'Large carrier with 500 hangar spaces.';\r\n      case 'death_star':\r\n        return 'Biggest unit, cant use jump gates, gives +10% power and armour to fleet.';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Units</h3>\r\n      </div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Unit</th>\r\n              <th className=\"py-2 px-3 text-left\">Credits</th>\r\n              <th className=\"py-2 px-3 text-left\">Drive</th>\r\n              <th className=\"py-2 px-3 text-left\">Weapon</th>\r\n              <th className=\"py-2 px-3 text-left\">Attack</th>\r\n              <th className=\"py-2 px-3 text-left\">Armour</th>\r\n              <th className=\"py-2 px-3 text-left\">Shield</th>\r\n              <th className=\"py-2 px-3 text-left\">Hangar</th>\r\n              <th className=\"py-2 px-3 text-left\">Speed</th>\r\n              <th className=\"py-2 px-3 text-left\">Shipyard</th>\r\n              <th className=\"py-2 px-3 text-left\">Requires</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {units.map((u) => {\r\n              const requires =\r\n                u.techPrereqs.length === 0\r\n                  ? ''\r\n                  : u.techPrereqs.map((p) => `${getTechSpec(p.key).name} ${p.level}`).join(', ');\r\n              return (\r\n                <tr key={u.key} className=\"border-b border-gray-800 hover:bg-gray-800/60\">\r\n                  <td className=\"py-2 px-3\">\r\n                    <div className=\"text-white\">{u.name}</div>\r\n                    {(u.description ?? getUnitDescription(u.key)) ? (\r\n                      <div className=\"text-xs text-gray-400\">{u.description ?? getUnitDescription(u.key)}</div>\r\n                    ) : null}\r\n                  </td>\r\n                  <td className=\"py-2 px-3 text-gray-200\">{u.creditsCost.toLocaleString()}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{u.drive ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{u.weapon ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{u.attack ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{u.armour ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{u.shield ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{u.hangar ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{u.speed ?? ''}</td>\r\n                  <td className=\"py-2 px-3 text-gray-300\">{renderShipyardReq(u)}</td>\r\n                  <td className={`py-2 px-3 ${u.techPrereqs.length ? 'text-red-400' : 'text-gray-400'}`}>{requires}</td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <div className=\"mt-2 text-xs text-gray-400 space-y-1\">\r\n        <p>* Can move a galaxy away (200 distance).</p>\r\n        <p>Note: Shipyard 20 (1) means that it requires Shipyard Level 20 and Orbital Shipyard Level 1.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst CapacitiesSection: React.FC = () => {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h3 className=\"text-lg font-semibold text-empire-gold\">Capacities</h3>\r\n        </div>\r\n\r\n        <div className=\"space-y-6 text-sm text-gray-200\">\r\n          {/* Construction Capacity */}\r\n          <div>\r\n            <h4 className=\"text-base font-semibold text-white mb-1\">Construction Capacity</h4>\r\n            <p className=\"text-gray-300 mb-2\">\r\n              Determines how quickly structures and defenses are built at a base. Measured in credits per hour (cred/h).\r\n            </p>\r\n            <ul className=\"list-disc ml-5 text-gray-300 space-y-1\">\r\n              <li><span className=\"text-empire-gold\">New Base Baseline:</span> 40 cred/h (even with no capacity buildings).</li>\r\n              <li><span className=\"text-empire-gold\">Metal Refineries:</span> + base metal resource value per level.</li>\r\n              <li><span className=\"text-empire-gold\">Robotic Factories:</span> +2 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Nanite Factories:</span> +4 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Android Factories:</span> +6 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Cybernetics Technology:</span> +5% across all bases.</li>\r\n              <li><span className=\"text-empire-gold\">Construction Commander:</span> reduces construction time by 1% per commander level. (Hook)</li>\r\n            </ul>\r\n            <div className=\"mt-2 p-2 rounded bg-gray-800 border border-gray-700 text-gray-200\">\r\n              <div className=\"text-gray-300\">Formula</div>\r\n              <div className=\"font-mono text-gray-100\">Construction Time (hours) = Structure Cost (credits) / Construction Capacity (cred/h)</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Production Capacity */}\r\n          <div>\r\n            <h4 className=\"text-base font-semibold text-white mb-1\">Production Capacity</h4>\r\n            <p className=\"text-gray-300 mb-2\">\r\n              Determines how quickly ships and goods are produced at a base. Measured in cred/h.\r\n            </p>\r\n            <ul className=\"list-disc ml-5 text-gray-300 space-y-1\">\r\n              <li><span className=\"text-empire-gold\">Baseline:</span> 0 cred/h (requires structures/tech to increase).</li>\r\n              <li><span className=\"text-empire-gold\">Shipyards:</span> +2 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Orbital Shipyards:</span> +8 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Metal Refineries:</span> + base metal resource value per level.</li>\r\n              <li><span className=\"text-empire-gold\">Robotic Factories:</span> +2 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Nanite Factories:</span> +4 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Android Factories:</span> +6 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Cybernetics Technology:</span> +5% across all bases.</li>\r\n              <li><span className=\"text-empire-gold\">Production Commander:</span> reduces production time by 1% per commander level. (Hook)</li>\r\n              <li><span className=\"text-empire-gold\">Double Production:</span> optional mode to halve time for extra cost. (Planned)</li>\r\n            </ul>\r\n            <div className=\"mt-2 p-2 rounded bg-gray-800 border border-gray-700 text-gray-200\">\r\n              <div className=\"text-gray-300\">Formula</div>\r\n              <div className=\"font-mono text-gray-100\">Production Time (hours) = Unit Cost (credits) / Production Capacity (cred/h)</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Research Capacity */}\r\n          <div>\r\n            <h4 className=\"text-base font-semibold text-white mb-1\">Research Capacity</h4>\r\n            <p className=\"text-gray-300 mb-2\">\r\n              Determines how quickly technologies can be researched at a base. Measured in cred/h.\r\n            </p>\r\n            <ul className=\"list-disc ml-5 text-gray-300 space-y-1\">\r\n              <li><span className=\"text-empire-gold\">Baseline:</span> 0 cred/h.</li>\r\n              <li><span className=\"text-empire-gold\">Research Labs:</span> +8 per level.</li>\r\n              <li><span className=\"text-empire-gold\">Artificial Intelligence Technology:</span> +5% across all bases.</li>\r\n              <li><span className=\"text-empire-gold\">Research Commander:</span> reduces research time by 1% per commander level. (Hook)</li>\r\n            </ul>\r\n            <div className=\"mt-2 p-2 rounded bg-gray-800 border border-gray-700 text-gray-200\">\r\n              <div className=\"text-gray-300\">Formula</div>\r\n              <div className=\"font-mono text-gray-100\">Research Time (hours) = Technology Cost (credits) / Research Capacity (cred/h)</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Examples */}\r\n          <div>\r\n            <h4 className=\"text-base font-semibold text-white mb-1\">Example Calculations</h4>\r\n            <div className=\"grid md:grid-cols-3 gap-4\">\r\n              <div className=\"p-3 rounded bg-gray-800 border border-gray-700\">\r\n                <div className=\"text-gray-300 font-semibold mb-1\">Construction</div>\r\n                <ul className=\"text-gray-300 text-sm space-y-1\">\r\n                  <li>Structure cost: 100 credits</li>\r\n                  <li>Construction capacity: 20 cred/h</li>\r\n                  <li>Time: <span className=\"font-mono text-white\">100 / 20 = 5 hours</span></li>\r\n                </ul>\r\n              </div>\r\n              <div className=\"p-3 rounded bg-gray-800 border border-gray-700\">\r\n                <div className=\"text-gray-300 font-semibold mb-1\">Production</div>\r\n                <ul className=\"text-gray-300 text-sm space-y-1\">\r\n                  <li>Unit cost: 50 credits</li>\r\n                  <li>Production capacity: 10 cred/h</li>\r\n                  <li>Time: <span className=\"font-mono text-white\">50 / 10 = 5 hours</span></li>\r\n                </ul>\r\n              </div>\r\n              <div className=\"p-3 rounded bg-gray-800 border border-gray-700\">\r\n                <div className=\"text-gray-300 font-semibold mb-1\">Research</div>\r\n                <ul className=\"text-gray-300 text-sm space-y-1\">\r\n                  <li>Technology cost: 80 credits</li>\r\n                  <li>Research capacity: 40 cred/h</li>\r\n                  <li>Time: <span className=\"font-mono text-white\">80 / 40 = 2 hours</span></li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n            <p className=\"mt-2 text-xs text-gray-400\">\r\n              Percent bonuses (e.g., Cybernetics, AI) apply to the total capacity after flat additions. Commander reductions apply to time.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst TerrainsSection: React.FC = () => {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <TerrainsTable />\r\n      <AstroPositionTable />\r\n      <StarKindEffectsTable />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst TerrainsTable: React.FC = () => {\r\n  const rows = useMemo(\r\n    () =>\r\n      Object.entries(TERRAIN_BASELINES)\r\n        .filter(([name]) => name !== 'Asteroid')\r\n        .map(([name, v]) => ({\r\n          name,\r\n          metal: v.metal ?? 0,\r\n          gas: v.gas ?? 0,\r\n          crystals: v.crystals ?? 0,\r\n          fertility: v.fertility ?? 0,\r\n          areaPlanet: v.areaPlanet ?? undefined,\r\n          areaMoon: v.areaMoon ?? undefined,\r\n        }))\r\n        .sort((a, b) => a.name.localeCompare(b.name)),\r\n    []\r\n  );\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Terrains</h3>\r\n      </div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Terrain</th>\r\n              <th className=\"py-2 px-3 text-left\">Metal</th>\r\n              <th className=\"py-2 px-3 text-left\">Gas</th>\r\n              <th className=\"py-2 px-3 text-left\">Crystals</th>\r\n              <th className=\"py-2 px-3 text-left\">Fertility</th>\r\n              <th className=\"py-2 px-3 text-left\">Area Planet</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows.map((r) => (\r\n              <tr key={r.name} className=\"border-b border-gray-800 hover:bg-gray-800/60\">\r\n                <td className=\"py-2 px-3 text-white\">{r.name}</td>\r\n                <td className=\"py-2 px-3 text-gray-200\">{r.metal}</td>\r\n                <td className=\"py-2 px-3 text-gray-200\">{r.gas}</td>\r\n                <td className=\"py-2 px-3 text-gray-200\">{r.crystals}</td>\r\n                <td className=\"py-2 px-3 text-gray-200\">{r.fertility}</td>\r\n                <td className=\"py-2 px-3 text-gray-200\">{typeof r.areaPlanet === 'number' ? r.areaPlanet : ''}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <p className=\"mt-2 text-xs text-gray-400\">\r\n        Values shown are baseline terrain attributes. Final planet yields and fertility also depend on orbit position and star kind modifiers.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AstroPositionTable: React.FC = () => {\r\n  const positions = useMemo(() => Array.from({ length: 8 }, (_, i) => i + 1), []);\r\n  const base = useMemo(\r\n    () => positions.map((p) => ({ p, base: getBasePosition(p) })),\r\n    [positions]\r\n  );\r\n  const gasByPos = useMemo(() => [0, 0, 0, 1, 1, 1, 2, 2], []);\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Astro Position Effects (Base)</h3>\r\n      </div>\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Effect</th>\r\n              {positions.map((p) => (\r\n                <th key={p} className=\"py-2 px-3 text-center\">P{p}</th>\r\n              ))}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr className=\"border-b border-gray-800\">\r\n              <td className=\"py-2 px-3 text-white\">Solar Energy</td>\r\n              {base.map(({ p, base }) => (\r\n                <td key={`se-${p}`} className=\"py-2 px-3 text-gray-200 text-center\">{base.solarEnergy}</td>\r\n              ))}\r\n            </tr>\r\n            <tr>\r\n              <td className=\"py-2 px-3 text-white\">Fertility</td>\r\n              {base.map(({ p, base }) => (\r\n                <td key={`fert-${p}`} className=\"py-2 px-3 text-gray-200 text-center\">{base.fertility}</td>\r\n              ))}\r\n            </tr>\r\n            <tr>\r\n              <td className=\"py-2 px-3 text-white\">Gas</td>\r\n              {positions.map((p, idx) => (\r\n                <td key={`gas-${p}`} className=\"py-2 px-3 text-gray-200 text-center\">{gasByPos[idx]}</td>\r\n              ))}\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <p className=\"mt-2 text-xs text-gray-400\">\r\n        Star kind can modify these base values further and can add or remove resource yields at certain positions.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst StarKindEffectsTable: React.FC = () => {\r\n  const kinds = useMemo<StarKind[]>(\r\n    () => STAR_KIND_WEIGHTS.map(k => k.kind as StarKind),\r\n    []\r\n  );\r\n  const [selected, setSelected] = useState<StarKind>(kinds[0] || 'YELLOW');\r\n  const positions = useMemo(() => Array.from({ length: 8 }, (_, i) => i + 1), []);\r\n\r\n  const deltas = useMemo(\r\n    () =>\r\n      positions.map((p) => {\r\n        const m = getStarKindModifiers(selected, p);\r\n        return {\r\n          p,\r\n          solar: m.solarEnergyDelta,\r\n          fert: m.fertilityDelta,\r\n          metal: m.resourceDelta?.metal ?? 0,\r\n          gas: m.resourceDelta?.gas ?? 0,\r\n          crystals: m.resourceDelta?.crystals ?? 0,\r\n        };\r\n      }),\r\n    [selected, positions]\r\n  );\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Star Kind Modifiers by Orbit Position</h3>\r\n        <div className=\"flex items-center gap-2\">\r\n          <label className=\"text-sm text-gray-300\">Star Kind:</label>\r\n          <select\r\n            className=\"bg-gray-800 border border-gray-600 text-gray-200 text-sm rounded-md px-2 py-1\"\r\n            value={selected}\r\n            onChange={(e) => setSelected(e.target.value as StarKind)}\r\n          >\r\n            {kinds.map((k) => (\r\n              <option key={k} value={k}>\r\n                {k.replace(/_/g, ' ')}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Effect </th>\r\n              {positions.map((p) => (\r\n                <th key={p} className=\"py-2 px-3 text-center\">P{p}</th>\r\n              ))}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr className=\"border-b border-gray-800\">\r\n              <td className=\"py-2 px-3 text-white\">Solar Energy</td>\r\n              {deltas.map((d) => (\r\n                <td key={`s-${d.p}`} className=\"py-2 px-3 text-gray-200 text-center\">{d.solar}</td>\r\n              ))}\r\n            </tr>\r\n            <tr className=\"border-b border-gray-800\">\r\n              <td className=\"py-2 px-3 text-white\">Fertility</td>\r\n              {deltas.map((d) => (\r\n                <td key={`f-${d.p}`} className=\"py-2 px-3 text-gray-200 text-center\">{d.fert}</td>\r\n              ))}\r\n            </tr>\r\n            <tr className=\"border-b border-gray-800\">\r\n              <td className=\"py-2 px-3 text-white\">Metal</td>\r\n              {deltas.map((d) => (\r\n                <td key={`m-${d.p}`} className=\"py-2 px-3 text-gray-200 text-center\">{d.metal}</td>\r\n              ))}\r\n            </tr>\r\n            <tr className=\"border-b border-gray-800\">\r\n              <td className=\"py-2 px-3 text-white\">Gas</td>\r\n              {deltas.map((d) => (\r\n                <td key={`g-${d.p}`} className=\"py-2 px-3 text-gray-200 text-center\">{d.gas}</td>\r\n              ))}\r\n            </tr>\r\n            <tr>\r\n              <td className=\"py-2 px-3 text-white\">Crystals</td>\r\n              {deltas.map((d) => (\r\n                <td key={`c-${d.p}`} className=\"py-2 px-3 text-gray-200 text-center\">{d.crystals}</td>\r\n              ))}\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <p className=\"mt-2 text-xs text-gray-400\">\r\n        This table shows how the selected star kind modifies the base orbit effects and terrain yields. Final planet values are:\r\n        Terrain baseline + Star resource deltas + Base Orbit (Solar/Fertility) + Star Solar/Fertility deltas.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\nconst GameInfoModal: React.FC<GameInfoModalProps> = ({ initialTab }) => {\r\n  const [active, setActive] = useState<InfoTab>(initialTab ?? 'technologies');\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <SectionHeaderStrip active={active} setActive={setActive} />\r\n\r\n      {/* Content area with controlled height to keep within modal */}\r\n      <div className=\"max-h-[70vh] overflow-y-auto pr-1\">\r\n        {active === 'technologies' && <TechnologiesTable />}\r\n        {active === 'structures' && <StructuresTable />}\r\n        {active === 'defenses' && <DefensesTable />}\r\n        {active === 'units' && <UnitsTable />}\r\n        {active === 'capacities' && <CapacitiesSection />}\r\n        {active === 'terrains' && <TerrainsSection />}\r\n        {active === 'all' && (\r\n          <div className=\"space-y-6\">\r\n            <TechnologiesTable />\r\n            <StructuresTable />\r\n            <DefensesTable />\r\n            <UnitsTable />\r\n            <TerrainsSection />\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GameInfoModal;\r\n","import React from 'react';\r\nimport type { CapacityResult } from '@game/shared';\r\nimport { classifyCapacityBreakdown } from '@game/shared';\r\n\r\ntype Props = {\r\n  data: {\r\n    coord: string;\r\n    capacities: {\r\n      construction: CapacityResult;\r\n      production: CapacityResult;\r\n      research: CapacityResult;\r\n    };\r\n  };\r\n};\r\n\r\nconst Section: React.FC<{ title: string; result: CapacityResult }> = ({ title, result }) => {\r\n  const fmtCred = (n: number) => `${Math.round(n).toLocaleString()} cred./h`;\r\n  const fmtItem = (item: { source: string; value: number; kind: 'flat' | 'percent' }) => {\r\n    if (item.kind === 'percent') {\r\n      return `+${Math.round(item.value * 100)}%`;\r\n    }\r\n    return `+${Math.round(item.value).toLocaleString()} cred./h`;\r\n  };\r\n\r\n  const groups = classifyCapacityBreakdown(result.breakdown || []);\r\n\r\n  const GroupBlock: React.FC<{ label: string; items: typeof result.breakdown }> = ({ label, items }) => {\r\n    if (!items || items.length === 0) return null;\r\n    return (\r\n      <div className=\"mb-2\">\r\n        <div className=\"text-xs text-gray-400 uppercase tracking-wide mb-1\">{label}</div>\r\n        <div className=\"space-y-1\">\r\n          {items.map((b, idx) => (\r\n            <div key={`${label}-${idx}`} className=\"flex justify-between text-sm\">\r\n              <span className=\"text-gray-300\">{b.source}</span>\r\n              <span className=\"text-gray-200\">{fmtItem(b as any)}</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"mb-4 border border-gray-700 rounded-lg p-3\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <h4 className=\"font-semibold text-white\">{title}</h4>\r\n        <div className=\"text-sm text-gray-300\">\r\n          Total: <span className=\"font-mono\">{fmtCred(result.value)}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <GroupBlock label=\"Baseline\" items={groups.baseline} />\r\n      <GroupBlock label=\"Buildings\" items={groups.buildings} />\r\n      <GroupBlock label=\"Location\" items={groups.location} />\r\n      <GroupBlock label=\"Tech\" items={groups.tech} />\r\n      <GroupBlock label=\"Commander\" items={groups.commander} />\r\n      <GroupBlock label=\"Other\" items={groups.other} />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst CapacityBreakdownModal: React.FC<Props> = ({ data }) => {\r\n  if (!data?.capacities) {\r\n    return <div className=\"text-gray-400 text-sm\">No capacity data available.</div>;\r\n  }\r\n\r\n  const { coord, capacities } = data;\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-sm text-gray-400\">Base: <span className=\"text-white\">{coord}</span></div>\r\n\r\n      <Section title=\"Construction Capacity\" result={capacities.construction} />\r\n      <Section title=\"Production Capacity\" result={capacities.production} />\r\n      <Section title=\"Research Capacity\" result={capacities.research} />\r\n\r\n      <div className=\"text-xs text-gray-500\">\r\n        Notes:\r\n        <ul className=\"list-disc ml-5 mt-1\">\r\n          <li>Percent bonuses are applied after summing all flat contributions.</li>\r\n          <li>Cybernetics provides +5% to Construction and Production; Artificial Intelligence provides +5% to Research.</li>\r\n          <li>Values are rounded for display.</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CapacityBreakdownModal;\r\n","// Shared capacity calculators for Construction, Production, and Research\n// Phase 1: Minimal viable rules per current model constraints.\n//\n// Notes:\n// - BuildingType currently does not differentiate fine-grained BuildingKey variants.\n//   We treat all 'factory' the same (no direct production capacity) for now.\n//   We treat all 'shipyard' the same (+2 cred/h per level).\n//   We treat all 'research_lab' the same (+8 cred/h per level).\n// - Tech bonuses:\n//   - Cybernetics: +5% to construction and production capacities\n//   - Artificial Intelligence: +5% to research capacity\n// - Percent bonuses apply after summing all flat additions: effective = flatSum * (1 + totalPercent)\n// Tunable constants for Phase 2 (safe defaults; adjust as needed)\nconst ROBOTIC_FACTORY_CONSTR_PER_LEVEL = 2; // +2 cred/h per level (Construction)\nconst NANITE_FACTORY_CONSTR_PER_LEVEL = 10; // +10 cred/h per level (Construction)\nconst ANDROID_FACTORY_CONSTR_PER_LEVEL = 18; // +18 cred/h per level (Construction)\n// Production per-level constants\nconst ROBOTIC_FACTORY_PROD_PER_LEVEL = 2; // +2 cred/h per level (Production)\n// Overhaul-derived multipliers (percent per unit)\nconst PROD_PCT_PER_METAL_YIELD_UNIT = 0.01; // +1% Production per metal yield unit\nconst RESEARCH_PCT_PER_FERTILITY_UNIT = 0.01; // +1% Research per fertility unit\nconst CONSTR_PCT_PER_SOLAR_UNIT = 0.01; // +1% Construction per base solarEnergy unit\n// Helpers\nfunction hasAtLeastLevel(techLevels, key, level = 1) {\n    const v = techLevels[key] ?? 0;\n    return (typeof v === 'number' ? v : 0) >= level;\n}\nfunction finalizeCapacity(flat, percentTotal) {\n    const base = typeof flat === 'number' && isFinite(flat) ? flat : 0;\n    const pct = typeof percentTotal === 'number' && isFinite(percentTotal) ? percentTotal : 0;\n    return base * (1 + pct);\n}\n// Construction Capacity\n// Rules:\n// - Baseline: defaults.baseConstructionCredPerHour (40)\n// - +5% if 'cybernetics' >= 1\nexport function computeConstructionCapacity(ctx) {\n    const breakdown = [];\n    // Baseline flat\n    let flat = ctx.defaults.baseConstructionCredPerHour;\n    breakdown.push({ source: 'Baseline', value: flat, kind: 'flat' });\n    // Flat additions from factory chain (by catalogKey)\n    const active = (ctx.buildingsAtBase || []).filter(b => b.isActive);\n    const sumLevels = (key) => active.filter(b => (b.catalogKey || '') === key).reduce((s, b) => s + Math.max(0, b.level || 0), 0);\n    const roboticLv = sumLevels('robotic_factories');\n    const naniteLv = sumLevels('nanite_factories');\n    const androidLv = sumLevels('android_factories');\n    const roboticFlat = roboticLv * ROBOTIC_FACTORY_CONSTR_PER_LEVEL;\n    const naniteFlat = naniteLv * NANITE_FACTORY_CONSTR_PER_LEVEL;\n    const androidFlat = androidLv * ANDROID_FACTORY_CONSTR_PER_LEVEL;\n    if (roboticFlat) {\n        flat += roboticFlat;\n        breakdown.push({ source: 'Robotic Factories', value: roboticFlat, kind: 'flat' });\n    }\n    if (naniteFlat) {\n        flat += naniteFlat;\n        breakdown.push({ source: 'Nanite Factories', value: naniteFlat, kind: 'flat' });\n    }\n    if (androidFlat) {\n        flat += androidFlat;\n        breakdown.push({ source: 'Android Factories', value: androidFlat, kind: 'flat' });\n    }\n    // Buildings: Metal Refineries (by catalogKey)  add base metal yield per level\n    {\n        const refineryLevels = (ctx.buildingsAtBase || [])\n            .filter(b => b.isActive && (b.catalogKey || '') === 'metal_refineries')\n            .reduce((sum, b) => sum + Math.max(0, b.level || 0), 0);\n        const refineryFlat = refineryLevels * (ctx.locationDerived?.yieldsMetal || 0);\n        if (refineryFlat) {\n            flat += refineryFlat;\n            breakdown.push({ source: 'Metal Refineries (+metal yield per level)', value: refineryFlat, kind: 'flat' });\n        }\n    }\n    // Percent modifiers\n    let percent = 0;\n    // Tech: Cybernetics +5%\n    if (hasAtLeastLevel(ctx.techLevels, 'cybernetics', 1)) {\n        percent += 0.05;\n        breakdown.push({ source: 'Tech: Cybernetics +5%', value: 0.05, kind: 'percent' });\n    }\n    // Overhaul-derived: solarEnergy influences construction capacity (based on base position)\n    if (typeof ctx.locationDerived?.solarEnergy === 'number') {\n        const p = CONSTR_PCT_PER_SOLAR_UNIT * (ctx.locationDerived.solarEnergy || 0);\n        if (p) {\n            percent += p;\n            breakdown.push({ source: 'Environment: Solar Energy', value: p, kind: 'percent' });\n        }\n    }\n    // Commander hook (no-op if undefined)\n    if (typeof ctx.commander?.constructionPct === 'number' && ctx.commander.constructionPct) {\n        percent += ctx.commander.constructionPct;\n        breakdown.push({ source: 'Commander Bonus', value: ctx.commander.constructionPct, kind: 'percent' });\n    }\n    const value = finalizeCapacity(flat, percent);\n    return { value, breakdown };\n}\n// Production Capacity\n// Rules:\n// - Baseline: defaults.baseProductionCredPerHour (0)\n// - shipyard: +2 cred/h per level (isActive only)\n// - +5% if 'cybernetics' >= 1\nexport function computeProductionCapacity(ctx) {\n    const breakdown = [];\n    // Baseline flat\n    let flat = ctx.defaults.baseProductionCredPerHour;\n    breakdown.push({ source: 'Baseline', value: flat, kind: 'flat' });\n    // Buildings: Shipyards\n    const shipyardFlat = (ctx.buildingsAtBase || [])\n        .filter(b => b.isActive && b.type === 'shipyard')\n        .reduce((sum, b) => sum + 2 * Math.max(0, b.level || 0), 0);\n    if (shipyardFlat > 0) {\n        flat += shipyardFlat;\n        breakdown.push({ source: 'Shipyards (+2 per level)', value: shipyardFlat, kind: 'flat' });\n    }\n    // Buildings: Metal Refineries (by catalogKey)  add base metal yield per level\n    const refineryLevels = (ctx.buildingsAtBase || [])\n        .filter(b => b.isActive && (b.catalogKey || '') === 'metal_refineries')\n        .reduce((sum, b) => sum + Math.max(0, b.level || 0), 0);\n    const refineryFlat = refineryLevels * (ctx.locationDerived?.yieldsMetal || 0);\n    if (refineryFlat) {\n        flat += refineryFlat;\n        breakdown.push({ source: 'Metal Refineries (+metal yield per level)', value: refineryFlat, kind: 'flat' });\n    }\n    // Buildings: Robotic Factories (per-level flat +2)\n    const roboticLevelsProd = (ctx.buildingsAtBase || [])\n        .filter(b => b.isActive && (b.catalogKey || '') === 'robotic_factories')\n        .reduce((sum, b) => sum + Math.max(0, b.level || 0), 0);\n    const roboticFlatProd = roboticLevelsProd * ROBOTIC_FACTORY_PROD_PER_LEVEL;\n    if (roboticFlatProd) {\n        flat += roboticFlatProd;\n        breakdown.push({ source: 'Robotic Factories', value: roboticFlatProd, kind: 'flat' });\n    }\n    // Percent modifiers\n    let percent = 0;\n    // Tech: Cybernetics +5%\n    if (hasAtLeastLevel(ctx.techLevels, 'cybernetics', 1)) {\n        percent += 0.05;\n        breakdown.push({ source: 'Tech: Cybernetics +5%', value: 0.05, kind: 'percent' });\n    }\n    // Overhaul-derived: metal yield influences production capacity\n    if (typeof ctx.locationDerived?.yieldsMetal === 'number') {\n        const p = PROD_PCT_PER_METAL_YIELD_UNIT * (ctx.locationDerived.yieldsMetal || 0);\n        if (p) {\n            percent += p;\n            breakdown.push({ source: 'Environment: Metal Yield', value: p, kind: 'percent' });\n        }\n    }\n    // Commander hook (no-op if undefined)\n    if (typeof ctx.commander?.productionPct === 'number' && ctx.commander.productionPct) {\n        percent += ctx.commander.productionPct;\n        breakdown.push({ source: 'Commander Bonus', value: ctx.commander.productionPct, kind: 'percent' });\n    }\n    const value = finalizeCapacity(flat, percent);\n    return { value, breakdown };\n}\n// Research Capacity\n// Rules:\n// - Baseline: defaults.baseResearchCredPerHour (0)\n// - research_lab: +8 cred/h per level (isActive only)\n// - +5% if 'artificial_intelligence' >= 1\nexport function computeResearchCapacity(ctx) {\n    const breakdown = [];\n    // Baseline flat\n    let flat = ctx.defaults.baseResearchCredPerHour;\n    breakdown.push({ source: 'Baseline', value: flat, kind: 'flat' });\n    // Buildings: Research Labs\n    const labsFlat = (ctx.buildingsAtBase || [])\n        .filter(b => b.isActive && b.type === 'research_lab')\n        .reduce((sum, b) => sum + 8 * Math.max(0, b.level || 0), 0);\n    if (labsFlat > 0) {\n        flat += labsFlat;\n        breakdown.push({ source: 'Research Labs (+8 per level)', value: labsFlat, kind: 'flat' });\n    }\n    // Percent modifiers\n    let percent = 0;\n    // Tech: Artificial Intelligence +5%\n    if (hasAtLeastLevel(ctx.techLevels, 'artificial_intelligence', 1)) {\n        percent += 0.05;\n        breakdown.push({ source: 'Tech: Artificial Intelligence +5%', value: 0.05, kind: 'percent' });\n    }\n    // Overhaul-derived: fertility influences research capacity\n    if (typeof ctx.locationDerived?.fertility === 'number') {\n        const p = RESEARCH_PCT_PER_FERTILITY_UNIT * (ctx.locationDerived.fertility || 0);\n        if (p) {\n            percent += p;\n            breakdown.push({ source: 'Environment: Fertility', value: p, kind: 'percent' });\n        }\n    }\n    // Commander hook (no-op if undefined)\n    if (typeof ctx.commander?.researchPct === 'number' && ctx.commander.researchPct) {\n        percent += ctx.commander.researchPct;\n        breakdown.push({ source: 'Commander Bonus', value: ctx.commander.researchPct, kind: 'percent' });\n    }\n    const value = finalizeCapacity(flat, percent);\n    return { value, breakdown };\n}\n// Convenience: compute all three at once\nexport function computeAllCapacities(ctx) {\n    return {\n        construction: computeConstructionCapacity(ctx),\n        production: computeProductionCapacity(ctx),\n        research: computeResearchCapacity(ctx),\n    };\n}\n/**\n * Classify a CapacityResult.breakdown into grouped categories:\n * - baseline: \"Baseline\"\n * - buildings: Shipyards, Research Labs, Robotic/Nanite/Android Factories, Metal Refineries\n * - location: \"Environment: ...\"\n * - tech: \"Tech: ...\"\n * - commander: \"Commander Bonus\"\n * - other: any remaining entries\n *\n * This preserves existing CapacityResult API while enabling clearer UI sections.\n */\nexport function classifyCapacityBreakdown(items = []) {\n    const result = {\n        baseline: [],\n        buildings: [],\n        location: [],\n        tech: [],\n        commander: [],\n        other: [],\n    };\n    const isBuildingSource = (src) => src === 'Shipyards (+2 per level)' ||\n        src.startsWith('Research Labs') ||\n        src === 'Robotic Factories' ||\n        src === 'Nanite Factories' ||\n        src === 'Android Factories' ||\n        src.startsWith('Metal Refineries');\n    for (const item of items) {\n        const src = item.source || '';\n        if (src === 'Baseline') {\n            result.baseline.push(item);\n        }\n        else if (isBuildingSource(src)) {\n            result.buildings.push(item);\n        }\n        else if (src.startsWith('Environment:')) {\n            result.location.push(item);\n        }\n        else if (src.startsWith('Tech:')) {\n            result.tech.push(item);\n        }\n        else if (src === 'Commander Bonus') {\n            result.commander.push(item);\n        }\n        else {\n            result.other.push(item);\n        }\n    }\n    return result;\n}\n//# sourceMappingURL=capacities.js.map","import React from 'react';\r\n\r\ntype ProducerConsumerItem = {\r\n  key: string;\r\n  name: string;\r\n  value: number; // absolute contribution in energy units\r\n};\r\n\r\ntype EnergyBreakdownData = {\r\n  coord: string;\r\n  totals: {\r\n    produced: number;\r\n    consumed: number;\r\n    balance: number;\r\n    reservedNegative?: number; // optional future use\r\n  };\r\n  breakdown: {\r\n    baseline: number;\r\n    solar?: number;\r\n    gas?: number;\r\n    producers: ProducerConsumerItem[];\r\n    consumers: ProducerConsumerItem[];\r\n    reserved?: ProducerConsumerItem[]; // optional future use\r\n  };\r\n};\r\n\r\ntype Props = {\r\n  data: EnergyBreakdownData;\r\n};\r\n\r\nconst fmtEnergy = (n: number) => n.toLocaleString();\r\n\r\nconst SectionRow: React.FC<{ label: string; value: number; negative?: boolean }> = ({\r\n  label,\r\n  value,\r\n  negative,\r\n}) => {\r\n  if (!Number.isFinite(value) || value === 0) return null;\r\n  return (\r\n    <div className=\"flex justify-between text-sm\">\r\n      <span className=\"text-gray-300\">{label}</span>\r\n      <span className={negative ? 'text-red-300 font-mono' : 'text-gray-200 font-mono'}>\r\n        {negative ? '-' : '+'}\r\n        {fmtEnergy(Math.abs(value))}\r\n      </span>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Block: React.FC<{ title: string; children: React.ReactNode; total?: number; totalLabel?: string }> = ({\r\n  title,\r\n  children,\r\n  total,\r\n  totalLabel,\r\n}) => {\r\n  return (\r\n    <div className=\"mb-4 border border-gray-700 rounded-lg p-3\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <h4 className=\"font-semibold text-white\">{title}</h4>\r\n        {Number.isFinite(total) && (\r\n          <div className=\"text-sm text-gray-300\">\r\n            {totalLabel || 'Total'}:{' '}\r\n            <span className=\"font-mono\">{fmtEnergy(total as number)}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"space-y-1\">{children}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst EnergyBreakdownModal: React.FC<Props> = ({ data }) => {\r\n  if (!data) {\r\n    return <div className=\"text-gray-400 text-sm\">No energy data available.</div>;\r\n  }\r\n\r\n  const { coord, totals, breakdown } = data;\r\n\r\n  const producersSum =\r\n    (breakdown.baseline || 0) +\r\n    (breakdown.solar || 0) +\r\n    (breakdown.gas || 0) +\r\n    (breakdown.producers || []).reduce((s, it) => s + (it.value || 0), 0);\r\n\r\n  const consumersSum = (breakdown.consumers || []).reduce((s, it) => s + (it.value || 0), 0);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-sm text-gray-400\">\r\n        Base: <span className=\"text-white\">{coord}</span>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Produced</div>\r\n          <div className=\"mt-1 text-lg text-green-300 font-mono\">\r\n            +{fmtEnergy(totals.produced)}\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Consumed</div>\r\n          <div className=\"mt-1 text-lg text-red-300 font-mono\">\r\n            -{fmtEnergy(totals.consumed)}\r\n          </div>\r\n        </div>\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Balance</div>\r\n          <div className={`mt-1 text-lg font-mono ${totals.balance >= 0 ? 'text-green-300' : 'text-red-300'}`}>\r\n            {fmtEnergy(totals.balance)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <Block title=\"Produced\" total={producersSum} totalLabel=\"Produced\">\r\n        <div className=\"space-y-1\">\r\n          <div className=\"text-xs text-gray-400 uppercase tracking-wide\">Baseline & Context</div>\r\n          <SectionRow label=\"Baseline\" value={breakdown.baseline || 0} />\r\n          <SectionRow label=\"Solar Plants  solarEnergy\" value={breakdown.solar || 0} />\r\n          <SectionRow label=\"Gas Plants  gasYield\" value={breakdown.gas || 0} />\r\n        </div>\r\n\r\n        {(breakdown.producers || []).length > 0 && (\r\n          <div className=\"mt-2 space-y-1\">\r\n            <div className=\"text-xs text-gray-400 uppercase tracking-wide\">Other Producers</div>\r\n            {(breakdown.producers || []).map((p) => (\r\n              <SectionRow key={`p-${p.key}`} label={p.name} value={p.value} />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Block>\r\n\r\n      <Block title=\"Consumed\" total={consumersSum} totalLabel=\"Consumed\">\r\n        {(breakdown.consumers || []).length === 0 && (\r\n          <div className=\"text-sm text-gray-400\">No energy consumption from structures.</div>\r\n        )}\r\n        {(breakdown.consumers || []).map((c) => (\r\n          <SectionRow key={`c-${c.key}`} label={c.name} value={-Math.abs(c.value)} negative />\r\n        ))}\r\n      </Block>\r\n\r\n      {typeof totals.reservedNegative === 'number' || (breakdown.reserved && breakdown.reserved.length > 0) ? (\r\n        <Block title=\"Reserved (Queued Consumers)\">\r\n          {typeof totals.reservedNegative === 'number' && totals.reservedNegative !== 0 && (\r\n            <div className=\"flex justify-between text-sm\">\r\n              <span className=\"text-gray-300\">Reserved Total</span>\r\n              <span className=\"text-yellow-300 font-mono\">\r\n                {fmtEnergy(totals.reservedNegative)}\r\n              </span>\r\n            </div>\r\n          )}\r\n          {(breakdown.reserved || []).map((r) => (\r\n            <div key={`r-${r.key}`} className=\"flex justify-between text-sm\">\r\n              <span className=\"text-gray-300\">{r.name}</span>\r\n              <span className=\"text-yellow-300 font-mono\">{fmtEnergy(r.value)}</span>\r\n            </div>\r\n          ))}\r\n          {!breakdown.reserved || breakdown.reserved.length === 0 ? (\r\n            <div className=\"text-sm text-gray-500\">No queued reservations counted.</div>\r\n          ) : null}\r\n        </Block>\r\n      ) : null}\r\n\r\n      <div className=\"text-xs text-gray-500\">\r\n        Notes:\r\n        <ul className=\"list-disc ml-5 mt-1 space-y-1\">\r\n          <li>Baseline adds a constant +2 energy per base.</li>\r\n          <li>Solar/Gas plants scale by planet context (solarEnergy / gas yield).</li>\r\n          <li>Other structures use the catalog energyDelta per level.</li>\r\n          <li>Totals align with the shared helper used by both client and server.</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EnergyBreakdownModal;\r\n","import React from 'react';\r\n\r\ntype AreaUsageItem = {\r\n  key: string;\r\n  name: string;\r\n  value: number; // absolute area used (units)\r\n};\r\n\r\ntype AreaBreakdownData = {\r\n  coord: string;\r\n  totals: {\r\n    used: number;\r\n    free: number;\r\n    total: number;\r\n  };\r\n  breakdown: {\r\n    consumers: AreaUsageItem[];\r\n  };\r\n};\r\n\r\ntype Props = {\r\n  data: AreaBreakdownData;\r\n};\r\n\r\nconst fmt = (n: number) => n.toLocaleString();\r\n\r\nconst Row: React.FC<{ label: string; value: number }> = ({ label, value }) => {\r\n  if (!Number.isFinite(value) || value === 0) return null;\r\n  return (\r\n    <div className=\"flex justify-between text-sm\">\r\n      <span className=\"text-gray-300\">{label}</span>\r\n      <span className=\"text-gray-200 font-mono\">{fmt(value)}</span>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Block: React.FC<{ title: string; children: React.ReactNode; total?: number; totalLabel?: string }> = ({\r\n  title,\r\n  children,\r\n  total,\r\n  totalLabel,\r\n}) => {\r\n  return (\r\n    <div className=\"mb-4 border border-gray-700 rounded-lg p-3\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <h4 className=\"font-semibold text-white\">{title}</h4>\r\n        {Number.isFinite(total) && (\r\n          <div className=\"text-sm text-gray-300\">\r\n            {totalLabel || 'Total'}: <span className=\"font-mono\">{fmt(total as number)}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"space-y-1\">{children}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AreaBreakdownModal: React.FC<Props> = ({ data }) => {\r\n  if (!data) {\r\n    return <div className=\"text-gray-400 text-sm\">No area data available.</div>;\r\n  }\r\n\r\n  const { coord, totals, breakdown } = data;\r\n  const usedSum = (breakdown.consumers || []).reduce((s, it) => s + (it.value || 0), 0);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-sm text-gray-400\">\r\n        Base: <span className=\"text-white\">{coord}</span>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Used</div>\r\n          <div className=\"mt-1 text-lg text-gray-200 font-mono\">{fmt(totals.used)}</div>\r\n        </div>\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Free</div>\r\n          <div className=\"mt-1 text-lg text-green-300 font-mono\">{fmt(totals.free)}</div>\r\n        </div>\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Total</div>\r\n          <div className=\"mt-1 text-lg text-gray-200 font-mono\">{fmt(totals.total)}</div>\r\n        </div>\r\n      </div>\r\n\r\n      <Block title=\"Structures using area\" total={usedSum} totalLabel=\"Used\">\r\n        {(breakdown.consumers || []).length === 0 && (\r\n          <div className=\"text-sm text-gray-400\">No structures currently using area.</div>\r\n        )}\r\n        {(breakdown.consumers || []).map((c) => (\r\n          <Row key={`a-${c.key}`} label={c.name} value={c.value} />\r\n        ))}\r\n      </Block>\r\n\r\n      <div className=\"text-xs text-gray-500\">\r\n        Notes:\r\n        <ul className=\"list-disc ml-5 mt-1 space-y-1\">\r\n          <li>Totals are authoritative from the server Base Stats.</li>\r\n          <li>Per-structure area usage uses catalog areaRequired  level when available.</li>\r\n          <li>Some orbital structures may use 0 area.</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AreaBreakdownModal;\r\n","import React from 'react';\r\n\r\ntype PopItem = {\r\n  key: string;\r\n  name: string;\r\n  value: number; // absolute population units (people)\r\n};\r\n\r\ntype PopulationBreakdownData = {\r\n  coord: string;\r\n  totals: {\r\n    used: number;\r\n    capacity: number;\r\n    free: number;\r\n  };\r\n  breakdown: {\r\n    users?: PopItem[];    // populationRequired  level per structure (consumption)\r\n    sources?: PopItem[];  // capacity-providing sources (if available in catalog)\r\n  };\r\n};\r\n\r\ntype Props = {\r\n  data: PopulationBreakdownData;\r\n};\r\n\r\nconst fmt = (n: number) => n.toLocaleString();\r\n\r\nconst Row: React.FC<{ label: string; value: number }> = ({ label, value }) => {\r\n  if (!Number.isFinite(value) || value === 0) return null;\r\n  return (\r\n    <div className=\"flex justify-between text-sm\">\r\n      <span className=\"text-gray-300\">{label}</span>\r\n      <span className=\"text-gray-200 font-mono\">{fmt(value)}</span>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Block: React.FC<{ title: string; children: React.ReactNode; total?: number; totalLabel?: string }> = ({\r\n  title,\r\n  children,\r\n  total,\r\n  totalLabel\r\n}) => {\r\n  return (\r\n    <div className=\"mb-4 border border-gray-700 rounded-lg p-3\">\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <h4 className=\"font-semibold text-white\">{title}</h4>\r\n        {Number.isFinite(total) && (\r\n          <div className=\"text-sm text-gray-300\">\r\n            {totalLabel || 'Total'}: <span className=\"font-mono\">{fmt(total as number)}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"space-y-1\">{children}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst PopulationBreakdownModal: React.FC<Props> = ({ data }) => {\r\n  if (!data) {\r\n    return <div className=\"text-gray-400 text-sm\">No population data available.</div>;\r\n  }\r\n\r\n  const { coord, totals, breakdown } = data;\r\n\r\n  const users = breakdown.users || [];\r\n  const sources = breakdown.sources || [];\r\n\r\n  const usersSum = users.reduce((s, it) => s + (it.value || 0), 0);\r\n  const sourcesSum = sources.reduce((s, it) => s + (it.value || 0), 0);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-sm text-gray-400\">\r\n        Base: <span className=\"text-white\">{coord}</span>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Used</div>\r\n          <div className=\"mt-1 text-lg text-gray-200 font-mono\">{fmt(totals.used)}</div>\r\n        </div>\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Free</div>\r\n          <div className=\"mt-1 text-lg text-green-300 font-mono\">{fmt(totals.free)}</div>\r\n        </div>\r\n        <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n          <div className=\"text-xs text-gray-400\">Capacity</div>\r\n          <div className=\"mt-1 text-lg text-gray-200 font-mono\">{fmt(totals.capacity)}</div>\r\n        </div>\r\n      </div>\r\n\r\n      <Block title=\"Users (population required by structures)\" total={usersSum} totalLabel=\"Used\">\r\n        {users.length === 0 && (\r\n          <div className=\"text-sm text-gray-400\">No structures currently consuming population.</div>\r\n        )}\r\n        {users.map((u) => (\r\n          <Row key={`u-${u.key}`} label={u.name} value={u.value} />\r\n        ))}\r\n      </Block>\r\n\r\n      <Block title=\"Capacity Sources\" total={sourcesSum} totalLabel=\"Capacity\">\r\n        {sources.length === 0 ? (\r\n          <div className=\"text-sm text-gray-400\">\r\n            No per-building capacity sources are defined. Showing totals only.\r\n          </div>\r\n        ) : (\r\n          sources.map((s) => <Row key={`s-${s.key}`} label={s.name} value={s.value} />)\r\n        )}\r\n      </Block>\r\n\r\n      <div className=\"text-xs text-gray-500\">\r\n        Notes:\r\n        <ul className=\"list-disc ml-5 mt-1 space-y-1\">\r\n          <li>Totals (Used/Free/Capacity) are authoritative from the server Base Stats.</li>\r\n          <li>Users are computed from catalog populationRequired  current level per structure.</li>\r\n          <li>If capacity-providing fields are added to the catalog, they will appear under Capacity Sources.</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PopulationBreakdownModal;\r\n","import { getStructureCreditCostForLevel, hasCanonicalStructureCostForLevel, type BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\nimport { URBAN_STRUCTURES_ROWS, STRUCTURE_META as URBAN_META } from './urban_structures';\r\nimport { SOLAR_PLANTS_ROWS, STRUCTURE_META as SOLAR_META } from './solar_plants';\r\nimport { GAS_PLANTS_ROWS, STRUCTURE_META as GAS_META } from './gas_plants';\r\nimport { FUSION_PLANTS_ROWS, STRUCTURE_META as FUSION_META } from './fusion_plants';\r\nimport { RESEARCH_LABS_ROWS, STRUCTURE_META as RESEARCH_META } from './research_labs';\r\nimport { METAL_REFINERIES_ROWS, STRUCTURE_META as METAL_META } from './metal_refineries';\r\nimport { ROBOTIC_FACTORIES_ROWS, STRUCTURE_META as ROBOTIC_META } from './robotic_factories';\r\nimport { SHIPYARDS_ROWS, STRUCTURE_META as SHIPYARDS_META } from './shipyards';\r\nimport { ORBITAL_SHIPYARDS_ROWS, STRUCTURE_META as ORBITAL_SHIPYARDS_META } from './orbital_shipyards';\r\nimport { SPACEPORTS_ROWS, STRUCTURE_META as SPACEPORTS_META } from './spaceports';\r\nimport { COMMAND_CENTERS_ROWS, STRUCTURE_META as COMMAND_CENTERS_META } from './command_centers';\r\nimport { ANDROID_FACTORIES_ROWS, STRUCTURE_META as ANDROID_META } from './android_factories';\r\nimport { ECONOMIC_CENTERS_ROWS, STRUCTURE_META as ECONOMIC_CENTERS_META } from './economic_centers';\r\nimport { TERRAFORM_ROWS, STRUCTURE_META as TERRAFORM_META } from './terraform';\r\nimport { MULTI_LEVEL_PLATFORMS_ROWS, STRUCTURE_META as MULTI_LEVEL_PLATFORMS_META } from './multi_level_platforms';\r\nimport { ORBITAL_BASE_ROWS, STRUCTURE_META as ORBITAL_BASE_META } from './orbital_base';\r\nimport { CRYSTAL_MINES_ROWS, STRUCTURE_META as CRYSTAL_MINES_META } from './crystal_mines';\r\n\r\nconst computeSharedCredits = (key: BuildingKey, rows: LevelRow[]): LevelRow[] =>\r\n  rows\r\n    .filter((r) => hasCanonicalStructureCostForLevel(key, r.level))\r\n    .map((r) => ({\r\n      ...r,\r\n      credits: getStructureCreditCostForLevel(key, r.level),\r\n    }));\r\n\r\n// Aggregate map of structure level tables by BuildingKey\r\nexport const STRUCTURE_LEVEL_TABLES: Partial<Record<BuildingKey, LevelRow[]>> = {\r\n  urban_structures: computeSharedCredits('urban_structures', URBAN_STRUCTURES_ROWS),\r\n  solar_plants: computeSharedCredits('solar_plants', SOLAR_PLANTS_ROWS),\r\n  gas_plants: computeSharedCredits('gas_plants', GAS_PLANTS_ROWS),\r\n  fusion_plants: computeSharedCredits('fusion_plants', FUSION_PLANTS_ROWS),\r\n  research_labs: computeSharedCredits('research_labs', RESEARCH_LABS_ROWS),\r\n  metal_refineries: computeSharedCredits('metal_refineries', METAL_REFINERIES_ROWS),\r\n  robotic_factories: computeSharedCredits('robotic_factories', ROBOTIC_FACTORIES_ROWS),\r\n  shipyards: computeSharedCredits('shipyards', SHIPYARDS_ROWS),\r\n  orbital_shipyards: computeSharedCredits('orbital_shipyards', ORBITAL_SHIPYARDS_ROWS),\r\n  spaceports: computeSharedCredits('spaceports', SPACEPORTS_ROWS),\r\n  command_centers: computeSharedCredits('command_centers', COMMAND_CENTERS_ROWS),\r\n  android_factories: computeSharedCredits('android_factories', ANDROID_FACTORIES_ROWS),\r\n  economic_centers: computeSharedCredits('economic_centers', ECONOMIC_CENTERS_ROWS),\r\n  terraform: computeSharedCredits('terraform', TERRAFORM_ROWS),\r\n  multi_level_platforms: computeSharedCredits('multi_level_platforms', MULTI_LEVEL_PLATFORMS_ROWS),\r\n  orbital_base: computeSharedCredits('orbital_base', ORBITAL_BASE_ROWS),\r\n  crystal_mines: computeSharedCredits('crystal_mines', CRYSTAL_MINES_ROWS),\r\n  // Add more structure tables here as they are created\r\n};\r\n\r\n// Aggregate metadata map (title/subtitle) by BuildingKey\r\nexport const STRUCTURE_LEVEL_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  ...URBAN_META,\r\n  ...SOLAR_META,\r\n  ...GAS_META,\r\n  ...FUSION_META,\r\n  ...RESEARCH_META,\r\n  ...METAL_META,\r\n  ...ROBOTIC_META,\r\n  ...SHIPYARDS_META,\r\n  ...ORBITAL_SHIPYARDS_META,\r\n  ...SPACEPORTS_META,\r\n  ...COMMAND_CENTERS_META,\r\n  ...ANDROID_META,\r\n  ...ECONOMIC_CENTERS_META,\r\n  ...TERRAFORM_META,\r\n  ...MULTI_LEVEL_PLATFORMS_META,\r\n  ...ORBITAL_BASE_META,\r\n  ...CRYSTAL_MINES_META,\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\n\r\nexport type LevelRow = {\r\n  level: number;\r\n  credits: number;\r\n  populationCapacity?: number;\r\n  energyOutput?: number;\r\n  researchOutput?: number;\r\n  economyOutput?: number;\r\n  tradeRoutes?: number;\r\n  commandPoints?: number;\r\n  productionOutput?: number;\r\n  increasedArea?: number;\r\n};\r\n\r\n// Urban Structures\r\n// Title: Urban Structures\r\n// Subtitle: Each level increases population capacity by base fertility.\r\n// Columns: Level | Credits | Population Capacity\r\nexport const URBAN_STRUCTURES_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 1, populationCapacity: 7 },\r\n  { level: 2, credits: 2, populationCapacity: 14 },\r\n  { level: 3, credits: 3, populationCapacity: 21 },\r\n  { level: 4, credits: 4, populationCapacity: 28 },\r\n  { level: 5, credits: 6, populationCapacity: 35 },\r\n  { level: 6, credits: 8, populationCapacity: 42 },\r\n  { level: 7, credits: 12, populationCapacity: 49 },\r\n  { level: 8, credits: 18, populationCapacity: 56 },\r\n  { level: 9, credits: 26, populationCapacity: 63 },\r\n  { level: 10, credits: 39, populationCapacity: 70 },\r\n  { level: 11, credits: 58, populationCapacity: 77 },\r\n  { level: 12, credits: 87, populationCapacity: 84 },\r\n  { level: 13, credits: 130, populationCapacity: 91 },\r\n  { level: 14, credits: 195, populationCapacity: 98 },\r\n  { level: 15, credits: 292, populationCapacity: 105 },\r\n  { level: 16, credits: 438, populationCapacity: 112 },\r\n  { level: 17, credits: 657, populationCapacity: 119 },\r\n  { level: 18, credits: 986, populationCapacity: 126 },\r\n  { level: 19, credits: 1478, populationCapacity: 133 },\r\n  { level: 20, credits: 2217, populationCapacity: 140 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  urban_structures: {\r\n    title: 'Urban Structures',\r\n    subtitle: 'Each level increases population capacity by base fertility.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Solar Plants\r\n// Title: Solar Plants\r\n// Subtitle: Each level increases base energy output by base solar energy.\r\n// Columns: Level | Credits | Energy Output\r\nexport const SOLAR_PLANTS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 1, energyOutput: 3 },\r\n  { level: 2, credits: 2, energyOutput: 6 },\r\n  { level: 3, credits: 3, energyOutput: 9 },\r\n  { level: 4, credits: 4, energyOutput: 12 },\r\n  { level: 5, credits: 6, energyOutput: 15 },\r\n  { level: 6, credits: 8, energyOutput: 18 },\r\n  { level: 7, credits: 12, energyOutput: 21 },\r\n  { level: 8, credits: 18, energyOutput: 24 },\r\n  { level: 9, credits: 26, energyOutput: 27 },\r\n  { level: 10, credits: 39, energyOutput: 30 },\r\n  { level: 11, credits: 58, energyOutput: 33 },\r\n  { level: 12, credits: 87, energyOutput: 36 },\r\n  { level: 13, credits: 130, energyOutput: 39 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  solar_plants: {\r\n    title: 'Solar Plants',\r\n    subtitle: 'Each level increases base energy output by base solar energy.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Gas Plants\r\n// Title: Gas Plants\r\n// Subtitle: Each level increases base energy output by base gas resource.\r\n// Columns: Level | Credits | Energy Output\r\nexport const GAS_PLANTS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 1, energyOutput: 3 },\r\n  { level: 2, credits: 2, energyOutput: 6 },\r\n  { level: 3, credits: 3, energyOutput: 9 },\r\n  { level: 4, credits: 4, energyOutput: 12 },\r\n  { level: 5, credits: 6, energyOutput: 15 },\r\n  { level: 6, credits: 8, energyOutput: 18 },\r\n  { level: 7, credits: 12, energyOutput: 21 },\r\n  { level: 8, credits: 18, energyOutput: 24 },\r\n  { level: 9, credits: 26, energyOutput: 27 },\r\n  { level: 10, credits: 39, energyOutput: 30 },\r\n  { level: 11, credits: 58, energyOutput: 33 },\r\n  { level: 12, credits: 87, energyOutput: 36 },\r\n  { level: 13, credits: 130, energyOutput: 39 },\r\n  { level: 14, credits: 195, energyOutput: 42 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  gas_plants: {\r\n    title: 'Gas Plants',\r\n    subtitle: 'Each level increases base energy output by base gas resource.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Fusion Plants\r\n// Title: Fusion Plants\r\n// Subtitle: Each level increases base energy output by 4.\r\n// Columns: Level | Credits | Energy Output\r\nexport const FUSION_PLANTS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 20, energyOutput: 4 },\r\n  { level: 2, credits: 30, energyOutput: 8 },\r\n  { level: 3, credits: 45, energyOutput: 12 },\r\n  { level: 4, credits: 68, energyOutput: 16 },\r\n  { level: 5, credits: 102, energyOutput: 20 },\r\n  { level: 6, credits: 152, energyOutput: 24 },\r\n  { level: 7, credits: 228, energyOutput: 28 },\r\n  { level: 8, credits: 342, energyOutput: 32 },\r\n  { level: 9, credits: 513, energyOutput: 36 },\r\n  { level: 10, credits: 769, energyOutput: 40 },\r\n  { level: 11, credits: 1154, energyOutput: 44 },\r\n  { level: 12, credits: 1730, energyOutput: 48 },\r\n  { level: 13, credits: 2595, energyOutput: 52 },\r\n  { level: 14, credits: 3893, energyOutput: 56 },\r\n  { level: 15, credits: 5839, energyOutput: 60 },\r\n  { level: 16, credits: 8758, energyOutput: 64 },\r\n  { level: 17, credits: 13137, energyOutput: 68 },\r\n  { level: 18, credits: 19706, energyOutput: 72 },\r\n  { level: 19, credits: 29558, energyOutput: 76 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  fusion_plants: {\r\n    title: 'Fusion Plants',\r\n    subtitle: 'Each level increases base energy output by 4.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Research Labs\r\n// Title: Research Labs\r\n// Subtitle: Each level increases base research capacity by 8, and allows the research of more technologies.\r\n// Columns: Level | Credits | Research Output\r\nexport const RESEARCH_LABS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 2, researchOutput: 8 },\r\n  { level: 2, credits: 3, researchOutput: 16 },\r\n  { level: 3, credits: 5, researchOutput: 24 },\r\n  { level: 4, credits: 7, researchOutput: 32 },\r\n  { level: 5, credits: 11, researchOutput: 40 },\r\n  { level: 6, credits: 16, researchOutput: 48 },\r\n  { level: 7, credits: 23, researchOutput: 56 },\r\n  { level: 8, credits: 35, researchOutput: 64 },\r\n  { level: 9, credits: 52, researchOutput: 72 },\r\n  { level: 10, credits: 77, researchOutput: 80 },\r\n  { level: 11, credits: 116, researchOutput: 88 },\r\n  { level: 12, credits: 173, researchOutput: 96 },\r\n  { level: 13, credits: 260, researchOutput: 104 },\r\n  { level: 14, credits: 390, researchOutput: 112 },\r\n  { level: 15, credits: 584, researchOutput: 120 },\r\n  { level: 16, credits: 876, researchOutput: 128 },\r\n  { level: 17, credits: 1314, researchOutput: 136 },\r\n  { level: 18, credits: 1971, researchOutput: 144 },\r\n  { level: 19, credits: 2956, researchOutput: 152 },\r\n  { level: 20, credits: 4434, researchOutput: 160 },\r\n  { level: 21, credits: 6651, researchOutput: 168 },\r\n  { level: 22, credits: 9976, researchOutput: 176 },\r\n  { level: 23, credits: 14944, researchOutput: 184 },\r\n  { level: 24, credits: 22446, researchOutput: 192 },\r\n  { level: 25, credits: 33669, researchOutput: 200 },\r\n  { level: 26, credits: 50503, researchOutput: 208 },\r\n  { level: 27, credits: 75754, researchOutput: 216 },\r\n  { level: 28, credits: 113631, researchOutput: 224 },\r\n  { level: 29, credits: 170446, researchOutput: 232 },\r\n  { level: 30, credits: 255669, researchOutput: 240 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  research_labs: {\r\n    title: 'Research Labs',\r\n    subtitle: 'Each level increases base research capacity by 8, and allows the research of more technologies.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Metal Refineries\r\n// Title: Metal Refineries\r\n// Subtitle: Each level increases production and construction capacity by base metal resource.\r\n// Columns: Level | Credits | Production Output\r\nexport const METAL_REFINERIES_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 1, productionOutput: 3 },\r\n  { level: 2, credits: 2, productionOutput: 6 },\r\n  { level: 3, credits: 3, productionOutput: 9 },\r\n  { level: 4, credits: 4, productionOutput: 12 },\r\n  { level: 5, credits: 6, productionOutput: 15 },\r\n  { level: 6, credits: 8, productionOutput: 18 },\r\n  { level: 7, credits: 12, productionOutput: 21 },\r\n  { level: 8, credits: 18, productionOutput: 24 },\r\n  { level: 9, credits: 26, productionOutput: 27 },\r\n  { level: 10, credits: 39, productionOutput: 30 },\r\n  { level: 11, credits: 58, productionOutput: 33 },\r\n  { level: 12, credits: 87, productionOutput: 36 },\r\n  { level: 13, credits: 130, productionOutput: 39 },\r\n  { level: 14, credits: 195, productionOutput: 42 },\r\n  { level: 15, credits: 292, productionOutput: 45 },\r\n  { level: 16, credits: 438, productionOutput: 48 },\r\n  { level: 17, credits: 657, productionOutput: 51 },\r\n  { level: 18, credits: 986, productionOutput: 54 },\r\n  { level: 19, credits: 1478, productionOutput: 57 },\r\n  { level: 20, credits: 2217, productionOutput: 60 },\r\n  { level: 21, credits: 3326, productionOutput: 63 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  metal_refineries: {\r\n    title: 'Metal Refineries',\r\n    subtitle: 'Each level increases production and construction capacity by base metal resource.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Robotic Factories\r\n// Title: Robotic Factories\r\n// Subtitle: Each level increases production and construction capacity by 2.\r\n// Columns: Level | Credits | Production Output\r\nexport const ROBOTIC_FACTORIES_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 5, productionOutput: 2 },\r\n  { level: 2, credits: 8, productionOutput: 4 },\r\n  { level: 3, credits: 12, productionOutput: 6 },\r\n  { level: 4, credits: 17, productionOutput: 8 },\r\n  { level: 5, credits: 26, productionOutput: 10 },\r\n  { level: 6, credits: 38, productionOutput: 12 },\r\n  { level: 7, credits: 57, productionOutput: 14 },\r\n  { level: 8, credits: 86, productionOutput: 16 },\r\n  { level: 9, credits: 129, productionOutput: 18 },\r\n  { level: 10, credits: 193, productionOutput: 20 },\r\n  { level: 11, credits: 289, productionOutput: 22 },\r\n  { level: 12, credits: 433, productionOutput: 24 },\r\n  { level: 13, credits: 649, productionOutput: 26 },\r\n  { level: 14, credits: 974, productionOutput: 28 },\r\n  { level: 15, credits: 1460, productionOutput: 30 },\r\n  { level: 16, credits: 2190, productionOutput: 32 },\r\n  { level: 17, credits: 3285, productionOutput: 34 },\r\n];\r\n\r\n// Helper map for display metadata per structure\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  robotic_factories: {\r\n    title: 'Robotic Factories',\r\n    subtitle: 'Each level increases production and construction capacity by 2.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Shipyards\r\n// Title: Shipyards\r\n// Subtitle: Each level increases base production by 2 and allows the production of more units.\r\n// Columns: Level | Credits | Production Output\r\nexport const SHIPYARDS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 5, productionOutput: 2 },\r\n  { level: 2, credits: 8, productionOutput: 4 },\r\n  { level: 3, credits: 12, productionOutput: 6 },\r\n  { level: 4, credits: 17, productionOutput: 8 },\r\n  { level: 5, credits: 26, productionOutput: 10 },\r\n  { level: 6, credits: 38, productionOutput: 12 },\r\n  { level: 7, credits: 57, productionOutput: 14 },\r\n  { level: 8, credits: 86, productionOutput: 16 },\r\n  { level: 9, credits: 129, productionOutput: 18 },\r\n  { level: 10, credits: 193, productionOutput: 20 },\r\n  { level: 11, credits: 289, productionOutput: 22 },\r\n  { level: 12, credits: 433, productionOutput: 24 },\r\n  { level: 13, credits: 649, productionOutput: 26 },\r\n  { level: 14, credits: 974, productionOutput: 28 },\r\n  { level: 15, credits: 1460, productionOutput: 30 },\r\n  { level: 16, credits: 2190, productionOutput: 32 },\r\n  { level: 17, credits: 3285, productionOutput: 34 },\r\n  { level: 18, credits: 4927, productionOutput: 36 },\r\n  { level: 19, credits: 7390, productionOutput: 38 },\r\n  { level: 20, credits: 11085, productionOutput: 40 },\r\n  { level: 21, credits: 16627, productionOutput: 42 },\r\n  { level: 22, credits: 24940, productionOutput: 44 },\r\n  { level: 23, credits: 37410, productionOutput: 46 },\r\n  { level: 24, credits: 56114, productionOutput: 48 },\r\n  { level: 25, credits: 84171, productionOutput: 50 },\r\n  { level: 26, credits: 126256, productionOutput: 52 },\r\n  { level: 27, credits: 189384, productionOutput: 54 },\r\n  { level: 28, credits: 284076, productionOutput: 56 },\r\n  { level: 29, credits: 426114, productionOutput: 58 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  shipyards: {\r\n    title: 'Shipyards',\r\n    subtitle: 'Each level increases base production by 2 and allows the production of more units.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Orbital Shipyards\r\n// Title: Orbital Shipyards\r\n// Subtitle: Each level increases base production by 8, allows the production of more units and doesn't require area on the base.\r\n// Columns: Level | Credits | Production Output\r\nexport const ORBITAL_SHIPYARDS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 10000, productionOutput: 8 },\r\n  { level: 2, credits: 15000, productionOutput: 16 },\r\n  { level: 3, credits: 22500, productionOutput: 24 },\r\n  { level: 4, credits: 33750, productionOutput: 32 },\r\n  { level: 5, credits: 50625, productionOutput: 40 },\r\n  { level: 6, credits: 75938, productionOutput: 48 },\r\n  { level: 7, credits: 113907, productionOutput: 56 },\r\n  { level: 8, credits: 170860, productionOutput: 64 },\r\n  { level: 9, credits: 256290, productionOutput: 72 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  orbital_shipyards: {\r\n    title: 'Orbital Shipyards',\r\n    subtitle:\r\n      \"Each level increases base production by 8, allows the production of more units and doesn't require area on the base.\",\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Spaceports\r\n// Title: Spaceports\r\n// Subtitle: Each level increases base economy by 2 and allows trade routes.\r\n// Columns: Level | Credits | Economy Output\r\nexport const SPACEPORTS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 5, economyOutput: 2, tradeRoutes: 1 },\r\n  { level: 2, credits: 8, economyOutput: 4, tradeRoutes: 2 },\r\n  { level: 3, credits: 12, economyOutput: 6, tradeRoutes: 3 },\r\n  { level: 4, credits: 17, economyOutput: 8, tradeRoutes: 4 },\r\n  { level: 5, credits: 26, economyOutput: 10, tradeRoutes: 5 },\r\n  { level: 6, credits: 38, economyOutput: 12, tradeRoutes: 6 },\r\n  { level: 7, credits: 57, economyOutput: 14, tradeRoutes: 7 },\r\n  { level: 8, credits: 86, economyOutput: 16, tradeRoutes: 8 },\r\n  { level: 9, credits: 129, economyOutput: 18, tradeRoutes: 9 },\r\n  { level: 10, credits: 193, economyOutput: 20, tradeRoutes: 10 },\r\n  { level: 11, credits: 289, economyOutput: 22, tradeRoutes: 11 },\r\n  { level: 12, credits: 433, economyOutput: 24, tradeRoutes: 12 },\r\n  { level: 13, credits: 649, economyOutput: 26, tradeRoutes: 13 },\r\n  { level: 14, credits: 974, economyOutput: 28, tradeRoutes: 14 },\r\n  { level: 15, credits: 1460, economyOutput: 30, tradeRoutes: 15 },\r\n  { level: 16, credits: 2190, economyOutput: 32, tradeRoutes: 16 },\r\n  { level: 17, credits: 3285, economyOutput: 34, tradeRoutes: 17 },\r\n  { level: 18, credits: 4927, economyOutput: 36, tradeRoutes: 18 },\r\n  { level: 19, credits: 7390, economyOutput: 38, tradeRoutes: 19 },\r\n  { level: 20, credits: 11085, economyOutput: 40, tradeRoutes: 20 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  spaceports: {\r\n    title: 'Spaceports',\r\n    subtitle: 'Each level increases base economy by 2 and allows trade routes.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Command Centers\r\n// Title: Command Centers\r\n// Subtitle: Each level increases the number of occupied bases you can have by 1, and add 5% fleet attack power at base location.\r\n// Columns: Level | Credits | Command Points\r\nexport const COMMAND_CENTERS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 20, commandPoints: 1 },\r\n  { level: 2, credits: 30, commandPoints: 2 },\r\n  { level: 3, credits: 45, commandPoints: 3 },\r\n  { level: 4, credits: 68, commandPoints: 4 },\r\n  { level: 5, credits: 102, commandPoints: 5 },\r\n  { level: 6, credits: 152, commandPoints: 6 },\r\n  { level: 7, credits: 228, commandPoints: 7 },\r\n  { level: 8, credits: 342, commandPoints: 8 },\r\n  { level: 9, credits: 513, commandPoints: 9 },\r\n  { level: 10, credits: 769, commandPoints: 10 },\r\n  { level: 11, credits: 1154, commandPoints: 11 },\r\n  { level: 12, credits: 1730, commandPoints: 12 },\r\n  { level: 13, credits: 2595, commandPoints: 13 },\r\n  { level: 14, credits: 3893, commandPoints: 14 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  command_centers: {\r\n    title: 'Command Centers',\r\n    subtitle:\r\n      'Each level increases the number of occupied bases you can have by 1, and add 5% fleet attack power at base location.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Android Factories\r\n// Title: Android Factories\r\n// Subtitle: Each level increases production and construction capacity by 6.\r\n// Columns: Level | Credits | Production Output\r\nexport const ANDROID_FACTORIES_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 1000, productionOutput: 6 },\r\n  { level: 2, credits: 1500, productionOutput: 12 },\r\n  { level: 3, credits: 2250, productionOutput: 18 },\r\n  { level: 4, credits: 3375, productionOutput: 24 },\r\n  { level: 5, credits: 5063, productionOutput: 30 },\r\n  { level: 6, credits: 7594, productionOutput: 36 },\r\n  { level: 7, credits: 11391, productionOutput: 42 },\r\n  { level: 8, credits: 17086, productionOutput: 48 },\r\n  { level: 9, credits: 25629, productionOutput: 54 },\r\n  { level: 10, credits: 38444, productionOutput: 60 },\r\n  { level: 11, credits: 57666, productionOutput: 66 },\r\n  { level: 12, credits: 86498, productionOutput: 72 },\r\n];\r\n\r\n// Helper map for display metadata per structure\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  android_factories: {\r\n    title: 'Android Factories',\r\n    subtitle: 'Each level increases production and construction capacity by 6.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Economic Centers\r\n// Title: Economic Centers\r\n// Subtitle: Each level increases base economy by 3.\r\n// Columns: Level | Credits | Economy Output\r\nexport const ECONOMIC_CENTERS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 80, economyOutput: 3 },\r\n  { level: 2, credits: 120, economyOutput: 6 },\r\n  { level: 3, credits: 180, economyOutput: 9 },\r\n  { level: 4, credits: 270, economyOutput: 12 },\r\n  { level: 5, credits: 405, economyOutput: 15 },\r\n  { level: 6, credits: 608, economyOutput: 18 },\r\n  { level: 7, credits: 912, economyOutput: 21 },\r\n  { level: 8, credits: 1367, economyOutput: 24 },\r\n  { level: 9, credits: 2051, economyOutput: 27 },\r\n  { level: 10, credits: 3076, economyOutput: 30 },\r\n  { level: 11, credits: 4614, economyOutput: 33 },\r\n  { level: 12, credits: 6920, economyOutput: 36 },\r\n  { level: 13, credits: 10380, economyOutput: 39 },\r\n];\r\n\r\n// Helper map for display metadata per structure\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  economic_centers: {\r\n    title: 'Economic Centers',\r\n    subtitle: 'Each level increases base economy by 3.',\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Terraform\r\n// Title: Terraform\r\n// Subtitle: Each level increases base construction area by 5, doesn't require population.\r\n// Columns: Level | Credits | Increased Area\r\nexport const TERRAFORM_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 80, increasedArea: 5 },\r\n  { level: 2, credits: 120, increasedArea: 10 },\r\n  { level: 3, credits: 180, increasedArea: 15 },\r\n  { level: 4, credits: 270, increasedArea: 20 },\r\n  { level: 5, credits: 405, increasedArea: 25 },\r\n  { level: 6, credits: 608, increasedArea: 30 },\r\n  { level: 7, credits: 912, increasedArea: 35 },\r\n  { level: 8, credits: 1367, increasedArea: 40 },\r\n  { level: 9, credits: 2051, increasedArea: 45 },\r\n  { level: 10, credits: 3076, increasedArea: 50 },\r\n  { level: 11, credits: 4614, increasedArea: 55 },\r\n  { level: 12, credits: 6920, increasedArea: 60 },\r\n  { level: 13, credits: 10380, increasedArea: 65 },\r\n];\r\n\r\n// Helper map for display metadata per structure\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  terraform: {\r\n    title: 'Terraform',\r\n    subtitle: \"Each level increases base construction area by 5, doesn't require population.\",\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Multi-Level Platforms\r\n// Title: Multi-Level Platforms\r\n// Subtitle: Each level increases base construction area by 10, doesn't require population.\r\n// Columns: Level | Credits | Increased Area\r\nexport const MULTI_LEVEL_PLATFORMS_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 10000, increasedArea: 10 },\r\n  { level: 2, credits: 15000, increasedArea: 20 },\r\n  { level: 3, credits: 22500, increasedArea: 30 },\r\n  { level: 4, credits: 33750, increasedArea: 40 },\r\n  { level: 5, credits: 50625, increasedArea: 50 },\r\n  { level: 6, credits: 75938, increasedArea: 60 },\r\n  { level: 7, credits: 113907, increasedArea: 70 },\r\n  { level: 8, credits: 170860, increasedArea: 80 },\r\n  { level: 9, credits: 256290, increasedArea: 90 },\r\n  { level: 10, credits: 384434, increasedArea: 100 },\r\n  { level: 11, credits: 576651, increasedArea: 110 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  multi_level_platforms: {\r\n    title: 'Multi-Level Platforms',\r\n    subtitle: \"Each level increases base construction area by 10, doesn't require population.\",\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Orbital Base\r\n// Title: Orbital Base\r\n// Subtitle: Each level increase population capacity by 10 and doesn't require area on the base.\r\n// Columns: Level | Credits | Population Capacity\r\nexport const ORBITAL_BASE_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 2000, populationCapacity: 10 },\r\n  { level: 2, credits: 3000, populationCapacity: 20 },\r\n  { level: 3, credits: 4500, populationCapacity: 30 },\r\n  { level: 4, credits: 6750, populationCapacity: 40 },\r\n  { level: 5, credits: 10125, populationCapacity: 50 },\r\n  { level: 6, credits: 15188, populationCapacity: 60 },\r\n  { level: 7, credits: 22782, populationCapacity: 70 },\r\n  { level: 8, credits: 34172, populationCapacity: 80 },\r\n  { level: 9, credits: 51258, populationCapacity: 90 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  orbital_base: {\r\n    title: 'Orbital Base',\r\n    subtitle: \"Each level increase population capacity by 10 and doesn't require area on the base.\",\r\n  },\r\n};\r\n","import type { BuildingKey } from '@game/shared';\r\nimport type { LevelRow } from './urban_structures';\r\n\r\n// Crystal Mines\r\n// Title: Crystal Mines\r\n// Subtitle: Each level increases base economy by base crystals resource.\r\n// Columns: Level | Credits | Economy Output\r\nexport const CRYSTAL_MINES_ROWS: LevelRow[] = [\r\n  { level: 1, credits: 2, economyOutput: 2 },\r\n  { level: 2, credits: 3, economyOutput: 4 },\r\n  { level: 3, credits: 5, economyOutput: 6 },\r\n  { level: 4, credits: 7, economyOutput: 8 },\r\n  { level: 5, credits: 11, economyOutput: 10 },\r\n  { level: 6, credits: 16, economyOutput: 12 },\r\n  { level: 7, credits: 23, economyOutput: 14 },\r\n  { level: 8, credits: 35, economyOutput: 16 },\r\n];\r\n\r\n// Helper map for display metadata per structure (extensible)\r\nexport const STRUCTURE_META: Partial<Record<BuildingKey, { title: string; subtitle?: string }>> = {\r\n  crystal_mines: {\r\n    title: 'Crystal Mines',\r\n    subtitle: 'Economy output equals the bases crystals attribute (no baseline).',\r\n  },\r\n};\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { Colony, Building } from '@game/shared';\r\n\r\ninterface BaseData extends Omit<Colony, 'buildings'> {\r\n  buildings: Building[];\r\n  constructionQueue: Building[];\r\n}\r\n\r\ninterface BaseState {\r\n  // State\r\n  selectedBaseId: string | null;\r\n  bases: BaseData[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  \r\n  // Actions\r\n  setSelectedBase: (baseId: string | null) => void;\r\n  setBases: (bases: BaseData[]) => void;\r\n  updateBase: (baseId: string, updates: Partial<BaseData>) => void;\r\n  addBase: (base: BaseData) => void;\r\n  removeBase: (baseId: string) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setError: (error: string | null) => void;\r\n  \r\n  // Computed getters\r\n  getSelectedBase: () => BaseData | null;\r\n  getBaseById: (baseId: string) => BaseData | null;\r\n  getTotalBases: () => number;\r\n}\r\n\r\nexport const useBaseStore = create<BaseState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // Initial state\r\n      selectedBaseId: null,\r\n      bases: [],\r\n      loading: false,\r\n      error: null,\r\n\r\n      // Actions\r\n      setSelectedBase: (baseId) => set({ selectedBaseId: baseId }),\r\n      \r\n      setBases: (bases) => set({ bases, error: null }),\r\n      \r\n      updateBase: (baseId, updates) => set((state) => ({\r\n        bases: state.bases.map(base => \r\n          base._id === baseId ? { ...base, ...updates } : base\r\n        )\r\n      })),\r\n      \r\n      addBase: (base) => set((state) => ({\r\n        bases: [...state.bases, base]\r\n      })),\r\n      \r\n      removeBase: (baseId) => set((state) => ({\r\n        bases: state.bases.filter(base => base._id !== baseId),\r\n        selectedBaseId: state.selectedBaseId === baseId ? null : state.selectedBaseId\r\n      })),\r\n      \r\n      setLoading: (loading) => set({ loading }),\r\n      \r\n      setError: (error) => set({ error }),\r\n\r\n      // Computed getters\r\n      getSelectedBase: () => {\r\n        const state = get();\r\n        return state.selectedBaseId \r\n          ? state.bases.find(base => base._id === state.selectedBaseId) || null\r\n          : null;\r\n      },\r\n      \r\n      getBaseById: (baseId) => {\r\n        const state = get();\r\n        return state.bases.find(base => base._id === baseId) || null;\r\n      },\r\n      \r\n      getTotalBases: () => get().bases.length,\r\n      \r\n      // (Legacy per-hour production removed; capacities/economy to be added later)\r\n    }),\r\n    {\r\n      name: 'base-store',\r\n      partialize: (state) => ({ \r\n        selectedBaseId: state.selectedBaseId \r\n      })\r\n    }\r\n  )\r\n);\r\n","import React from 'react';\r\nimport type { BuildingKey } from '@game/shared';\r\nimport { STRUCTURE_LEVEL_TABLES, STRUCTURE_LEVEL_META } from './levelTables/structures';\r\nimport { useBaseStore } from '../../stores/baseStore';\r\nimport { universeService } from '../../services/universeService';\r\n\r\ninterface StructureLevelsModalProps {\r\n  structureKey: BuildingKey | undefined;\r\n}\r\n\r\nconst StructureLevelsModal: React.FC<StructureLevelsModalProps> = ({ structureKey }) => {\r\n  if (!structureKey) {\r\n    return (\r\n      <div className=\"text-center py-8\">\r\n        <p className=\"text-gray-400\">No structure selected.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const rows = STRUCTURE_LEVEL_TABLES[structureKey] || [];\r\n  const meta = STRUCTURE_LEVEL_META[structureKey];\r\n\r\n  // Dynamic per-base scaling for Metal Refineries (productionOutput)\r\n  const isMetalRefineries = structureKey === 'metal_refineries';\r\n  const isSolarPlants = structureKey === 'solar_plants';\r\n  const isGasPlants = structureKey === 'gas_plants';\r\n  const isUrbanStructures = structureKey === 'urban_structures';\r\n  const isCrystalMines = structureKey === 'crystal_mines';\r\n  const { selectedBaseId, bases } = useBaseStore((s) => ({\r\n    selectedBaseId: s.selectedBaseId,\r\n    bases: s.bases,\r\n  }));\r\n  const selectedBase = React.useMemo(\r\n    () => (selectedBaseId ? bases.find((b) => b._id === selectedBaseId) || null : null),\r\n    [selectedBaseId, bases]\r\n  );\r\n  const [metalRating, setMetalRating] = React.useState<number | null>(null);\r\n  const [solarRating, setSolarRating] = React.useState<number | null>(null);\r\n  const [gasRating, setGasRating] = React.useState<number | null>(null);\r\n  const [crystalRating, setCrystalRating] = React.useState<number | null>(null);\r\n  const [fertilityRating, setFertilityRating] = React.useState<number | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    let didCancel = false;\r\n    async function load() {\r\n      if (!isMetalRefineries) return;\r\n      const coord = selectedBase?.locationCoord;\r\n      if (!coord) {\r\n        if (!didCancel) setMetalRating(null);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await universeService.getLocationByCoord(coord);\r\n        if (res?.success && res.data) {\r\n          const d = res.data as any;\r\n          const rating =\r\n            d?.result?.yields?.metal ??\r\n            d?.terrain?.baseline?.metal ??\r\n            null;\r\n          if (!didCancel) setMetalRating(typeof rating === 'number' ? rating : null);\r\n        } else {\r\n          if (!didCancel) setMetalRating(null);\r\n        }\r\n      } catch {\r\n        if (!didCancel) setMetalRating(null);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      didCancel = true;\r\n    };\r\n  }, [isMetalRefineries, selectedBase?.locationCoord]);\r\n\r\n  // Dynamic per-base scaling for Solar Plants (energyOutput)\r\n  React.useEffect(() => {\r\n    let didCancel = false;\r\n    async function load() {\r\n      if (!isSolarPlants) return;\r\n      const coord = selectedBase?.locationCoord;\r\n      if (!coord) {\r\n        if (!didCancel) setSolarRating(null);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await universeService.getLocationByCoord(coord);\r\n        if (res?.success && res.data) {\r\n          const d = res.data as any;\r\n          const rating =\r\n            d?.result?.solarEnergy ??\r\n            d?.positionBase?.solarEnergy ??\r\n            null;\r\n          if (!didCancel) setSolarRating(typeof rating === 'number' ? rating : null);\r\n        } else {\r\n          if (!didCancel) setSolarRating(null);\r\n        }\r\n      } catch {\r\n        if (!didCancel) setSolarRating(null);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      didCancel = true;\r\n    };\r\n  }, [isSolarPlants, selectedBase?.locationCoord]);\r\n\r\n  // Dynamic per-base scaling for Gas Plants (energyOutput depends on gas rating)\r\n  React.useEffect(() => {\r\n    let didCancel = false;\r\n    async function load() {\r\n      if (!isGasPlants) return;\r\n      const coord = selectedBase?.locationCoord;\r\n      if (!coord) {\r\n        if (!didCancel) setGasRating(null);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await universeService.getLocationByCoord(coord);\r\n        if (res?.success && res.data) {\r\n          const d = res.data as any;\r\n          const rating =\r\n            d?.result?.yields?.gas ??\r\n            d?.terrain?.baseline?.gas ??\r\n            null;\r\n          if (!didCancel) setGasRating(typeof rating === 'number' ? rating : null);\r\n        } else {\r\n          if (!didCancel) setGasRating(null);\r\n        }\r\n      } catch {\r\n        if (!didCancel) setGasRating(null);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      didCancel = true;\r\n    };\r\n  }, [isGasPlants, selectedBase?.locationCoord]);\r\n\r\n  // Dynamic per-base scaling for Crystal Mines (economyOutput depends on crystals rating)\r\n  React.useEffect(() => {\r\n    let didCancel = false;\r\n    async function load() {\r\n      if (!isCrystalMines) return;\r\n      const coord = selectedBase?.locationCoord;\r\n      if (!coord) {\r\n        if (!didCancel) setCrystalRating(null);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await universeService.getLocationByCoord(coord);\r\n        if (res?.success && res.data) {\r\n          const d = res.data as any;\r\n          const rating =\r\n            d?.result?.yields?.crystals ??\r\n            d?.terrain?.baseline?.crystals ??\r\n            null;\r\n          if (!didCancel) setCrystalRating(typeof rating === 'number' ? rating : null);\r\n        } else {\r\n          if (!didCancel) setCrystalRating(null);\r\n        }\r\n      } catch {\r\n        if (!didCancel) setCrystalRating(null);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      didCancel = true;\r\n    };\r\n  }, [isCrystalMines, selectedBase?.locationCoord]);\r\n\r\n  // Dynamic per-base scaling for Urban Structures (populationCapacity depends on fertility)\r\n  React.useEffect(() => {\r\n    let didCancel = false;\r\n    async function load() {\r\n      if (!isUrbanStructures) return;\r\n      const coord = selectedBase?.locationCoord;\r\n      if (!coord) {\r\n        if (!didCancel) setFertilityRating(null);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await universeService.getLocationByCoord(coord);\r\n        if (res?.success && res.data) {\r\n          const d = res.data as any;\r\n          const rating =\r\n            d?.result?.fertility ??\r\n            d?.positionBase?.fertility ??\r\n            d?.terrain?.baseline?.fertility ??\r\n            null;\r\n          if (!didCancel) setFertilityRating(typeof rating === 'number' ? rating : null);\r\n        } else {\r\n          if (!didCancel) setFertilityRating(null);\r\n        }\r\n      } catch {\r\n        if (!didCancel) setFertilityRating(null);\r\n      }\r\n    }\r\n    load();\r\n    return () => {\r\n      didCancel = true;\r\n    };\r\n  }, [isUrbanStructures, selectedBase?.locationCoord]);\r\n\r\n  // Detect optional columns based on data present\r\n  const hasPopulationCapacity = rows.some((r) => typeof r.populationCapacity === 'number');\r\n  const hasEnergyOutput = rows.some((r: any) => typeof (r as any).energyOutput === 'number');\r\n  const hasResearchOutput = rows.some((r: any) => typeof (r as any).researchOutput === 'number');\r\n  const hasEconomyOutput = rows.some((r: any) => typeof (r as any).economyOutput === 'number');\r\n  const hasTradeRoutes = rows.some((r: any) => typeof (r as any).tradeRoutes === 'number');\r\n  const hasCommandPoints = rows.some((r: any) => typeof (r as any).commandPoints === 'number');\r\n  const hasProductionOutput = rows.some((r: any) => typeof (r as any).productionOutput === 'number');\r\n  const hasIncreasedArea = rows.some((r: any) => typeof (r as any).increasedArea === 'number');\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {/* Title + Subtitle (redundant with modal title but keeps context when reused) */}\r\n      {meta?.subtitle && (\r\n        <div className=\"text-sm text-gray-300\">{meta.subtitle}</div>\r\n      )}\r\n      {isMetalRefineries && (\r\n        <div className=\"text-xs text-gray-400\">\r\n          {metalRating != null\r\n            ? `Adjusted for base metal rating: ${metalRating} (baseline 3).`\r\n            : 'Baseline shown: metal rating 3. Actual output varies by base.'}\r\n        </div>\r\n      )}\r\n      {isSolarPlants && (\r\n        <div className=\"text-xs text-gray-400\">\r\n          {solarRating != null\r\n            ? `Adjusted for base solar energy: ${solarRating} (baseline 3).`\r\n            : 'Baseline shown: solar energy 3. Actual output varies by base.'}\r\n        </div>\r\n      )}\r\n      {isGasPlants && (\r\n        <div className=\"text-xs text-gray-400\">\r\n          {gasRating != null\r\n            ? `Adjusted for base gas rating: ${gasRating} (baseline 3).`\r\n            : 'Baseline shown: gas rating 3. Actual output varies by base.'}\r\n        </div>\r\n      )}\r\n      {isCrystalMines && (\r\n        <div className=\"text-xs text-gray-400\">\r\n          {crystalRating != null\r\n            ? `Economy output equals base crystals attribute. Using crystals: ${crystalRating}.`\r\n            : 'Crystals unavailable for this base; showing static table values.'}\r\n        </div>\r\n      )}\r\n      {isUrbanStructures && (\r\n        <div className=\"text-xs text-gray-400\">\r\n          {fertilityRating != null\r\n            ? `Population capacity at level = fertility  level. Using fertility: ${fertilityRating}.`\r\n            : 'Fertility unavailable for this base; showing static table values.'}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Level</th>\r\n              <th className=\"py-2 px-3 text-left\">Credits</th>\r\n              {hasPopulationCapacity && (\r\n                <th className=\"py-2 px-3 text-left\">Population Capacity</th>\r\n              )}\r\n              {hasEnergyOutput && (\r\n                <th className=\"py-2 px-3 text-left\">Energy Output</th>\r\n              )}\r\n              {hasResearchOutput && (\r\n                <th className=\"py-2 px-3 text-left\">Research Output</th>\r\n              )}\r\n              {hasEconomyOutput && (\r\n                <th className=\"py-2 px-3 text-left\">Economy Output</th>\r\n              )}\r\n              {hasTradeRoutes && (\r\n                <th className=\"py-2 px-3 text-left\">Trade Routes</th>\r\n              )}\r\n              {hasCommandPoints && (\r\n                <th className=\"py-2 px-3 text-left\">Command Points</th>\r\n              )}\r\n              {hasProductionOutput && (\r\n                <th className=\"py-2 px-3 text-left\">Production Output</th>\r\n              )}\r\n              {hasIncreasedArea && (\r\n                <th className=\"py-2 px-3 text-left\">Increased Area</th>\r\n              )}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows.length === 0 ? (\r\n              <tr>\r\n                <td\r\n                  colSpan={\r\n                    2 +\r\n                    (hasPopulationCapacity ? 1 : 0) +\r\n                    (hasEnergyOutput ? 1 : 0) +\r\n                    (hasResearchOutput ? 1 : 0) +\r\n                    (hasEconomyOutput ? 1 : 0) +\r\n                    (hasTradeRoutes ? 1 : 0) +\r\n                    (hasCommandPoints ? 1 : 0) +\r\n                    (hasProductionOutput ? 1 : 0) +\r\n                    (hasIncreasedArea ? 1 : 0)\r\n                  }\r\n                >\r\n                  No level data available yet.\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              rows.map((r) => (\r\n                <tr key={r.level} className=\"border-b border-gray-800\">\r\n                  <td className=\"py-2 px-3 text-gray-200\">{r.level}</td>\r\n                  <td className=\"py-2 px-3 text-gray-200\">{r.credits.toLocaleString()}</td>\r\n                  {hasPopulationCapacity && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {isUrbanStructures\r\n                        ? (fertilityRating != null\r\n                            ? Math.round(r.level * fertilityRating).toLocaleString()\r\n                            : (typeof r.populationCapacity === 'number' ? r.populationCapacity.toLocaleString() : ''))\r\n                        : (typeof r.populationCapacity === 'number' ? r.populationCapacity.toLocaleString() : '')}\r\n                    </td>\r\n                  )}\r\n                  {hasEnergyOutput && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof (r as any).energyOutput === 'number'\r\n                        ? (isSolarPlants\r\n                            ? Math.round(\r\n                                ((r as any).energyOutput as number) * ((solarRating ?? 3) / 3)\r\n                              ).toLocaleString()\r\n                            : isGasPlants\r\n                            ? Math.round(\r\n                                ((r as any).energyOutput as number) * ((gasRating ?? 3) / 3)\r\n                              ).toLocaleString()\r\n                            : (r as any).energyOutput.toLocaleString())\r\n                        : ''}\r\n                    </td>\r\n                  )}\r\n                  {hasResearchOutput && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof (r as any).researchOutput === 'number' ? (r as any).researchOutput.toLocaleString() : ''}\r\n                    </td>\r\n                  )}\r\n                  {hasEconomyOutput && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof (r as any).economyOutput === 'number'\r\n                        ? (isCrystalMines\r\n                            ? (crystalRating != null\r\n                                ? Math.round(crystalRating).toLocaleString()\r\n                                : (r as any).economyOutput.toLocaleString())\r\n                            : (r as any).economyOutput.toLocaleString())\r\n                        : ''}\r\n                    </td>\r\n                  )}\r\n                  {hasTradeRoutes && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof (r as any).tradeRoutes === 'number' ? (r as any).tradeRoutes.toLocaleString() : ''}\r\n                    </td>\r\n                  )}\r\n                  {hasCommandPoints && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof (r as any).commandPoints === 'number' ? (r as any).commandPoints.toLocaleString() : ''}\r\n                    </td>\r\n                  )}\r\n                  {hasProductionOutput && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof (r as any).productionOutput === 'number'\r\n                        ? (isMetalRefineries\r\n                            ? Math.round(\r\n                                ((r as any).productionOutput as number) * ((metalRating ?? 3) / 3)\r\n                              ).toLocaleString()\r\n                            : (r as any).productionOutput.toLocaleString())\r\n                        : ''}\r\n                    </td>\r\n                  )}\r\n                  {hasIncreasedArea && (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof (r as any).increasedArea === 'number'\r\n                        ? (r as any).increasedArea.toLocaleString()\r\n                        : ''}\r\n                    </td>\r\n                  )}\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StructureLevelsModal;\r\n","export const ENERGY_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, baseEnergyOutputPct: 100 },\r\n  { level: 1, credits: 2, baseEnergyOutputPct: 105, labs: 1, requires: '' },\r\n  { level: 2, credits: 3, baseEnergyOutputPct: 110 },\r\n  { level: 3, credits: 5, baseEnergyOutputPct: 115 },\r\n  { level: 4, credits: 7, baseEnergyOutputPct: 120 },\r\n  { level: 5, credits: 11, baseEnergyOutputPct: 125 },\r\n  { level: 6, credits: 16, baseEnergyOutputPct: 130 },\r\n  { level: 7, credits: 23, baseEnergyOutputPct: 135 },\r\n  { level: 8, credits: 35, baseEnergyOutputPct: 140 },\r\n  { level: 9, credits: 52, baseEnergyOutputPct: 145 },\r\n  { level: 10, credits: 77, baseEnergyOutputPct: 150 },\r\n  { level: 11, credits: 116, baseEnergyOutputPct: 155 },\r\n  { level: 12, credits: 173, baseEnergyOutputPct: 160 },\r\n  { level: 13, credits: 260, baseEnergyOutputPct: 165 },\r\n  { level: 14, credits: 390, baseEnergyOutputPct: 170 },\r\n  { level: 15, credits: 584, baseEnergyOutputPct: 175 },\r\n  { level: 16, credits: 876, baseEnergyOutputPct: 180 },\r\n  { level: 17, credits: 1314, baseEnergyOutputPct: 185 },\r\n  { level: 18, credits: 1971, baseEnergyOutputPct: 190 },\r\n  { level: 19, credits: 2956, baseEnergyOutputPct: 195 },\r\n  { level: 20, credits: 4434, baseEnergyOutputPct: 200 },\r\n  { level: 21, credits: 6651, baseEnergyOutputPct: 205 },\r\n  { level: 22, credits: 9976, baseEnergyOutputPct: 210 },\r\n  { level: 23, credits: 14964, baseEnergyOutputPct: 215 },\r\n  { level: 24, credits: 22446, baseEnergyOutputPct: 220 },\r\n  { level: 25, credits: 33669, baseEnergyOutputPct: 225 }\r\n] as const;\r\n","export const COMPUTER_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, campaignFleets: 0 },\r\n  { level: 1, credits: 2, campaignFleets: 1, labs: 1, requires: '' },\r\n  { level: 2, credits: 3, campaignFleets: 2 },\r\n  { level: 3, credits: 5, campaignFleets: 3 },\r\n  { level: 4, credits: 7, campaignFleets: 4 },\r\n  { level: 5, credits: 11, campaignFleets: 5 },\r\n  { level: 6, credits: 16, campaignFleets: 6 },\r\n  { level: 7, credits: 23, campaignFleets: 7 },\r\n  { level: 8, credits: 35, campaignFleets: 8 },\r\n  { level: 9, credits: 52, campaignFleets: 9 },\r\n  { level: 10, credits: 77, campaignFleets: 10 },\r\n  { level: 11, credits: 116, campaignFleets: 11 },\r\n  { level: 12, credits: 173, campaignFleets: 12 },\r\n  { level: 13, credits: 260, campaignFleets: 13 },\r\n  { level: 14, credits: 390, campaignFleets: 14 },\r\n  { level: 15, credits: 584, campaignFleets: 15 },\r\n  { level: 16, credits: 876, campaignFleets: 16 },\r\n  { level: 17, credits: 1314, campaignFleets: 17 },\r\n  { level: 18, credits: 1971, campaignFleets: 18 },\r\n  { level: 19, credits: 2956, campaignFleets: 19 },\r\n  { level: 20, credits: 4434, campaignFleets: 20 },\r\n  { level: 21, credits: 6651, campaignFleets: 21 },\r\n  { level: 22, credits: 9976, campaignFleets: 22 },\r\n  { level: 23, credits: 14964, campaignFleets: 23 },\r\n  { level: 24, credits: 22446, campaignFleets: 24 },\r\n  { level: 25, credits: 33669, campaignFleets: 25 }\r\n] as const;\r\n","export const ARMOUR_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, unitsArmourPct: 100 },\r\n  { level: 1, credits: 4, unitsArmourPct: 105, labs: 2, requires: '' },\r\n  { level: 2, credits: 6, unitsArmourPct: 110 },\r\n  { level: 3, credits: 9, unitsArmourPct: 115 },\r\n  { level: 4, credits: 14, unitsArmourPct: 120 },\r\n  { level: 5, credits: 21, unitsArmourPct: 125 },\r\n  { level: 6, credits: 31, unitsArmourPct: 130 },\r\n  { level: 7, credits: 46, unitsArmourPct: 135 },\r\n  { level: 8, credits: 69, unitsArmourPct: 140 },\r\n  { level: 9, credits: 103, unitsArmourPct: 145 },\r\n  { level: 10, credits: 154, unitsArmourPct: 150 },\r\n  { level: 11, credits: 231, unitsArmourPct: 155 },\r\n  { level: 12, credits: 346, unitsArmourPct: 160 },\r\n  { level: 13, credits: 519, unitsArmourPct: 165 },\r\n  { level: 14, credits: 779, unitsArmourPct: 170 },\r\n  { level: 15, credits: 1168, unitsArmourPct: 175 },\r\n  { level: 16, credits: 1752, unitsArmourPct: 180 },\r\n  { level: 17, credits: 2628, unitsArmourPct: 185 },\r\n  { level: 18, credits: 3942, unitsArmourPct: 190 },\r\n  { level: 19, credits: 5912, unitsArmourPct: 195 },\r\n  { level: 20, credits: 8868, unitsArmourPct: 200 },\r\n  { level: 21, credits: 13302, unitsArmourPct: 205 },\r\n  { level: 22, credits: 19952, unitsArmourPct: 210 },\r\n  { level: 23, credits: 29928, unitsArmourPct: 215 },\r\n  { level: 24, credits: 44891, unitsArmourPct: 220 },\r\n  { level: 25, credits: 67337, unitsArmourPct: 225 },\r\n  { level: 26, credits: 101005, unitsArmourPct: 230 },\r\n  { level: 27, credits: 151508, unitsArmourPct: 235 },\r\n  { level: 28, credits: 227261, unitsArmourPct: 240 },\r\n  { level: 29, credits: 340891, unitsArmourPct: 245 },\r\n  { level: 30, credits: 511337, unitsArmourPct: 250 }\r\n] as const;\r\n","export const LASER_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, laserWeaponsAttackPct: 100 },\r\n  { level: 1, credits: 4, laserWeaponsAttackPct: 105, labs: 2, requires: '' },\r\n  { level: 2, credits: 6, laserWeaponsAttackPct: 110 },\r\n  { level: 3, credits: 9, laserWeaponsAttackPct: 115 },\r\n  { level: 4, credits: 14, laserWeaponsAttackPct: 120 },\r\n  { level: 5, credits: 21, laserWeaponsAttackPct: 125 },\r\n  { level: 6, credits: 31, laserWeaponsAttackPct: 130 },\r\n  { level: 7, credits: 46, laserWeaponsAttackPct: 135 },\r\n  { level: 8, credits: 69, laserWeaponsAttackPct: 140 },\r\n  { level: 9, credits: 103, laserWeaponsAttackPct: 145 },\r\n  { level: 10, credits: 154, laserWeaponsAttackPct: 150 },\r\n  { level: 11, credits: 231, laserWeaponsAttackPct: 155 },\r\n  { level: 12, credits: 346, laserWeaponsAttackPct: 160 },\r\n  { level: 13, credits: 519, laserWeaponsAttackPct: 165 },\r\n  { level: 14, credits: 779, laserWeaponsAttackPct: 170 },\r\n  { level: 15, credits: 1168, laserWeaponsAttackPct: 175 },\r\n  { level: 16, credits: 1752, laserWeaponsAttackPct: 180 },\r\n  { level: 17, credits: 2628, laserWeaponsAttackPct: 185 },\r\n  { level: 18, credits: 3942, laserWeaponsAttackPct: 190 },\r\n  { level: 19, credits: 5912, laserWeaponsAttackPct: 195 },\r\n  { level: 20, credits: 8868, laserWeaponsAttackPct: 200 },\r\n  { level: 21, credits: 13302, laserWeaponsAttackPct: 205 },\r\n  { level: 22, credits: 19952, laserWeaponsAttackPct: 210 },\r\n  { level: 23, credits: 29928, laserWeaponsAttackPct: 215 },\r\n  { level: 24, credits: 44891, laserWeaponsAttackPct: 220 },\r\n  { level: 25, credits: 67337, laserWeaponsAttackPct: 225 },\r\n  { level: 26, credits: 101005, laserWeaponsAttackPct: 230 },\r\n  { level: 27, credits: 151508, laserWeaponsAttackPct: 235 },\r\n  { level: 28, credits: 227261, laserWeaponsAttackPct: 240 },\r\n  { level: 29, credits: 340891, laserWeaponsAttackPct: 245 },\r\n  { level: 30, credits: 511337, laserWeaponsAttackPct: 250 }\r\n] as const;\r\n","export const MISSILES_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, missilesWeaponsAttackPct: 100 },\r\n  { level: 1, credits: 8, missilesWeaponsAttackPct: 105, labs: 4, requires: '' },\r\n  { level: 2, credits: 12, missilesWeaponsAttackPct: 110 },\r\n  { level: 3, credits: 18, missilesWeaponsAttackPct: 115 },\r\n  { level: 4, credits: 27, missilesWeaponsAttackPct: 120 },\r\n  { level: 5, credits: 41, missilesWeaponsAttackPct: 125 },\r\n  { level: 6, credits: 61, missilesWeaponsAttackPct: 130 },\r\n  { level: 7, credits: 92, missilesWeaponsAttackPct: 135 },\r\n  { level: 8, credits: 137, missilesWeaponsAttackPct: 140 },\r\n  { level: 9, credits: 206, missilesWeaponsAttackPct: 145 },\r\n  { level: 10, credits: 308, missilesWeaponsAttackPct: 150 },\r\n  { level: 11, credits: 462, missilesWeaponsAttackPct: 155 },\r\n  { level: 12, credits: 692, missilesWeaponsAttackPct: 160 },\r\n  { level: 13, credits: 1038, missilesWeaponsAttackPct: 165 },\r\n  { level: 14, credits: 1558, missilesWeaponsAttackPct: 170 },\r\n  { level: 15, credits: 2336, missilesWeaponsAttackPct: 175 },\r\n  { level: 16, credits: 3504, missilesWeaponsAttackPct: 180 },\r\n  { level: 17, credits: 5256, missilesWeaponsAttackPct: 185 },\r\n  { level: 18, credits: 7884, missilesWeaponsAttackPct: 190 },\r\n  { level: 19, credits: 11824, missilesWeaponsAttackPct: 195 },\r\n  { level: 20, credits: 17736, missilesWeaponsAttackPct: 200 },\r\n  { level: 21, credits: 26604, missilesWeaponsAttackPct: 205 },\r\n  { level: 22, credits: 39904, missilesWeaponsAttackPct: 210 },\r\n  { level: 23, credits: 59856, missilesWeaponsAttackPct: 215 },\r\n  { level: 24, credits: 89782, missilesWeaponsAttackPct: 220 },\r\n  { level: 25, credits: 134674, missilesWeaponsAttackPct: 225 },\r\n  { level: 26, credits: 202010, missilesWeaponsAttackPct: 230 },\r\n  { level: 27, credits: 303016, missilesWeaponsAttackPct: 235 },\r\n  { level: 28, credits: 454522, missilesWeaponsAttackPct: 240 },\r\n  { level: 29, credits: 681782, missilesWeaponsAttackPct: 245 },\r\n  { level: 30, credits: 1022674, missilesWeaponsAttackPct: 250 }\r\n] as const;\r\n","export const STELLAR_DRIVE_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, stellarUnitsSpeedPct: 100 },\r\n  { level: 1, credits: 16, stellarUnitsSpeedPct: 105, labs: 5, requires: '' },\r\n  { level: 2, credits: 24, stellarUnitsSpeedPct: 110 },\r\n  { level: 3, credits: 36, stellarUnitsSpeedPct: 115 },\r\n  { level: 4, credits: 54, stellarUnitsSpeedPct: 120 },\r\n  { level: 5, credits: 81, stellarUnitsSpeedPct: 125 },\r\n  { level: 6, credits: 122, stellarUnitsSpeedPct: 130 },\r\n  { level: 7, credits: 183, stellarUnitsSpeedPct: 135 },\r\n  { level: 8, credits: 274, stellarUnitsSpeedPct: 140 },\r\n  { level: 9, credits: 411, stellarUnitsSpeedPct: 145 },\r\n  { level: 10, credits: 616, stellarUnitsSpeedPct: 150 },\r\n  { level: 11, credits: 923, stellarUnitsSpeedPct: 155 },\r\n  { level: 12, credits: 1384, stellarUnitsSpeedPct: 160 },\r\n\r\n  // Continuing pattern based on Laser credits * 4 (rounded) to level 30\r\n  { level: 13, credits: 2076, stellarUnitsSpeedPct: 165 },\r\n  { level: 14, credits: 3116, stellarUnitsSpeedPct: 170 },\r\n  { level: 15, credits: 4672, stellarUnitsSpeedPct: 175 },\r\n  { level: 16, credits: 7008, stellarUnitsSpeedPct: 180 },\r\n  { level: 17, credits: 10512, stellarUnitsSpeedPct: 185 },\r\n  { level: 18, credits: 15768, stellarUnitsSpeedPct: 190 },\r\n  { level: 19, credits: 23648, stellarUnitsSpeedPct: 195 },\r\n  { level: 20, credits: 35472, stellarUnitsSpeedPct: 200 },\r\n  { level: 21, credits: 53208, stellarUnitsSpeedPct: 205 },\r\n  { level: 22, credits: 79808, stellarUnitsSpeedPct: 210 },\r\n  { level: 23, credits: 119712, stellarUnitsSpeedPct: 215 },\r\n  { level: 24, credits: 179564, stellarUnitsSpeedPct: 220 },\r\n  { level: 25, credits: 269348, stellarUnitsSpeedPct: 225 },\r\n  { level: 26, credits: 404020, stellarUnitsSpeedPct: 230 },\r\n  { level: 27, credits: 606032, stellarUnitsSpeedPct: 235 },\r\n  { level: 28, credits: 909044, stellarUnitsSpeedPct: 240 },\r\n  { level: 29, credits: 1363564, stellarUnitsSpeedPct: 245 },\r\n  { level: 30, credits: 2045348, stellarUnitsSpeedPct: 250 }\r\n] as const;\r\n","export const PLASMA_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, plasmaWeaponsAttackPct: 100 },\r\n  { level: 1, credits: 32, plasmaWeaponsAttackPct: 105, labs: 6, requires: '' },\r\n  { level: 2, credits: 48, plasmaWeaponsAttackPct: 110 },\r\n  { level: 3, credits: 72, plasmaWeaponsAttackPct: 115 },\r\n  { level: 4, credits: 108, plasmaWeaponsAttackPct: 120 },\r\n  { level: 5, credits: 162, plasmaWeaponsAttackPct: 125 },\r\n  { level: 6, credits: 243, plasmaWeaponsAttackPct: 130 },\r\n  { level: 7, credits: 365, plasmaWeaponsAttackPct: 135 },\r\n  { level: 8, credits: 547, plasmaWeaponsAttackPct: 140 },\r\n  { level: 9, credits: 821, plasmaWeaponsAttackPct: 145 },\r\n  { level: 10, credits: 1231, plasmaWeaponsAttackPct: 150 },\r\n  { level: 11, credits: 1846, plasmaWeaponsAttackPct: 155 },\r\n  { level: 12, credits: 2768, plasmaWeaponsAttackPct: 160 },\r\n  { level: 13, credits: 4152, plasmaWeaponsAttackPct: 165 },\r\n  { level: 14, credits: 6228, plasmaWeaponsAttackPct: 170 },\r\n  { level: 15, credits: 9342, plasmaWeaponsAttackPct: 175 },\r\n  { level: 16, credits: 14013, plasmaWeaponsAttackPct: 180 },\r\n\r\n  // Continued using ~1.5x growth per level (rounded)\r\n  { level: 17, credits: 21020, plasmaWeaponsAttackPct: 185 },\r\n  { level: 18, credits: 31530, plasmaWeaponsAttackPct: 190 },\r\n  { level: 19, credits: 47295, plasmaWeaponsAttackPct: 195 },\r\n  { level: 20, credits: 70943, plasmaWeaponsAttackPct: 200 },\r\n  { level: 21, credits: 106415, plasmaWeaponsAttackPct: 205 },\r\n  { level: 22, credits: 159623, plasmaWeaponsAttackPct: 210 },\r\n  { level: 23, credits: 239435, plasmaWeaponsAttackPct: 215 },\r\n  { level: 24, credits: 359153, plasmaWeaponsAttackPct: 220 },\r\n  { level: 25, credits: 538730, plasmaWeaponsAttackPct: 225 },\r\n  { level: 26, credits: 808095, plasmaWeaponsAttackPct: 230 },\r\n  { level: 27, credits: 1212143, plasmaWeaponsAttackPct: 235 },\r\n  { level: 28, credits: 1818215, plasmaWeaponsAttackPct: 240 },\r\n  { level: 29, credits: 2727323, plasmaWeaponsAttackPct: 245 },\r\n  { level: 30, credits: 4090985, plasmaWeaponsAttackPct: 250 }\r\n] as const;\r\n","export const PHOTON_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, photonWeaponsAttackPct: 100 },\r\n  { level: 1, credits: 1024, photonWeaponsAttackPct: 105 },\r\n  { level: 2, credits: 1536, photonWeaponsAttackPct: 110 },\r\n  { level: 3, credits: 2304, photonWeaponsAttackPct: 115 },\r\n  { level: 4, credits: 3456, photonWeaponsAttackPct: 120 },\r\n  { level: 5, credits: 5184, photonWeaponsAttackPct: 125 },\r\n  { level: 6, credits: 7776, photonWeaponsAttackPct: 130 },\r\n  { level: 7, credits: 11664, photonWeaponsAttackPct: 135 },\r\n  { level: 8, credits: 17496, photonWeaponsAttackPct: 140 },\r\n  { level: 9, credits: 26244, photonWeaponsAttackPct: 145 },\r\n  { level: 10, credits: 39366, photonWeaponsAttackPct: 150 },\r\n  { level: 11, credits: 59049, photonWeaponsAttackPct: 155 },\r\n  { level: 12, credits: 88574, photonWeaponsAttackPct: 160 },\r\n  { level: 13, credits: 132861, photonWeaponsAttackPct: 165 },\r\n  { level: 14, credits: 199291, photonWeaponsAttackPct: 170 },\r\n  { level: 15, credits: 298936, photonWeaponsAttackPct: 175 },\r\n  { level: 16, credits: 448404, photonWeaponsAttackPct: 180 },\r\n  { level: 17, credits: 672606, photonWeaponsAttackPct: 185 },\r\n  { level: 18, credits: 1008908, photonWeaponsAttackPct: 190 }\r\n] as const;\r\n","export const WARP_DRIVE_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, warpUnitsSpeedPct: 100 },\r\n  { level: 1, credits: 64, warpUnitsSpeedPct: 105 },\r\n  { level: 2, credits: 96, warpUnitsSpeedPct: 110 },\r\n  { level: 3, credits: 144, warpUnitsSpeedPct: 115 },\r\n  { level: 4, credits: 216, warpUnitsSpeedPct: 120 },\r\n  { level: 5, credits: 324, warpUnitsSpeedPct: 125 },\r\n  { level: 6, credits: 486, warpUnitsSpeedPct: 130 },\r\n  { level: 7, credits: 729, warpUnitsSpeedPct: 135 },\r\n  { level: 8, credits: 1094, warpUnitsSpeedPct: 140 },\r\n  { level: 9, credits: 1641, warpUnitsSpeedPct: 145 },\r\n  { level: 10, credits: 2461, warpUnitsSpeedPct: 150 },\r\n  { level: 11, credits: 3691, warpUnitsSpeedPct: 155 },\r\n  { level: 12, credits: 5536, warpUnitsSpeedPct: 160 },\r\n  { level: 13, credits: 8304, warpUnitsSpeedPct: 165 },\r\n  { level: 14, credits: 12456, warpUnitsSpeedPct: 170 },\r\n  { level: 15, credits: 18684, warpUnitsSpeedPct: 175 },\r\n  { level: 16, credits: 28026, warpUnitsSpeedPct: 180 },\r\n  { level: 17, credits: 42038, warpUnitsSpeedPct: 185 },\r\n  { level: 18, credits: 63057, warpUnitsSpeedPct: 190 },\r\n  { level: 19, credits: 94586, warpUnitsSpeedPct: 195 },\r\n  { level: 20, credits: 141878, warpUnitsSpeedPct: 200 }\r\n] as const;\r\n","export const SHIELDING_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, unitsShieldStrengthPct: 100 },\r\n  { level: 1, credits: 128, unitsShieldStrengthPct: 105 },\r\n  { level: 2, credits: 192, unitsShieldStrengthPct: 110 },\r\n  { level: 3, credits: 288, unitsShieldStrengthPct: 115 },\r\n  { level: 4, credits: 432, unitsShieldStrengthPct: 120 },\r\n  { level: 5, credits: 648, unitsShieldStrengthPct: 125 },\r\n  { level: 6, credits: 972, unitsShieldStrengthPct: 130 },\r\n  { level: 7, credits: 1458, unitsShieldStrengthPct: 135 },\r\n  { level: 8, credits: 2187, unitsShieldStrengthPct: 140 },\r\n  { level: 9, credits: 3281, unitsShieldStrengthPct: 145 },\r\n  { level: 10, credits: 4921, unitsShieldStrengthPct: 150 },\r\n  { level: 11, credits: 7382, unitsShieldStrengthPct: 155 },\r\n  { level: 12, credits: 11072, unitsShieldStrengthPct: 160 },\r\n  { level: 13, credits: 16608, unitsShieldStrengthPct: 165 },\r\n  { level: 14, credits: 24912, unitsShieldStrengthPct: 170 },\r\n  { level: 15, credits: 37367, unitsShieldStrengthPct: 175 },\r\n  { level: 16, credits: 56051, unitsShieldStrengthPct: 180 },\r\n  { level: 17, credits: 84076, unitsShieldStrengthPct: 185 },\r\n  { level: 18, credits: 126114, unitsShieldStrengthPct: 190 },\r\n  { level: 19, credits: 189171, unitsShieldStrengthPct: 195 },\r\n  { level: 20, credits: 283756, unitsShieldStrengthPct: 200 }\r\n] as const;\r\n","export const STEALTH_LEVEL_ROWS = [\r\n  { level: 0, credits: 0 },\r\n  { level: 1, credits: 512 },\r\n  { level: 2, credits: 768 },\r\n  { level: 3, credits: 1152 },\r\n  { level: 4, credits: 1728 },\r\n  { level: 5, credits: 2592 },\r\n  { level: 6, credits: 3888 },\r\n  { level: 7, credits: 5832 },\r\n  { level: 8, credits: 8748 }\r\n] as const;\r\n","export const ARTIFICIAL_INTELLIGENCE_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, baseResearchOutputPct: 100 },\r\n  { level: 1, credits: 2048, baseResearchOutputPct: 105 },\r\n  { level: 2, credits: 3072, baseResearchOutputPct: 110 },\r\n  { level: 3, credits: 4608, baseResearchOutputPct: 115 },\r\n  { level: 4, credits: 6912, baseResearchOutputPct: 120 },\r\n  { level: 5, credits: 10368, baseResearchOutputPct: 125 },\r\n  { level: 6, credits: 15552, baseResearchOutputPct: 130 },\r\n  { level: 7, credits: 23328, baseResearchOutputPct: 135 },\r\n  { level: 8, credits: 34992, baseResearchOutputPct: 140 },\r\n  { level: 9, credits: 52488, baseResearchOutputPct: 145 },\r\n  { level: 10, credits: 78732, baseResearchOutputPct: 150 },\r\n  { level: 11, credits: 118098, baseResearchOutputPct: 155 },\r\n  { level: 12, credits: 177147, baseResearchOutputPct: 160 },\r\n  { level: 13, credits: 265721, baseResearchOutputPct: 165 },\r\n  { level: 14, credits: 398581, baseResearchOutputPct: 170 }\r\n] as const;\r\n","export const CYBERNETICS_LEVEL_ROWS = [\r\n  { level: 0, credits: 0, baseConstructionProductionOutputPct: 100 },\r\n  { level: 1, credits: 8192, baseConstructionProductionOutputPct: 105 },\r\n  { level: 2, credits: 12288, baseConstructionProductionOutputPct: 110 },\r\n  { level: 3, credits: 18432, baseConstructionProductionOutputPct: 115 },\r\n  { level: 4, credits: 27648, baseConstructionProductionOutputPct: 120 },\r\n  { level: 5, credits: 41472, baseConstructionProductionOutputPct: 125 },\r\n  { level: 6, credits: 62208, baseConstructionProductionOutputPct: 130 },\r\n  { level: 7, credits: 93312, baseConstructionProductionOutputPct: 135 },\r\n  { level: 8, credits: 139968, baseConstructionProductionOutputPct: 140 },\r\n  { level: 9, credits: 209952, baseConstructionProductionOutputPct: 145 },\r\n  { level: 10, credits: 314928, baseConstructionProductionOutputPct: 150 }\r\n] as const;\r\n","import type { ResearchLevelRow } from './metrics';\r\n\r\nexport const ION_LEVEL_ROWS: Readonly<ResearchLevelRow[]> = [\r\n  { level: 0, credits: 0, ionWeaponsAttackPct: 100 },\r\n  { level: 1, credits: 256, ionWeaponsAttackPct: 105 },\r\n  { level: 2, credits: 384, ionWeaponsAttackPct: 110 },\r\n  { level: 3, credits: 576, ionWeaponsAttackPct: 115 },\r\n  { level: 4, credits: 864, ionWeaponsAttackPct: 120 },\r\n  { level: 5, credits: 1296, ionWeaponsAttackPct: 125 },\r\n  { level: 6, credits: 1944, ionWeaponsAttackPct: 130 },\r\n  { level: 7, credits: 2916, ionWeaponsAttackPct: 135 },\r\n  { level: 8, credits: 4374, ionWeaponsAttackPct: 140 },\r\n  { level: 9, credits: 6561, ionWeaponsAttackPct: 145 },\r\n  { level: 10, credits: 9842, ionWeaponsAttackPct: 150 },\r\n  { level: 11, credits: 14762, ionWeaponsAttackPct: 155 },\r\n  { level: 12, credits: 22144, ionWeaponsAttackPct: 160 },\r\n  { level: 13, credits: 33215, ionWeaponsAttackPct: 165 },\r\n  { level: 14, credits: 49823, ionWeaponsAttackPct: 170 },\r\n  { level: 15, credits: 74734, ionWeaponsAttackPct: 175 },\r\n  { level: 16, credits: 112101, ionWeaponsAttackPct: 180 },\r\n  { level: 17, credits: 168152, ionWeaponsAttackPct: 185 },\r\n  { level: 18, credits: 252227, ionWeaponsAttackPct: 190 }\r\n] as const;\r\n","import type { ResearchLevelRow } from './metrics';\r\n\r\nexport const DISRUPTOR_LEVEL_ROWS: Readonly<ResearchLevelRow[]> = [\r\n  { level: 0, credits: 0, disruptorWeaponsAttackPct: 100 },\r\n  { level: 1, credits: 4096, disruptorWeaponsAttackPct: 105 },\r\n  { level: 2, credits: 6144, disruptorWeaponsAttackPct: 110 },\r\n  { level: 3, credits: 9216, disruptorWeaponsAttackPct: 115 },\r\n  { level: 4, credits: 13824, disruptorWeaponsAttackPct: 120 },\r\n  { level: 5, credits: 20736, disruptorWeaponsAttackPct: 125 },\r\n  { level: 6, credits: 31104, disruptorWeaponsAttackPct: 130 },\r\n  { level: 7, credits: 46656, disruptorWeaponsAttackPct: 135 },\r\n  { level: 8, credits: 69984, disruptorWeaponsAttackPct: 140 },\r\n  { level: 9, credits: 104976, disruptorWeaponsAttackPct: 145 },\r\n  { level: 10, credits: 157464, disruptorWeaponsAttackPct: 150 },\r\n  { level: 11, credits: 236196, disruptorWeaponsAttackPct: 155 },\r\n  { level: 12, credits: 354296, disruptorWeaponsAttackPct: 160 },\r\n  { level: 13, credits: 531444, disruptorWeaponsAttackPct: 165 },\r\n  { level: 14, credits: 797164, disruptorWeaponsAttackPct: 170 },\r\n  { level: 15, credits: 1195744, disruptorWeaponsAttackPct: 175 },\r\n  { level: 16, credits: 1793616, disruptorWeaponsAttackPct: 180 },\r\n  { level: 17, credits: 2690424, disruptorWeaponsAttackPct: 185 },\r\n  { level: 18, credits: 4035632, disruptorWeaponsAttackPct: 190 }\r\n] as const;\r\n","export const TACHYON_COMMUNICATIONS_LEVEL_ROWS = [\r\n  { level: 0, credits: 0 },\r\n  { level: 1, credits: 32768 },\r\n  { level: 2, credits: 49152 },\r\n  { level: 3, credits: 73728 },\r\n  { level: 4, credits: 110592 },\r\n  { level: 5, credits: 165888 },\r\n  { level: 6, credits: 248832 },\r\n  { level: 7, credits: 373248 },\r\n  { level: 8, credits: 559872 }\r\n] as const;\r\n","export const ANTI_GRAVITY_LEVEL_ROWS = [\r\n  { level: 0, credits: 0 },\r\n  { level: 1, credits: 100000 },\r\n  { level: 2, credits: 150000 },\r\n  { level: 3, credits: 225000 },\r\n  { level: 4, credits: 337500 },\r\n  { level: 5, credits: 506250 },\r\n  { level: 6, credits: 759375 },\r\n  { level: 7, credits: 1139063 },\r\n  { level: 8, credits: 1708594 },\r\n  { level: 9, credits: 2562891 },\r\n  { level: 10, credits: 3844336 },\r\n  { level: 11, credits: 5766504 },\r\n  { level: 12, credits: 8649756 }\r\n] as const;\r\n","import { TechnologyKey, technologyCatalog } from '@game/shared';\r\nimport type { ResearchLevelRow } from './metrics';\r\nimport { ENERGY_LEVEL_ROWS } from './energy';\r\nimport { COMPUTER_LEVEL_ROWS } from './computer';\r\nimport { ARMOUR_LEVEL_ROWS } from './armour';\r\nimport { LASER_LEVEL_ROWS } from './laser';\r\nimport { MISSILES_LEVEL_ROWS } from './missiles';\r\nimport { STELLAR_DRIVE_LEVEL_ROWS } from './stellar_drive';\r\nimport { PLASMA_LEVEL_ROWS } from './plasma';\r\nimport { PHOTON_LEVEL_ROWS } from './photon';\r\nimport { WARP_DRIVE_LEVEL_ROWS } from './warp_drive';\r\nimport { SHIELDING_LEVEL_ROWS } from './shielding';\r\nimport { STEALTH_LEVEL_ROWS } from './stealth';\r\nimport { ARTIFICIAL_INTELLIGENCE_LEVEL_ROWS } from './artificial_intelligence';\r\nimport { CYBERNETICS_LEVEL_ROWS } from './cybernetics';\r\nimport { ION_LEVEL_ROWS } from './ion';\r\nimport { DISRUPTOR_LEVEL_ROWS } from './disruptor';\r\nimport { TACHYON_COMMUNICATIONS_LEVEL_ROWS } from './tachyon_communications';\r\nimport { ANTI_GRAVITY_LEVEL_ROWS } from './anti_gravity';\r\n\r\n\r\n// Default scaffold: build a single L1 row per tech from TechnologySpec.\r\n// This establishes the framework, mirroring structures level tables,\r\n// and can be extended with per-tech files later if/when multi-level data is defined.\r\nconst buildDefaultTables = (): Record<TechnologyKey, ResearchLevelRow[]> => {\r\n  const tables = {} as Record<TechnologyKey, ResearchLevelRow[]>;\r\n  (Object.keys(technologyCatalog) as TechnologyKey[]).forEach((key) => {\r\n    const spec = technologyCatalog[key];\r\n    const requires =\r\n      spec.prerequisites && spec.prerequisites.length > 0\r\n        ? spec.prerequisites.map((p) => `${p.key.replace(/_/g, ' ')} ${p.level}`).join(', ')\r\n        : '';\r\n    tables[key] = [\r\n      {\r\n        level: 1,\r\n        credits: spec.creditsCost,\r\n        labs: spec.requiredLabs,\r\n        requires,\r\n        effect: spec.description || '',\r\n      },\r\n    ];\r\n  });\r\n  return tables;\r\n};\r\n\r\nexport const RESEARCH_LEVEL_TABLES: Record<TechnologyKey, ResearchLevelRow[]> = (() => {\r\n  const tables = buildDefaultTables();\r\n  tables['energy'] = ENERGY_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['computer'] = COMPUTER_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['armour'] = ARMOUR_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['laser'] = LASER_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['plasma'] = PLASMA_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['photon'] = PHOTON_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['missiles'] = MISSILES_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['stellar_drive'] = STELLAR_DRIVE_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['warp_drive'] = WARP_DRIVE_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['shielding'] = SHIELDING_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['stealth'] = STEALTH_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['artificial_intelligence'] = ARTIFICIAL_INTELLIGENCE_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['cybernetics'] = CYBERNETICS_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['ion'] = ION_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['disruptor'] = DISRUPTOR_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['tachyon_communications'] = TACHYON_COMMUNICATIONS_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  tables['anti_gravity'] = ANTI_GRAVITY_LEVEL_ROWS as unknown as ResearchLevelRow[];\r\n  return tables;\r\n})();\r\n\r\nexport const RESEARCH_LEVEL_META: Record<TechnologyKey, { title: string; subtitle?: string }> = ((): Record<TechnologyKey, { title: string; subtitle?: string }> => {\r\n  const meta = {} as Record<TechnologyKey, { title: string; subtitle?: string }>;\r\n  (Object.keys(technologyCatalog) as TechnologyKey[]).forEach((key) => {\r\n    const spec = technologyCatalog[key];\r\n    meta[key] = {\r\n      title: `${spec.name}  Levels`,\r\n      subtitle: spec.description || undefined,\r\n    };\r\n  });\r\n  // Override subtitle for Energy to match UI copy\r\n  if (meta['energy']) {\r\n    meta['energy'].subtitle = 'Each level increases all bases energy output by 5%.';\r\n  }\r\n  // Override subtitle for Artificial Intelligence to match UI copy\r\n  if (meta['artificial_intelligence']) {\r\n    meta['artificial_intelligence'].subtitle = 'Each level increases all bases research output by 5%.';\r\n  }\r\n  // Override subtitle for Computer to match UI copy\r\n  if (meta['computer']) {\r\n    meta['computer'].subtitle = 'Each level allows one campaign fleet and the recruiting of one commander. Each 5 levels allows one auto scout fleet.';\r\n  }\r\n  // Override subtitle for Armour to match UI copy\r\n  if (meta['armour']) {\r\n    meta['armour'].subtitle = 'Each level increases units and defenses armour by 5%.';\r\n  }\r\n  // Override subtitle for Laser to match UI copy\r\n  if (meta['laser']) {\r\n    meta['laser'].subtitle = 'Each level increases laser weapons power by 5%.';\r\n  }\r\n  // Override subtitle for Plasma to match UI copy\r\n  if (meta['plasma']) {\r\n    meta['plasma'].subtitle = 'Each level increases plasma weapons power by 5%.';\r\n  }\r\n  // Override subtitle for Photon to match UI copy\r\n  if (meta['photon']) {\r\n    meta['photon'].subtitle = 'Each level increases photon weapons power by 5%.';\r\n  }\r\n  if (meta['missiles']) {\r\n    meta['missiles'].subtitle = 'Each level increases missile weapons power by 5%.';\r\n  }\r\n  if (meta['stellar_drive']) {\r\n    meta['stellar_drive'].subtitle = 'Each level increases stellar units travel speed by 5%.';\r\n  }\r\n  if (meta['warp_drive']) {\r\n    meta['warp_drive'].subtitle = 'Each level increases warp units travel speed by 5%.';\r\n  }\r\n  if (meta['shielding']) {\r\n    meta['shielding'].subtitle = 'Each level increases units and defenses shield strength by 5%.';\r\n  }\r\n  if (meta['cybernetics']) {\r\n    meta['cybernetics'].subtitle = 'Each level increases all bases construction and production output by 5%.';\r\n  }\r\n  return meta;\r\n})();\r\n","/**\r\n * Centralized Research Metrics: canonical constants and small pure helpers.\r\n * This is the single source of truth for research metric keys, labels, and kinds.\r\n */\r\n\r\nexport const METRIC_PRIORITY = [\r\n  'baseEnergyOutputPct',\r\n  'baseResearchOutputPct',\r\n  'baseConstructionProductionOutputPct',\r\n  'campaignFleets',\r\n  'unitsArmourPct',\r\n  'unitsShieldStrengthPct',\r\n  'laserWeaponsAttackPct',\r\n  'photonWeaponsAttackPct',\r\n  'missilesWeaponsAttackPct',\r\n  'stellarUnitsSpeedPct',\r\n  'warpUnitsSpeedPct',\r\n  'plasmaWeaponsAttackPct',\r\n  'ionWeaponsAttackPct',\r\n  'disruptorWeaponsAttackPct',\r\n] as const;\r\n\r\nexport type MetricKey = (typeof METRIC_PRIORITY)[number];\r\n\r\nexport const METRIC_LABELS: Record<MetricKey, string> = {\r\n  baseEnergyOutputPct: 'Base Energy Output',\r\n  baseResearchOutputPct: 'Base Research Output',\r\n  baseConstructionProductionOutputPct: 'Construction & Production Output',\r\n  campaignFleets: 'Campaign Fleets',\r\n  unitsArmourPct: 'Units Armour',\r\n  unitsShieldStrengthPct: 'Shield Strength',\r\n  laserWeaponsAttackPct: 'Laser Weapons Attack',\r\n  photonWeaponsAttackPct: 'Photon Weapons Attack',\r\n  missilesWeaponsAttackPct: 'Missiles Weapons Attack',\r\n  stellarUnitsSpeedPct: 'Stellar Units Speed',\r\n  warpUnitsSpeedPct: 'Warp Units Speed',\r\n  plasmaWeaponsAttackPct: 'Plasma Weapons Attack',\r\n  ionWeaponsAttackPct: 'Ion Weapons Attack',\r\n  disruptorWeaponsAttackPct: 'Disruptor Weapons Attack',\r\n};\r\n\r\nexport const METRIC_KIND: Record<MetricKey, 'percent' | 'count'> = {\r\n  baseEnergyOutputPct: 'percent',\r\n  baseResearchOutputPct: 'percent',\r\n  baseConstructionProductionOutputPct: 'percent',\r\n  campaignFleets: 'count',\r\n  unitsArmourPct: 'percent',\r\n  unitsShieldStrengthPct: 'percent',\r\n  laserWeaponsAttackPct: 'percent',\r\n  photonWeaponsAttackPct: 'percent',\r\n  missilesWeaponsAttackPct: 'percent',\r\n  stellarUnitsSpeedPct: 'percent',\r\n  warpUnitsSpeedPct: 'percent',\r\n  plasmaWeaponsAttackPct: 'percent',\r\n  ionWeaponsAttackPct: 'percent',\r\n  disruptorWeaponsAttackPct: 'percent',\r\n};\r\n\r\nexport type ResearchLevelRow = {\r\n  level: number;\r\n  credits: number;\r\n  labs?: number;\r\n  requires?: string;\r\n  effect?: string;\r\n} & Partial<Record<MetricKey, number>>;\r\n\r\n/**\r\n * Row-like shape used by helper functions.\r\n * Loosened to accept existing tables where credits may be optional.\r\n */\r\nexport type ResearchRowLike = {\r\n  labs?: number;\r\n  requires?: string;\r\n  effect?: string;\r\n} & Partial<Record<MetricKey, number>>;\r\n\r\n/**\r\n * Select the first visible metric key present in any row, according to priority order.\r\n */\r\nexport function selectVisibleMetricKey(\r\n  rows: ReadonlyArray<ResearchRowLike>\r\n): MetricKey | undefined {\r\n  return METRIC_PRIORITY.find((k) => rows.some((r) => typeof r[k] === 'number'));\r\n}\r\n\r\n/**\r\n * True when the table is purely Level/Credits (no metric and no labs/requires/effect).\r\n */\r\nexport function computeHasCreditsOnly(\r\n  rows: ReadonlyArray<ResearchRowLike>,\r\n  visibleMetricKey?: MetricKey\r\n): boolean {\r\n  return (\r\n    rows.length > 0 &&\r\n    !visibleMetricKey &&\r\n    rows.every((r) => typeof r.labs !== 'number' && !r.requires && !r.effect)\r\n  );\r\n}\r\n\r\n/**\r\n * Derive empty-state colSpan based on derived columns.\r\n * - 2 when credits-only\r\n * - 3 when a metric column is visible\r\n * - 5 when labs/requires/effect is used (no metric)\r\n */\r\nexport function computeEmptyStateColSpan(\r\n  hasCreditsOnly: boolean,\r\n  visibleMetricKey?: MetricKey\r\n): number {\r\n  return hasCreditsOnly ? 2 : visibleMetricKey ? 3 : 5;\r\n}\r\n","import React from 'react';\r\nimport type { TechnologyKey } from '@game/shared';\r\nimport { RESEARCH_LEVEL_TABLES, RESEARCH_LEVEL_META } from './levelTables/research';\r\nimport { METRIC_LABELS, METRIC_KIND, type MetricKey, selectVisibleMetricKey, computeHasCreditsOnly } from './levelTables/research/metrics';\r\n\r\ninterface ResearchLevelsModalProps {\r\n  techKey: TechnologyKey | undefined;\r\n}\r\n\r\n\r\n\r\n\r\n\r\nconst ResearchLevelsModal: React.FC<ResearchLevelsModalProps> = ({ techKey }) => {\r\n  if (!techKey) {\r\n    return (\r\n      <div className=\"text-center py-8\">\r\n        <p className=\"text-gray-400\">No technology selected.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const rows = RESEARCH_LEVEL_TABLES[techKey] || [];\r\n  const meta = RESEARCH_LEVEL_META[techKey];\r\n\r\n  // Determine which metric column (if any) should be shown\r\n  const visibleMetricKey: MetricKey | undefined = selectVisibleMetricKey(rows);\r\n\r\n  const hasCreditsOnly = computeHasCreditsOnly(rows, visibleMetricKey);\r\n\r\n  const showLabsBlock = !visibleMetricKey && !hasCreditsOnly;\r\n\r\n  // Compute empty-state colSpan based on derived columns\r\n  const emptyStateColSpan = hasCreditsOnly ? 2 : visibleMetricKey ? 3 : 5;\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {meta?.subtitle && <div className=\"text-sm text-gray-300\">{meta.subtitle}</div>}\r\n\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Level</th>\r\n              <th className=\"py-2 px-3 text-left\">Credits</th>\r\n              {visibleMetricKey ? (\r\n                <th className=\"py-2 px-3 text-left\">{METRIC_LABELS[visibleMetricKey]}</th>\r\n              ) : showLabsBlock ? (\r\n                <>\r\n                  <th className=\"py-2 px-3 text-left\">Labs</th>\r\n                  <th className=\"py-2 px-3 text-left\">Requires</th>\r\n                  <th className=\"py-2 px-3 text-left\">Effect</th>\r\n                </>\r\n              ) : null}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows.length === 0 ? (\r\n              <tr>\r\n                <td colSpan={emptyStateColSpan} className=\"py-2 px-3 text-gray-400\">\r\n                  Coming soon.\r\n                </td>\r\n              </tr>\r\n            ) : (\r\n              rows.map((r: any) => (\r\n                <tr key={r.level} className=\"border-b border-gray-800\">\r\n                  <td className=\"py-2 px-3 text-gray-200\">{r.level}</td>\r\n                  <td className=\"py-2 px-3 text-gray-200\">\r\n                    {typeof r.credits === 'number' ? r.credits.toLocaleString() : ''}\r\n                  </td>\r\n\r\n                  {visibleMetricKey ? (\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      {typeof r[visibleMetricKey] === 'number'\r\n                        ? METRIC_KIND[visibleMetricKey] === 'percent'\r\n                          ? `${r[visibleMetricKey]}%`\r\n                          : (r[visibleMetricKey] as number).toLocaleString()\r\n                        : ''}\r\n                    </td>\r\n                  ) : showLabsBlock ? (\r\n                    <>\r\n                      <td className=\"py-2 px-3 text-gray-200\">\r\n                        {typeof r.labs === 'number' ? r.labs.toLocaleString() : ''}\r\n                      </td>\r\n                      <td className=\"py-2 px-3 text-gray-200\">{r.requires ?? ''}</td>\r\n                      <td className=\"py-2 px-3 text-gray-200\">{r.effect ?? ''}</td>\r\n                    </>\r\n                  ) : null}\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResearchLevelsModal;\r\n","import React from 'react';\r\nimport { useModalStore } from '../../stores/modalStore';\r\nimport { Empire } from '@game/shared';\r\nimport Modal from '../ui/Modal';\r\nimport ResearchModal from './ResearchModal';\r\nimport GalaxyModal from './GalaxyModal';\r\nimport FleetModal from './FleetModal';\r\nimport GameInfoModal from './GameInfoModal';\r\nimport CapacityBreakdownModal from './CapacityBreakdownModal';\r\nimport EnergyBreakdownModal from './EnergyBreakdownModal';\r\nimport AreaBreakdownModal from './AreaBreakdownModal';\r\nimport PopulationBreakdownModal from './PopulationBreakdownModal';\r\nimport StructureLevelsModal from './StructureLevelsModal';\r\nimport { STRUCTURE_LEVEL_META } from './levelTables/structures';\r\nimport ResearchLevelsModal from './ResearchLevelsModal';\r\nimport { RESEARCH_LEVEL_META } from './levelTables/research';\r\n\r\ninterface ModalManagerProps {\r\n  empire: Empire | null;\r\n  onUpdate: () => void;\r\n}\r\n\r\nconst ModalManager: React.FC<ModalManagerProps> = ({ empire, onUpdate }) => {\r\n  const { isOpen, type, closeModal, data } = useModalStore();\r\n\r\n  if (!isOpen || !type || !empire) {\r\n    return null;\r\n  }\r\n\r\n  const getModalTitle = () => {\r\n    switch (type) {\r\n      case 'research':\r\n        return ' Research & Development';\r\n      case 'galaxy':\r\n        return ' Galaxy Map';\r\n      case 'fleet':\r\n        return ' Fleet Management';\r\n      case 'game_info':\r\n        return ' Game Info';\r\n      case 'capacity_breakdown':\r\n        return ' Capacity Breakdown';\r\n      case 'energy_breakdown':\r\n        return ' Energy Breakdown';\r\n      case 'area_breakdown':\r\n        return ' Area Usage Breakdown';\r\n      case 'population_breakdown':\r\n        return ' Population Breakdown';\r\n      case 'levels_table': {\r\n        const sk = data?.structureKey as keyof typeof STRUCTURE_LEVEL_META | undefined;\r\n        const title = sk && STRUCTURE_LEVEL_META[sk]?.title ? STRUCTURE_LEVEL_META[sk]?.title as string : 'Levels Table';\r\n        return title;\r\n      }\r\n      case 'research_levels_table': {\r\n        const tk = data?.techKey as keyof typeof RESEARCH_LEVEL_META | undefined;\r\n        const title = tk && RESEARCH_LEVEL_META[tk]?.title ? (RESEARCH_LEVEL_META[tk]?.title as string) : 'Research Levels';\r\n        return title;\r\n      }\r\n      default:\r\n        return 'Game Interface';\r\n    }\r\n  };\r\n\r\n  const getModalSize = () => {\r\n    switch (type) {\r\n      case 'research':\r\n      case 'galaxy':\r\n        return 'xl' as const;\r\n      case 'fleet':\r\n        return 'lg' as const;\r\n      case 'game_info':\r\n        return '2xl' as const;\r\n      case 'capacity_breakdown':\r\n        return 'lg' as const;\r\n      case 'energy_breakdown':\r\n      case 'area_breakdown':\r\n      case 'population_breakdown':\r\n        return 'lg' as const;\r\n      case 'levels_table':\r\n        return 'md' as const;\r\n      case 'research_levels_table':\r\n        return 'md' as const;\r\n      default:\r\n        return 'lg' as const;\r\n    }\r\n  };\r\n\r\n  const renderModalContent = () => {\r\n    switch (type) {\r\n      case 'research':\r\n        return (\r\n          <ResearchModal\r\n            empire={empire}\r\n            onUpdate={onUpdate}\r\n          />\r\n        );\r\n      case 'galaxy':\r\n        return (\r\n          <GalaxyModal\r\n            empire={empire}\r\n            onUpdate={onUpdate}\r\n          />\r\n        );\r\n      case 'fleet':\r\n        return (\r\n          <FleetModal\r\n            empire={empire}\r\n            onUpdate={onUpdate}\r\n          />\r\n        );\r\n      case 'game_info':\r\n        return (\r\n          <GameInfoModal\r\n            empire={empire}\r\n            onUpdate={onUpdate}\r\n            initialTab={data?.initialTab}\r\n          />\r\n        );\r\n      case 'capacity_breakdown':\r\n        return (\r\n          <CapacityBreakdownModal\r\n            data={data}\r\n          />\r\n        );\r\n      case 'energy_breakdown':\r\n        return (\r\n          <EnergyBreakdownModal\r\n            data={data}\r\n          />\r\n        );\r\n      case 'area_breakdown':\r\n        return (\r\n          <AreaBreakdownModal\r\n            data={data}\r\n          />\r\n        );\r\n      case 'population_breakdown':\r\n        return (\r\n          <PopulationBreakdownModal\r\n            data={data}\r\n          />\r\n        );\r\n      case 'levels_table':\r\n        return (\r\n          <StructureLevelsModal\r\n            structureKey={data?.structureKey}\r\n          />\r\n        );\r\n      case 'research_levels_table':\r\n        return (\r\n          <ResearchLevelsModal\r\n            techKey={data?.techKey}\r\n          />\r\n        );\r\n      default:\r\n        return (\r\n          <div className=\"text-center py-8\">\r\n            <p className=\"text-gray-400\">Modal content not found.</p>\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      isOpen={isOpen}\r\n      onClose={closeModal}\r\n      title={getModalTitle()}\r\n      size={getModalSize()}\r\n    >\r\n      {renderModalContent()}\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ModalManager;\r\n","import React, { useEffect, useState, useMemo } from 'react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { Empire } from '@game/shared';\r\nimport ModalManager from './ModalManager';\r\nimport api from '../../services/api';\r\n\r\n\r\ninterface DashboardData {\r\n  user: any;\r\n  empire: Empire | null;\r\n  isNewPlayer: boolean;\r\n  serverInfo: {\r\n    name: string;\r\n    version: string;\r\n    playersOnline: number;\r\n    universeSize: { width: number; height: number };\r\n  };\r\n  profile?: {\r\n    economyPerHour: number;\r\n    fleetScore: number;\r\n    technologyScore: number;\r\n    level: number;\r\n  };\r\n}\r\n\r\nconst Dashboard: React.FC = () => {\r\n  const { user } = useAuthStore();\r\n  const [dashboardData, setDashboardData] = useState<DashboardData | null>(null);\r\n  const [empireCreationName, setEmpireCreationName] = useState('');\r\n  const [showCreateEmpire, setShowCreateEmpire] = useState(false);\r\n\r\n  // Use shared axios instance with global auth/refresh + desktop-safe redirects\r\n  const apiClient = api;\r\n\r\n  // Fetch dashboard data\r\n  const fetchDashboardData = async () => {\r\n    try {\r\n      const response = await apiClient.get('/game/dashboard');\r\n      const data = response.data;\r\n\r\n      console.log('Dashboard API Response:', data); // Debug log\r\n\r\n      if (data.success) {\r\n        console.log('Profile data received:', data.data.profile); // Debug log\r\n        setDashboardData(data.data);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching dashboard data:', err);\r\n    }\r\n  };\r\n\r\n  // Create empire\r\n  const handleCreateEmpire = async () => {\r\n    if (!empireCreationName.trim()) return;\r\n\r\n    try {\r\n      const response = await apiClient.post('/game/empire', { name: empireCreationName });\r\n      const data = response.data;\r\n\r\n      if (data.success) {\r\n        setShowCreateEmpire(false);\r\n        setEmpireCreationName('');\r\n        await fetchDashboardData();\r\n      } else {\r\n        console.error(data.error || 'Failed to create empire');\r\n      }\r\n    } catch (err) {\r\n      console.error('Network error. Please try again.', err);\r\n    }\r\n  };\r\n\r\n\r\n  useEffect(() => {\r\n    fetchDashboardData();\r\n  }, []);\r\n\r\n  // Helper to handle both Map and plain object techLevels from server\r\n  const getTechEntries = (tl: any): [string, number][] => {\r\n    if (!tl) return [];\r\n    if (tl instanceof Map) return Array.from(tl.entries());\r\n    if (typeof tl === 'object') return Object.entries(tl as Record<string, number>);\r\n    return [];\r\n  };\r\n\r\n  const techEntries = useMemo(\r\n    () => getTechEntries((dashboardData?.empire as any)?.techLevels),\r\n    [dashboardData?.empire]\r\n  );\r\n\r\n  if (!dashboardData) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-400\">Loading dashboard...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Welcome Header */}\r\n      <div className=\"game-card\">\r\n        <h1 className=\"text-2xl font-bold mb-2\">\r\n          Welcome to {dashboardData.serverInfo.name}, {user?.username}!\r\n        </h1>\r\n        <p className=\"text-gray-400\">\r\n          {dashboardData.empire\r\n            ? `Home system: ${dashboardData.empire.homeSystem}`\r\n            : 'Setting up your starter base...'}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Empire Creation Modal */}\r\n      {showCreateEmpire && (\r\n        <div className=\"game-card border-2 border-yellow-500\">\r\n          <h3 className=\"text-xl font-semibold mb-4 text-yellow-400\">Create Your Empire</h3>\r\n          <p className=\"text-gray-400 mb-4\">\r\n            Welcome, Commander! You're about to establish your space empire. Choose a name that will\r\n            strike fear into your enemies and inspire your allies.\r\n          </p>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label htmlFor=\"empireName\" className=\"block text-sm font-medium mb-2\">\r\n                Empire Name\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                id=\"empireName\"\r\n                value={empireCreationName}\r\n                onChange={(e) => setEmpireCreationName(e.target.value)}\r\n                placeholder=\"Enter your empire name...\"\r\n                className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500\"\r\n                maxLength={30}\r\n              />\r\n              <p className=\"text-xs text-gray-500 mt-1\">3-30 characters</p>\r\n            </div>\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={handleCreateEmpire}\r\n                disabled={!empireCreationName.trim() || empireCreationName.length < 3}\r\n                className=\"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                Establish Empire\r\n              </button>\r\n              <button\r\n                onClick={() => setShowCreateEmpire(false)}\r\n                className=\"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700\"\r\n              >\r\n                Later\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Empire Overview */}\r\n      {dashboardData.empire ? (\r\n        <div className=\"space-y-6\">\r\n\r\n\r\n          {/* Empire Territory & Technology */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            {/* Territory Information */}\r\n            <div className=\"game-card\">\r\n              <h3 className=\"text-lg font-semibold text-green-400 mb-4\"> Territory & Home</h3>\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-gray-300\">Home System:</span>\r\n                  <span className=\"font-mono text-sm\">{dashboardData.empire.homeSystem || 'Not set'}</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-gray-300\">Territories:</span>\r\n                  <span className=\"font-mono text-sm\">{dashboardData.empire.territories.length}</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <span className=\"text-gray-300\">Controlled Systems:</span>\r\n                  <span className=\"font-mono text-sm\">{dashboardData.empire.territories.slice(0, 3).join(', ')}{dashboardData.empire.territories.length > 3 ? '...' : ''}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Technology Levels */}\r\n            <div className=\"game-card\">\r\n              <h3 className=\"text-lg font-semibold text-purple-400 mb-4\"> Technology</h3>\r\n              <div className=\"space-y-2 max-h-32 overflow-y-auto\">\r\n                {techEntries.length > 0 ? (\r\n                  techEntries.map(([tech, level]) => (\r\n                    <div key={tech} className=\"flex items-center justify-between text-sm\">\r\n                      <span className=\"text-gray-300 capitalize\">{tech.replace(/_/g, ' ')}:</span>\r\n                      <span className=\"font-mono\">Level {level}</span>\r\n                    </div>\r\n                  ))\r\n                ) : (\r\n                  <div className=\"text-gray-500 text-sm\">No technologies researched</div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Empire Statistics */}\r\n          <div className=\"game-card\">\r\n            <h3 className=\"text-lg font-semibold text-empire-gold mb-4\"> Empire Statistics</h3>\r\n\r\n            <div className=\"text-sm divide-y divide-gray-700/60\">\r\n              <div className=\"flex items-center justify-between py-1.5\">\r\n                <span className=\"font-medium text-gray-300\">Empire Name</span>\r\n                <span className=\"font-mono\">{dashboardData.empire.name}</span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between py-1.5\">\r\n                <span className=\"font-medium text-gray-300\">Player</span>\r\n                <span className=\"font-mono\">{dashboardData.user?.username ?? user?.username ?? ''}</span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between py-1.5\">\r\n                <span className=\"font-medium text-gray-300\">Player ID</span>\r\n                <span className=\"font-mono\">{dashboardData.user?._id ?? user?._id ?? ''}</span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between py-1.5\">\r\n                <span className=\"font-medium text-gray-300\">Level</span>\r\n                <span className=\"font-mono\">\r\n                  {dashboardData.profile ? dashboardData.profile.level.toFixed(2) : '0.00'} <span className=\"text-gray-400\">(Rank 000)</span>\r\n                </span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between py-1.5\">\r\n                <span className=\"font-medium text-gray-300\">Economy Rate</span>\r\n                <span className=\"font-mono\">{dashboardData.profile ? Math.round(dashboardData.profile.economyPerHour) : '0'} cred./h</span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between py-1.5\">\r\n                <span className=\"font-medium text-gray-300\">Fleet Size</span>\r\n                <span className=\"font-mono\">{dashboardData.profile ? dashboardData.profile.fleetScore : '0'}</span>\r\n              </div>\r\n              <div className=\"flex items-center justify-between py-1.5\">\r\n                <span className=\"font-medium text-gray-300\">Technology Score</span>\r\n                <span className=\"font-mono\">{dashboardData.profile ? dashboardData.profile.technologyScore : '0'}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"game-card\">\r\n          <h3 className=\"text-lg font-semibold mb-3 text-yellow-400\">Starter Setup</h3>\r\n          <p className=\"text-gray-400 mb-4\">\r\n            Your starter base is being prepared. Please refresh shortly.\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Game Tips / Info */}\r\n      <div className=\"game-card\">\r\n        <h3 className=\"text-lg font-semibold mb-3 text-space-purple\">Phase 3 Features - Now Available!</h3>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n          <div>\r\n            <h4 className=\"font-medium mb-2 text-green-400\"> Building System</h4>\r\n            <p className=\"text-gray-400\">\r\n              Construct mines, factories, research labs, and defense stations. Each building type provides unique benefits and can be upgraded.\r\n            </p>\r\n          </div>\r\n          <div>\r\n            <h4 className=\"font-medium mb-2 text-blue-400\"> Resource Management</h4>\r\n            <p className=\"text-gray-400\">\r\n              Manage Credits, Metal, Energy, and Research points. Buildings automatically produce resources over time.\r\n            </p>\r\n          </div>\r\n          <div>\r\n            <h4 className=\"font-medium mb-2 text-purple-400\"> Research System</h4>\r\n            <p className=\"text-gray-400\">\r\n              Advance your empire through Military, Economic, and Exploration technologies for powerful bonuses.\r\n            </p>\r\n          </div>\r\n          <div>\r\n            <h4 className=\"font-medium mb-2 text-yellow-400\"> Territory Expansion</h4>\r\n            <p className=\"text-gray-400\">\r\n              Colonize new worlds to expand your empire. Each territory can support multiple buildings and colonies.\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-4 p-3 bg-blue-900/30 border border-blue-700 rounded-md\">\r\n          <p className=\"text-blue-200 text-sm\">\r\n            <span className=\"font-medium\"> Real-time Gameplay:</span> Resources update automatically every minute. Buildings complete construction over time. Your empire grows even when you're offline!\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal Manager */}\r\n      <ModalManager empire={dashboardData.empire} onUpdate={fetchDashboardData} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n","import api, { ApiError } from \"./api\";\r\nimport { ApiResponse } from \"@game/shared\";\r\n\r\nexport interface ServerStatusData {\r\n  status: string;\r\n  version: string;\r\n  startedAt: string;\r\n  uptimeSeconds: number;\r\n  playersOnline: number;\r\n  socketsConnected: number;\r\n}\r\n\r\nfunction isApiErrorLike(err: unknown): err is ApiError {\r\n  return (\r\n    !!err &&\r\n    typeof err === \"object\" &&\r\n    typeof (err as any).code === \"string\" &&\r\n    typeof (err as any).message === \"string\"\r\n  );\r\n}\r\n\r\nexport const statusService = {\r\n  async getStatus(): Promise<ApiResponse<ServerStatusData>> {\r\n    try {\r\n      const response = await api.get<ApiResponse<ServerStatusData>>(\"/status\");\r\n      return response.data;\r\n    } catch (err) {\r\n      // Normalize to canonical DTO for callers that expect ApiResponse\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<ServerStatusData>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<ServerStatusData>;\r\n    }\r\n  },\r\n};\r\n\r\nexport default statusService;\r\n","import * as React from \"react\";\r\n\r\ntype State = \"online\" | \"degraded\" | \"offline\";\r\n\r\ninterface Props {\r\n  state: State;\r\n  showLabel?: boolean;\r\n  size?: \"sm\" | \"md\";\r\n  title?: string;\r\n  className?: string;\r\n}\r\n\r\nexport const StatusDot: React.FC<Props> = ({\r\n  state,\r\n  showLabel = false,\r\n  size = \"sm\",\r\n  title,\r\n  className,\r\n}) => {\r\n  const colorClass =\r\n    state === \"online\"\r\n      ? \"bg-green-400\"\r\n      : state === \"degraded\"\r\n      ? \"bg-yellow-400\"\r\n      : \"bg-red-400\";\r\n\r\n  const label =\r\n    state === \"online\" ? \"Online\" : state === \"degraded\" ? \"Degraded\" : \"Offline\";\r\n\r\n  const dotSizeClass = size === \"md\" ? \"w-3 h-3\" : \"w-2 h-2\";\r\n  const labelColorClass =\r\n    state === \"online\"\r\n      ? \"text-green-400\"\r\n      : state === \"degraded\"\r\n      ? \"text-yellow-400\"\r\n      : \"text-red-400\";\r\n\r\n  return (\r\n    <span\r\n      className={`inline-flex items-center gap-2 ${className || \"\"}`}\r\n      role=\"status\"\r\n      aria-label={label}\r\n      title={title || label}\r\n    >\r\n      <span className={`${dotSizeClass} rounded-full ${colorClass}`} />\r\n      {showLabel && <span className={`text-xs ${labelColorClass}`}>{label}</span>}\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default StatusDot;\r\n","import * as React from \"react\";\r\n\r\ntype SyncState = \"idle\" | \"syncing\" | \"error\";\r\n\r\ninterface Props {\r\n  state: SyncState;\r\n  queuedCount?: number;\r\n  showLabel?: boolean; // default false; show label for syncing/error to reduce noise\r\n  size?: \"sm\" | \"md\";\r\n  title?: string;\r\n  className?: string;\r\n}\r\n\r\nconst SyncDot: React.FC<Props> = ({\r\n  state,\r\n  queuedCount,\r\n  showLabel = false,\r\n  size = \"sm\",\r\n  title,\r\n  className,\r\n}) => {\r\n  const label =\r\n    state === \"syncing\" ? \"Syncing\" : state === \"error\" ? \"Sync error\" : \"Synced\";\r\n\r\n  const dotSizeClass = size === \"md\" ? \"w-3 h-3\" : \"w-2 h-2\";\r\n\r\n  // Colors (dark UI): idle  blue, syncing  blue + pulse, error  red\r\n  const baseColorClass =\r\n    state === \"error\" ? \"bg-red-400\" : \"bg-blue-400\";\r\n  const pulseClass = state === \"syncing\" ? \"animate-pulse\" : \"\";\r\n\r\n  const labelColorClass =\r\n    state === \"error\" ? \"text-red-400\" : \"text-blue-400\";\r\n\r\n  const aria = state === \"syncing\" ? \"Syncing\" : state === \"error\" ? \"Sync error\" : \"Synced\";\r\n\r\n  return (\r\n    <span\r\n      className={`inline-flex items-center gap-2 ${className || \"\"}`}\r\n      role=\"status\"\r\n      aria-label={aria}\r\n      title={title || label}\r\n    >\r\n      <span className={`${dotSizeClass} rounded-full ${baseColorClass} ${pulseClass}`} />\r\n      {showLabel && (\r\n        <span className={`text-xs ${labelColorClass}`}>\r\n          {label}\r\n          {state === \"syncing\" && typeof queuedCount === \"number\" && queuedCount > 0\r\n            ? ` (${queuedCount})`\r\n            : null}\r\n        </span>\r\n      )}\r\n    </span>\r\n  );\r\n};\r\n\r\nexport default SyncDot;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { Link } from 'react-router-dom';\r\nimport { statusService, ServerStatusData } from '../../services/statusService';\r\nimport { getSocket } from '../../services/socket';\r\nimport axios from 'axios';\r\nimport { useModalStore } from '../../stores/modalStore';\r\nimport ModalManager from '../game/ModalManager';\r\nimport { useNetwork } from '../../contexts/NetworkContext';\r\nimport StatusDot from '../ui/StatusDot';\r\nimport SyncDot from '../ui/SyncDot';\r\nimport { useSync } from '../../contexts/SyncContext';\r\n\r\ninterface LayoutProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst Layout: React.FC<LayoutProps> = ({ children }) => {\r\n  const { user, empire, logout } = useAuthStore();\r\n  const { openModal } = useModalStore();\r\n  const { status: networkStatus, isFullyConnected } = useNetwork();\r\n  const isDesktop = typeof window !== 'undefined' && !!(window as any).desktop;\r\n  const { status: syncStatus } = useSync();\r\n\r\n  // Derive connection state for persistent header indicator\r\n  const connectionState: 'online' | 'degraded' | 'offline' =\r\n    !networkStatus.isOnline ? 'offline' : !networkStatus.isApiReachable ? 'degraded' : 'online';\r\n  const showStatusLabel = connectionState !== 'online';\r\n  const statusTitle =\r\n    connectionState === 'offline'\r\n      ? 'No internet connection. Actions are limited; queued items will sync later.'\r\n      : connectionState === 'degraded'\r\n      ? 'Server unreachable. Viewing cached data; actions are limited.'\r\n      : 'Online';\r\n\r\n  const [serverStatus, setServerStatus] = useState<ServerStatusData | null>(null);\r\n\r\n  useEffect(() => {\r\n    let intervalId: number | undefined;\r\n    // Simple backoff window if the server responds with 429\r\n    let pauseUntil = 0;\r\n    const fetchStatus = async () => {\r\n      if (Date.now() < pauseUntil) return;\r\n      if (!isFullyConnected) return; // Don't fetch status when offline\r\n      \r\n      try {\r\n        const res = await statusService.getStatus();\r\n        if (res && (res as any).success && (res as any).data) {\r\n          setServerStatus((res as any).data as ServerStatusData);\r\n        }\r\n      } catch (err) {\r\n        if (axios.isAxiosError(err) && err.response?.status === 429) {\r\n          // Back off for 60s on rate limit to avoid spamming\r\n          pauseUntil = Date.now() + 60_000;\r\n        }\r\n        // Ignore other transient errors\r\n      }\r\n    };\r\n    fetchStatus();\r\n    // Poll less frequently; presence updates arrive via Socket.IO in real-time\r\n    intervalId = window.setInterval(fetchStatus, 30000);\r\n    return () => {\r\n      if (intervalId) window.clearInterval(intervalId);\r\n    };\r\n  }, [isFullyConnected]);\r\n\r\n  // Push-based presence updates (instant Players refresh)\r\n  useEffect(() => {\r\n    const socket = getSocket();\r\n    if (!socket) return;\r\n\r\n    const handler = (data: { playersOnline: number; socketsConnected: number }) => {\r\n      setServerStatus(prev => {\r\n        if (!prev) return prev;\r\n        return {\r\n          ...prev,\r\n          playersOnline: data.playersOnline,\r\n        };\r\n      });\r\n    };\r\n\r\n    socket.on('presence:update', handler);\r\n    return () => {\r\n      socket.off('presence:update', handler);\r\n    };\r\n  }, []);\r\n\r\n  const formatUptime = (seconds: number) => {\r\n    const d = Math.floor(seconds / 86400);\r\n    const h = Math.floor((seconds % 86400) / 3600);\r\n    const m = Math.floor((seconds % 3600) / 60);\r\n    if (d > 0) return `${d}d ${h}h`;\r\n    if (h > 0) return `${h}h ${m}m`;\r\n    return `${m}m`;\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-900 text-white\">\r\n      {/* Navigation Header */}\r\n      <nav className=\"game-nav\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-4\">\r\n            <h1 className=\"text-xl font-bold text-blue-400\">Attrition</h1>\r\n            <span className=\"text-sm text-gray-400\">Alpha Server</span>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center space-x-6\">\r\n            {/* Persistent connection + sync status indicators (subtle, non-intrusive) */}\r\n            <div className=\"flex items-center gap-4\">\r\n              {/* Network status */}\r\n              <div className=\"flex items-center gap-2\">\r\n                <StatusDot\r\n                  state={connectionState}\r\n                  showLabel={showStatusLabel}\r\n                  size=\"sm\"\r\n                  title={statusTitle}\r\n                />\r\n                {connectionState === 'online' && networkStatus.latencyMs ? (\r\n                  <span className=\"text-xs text-gray-400\">({networkStatus.latencyMs}ms)</span>\r\n                ) : null}\r\n              </div>\r\n\r\n              {/* Sync status */}\r\n              <div className=\"flex items-center gap-2\">\r\n                <SyncDot\r\n                  state={syncStatus.state}\r\n                  queuedCount={syncStatus.queuedCount}\r\n                  showLabel={syncStatus.state !== 'idle'}\r\n                  size=\"sm\"\r\n                  title={\r\n                    syncStatus.state === 'error'\r\n                      ? (syncStatus.lastError || 'Sync error')\r\n                      : syncStatus.state === 'syncing'\r\n                      ? 'Flushing queued changes'\r\n                      : 'Synced'\r\n                  }\r\n                />\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={() => openModal('galaxy')}\r\n              className=\"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n            >\r\n              Open Galaxy\r\n            </button>\r\n            {/* Resource Display */}\r\n            {empire && (\r\n              <div className=\"flex items-center space-x-4 text-sm\">\r\n                <div className=\"resource-display\">\r\n                  <span className=\"text-empire-gold\"></span>\r\n                  <span>{empire.resources.credits.toLocaleString()}</span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* User Menu */}\r\n            <div className=\"flex items-center space-x-3\">\r\n              <div className=\"text-right\">\r\n                <div className=\"text-sm font-medium\">{user?.username}</div>\r\n                {empire && (\r\n                  <div className=\"text-xs text-gray-400\">{empire.name}</div>\r\n                )}\r\n              </div>\r\n              <button\r\n                onClick={logout}\r\n                className=\"text-sm text-gray-400 hover:text-white transition-colors\"\r\n              >\r\n                Logout\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"flex\">\r\n        {/* Sidebar */}\r\n        <aside className=\"game-sidebar\">\r\n          <nav className=\"space-y-2\">\r\n            <Link\r\n              to=\"/dashboard\"\r\n              className=\"block px-3 py-2 rounded text-sm font-medium bg-gray-700 text-white\"\r\n            >\r\n              Dashboard\r\n            </Link>\r\n            <Link\r\n              to=\"/bases\"\r\n              className=\"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n            >\r\n              Bases\r\n            </Link>\r\n            <Link\r\n              to=\"/galaxy\"\r\n              className=\"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n            >\r\n              Galaxy Map\r\n            </Link>\r\n            <button\r\n              onClick={() => openModal('game_info')}\r\n              className=\"block w-full text-left px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n            >\r\n              Game Info\r\n            </button>\r\n            <Link\r\n              to=\"/help\"\r\n              className=\"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n            >\r\n              Help\r\n            </Link>\r\n            {isDesktop && (\r\n              <Link\r\n                to=\"/admin/performance\"\r\n                className=\"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n              >\r\n                Performance\r\n              </Link>\r\n            )}\r\n            <a\r\n              href=\"#\"\r\n              className=\"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n            >\r\n              Fleets\r\n            </a>\r\n            <a\r\n              href=\"#\"\r\n              className=\"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n            >\r\n              Research\r\n            </a>\r\n            <a\r\n              href=\"#\"\r\n              className=\"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors\"\r\n            >\r\n              Diplomacy\r\n            </a>\r\n          </nav>\r\n          \r\n          {/* Server Status */}\r\n          <div className=\"mt-8 p-3 bg-gray-700 rounded\">\r\n            <h3 className=\"text-sm font-medium mb-2\">Server Status</h3>\r\n            <div className=\"space-y-1 text-xs\">\r\n              <div className=\"flex justify-between\">\r\n                <span>Status:</span>\r\n                <span className={serverStatus?.status === 'OK' ? 'status-online' : 'text-red-400'}>\r\n                  {serverStatus?.status === 'OK' ? 'Online' : 'Offline'}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span>Players:</span>\r\n                <span>{serverStatus ? serverStatus.playersOnline : ''}</span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span>Uptime:</span>\r\n                <span>{serverStatus ? formatUptime(serverStatus.uptimeSeconds) : ''}</span>\r\n              </div>\r\n              {/* Network Status */}\r\n              <div className=\"flex justify-between pt-1 border-t border-gray-600 mt-1\">\r\n                <span>Network:</span>\r\n                <span className={isFullyConnected ? 'text-green-400' : 'text-red-400'}>\r\n                  {isFullyConnected ? 'Connected' : 'Disconnected'}\r\n                </span>\r\n              </div>\r\n              {networkStatus.latencyMs && (\r\n                <div className=\"flex justify-between text-gray-400\">\r\n                  <span>Latency:</span>\r\n                  <span>{networkStatus.latencyMs}ms</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </aside>\r\n\r\n        {/* Main Content Area */}\r\n        <main className=\"game-main\">\r\n          {children}\r\n        </main>\r\n      </div>\r\n      <ModalManager empire={empire || null} onUpdate={() => {}} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n","import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { CoordinateComponents } from '@game/shared';\r\n\r\nexport type MapZoomLevel = 'universe' | 'galaxy' | 'region' | 'system';\r\n\r\nexport interface MapViewport {\r\n  centerX: number;\r\n  centerY: number;\r\n  zoom: number;\r\n}\r\n\r\nexport interface UniverseMapState {\r\n  // Current view state\r\n  zoomLevel: MapZoomLevel;\r\n  selectedCoordinate: CoordinateComponents | null;\r\n  viewport: MapViewport;\r\n  \r\n  // Data cache\r\n  galaxyData: Map<number, any>;\r\n  regionData: Map<string, any>;\r\n  systemData: Map<string, any>;\r\n  \r\n  // UI state\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  showGrid: boolean;\r\n  showTerritories: boolean;\r\n  showFleets: boolean;\r\n  showResources: boolean;\r\n  showOverhaulData: boolean;\r\n  \r\n  // Search state\r\n  searchQuery: string;\r\n  searchResults: CoordinateComponents[];\r\n\r\n  // Shared timebase for System view hit-testing (non-persistent)\r\n  systemTimeScalar: number | null;\r\n\r\n  // Version bump to trigger view refresh when regionData updates\r\n  regionDataVersion: number;\r\n}\r\n\r\nexport interface UniverseMapActions {\r\n  // Navigation actions\r\n  setZoomLevel: (level: MapZoomLevel) => void;\r\n  setSelectedCoordinate: (coord: CoordinateComponents | null) => void;\r\n  navigateToCoordinate: (coord: CoordinateComponents) => void;\r\n  zoomIn: () => void;\r\n  zoomOut: () => void;\r\n  navigateToUniverse: () => void;\r\n  navigateToGalaxy: (galaxy: number) => void;\r\n  navigateToRegion: (galaxy: number, region: number) => void;\r\n  navigateToSystem: (galaxy: number, region: number, system: number) => void;\r\n  \r\n  // Viewport actions\r\n  setViewport: (viewport: MapViewport) => void;\r\n  panViewport: (deltaX: number, deltaY: number) => void;\r\n  \r\n  // Data actions\r\n  setGalaxyData: (galaxyId: number, data: any) => void;\r\n  setRegionData: (key: string, data: any) => void;\r\n  setSystemData: (key: string, data: any) => void;\r\n  clearCache: () => void;\r\n  \r\n  // UI actions\r\n  setLoading: (loading: boolean) => void;\r\n  setError: (error: string | null) => void;\r\n  toggleGrid: () => void;\r\n  toggleTerritories: () => void;\r\n  toggleFleets: () => void;\r\n  toggleResources: () => void;\r\n  toggleOverhaulData: () => void;\r\n  \r\n  // Search actions\r\n  setSearchQuery: (query: string) => void;\r\n  setSearchResults: (results: CoordinateComponents[]) => void;\r\n  \r\n  // Computed getters\r\n  getCurrentRegionKey: () => string | null;\r\n  getCurrentSystemKey: () => string | null;\r\n  getZoomLevelFromCoordinate: (coord: CoordinateComponents) => MapZoomLevel;\r\n\r\n  // Timebase setter for System view hit-testing\r\n  setSystemTimeScalar: (v: number) => void;\r\n}\r\n\r\nconst useUniverseMapStore = create<UniverseMapState & UniverseMapActions>()(\r\n  persist(\r\n    (set, get) => ({\r\n      // Initial state\r\n      zoomLevel: 'universe',\r\n      selectedCoordinate: null,\r\n      viewport: {\r\n        centerX: 0,\r\n        centerY: 0,\r\n        zoom: 1\r\n      },\r\n      \r\n      galaxyData: new Map(),\r\n      regionData: new Map(),\r\n      systemData: new Map(),\r\n      \r\n      isLoading: false,\r\n      error: null,\r\n      showGrid: true,\r\n      showTerritories: true,\r\n      showFleets: true,\r\n      showResources: false,\r\n      showOverhaulData: false,\r\n      \r\n      searchQuery: '',\r\n      searchResults: [],\r\n\r\n      // Shared timebase (initialized per SystemView render)\r\n      systemTimeScalar: null,\r\n\r\n      // Region data version for view refresh triggers\r\n      regionDataVersion: 0,\r\n      \r\n      // Navigation actions\r\n      setZoomLevel: (level) => set({ zoomLevel: level }),\r\n      \r\n      setSelectedCoordinate: (coord) => set({ selectedCoordinate: coord }),\r\n      \r\n      navigateToCoordinate: (coord) => {\r\n        const zoomLevel = get().getZoomLevelFromCoordinate(coord);\r\n        set({ \r\n          selectedCoordinate: coord,\r\n          zoomLevel,\r\n          viewport: {\r\n            centerX: coord.galaxy,\r\n            centerY: coord.region,\r\n            zoom: zoomLevel === 'universe' ? 1 : zoomLevel === 'galaxy' ? 2 : zoomLevel === 'region' ? 4 : 8\r\n          }\r\n        });\r\n      },\r\n\r\n      navigateToUniverse: () => {\r\n        set({\r\n          zoomLevel: 'universe',\r\n          selectedCoordinate: null,\r\n          viewport: { centerX: 0, centerY: 0, zoom: 1 }\r\n        });\r\n      },\r\n\r\n      navigateToGalaxy: (galaxy) => {\r\n        const server = get().selectedCoordinate?.server ?? 'A';\r\n        set({\r\n          zoomLevel: 'galaxy',\r\n          selectedCoordinate: {\r\n            server,\r\n            galaxy,\r\n            region: 0,\r\n            system: 0,\r\n            body: 0\r\n          },\r\n          viewport: { centerX: galaxy, centerY: 0, zoom: 2 }\r\n        });\r\n      },\r\n\r\n      navigateToRegion: (galaxy, region) => {\r\n        const server = get().selectedCoordinate?.server ?? 'A';\r\n        set({\r\n          zoomLevel: 'region',\r\n          selectedCoordinate: {\r\n            server,\r\n            galaxy,\r\n            region,\r\n            system: 0,\r\n            body: 0\r\n          },\r\n          viewport: { centerX: galaxy, centerY: region, zoom: 4 }\r\n        });\r\n      },\r\n\r\n      navigateToSystem: (galaxy, region, system) => {\r\n        const server = get().selectedCoordinate?.server ?? 'A';\r\n        set({\r\n          zoomLevel: 'system',\r\n          selectedCoordinate: {\r\n            server,\r\n            galaxy,\r\n            region,\r\n            system,\r\n            body: 0\r\n          },\r\n          viewport: { centerX: galaxy, centerY: region, zoom: 8 }\r\n        });\r\n      },\r\n      \r\n      zoomIn: () => {\r\n        const { zoomLevel } = get();\r\n        const levels: MapZoomLevel[] = ['universe', 'galaxy', 'region', 'system'];\r\n        const currentIndex = levels.indexOf(zoomLevel);\r\n        if (currentIndex < levels.length - 1) {\r\n          set({ zoomLevel: levels[currentIndex + 1] });\r\n        }\r\n      },\r\n      \r\n      zoomOut: () => {\r\n        const { zoomLevel } = get();\r\n        const levels: MapZoomLevel[] = ['universe', 'galaxy', 'region', 'system'];\r\n        const currentIndex = levels.indexOf(zoomLevel);\r\n        if (currentIndex > 0) {\r\n          set({ zoomLevel: levels[currentIndex - 1] });\r\n        }\r\n      },\r\n      \r\n      // Viewport actions\r\n      setViewport: (viewport) => set({ viewport }),\r\n      \r\n      panViewport: (deltaX, deltaY) => {\r\n        const { viewport } = get();\r\n        set({\r\n          viewport: {\r\n            ...viewport,\r\n            centerX: viewport.centerX + deltaX,\r\n            centerY: viewport.centerY + deltaY\r\n          }\r\n        });\r\n      },\r\n      \r\n      // Data actions\r\n      setGalaxyData: (galaxyId, data) => {\r\n        const { galaxyData } = get();\r\n        const newGalaxyData = new Map(galaxyData);\r\n        newGalaxyData.set(galaxyId, data);\r\n        set({ galaxyData: newGalaxyData });\r\n      },\r\n      \r\n      setRegionData: (key, data) => {\r\n        const { regionData } = get();\r\n        const newRegionData = new Map(regionData);\r\n        newRegionData.set(key, data);\r\n        set({\r\n          regionData: newRegionData,\r\n          regionDataVersion: (get().regionDataVersion ?? 0) + 1\r\n        });\r\n      },\r\n      \r\n      setSystemData: (key, data) => {\r\n        const { systemData } = get();\r\n        const newSystemData = new Map(systemData);\r\n        newSystemData.set(key, data);\r\n        set({ systemData: newSystemData });\r\n      },\r\n      \r\n      clearCache: () => set({\r\n        galaxyData: new Map(),\r\n        regionData: new Map(),\r\n        systemData: new Map()\r\n      }),\r\n      \r\n      // UI actions\r\n      setLoading: (loading) => set({ isLoading: loading }),\r\n      setError: (error) => set({ error }),\r\n      toggleGrid: () => set((state) => ({ showGrid: !state.showGrid })),\r\n      toggleTerritories: () => set((state) => ({ showTerritories: !state.showTerritories })),\r\n      toggleFleets: () => set((state) => ({ showFleets: !state.showFleets })),\r\n      toggleResources: () => set((state) => ({ showResources: !state.showResources })),\r\n      toggleOverhaulData: () => set((state) => ({ showOverhaulData: !state.showOverhaulData })),\r\n      \r\n      // Search actions\r\n      setSearchQuery: (query) => set({ searchQuery: query }),\r\n      setSearchResults: (results) => set({ searchResults: results }),\r\n\r\n      // System timebase setter\r\n      setSystemTimeScalar: (v) => set({ systemTimeScalar: v }),\r\n      \r\n      // Computed getters\r\n      getCurrentRegionKey: () => {\r\n        const { selectedCoordinate } = get();\r\n        if (!selectedCoordinate) return null;\r\n        return `${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}`;\r\n      },\r\n      \r\n      getCurrentSystemKey: () => {\r\n        const { selectedCoordinate } = get();\r\n        if (!selectedCoordinate) return null;\r\n        return `${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}:${selectedCoordinate.system}`;\r\n      },\r\n      \r\n      getZoomLevelFromCoordinate: (coord) => {\r\n        // Select view based on most specific coordinate part provided\r\n        if (coord.body > 0) return 'system';\r\n        // If a specific system is referenced (even with body 0), show system view\r\n        if (coord.system > 0) return 'system';\r\n        // Clicking a region should enter region view (region can be 0..99)\r\n        if (coord.region >= 0) return 'region';\r\n        // Fallback to galaxy view when only galaxy is specified\r\n        if (coord.galaxy >= 0) return 'galaxy';\r\n        // Default to universe view\r\n        return 'universe';\r\n      }\r\n    }),\r\n    {\r\n      name: 'universe-map-storage',\r\n      partialize: (state) => ({\r\n        zoomLevel: state.zoomLevel,\r\n        selectedCoordinate: state.selectedCoordinate,\r\n        viewport: state.viewport,\r\n        showGrid: state.showGrid,\r\n        showTerritories: state.showTerritories,\r\n        showFleets: state.showFleets,\r\n        showResources: state.showResources,\r\n        showOverhaulData: state.showOverhaulData\r\n      })\r\n    }\r\n  )\r\n);\r\n\r\nexport default useUniverseMapStore;\r\n","import React from 'react';\r\nimport { CoordinateComponents } from '@game/shared';\r\nimport { MapZoomLevel } from '../../../stores/universeMapStore';\r\n\r\ninterface NavigationBreadcrumbProps {\r\n  selectedCoordinate: CoordinateComponents | null;\r\n  zoomLevel: MapZoomLevel;\r\n  onUniverse: () => void;\r\n  onGalaxy: (galaxy: number) => void;\r\n  onRegion: (galaxy: number, region: number) => void;\r\n}\r\n\r\nconst NavigationBreadcrumb: React.FC<NavigationBreadcrumbProps> = ({\r\n  selectedCoordinate,\r\n  zoomLevel,\r\n  onUniverse,\r\n  onGalaxy,\r\n  onRegion\r\n}) => {\r\n  if (!selectedCoordinate) {\r\n    return (\r\n      <div className=\"bg-gray-800 border border-gray-600 rounded-lg px-4 py-3\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-yellow-400 font-bold text-lg\">Universe Overview</span>\r\n          <span className=\"text-gray-400 text-sm\">(Select a galaxy to explore)</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n\r\n  const handleUniverseClick = () => {\r\n    onUniverse();\r\n  };\r\n\r\n  const handleGalaxyClick = () => {\r\n    onGalaxy(selectedCoordinate.galaxy);\r\n  };\r\n\r\n  const handleRegionClick = () => {\r\n    onRegion(selectedCoordinate.galaxy, selectedCoordinate.region);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-gray-800 border border-gray-600 rounded-lg px-4 py-3\">\r\n      <div className=\"flex items-center gap-2 text-lg\">\r\n        {/* Universe Level */}\r\n        <button\r\n          onClick={handleUniverseClick}\r\n          className=\"text-blue-400 hover:text-blue-300 transition-colors font-medium\"\r\n        >\r\n          Universe\r\n        </button>\r\n\r\n        {/* Galaxy Level */}\r\n        {selectedCoordinate.galaxy >= 0 && (\r\n          <>\r\n            <span className=\"text-gray-400\">{'>'}</span>\r\n            <button\r\n              onClick={handleGalaxyClick}\r\n              className={`transition-colors font-medium ${\r\n                zoomLevel === 'galaxy' || zoomLevel === 'universe'\r\n                  ? 'text-yellow-400'\r\n                  : 'text-blue-400 hover:text-blue-300'\r\n              }`}\r\n            >\r\n              Galaxy {selectedCoordinate.server}{selectedCoordinate.galaxy.toString().padStart(2, '0')}\r\n            </button>\r\n          </>\r\n        )}\r\n\r\n        {/* Region Level */}\r\n        {selectedCoordinate.region >= 0 && zoomLevel !== 'universe' && zoomLevel !== 'galaxy' && (\r\n          <>\r\n            <span className=\"text-gray-400\">{'>'}</span>\r\n            <button\r\n              onClick={handleRegionClick}\r\n              className={`transition-colors font-medium ${\r\n                zoomLevel === 'region'\r\n                  ? 'text-yellow-400'\r\n                  : 'text-blue-400 hover:text-blue-300'\r\n              }`}\r\n            >\r\n              Region {selectedCoordinate.region.toString().padStart(2, '0')}\r\n            </button>\r\n          </>\r\n        )}\r\n\r\n        {/* System Level */}\r\n        {selectedCoordinate.system >= 0 && zoomLevel === 'system' && (\r\n          <>\r\n            <span className=\"text-gray-400\">{'>'}</span>\r\n            <span className=\"text-yellow-400 font-medium\">\r\n              System {selectedCoordinate.system.toString().padStart(2, '0')}\r\n            </span>\r\n          </>\r\n        )}\r\n\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NavigationBreadcrumb;\r\n","import React from 'react';\r\nimport useUniverseMapStore from '../../../stores/universeMapStore';\r\n\r\ninterface LocationTooltipProps {\r\n  location: any;\r\n  position: { x: number; y: number };\r\n}\r\n\r\nconst LocationTooltip: React.FC<LocationTooltipProps> = ({ location, position }) => {\r\n  if (!location) return null;\r\n  const { showOverhaulData } = useUniverseMapStore();\r\n\r\n  const getLocationIcon = (type: string) => {\r\n    return type === 'planet' ? '' : '';\r\n  };\r\n\r\n\r\n\r\n  // Position tooltip to avoid going off screen\r\n  const tooltipStyle = {\r\n    left: position.x + 15,\r\n    top: position.y - 10,\r\n    transform: position.x > window.innerWidth - 300 ? 'translateX(-100%)' : 'none'\r\n  };\r\n\r\n  return (\r\n    <div \r\n      className=\"absolute z-50 bg-gray-900 border border-gray-600 rounded-lg p-3 shadow-lg pointer-events-none\"\r\n      style={tooltipStyle}\r\n    >\r\n      {/* Header */}\r\n      <div className=\"flex items-center gap-2 mb-2\">\r\n        <span className=\"text-lg\">{getLocationIcon(location.type)}</span>\r\n        <div>\r\n          <div className=\"text-white font-semibold\">{location.coord}</div>\r\n          <div className=\"text-xs text-gray-400 capitalize\">{location.type}</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Owner */}\r\n      <div className=\"mb-2\">\r\n        <span className=\"text-gray-400 text-sm\">Owner: </span>\r\n        <span className={location.owner ? 'text-red-400' : 'text-green-400'}>\r\n          {location.owner ? location.owner.username : 'Unowned'}\r\n        </span>\r\n      </div>\r\n\r\n      {/* Properties */}\r\n      <div className=\"space-y-1\">\r\n\r\n      {/* Overhaul Data (optional) */}\r\n      {showOverhaulData && (\r\n        <div className=\"mt-2 pt-2 border-t border-gray-600 space-y-1\">\r\n          <div className=\"text-xs text-blue-300 font-semibold\">Overhaul</div>\r\n\r\n          {/* Body-level (planets/asteroids) */}\r\n          {location.terrain && (\r\n            <>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-400 text-sm\">Terrain:</span>\r\n                <span className=\"text-sm text-gray-200\">{location.terrain?.type}</span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-400 text-sm\">Orbit Pos:</span>\r\n                <span className=\"text-sm text-gray-200\">{location.orbitPosition ?? ''}</span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-400 text-sm\">Solar Energy:</span>\r\n                <span className=\"text-sm text-gray-200\">{location.result?.solarEnergy ?? ''}</span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-400 text-sm\">Fertility:</span>\r\n                <span className=\"text-sm text-gray-200\">{location.result?.fertility ?? ''}</span>\r\n              </div>\r\n              {location.result?.yields && (\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-400 text-sm\">Yields (M/G/C):</span>\r\n                  <span className=\"text-sm text-gray-200\">\r\n                    {location.result.yields.metal}/{location.result.yields.gas}/{location.result.yields.crystals}\r\n                  </span>\r\n                </div>\r\n              )}\r\n              {typeof location.result?.area === 'number' && (\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-400 text-sm\">Area:</span>\r\n                  <span className=\"text-sm text-gray-200\">{location.result.area}</span>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n\r\n          {/* Star-level */}\r\n          {location.starOverhaul?.kind && (\r\n            <>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-400 text-sm\">Star Kind:</span>\r\n                <span className=\"text-sm text-yellow-300\">{location.starOverhaul.kind}</span>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      </div>\r\n\r\n      {/* Context Information */}\r\n      {location.context && (\r\n        <div className=\"mt-2 pt-2 border-t border-gray-600\">\r\n          <div className=\"text-xs text-gray-400\">\r\n            Galaxy {location.context.galaxy}  Region {location.context.region}  System {location.context.system}  Body {location.context.body}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Additional Info */}\r\n      {location.buildings && location.buildings.length > 0 && (\r\n        <div className=\"mt-2 pt-2 border-t border-gray-600\">\r\n          <div className=\"text-xs text-gray-400 mb-1\">Buildings:</div>\r\n          <div className=\"text-xs text-blue-400\">\r\n            {location.buildings.length} structure{location.buildings.length !== 1 ? 's' : ''}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {location.fleets && location.fleets.length > 0 && (\r\n        <div className=\"mt-2 pt-2 border-t border-gray-600\">\r\n          <div className=\"text-xs text-gray-400 mb-1\">Fleets:</div>\r\n          <div className=\"text-xs text-red-400\">\r\n            {location.fleets.length} fleet{location.fleets.length !== 1 ? 's' : ''} present\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LocationTooltip;\r\n","// Shared constants for consistent layout across all map components\r\n\r\nexport const UNIVERSE_LAYOUT = {\r\n  galaxySize: 80,\r\n  padding: 20,\r\n  cols: 8,\r\n  rows: 5,\r\n  totalGalaxies: 40\r\n} as const;\r\n\r\nexport const GALAXY_LAYOUT = {\r\n  regionSize: 60,\r\n  padding: 10,\r\n  cols: 10,\r\n  rows: 10,\r\n  totalRegions: 100\r\n} as const;\r\n\r\nexport const REGION_LAYOUT = {\r\n  systemSize: 40,\r\n  padding: 15,\r\n  cols: 10,\r\n  rows: 10,\r\n  maxSystems: 100\r\n} as const;\r\n\r\nexport const SYSTEM_LAYOUT = {\r\n  bodySize: 30,\r\n  padding: 12,\r\n  cols: 8,\r\n  rows: 6,\r\n  maxBodies: 48\r\n} as const;\r\n\r\nexport const STANDARD_ORBITS = [60, 90, 120, 150, 180, 210, 240, 270] as const;\r\n\r\n// Helper functions for coordinate calculations\r\nexport const calculateGridLayout = (\r\n  canvasWidth: number,\r\n  canvasHeight: number,\r\n  itemSize: number,\r\n  padding: number,\r\n  cols: number,\r\n  rows: number\r\n) => {\r\n  const totalWidth = cols * itemSize + (cols - 1) * padding;\r\n  const totalHeight = rows * itemSize + (rows - 1) * padding;\r\n  \r\n  const startX = (canvasWidth - totalWidth) / 2;\r\n  const startY = (canvasHeight - totalHeight) / 2;\r\n  \r\n  return {\r\n    totalWidth,\r\n    totalHeight,\r\n    startX,\r\n    startY\r\n  };\r\n};\r\n\r\n/**\r\n * Calculate a fitted grid layout that uniformly scales itemSize and padding\r\n * so the entire grid fits within the canvas with a margin. Returns the\r\n * scaled itemSize/padding and centered startX/startY.\r\n */\r\nexport const calculateFittedGridLayout = (\r\n  canvasWidth: number,\r\n  canvasHeight: number,\r\n  baseItemSize: number,\r\n  basePadding: number,\r\n  cols: number,\r\n  rows: number,\r\n  margin: number = 16\r\n) => {\r\n  // Base (unscaled) total dimensions\r\n  const baseTotalWidth = cols * baseItemSize + (cols - 1) * basePadding;\r\n  const baseTotalHeight = rows * baseItemSize + (rows - 1) * basePadding;\r\n\r\n  // Available space after applying margin on all sides\r\n  const availableWidth = Math.max(0, canvasWidth - margin * 2);\r\n  const availableHeight = Math.max(0, canvasHeight - margin * 2);\r\n\r\n  // Uniform scale to fit both width and height\r\n  const scale = Math.min(\r\n    availableWidth / baseTotalWidth,\r\n    availableHeight / baseTotalHeight\r\n  );\r\n\r\n  // Scaled sizes\r\n  const itemSize = baseItemSize * scale;\r\n  const padding = basePadding * scale;\r\n\r\n  // Recompute scaled totals\r\n  const totalWidth = cols * itemSize + (cols - 1) * padding;\r\n  const totalHeight = rows * itemSize + (rows - 1) * padding;\r\n\r\n  // Center the grid\r\n  const startX = (canvasWidth - totalWidth) / 2;\r\n  const startY = (canvasHeight - totalHeight) / 2;\r\n\r\n  return {\r\n    scale,\r\n    itemSize,\r\n    padding,\r\n    startX,\r\n    startY,\r\n    totalWidth,\r\n    totalHeight,\r\n    margin\r\n  };\r\n};\r\n\r\nexport const getGridPosition = (\r\n  index: number,\r\n  cols: number,\r\n  itemSize: number,\r\n  padding: number,\r\n  startX: number,\r\n  startY: number\r\n) => {\r\n  const row = Math.floor(index / cols);\r\n  const col = index % cols;\r\n  \r\n  const x = startX + col * (itemSize + padding);\r\n  const y = startY + row * (itemSize + padding);\r\n  \r\n  return { x, y, row, col };\r\n};\r\n\r\nexport const getClickedIndex = (\r\n  clickX: number,\r\n  clickY: number,\r\n  startX: number,\r\n  startY: number,\r\n  itemSize: number,\r\n  padding: number,\r\n  cols: number,\r\n  rows: number,\r\n  totalWidth: number,\r\n  totalHeight: number\r\n): number | null => {\r\n  // Check if click is within the grid area\r\n  if (clickX < startX || clickX > startX + totalWidth || \r\n      clickY < startY || clickY > startY + totalHeight) {\r\n    return null;\r\n  }\r\n  \r\n  const relativeX = clickX - startX;\r\n  const relativeY = clickY - startY;\r\n  \r\n  const col = Math.floor(relativeX / (itemSize + padding));\r\n  const row = Math.floor(relativeY / (itemSize + padding));\r\n  \r\n  // Check if click is within an item (not in padding area)\r\n  const itemLocalX = relativeX % (itemSize + padding);\r\n  const itemLocalY = relativeY % (itemSize + padding);\r\n  \r\n  if (itemLocalX < itemSize && itemLocalY < itemSize && \r\n      col < cols && row < rows) {\r\n    const index = row * cols + col;\r\n    return index;\r\n  }\r\n  \r\n  return null;\r\n};\r\n","/**\r\n * Offscreen canvas layer helpers for caching and composition.\r\n * Keep this browser-only (no import.meta or SSR usage).\r\n */\r\n\r\nexport type LayerCache = Map<string, HTMLCanvasElement>;\r\n\r\n/**\r\n * Create an offscreen canvas of the given size.\r\n */\r\nexport function createOffscreenLayer(width: number, height: number): HTMLCanvasElement {\r\n  const canvas = document.createElement(\"canvas\");\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  return canvas;\r\n}\r\n\r\n/**\r\n * Clear and draw into a layer using the provided draw function.\r\n */\r\nexport function drawToLayer(\r\n  layer: HTMLCanvasElement,\r\n  draw: (ctx: CanvasRenderingContext2D) => void\r\n): void {\r\n  const ctx = layer.getContext(\"2d\");\r\n  if (!ctx) return;\r\n  ctx.clearRect(0, 0, layer.width, layer.height);\r\n  draw(ctx);\r\n}\r\n\r\n/**\r\n * Compose multiple layers onto a target 2D context.\r\n * Layers are drawn in order.\r\n */\r\nexport function composeLayers(\r\n  targetCtx: CanvasRenderingContext2D,\r\n  layers: HTMLCanvasElement[]\r\n): void {\r\n  for (const layer of layers) {\r\n    targetCtx.drawImage(layer, 0, 0);\r\n  }\r\n}\r\n\r\n/**\r\n * Minimal stable serialization for dependency fingerprints.\r\n * The caller should pass a minimized deps object (ids/flags/hashes only).\r\n */\r\nexport function getCacheKeyFromDeps(deps: Record<string, unknown>): string {\r\n  // Stable stringify with sorted keys and circular guard\r\n  const seen = new WeakSet<object>();\r\n\r\n  const stable = (value: any): string => {\r\n    const t = typeof value;\r\n    if (value === null || t === \"number\" || t === \"boolean\") return JSON.stringify(value);\r\n    if (t === \"string\") return JSON.stringify(value);\r\n    if (t === \"undefined\") return '\"__undef__\"';\r\n    if (t === \"function\" || t === \"symbol\") return `\"__${t}__\"`;\r\n\r\n    if (Array.isArray(value)) {\r\n      return `[${value.map((v) => stable(v)).join(\",\")}]`;\r\n    }\r\n\r\n    if (t === \"object\") {\r\n      if (seen.has(value)) return '\"__circular__\"';\r\n      seen.add(value);\r\n      const keys = Object.keys(value).sort();\r\n      const entries = keys.map((k) => `${JSON.stringify(k)}:${stable((value as any)[k])}`);\r\n      return `{${entries.join(\",\")}}`;\r\n    }\r\n\r\n    // Fallback\r\n    try {\r\n      return JSON.stringify(value);\r\n    } catch {\r\n      return `\"${String(value)}\"`;\r\n    }\r\n  };\r\n\r\n  try {\r\n    return stable(deps);\r\n  } catch {\r\n    // Final fallback: deterministic key=value join\r\n    return Object.keys(deps)\r\n      .sort()\r\n      .map((k) => `${k}=${String((deps as any)[k])}`)\r\n      .join(\"&\");\r\n  }\r\n}\r\n\r\n/**\r\n * Build or reuse a cached offscreen layer based on a key prefix and dependency fingerprint.\r\n * The builder should create the layer and fully render its content.\r\n */\r\nexport function buildCachedLayer(\r\n  keyPrefix: string,\r\n  deps: Record<string, unknown>,\r\n  cache: LayerCache,\r\n  builder: () => HTMLCanvasElement\r\n): HTMLCanvasElement {\r\n  const key = `${keyPrefix}:${getCacheKeyFromDeps(deps)}`;\r\n  const cached = cache.get(key);\r\n  if (cached) return cached;\r\n  const layer = builder();\r\n  cache.set(key, layer);\r\n  return layer;\r\n}\r\n\r\n/**\r\n * Optionally clear cached layers by predicate. If no predicate is supplied, clears all.\r\n */\r\nexport function clearLayerCache(\r\n  cache: LayerCache,\r\n  predicate?: (key: string) => boolean\r\n): void {\r\n  for (const key of cache.keys()) {\r\n    if (!predicate || predicate(key)) {\r\n      cache.delete(key);\r\n    }\r\n  }\r\n}\r\n","import * as React from 'react';\r\nimport { Empire } from '@game/shared';\r\nimport { MapViewport } from '../../../stores/universeMapStore';\r\nimport { UNIVERSE_LAYOUT, calculateGridLayout, getClickedIndex } from './mapConstants';\r\nimport { buildCachedLayer, createOffscreenLayer, drawToLayer, composeLayers, clearLayerCache, LayerCache } from './helpers/offscreenLayers';\r\nimport { computeEmpireTerritoryHash } from './helpers/hashing';\r\n\r\ninterface UniverseOverviewProps {\r\n  canvas: HTMLCanvasElement;\r\n  viewport: MapViewport;\r\n  empire: Empire;\r\n  showGrid: boolean;\r\n  showTerritories: boolean;\r\n}\r\n\r\n// Dev-only performance monitor (logs FPS and warns on sustained low FPS)\r\n// Enabled when localStorage.getItem('enableFpsMonitor') === '1'\r\nclass PerformanceMonitor {\r\n  private frames = 0;\r\n  private last = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n  private fps = 0;\r\n  private belowThresholdCount = 0;\r\n\r\n  constructor(\r\n    private enabled: boolean,\r\n    private threshold = 30,\r\n    private warnStreakSeconds = 3\r\n  ) {}\r\n\r\n  update(now: number): number {\r\n    this.frames++;\r\n    if (now - this.last >= 1000) {\r\n      this.fps = this.frames;\r\n      this.frames = 0;\r\n      this.last = now;\r\n\r\n      if (this.enabled) {\r\n        if (typeof console !== 'undefined' && typeof console.debug === 'function') {\r\n          console.debug(`[UniverseOverview] ${this.fps} fps`);\r\n        }\r\n        if (this.fps < this.threshold) {\r\n          this.belowThresholdCount++;\r\n          if (this.belowThresholdCount >= this.warnStreakSeconds) {\r\n            if (typeof console !== 'undefined' && typeof console.warn === 'function') {\r\n              console.warn(\r\n                `[UniverseOverview] Sustained low FPS (${this.fps} < ${this.threshold}) for ${this.warnStreakSeconds}s`\r\n              );\r\n            }\r\n            this.belowThresholdCount = 0;\r\n          }\r\n        } else {\r\n          this.belowThresholdCount = 0;\r\n        }\r\n      }\r\n    }\r\n    return this.fps;\r\n  }\r\n}\r\n\r\nconst UniverseOverview: React.FC<UniverseOverviewProps> = ({\r\n  canvas,\r\n  empire,\r\n  showGrid,\r\n  showTerritories\r\n}) => {\r\n  const layoutRef = React.useRef<ReturnType<typeof calculateGridLayout> | null>(null);\r\n  const layerCacheRef = React.useRef<LayerCache>(new Map());\r\n  const animationRef = React.useRef<number | null>(null);\r\n  const enableFpsMonitor =\r\n    (typeof window !== 'undefined') &&\r\n    !!window.localStorage &&\r\n    window.localStorage.getItem('enableFpsMonitor') === '1';\r\n  const perfMonitorRef = React.useRef<PerformanceMonitor | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    let running = true;\r\n\r\n    // Init performance monitor (dev-guarded via localStorage flag)\r\n    perfMonitorRef.current = new PerformanceMonitor(enableFpsMonitor);\r\n\r\n    // Compute and cache fitted layout for this run\r\n    const { galaxySize, padding, cols, rows } = UNIVERSE_LAYOUT;\r\n    const fitted = calculateGridLayout(canvas.width, canvas.height, galaxySize, padding, cols, rows);\r\n    layoutRef.current = fitted;\r\n\r\n    const draw = () => {\r\n      if (!running) return;\r\n\r\n      // Clear and draw animated star field (dynamic, not cached)\r\n      ctx.fillStyle = '#000011';\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      drawStarField(ctx, canvas.width, canvas.height);\r\n\r\n      // Ensure layout\r\n      const layout =\r\n        layoutRef.current ??\r\n        calculateGridLayout(canvas.width, canvas.height, galaxySize, padding, cols, rows);\r\n      layoutRef.current = layout;\r\n\r\n      // Background/grid (static-most)\r\n      const gridDeps = {\r\n        width: canvas.width,\r\n        height: canvas.height,\r\n        showGrid,\r\n        cols,\r\n        rows\r\n      };\r\n      const gridLayer = buildCachedLayer('universe:background', gridDeps, layerCacheRef.current, () => {\r\n        const off = createOffscreenLayer(canvas.width, canvas.height);\r\n        drawToLayer(off, (gctx) => {\r\n          if (showGrid) {\r\n            drawUniverseGridLines(gctx, layout, cols, rows, galaxySize, padding);\r\n          }\r\n        });\r\n        return off;\r\n      });\r\n\r\n      // Galaxies + labels (semi-static based on territories)\r\n      const galaxiesDeps = {\r\n        width: canvas.width,\r\n        height: canvas.height,\r\n        showTerritories,\r\n        empireHash: computeEmpireTerritoryHash(empire)\r\n      };\r\n      const galaxiesLayer = buildCachedLayer('universe:galaxies', galaxiesDeps, layerCacheRef.current, () => {\r\n        const off = createOffscreenLayer(canvas.width, canvas.height);\r\n        drawToLayer(off, (gctx) => {\r\n          drawGalaxies(gctx, layout, showTerritories, empire);\r\n        });\r\n        return off;\r\n      });\r\n\r\n      // Compose cached layers on top of star field\r\n      composeLayers(ctx, [gridLayer, galaxiesLayer]);\r\n\r\n      // FPS tracking (dev-guarded logging/overlay)\r\n      {\r\n        const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n        const fps = perfMonitorRef.current ? perfMonitorRef.current.update(now) : 0;\r\n\r\n        if (enableFpsMonitor) {\r\n          ctx.fillStyle = 'rgba(0,255,0,0.85)';\r\n          ctx.font = '10px monospace';\r\n          ctx.textAlign = 'left';\r\n          ctx.fillText(`${fps} fps`, 8, 16);\r\n        }\r\n      }\r\n\r\n      animationRef.current = requestAnimationFrame(draw);\r\n    };\r\n\r\n    draw();\r\n\r\n    return () => {\r\n      running = false;\r\n      if (animationRef.current) {\r\n        cancelAnimationFrame(animationRef.current);\r\n        animationRef.current = null;\r\n      }\r\n    };\r\n  }, [canvas, empire, showGrid, showTerritories, enableFpsMonitor]);\r\n\r\n  // Cache hygiene: clear when dimensions or flags change\r\n  React.useEffect(() => {\r\n    clearLayerCache(layerCacheRef.current, (k) =>\r\n      k.startsWith('universe:background') || k.startsWith('universe:galaxies')\r\n    );\r\n  }, [canvas.width, canvas.height, showGrid, showTerritories]);\r\n\r\n  return null; // This component only renders to canvas\r\n};\r\n\r\nconst drawStarField = (ctx: CanvasRenderingContext2D, width: number, height: number) => {\r\n  const time = Date.now() * 0.0001;\r\n\r\n  // Draw twinkling stars\r\n  for (let i = 0; i < 300; i++) {\r\n    const x = (i * 37) % width;\r\n    const y = (i * 73) % height;\r\n    const brightness = 0.2 + 0.8 * Math.sin(time + i * 0.1);\r\n    const size = 0.5 + 0.5 * Math.sin(time * 2 + i * 0.05);\r\n\r\n    ctx.fillStyle = `rgba(255, 255, 255, ${brightness * 0.6})`;\r\n    ctx.fillRect(x, y, size, size);\r\n  }\r\n\r\n  // Draw nebula effects\r\n  for (let i = 0; i < 5; i++) {\r\n    const x = (i * 157) % width;\r\n    const y = (i * 211) % height;\r\n    const radius = 50 + 30 * Math.sin(time + i);\r\n\r\n    const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);\r\n    gradient.addColorStop(0, `rgba(100, 50, 200, ${0.1 * Math.sin(time + i)})`);\r\n    gradient.addColorStop(1, 'rgba(100, 50, 200, 0)');\r\n\r\n    ctx.fillStyle = gradient;\r\n    ctx.fillRect(x - radius, y - radius, radius * 2, radius * 2);\r\n  }\r\n};\r\n\r\n/**\r\n * Draw only the grid lines using a fitted layout (used for off-screen caching).\r\n */\r\nconst drawUniverseGridLines = (\r\n  ctx: CanvasRenderingContext2D,\r\n  layout: ReturnType<typeof calculateGridLayout>,\r\n  cols: number,\r\n  rows: number,\r\n  galaxySize: number,\r\n  padding: number\r\n) => {\r\n  const { totalWidth, totalHeight, startX, startY } = layout;\r\n\r\n  ctx.strokeStyle = 'rgba(100, 100, 100, 0.3)';\r\n  ctx.lineWidth = 1;\r\n\r\n  // Vertical lines\r\n  for (let col = 0; col <= cols; col++) {\r\n    const x = startX + col * (galaxySize + padding) - padding / 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, startY - padding / 2);\r\n    ctx.lineTo(x, startY + totalHeight + padding / 2);\r\n    ctx.stroke();\r\n  }\r\n\r\n  // Horizontal lines\r\n  for (let row = 0; row <= rows; row++) {\r\n    const y = startY + row * (galaxySize + padding) - padding / 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(startX - padding / 2, y);\r\n    ctx.lineTo(startX + totalWidth + padding / 2, y);\r\n    ctx.stroke();\r\n  }\r\n};\r\n\r\n/**\r\n * Draw galaxies (spirals + labels) using a fitted layout (offscreen cached).\r\n */\r\nconst drawGalaxies = (\r\n  ctx: CanvasRenderingContext2D,\r\n  layout: ReturnType<typeof calculateGridLayout>,\r\n  showTerritories: boolean,\r\n  empire: Empire\r\n) => {\r\n  const { galaxySize, padding, cols } = UNIVERSE_LAYOUT;\r\n  const { startX, startY } = layout;\r\n\r\n  // Galaxies\r\n  for (let galaxyId = 0; galaxyId < 40; galaxyId++) {\r\n    const row = Math.floor(galaxyId / cols);\r\n    const col = galaxyId % cols;\r\n\r\n    const x = startX + col * (galaxySize + padding);\r\n    const y = startY + row * (galaxySize + padding);\r\n\r\n    drawGalaxy(ctx, x, y, galaxySize, galaxyId, empire, showTerritories);\r\n  }\r\n\r\n  // Labels\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';\r\n  ctx.font = '12px monospace';\r\n  ctx.textAlign = 'center';\r\n\r\n  for (let galaxyId = 0; galaxyId < 40; galaxyId++) {\r\n    const row = Math.floor(galaxyId / cols);\r\n    const col = galaxyId % cols;\r\n\r\n    const x = startX + col * (galaxySize + padding) + galaxySize / 2;\r\n    const y = startY + row * (galaxySize + padding) + galaxySize + 15;\r\n\r\n    ctx.fillText(`Galaxy ${galaxyId}`, x, y);\r\n  }\r\n};\r\n\r\nconst drawGalaxy = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  size: number,\r\n  galaxyId: number,\r\n  empire: Empire,\r\n  showTerritories: boolean\r\n) => {\r\n  const centerX = x + size / 2;\r\n  const centerY = y + size / 2;\r\n  const radius = size / 2 - 5;\r\n\r\n  // Draw galaxy spiral\r\n  ctx.strokeStyle = 'rgba(200, 200, 255, 0.6)';\r\n  ctx.lineWidth = 2;\r\n\r\n  for (let arm = 0; arm < 3; arm++) {\r\n    ctx.beginPath();\r\n    for (let t = 0; t < Math.PI * 4; t += 0.1) {\r\n      const spiralRadius = (t / (Math.PI * 4)) * radius;\r\n      const angle = t + (arm * Math.PI * 2 / 3);\r\n      const spiralX = centerX + Math.cos(angle) * spiralRadius;\r\n      const spiralY = centerY + Math.sin(angle) * spiralRadius;\r\n\r\n      if (t === 0) {\r\n        ctx.moveTo(spiralX, spiralY);\r\n      } else {\r\n        ctx.lineTo(spiralX, spiralY);\r\n      }\r\n    }\r\n    ctx.stroke();\r\n  }\r\n\r\n  // Draw galaxy core\r\n  const coreGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 15);\r\n  coreGradient.addColorStop(0, 'rgba(255, 255, 200, 0.8)');\r\n  coreGradient.addColorStop(1, 'rgba(255, 255, 200, 0)');\r\n  ctx.fillStyle = coreGradient;\r\n  ctx.fillRect(centerX - 15, centerY - 15, 30, 30);\r\n\r\n  // Show territory indicators if enabled\r\n  if (showTerritories) {\r\n    // Check if this galaxy contains empire territories\r\n    const hasTerritory = empire.territories.some(coord => {\r\n      try {\r\n        const galaxyFromCoord = parseInt(coord.substring(1, 3), 10);\r\n        return galaxyFromCoord === galaxyId;\r\n      } catch {\r\n        return false;\r\n      }\r\n    });\r\n\r\n    if (hasTerritory) {\r\n      // Draw territory indicator\r\n      ctx.strokeStyle = '#00ff00';\r\n      ctx.lineWidth = 3;\r\n      ctx.beginPath();\r\n      ctx.arc(centerX, centerY, radius + 2, 0, Math.PI * 2);\r\n      ctx.stroke();\r\n\r\n      // Add empire flag\r\n      ctx.fillStyle = '#00ff00';\r\n      ctx.fillRect(x + size - 12, y + 2, 10, 8);\r\n    }\r\n  }\r\n\r\n  // Draw galaxy border\r\n  ctx.strokeStyle = 'rgba(100, 150, 255, 0.4)';\r\n  ctx.lineWidth = 1;\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n\r\n  // Add hover effect (placeholder)\r\n  const isHovered = false;\r\n  if (isHovered) {\r\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.arc(centerX, centerY, radius + 3, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n  }\r\n};\r\n\r\n// Click handling function for universe view\r\nexport const handleUniverseViewClick = (\r\n  clickX: number,\r\n  clickY: number,\r\n  canvasWidth: number,\r\n  canvasHeight: number\r\n): number | null => {\r\n  const { galaxySize, padding, cols, rows } = UNIVERSE_LAYOUT;\r\n  const layout = calculateGridLayout(canvasWidth, canvasHeight, galaxySize, padding, cols, rows);\r\n  const { totalWidth, totalHeight, startX, startY } = layout;\r\n\r\n  return getClickedIndex(\r\n    clickX,\r\n    clickY,\r\n    startX,\r\n    startY,\r\n    galaxySize,\r\n    padding,\r\n    cols,\r\n    rows,\r\n    totalWidth,\r\n    totalHeight\r\n  );\r\n};\r\n\r\nexport default UniverseOverview;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { CoordinateComponents, pickStarKindFromCoord } from '@game/shared';\r\nimport universeService from '../../../services/universeService';\r\nimport type { UniverseRegionSystemsData } from '../../../services/universeService';\r\nimport useUniverseMapStore from '../../../stores/universeMapStore';\r\nimport {\r\n  buildCachedLayer,\r\n  createOffscreenLayer,\r\n  drawToLayer,\r\n  composeLayers,\r\n  clearLayerCache,\r\n  type LayerCache\r\n} from './helpers/offscreenLayers';\r\n\r\ninterface RegionViewProps {\r\n  canvas: HTMLCanvasElement;\r\n  selectedCoordinate: CoordinateComponents | null;\r\n  showTerritories: boolean;\r\n}\r\n\r\nconst RegionView: React.FC<RegionViewProps> = ({\r\n  canvas,\r\n  selectedCoordinate,\r\n  showTerritories\r\n}) => {\r\n  const [regionSystems, setRegionSystems] = useState<UniverseRegionSystemsData['systems']>([]);\r\n  const { setRegionData } = useUniverseMapStore();\r\n  const layerCacheRef = useRef<LayerCache>(new Map());\r\n\r\n  // Fetch region systems for selected region\r\n  useEffect(() => {\r\n    if (!selectedCoordinate) return;\r\n    (async () => {\r\n      try {\r\n        const res = await universeService.getRegionSystems(\r\n          selectedCoordinate.server,\r\n          selectedCoordinate.galaxy,\r\n          selectedCoordinate.region\r\n        );\r\n        if ((res as any)?.success && (res as any)?.data) {\r\n          const systems = (res as any).data.systems || [];\r\n          setRegionSystems(systems);\r\n\r\n          // Cache summary for UniverseMap click gating (real stars only)\r\n          const key = `${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}`;\r\n          const systemsWithStars = systems\r\n            .filter((s: any) => !!s && s.star)\r\n            .map((s: any) => s.system);\r\n          setRegionData(key, { systemsWithStars });\r\n        } else {\r\n          setRegionSystems([]);\r\n        }\r\n      } catch {\r\n        setRegionSystems([]);\r\n      }\r\n    })();\r\n  }, [selectedCoordinate?.server, selectedCoordinate?.galaxy, selectedCoordinate?.region, setRegionData]);\r\n\r\n  // Render\r\n  useEffect(() => {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx || !selectedCoordinate) return;\r\n\r\n    // Clear canvas with space background\r\n    ctx.fillStyle = '#0a0a1a';\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // Animated starfield (kept separate from cached static layers)\r\n    drawStarField(ctx, canvas.width, canvas.height);\r\n\r\n    // Cached static grid/background layer\r\n    const gridDeps = { width: canvas.width, height: canvas.height };\r\n    const gridLayer = buildCachedLayer('region:grid', gridDeps, layerCacheRef.current, () => {\r\n      const off = createOffscreenLayer(canvas.width, canvas.height);\r\n      drawToLayer(off, (gctx) => {\r\n        drawRegionGridLayer(gctx, canvas.width, canvas.height);\r\n      });\r\n      return off;\r\n    });\r\n\r\n    // Dynamic systems + labels (depends on server/galaxy/region and data)\r\n    const systemsKeyDeps = {\r\n      server: selectedCoordinate.server,\r\n      galaxy: selectedCoordinate.galaxy,\r\n      region: selectedCoordinate.region,\r\n      systems: computeSystemsHash(regionSystems),\r\n      showTerritories\r\n    };\r\n\r\n    const systemsLayer = buildCachedLayer(\r\n      'region:systems',\r\n      systemsKeyDeps,\r\n      layerCacheRef.current,\r\n      () => {\r\n        const off = createOffscreenLayer(canvas.width, canvas.height);\r\n        drawToLayer(off, (rctx) => {\r\n          drawSystemsInRegion(\r\n            rctx,\r\n            canvas.width,\r\n            canvas.height,\r\n            selectedCoordinate,\r\n            regionSystems,\r\n            showTerritories\r\n          );\r\n        });\r\n        return off;\r\n      }\r\n    );\r\n\r\n    // Compose cached layers: grid/background first, then dynamic systems\r\n    composeLayers(ctx, [gridLayer, systemsLayer]);\r\n  }, [canvas, selectedCoordinate, showTerritories, regionSystems]);\r\n\r\n  // Cache hygiene on dimension changes\r\n  useEffect(() => {\r\n    clearLayerCache(layerCacheRef.current, (k) =>\r\n      k.startsWith('region:grid') || k.startsWith('region:systems')\r\n    );\r\n  }, [canvas.width, canvas.height]);\r\n\r\n  return null; // This component only renders to canvas\r\n};\r\n\r\n// ----------------- Rendering helpers -----------------\r\n\r\nconst drawStarField = (ctx: CanvasRenderingContext2D, width: number, height: number) => {\r\n  const time = Date.now() * 0.0001;\r\n\r\n  // Twinkling stars\r\n  for (let i = 0; i < 150; i++) {\r\n    const x = (i * 43) % width;\r\n    const y = (i * 71) % height;\r\n    const brightness = 0.4 + 0.6 * Math.sin(time + i * 0.2);\r\n    const size = 0.8 + 0.4 * Math.sin(time * 1.2 + i * 0.1);\r\n\r\n    ctx.fillStyle = `rgba(255, 255, 255, ${brightness * 0.8})`;\r\n    ctx.fillRect(x, y, size, size);\r\n  }\r\n\r\n  // Nebula clouds\r\n  for (let i = 0; i < 3; i++) {\r\n    const x = (i * 200) % width;\r\n    const y = (i * 150) % height;\r\n    const radius = 80 + 40 * Math.sin(time + i);\r\n\r\n    const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);\r\n    gradient.addColorStop(0, `rgba(200, 100, 255, ${0.08 * Math.sin(time + i)})`);\r\n    gradient.addColorStop(1, 'rgba(200, 100, 255, 0)');\r\n\r\n    ctx.fillStyle = gradient;\r\n    ctx.fillRect(x - radius, y - radius, radius * 2, radius * 2);\r\n  }\r\n};\r\n\r\n// Layout used by both draw and hit-tests\r\nconst calculateRegionGridLayout = (width: number, height: number) => {\r\n  const gridX = 50;\r\n  const gridY = 80;\r\n  const gridW = width - 100;\r\n  const gridH = height - 160;\r\n  const cols = 10;\r\n  const rows = 10;\r\n  const cellW = gridW / cols;\r\n  const cellH = gridH / rows;\r\n  return { gridX, gridY, gridW, gridH, cols, rows, cellW, cellH };\r\n};\r\n\r\n// Cached static background + grid\r\nconst drawRegionGridLayer = (ctx: CanvasRenderingContext2D, width: number, height: number) => {\r\n  // Background gradient (semi-transparent so starfield shows through)\r\n  const gradient = ctx.createRadialGradient(\r\n    width / 2,\r\n    height / 2,\r\n    0,\r\n    width / 2,\r\n    height / 2,\r\n    Math.max(width, height) / 2\r\n  );\r\n  gradient.addColorStop(0, 'rgba(20, 20, 40, 0.3)');\r\n  gradient.addColorStop(1, 'rgba(10, 10, 20, 0.1)');\r\n  ctx.fillStyle = gradient;\r\n  ctx.fillRect(0, 0, width, height);\r\n\r\n  // Grid lines\r\n  const { gridX, gridY, gridW, gridH, cols, rows, cellW, cellH } = calculateRegionGridLayout(width, height);\r\n  const gridStroke = 'rgba(100,150,255,0.25)';\r\n  ctx.strokeStyle = gridStroke;\r\n  ctx.lineWidth = 1;\r\n  for (let c = 0; c <= cols; c++) {\r\n    const x = gridX + c * cellW;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, gridY);\r\n    ctx.lineTo(x, gridY + gridH);\r\n    ctx.stroke();\r\n  }\r\n  for (let r = 0; r <= rows; r++) {\r\n    const y = gridY + r * cellH;\r\n    ctx.beginPath();\r\n    ctx.moveTo(gridX, y);\r\n    ctx.lineTo(gridX + gridW, y);\r\n    ctx.stroke();\r\n  }\r\n};\r\n\r\n// Dynamic systems/labels layer (composed above cached grid/background)\r\nconst drawSystemsInRegion = (\r\n  ctx: CanvasRenderingContext2D,\r\n  width: number,\r\n  height: number,\r\n  selectedCoordinate: CoordinateComponents,\r\n  systems: UniverseRegionSystemsData['systems'],\r\n  showTerritories: boolean\r\n) => {\r\n  const { gridX, gridY, gridH, cols, cellW, cellH } = calculateRegionGridLayout(width, height);\r\n\r\n  // Draw stars at fixed 10x10 grid cell centers based on real system id (0099)\r\n  systems.forEach((sys) => {\r\n    const col = sys.system % cols;\r\n    const row = Math.floor(sys.system / cols);\r\n\r\n    const systemX = gridX + col * cellW + cellW / 2;\r\n    const systemY = gridY + row * cellH + cellH / 2;\r\n\r\n    // Visual size consistent but slightly varied if desired (owned highlight could increase)\r\n    const systemSize = 10;\r\n\r\n    // Draw system with coordinate label using real system id\r\n    const star = (sys as any).star;\r\n    const spectralClass = (star?.spectralClass as any) || undefined;\r\n\r\n    const kindColorMap: Record<string, string> = {\r\n      YELLOW: '#FFF4EA',\r\n      ORANGE: '#FFD2A1',\r\n      WHITE: '#CAD7FF',\r\n      BLUE: '#9BB0FF',\r\n      RED_GIANT: '#FF9E7B',\r\n      SUPER_GIANT: '#FFE29A',\r\n      WHITE_DWARF: '#E6F1FF',\r\n      NEUTRON: '#AFBFFF'\r\n    };\r\n\r\n    const sysCoord = (sys as any).coord as string | undefined;\r\n    const coordForStar = sysCoord && sysCoord.split(':').length === 2 ? `${sysCoord}:00` : sysCoord;\r\n    const starKind = coordForStar ? pickStarKindFromCoord(coordForStar, 101) : undefined;\r\n    const baseHex = star?.color || (starKind ? kindColorMap[starKind] : undefined);\r\n\r\n    const displayHex = baseHex ? enhanceStarColor(baseHex, spectralClass) : undefined;\r\n\r\n    drawStarSystemAtPosition(\r\n      ctx,\r\n      systemX,\r\n      systemY,\r\n      systemSize,\r\n      0.75,\r\n      selectedCoordinate,\r\n      sys.system,\r\n      showTerritories,\r\n      displayHex\r\n    );\r\n  });\r\n\r\n  // Region title and coordinate\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.font = 'bold 20px monospace';\r\n  ctx.textAlign = 'center';\r\n  const coordString = `${selectedCoordinate.server}${selectedCoordinate.galaxy.toString().padStart(2, '0')}:${selectedCoordinate.region.toString().padStart(2, '0')}`;\r\n  ctx.fillText(`Galaxy ${selectedCoordinate.galaxy} > Region ${selectedCoordinate.region}`, width / 2, 35);\r\n\r\n  // Coordinate reference\r\n  ctx.fillStyle = 'rgba(255, 255, 150, 0.8)';\r\n  ctx.font = '14px monospace';\r\n  ctx.fillText(`(${coordString})`, width / 2, 55);\r\n\r\n  // Hint for empty regions\r\n  if (!systems || systems.length === 0) {\r\n    ctx.fillStyle = 'rgba(255,255,255,0.6)';\r\n    ctx.font = '14px monospace';\r\n    ctx.fillText('No star systems in this region (from DB).', width / 2, gridY + gridH / 2);\r\n  }\r\n};\r\n\r\nconst hexToRgba = (hex: string, alpha: number) => {\r\n  try {\r\n    const h = hex.replace('#', '');\r\n    const normalized = h.length === 3 ? h.split('').map(ch => ch + ch).join('') : h;\r\n    const bigint = parseInt(normalized, 16);\r\n    const r = (bigint >> 16) & 255;\r\n    const g = (bigint >> 8) & 255;\r\n    const b = bigint & 255;\r\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n  } catch {\r\n    return `rgba(255, 255, 255, ${alpha})`;\r\n  }\r\n};\r\n\r\nconst hexToRgb = (hex: string) => {\r\n  const h = hex.replace('#', '');\r\n  const normalized = h.length === 3 ? h.split('').map(ch => ch + ch).join('') : h;\r\n  const bigint = parseInt(normalized, 16);\r\n  return {\r\n    r: (bigint >> 16) & 255,\r\n    g: (bigint >> 8) & 255,\r\n    b: bigint & 255\r\n  };\r\n};\r\n\r\nconst rgbToHsl = (r: number, g: number, b: number) => {\r\n  r /= 255; g /= 255; b /= 255;\r\n  const max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n  let h = 0, s = 0;\r\n  const l = (max + min) / 2;\r\n\r\n  if (max !== min) {\r\n    const d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n    switch (max) {\r\n      case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n      case g: h = (b - r) / d + 2; break;\r\n      case b: h = (r - g) / d + 4; break;\r\n    }\r\n    h /= 6;\r\n  }\r\n  return { h, s, l };\r\n};\r\n\r\nconst hslToHex = (h: number, s: number, l: number) => {\r\n  const hue2rgb = (p: number, q: number, t: number) => {\r\n    if (t < 0) t += 1;\r\n    if (t > 1) t -= 1;\r\n    if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n    if (t < 1 / 2) return q;\r\n    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n    return p;\r\n  };\r\n  let r: number, g: number, b: number;\r\n\r\n  if (s === 0) {\r\n    r = g = b = l; // achromatic\r\n  } else {\r\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n    const p = 2 * l - q;\r\n    r = hue2rgb(p, q, h + 1 / 3);\r\n    g = hue2rgb(p, q, h);\r\n    b = hue2rgb(p, q, h - 1 / 3);\r\n  }\r\n\r\n  const toHex = (x: number) => {\r\n    const v = Math.round(x * 255).toString(16).padStart(2, '0');\r\n    return v;\r\n  };\r\n  return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\r\n};\r\n\r\n/**\r\n * Small, stable fingerprint for systems to use in cache keys\r\n */\r\nconst computeSystemsHash = (systems: UniverseRegionSystemsData['systems']): string => {\r\n  try {\r\n    let hash = systems.length;\r\n    for (let i = 0; i < systems.length; i++) {\r\n      const s = systems[i] as any;\r\n      const id = (s?.system ?? 0) as number;\r\n      const color = typeof s?.star?.color === 'string' ? s.star.color : '';\r\n      const colorNibble = color.length >= 7 ? parseInt(color.slice(1, 3), 16) : 0;\r\n      hash = ((hash << 5) - hash) + ((id & 0xffff) ^ (colorNibble & 0xff));\r\n      hash |= 0; // keep in 32-bit range\r\n    }\r\n    return `${systems.length}:${hash >>> 0}`;\r\n  } catch {\r\n    return `${systems?.length ?? 0}:0`;\r\n  }\r\n};\r\n\r\nconst enhanceStarColor = (\r\n  hex: string,\r\n  spectralClass?: 'O' | 'B' | 'A' | 'F' | 'G' | 'K' | 'M'\r\n) => {\r\n  try {\r\n    const { r, g, b } = hexToRgb(hex);\r\n    let { h, s, l } = rgbToHsl(r, g, b);\r\n\r\n    // Boost saturation and adjust lightness per class for contrast\r\n    switch (spectralClass) {\r\n      case 'O':\r\n      case 'B':\r\n        s = Math.min(1, s * 1.6 + 0.25);\r\n        l = Math.min(0.88, l * 0.95 + 0.1);\r\n        break;\r\n      case 'A':\r\n      case 'F':\r\n        s = Math.min(1, s * 1.35 + 0.15);\r\n        l = Math.min(0.86, l * 1.0 + 0.05);\r\n        break;\r\n      case 'G':\r\n        s = Math.min(1, s * 1.25 + 0.12);\r\n        l = Math.min(0.84, l * 1.0);\r\n        break;\r\n      case 'K':\r\n      case 'M':\r\n        s = Math.min(1, s * 1.45 + 0.2);\r\n        l = Math.min(0.8, l * 0.95 + 0.02);\r\n        break;\r\n      default:\r\n        s = Math.min(1, s * 1.3 + 0.15);\r\n        l = Math.min(0.85, l);\r\n    }\r\n\r\n    return hslToHex(h, s, l);\r\n  } catch {\r\n    return hex;\r\n  }\r\n};\r\n\r\nconst drawStarSystemAtPosition = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  size: number,\r\n  brightness: number,\r\n  selectedCoordinate: CoordinateComponents,\r\n  systemId: number,\r\n  showTerritories: boolean,\r\n  starColor?: string\r\n) => {\r\n  // Resolve star color from DB (or fallback to white)\r\n  const resolvedColor = starColor ?? '#FFFFFF';\r\n\r\n  // Color glow (use additive blend for intensity)\r\n  ctx.save();\r\n  const prevComposite = ctx.globalCompositeOperation;\r\n  ctx.globalCompositeOperation = 'lighter';\r\n  const glowGradient = ctx.createRadialGradient(x, y, 0, x, y, size * 2.4);\r\n  const innerAlpha = Math.min(1, 0.75 + 0.25 * brightness);\r\n  glowGradient.addColorStop(0, hexToRgba(resolvedColor, innerAlpha));\r\n  glowGradient.addColorStop(1, hexToRgba(resolvedColor, 0));\r\n  ctx.fillStyle = glowGradient;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size * 2.4, 0, Math.PI * 2);\r\n  ctx.fill();\r\n  ctx.globalCompositeOperation = prevComposite;\r\n  ctx.restore();\r\n\r\n  // Main star\r\n  ctx.fillStyle = resolvedColor;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  // Colored inner core to reinforce hue\r\n  ctx.fillStyle = hexToRgba(resolvedColor, Math.min(1, 0.85));\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size * 0.55, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  // Small white sparkle for brightness (reduced so hue dominates)\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.25)';\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size * 0.18, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  // Thin rim to accentuate color boundary\r\n  ctx.strokeStyle = hexToRgba(resolvedColor, 0.9);\r\n  ctx.lineWidth = 1;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size + 1.2, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n\r\n  // Draw coordinate label\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.font = '10px monospace';\r\n  ctx.textAlign = 'center';\r\n  const systemCoord = `${selectedCoordinate.server}${selectedCoordinate.galaxy.toString().padStart(2, '0')}:${selectedCoordinate.region.toString().padStart(2, '0')}:${systemId.toString().padStart(2, '0')}`;\r\n  ctx.fillText(systemCoord, x, y + size + 15);\r\n\r\n  // Show territory indicators if enabled (placeholder)\r\n  if (showTerritories) {\r\n    const hasTerritory = false;\r\n    if (hasTerritory) {\r\n      ctx.strokeStyle = '#00ff00';\r\n      ctx.lineWidth = 3;\r\n      ctx.beginPath();\r\n      ctx.arc(x, y, size + 5, 0, Math.PI * 2);\r\n      ctx.stroke();\r\n    }\r\n  }\r\n};\r\n  \r\nexport default RegionView;\r\n","/**\r\n * Deterministic system body generation + shared positioning for draw and hit-testing.\r\n * Mirrors the visual math used in SystemView to satisfy the canvas-debugging rule:\r\n * hit tests must use the exact same math as draw functions.\r\n */\r\n\r\nimport { STANDARD_ORBITS } from './mapConstants';\r\nimport { parseCoord } from '@game/shared';\r\n\r\nexport type BodyType = 'planet' | 'asteroid';\r\n\r\nexport interface SystemBody {\r\n  id: number;\r\n  type: BodyType;\r\n  name: string;\r\n  orbitRadius: number;\r\n  size: number; // radius in pixels for draw/hit-test\r\n  color: string;\r\n  fertility: number;\r\n  resources: {\r\n    metal: number;\r\n    energy: number;\r\n    research: number;\r\n  };\r\n  owner?: { id: string; username: string } | null;\r\n  hasColony: boolean;\r\n}\r\n\r\n/**\r\n * Mulberry32 PRNG - compact deterministic RNG from a numeric seed.\r\n * Returns a function that yields [0,1) floats.\r\n */\r\nfunction mulberry32(seed: number): () => number {\r\n  let a = seed >>> 0;\r\n  return function () {\r\n    a = (a + 0x6D2B79F5) >>> 0;\r\n    let t = Math.imul(a ^ (a >>> 15), (a | 1));\r\n    t ^= t + Math.imul(t ^ (t >>> 7), (t | 61));\r\n    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\r\n  };\r\n}\r\n\r\n/**\r\n * Deterministic color palette for planets (index chosen via RNG)\r\n */\r\nfunction getPlanetColorDeterministic(rand: () => number): string {\r\n  const colors = [\r\n    '#8B4513', // Brown (rocky)\r\n    '#4682B4', // Steel blue (water world)\r\n    '#228B22', // Forest green (garden world)\r\n    '#DC143C', // Crimson (volcanic)\r\n    '#FFD700', // Gold (desert)\r\n    '#9370DB', // Medium purple (gas giant)\r\n    '#F0E68C', // Khaki (arid)\r\n    '#20B2AA'  // Light sea green (ocean world)\r\n  ];\r\n  const idx = Math.floor(rand() * colors.length);\r\n  return colors[idx];\r\n}\r\n\r\n/**\r\n * Deterministically generate bodies for a system from a numeric seed.\r\n * Matches the shape used by SystemView's previous mock bodies.\r\n */\r\nexport function generateSystemBodies(seed: number): SystemBody[] {\r\n  const rand = mulberry32(seed);\r\n  const bodies: SystemBody[] = [];\r\n  // 5-19 bodies inclusive to keep coordinate.body in 0..19 (star=0, bodies=1..19)\r\n  const bodyCount = 5 + Math.floor(rand() * 15);\r\n\r\n  for (let i = 0; i < bodyCount; i++) {\r\n    const isPlanet = rand() > 0.3; // ~70% planets\r\n    // Snap orbit radius to standardized rings for consistent visuals across systems\r\n    const orbitRadius = STANDARD_ORBITS[i % STANDARD_ORBITS.length];\r\n\r\n    const size = isPlanet ? 3 + rand() * 4 : 1 + rand() * 2;\r\n    const color = isPlanet ? getPlanetColorDeterministic(rand) : '#8B7355';\r\n\r\n    const fertility = isPlanet ? (1 + Math.floor(rand() * 10)) : (1 + Math.floor(rand() * 3));\r\n    const resVal = () => 1 + Math.floor(rand() * 10);\r\n\r\n    bodies.push({\r\n      id: i,\r\n      type: isPlanet ? 'planet' : 'asteroid',\r\n      name: isPlanet ? `Planet ${i + 1}` : `Asteroid ${i + 1}`,\r\n      orbitRadius,\r\n      size,\r\n      color,\r\n      fertility,\r\n      resources: {\r\n        metal: resVal(),\r\n        energy: resVal(),\r\n        research: resVal()\r\n      },\r\n      hasColony: false\r\n    });\r\n  }\r\n\r\n  return bodies;\r\n}\r\n\r\n/**\r\n * Compute current position for a body at a given time.\r\n * Must mirror the math in drawCelestialBody:\r\n *   const angle = (time + body.id * 30) % (Math.PI * 2);\r\n *   x = centerX + cos(angle) * orbitRadius\r\n *   y = centerY + sin(angle) * orbitRadius\r\n *\r\n * Where \"time\" is expected to be Date.now() * 0.0005 same as draw.\r\n */\r\nexport function getBodyPositionAtTime(\r\n  body: SystemBody,\r\n  timeScalar: number,\r\n  centerX: number,\r\n  centerY: number\r\n): { x: number; y: number } {\r\n  const angle = (timeScalar + body.id * 30) % (Math.PI * 2);\r\n  const x = centerX + Math.cos(angle) * body.orbitRadius;\r\n  const y = centerY + Math.sin(angle) * body.orbitRadius;\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * Minimal shape of a server-returned body for mapping to SystemBody.\r\n */\r\nexport interface ServerBody {\r\n  coord: string;\r\n  type: BodyType | 'star';\r\n  result?: {\r\n    fertility: number;\r\n    yields: {\r\n      metal: number;\r\n      gas: number;\r\n      crystals: number;\r\n    };\r\n  };\r\n  owner?: { id: string; username: string } | null;\r\n}\r\n\r\n/**\r\n * Map server bodies (DB truth) into draw/hit-test SystemBody list.\r\n * - Skips the star (body 00)\r\n * - Uses STANDARD_ORBITS for visual parity\r\n * - Labels based on server type (authoritative)\r\n */\r\nexport function mapServerBodiesToSystemBodies(serverBodies: ServerBody[] | undefined | null): SystemBody[] {\r\n  if (!serverBodies || serverBodies.length === 0) return [];\r\n\r\n  const result: SystemBody[] = [];\r\n  for (const b of serverBodies) {\r\n    const c = parseCoord(b.coord);\r\n    // Skip star (body 0)\r\n    if (c.body === 0) continue;\r\n\r\n    const id = c.body - 1; // 0..18\r\n    const labelNum = c.body.toString().padStart(2, '0');\r\n    const isPlanet = b.type === 'planet';\r\n    const isAsteroid = b.type === 'asteroid';\r\n\r\n    // Size/color by type (stable, no RNG)\r\n    const size = isPlanet ? 5 : 2.5;\r\n    const color = isPlanet ? '#2b4f28' : '#8B7355';\r\n\r\n    result.push({\r\n      id,\r\n      type: isPlanet ? 'planet' : 'asteroid',\r\n      name: isAsteroid ? `Asteroid ${labelNum}` : `Planet ${labelNum}`,\r\n      orbitRadius: STANDARD_ORBITS[id % STANDARD_ORBITS.length],\r\n      size,\r\n      color,\r\n      fertility: (typeof b.result?.fertility === 'number')\r\n        ? Math.max(0, Math.min(10, Math.round(b.result!.fertility)))\r\n        : (isPlanet ? 5 : 1),\r\n      resources: {\r\n        metal: (typeof b.result?.yields?.metal === 'number')\r\n          ? Math.max(0, Math.min(10, Math.round(b.result!.yields.metal)))\r\n          : 5,\r\n        // Map new taxonomy gas->energy, crystals->research for UI indicators\r\n        energy: (typeof b.result?.yields?.gas === 'number')\r\n          ? Math.max(0, Math.min(10, Math.round(b.result!.yields.gas)))\r\n          : 5,\r\n        research: (typeof b.result?.yields?.crystals === 'number')\r\n          ? Math.max(0, Math.min(10, Math.round(b.result!.yields.crystals)))\r\n          : 5,\r\n      },\r\n      owner: b.owner ?? null,\r\n      hasColony: !!b.owner,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n","import * as React from 'react';\r\nimport { Empire, CoordinateComponents, formatCoord, pickStarKindFromCoord } from '@game/shared';\r\nimport { SystemBody, getBodyPositionAtTime, mapServerBodiesToSystemBodies, ServerBody } from './systemBodies';\r\nimport useUniverseMapStore from '../../../stores/universeMapStore';\r\nimport { STANDARD_ORBITS } from './mapConstants';\r\nimport { buildCachedLayer, createOffscreenLayer, drawToLayer, composeLayers, clearLayerCache, LayerCache } from './helpers/offscreenLayers';\r\n\r\ninterface SystemViewProps {\r\n  canvas: HTMLCanvasElement;\r\n  selectedCoordinate: CoordinateComponents | null;\r\n  empire: Empire;\r\n  showResources: boolean;\r\n  serverBodies?: ServerBody[];\r\n}\r\n\r\n// Dev-only performance monitor (logs FPS and warns on sustained low FPS)\r\n// Enabled when localStorage.getItem('enableFpsMonitor') === '1'\r\nclass PerformanceMonitor {\r\n  private frames = 0;\r\n  private last = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n  private fps = 0;\r\n  private belowThresholdCount = 0;\r\n\r\n  constructor(\r\n    private enabled: boolean,\r\n    private threshold = 30,\r\n    private warnStreakSeconds = 3\r\n  ) {}\r\n\r\n  update(now: number): number {\r\n    this.frames++;\r\n    if (now - this.last >= 1000) {\r\n      this.fps = this.frames;\r\n      this.frames = 0;\r\n      this.last = now;\r\n\r\n      if (this.enabled) {\r\n        if (typeof console !== 'undefined' && typeof console.debug === 'function') {\r\n          console.debug(`[SystemView] ${this.fps} fps`);\r\n        }\r\n        if (this.fps < this.threshold) {\r\n          this.belowThresholdCount++;\r\n          if (this.belowThresholdCount >= this.warnStreakSeconds) {\r\n            if (typeof console !== 'undefined' && typeof console.warn === 'function') {\r\n              console.warn(\r\n                `[SystemView] Sustained low FPS (${this.fps} < ${this.threshold}) for ${this.warnStreakSeconds}s`\r\n              );\r\n            }\r\n            this.belowThresholdCount = 0;\r\n          }\r\n        } else {\r\n          this.belowThresholdCount = 0;\r\n        }\r\n      }\r\n    }\r\n    return this.fps;\r\n  }\r\n}\r\n\r\nconst SystemView: React.FC<SystemViewProps> = ({\r\n  canvas,\r\n  selectedCoordinate,\r\n  empire,\r\n  showResources,\r\n  serverBodies\r\n}) => {\r\n  const { setSystemTimeScalar } = useUniverseMapStore();\r\n\r\n  // Offscreen cache for static-most background (orbit rings)\r\n  const layerCacheRef = React.useRef<LayerCache>(new Map());\r\n  const animationRef = React.useRef<number | null>(null);\r\n  const enableFpsMonitor =\r\n    (typeof window !== 'undefined') &&\r\n    !!window.localStorage &&\r\n    window.localStorage.getItem('enableFpsMonitor') === '1';\r\n  const perfMonitorRef = React.useRef<PerformanceMonitor | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx || !selectedCoordinate) return;\r\n\r\n    let running = true;\r\n\r\n    // Init performance monitor (dev-guarded via localStorage flag)\r\n    perfMonitorRef.current = new PerformanceMonitor(enableFpsMonitor);\r\n\r\n    const draw = () => {\r\n      if (!running) return;\r\n\r\n      // Clear canvas with space background\r\n      ctx.fillStyle = '#0a0a1a';\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n      // Animated star field (dynamic, not cached)\r\n      drawStarField(ctx, canvas.width, canvas.height);\r\n\r\n      // Establish shared timebase for draw and click hit-testing\r\n      const timeScalar = Date.now() * 0.0005;\r\n      setSystemTimeScalar(timeScalar);\r\n\r\n      // Cached background layer: standardized orbit rings only\r\n      const bgDeps = {\r\n        width: canvas.width,\r\n        height: canvas.height\r\n      };\r\n      const bgLayer = buildCachedLayer('system:background', bgDeps, layerCacheRef.current, () => {\r\n        const off = createOffscreenLayer(canvas.width, canvas.height);\r\n        drawToLayer(off, (gctx) => {\r\n          const centerX = off.width / 2;\r\n          const centerY = off.height / 2;\r\n          STANDARD_ORBITS.forEach((r) => drawOrbit(gctx, centerX, centerY, r));\r\n        });\r\n        return off;\r\n      });\r\n\r\n      // Compose cached background on top of starfield\r\n      composeLayers(ctx, [bgLayer]);\r\n\r\n      // Draw the star system bodies with discovery states (DB-backed)\r\n      drawStarSystemDetail(ctx, canvas.width, canvas.height, selectedCoordinate, showResources, timeScalar, serverBodies);\r\n\r\n      // FPS tracking (dev-guarded logging/overlay)\r\n      {\r\n        const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n        const fps = perfMonitorRef.current ? perfMonitorRef.current.update(now) : 0;\r\n\r\n        if (enableFpsMonitor) {\r\n          ctx.fillStyle = 'rgba(0,255,0,0.85)';\r\n          ctx.font = '10px monospace';\r\n          ctx.textAlign = 'left';\r\n          ctx.fillText(`${fps} fps`, 8, 16);\r\n        }\r\n      }\r\n\r\n      animationRef.current = requestAnimationFrame(draw);\r\n    };\r\n\r\n    draw();\r\n\r\n    return () => {\r\n      running = false;\r\n      if (animationRef.current) {\r\n        cancelAnimationFrame(animationRef.current);\r\n        animationRef.current = null;\r\n      }\r\n    };\r\n  }, [canvas, selectedCoordinate, showResources, empire, serverBodies, setSystemTimeScalar, enableFpsMonitor]);\r\n\r\n  // Cache hygiene: clear cached system background on dimension changes\r\n  React.useEffect(() => {\r\n    clearLayerCache(layerCacheRef.current, (k) => k.startsWith('system:background'));\r\n  }, [canvas.width, canvas.height]);\r\n\r\n  return null; // This component only renders to canvas\r\n};\r\n\r\nconst drawStarField = (ctx: CanvasRenderingContext2D, width: number, height: number) => {\r\n  const time = Date.now() * 0.0001;\r\n\r\n  // Draw distant stars\r\n  for (let i = 0; i < 100; i++) {\r\n    const x = (i * 47) % width;\r\n    const y = (i * 83) % height;\r\n    const brightness = 0.5 + 0.5 * Math.sin(time + i * 0.3);\r\n    const size = 1 + 0.5 * Math.sin(time * 0.8 + i * 0.15);\r\n\r\n    ctx.fillStyle = `rgba(255, 255, 255, ${brightness * 0.9})`;\r\n    ctx.fillRect(x, y, size, size);\r\n  }\r\n\r\n  // Draw cosmic dust\r\n  for (let i = 0; i < 2; i++) {\r\n    const x = (i * 300) % width;\r\n    const y = (i * 200) % height;\r\n    const radius = 120 + 60 * Math.sin(time + i);\r\n\r\n    const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);\r\n    gradient.addColorStop(0, `rgba(255, 200, 100, ${0.05 * Math.sin(time + i)})`);\r\n    gradient.addColorStop(1, 'rgba(255, 200, 100, 0)');\r\n\r\n    ctx.fillStyle = gradient;\r\n    ctx.fillRect(x - radius, y - radius, radius * 2, radius * 2);\r\n  }\r\n};\r\n\r\nconst drawStarSystemDetail = (\r\n  ctx: CanvasRenderingContext2D,\r\n  width: number,\r\n  height: number,\r\n  selectedCoordinate: CoordinateComponents,\r\n  showResources: boolean,\r\n  timeScalar: number,\r\n  serverBodies?: ServerBody[]\r\n) => {\r\n  const centerX = width / 2;\r\n  const centerY = height / 2;\r\n\r\n  // Determine deterministic star kind/color for this system's central star (body 0)\r\n  const starCoordStr = formatCoord({ ...selectedCoordinate, body: 0 });\r\n  const starKind = pickStarKindFromCoord(starCoordStr, 101);\r\n  const starColorMap: Record<string, string> = {\r\n    YELLOW: '#FFF4EA',\r\n    ORANGE: '#FFD2A1',\r\n    WHITE: '#CAD7FF',\r\n    BLUE: '#9BB0FF',\r\n    RED_GIANT: '#FF9E7B',\r\n    SUPER_GIANT: '#FFE29A',\r\n    WHITE_DWARF: '#E6F1FF',\r\n    NEUTRON: '#AFBFFF'\r\n  };\r\n  const starType = { color: starColorMap[starKind] || '#FFF4EA' };\r\n\r\n  // Prefer server bodies (DB truth) with deterministic fallback\r\n  const bodies: SystemBody[] = (serverBodies && serverBodies.length)\r\n    ? mapServerBodiesToSystemBodies(serverBodies)\r\n    : [];\r\n\r\n  // Draw central star (colored glow)\r\n  drawCentralStar(ctx, centerX, centerY, starType);\r\n\r\n  // Bodies at positions computed from shared timebase\r\n  bodies.forEach((body) => {\r\n    drawCelestialBody(ctx, centerX, centerY, body, showResources, timeScalar);\r\n  });\r\n\r\n  // Title and coordinate\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.font = 'bold 16px monospace';\r\n  ctx.textAlign = 'center';\r\n  const coordString = `${selectedCoordinate.server}${selectedCoordinate.galaxy\r\n    .toString()\r\n    .padStart(2, '0')}:${selectedCoordinate.region\r\n    .toString()\r\n    .padStart(2, '0')}:${selectedCoordinate.system.toString().padStart(2, '0')}`;\r\n  ctx.fillText(`System ${selectedCoordinate.system}`, width / 2, 30);\r\n\r\n  ctx.fillStyle = 'rgba(255, 255, 150, 0.8)';\r\n  ctx.font = '12px monospace';\r\n  ctx.fillText(`(${coordString})`, width / 2, 50);\r\n\r\n  if (showResources) {\r\n    drawResourceLegend(ctx, width, height);\r\n  }\r\n};\r\n\r\nconst drawCentralStar = (\r\n  ctx: CanvasRenderingContext2D,\r\n  centerX: number,\r\n  centerY: number,\r\n  starType: { color: string }\r\n) => {\r\n  // Helpers localized to this draw to avoid file-wide edits\r\n  const hexToRgba = (hex: string, alpha: number) => {\r\n    try {\r\n      const h = hex.replace('#', '');\r\n      const normalized = h.length === 3 ? h.split('').map(ch => ch + ch).join('') : h;\r\n      const bigint = parseInt(normalized, 16);\r\n      const r = (bigint >> 16) & 255;\r\n      const g = (bigint >> 8) & 255;\r\n      const b = bigint & 255;\r\n      return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    } catch {\r\n      return `rgba(255, 255, 255, ${alpha})`;\r\n    }\r\n  };\r\n  const hexToRgb = (hex: string) => {\r\n    const h = hex.replace('#', '');\r\n    const normalized = h.length === 3 ? h.split('').map(ch => ch + ch).join('') : h;\r\n    const bigint = parseInt(normalized, 16);\r\n    return {\r\n      r: (bigint >> 16) & 255,\r\n      g: (bigint >> 8) & 255,\r\n      b: bigint & 255\r\n    };\r\n  };\r\n  const rgbToHsl = (r: number, g: number, b: number) => {\r\n    r /= 255; g /= 255; b /= 255;\r\n    const max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n    let h = 0, s = 0;\r\n    const l = (max + min) / 2;\r\n    if (max !== min) {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n        case g: h = (b - r) / d + 2; break;\r\n        case b: h = (r - g) / d + 4; break;\r\n      }\r\n      h /= 6;\r\n    }\r\n    return { h, s, l };\r\n  };\r\n  const hslToHex = (h: number, s: number, l: number) => {\r\n    const hue2rgb = (p: number, q: number, t: number) => {\r\n      if (t < 0) t += 1;\r\n      if (t > 1) t -= 1;\r\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n      if (t < 1 / 2) return q;\r\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n      return p;\r\n    };\r\n    let r: number, g: number, b: number;\r\n    if (s === 0) {\r\n      r = g = b = l;\r\n    } else {\r\n      const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n      const p = 2 * l - q;\r\n      r = hue2rgb(p, q, h + 1 / 3);\r\n      g = hue2rgb(p, q, h);\r\n      b = hue2rgb(p, q, h - 1 / 3);\r\n    }\r\n    const toHex = (x: number) => Math.round(x * 255).toString(16).padStart(2, '0');\r\n    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\r\n  };\r\n  const enhanceStarColor = (hex: string) => {\r\n    try {\r\n      const { r, g, b } = hexToRgb(hex);\r\n      let { h, s, l } = rgbToHsl(r, g, b);\r\n      s = Math.min(1, s * 1.5 + 0.2);\r\n      l = Math.min(0.86, l * 1.0 + 0.05);\r\n      return hslToHex(h, s, l);\r\n    } catch {\r\n      return hex;\r\n    }\r\n  };\r\n\r\n  const time = Date.now() * 0.001;\r\n  const starRadius = 15 + 3 * Math.sin(time);\r\n  const baseHex = starType.color;\r\n  const displayHex = enhanceStarColor(baseHex);\r\n\r\n  // Additive colored corona for dramatic hue\r\n  ctx.save();\r\n  const prevComposite = ctx.globalCompositeOperation;\r\n  ctx.globalCompositeOperation = 'lighter';\r\n  const coronaGrad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, starRadius * 2.8);\r\n  coronaGrad.addColorStop(0, hexToRgba(displayHex, 0.75));\r\n  coronaGrad.addColorStop(1, hexToRgba(displayHex, 0));\r\n  ctx.fillStyle = coronaGrad;\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, starRadius * 2.8, 0, Math.PI * 2);\r\n  ctx.fill();\r\n  ctx.globalCompositeOperation = prevComposite;\r\n  ctx.restore();\r\n\r\n  // Main star body (colored)\r\n  ctx.fillStyle = displayHex;\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, starRadius, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  // Colored inner core to emphasize hue\r\n  ctx.fillStyle = hexToRgba(displayHex, 0.9);\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, starRadius * 0.6, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  // Small white sparkle for brightness\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.25)';\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, starRadius * 0.22, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  // Subtle colored rim\r\n  ctx.strokeStyle = hexToRgba(displayHex, 0.95);\r\n  ctx.lineWidth = 1;\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, starRadius + 1.5, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n};\r\n\r\nconst drawOrbit = (ctx: CanvasRenderingContext2D, centerX: number, centerY: number, radius: number) => {\r\n  ctx.strokeStyle = 'rgba(100, 100, 100, 0.2)';\r\n  ctx.lineWidth = 1;\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n};\r\n\r\nconst drawCelestialBody = (\r\n  ctx: CanvasRenderingContext2D,\r\n  centerX: number,\r\n  centerY: number,\r\n  body: SystemBody,\r\n  showResources: boolean,\r\n  timeScalar: number\r\n) => {\r\n  const { x, y } = getBodyPositionAtTime(body, timeScalar, centerX, centerY);\r\n\r\n  // Always draw DB-backed body (no placeholders)\r\n  ctx.fillStyle = body.color;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, body.size, 0, Math.PI * 2);\r\n  ctx.fill();\r\n\r\n  // Draw body outline\r\n  ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\r\n  ctx.lineWidth = 1;\r\n  ctx.stroke();\r\n\r\n  // Draw colony indicator (if any)\r\n  if (body.hasColony) {\r\n    ctx.strokeStyle = '#00ff00';\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, body.size + 2, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n\r\n    // Add empire name for colonized planets (from server)\r\n    const ownerName = body.owner?.username ?? 'Unknown';\r\n    ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';\r\n    ctx.font = '8px monospace';\r\n    ctx.textAlign = 'center';\r\n    ctx.fillText(ownerName, x, y - body.size - 8);\r\n  }\r\n\r\n  // Draw resource indicators if enabled\r\n  if (showResources) {\r\n    drawResourceIndicators(ctx, x, y, body);\r\n  }\r\n\r\n  // Draw body label\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';\r\n  ctx.font = '10px monospace';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText(body.name, x, y + body.size + 12);\r\n\r\n  // (Optional) body tooltip on hover (hover detection not implemented yet)\r\n  const isHovered = false; // TODO: Implement hover detection\r\n  if (isHovered) {\r\n    drawBodyTooltip(ctx, x, y, body);\r\n  }\r\n};\r\n\r\nconst drawResourceIndicators = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  body: SystemBody\r\n) => {\r\n  const resources = [\r\n    { value: body.resources.metal, color: '#C0C0C0', symbol: 'M' },\r\n    { value: body.resources.energy, color: '#4169E1', symbol: 'E' }\r\n  ];\r\n\r\n  resources.forEach((resource, index) => {\r\n    const intensity = resource.value / 10;\r\n    const indicatorX = x - 10 + index * 10;\r\n    const indicatorY = y - body.size - 8;\r\n\r\n    ctx.fillStyle = `rgba(${hexToRgb(resource.color)}, ${intensity})`;\r\n    ctx.fillRect(indicatorX, indicatorY, 8, 4);\r\n\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';\r\n    ctx.font = '8px monospace';\r\n    ctx.textAlign = 'center';\r\n    ctx.fillText(resource.symbol, indicatorX + 4, indicatorY + 3);\r\n  });\r\n};\r\n\r\nconst drawBodyTooltip = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  body: SystemBody\r\n) => {\r\n  const tooltipWidth = 120;\r\n  const tooltipHeight = 60;\r\n  const tooltipX = x + 20;\r\n  const tooltipY = y - tooltipHeight / 2;\r\n\r\n  // Tooltip background\r\n  ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';\r\n  ctx.fillRect(tooltipX, tooltipY, tooltipWidth, tooltipHeight);\r\n\r\n  ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\r\n  ctx.lineWidth = 1;\r\n  ctx.strokeRect(tooltipX, tooltipY, tooltipWidth, tooltipHeight);\r\n\r\n  // Tooltip content\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.font = '10px monospace';\r\n  ctx.textAlign = 'left';\r\n\r\n  ctx.fillText(body.name, tooltipX + 5, tooltipY + 15);\r\n  ctx.fillText(`Type: ${body.type}`, tooltipX + 5, tooltipY + 25);\r\n  ctx.fillText(`Fertility: ${body.fertility}`, tooltipX + 5, tooltipY + 35);\r\n  ctx.fillText(`M:${body.resources.metal} E:${body.resources.energy}`, tooltipX + 5, tooltipY + 45);\r\n};\r\n\r\nconst drawResourceLegend = (ctx: CanvasRenderingContext2D, width: number, height: number) => {\r\n  const legendX = width - 150;\r\n  const legendY = height - 80;\r\n  const legendWidth = 140;\r\n  const legendHeight = 70;\r\n\r\n  // Legend background\r\n  ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n  ctx.fillRect(legendX, legendY, legendWidth, legendHeight);\r\n\r\n  ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\r\n  ctx.lineWidth = 1;\r\n  ctx.strokeRect(legendX, legendY, legendWidth, legendHeight);\r\n\r\n  // Legend title\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.font = 'bold 12px monospace';\r\n  ctx.textAlign = 'left';\r\n  ctx.fillText('Resources', legendX + 5, legendY + 15);\r\n\r\n  // Legend items\r\n  const resources = [\r\n    { color: '#C0C0C0', label: 'Metal (M)' },\r\n    { color: '#4169E1', label: 'Energy (E)' }\r\n  ];\r\n\r\n  ctx.font = '10px monospace';\r\n  resources.forEach((resource, index) => {\r\n    const itemY = legendY + 25 + index * 12;\r\n\r\n    ctx.fillStyle = resource.color;\r\n    ctx.fillRect(legendX + 5, itemY, 8, 8);\r\n\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';\r\n    ctx.fillText(resource.label, legendX + 18, itemY + 7);\r\n  });\r\n};\r\n\r\nconst hexToRgb = (hex: string): string => {\r\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  if (result) {\r\n    const r = parseInt(result[1], 16);\r\n    const g = parseInt(result[2], 16);\r\n    const b = parseInt(result[3], 16);\r\n    return `${r}, ${g}, ${b}`;\r\n  }\r\n  return '255, 255, 255';\r\n};\r\n\r\n/**\r\n * Handle clicks in SystemView using the SAME timeScalar and body positions as draw (click-parity).\r\n * Returns the index of the clicked body in the mapped SystemBody array, or null if none hit.\r\n */\r\nexport const handleSystemViewClick = (\r\n  clickX: number,\r\n  clickY: number,\r\n  canvasWidth: number,\r\n  canvasHeight: number,\r\n  timeScalar: number,\r\n  serverBodies?: ServerBody[]\r\n): number | null => {\r\n  const centerX = canvasWidth / 2;\r\n  const centerY = canvasHeight / 2;\r\n  const bodies: SystemBody[] = (serverBodies && serverBodies.length)\r\n    ? mapServerBodiesToSystemBodies(serverBodies)\r\n    : [];\r\n\r\n  for (let i = 0; i < bodies.length; i++) {\r\n    const body = bodies[i];\r\n    const { x, y } = getBodyPositionAtTime(body, timeScalar, centerX, centerY);\r\n    const dx = clickX - x;\r\n    const dy = clickY - y;\r\n    const dist2 = dx * dx + dy * dy;\r\n    if (dist2 <= body.size * body.size) {\r\n      return i;\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\nexport default SystemView;\r\n","import React from 'react';\r\n\r\ntype StarOverhaulEffects = {\r\n  kind: 'RED_GIANT' | 'SUPER_GIANT' | 'BLUE' | 'NEUTRON' | 'WHITE' | 'WHITE_DWARF' | 'ORANGE' | 'YELLOW';\r\n  orbitModifiers?: Array<{\r\n    position: number;\r\n    solarEnergyDelta: number;\r\n    fertilityDelta: number;\r\n    resourceDelta: { metal: number; gas: number; crystals: number };\r\n  }>;\r\n  notes?: string;\r\n};\r\n\r\ninterface StarInfoPanelProps {\r\n  starType?: { color?: string; name?: string; class?: string };\r\n  coord?: string;\r\n  hasStar?: boolean; // false => explicitly no star (server confirmed)\r\n  starOverhaul?: StarOverhaulEffects;\r\n}\r\n\r\nconst fmtSigned = (n: number) => (n >= 0 ? `+${n}` : `${n}`);\r\nconst formatKind = (k: string) => k.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, (c) => c.toUpperCase());\r\n\r\nconst StarInfoPanel: React.FC<StarInfoPanelProps> = ({ starType, coord, hasStar, starOverhaul }) => {\r\n  return (\r\n    <div className=\"absolute top-4 left-4 z-20\">\r\n      <div className=\"min-w-[240px] bg-gray-900/80 border border-gray-700 rounded-lg p-3 shadow-lg backdrop-blur-sm\">\r\n        {!hasStar && hasStar !== undefined ? (\r\n          <div className=\"text-gray-300\">\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <span className=\"text-sm font-semibold text-white\">System Star</span>\r\n            </div>\r\n            <div className=\"text-red-300 text-sm\">No star in this system</div>\r\n            {coord && (\r\n              <div className=\"text-xs text-gray-400 mt-1\">({coord})</div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-gray-300\">\r\n            <div className=\"flex items-center gap-3 mb-2\">\r\n              <div\r\n                className=\"w-5 h-5 rounded-full border border-gray-600 shadow-inner\"\r\n                style={{ backgroundColor: starType?.color || '#ffffff' }}\r\n                title=\"Star color\"\r\n              />\r\n              <div className=\"leading-tight\">\r\n                <div className=\"text-sm font-semibold text-white\">\r\n                  {starType ? `${starType.name} (${starType.class})` : 'Star'}\r\n                </div>\r\n                {coord && (\r\n                  <div className=\"text-xs text-gray-400\">({coord})</div>\r\n                )}\r\n              </div>\r\n              {starOverhaul?.kind && (\r\n                <span className=\"ml-1 px-2 py-0.5 rounded-full bg-blue-600/30 text-blue-200 text-[11px] border border-blue-500/40 whitespace-nowrap\">\r\n                  {formatKind(starOverhaul.kind)}\r\n                </span>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"mt-2 text-sm\">\r\n              <div className=\"text-gray-400 mb-1\">Orbit Modifiers</div>\r\n              {starOverhaul?.orbitModifiers && starOverhaul.orbitModifiers.length > 0 ? (\r\n                <div className=\"space-y-1 max-h-52 overflow-y-auto pr-1\">\r\n                  {starOverhaul.orbitModifiers\r\n                    .slice()\r\n                    .sort((a, b) => a.position - b.position)\r\n                    .map((m) => {\r\n                      const parts: string[] = [];\r\n                      if (m.solarEnergyDelta) parts.push(`Solar Energy ${fmtSigned(m.solarEnergyDelta)}`);\r\n                      if (m.fertilityDelta) parts.push(`Fertility ${fmtSigned(m.fertilityDelta)}`);\r\n                      if (m.resourceDelta) {\r\n                        const metal = m.resourceDelta.metal ?? 0;\r\n                        const gas = m.resourceDelta.gas ?? 0;\r\n                        const crystals = m.resourceDelta.crystals ?? 0;\r\n                        if (metal) parts.push(`Metal ${fmtSigned(metal)}`);\r\n                        if (gas) parts.push(`Gas ${fmtSigned(gas)}`);\r\n                        if (crystals) parts.push(`Crystals ${fmtSigned(crystals)}`);\r\n                      }\r\n                      const text = parts.length ? parts.join('  ') : 'No changes';\r\n                      return (\r\n                        <div key={m.position} className=\"flex items-start gap-2\">\r\n                          <div className=\"text-gray-400 w-8\">P{m.position}</div>\r\n                          <div className=\"text-gray-200\">{text}</div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-gray-400\">No orbit modifiers available</div>\r\n              )}\r\n            </div>\r\n\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StarInfoPanel;\r\n","/**\r\n * Coordinate Mapping System for Universe Map\r\n * \r\n * This system ensures that objects maintain consistent spatial relationships\r\n * across different zoom levels. For example, a star that appears in the top-right\r\n * of a region should appear in the same relative position when viewing that\r\n * region from the galaxy level.\r\n */\r\n\r\nimport { generateSeedFromCoordinate } from '@game/shared';\r\n\r\nexport interface SpatialPosition {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport interface GridLayout {\r\n  itemSize: number;\r\n  padding: number;\r\n  cols: number;\r\n  rows: number;\r\n  totalWidth: number;\r\n  totalHeight: number;\r\n  startX: number;\r\n  startY: number;\r\n}\r\n\r\n/**\r\n * Calculate grid layout for any zoom level\r\n */\r\nexport const calculateGridLayout = (\r\n  canvasWidth: number,\r\n  canvasHeight: number,\r\n  itemSize: number,\r\n  padding: number,\r\n  cols: number,\r\n  rows: number\r\n): GridLayout => {\r\n  const totalWidth = cols * itemSize + (cols - 1) * padding;\r\n  const totalHeight = rows * itemSize + (rows - 1) * padding;\r\n  \r\n  const startX = (canvasWidth - totalWidth) / 2;\r\n  const startY = (canvasHeight - totalHeight) / 2;\r\n\r\n  return {\r\n    itemSize,\r\n    padding,\r\n    cols,\r\n    rows,\r\n    totalWidth,\r\n    totalHeight,\r\n    startX,\r\n    startY\r\n  };\r\n};\r\n\r\n/**\r\n * Get the pixel position of a grid item\r\n */\r\nexport const getGridItemPosition = (\r\n  layout: GridLayout,\r\n  index: number\r\n): SpatialPosition => {\r\n  const row = Math.floor(index / layout.cols);\r\n  const col = index % layout.cols;\r\n  \r\n  return {\r\n    x: layout.startX + col * (layout.itemSize + layout.padding),\r\n    y: layout.startY + row * (layout.itemSize + layout.padding)\r\n  };\r\n};\r\n\r\n/**\r\n * Get the center position of a grid item\r\n */\r\nexport const getGridItemCenter = (\r\n  layout: GridLayout,\r\n  index: number\r\n): SpatialPosition => {\r\n  const position = getGridItemPosition(layout, index);\r\n  return {\r\n    x: position.x + layout.itemSize / 2,\r\n    y: position.y + layout.itemSize / 2\r\n  };\r\n};\r\n\r\n/**\r\n * Seed-based random number generator for consistent positioning\r\n * This ensures that \"random\" star positions are the same every time\r\n */\r\nexport class SeededRandom {\r\n  private seed: number;\r\n\r\n  constructor(seed: number) {\r\n    this.seed = seed;\r\n  }\r\n\r\n  next(): number {\r\n    this.seed = (this.seed * 9301 + 49297) % 233280;\r\n    return this.seed / 233280;\r\n  }\r\n\r\n  nextInRange(min: number, max: number): number {\r\n    return min + this.next() * (max - min);\r\n  }\r\n\r\n  nextInt(max: number): number {\r\n    return Math.floor(this.next() * max);\r\n  }\r\n}\r\n\r\n/**\r\n * Generate consistent star positions within a region/system\r\n */\r\nexport const generateStarPositions = (\r\n  regionId: number,\r\n  galaxyId: number,\r\n  bounds: { width: number; height: number; padding: number },\r\n  starCount: number\r\n): SpatialPosition[] => {\r\n  // Create a unique seed based on galaxy and region\r\n  const seed = galaxyId * 1000 + regionId;\r\n  const rng = new SeededRandom(seed);\r\n  \r\n  const positions: SpatialPosition[] = [];\r\n  const { width, height, padding } = bounds;\r\n  \r\n  for (let i = 0; i < starCount; i++) {\r\n    positions.push({\r\n      x: padding + rng.nextInRange(0, width - 2 * padding),\r\n      y: padding + rng.nextInRange(0, height - 2 * padding)\r\n    });\r\n  }\r\n  \r\n  return positions;\r\n};\r\n\r\n/**\r\n * Generate consistent system positions within a region\r\n * These positions will be used both in region view and when zooming into systems\r\n */\r\nexport const generateSystemPositions = (\r\n  coordinate: string\r\n): Array<SpatialPosition & { brightness: number }> => {\r\n  // Parse coordinate to get galaxy and region IDs\r\n  const parts = coordinate.split(':');\r\n  const galaxyId = parseInt(parts[0].substring(1), 10);\r\n  const regionId = parseInt(parts[1], 10);\r\n  \r\n  const seed = galaxyId * 10000 + regionId * 100;\r\n  const rng = new SeededRandom(seed);\r\n  \r\n  // Generate 8-23 systems per region\r\n  const systemCount = Math.floor(rng.nextInRange(8, 24));\r\n  const positions: Array<SpatialPosition & { brightness: number }> = [];\r\n  \r\n  for (let i = 0; i < systemCount; i++) {\r\n    // Generate positions in normalized coordinates (0-1)\r\n    // These will be scaled to actual pixel coordinates when rendering\r\n    positions.push({\r\n      x: rng.nextInRange(0.05, 0.95), // Keep away from edges\r\n      y: rng.nextInRange(0.05, 0.95),\r\n      brightness: rng.nextInRange(0.3, 1.0) // Brightness variation for visual interest\r\n    });\r\n  }\r\n  \r\n  return positions;\r\n};\r\n\r\n/**\r\n * Convert normalized coordinates to pixel coordinates\r\n */\r\n/**\r\n * Deterministic position from a coordinate string (e.g., \"A00:03:19:00\")\r\n * Produces stable normalized positions (0-1) and a brightness value.\r\n */\r\nexport const positionFromCoord = (\r\n  coord: string\r\n): { x: number; y: number; brightness: number } => {\r\n  const seed = generateSeedFromCoordinate(coord);\r\n  const rng = new SeededRandom(seed);\r\n  const x = rng.nextInRange(0.08, 0.92);\r\n  const y = rng.nextInRange(0.12, 0.88);\r\n  const brightness = rng.nextInRange(0.3, 1.0);\r\n  return { x, y, brightness };\r\n};\r\n\r\nexport const normalizedToPixel = (\r\n  normalized: SpatialPosition,\r\n  bounds: { x: number; y: number; width: number; height: number }\r\n): SpatialPosition => {\r\n  return {\r\n    x: bounds.x + normalized.x * bounds.width,\r\n    y: bounds.y + normalized.y * bounds.height\r\n  };\r\n};\r\n\r\n/**\r\n * Calculate which grid item was clicked\r\n */\r\nexport const getClickedGridIndex = (\r\n  clickX: number,\r\n  clickY: number,\r\n  layout: GridLayout\r\n): number | null => {\r\n  // Check if click is within the grid bounds\r\n  if (\r\n    clickX < layout.startX ||\r\n    clickX > layout.startX + layout.totalWidth ||\r\n    clickY < layout.startY ||\r\n    clickY > layout.startY + layout.totalHeight\r\n  ) {\r\n    return null;\r\n  }\r\n\r\n  // Calculate which grid cell was clicked\r\n  const relativeX = clickX - layout.startX;\r\n  const relativeY = clickY - layout.startY;\r\n  \r\n  const col = Math.floor(relativeX / (layout.itemSize + layout.padding));\r\n  const row = Math.floor(relativeY / (layout.itemSize + layout.padding));\r\n  \r\n  // Check if click was within an actual item (not in padding)\r\n  const itemLocalX = relativeX % (layout.itemSize + layout.padding);\r\n  const itemLocalY = relativeY % (layout.itemSize + layout.padding);\r\n  \r\n  if (itemLocalX >= layout.itemSize || itemLocalY >= layout.itemSize) {\r\n    return null; // Clicked in padding area\r\n  }\r\n  \r\n  const index = row * layout.cols + col;\r\n  \r\n  // Validate index bounds\r\n  if (col >= layout.cols || row >= layout.rows || index < 0) {\r\n    return null;\r\n  }\r\n  \r\n  return index;\r\n};\r\n\r\n/**\r\n * Zoom level configurations\r\n */\r\nexport const ZOOM_CONFIGS = {\r\n  universe: {\r\n    itemSize: 80,\r\n    padding: 20,\r\n    cols: 8,\r\n    rows: 5,\r\n    totalItems: 40\r\n  },\r\n  galaxy: {\r\n    // Must match GALAXY_LAYOUT in mapConstants.ts to keep draw and click mapping aligned\r\n    itemSize: 60,\r\n    padding: 10,\r\n    cols: 10,\r\n    rows: 10,\r\n    totalItems: 100\r\n  },\r\n  region: {\r\n    itemSize: 60,\r\n    padding: 12,\r\n    cols: 10,\r\n    rows: 10,\r\n    totalItems: 100\r\n  },\r\n  system: {\r\n    // System view uses a different layout - orbital positions\r\n    orbitCount: 8,\r\n    centerX: 0.5,\r\n    centerY: 0.5,\r\n    maxOrbitRadius: 0.4\r\n  }\r\n} as const;\r\n","import { UniverseRegionSystemsData } from './universeService';\r\n\r\ntype Task = {\r\n  server: string;\r\n  galaxy: number;\r\n  region: number;\r\n  key: string; // `${server}${galaxy}:${region}`\r\n  priority?: boolean;\r\n};\r\n\r\ntype SetRegionDataFn = (key: string, data: { systemsWithStars: number[]; starColors?: Record<number, string> }) => void;\r\n\r\nconst getApiBaseUrl = () =>\r\n  (import.meta as any).env?.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\nfunction getAuthHeader(): Record<string, string> {\r\n  try {\r\n    const tokenStr = localStorage.getItem('auth-storage');\r\n    if (!tokenStr) return {};\r\n    const parsed = JSON.parse(tokenStr);\r\n    const token = parsed?.state?.token;\r\n    if (token) {\r\n      return { Authorization: `Bearer ${token}` };\r\n    }\r\n  } catch {\r\n    // ignore\r\n  }\r\n  return {};\r\n}\r\n\r\nexport class RegionSummaryQueue {\r\n  private queue: Task[] = [];\r\n  private inFlight = new Set<string>();\r\n  private running = false;\r\n  private pausedUntil = 0;\r\n  private backoffMs = 0;\r\n  private destroyed = false;\r\n\r\n  constructor(private setRegionData: SetRegionDataFn) {}\r\n\r\n  destroy() {\r\n    this.destroyed = true;\r\n    this.queue = [];\r\n    this.inFlight.clear();\r\n  }\r\n\r\n  enqueue(task: Task) {\r\n    if (this.destroyed) return;\r\n\r\n    // Deduplicate: skip if already in-flight or queued\r\n    if (this.inFlight.has(task.key)) return;\r\n    if (this.queue.find((t) => t.key === task.key)) return;\r\n\r\n    if (task.priority) {\r\n      this.queue.unshift(task);\r\n    } else {\r\n      this.queue.push(task);\r\n    }\r\n\r\n    this.run();\r\n  }\r\n\r\n  private async run() {\r\n    if (this.running || this.destroyed) return;\r\n    this.running = true;\r\n\r\n    try {\r\n      while (!this.destroyed && this.queue.length > 0) {\r\n        const now = Date.now();\r\n        if (now < this.pausedUntil) {\r\n          await this.sleep(this.pausedUntil - now);\r\n          continue;\r\n        }\r\n\r\n        const task = this.queue.shift()!;\r\n        if (this.inFlight.has(task.key)) {\r\n          // Already being processed\r\n          continue;\r\n        }\r\n        this.inFlight.add(task.key);\r\n\r\n        try {\r\n          const { systemsWithStars, starColors } = await this.fetchRegionSystems(task.server, task.galaxy, task.region);\r\n          this.setRegionData(task.key, { systemsWithStars, starColors });\r\n          // Success clears backoff\r\n          this.backoffMs = 0;\r\n          // Gentle pacing between requests\r\n          await this.sleep(150);\r\n        } catch (e: any) {\r\n          const isRateLimit = e?.__rateLimit === true;\r\n          const retryMs = typeof e?.__retryMs === 'number' ? e.__retryMs : 0;\r\n\r\n          if (isRateLimit) {\r\n            // Exponential backoff if server didn't specify Retry-After\r\n            this.backoffMs = this.backoffMs ? Math.min(this.backoffMs * 2, 8000) : 1000;\r\n            const pause = Math.max(this.backoffMs, retryMs);\r\n            this.pausedUntil = Date.now() + pause;\r\n\r\n            // Requeue the task at the front to retry after pause\r\n            this.queue.unshift(task);\r\n            if (import.meta.env.DEV) {\r\n              // eslint-disable-next-line no-console\r\n              console.info(`[RegionSummaryQueue] 429 detected. Pausing for ${pause}ms. Queue len=${this.queue.length}`);\r\n            }\r\n          } else {\r\n            // Non-429 failure: mark as empty to avoid tight loops, and continue\r\n            this.setRegionData(task.key, { systemsWithStars: [] });\r\n            // Gentle pacing even on errors\r\n            await this.sleep(150);\r\n          }\r\n        } finally {\r\n          this.inFlight.delete(task.key);\r\n        }\r\n      }\r\n    } finally {\r\n      this.running = false;\r\n    }\r\n  }\r\n\r\n  private async fetchRegionSystems(server: string, galaxy: number, region: number): Promise<{ systemsWithStars: number[]; starColors: Record<number, string> }> {\r\n    const base = getApiBaseUrl();\r\n    const url = `${base}/universe/region/${encodeURIComponent(server)}/${galaxy}/${region}`;\r\n\r\n    const headers: Record<string, string> = {\r\n      'Content-Type': 'application/json',\r\n      ...getAuthHeader(),\r\n    };\r\n\r\n    const res = await fetch(url, { method: 'GET', headers });\r\n\r\n    if (res.status === 429) {\r\n      // Respect Retry-After if present\r\n      const retryAfter = res.headers.get('Retry-After');\r\n      const retrySec = retryAfter ? parseInt(retryAfter, 10) : NaN;\r\n      const retryMs = Number.isFinite(retrySec) ? retrySec * 1000 : 0;\r\n\r\n      const err: any = new Error('Rate limited');\r\n      err.__rateLimit = true;\r\n      err.__retryMs = retryMs;\r\n      throw err;\r\n    }\r\n\r\n    if (!res.ok) {\r\n      // Other HTTP error\r\n      throw new Error(`HTTP ${res.status}`);\r\n    }\r\n\r\n    // Expect ApiResponse<UniverseRegionSystemsData>\r\n    let json: any;\r\n    try {\r\n      json = (await res.json()) as { success: boolean; data?: UniverseRegionSystemsData; error?: string };\r\n    } catch {\r\n      // Malformed response\r\n      throw new Error('Invalid JSON');\r\n    }\r\n\r\n    if (!json || json.success !== true || !json.data) {\r\n      // Treat as transient failure; queue logic will set empty summary\r\n      throw new Error(json?.error || 'Request failed');\r\n    }\r\n\r\n    const systems = Array.isArray(json.data.systems) ? json.data.systems : [];\r\n\r\n    // Build list and color map\r\n    const starColors: Record<number, string> = {};\r\n    const systemsWithStars = systems\r\n      .filter((s: any) => {\r\n        if (!!s?.star?.color) {\r\n          starColors[s.system] = s.star.color;\r\n        }\r\n        return !!s && s.star;\r\n      })\r\n      .map((s: any) => s.system);\r\n\r\n    return { systemsWithStars, starColors };\r\n  }\r\n\r\n  private sleep(ms: number) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n}\r\n\r\nexport default RegionSummaryQueue;\r\n","import React, { useRef, useEffect, useState, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Empire, formatCoord } from '@game/shared';\r\nimport useUniverseMapStore from '../../stores/universeMapStore';\r\nimport LocationTooltip from './map/LocationTooltip';\r\nimport { handleUniverseViewClick } from './map/UniverseOverview';\r\nimport { handleGalaxyViewClick } from './map/GalaxyView';\r\nimport RegionView from './map/RegionView';\r\nimport SystemView from './map/SystemView';\r\nimport StarInfoPanel from './map/StarInfoPanel';\r\nimport {\r\n  ZOOM_CONFIGS\r\n} from './map/coordinateMapping';\r\nimport { generateSeedFromCoordinate } from '@game/shared';\r\nimport { getBodyPositionAtTime, mapServerBodiesToSystemBodies, SystemBody } from './map/systemBodies';\r\nimport universeService from '../../services/universeService';\r\nimport RegionSummaryQueue from '../../services/regionSummaryQueue';\r\nimport { GALAXY_LAYOUT, calculateFittedGridLayout, getClickedIndex } from './map/mapConstants';\r\n\r\ninterface UniverseMapProps {\r\n  empire: Empire;\r\n}\r\n\r\nconst UniverseMap: React.FC<UniverseMapProps> = ({ empire }) => {\r\n  const navigate = useNavigate();\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [canvasSize, setCanvasSize] = useState({ width: 800, height: 600 });\r\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\r\n  const [hoveredLocation] = useState<any>(null);\r\n  const [hoveredRegion, setHoveredRegion] = useState<number | null>(null);\r\n  const [canvasReady, setCanvasReady] = useState(false);\r\n\r\n  // Guard to prevent repeated galaxy prefetch bursts per (server, galaxy)\r\n  const prefetchKeyRef = useRef<string | null>(null);\r\n  // Queue for safe region summary fetching with backoff\r\n  const queueRef = useRef<RegionSummaryQueue | null>(null);\r\n\r\n  const {\r\n    zoomLevel,\r\n    selectedCoordinate,\r\n    viewport,\r\n    isLoading,\r\n    error,\r\n    showGrid,\r\n    showTerritories,\r\n    showFleets,\r\n    showResources,\r\n    navigateToGalaxy,\r\n    navigateToRegion,\r\n    navigateToSystem,\r\n    zoomIn,\r\n    zoomOut,\r\n    setError,\r\n    setLoading,\r\n    systemData,\r\n    setSystemData,\r\n    setRegionData,\r\n    systemTimeScalar,\r\n    regionData,\r\n    regionDataVersion\r\n  } = useUniverseMapStore();\r\n\r\n  // Handle canvas resize\r\n  const handleResize = useCallback(() => {\r\n    if (containerRef.current) {\r\n      const rect = containerRef.current.getBoundingClientRect();\r\n      const newSize = {\r\n        width: Math.max(800, rect.width - 16), // Minimal padding for fullscreen\r\n        height: Math.max(600, rect.height - 32) // Reduced padding since controls are hidden\r\n      };\r\n      setCanvasSize(newSize);\r\n    }\r\n  }, []);\r\n\r\n  // Handle mouse events\r\n\r\n  const handleMouseMove = useCallback((e: React.MouseEvent) => {\r\n    const rect = canvasRef.current?.getBoundingClientRect();\r\n    if (!rect) return;\r\n\r\n    const x = e.clientX - rect.left;\r\n    const y = e.clientY - rect.top;\r\n    setMousePosition({ x, y });\r\n\r\n    // Galaxy view hover detection for region tooltip\r\n    if (zoomLevel === 'galaxy') {\r\n      const fitted = calculateFittedGridLayout(\r\n        canvasSize.width,\r\n        canvasSize.height,\r\n        GALAXY_LAYOUT.regionSize,\r\n        GALAXY_LAYOUT.padding,\r\n        GALAXY_LAYOUT.cols,\r\n        GALAXY_LAYOUT.rows\r\n      );\r\n      const idx = getClickedIndex(\r\n        x,\r\n        y,\r\n        fitted.startX,\r\n        fitted.startY,\r\n        fitted.itemSize,\r\n        fitted.padding,\r\n        GALAXY_LAYOUT.cols,\r\n        GALAXY_LAYOUT.rows,\r\n        fitted.totalWidth,\r\n        fitted.totalHeight\r\n      );\r\n      setHoveredRegion(idx);\r\n    } else if (hoveredRegion !== null) {\r\n      setHoveredRegion(null);\r\n    }\r\n\r\n  }, [zoomLevel, canvasSize, hoveredRegion]);\r\n\r\n\r\n\r\n  const handleCanvasClick = useCallback((e: React.MouseEvent) => {\r\n\r\n    const rect = canvasRef.current?.getBoundingClientRect();\r\n    if (!rect) return;\r\n\r\n    const x = e.clientX - rect.left;\r\n    const y = e.clientY - rect.top;\r\n\r\n    // Handle click based on current zoom level using view component functions\r\n    switch (zoomLevel) {\r\n      case 'universe':\r\n        const galaxyId = handleUniverseViewClick(x, y, canvasSize.width, canvasSize.height);\r\n        if (galaxyId !== null && galaxyId >= 0 && galaxyId < 40) {\r\n          console.log(`Clicked galaxy ${galaxyId}`);\r\n          navigateToGalaxy(galaxyId);\r\n        }\r\n        break;\r\n        \r\n      case 'galaxy':\r\n        const regionId = handleGalaxyViewClick(x, y, canvasSize.width, canvasSize.height);\r\n        if (regionId !== null && selectedCoordinate && regionId >= 0 && regionId < 100) {\r\n          console.log(`Clicked region ${regionId}`);\r\n          navigateToRegion(selectedCoordinate.galaxy, regionId);\r\n        }\r\n        break;\r\n        \r\n      case 'region':\r\n        // Detect which system was clicked using the same 10x10 grid math as RegionView\r\n        if (!selectedCoordinate) {\r\n          console.log('No coordinate selected in region view');\r\n          break;\r\n        }\r\n        try {\r\n          const width = canvasSize.width;\r\n          const height = canvasSize.height;\r\n\r\n          // Match RegionView grid parameters exactly\r\n          const gridX = 50;\r\n          const gridY = 80;\r\n          const gridW = width - 100;\r\n          const gridH = height - 160;\r\n          const cols = 10;\r\n          const rows = 10;\r\n          const cellW = gridW / cols;\r\n          const cellH = gridH / rows;\r\n\r\n          // Ensure click is within grid bounds\r\n          if (x >= gridX && x <= gridX + gridW && y >= gridY && y <= gridY + gridH) {\r\n            const col = Math.floor((x - gridX) / cellW);\r\n            const row = Math.floor((y - gridY) / cellH);\r\n\r\n            if (col >= 0 && col < cols && row >= 0 && row < rows) {\r\n              // Require click to be near the star center to avoid padding clicks\r\n              const cx = gridX + col * cellW + cellW / 2;\r\n              const cy = gridY + row * cellH + cellH / 2;\r\n              const dx = x - cx;\r\n              const dy = y - cy;\r\n              const r = 14; // ~starSize (10) + padding\r\n\r\n              if (dx * dx + dy * dy <= r * r) {\r\n                const systemId = row * cols + col;\r\n                const key = `${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}`;\r\n                const summary = regionData.get(key);\r\n                if (summary?.systemsWithStars?.includes(systemId)) {\r\n                  console.log(`Clicked system ${systemId}`);\r\n                  navigateToSystem(selectedCoordinate.galaxy, selectedCoordinate.region, systemId);\r\n                } else {\r\n                  // No-op: restrict clicks to real star systems only\r\n                }\r\n              }\r\n            }\r\n          }\r\n        } catch (err) {\r\n          console.error('Error handling region click:', err);\r\n        }\r\n        break;\r\n        \r\n      case 'system':\r\n        // Detect planet click in system view using the same math as draw\r\n        if (!selectedCoordinate) {\r\n          console.log('No coordinate selected in system view');\r\n          break;\r\n        }\r\n        try {\r\n          const centerX = canvasSize.width / 2;\r\n          const centerY = canvasSize.height / 2;\r\n\r\n          // Seed bodies deterministically from star coordinate (body 0)\r\n          const key = `${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}:${selectedCoordinate.system}`;\r\n          const cachedBodies = systemData.get(key) as any[] | undefined;\r\n          const bodies = cachedBodies && cachedBodies.length\r\n            ? mapServerBodiesToSystemBodies(cachedBodies as any)\r\n            : [];\r\n\r\n          const timeScalar = systemTimeScalar ?? Date.now() * 0.0005;\r\n\r\n          let clickedBody: SystemBody | null = null;\r\n          let nearestBody: SystemBody | null = null;\r\n          let nearestDistSq = Number.POSITIVE_INFINITY;\r\n\r\n          for (const body of bodies) {\r\n            // Navigate for both planets and asteroids (star is body 0 and not in this list)\r\n            const { x: bx, y: by } = getBodyPositionAtTime(body, timeScalar, centerX, centerY);\r\n            const r = Math.max(8, Math.min(16, body.size + 4)); // slightly more forgiving to ensure reliable clicks\r\n            const dx = x - bx;\r\n            const dy = y - by;\r\n            const distSq = dx * dx + dy * dy;\r\n\r\n            if (distSq < nearestDistSq) {\r\n              nearestDistSq = distSq;\r\n              nearestBody = body;\r\n            }\r\n            if (distSq <= r * r) {\r\n              clickedBody = body;\r\n              break;\r\n            }\r\n          }\r\n\r\n          // Fallback: if no body fell within its precise radius, use the nearest body within a global threshold\r\n          if (!clickedBody && nearestBody) {\r\n            const globalThreshold = 24; // pixels\r\n            if (nearestDistSq <= globalThreshold * globalThreshold) {\r\n              clickedBody = nearestBody;\r\n            }\r\n          }\r\n\r\n          if (clickedBody) {\r\n            // Debug highlight the detected body position to verify hit-testing\r\n            try {\r\n              const canvas = canvasRef.current;\r\n              const ctx = canvas?.getContext('2d');\r\n              if (ctx) {\r\n                const { x: hx, y: hy } = getBodyPositionAtTime(clickedBody, timeScalar, centerX, centerY);\r\n                ctx.save();\r\n                ctx.strokeStyle = 'rgba(0, 255, 0, 0.9)';\r\n                ctx.lineWidth = 2;\r\n                ctx.beginPath();\r\n                ctx.arc(hx, hy, (clickedBody.size || 4) + 8, 0, Math.PI * 2);\r\n                ctx.stroke();\r\n                ctx.restore();\r\n              }\r\n            } catch (e) {\r\n              console.warn('[SystemClick] Debug highlight failed:', e);\r\n            }\r\n\r\n            console.log('[SystemClick] Navigating to body', clickedBody.id, 'coord body=', clickedBody.id + 1, 'timeScalar=', timeScalar);\r\n\r\n            // Star is body 0, generated bodies are 1..N by adding 1\r\n            const planetBodyIndex = clickedBody.id + 1;\r\n            const planetCoord = formatCoord({\r\n              ...selectedCoordinate,\r\n              body: planetBodyIndex,\r\n            });\r\n            navigate(`/planet/${planetCoord}`);\r\n          } else {\r\n            console.log('[SystemClick] No body matched. nearestDistSq=', nearestDistSq);\r\n          }\r\n        } catch (err) {\r\n          console.error('Error handling system click:', err);\r\n        }\r\n        break;\r\n    }\r\n  }, [canvasSize, zoomLevel, selectedCoordinate, navigate, systemTimeScalar]);\r\n\r\n  // Initialize canvas size\r\n  useEffect(() => {\r\n    handleResize();\r\n    // Defer readiness to the next animation frame to ensure the canvas ref is set post-commit\r\n    const rafId = requestAnimationFrame(() => setCanvasReady(true));\r\n    window.addEventListener('resize', handleResize);\r\n    return () => {\r\n      cancelAnimationFrame(rafId);\r\n      window.removeEventListener('resize', handleResize);\r\n    };\r\n  }, [handleResize]);\r\n\r\n  // Fetch system bodies from server when entering system view (cached by system key)\r\n  useEffect(() => {\r\n    if (zoomLevel !== 'system' || !selectedCoordinate) return;\r\n    const key = `${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}:${selectedCoordinate.system}`;\r\n    if (systemData.has(key)) return;\r\n\r\n    setLoading(true);\r\n    universeService\r\n      .getSystemBodies(\r\n        selectedCoordinate.server,\r\n        selectedCoordinate.galaxy,\r\n        selectedCoordinate.region,\r\n        selectedCoordinate.system\r\n      )\r\n      .then((res) => {\r\n        if (res.success && res.data) {\r\n          setSystemData(key, res.data.bodies);\r\n        } else {\r\n          setError(res.error || 'Failed to load system bodies');\r\n        }\r\n      })\r\n      .catch(() => setError('Network error loading system bodies'))\r\n      .finally(() => setLoading(false));\r\n  }, [zoomLevel, selectedCoordinate, systemData, setSystemData, setLoading, setError]);\r\n\r\n  // Initialize RegionSummaryQueue\r\n  useEffect(() => {\r\n    if (!queueRef.current) {\r\n      queueRef.current = new RegionSummaryQueue(setRegionData);\r\n    }\r\n    return () => {\r\n      queueRef.current?.destroy();\r\n      queueRef.current = null;\r\n    };\r\n  }, [setRegionData]);\r\n\r\n  // Prefetch ALL region star colors in one batch when entering Galaxy view\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    (async () => {\r\n      if (zoomLevel !== 'galaxy' || !selectedCoordinate) return;\r\n\r\n      const server = selectedCoordinate.server;\r\n      const galaxy = selectedCoordinate.galaxy;\r\n      const prefetchKey = `${server}${galaxy}`;\r\n\r\n      // Run only once per (server, galaxy)\r\n      if (prefetchKeyRef.current === prefetchKey) return;\r\n\r\n      // Primary path: single batched colors payload for the entire galaxy\r\n      try {\r\n        const res = await universeService.getGalaxyRegionStarColors(server, galaxy);\r\n        if (!cancelled && res.success && res.data) {\r\n          for (const { region, systems } of res.data.regions || []) {\r\n            const systemsWithStars = systems.map((s) => s.system);\r\n            const starColors = Object.fromEntries(systems.map((s) => [s.system, s.color]));\r\n            const key = `${server}${galaxy}:${region}`;\r\n            setRegionData(key, { systemsWithStars, starColors });\r\n          }\r\n\r\n          prefetchKeyRef.current = prefetchKey;\r\n          if ((import.meta as any).env?.DEV) {\r\n            // eslint-disable-next-line no-console\r\n            console.info(\r\n              `[GalaxyPrefetch] Batched star colors for ${server}${galaxy.toString().padStart(2, '0')} (regions=${res.data.regions?.length ?? 0})`\r\n            );\r\n          }\r\n          return;\r\n        }\r\n      } catch {\r\n        // fall through to fallback\r\n      }\r\n\r\n      // Fallback path: batch positions only, then enqueue queue to fill colors progressively\r\n      try {\r\n        const res2 = await universeService.getGalaxyRegionSummaries(server, galaxy);\r\n        if (!cancelled && res2.success && res2.data) {\r\n          for (const { region, systemsWithStars } of res2.data.regions || []) {\r\n            const key = `${server}${galaxy}:${region}`;\r\n            setRegionData(key, { systemsWithStars });\r\n          }\r\n        }\r\n      } catch {\r\n        // ignore and proceed to queue regardless\r\n      }\r\n\r\n      const q = queueRef.current;\r\n      if (!cancelled && q) {\r\n        for (let r = 0; r < 100; r++) {\r\n          const key = `${server}${galaxy}:${r}`;\r\n          q.enqueue({ server, galaxy, region: r, key });\r\n        }\r\n        prefetchKeyRef.current = prefetchKey;\r\n        if ((import.meta as any).env?.DEV) {\r\n          // eslint-disable-next-line no-console\r\n          console.info(\r\n            `[GalaxyPrefetch:FALLBACK] Enqueued 100 regions for ${server}${galaxy.toString().padStart(2, '0')}`\r\n          );\r\n        }\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [zoomLevel, selectedCoordinate?.server, selectedCoordinate?.galaxy, setRegionData]);\r\n\r\n  // High-priority fetch for hovered region in Galaxy view\r\n  useEffect(() => {\r\n    if (zoomLevel !== 'galaxy' || !selectedCoordinate) return;\r\n    if (hoveredRegion === null || hoveredRegion < 0 || hoveredRegion >= 100) return;\r\n\r\n    const server = selectedCoordinate.server;\r\n    const galaxy = selectedCoordinate.galaxy;\r\n    const key = `${server}${galaxy}:${hoveredRegion}`;\r\n\r\n    if (!regionData.has(key)) {\r\n      queueRef.current?.enqueue({ server, galaxy, region: hoveredRegion, key, priority: true });\r\n    }\r\n  }, [zoomLevel, selectedCoordinate?.server, selectedCoordinate?.galaxy, hoveredRegion, regionData]);\r\n\r\n  // Draw realistic star field background with steady colors\r\n  const drawStarField = (ctx: CanvasRenderingContext2D) => {\r\n    // Draw deterministic background stars (cosmetic only; no MK dependency)\r\n    for (let i = 0; i < 400; i++) {\r\n      const x = (i * 37) % canvasSize.width;\r\n      const y = (i * 73) % canvasSize.height;\r\n\r\n      const seed = generateSeedFromCoordinate(`background-${x}-${y}`, i);\r\n      const palette = ['#9BB0FF', '#CAD7FF', '#FFF4EA', '#FFD2A1', '#E6F1FF', '#AFBFFF'];\r\n      const colorIdx = Math.abs(seed) % palette.length;\r\n      const baseHex = palette[colorIdx];\r\n\r\n      // Size between ~0.5 and 2.3 pixels, steady (no twinkling)\r\n      const size = 0.5 + ((Math.abs(seed) % 1000) / 1000) * 1.8;\r\n\r\n      ctx.fillStyle = baseHex;\r\n      ctx.beginPath();\r\n      ctx.arc(x, y, size, 0, Math.PI * 2);\r\n      ctx.fill();\r\n    }\r\n\r\n    // Draw subtle nebula effects (reduced intensity, no animation)\r\n    for (let i = 0; i < 6; i++) {\r\n      const x = (i * 157) % canvasSize.width;\r\n      const y = (i * 211) % canvasSize.height;\r\n      const radius = 80 + (i * 20); // Static radius\r\n      \r\n      const colors = [\r\n        [80, 40, 160], // Purple\r\n        [160, 80, 40], // Orange\r\n        [40, 160, 80], // Green\r\n        [160, 40, 80], // Pink\r\n        [40, 80, 160], // Blue\r\n        [160, 160, 40], // Yellow\r\n      ];\r\n      const color = colors[i % colors.length];\r\n      \r\n      const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);\r\n      gradient.addColorStop(0, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0.15)`); // Static opacity\r\n      gradient.addColorStop(1, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0)`);\r\n      \r\n      ctx.fillStyle = gradient;\r\n      ctx.fillRect(x - radius, y - radius, radius * 2, radius * 2);\r\n    }\r\n  };\r\n\r\n  // Draw universe overview (40 galaxies in 8x5 grid)\r\n  const drawUniverseView = (ctx: CanvasRenderingContext2D) => {\r\n    const galaxySize = 80;\r\n    const padding = 20;\r\n    const cols = 8;\r\n    const rows = 5;\r\n    \r\n    const totalWidth = cols * galaxySize + (cols - 1) * padding;\r\n    const totalHeight = rows * galaxySize + (rows - 1) * padding;\r\n    \r\n    const startX = (canvasSize.width - totalWidth) / 2;\r\n    const startY = (canvasSize.height - totalHeight) / 2;\r\n\r\n    // Draw grid lines if enabled\r\n    if (showGrid) {\r\n      ctx.strokeStyle = 'rgba(150, 150, 150, 0.6)';\r\n      ctx.lineWidth = 1;\r\n      \r\n      // Vertical lines\r\n      for (let col = 0; col <= cols; col++) {\r\n        const x = startX + col * (galaxySize + padding) - padding / 2;\r\n        ctx.beginPath();\r\n        ctx.moveTo(x, startY - padding / 2);\r\n        ctx.lineTo(x, startY + totalHeight + padding / 2);\r\n        ctx.stroke();\r\n      }\r\n      \r\n      // Horizontal lines\r\n      for (let row = 0; row <= rows; row++) {\r\n        const y = startY + row * (galaxySize + padding) - padding / 2;\r\n        ctx.beginPath();\r\n        ctx.moveTo(startX - padding / 2, y);\r\n        ctx.lineTo(startX + totalWidth + padding / 2, y);\r\n        ctx.stroke();\r\n      }\r\n    }\r\n\r\n    // Draw galaxies\r\n    for (let galaxyId = 0; galaxyId < 40; galaxyId++) {\r\n      const row = Math.floor(galaxyId / cols);\r\n      const col = galaxyId % cols;\r\n      \r\n      const x = startX + col * (galaxySize + padding);\r\n      const y = startY + row * (galaxySize + padding);\r\n      \r\n      drawGalaxy(ctx, x, y, galaxySize, galaxyId, empire, showTerritories);\r\n    }\r\n\r\n    // Draw galaxy labels\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n    ctx.font = '12px monospace';\r\n    ctx.textAlign = 'center';\r\n    \r\n    for (let galaxyId = 0; galaxyId < 40; galaxyId++) {\r\n      const row = Math.floor(galaxyId / cols);\r\n      const col = galaxyId % cols;\r\n      \r\n      const x = startX + col * (galaxySize + padding) + galaxySize / 2;\r\n      const y = startY + row * (galaxySize + padding) + galaxySize + 15;\r\n      \r\n      ctx.fillText(`Galaxy ${galaxyId}`, x, y);\r\n    }\r\n  };\r\n\r\n  // Draw individual galaxy\r\n  const drawGalaxy = (\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    size: number,\r\n    galaxyId: number,\r\n    empire: Empire,\r\n    showTerritories: boolean\r\n  ) => {\r\n    const centerX = x + size / 2;\r\n    const centerY = y + size / 2;\r\n    const radius = size / 2 - 5;\r\n\r\n    // Draw galaxy spiral arms with bright colors\r\n    ctx.strokeStyle = 'rgba(100, 150, 255, 0.8)';\r\n    ctx.lineWidth = 3;\r\n    \r\n    for (let arm = 0; arm < 3; arm++) {\r\n      ctx.beginPath();\r\n      for (let t = 0; t < Math.PI * 4; t += 0.1) {\r\n        const spiralRadius = (t / (Math.PI * 4)) * radius;\r\n        const angle = t + (arm * Math.PI * 2 / 3);\r\n        const spiralX = centerX + Math.cos(angle) * spiralRadius;\r\n        const spiralY = centerY + Math.sin(angle) * spiralRadius;\r\n        \r\n        if (t === 0) {\r\n          ctx.moveTo(spiralX, spiralY);\r\n        } else {\r\n          ctx.lineTo(spiralX, spiralY);\r\n        }\r\n      }\r\n      ctx.stroke();\r\n    }\r\n\r\n    // Draw bright galaxy core\r\n    const coreGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, 20);\r\n    coreGradient.addColorStop(0, 'rgba(255, 255, 150, 1.0)');\r\n    coreGradient.addColorStop(0.5, 'rgba(255, 200, 100, 0.8)');\r\n    coreGradient.addColorStop(1, 'rgba(255, 150, 50, 0.2)');\r\n    \r\n    ctx.fillStyle = coreGradient;\r\n    ctx.beginPath();\r\n    ctx.arc(centerX, centerY, 20, 0, Math.PI * 2);\r\n    ctx.fill();\r\n\r\n    // Show territory indicators if enabled\r\n    if (showTerritories) {\r\n      // Check if this galaxy contains empire territories\r\n      const hasTerritory = empire.territories.some(coord => {\r\n        try {\r\n          const galaxyFromCoord = parseInt(coord.substring(1, 3), 10);\r\n          return galaxyFromCoord === galaxyId;\r\n        } catch {\r\n          return false;\r\n        }\r\n      });\r\n\r\n      if (hasTerritory) {\r\n        // Draw bright territory indicator\r\n        ctx.strokeStyle = '#00ff00';\r\n        ctx.lineWidth = 4;\r\n        ctx.beginPath();\r\n        ctx.arc(centerX, centerY, radius + 3, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n        \r\n        // Add empire flag\r\n        ctx.fillStyle = '#00ff00';\r\n        ctx.fillRect(x + size - 15, y + 3, 12, 8);\r\n      }\r\n    }\r\n\r\n    // Draw galaxy border\r\n    ctx.strokeStyle = 'rgba(150, 200, 255, 0.6)';\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\r\n    ctx.stroke();\r\n  };\r\n\r\n  // Draw galaxy view (100 regions in 10x10 grid) - Clean grid layout matching mockup\r\n  const drawGalaxyView = (ctx: CanvasRenderingContext2D) => {\r\n    if (!selectedCoordinate) return;\r\n\r\n    const config = ZOOM_CONFIGS.galaxy;\r\n    const fitted = calculateFittedGridLayout(\r\n      canvasSize.width,\r\n      canvasSize.height,\r\n      config.itemSize,\r\n      config.padding,\r\n      config.cols,\r\n      config.rows,\r\n      16\r\n    );\r\n\r\n    // Draw clean blue grid lines like in mockup\r\n    ctx.strokeStyle = 'rgba(100, 150, 255, 0.8)';\r\n    ctx.lineWidth = 2;\r\n    \r\n    // Vertical lines\r\n    for (let col = 0; col <= config.cols; col++) {\r\n      const x = fitted.startX + col * (fitted.itemSize + fitted.padding);\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, fitted.startY);\r\n      ctx.lineTo(x, fitted.startY + fitted.totalHeight);\r\n      ctx.stroke();\r\n    }\r\n    \r\n    // Horizontal lines\r\n    for (let row = 0; row <= config.rows; row++) {\r\n      const y = fitted.startY + row * (fitted.itemSize + fitted.padding);\r\n      ctx.beginPath();\r\n      ctx.moveTo(fitted.startX, y);\r\n      ctx.lineTo(fitted.startX + fitted.totalWidth, y);\r\n      ctx.stroke();\r\n    }\r\n\r\n    // Draw regions with star clusters like in mockup\r\n    for (let regionId = 0; regionId < 100; regionId++) {\r\n      const row = Math.floor(regionId / config.cols);\r\n      const col = regionId % config.cols;\r\n      \r\n      const x = fitted.startX + col * (fitted.itemSize + fitted.padding);\r\n      const y = fitted.startY + row * (fitted.itemSize + fitted.padding);\r\n      \r\n      drawRegionInGalaxy(ctx, x, y, fitted.itemSize, selectedCoordinate.galaxy, regionId, empire, showTerritories);\r\n    }\r\n\r\n    // Draw galaxy title matching mockup format\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n    ctx.font = 'bold 18px monospace';\r\n    ctx.textAlign = 'left';\r\n    ctx.fillText(`Galaxy ${selectedCoordinate.server}${selectedCoordinate.galaxy.toString().padStart(2, '0')}`, fitted.startX, fitted.startY - 20);\r\n    \r\n    // Add \"Change\" link like in mockup\r\n    ctx.fillStyle = 'rgba(255, 200, 0, 0.9)';\r\n    ctx.font = '14px monospace';\r\n    const titleWidth = ctx.measureText(`Galaxy ${selectedCoordinate.server}${selectedCoordinate.galaxy.toString().padStart(2, '0')}`).width;\r\n    ctx.fillText('Change', fitted.startX + titleWidth + 20, fitted.startY - 20);\r\n  };\r\n\r\n  // Helper to convert hex color to rgba\r\n  const hexToRgba = (hex: string, alpha: number) => {\r\n    try {\r\n      const h = hex.replace('#', '');\r\n      const normalized = h.length === 3 ? h.split('').map(ch => ch + ch).join('') : h;\r\n      const bigint = parseInt(normalized, 16);\r\n      const r = (bigint >> 16) & 255;\r\n      const g = (bigint >> 8) & 255;\r\n      const b = bigint & 255;\r\n      return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n    } catch {\r\n      return `rgba(255, 255, 255, ${alpha})`;\r\n    }\r\n  };\r\n\r\n  // Draw individual region in galaxy view - matching mockup style\r\n  const drawRegionInGalaxy = (\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    size: number,\r\n    galaxyId: number,\r\n    regionId: number,\r\n    empire: Empire,\r\n    showTerritories: boolean\r\n  ) => {\r\n    // Draw dark space background\r\n    ctx.fillStyle = 'rgba(5, 5, 15, 0.8)';\r\n    ctx.fillRect(x, y, size, size);\r\n\r\n    // If we have a server-backed summary for this region, draw stars at mini 10x10 centers\r\n    const server = selectedCoordinate?.server ?? 'A';\r\n    const key = `${server}${galaxyId}:${regionId}`;\r\n    const summary = regionData.get(key) as { systemsWithStars?: number[]; starColors?: Record<number, string> } | undefined;\r\n    if (summary?.systemsWithStars?.length) {\r\n      const mini = size / 10;\r\n      summary.systemsWithStars.forEach((sys) => {\r\n        const col = sys % 10;\r\n        const row = Math.floor(sys / 10);\r\n        const sx = x + (col + 0.5) * mini;\r\n        const sy = y + (row + 0.5) * mini;\r\n\r\n        const baseHex = summary.starColors?.[sys] ?? '#FFFFFF';\r\n        const r = Math.max(1.4, Math.min(2.4, mini * 0.12));\r\n\r\n        // colored glow\r\n        const g = ctx.createRadialGradient(sx, sy, 0, sx, sy, r * 3);\r\n        g.addColorStop(0, hexToRgba(baseHex, 0.65));\r\n        g.addColorStop(1, hexToRgba(baseHex, 0));\r\n        ctx.fillStyle = g;\r\n        ctx.beginPath();\r\n        ctx.arc(sx, sy, r * 3, 0, Math.PI * 2);\r\n        ctx.fill();\r\n\r\n        // colored dot\r\n        ctx.fillStyle = baseHex;\r\n        ctx.beginPath();\r\n        ctx.arc(sx, sy, r, 0, Math.PI * 2);\r\n        ctx.fill();\r\n      });\r\n    }\r\n\r\n    // Show territory indicators if enabled\r\n    if (showTerritories) {\r\n      // Check if this region contains empire territories\r\n      const hasTerritory = empire.territories.some(coord => {\r\n        try {\r\n          const coordGalaxy = parseInt(coord.substring(1, 3), 10);\r\n          const coordRegion = parseInt(coord.substring(4, 6), 10);\r\n          return coordGalaxy === galaxyId && coordRegion === regionId;\r\n        } catch {\r\n          return false;\r\n        }\r\n      });\r\n\r\n      if (hasTerritory) {\r\n        // Draw bright territory indicator\r\n        ctx.strokeStyle = '#00ff00';\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeRect(x + 1, y + 1, size - 2, size - 2);\r\n        \r\n        // Add empire flag\r\n        ctx.fillStyle = '#00ff00';\r\n        ctx.fillRect(x + size - 10, y + 2, 8, 5);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Main render function\r\n  const renderCurrentView = () => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    // Only overpaint the canvas for universe/galaxy.\r\n    // Region/System are fully rendered by their own components to avoid being wiped each frame.\r\n    if (zoomLevel === 'universe' || zoomLevel === 'galaxy') {\r\n      // Clear canvas with space background\r\n      ctx.fillStyle = '#0a0a1a';\r\n      ctx.fillRect(0, 0, canvasSize.width, canvasSize.height);\r\n\r\n      // Draw star field background\r\n      drawStarField(ctx);\r\n\r\n      if (zoomLevel === 'universe') {\r\n        drawUniverseView(ctx);\r\n      } else {\r\n        drawGalaxyView(ctx);\r\n\r\n        // Hover tooltip for region index\r\n        if (hoveredRegion !== null) {\r\n          const label = `R${hoveredRegion.toString().padStart(2, '0')}`;\r\n          ctx.font = '12px monospace';\r\n          const padding = 4;\r\n          const metrics = ctx.measureText(label);\r\n          const boxW = metrics.width + padding * 2;\r\n          const boxH = 18;\r\n          let tx = mousePosition.x + 12;\r\n          let ty = mousePosition.y - 12;\r\n          if (tx + boxW > canvasSize.width) tx = canvasSize.width - boxW - 4;\r\n          if (ty - boxH < 0) ty = boxH + 4;\r\n          ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n          ctx.fillRect(tx, ty - boxH, boxW, boxH);\r\n          ctx.strokeStyle = 'rgba(255,255,255,0.8)';\r\n          ctx.strokeRect(tx, ty - boxH, boxW, boxH);\r\n          ctx.fillStyle = 'rgba(255,255,255,0.95)';\r\n          ctx.fillText(label, tx + padding, ty - 5);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  // Animation loop\r\n  useEffect(() => {\r\n    let animationId: number;\r\n    \r\n    const animate = () => {\r\n      renderCurrentView();\r\n      animationId = requestAnimationFrame(animate);\r\n    };\r\n    \r\n    animate();\r\n    \r\n    return () => {\r\n      if (animationId) {\r\n        cancelAnimationFrame(animationId);\r\n      }\r\n    };\r\n  }, [zoomLevel, viewport, selectedCoordinate, showGrid, showTerritories, showFleets, showResources, canvasSize, regionDataVersion]);\r\n\r\n  // Star info panel derivation for system view\r\n  let starPanel: React.ReactNode = null;\r\n  if (zoomLevel === 'system' && selectedCoordinate) {\r\n    const systemKey = `${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}:${selectedCoordinate.system}`;\r\n    const cachedBodies = systemData.get(systemKey) as any[] | undefined;\r\n    const hasStar = cachedBodies ? cachedBodies.length > 0 : undefined;\r\n\r\n    // Read server-provided starOverhaul from the star (body 00)\r\n    let starOverhaul: any | undefined = undefined;\r\n    if (Array.isArray(cachedBodies) && cachedBodies.length > 0) {\r\n      const starBody = cachedBodies.find((b: any) => b?.type === 'star');\r\n      if (starBody && starBody.starOverhaul) {\r\n        starOverhaul = starBody.starOverhaul;\r\n      }\r\n    }\r\n\r\n    const coordText = `${selectedCoordinate.server}${selectedCoordinate.galaxy.toString().padStart(2, '0')}:${selectedCoordinate.region.toString().padStart(2, '0')}:${selectedCoordinate.system.toString().padStart(2, '0')}`;\r\n    // No MK spectral computation; show Overhaul kind only\r\n    starPanel = (<StarInfoPanel coord={coordText} hasStar={hasStar} starOverhaul={starOverhaul} />);\r\n  }\r\n\r\n  return (\r\n    <div ref={containerRef} className=\"relative w-full h-full bg-gray-900 overflow-hidden\">\r\n\r\n\r\n      {/* Main Canvas */}\r\n      <canvas\r\n        ref={canvasRef}\r\n        width={canvasSize.width}\r\n        height={canvasSize.height}\r\n        onMouseMove={handleMouseMove}\r\n        onMouseLeave={() => setHoveredRegion(null)}\r\n        onClick={handleCanvasClick}\r\n      />\r\n\r\n      {/* Region View Component - renders to canvas */}\r\n      {zoomLevel === 'region' && canvasReady && (\r\n        <RegionView\r\n          canvas={canvasRef.current!}\r\n          selectedCoordinate={selectedCoordinate}\r\n          showTerritories={showTerritories}\r\n        />\r\n      )}\r\n\r\n      {/* System View Component - renders to canvas */}\r\n      {zoomLevel === 'system' && canvasReady && (\r\n        <SystemView\r\n          canvas={canvasRef.current!}\r\n          selectedCoordinate={selectedCoordinate}\r\n          empire={empire}\r\n          showResources={showResources}\r\n          serverBodies={\r\n            selectedCoordinate\r\n              ? (systemData.get(`${selectedCoordinate.server}${selectedCoordinate.galaxy}:${selectedCoordinate.region}:${selectedCoordinate.system}`) as any[] | undefined)\r\n              : undefined\r\n          }\r\n        />\r\n      )}\r\n\r\n      {starPanel}\r\n\r\n      {/* Location Tooltip */}\r\n      {hoveredLocation && (\r\n        <LocationTooltip \r\n          location={hoveredLocation}\r\n          position={mousePosition}\r\n        />\r\n      )}\r\n\r\n      {/* Loading Overlay */}\r\n      {isLoading && (\r\n        <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"text-white text-center\">\r\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\r\n            <p>Loading universe data...</p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Error Display */}\r\n      {error && (\r\n        <div className=\"absolute top-32 left-1/2 transform -translate-x-1/2 bg-red-900 border border-red-700 text-red-200 px-4 py-2 rounded-md z-30\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <span> {error}</span>\r\n            <button \r\n              onClick={() => setError(null)}\r\n              className=\"text-red-400 hover:text-red-200\"\r\n            >\r\n              \r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Zoom Controls */}\r\n      <div className=\"absolute bottom-4 right-4 flex flex-col gap-2 z-10\">\r\n        <button\r\n          onClick={zoomIn}\r\n          className=\"w-10 h-10 bg-gray-800 border border-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center justify-center\"\r\n          title=\"Zoom In\"\r\n        >\r\n          +\r\n        </button>\r\n        <button\r\n          onClick={zoomOut}\r\n          className=\"w-10 h-10 bg-gray-800 border border-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center justify-center\"\r\n          title=\"Zoom Out\"\r\n        >\r\n          \r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UniverseMap;\r\n","import * as React from 'react';\r\nimport { Empire, CoordinateComponents, pickStarKindFromCoord } from '@game/shared';\r\nimport { MapViewport } from '../../../stores/universeMapStore';\r\nimport { GALAXY_LAYOUT, calculateFittedGridLayout, getClickedIndex } from './mapConstants';\r\nimport universeService, { UniverseRegionSystemsData } from '../../../services/universeService';\r\nimport { buildCachedLayer, createOffscreenLayer, drawToLayer, composeLayers, clearLayerCache, LayerCache } from './helpers/offscreenLayers';\r\nimport { computeStarsHash, computeEmpireTerritoryHash } from './helpers/hashing';\r\n\r\ninterface GalaxyViewProps {\r\n  canvas: HTMLCanvasElement;\r\n  viewport: MapViewport;\r\n  selectedCoordinate: CoordinateComponents | null;\r\n  empire: Empire;\r\n  showGrid: boolean;\r\n  showTerritories: boolean;\r\n}\r\n\r\n// Dev-only performance monitor (logs FPS and warns on sustained low FPS)\r\n// Enabled when localStorage.getItem('enableFpsMonitor') === '1'\r\nclass PerformanceMonitor {\r\n  private frames = 0;\r\n  private last = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n  private fps = 0;\r\n  private belowThresholdCount = 0;\r\n\r\n  constructor(\r\n    private enabled: boolean,\r\n    private threshold = 30,\r\n    private warnStreakSeconds = 3\r\n  ) {}\r\n\r\n  update(now: number): number {\r\n    this.frames++;\r\n    if (now - this.last >= 1000) {\r\n      this.fps = this.frames;\r\n      this.frames = 0;\r\n      this.last = now;\r\n\r\n      if (this.enabled) {\r\n        // Log current fps\r\n        if (typeof console !== 'undefined' && typeof console.debug === 'function') {\r\n          console.debug(`[GalaxyView] ${this.fps} fps`);\r\n        }\r\n\r\n        // Track sustained low FPS and warn\r\n        if (this.fps < this.threshold) {\r\n          this.belowThresholdCount++;\r\n          if (this.belowThresholdCount >= this.warnStreakSeconds) {\r\n            if (typeof console !== 'undefined' && typeof console.warn === 'function') {\r\n              console.warn(\r\n                `[GalaxyView] Sustained low FPS (${this.fps} < ${this.threshold}) for ${this.warnStreakSeconds}s`\r\n              );\r\n            }\r\n            this.belowThresholdCount = 0; // reset to avoid spamming\r\n          }\r\n        } else {\r\n          this.belowThresholdCount = 0;\r\n        }\r\n      }\r\n    }\r\n    return this.fps;\r\n  }\r\n}\r\n\r\nconst GalaxyView: React.FC<GalaxyViewProps> = ({\r\n  canvas,\r\n  selectedCoordinate,\r\n  empire,\r\n  showGrid,\r\n  showTerritories\r\n}) => {\r\n  // Per-region star data fetched from server: systems with star color/class\r\n  const [regionStarsByRegion, setRegionStarsByRegion] = React.useState<Record<number, UniverseRegionSystemsData['systems']>>({});\r\n\r\n  // Animation + FPS monitoring (guarded)\r\n  const animationRef = React.useRef<number | null>(null);\r\n  const enableFpsMonitor =\r\n    (typeof window !== 'undefined') &&\r\n    !!window.localStorage &&\r\n    window.localStorage.getItem('enableFpsMonitor') === '1';\r\n  const perfMonitorRef = React.useRef<PerformanceMonitor | null>(null);\r\n\r\n  // Cached fitted layout and offscreen grid layer\r\n  const layoutRef = React.useRef<ReturnType<typeof calculateFittedGridLayout> | null>(null);\r\n  const regionCanvasRef = React.useRef<HTMLCanvasElement | null>(null);\r\n  const layerCacheRef = React.useRef<LayerCache>(new Map());\r\n  const lowDetailRef = React.useRef<boolean>(false);\r\n\r\n  // Fetch all region star data for the selected galaxy\r\n  React.useEffect(() => {\r\n    let cancelled = false;\r\n    const load = async () => {\r\n      if (!selectedCoordinate) return;\r\n      const server = selectedCoordinate.server;\r\n      const galaxy = selectedCoordinate.galaxy;\r\n\r\n      // Fetch all 100 regions in parallel (can be optimized with batching if needed)\r\n      const promises = Array.from({ length: 100 }, async (_, region) => {\r\n        try {\r\n          const res = await universeService.getRegionSystems(server, galaxy, region);\r\n          if ((res as any)?.success && (res as any)?.data) {\r\n            return { region, systems: (res as any).data.systems as UniverseRegionSystemsData['systems'] };\r\n          }\r\n        } catch {\r\n          // ignore failures; leave region empty\r\n        }\r\n        return { region, systems: [] as UniverseRegionSystemsData['systems'] };\r\n      });\r\n\r\n      const results = await Promise.all(promises);\r\n      if (cancelled) return;\r\n\r\n      const byRegion: Record<number, UniverseRegionSystemsData['systems']> = {};\r\n      results.forEach(({ region, systems }) => {\r\n        byRegion[region] = systems || [];\r\n      });\r\n      setRegionStarsByRegion(byRegion);\r\n    };\r\n\r\n    load();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [selectedCoordinate?.server, selectedCoordinate?.galaxy]);\r\n\r\n  React.useEffect(() => {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    let running = true;\r\n\r\n    // Init performance monitor (dev-guarded via localStorage flag)\r\n    perfMonitorRef.current = new PerformanceMonitor(enableFpsMonitor);\r\n\r\n    // Compute fitted layout (once per effect run) and cache it\r\n    const fitted = calculateFittedGridLayout(\r\n      canvas.width,\r\n      canvas.height,\r\n      GALAXY_LAYOUT.regionSize,\r\n      GALAXY_LAYOUT.padding,\r\n      GALAXY_LAYOUT.cols,\r\n      GALAXY_LAYOUT.rows\r\n    );\r\n    layoutRef.current = fitted;\r\n\r\n\r\n    // Prepare offscreen regions canvas (static unless data/props change)\r\n    if (selectedCoordinate) {\r\n      const regionCanvas = document.createElement('canvas');\r\n      regionCanvas.width = canvas.width;\r\n      regionCanvas.height = canvas.height;\r\n      const rctx = regionCanvas.getContext('2d');\r\n      if (rctx) {\r\n        drawRegionsLayer(\r\n          rctx,\r\n          fitted,\r\n          selectedCoordinate.galaxy,\r\n          showTerritories,\r\n          empire,\r\n          regionStarsByRegion\r\n        );\r\n      }\r\n      regionCanvasRef.current = regionCanvas;\r\n    } else {\r\n      regionCanvasRef.current = null;\r\n    }\r\n\r\n    const draw = () => {\r\n      if (!running) return;\r\n\r\n      // Clear canvas\r\n      ctx.fillStyle = '#000011';\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n      // Draw star field background (animated via time)\r\n      drawStarField(ctx, canvas.width, canvas.height, lowDetailRef.current);\r\n\r\n      // Draw region grid (10x10 layout for 100 regions)\r\n      if (selectedCoordinate) {\r\n        // Ensure fitted layout exists (fallback compute if needed)\r\n        const fittedLayout =\r\n          layoutRef.current ??\r\n          calculateFittedGridLayout(\r\n            canvas.width,\r\n            canvas.height,\r\n            GALAXY_LAYOUT.regionSize,\r\n            GALAXY_LAYOUT.padding,\r\n            GALAXY_LAYOUT.cols,\r\n            GALAXY_LAYOUT.rows\r\n          );\r\n        layoutRef.current = fittedLayout;\r\n\r\n        // Build cached grid and regions layers and compose them\r\n        const gridDeps = {\r\n          width: canvas.width,\r\n          height: canvas.height,\r\n          showGrid,\r\n          cols: GALAXY_LAYOUT.cols,\r\n          rows: GALAXY_LAYOUT.rows\r\n        };\r\n        const gridLayer = buildCachedLayer('galaxy:grid', gridDeps, layerCacheRef.current, () => {\r\n          const off = createOffscreenLayer(canvas.width, canvas.height);\r\n          drawToLayer(off, (gctx) => {\r\n            if (showGrid) {\r\n              drawGridLines(gctx, fittedLayout, GALAXY_LAYOUT.cols, GALAXY_LAYOUT.rows);\r\n            }\r\n          });\r\n          return off;\r\n        });\r\n\r\n        const regionsDeps = {\r\n          width: canvas.width,\r\n          height: canvas.height,\r\n          galaxyId: selectedCoordinate.galaxy,\r\n          showTerritories,\r\n          empireHash: computeEmpireTerritoryHash(empire),\r\n          starsHash: computeStarsHash(regionStarsByRegion)\r\n        };\r\n        const regionsLayer = buildCachedLayer('galaxy:regions', regionsDeps, layerCacheRef.current, () => {\r\n          const off = createOffscreenLayer(canvas.width, canvas.height);\r\n          drawToLayer(off, (rctx) => {\r\n            drawRegionsLayer(\r\n              rctx,\r\n              fittedLayout,\r\n              selectedCoordinate.galaxy,\r\n              showTerritories,\r\n              empire,\r\n              regionStarsByRegion\r\n            );\r\n          });\r\n          return off;\r\n        });\r\n\r\n        composeLayers(ctx, [gridLayer, regionsLayer]);\r\n      }\r\n\r\n      // FPS tracking (dev-guarded logging/overlay)\r\n      {\r\n        const now = (typeof performance !== 'undefined' ? performance.now() : Date.now());\r\n        const fps = perfMonitorRef.current ? perfMonitorRef.current.update(now) : 0;\r\n\r\n        // Adaptive complexity: degrade details when FPS drops\r\n        if (fps > 0) {\r\n          lowDetailRef.current = fps < 30;\r\n        }\r\n\r\n        // Optional on-canvas overlay when dev flag is enabled\r\n        if (enableFpsMonitor) {\r\n          ctx.fillStyle = 'rgba(0,255,0,0.85)';\r\n          ctx.font = '10px monospace';\r\n          ctx.textAlign = 'left';\r\n          ctx.fillText(`${fps} fps`, 8, 16);\r\n        }\r\n      }\r\n\r\n      animationRef.current = requestAnimationFrame(draw);\r\n    };\r\n\r\n    // Start RAF loop\r\n    draw();\r\n\r\n    // Cleanup on deps change/unmount\r\n    return () => {\r\n      running = false;\r\n      if (animationRef.current) {\r\n        cancelAnimationFrame(animationRef.current);\r\n        animationRef.current = null;\r\n      }\r\n    };\r\n  }, [canvas, selectedCoordinate, showGrid, showTerritories, empire, regionStarsByRegion, enableFpsMonitor]);\r\n\r\n  // Rebuild regions offscreen layer when data/props change\r\n  React.useEffect(() => {\r\n    const fitted = layoutRef.current;\r\n    if (!fitted || !selectedCoordinate) return;\r\n\r\n    const regionCanvas = document.createElement('canvas');\r\n    // We cannot access the canvas element here safely for width/height if not in scope; default to fitted totals + margins via current canvas\r\n    // Prefer to mirror main canvas size if available\r\n    const width = (typeof window !== 'undefined' ? (canvas?.width ?? Math.ceil(fitted.totalWidth + fitted.startX * 2)) : Math.ceil(fitted.totalWidth + fitted.startX * 2));\r\n    const height = (typeof window !== 'undefined' ? (canvas?.height ?? Math.ceil(fitted.totalHeight + fitted.startY * 2)) : Math.ceil(fitted.totalHeight + fitted.startY * 2));\r\n    regionCanvas.width = width;\r\n    regionCanvas.height = height;\r\n\r\n    const rctx = regionCanvas.getContext('2d');\r\n    if (rctx) {\r\n      drawRegionsLayer(\r\n        rctx,\r\n        fitted,\r\n        selectedCoordinate.galaxy,\r\n        showTerritories,\r\n        empire,\r\n        regionStarsByRegion\r\n      );\r\n    }\r\n    regionCanvasRef.current = regionCanvas;\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [selectedCoordinate?.galaxy, showTerritories, empire, regionStarsByRegion]);\r\n\r\n  // Cache hygiene: clear cached galaxy layers on dimension/flag changes\r\n  React.useEffect(() => {\r\n    clearLayerCache(layerCacheRef.current, (k) =>\r\n      k.startsWith('galaxy:grid') || k.startsWith('galaxy:regions')\r\n    );\r\n  }, [canvas.width, canvas.height, showGrid, showTerritories]);\r\n\r\n  return null; // This component only renders to canvas\r\n};\r\n\r\n\r\nconst drawStarField = (ctx: CanvasRenderingContext2D, width: number, height: number, lowDetail: boolean) => {\r\n  const time = Date.now() * 0.0001;\r\n  const centerX = width / 2;\r\n  const centerY = height / 2;\r\n  \r\n  // Draw spiral galaxy background\r\n  drawSpiralGalaxy(ctx, centerX, centerY, width, height, time, lowDetail);\r\n  \r\n  // Draw distant background stars\r\n  const starCount = lowDetail ? 150 : 300;\r\n  for (let i = 0; i < starCount; i++) {\r\n    const x = (i * 41) % width;\r\n    const y = (i * 67) % height;\r\n    const brightness = 0.2 + 0.5 * Math.sin(time + i * 0.15);\r\n    const size = 0.3 + 0.3 * Math.sin(time * 1.5 + i * 0.08);\r\n    \r\n    ctx.fillStyle = `rgba(255, 255, 255, ${brightness * 0.4})`;\r\n    ctx.fillRect(x, y, size, size);\r\n  }\r\n};\r\n\r\nconst drawSpiralGalaxy = (\r\n  ctx: CanvasRenderingContext2D,\r\n  centerX: number,\r\n  centerY: number,\r\n  width: number,\r\n  height: number,\r\n  time: number,\r\n  lowDetail: boolean\r\n) => {\r\n  const maxRadius = Math.min(width, height) * 0.4;\r\n  \r\n  // Draw galactic core\r\n  const coreGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, maxRadius * 0.2);\r\n  coreGradient.addColorStop(0, 'rgba(255, 255, 150, 0.8)');\r\n  coreGradient.addColorStop(0.3, 'rgba(255, 200, 100, 0.6)');\r\n  coreGradient.addColorStop(0.7, 'rgba(255, 150, 50, 0.3)');\r\n  coreGradient.addColorStop(1, 'rgba(255, 100, 0, 0.1)');\r\n  \r\n  ctx.fillStyle = coreGradient;\r\n  ctx.beginPath();\r\n  ctx.arc(centerX, centerY, maxRadius * 0.2, 0, Math.PI * 2);\r\n  ctx.fill();\r\n  \r\n  // Draw spiral arms\r\n  for (let arm = 0; arm < 4; arm++) {\r\n    drawSpiralArm(ctx, centerX, centerY, maxRadius, arm * Math.PI / 2, time);\r\n  }\r\n  \r\n  // Draw star clusters along spiral arms\r\n  const clusterCount = lowDetail ? 25 : 50;\r\n  for (let cluster = 0; cluster < clusterCount; cluster++) {\r\n    const angle = (cluster * 0.3 + time * 0.5) % (Math.PI * 2);\r\n    const radius = (cluster * 8) % maxRadius;\r\n    const spiralOffset = radius * 0.02; // Spiral effect\r\n    \r\n    const x = centerX + Math.cos(angle + spiralOffset) * radius;\r\n    const y = centerY + Math.sin(angle + spiralOffset) * radius;\r\n    \r\n    if (x > 0 && x < width && y > 0 && y < height) {\r\n      drawStarCluster(ctx, x, y, 3 + Math.random() * 4, time + cluster);\r\n    }\r\n  }\r\n};\r\n\r\nconst drawSpiralArm = (\r\n  ctx: CanvasRenderingContext2D,\r\n  centerX: number,\r\n  centerY: number,\r\n  maxRadius: number,\r\n  startAngle: number,\r\n  time: number\r\n) => {\r\n  ctx.strokeStyle = 'rgba(100, 150, 255, 0.3)';\r\n  ctx.lineWidth = 8;\r\n  ctx.beginPath();\r\n  \r\n  for (let r = maxRadius * 0.2; r < maxRadius; r += 2) {\r\n    const spiralTightness = 0.02;\r\n    const angle = startAngle + r * spiralTightness + time * 0.1;\r\n    const x = centerX + Math.cos(angle) * r;\r\n    const y = centerY + Math.sin(angle) * r;\r\n    \r\n    if (r === maxRadius * 0.2) {\r\n      ctx.moveTo(x, y);\r\n    } else {\r\n      ctx.lineTo(x, y);\r\n    }\r\n  }\r\n  \r\n  ctx.stroke();\r\n  \r\n  // Add nebula clouds along the arm\r\n  for (let i = 0; i < 10; i++) {\r\n    const r = maxRadius * 0.3 + (i * maxRadius * 0.07);\r\n    const spiralTightness = 0.02;\r\n    const angle = startAngle + r * spiralTightness + time * 0.1;\r\n    const x = centerX + Math.cos(angle) * r;\r\n    const y = centerY + Math.sin(angle) * r;\r\n    \r\n    const nebulaGradient = ctx.createRadialGradient(x, y, 0, x, y, 20);\r\n    nebulaGradient.addColorStop(0, 'rgba(255, 100, 150, 0.4)');\r\n    nebulaGradient.addColorStop(0.5, 'rgba(100, 150, 255, 0.2)');\r\n    nebulaGradient.addColorStop(1, 'rgba(100, 150, 255, 0)');\r\n    \r\n    ctx.fillStyle = nebulaGradient;\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, 20, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  }\r\n};\r\n\r\nconst drawStarCluster = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  size: number,\r\n  timeOffset: number\r\n) => {\r\n  const brightness = 0.6 + 0.4 * Math.sin(timeOffset * 0.5);\r\n  \r\n  // Main cluster glow\r\n  const clusterGradient = ctx.createRadialGradient(x, y, 0, x, y, size * 2);\r\n  clusterGradient.addColorStop(0, `rgba(255, 255, 200, ${brightness * 0.8})`);\r\n  clusterGradient.addColorStop(0.5, `rgba(255, 200, 150, ${brightness * 0.4})`);\r\n  clusterGradient.addColorStop(1, 'rgba(255, 200, 150, 0)');\r\n  \r\n  ctx.fillStyle = clusterGradient;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size * 2, 0, Math.PI * 2);\r\n  ctx.fill();\r\n  \r\n  // Bright core\r\n  ctx.fillStyle = `rgba(255, 255, 255, ${brightness})`;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size * 0.5, 0, Math.PI * 2);\r\n  ctx.fill();\r\n};\r\n\r\n/**\r\n * Draw only the grid lines using a fitted layout (used for off-screen caching).\r\n */\r\nconst drawGridLines = (\r\n  ctx: CanvasRenderingContext2D,\r\n  fitted: ReturnType<typeof calculateFittedGridLayout>,\r\n  cols: number,\r\n  rows: number\r\n) => {\r\n  const { startX, startY, itemSize, padding, totalWidth, totalHeight } = fitted;\r\n\r\n  ctx.strokeStyle = 'rgba(100, 100, 100, 0.4)';\r\n  ctx.lineWidth = 1;\r\n\r\n  // Vertical lines\r\n  for (let col = 0; col <= cols; col++) {\r\n    const x = startX + col * (itemSize + padding);\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, startY);\r\n    ctx.lineTo(x, startY + totalHeight);\r\n    ctx.stroke();\r\n  }\r\n\r\n  // Horizontal lines\r\n  for (let row = 0; row <= rows; row++) {\r\n    const y = startY + row * (itemSize + padding);\r\n    ctx.beginPath();\r\n    ctx.moveTo(startX, y);\r\n    ctx.lineTo(startX + totalWidth, y);\r\n    ctx.stroke();\r\n  }\r\n};\r\n\r\n/**\r\n * Draw dynamic regions + labels (no grid). Suitable for offscreen caching.\r\n */\r\nconst drawRegionsLayer = (\r\n  ctx: CanvasRenderingContext2D,\r\n  fitted: ReturnType<typeof calculateFittedGridLayout>,\r\n  galaxyId: number,\r\n  showTerritories: boolean,\r\n  empire: Empire,\r\n  regionStarsByRegion: Record<number, UniverseRegionSystemsData['systems']>\r\n) => {\r\n  const { startX, startY, itemSize, padding } = fitted;\r\n  const { cols } = GALAXY_LAYOUT;\r\n\r\n  // Clear before drawing\r\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n  // Draw regions\r\n  for (let regionId = 0; regionId < 100; regionId++) {\r\n    const row = Math.floor(regionId / cols);\r\n    const col = regionId % cols;\r\n\r\n    const x = startX + col * (itemSize + padding);\r\n    const y = startY + row * (itemSize + padding);\r\n\r\n    drawRegion(\r\n      ctx,\r\n      x,\r\n      y,\r\n      itemSize,\r\n      galaxyId,\r\n      regionId,\r\n      empire,\r\n      showTerritories,\r\n      regionStarsByRegion[regionId]\r\n    );\r\n  }\r\n\r\n  // Draw galaxy title\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n  ctx.font = 'bold 24px monospace';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText(`Galaxy ${galaxyId}`, ctx.canvas.width / 2, 40);\r\n\r\n  // Draw region labels\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\r\n  ctx.font = '10px monospace';\r\n  ctx.textAlign = 'center';\r\n\r\n  for (let regionId = 0; regionId < 100; regionId++) {\r\n    const row = Math.floor(regionId / cols);\r\n    const col = regionId % cols;\r\n\r\n    const x = startX + col * (itemSize + padding) + itemSize / 2;\r\n    const y = startY + row * (itemSize + padding) + itemSize + 12;\r\n\r\n    ctx.fillText(`R${regionId.toString().padStart(2, '0')}`, x, y);\r\n  }\r\n};\r\n\r\n\r\nconst drawRegion = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  size: number,\r\n  galaxyId: number,\r\n  regionId: number,\r\n  empire: Empire,\r\n  showTerritories: boolean,\r\n  systems: UniverseRegionSystemsData['systems'] = []\r\n) => {\r\n  // Draw region background\r\n  ctx.fillStyle = 'rgba(20, 20, 40, 0.3)';\r\n  ctx.fillRect(x, y, size, size);\r\n\r\n  // Draw star systems using actual DB data on a 10x10 mini-grid (aligned with RegionView)\r\n  const cols = 10;\r\n  const rows = 10;\r\n  const cellW = size / cols;\r\n  const cellH = size / rows;\r\n  const dotR = Math.max(0.8, Math.min(1.8, Math.min(cellW, cellH) * 0.18));\r\n\r\n  systems.forEach((sys) => {\r\n    const col = sys.system % cols;\r\n    const row = Math.floor(sys.system / cols);\r\n    const cx = x + col * cellW + cellW / 2;\r\n    const cy = y + row * cellH + cellH / 2;\r\n\r\n    // Resolve star color using server color if available, otherwise deterministic Overhaul StarKind\r\n    const star = (sys as any).star;\r\n    const kindColorMap: Record<string, string> = {\r\n      YELLOW: '#FFF4EA',\r\n      ORANGE: '#FFD2A1',\r\n      WHITE: '#CAD7FF',\r\n      BLUE: '#9BB0FF',\r\n      RED_GIANT: '#FF9E7B',\r\n      SUPER_GIANT: '#FFE29A',\r\n      WHITE_DWARF: '#E6F1FF',\r\n      NEUTRON: '#AFBFFF'\r\n    };\r\n    const sysCoord = (sys as any).coord as string | undefined;\r\n    // Ensure body component present for deterministic star (default to :00)\r\n    const coordForStar = sysCoord && sysCoord.split(':').length === 2 ? `${sysCoord}:00` : sysCoord;\r\n    const starKind = coordForStar ? pickStarKindFromCoord(coordForStar, 101) : undefined;\r\n    const baseHex = star?.color || (starKind ? kindColorMap[starKind] : undefined);\r\n    const color = baseHex ?? '#FFFFFF';\r\n\r\n    // Tiny colored dot + faint glow\r\n    const glow = ctx.createRadialGradient(cx, cy, 0, cx, cy, dotR * 3);\r\n    glow.addColorStop(0, hexToRgba(color, 0.55));\r\n    glow.addColorStop(1, hexToRgba(color, 0));\r\n    ctx.fillStyle = glow;\r\n    ctx.beginPath();\r\n    ctx.arc(cx, cy, dotR * 3, 0, Math.PI * 2);\r\n    ctx.fill();\r\n\r\n    ctx.fillStyle = color;\r\n    ctx.beginPath();\r\n    ctx.arc(cx, cy, dotR, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  });\r\n\r\n  // Show territory indicators if enabled\r\n  if (showTerritories) {\r\n    // Check if this region contains empire territories\r\n    const hasTerritory = empire.territories.some(coord => {\r\n      try {\r\n        const coordGalaxy = parseInt(coord.substring(1, 3), 10);\r\n        const coordRegion = parseInt(coord.substring(4, 6), 10);\r\n        return coordGalaxy === galaxyId && coordRegion === regionId;\r\n      } catch {\r\n        return false;\r\n      }\r\n    });\r\n\r\n    if (hasTerritory) {\r\n      // Draw territory indicator\r\n      ctx.strokeStyle = '#00ff00';\r\n      ctx.lineWidth = 2;\r\n      ctx.strokeRect(x + 1, y + 1, size - 2, size - 2);\r\n      \r\n      // Add empire flag\r\n      ctx.fillStyle = '#00ff00';\r\n      ctx.fillRect(x + size - 8, y + 2, 6, 4);\r\n    }\r\n  }\r\n\r\n  // Draw region border\r\n  ctx.strokeStyle = 'rgba(100, 150, 255, 0.3)';\r\n  ctx.lineWidth = 1;\r\n  ctx.strokeRect(x, y, size, size);\r\n\r\n  // Add hover effect (simplified - would need mouse position)\r\n  const isHovered = false; // TODO: Implement hover detection\r\n  if (isHovered) {\r\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';\r\n    ctx.lineWidth = 2;\r\n    ctx.strokeRect(x - 1, y - 1, size + 2, size + 2);\r\n  }\r\n};\r\n\r\n\r\n\r\n// Local helper\r\nconst hexToRgba = (hex: string, alpha: number) => {\r\n  try {\r\n    const h = hex.replace('#', '');\r\n    const normalized = h.length === 3 ? h.split('').map(ch => ch + ch).join('') : h;\r\n    const bigint = parseInt(normalized, 16);\r\n    const r = (bigint >> 16) & 255;\r\n    const g = (bigint >> 8) & 255;\r\n    const b = bigint & 255;\r\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n  } catch {\r\n    return `rgba(255, 255, 255, ${alpha})`;\r\n  }\r\n};\r\n\r\n// Click handling function for galaxy view\r\nexport const handleGalaxyViewClick = (\r\n  clickX: number,\r\n  clickY: number,\r\n  canvasWidth: number,\r\n  canvasHeight: number\r\n): number | null => {\r\n  const { regionSize, padding, cols, rows } = GALAXY_LAYOUT;\r\n  const fitted = calculateFittedGridLayout(canvasWidth, canvasHeight, regionSize, padding, cols, rows);\r\n  \r\n  return getClickedIndex(\r\n    clickX,\r\n    clickY,\r\n    fitted.startX,\r\n    fitted.startY,\r\n    fitted.itemSize,\r\n    fitted.padding,\r\n    cols,\r\n    rows,\r\n    fitted.totalWidth,\r\n    fitted.totalHeight\r\n  );\r\n};\r\n\r\nexport default GalaxyView;\r\n","import React from 'react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport useUniverseMapStore from '../../stores/universeMapStore';\r\nimport NavigationBreadcrumb from './map/NavigationBreadcrumb';\r\nimport UniverseMap from './UniverseMap';\r\n\r\nconst GalaxyPage: React.FC = () => {\r\n  const { empire } = useAuthStore();\r\n  const { selectedCoordinate, zoomLevel, navigateToUniverse, navigateToGalaxy, navigateToRegion } = useUniverseMapStore();\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"game-card\">\r\n        <NavigationBreadcrumb\r\n          selectedCoordinate={selectedCoordinate}\r\n          zoomLevel={zoomLevel}\r\n          onUniverse={navigateToUniverse}\r\n          onGalaxy={navigateToGalaxy}\r\n          onRegion={navigateToRegion}\r\n        />\r\n      </div>\r\n\r\n      {empire ? (\r\n        <div className=\"game-card p-0 h-[75vh] overflow-hidden\">\r\n          <UniverseMap empire={empire} />\r\n        </div>\r\n      ) : (\r\n        <div className=\"game-card border-2 border-yellow-500\">\r\n          <p className=\"text-yellow-300\">\r\n            You need to create an empire before using the universe map.\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GalaxyPage;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { useNavigate, useParams, Link } from 'react-router-dom';\r\nimport { isValidCoordinate, parseCoord } from '@game/shared';\r\nimport useUniverseMapStore from '../../stores/universeMapStore';\r\nimport universeService, { UniverseLocationData } from '../../services/universeService';\r\n\r\nconst PlanetPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { coord } = useParams<{ coord: string }>();\r\n  const { navigateToUniverse, navigateToGalaxy, navigateToRegion, navigateToSystem } = useUniverseMapStore();\r\n\r\n  const isValid = !!coord && isValidCoordinate(coord);\r\n  const components = useMemo(() => (isValid ? parseCoord(coord!) : null), [coord, isValid]);\r\n\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [data, setData] = useState<UniverseLocationData | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!isValid) {\r\n      setLoading(false);\r\n      setError('Invalid coordinate format. Expected A00:10:22:10');\r\n      return;\r\n    }\r\n    let mounted = true;\r\n    setLoading(true);\r\n    setError(null);\r\n    universeService.getLocationByCoord(coord!)\r\n      .then((res) => {\r\n        if (!mounted) return;\r\n        if (res.success && res.data) {\r\n          setData(res.data);\r\n        } else {\r\n          setError(res.error || 'Unable to load data.');\r\n        }\r\n      })\r\n      .catch(() => {\r\n        if (mounted) setError('Network error occurred while loading data.');\r\n      })\r\n      .finally(() => {\r\n        if (mounted) setLoading(false);\r\n      });\r\n    return () => { mounted = false; };\r\n  }, [coord, isValid]);\r\n\r\n  const goUniverse = () => {\r\n    navigateToUniverse();\r\n    navigate('/galaxy');\r\n  };\r\n  const goGalaxy = () => {\r\n    if (!components) return;\r\n    navigateToGalaxy(components.galaxy);\r\n    navigate('/galaxy');\r\n  };\r\n  const goRegion = () => {\r\n    if (!components) return;\r\n    navigateToRegion(components.galaxy, components.region);\r\n    navigate('/galaxy');\r\n  };\r\n  const goSystem = () => {\r\n    if (!components) return;\r\n    navigateToSystem(components.galaxy, components.region, components.system);\r\n    navigate('/galaxy');\r\n  };\r\n\r\n  const planetVisualStyle = useMemo<React.CSSProperties>(() => {\r\n    const type = data?.type || 'planet';\r\n    // Type-based color themes\r\n    const themes: Record<string, string> = {\r\n      terrestrial: 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, #487a3a 21%, #2b4f28 60%, #132515 100%)',\r\n      gas_giant: 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.15) 18%, #7a62b7 20%, #4f3a8a 58%, #2a174f 100%)',\r\n      ice: 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.4) 22%, #78a9d6 23%, #3c6d99 60%, #1c3550 100%)',\r\n      desert: 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 18%, #e0b34a 20%, #a97a2a 60%, #5e3b10 100%)',\r\n      volcanic: 'radial-gradient(circle at 30% 30%, rgba(255,200,200,0.7), rgba(255,200,200,0.2) 20%, #cc2b2b 22%, #7a1e1e 60%, #330d0d 100%)',\r\n      planet: 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, rgba(40,80,140,1) 21%, rgba(20,40,80,1) 60%, rgba(10,20,40,1) 100%)',\r\n      asteroid: 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.2) 18%, #7b6f62 20%, #4a423b 60%, #26221e 100%)',\r\n      star: 'radial-gradient(circle at 30% 30%, rgba(255,255,200,0.9), rgba(255,255,200,0.4) 22%, #ffd27a 24%, #e0a53a 60%, #8a5a0a 100%)',\r\n    };\r\n    const background = (themes[type] || themes.planet);\r\n    return {\r\n      background,\r\n      boxShadow: '0 0 40px rgba(100,150,255,0.3), inset 0 0 30px rgba(0,0,0,0.6)'\r\n    };\r\n  }, [data]);\r\n\r\n  // Type-aware display labels derived from API type and coordinate\r\n  const bodyLabel = components ? components.body.toString().padStart(2, '0') : '';\r\n  const apiType = data?.type; // 'planet' | 'asteroid' | 'star' | undefined\r\n  const inferredType = apiType ?? (components?.body === 0 ? 'star' : undefined);\r\n  const displayType =\r\n    inferredType ?? ((loading || !!error) ? 'body' : 'body'); // generic fallback to avoid misleading labels\r\n  const displayName =\r\n    displayType === 'star'\r\n      ? 'Star'\r\n      : displayType === 'planet'\r\n      ? `Planet ${bodyLabel}`\r\n      : displayType === 'asteroid'\r\n      ? `Asteroid ${bodyLabel}`\r\n      : (components ? `Body ${bodyLabel}` : 'Body');\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header with breadcrumbs */}\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-white\">\r\n              {displayName}\r\n            </h1>\r\n            <p className=\"text-sm text-gray-400\">\r\n              {isValid ? `A${components!.galaxy.toString().padStart(2, '0')}:${components!.region\r\n                .toString()\r\n                .padStart(2, '0')}:${components!.system.toString().padStart(2, '0')}:${components!.body\r\n                .toString()\r\n                .padStart(2, '0')}` : coord || 'Unknown'}\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600\"\r\n              onClick={() => navigate(-1)}\r\n              title=\"Go Back\"\r\n            >\r\n               Back\r\n            </button>\r\n            <button\r\n              className=\"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n              onClick={goSystem}\r\n              title=\"Back to System\"\r\n            >\r\n               System\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Breadcrumbs */}\r\n        {components && (\r\n          <div className=\"flex flex-wrap items-center gap-2 text-sm\">\r\n            <button className=\"text-blue-400 hover:text-blue-200\" onClick={goUniverse}>Universe</button>\r\n            <span className=\"text-gray-500\"></span>\r\n            <button className=\"text-blue-400 hover:text-blue-200\" onClick={goGalaxy}>\r\n              Galaxy C{components.galaxy.toString().padStart(2, '0')}\r\n            </button>\r\n            <span className=\"text-gray-500\"></span>\r\n            <button className=\"text-blue-400 hover:text-blue-200\" onClick={goRegion}>\r\n              Region {components.region.toString().padStart(2, '0')}\r\n            </button>\r\n            <span className=\"text-gray-500\"></span>\r\n            <button className=\"text-blue-400 hover:text-blue-200\" onClick={goSystem}>\r\n              System {components.system.toString().padStart(2, '0')}\r\n            </button>\r\n            <span className=\"text-gray-500\"></span>\r\n            <span className=\"text-gray-300\">{displayName}</span>\r\n          </div>\r\n        )}\r\n\r\n        {!isValid && (\r\n          <div className=\"mt-3 text-red-400\">\r\n            Invalid coordinate format. Expected A00:10:22:10\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {/* Planet Visual */}\r\n        <div className=\"game-card flex items-center justify-center\">\r\n          <div\r\n            className=\"w-64 h-64 md:w-80 md:h-80 rounded-full shadow-lg\"\r\n            style={planetVisualStyle}\r\n            aria-label=\"Planet preview\"\r\n          />\r\n        </div>\r\n\r\n        {/* Planet Details */}\r\n        <div className=\"game-card\">\r\n          <h2 className=\"text-xl font-semibold text-white mb-4\">\r\n            {displayType === 'star'\r\n              ? 'Star Information'\r\n              : displayType === 'planet'\r\n              ? 'Planet Information'\r\n              : displayType === 'asteroid'\r\n              ? 'Asteroid Information'\r\n              : 'Body Information'}\r\n          </h2>\r\n\r\n          {loading ? (\r\n            <div className=\"text-gray-400\">Loading data...</div>\r\n          ) : error ? (\r\n            <div className=\"text-red-400\">{error}</div>\r\n          ) : (\r\n            <div className=\"space-y-2 text-gray-300\">\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-400\">Type</span>\r\n                <span className=\"text-white\">{data?.type ?? ''}</span>\r\n              </div>\r\n              <div className=\"flex justify-between\">\r\n                <span className=\"text-gray-400\">Owner</span>\r\n                <span className=\"text-white\">{data?.owner?.username ?? 'Unclaimed'}</span>\r\n              </div>\r\n\r\n              {/* Overhaul data (terrain/orbit/solar/fertility/yields/area; star info if available) */}\r\n              {(data?.terrain || typeof data?.orbitPosition === 'number' || data?.result) && (\r\n                <>\r\n                  {data?.terrain?.type && (\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-400\">Terrain</span>\r\n                      <span className=\"text-white\">{data.terrain.type}</span>\r\n                    </div>\r\n                  )}\r\n                  {typeof data?.orbitPosition === 'number' && (\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-400\">Orbit Pos</span>\r\n                      <span className=\"text-white\">{data.orbitPosition}</span>\r\n                    </div>\r\n                  )}\r\n                  {typeof data?.result?.solarEnergy === 'number' && (\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-400\">Solar Energy</span>\r\n                      <span className=\"text-white\">{data.result.solarEnergy}</span>\r\n                    </div>\r\n                  )}\r\n                  {typeof data?.result?.fertility === 'number' && (\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-400\">Fertility</span>\r\n                      <span className=\"text-white\">{data.result.fertility}</span>\r\n                    </div>\r\n                  )}\r\n                  {data?.result?.yields && (\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-400\">Yields (M/G/C)</span>\r\n                      <span className=\"text-white\">\r\n                        {data.result.yields.metal}/{data.result.yields.gas}/{data.result.yields.crystals}\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                  {typeof data?.result?.area === 'number' && (\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-400\">Area</span>\r\n                      <span className=\"text-white\">{data.result.area}</span>\r\n                    </div>\r\n                  )}\r\n                  {data?.starOverhaul?.kind && (\r\n                    <div className=\"flex justify-between\">\r\n                      <span className=\"text-gray-400\">Star Kind</span>\r\n                      <span className=\"text-white\">{data.starOverhaul.kind}</span>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n\r\n              {/* Star properties (fallback if coord points to star) */}\r\n              {data?.starProperties && (\r\n                <div className=\"mt-3 text-sm text-gray-400\">\r\n                  Star: class {data.starProperties.spectralClass}, {data.starProperties.temperatureK}K\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Bases / Action area */}\r\n      {data?.owner ? (\r\n        <div className=\"game-card\">\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm\">\r\n              <thead className=\"bg-gradient-to-r from-indigo-900/60 to-indigo-700/40 border border-indigo-500/60\">\r\n                <tr>\r\n                  <th className=\"px-3 py-2 text-left text-gray-200\">Base</th>\r\n                  <th className=\"px-3 py-2 text-left text-gray-200\">Owner</th>\r\n                  <th className=\"px-3 py-2 text-left text-gray-200\">Occupier</th>\r\n                  <th className=\"px-3 py-2 text-right text-gray-200\">Economy</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"border border-indigo-500/40\">\r\n                <tr className=\"border-t border-indigo-500/30\">\r\n                  <td className=\"px-3 py-2\">\r\n                    <Link\r\n                      to={`/base/${encodeURIComponent(coord!)}`}\r\n                      className=\"text-blue-300 underline decoration-dotted hover:text-blue-200\"\r\n                      title=\"Open base page\"\r\n                    >\r\n                      Home Planet h\r\n                    </Link>\r\n                  </td>\r\n                  <td className=\"px-3 py-2 text-empire-gold\">\r\n                    {data?.owner?.username ?? ''}\r\n                  </td>\r\n                  <td className=\"px-3 py-2 text-gray-300\"></td>\r\n                  <td className=\"px-3 py-2 text-right text-yellow-300 font-mono\">0 / 0</td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"mt-3 text-center\">\r\n            <span className=\"text-yellow-300 hover:text-yellow-200 cursor-default\">\r\n              Move fleet here\r\n            </span>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"game-card\">\r\n          <div className=\"py-4 text-center\">\r\n            <span className=\"text-yellow-300 hover:text-yellow-200 cursor-default\">\r\n              Move fleet here\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PlanetPage;\r\n","import axios from 'axios';\r\nimport { attachMetrics } from './httpInstrumentation';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: { 'Content-Type': 'application/json' },\r\n});\r\n\r\nattachMetrics(api, 'base-stats');\r\n\r\n// Auth token\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem('auth-storage');\r\n  if (token) {\r\n    try {\r\n      const parsed = JSON.parse(token);\r\n      if (parsed.state?.token) {\r\n        (config.headers as any).Authorization = `Bearer ${parsed.state.token}`;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing auth token', e);\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\n// 401 handling\r\napi.interceptors.response.use(\r\n  (r) => r,\r\n  (error) => {\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem('auth-storage');\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport interface BaseStatsDTO {\r\n  area: { total: number; used: number; free: number };\r\n  energy: { produced: number; consumed: number; balance: number };\r\n  population: { used: number; capacity: number; free: number };\r\n  ownerIncomeCredPerHour: number;\r\n}\r\n\r\nexport interface ApiResponse<T = any> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: string;\r\n  message?: string;\r\n}\r\n\r\n// In-flight request coalescing (prevents parallel identical GETs from fanning out)\r\nconst inflightBaseStats = new Map<string, Promise<ApiResponse<{ stats: BaseStatsDTO }>>>();\r\n\r\nexport const baseStatsService = {\r\n  async get(coord: string): Promise<ApiResponse<{ stats: BaseStatsDTO }>> {\r\n    const key = `base-stats:${coord}`;\r\n\r\n    const existing = inflightBaseStats.get(key);\r\n    if (existing) {\r\n      return existing;\r\n    }\r\n\r\n    const requestPromise = (async () => {\r\n      try {\r\n        const res = await api.get<ApiResponse<{ stats: BaseStatsDTO }>>(\r\n          `/game/base-stats/${encodeURIComponent(coord)}`\r\n        );\r\n        return res.data;\r\n      } finally {\r\n        inflightBaseStats.delete(key);\r\n      }\r\n    })();\r\n\r\n    inflightBaseStats.set(key, requestPromise);\r\n    return requestPromise;\r\n  },\r\n};\r\n\r\nexport default baseStatsService;\r\n","import React, { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\nimport baseStatsService from '../../services/baseStatsService';\r\nimport { Link } from 'react-router-dom';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\ntype Economy = {\r\n  metalPerHour: number;\r\n  energyPerHour: number;\r\n  researchPerHour: number;\r\n};\r\n\r\ntype BaseSummary = {\r\n  baseId: string;\r\n  name: string;\r\n  location: string;\r\n  economy: Economy;\r\n  occupier: null | { empireId: string; name: string };\r\n  construction: { queued: number; next?: { name: string; remaining: number; percent?: number } };\r\n  production: { queued: number; next?: { name: string; remaining: number; percent?: number } };\r\n  research: null | { name: string; remaining: number; percent?: number };\r\n};\r\n\r\ntype BaseEcon = { owner: number; base: number };\r\n\r\ninterface BaseEventsTableProps {\r\n  onRowClick?: (baseId: string) => void;\r\n}\r\n\r\n// Local axios instance with auth header injection (mirrors pattern in BaseManagement)\r\nconst createAuthenticatedApi = () => {\r\n  const api = axios.create({\r\n    baseURL: API_BASE_URL,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n  });\r\n\r\n  api.interceptors.request.use((config) => {\r\n    const token = localStorage.getItem('auth-storage');\r\n    if (token) {\r\n      try {\r\n        const parsed = JSON.parse(token);\r\n        if (parsed.state?.token) {\r\n          config.headers = config.headers || {};\r\n          (config.headers as any).Authorization = `Bearer ${parsed.state.token}`;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error parsing auth token:', error);\r\n      }\r\n    }\r\n    return config;\r\n  });\r\n\r\n  api.interceptors.response.use(\r\n    (response) => response,\r\n    (error) => {\r\n      if (error.response?.status === 401) {\r\n        localStorage.removeItem('auth-storage');\r\n        window.location.href = '/login';\r\n      }\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n\r\n  return api;\r\n};\r\n\r\n/**\r\n * Formats a remaining duration in milliseconds into a compact H/M display:\r\n * - If minutes >= 60: \"Hh MMm\"\r\n * - Else: \"Mm\"\r\n * - Floors to minimum 1 minute when > 0 to avoid displaying 0m\r\n */\r\nfunction formatRemainingMs(ms: number): string {\r\n  const totalSeconds = Math.max(0, Math.floor(ms / 1000));\r\n  let minutes = Math.floor(totalSeconds / 60);\r\n  if (totalSeconds > 0 && minutes === 0) minutes = 1; // minimum 1m when > 0\r\n  const hours = Math.floor(minutes / 60);\r\n  const remMins = minutes % 60;\r\n\r\n  if (hours >= 1) {\r\n    const mm = remMins.toString().padStart(2, '0');\r\n    return `${hours}h ${mm}m`;\r\n  }\r\n  return `${minutes}m`;\r\n}\r\n\r\n// Simple progress bar with color variants: green (construction), purple (research), red (production)\r\nconst ProgressBar: React.FC<{ percent: number; color: 'green' | 'purple' | 'red' }> = ({ percent, color }) => {\r\n  const barColor =\r\n    color === 'green' ? 'bg-green-500' :\r\n    color === 'purple' ? 'bg-purple-500' :\r\n    'bg-red-500';\r\n  const trackColor =\r\n    color === 'green' ? 'bg-green-900/40' :\r\n    color === 'purple' ? 'bg-purple-900/40' :\r\n    'bg-red-900/40';\r\n\r\n  const pct = Math.min(100, Math.max(0, Math.floor(percent)));\r\n\r\n  return (\r\n    <div className={`h-2 w-40 sm:w-48 rounded ${trackColor}`}>\r\n      <div className={`h-2 rounded ${barColor}`} style={{ width: `${pct}%` }} />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst BaseEventsTable: React.FC<BaseEventsTableProps> = ({ onRowClick }) => {\r\n  const [items, setItems] = useState<BaseSummary[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [econMap, setEconMap] = useState<Record<string, BaseEcon>>({});\r\n\r\n  const api = createAuthenticatedApi();\r\n\r\n  const fetchSummary = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await api.get('/game/bases/summary');\r\n      if (res.data?.success) {\r\n        const bases: BaseSummary[] = res.data.data?.bases || [];\r\n        setItems(bases);\r\n        await fetchBaseEcon(bases);\r\n      } else {\r\n        setError(res.data?.error || 'Failed to load base summaries');\r\n      }\r\n    } catch (e: any) {\r\n      console.error('Error fetching base summaries:', e);\r\n      setError('Failed to load base summaries. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchSummary();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const fetchBaseEcon = async (bases: BaseSummary[]) => {\r\n    try {\r\n      const entries = await Promise.all(\r\n        bases.map(async (b) => {\r\n          try {\r\n            const res = await baseStatsService.get(b.location);\r\n            const ownerIncome = Math.round(res.data?.stats.ownerIncomeCredPerHour ?? 0);\r\n            const baseEconomy = ownerIncome; // Phase A: same as owner income; will diverge when occupation affects owner income\r\n            return [b.location, { owner: ownerIncome, base: baseEconomy }] as const;\r\n          } catch {\r\n            return [b.location, { owner: 0, base: 0 }] as const;\r\n          }\r\n        })\r\n      );\r\n      const map: Record<string, BaseEcon> = {};\r\n      entries.forEach(([loc, econ]) => {\r\n        map[loc] = econ;\r\n      });\r\n      setEconMap(map);\r\n    } catch {\r\n      // swallow; UI will show 0/0\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h3 className=\"text-lg font-semibold text-empire-gold\">Bases Events</h3>\r\n        </div>\r\n        <div className=\"flex items-center justify-center py-8\">\r\n          <div className=\"text-center\">\r\n            <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto mb-3\"></div>\r\n            <p className=\"text-gray-400\">Loading base events...</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h3 className=\"text-lg font-semibold text-empire-gold\">Bases Events</h3>\r\n          <button onClick={fetchSummary} className=\"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\">Refresh</button>\r\n        </div>\r\n        <div className=\"text-center\">\r\n          <div className=\"text-red-400 mb-4\"> {error}</div>\r\n          <button onClick={fetchSummary} className=\"game-button\">Retry</button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"game-card\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Bases Events</h3>\r\n        <button onClick={fetchSummary} className=\"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\">Refresh</button>\r\n      </div>\r\n\r\n      {items.length === 0 ? (\r\n        <div className=\"text-center py-6 text-gray-400\">No bases found.</div>\r\n      ) : (\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"text-gray-300 border-b border-gray-700\">\r\n                <th className=\"py-2 px-3 text-left\">Base</th>\r\n                <th className=\"py-2 px-3 text-left\">Location</th>\r\n                <th className=\"py-2 px-3 text-left\">Economy</th>\r\n                <th className=\"py-2 px-3 text-left\">Occupier</th>\r\n                <th className=\"py-2 px-3 text-left\">Construction</th>\r\n                <th className=\"py-2 px-3 text-left\">Production</th>\r\n                <th className=\"py-2 px-3 text-left\">Research</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {items.map((b) => {\r\n                const econData = econMap[b.location];\r\n                const owner = Math.round(econData?.owner ?? 0);\r\n                const base = Math.round(econData?.base ?? 0);\r\n                const econ = `${owner} / ${base}`;\r\n                const occupier = b.occupier ? (b.occupier.name || 'Occupied') : '';\r\n                const construction = (b.construction.next && b.construction.queued > 0)\r\n                  ? `${b.construction.next.name} (${formatRemainingMs(b.construction.next.remaining)})`\r\n                  : `(${b.construction.queued})`;\r\n                const production = (b.production.next && b.production.queued > 0)\r\n                  ? `${b.production.next.name} (${formatRemainingMs(b.production.next.remaining)})`\r\n                  : `(${b.production.queued})`;\r\n                const researchWaiting = !!b.research && (b.research.remaining <= 0);\r\n                const researchText = b.research\r\n                  ? (researchWaiting\r\n                      ? `${b.research.name} (waiting)`\r\n                      : `${b.research.name} (${formatRemainingMs(b.research.remaining)})`)\r\n                  : '';\r\n                return (\r\n                  <tr\r\n                    key={b.baseId}\r\n                    className=\"border-b border-gray-800 hover:bg-gray-800/60 cursor-pointer\"\r\n                    onClick={() => onRowClick?.(b.baseId)}\r\n                  >\r\n                    <td className=\"py-2 px-3 text-white\">{b.name}</td>\r\n                    <td className=\"py-2 px-3 font-mono text-gray-300\">{b.location}</td>\r\n                    <td className=\"py-2 px-3 text-gray-200\">{econ}</td>\r\n                    <td className=\"py-2 px-3\">\r\n                      <span className={b.occupier ? 'text-yellow-400' : 'text-gray-400'}>{occupier}</span>\r\n                    </td>\r\n                    <td className=\"py-2 px-3\">\r\n                      <div className=\"flex flex-col gap-1\">\r\n                        <Link\r\n                          to={`/base/${encodeURIComponent(b.location)}?tab=structures`}\r\n                          onClick={(e) => e.stopPropagation()}\r\n                          className={(b.construction.queued > 0 ? 'text-yellow-400' : 'text-gray-400') + ' hover:text-yellow-300'}\r\n                          aria-label={`View structures for ${b.name}`}\r\n                        >\r\n                          {construction}\r\n                        </Link>\r\n                        {typeof b.construction.next?.percent === 'number' ? (\r\n                          <ProgressBar percent={b.construction.next.percent!} color=\"green\" />\r\n                        ) : null}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"py-2 px-3\">\r\n                      <div className=\"flex flex-col gap-1\">\r\n                        <Link\r\n                          to={`/base/${encodeURIComponent(b.location)}?tab=fleets`}\r\n                          onClick={(e) => e.stopPropagation()}\r\n                          className={(b.production.queued > 0 ? 'text-yellow-400' : 'text-gray-400') + ' hover:text-yellow-300'}\r\n                          aria-label={`View fleets for ${b.name}`}\r\n                        >\r\n                          {production}\r\n                        </Link>\r\n                        {typeof b.production.next?.percent === 'number' && (b.production.next?.remaining || 0) > 0 ? (\r\n                          <ProgressBar percent={b.production.next!.percent!} color=\"red\" />\r\n                        ) : null}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"py-2 px-3 text-gray-200\">\r\n                      <div className=\"flex flex-col gap-1\">\r\n                        <Link\r\n                          to={`/base/${encodeURIComponent(b.location)}?tab=research`}\r\n                          onClick={(e) => e.stopPropagation()}\r\n                          className=\"hover:text-yellow-300\"\r\n                          aria-label={`View research for ${b.name}`}\r\n                        >\r\n                          {researchText}\r\n                        </Link>\r\n                        {typeof b.research?.percent === 'number' && !researchWaiting ? (\r\n                          <ProgressBar percent={b.research.percent!} color=\"purple\" />\r\n                        ) : null}\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BaseEventsTable;\r\n","import React from 'react';\r\nimport { Empire } from '@game/shared';\r\nimport BaseEventsTable from './BaseEventsTable';\r\n\r\ninterface BaseOverviewProps {\r\n  bases: any[];\r\n  empire: Empire;\r\n  onBaseSelect: (baseId: string) => void;\r\n  onUpdate: () => void;\r\n}\r\n\r\nconst BaseOverview: React.FC<BaseOverviewProps> = ({ \r\n  bases, \r\n  onBaseSelect, \r\n  onUpdate \r\n}) => {\r\n\r\n  if (bases.length === 0) {\r\n    return (\r\n      <div className=\"game-card text-center\">\r\n        <div className=\"py-12\">\r\n          <div className=\"text-6xl mb-4\"></div>\r\n          <h3 className=\"text-xl font-semibold mb-2 text-gray-300\">No Bases Found</h3>\r\n          <p className=\"text-gray-400 mb-6\">\r\n            You haven't established any bases yet. Start by colonizing a location to build your first base.\r\n          </p>\r\n          <button \r\n            onClick={onUpdate}\r\n            className=\"game-button\"\r\n          >\r\n            Refresh Bases\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n\r\n\r\n      {/* Bases Events Summary Table */}\r\n      <BaseEventsTable onRowClick={onBaseSelect} />\r\n\r\n\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BaseOverview;\r\n","import api, { ApiError } from \"./api\";\r\nimport { ApiResponse, TechnologyKey, TechnologySpec } from \"@game/shared\";\r\n\r\nexport interface TechStatusDTO {\r\n  techLevels: Partial<Record<TechnologyKey, number>>;\r\n  baseLabTotal: number;\r\n  eligibility: Record<TechnologyKey, { canStart: boolean; reasons: string[] }>;\r\n  credits: number;\r\n}\r\n\r\nfunction isApiErrorLike(err: unknown): err is ApiError {\r\n  return (\r\n    !!err &&\r\n    typeof err === \"object\" &&\r\n    typeof (err as any).code === \"string\" &&\r\n    typeof (err as any).message === \"string\"\r\n  );\r\n}\r\n\r\nexport const techService = {\r\n  async getCatalog(): Promise<ApiResponse<{ catalog: TechnologySpec[] }>> {\r\n    try {\r\n      const res = await api.get<ApiResponse<{ catalog: TechnologySpec[] }>>(\r\n        \"/game/tech/catalog\"\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<{ catalog: TechnologySpec[] }>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<{ catalog: TechnologySpec[] }>;\r\n    }\r\n  },\r\n\r\n  async getStatus(\r\n    baseCoord: string\r\n  ): Promise<ApiResponse<{ status: TechStatusDTO }>> {\r\n    try {\r\n      const res = await api.get<ApiResponse<{ status: TechStatusDTO }>>(\r\n        `/game/tech/status`,\r\n        { params: { base: baseCoord } }\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<{ status: TechStatusDTO }>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<{ status: TechStatusDTO }>;\r\n    }\r\n  },\r\n\r\n  async start(\r\n    locationCoord: string,\r\n    techKey: TechnologyKey\r\n  ): Promise<ApiResponse<any>> {\r\n    try {\r\n      const res = await api.post<ApiResponse<any>>(\"/game/tech/start\", {\r\n        locationCoord,\r\n        techKey,\r\n      });\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        // Soft-path for idempotency conflicts: return error data instead of throwing\r\n        if (\r\n          err.code === \"ALREADY_IN_PROGRESS\" ||\r\n          err.status === 409 ||\r\n          err.code === \"HTTP_409\"\r\n        ) {\r\n          return {\r\n            success: false,\r\n            code: err.code,\r\n            message: err.message,\r\n            details: err.details,\r\n            reasons:\r\n              (err.details && (err.details.reasons as string[] | undefined)) ||\r\n              undefined,\r\n          } as ApiResponse<any>;\r\n        }\r\n        // Other errors: bubble for global handling\r\n        throw err;\r\n      }\r\n      // Unknown error\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<any>;\r\n    }\r\n  },\r\n\r\n  async getQueue(baseCoord?: string): Promise<ApiResponse<{ queue: any[] }>> {\r\n    try {\r\n      const params = baseCoord ? { base: baseCoord } : undefined;\r\n      const res = await api.get<ApiResponse<{ queue: any[] }>>(\r\n        \"/game/tech/queue\",\r\n        { params }\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<{ queue: any[] }>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<{ queue: any[] }>;\r\n    }\r\n  },\r\n\r\n  async cancelQueueItem(\r\n    id: string\r\n  ): Promise<ApiResponse<{ cancelledId: string; refundedCredits: number | null }>> {\r\n    try {\r\n      const res = await api.delete<\r\n        ApiResponse<{ cancelledId: string; refundedCredits: number | null }>\r\n      >(`/game/tech/queue/${encodeURIComponent(id)}`);\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<{ cancelledId: string; refundedCredits: number | null }>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<{ cancelledId: string; refundedCredits: number | null }>;\r\n    }\r\n  },\r\n};\r\n\r\nexport default techService;\r\n","import api, { ApiError } from \"./api\";\r\nimport { ApiResponse, BuildingKey, BuildingSpec } from \"@game/shared\";\r\n\r\n// DTOs\r\nexport interface StructuresStatusDTO {\r\n  techLevels: Record<string, number>;\r\n  eligibility: Record<\r\n    BuildingKey,\r\n    {\r\n      canStart: boolean;\r\n      reasons: string[];\r\n    }\r\n  >;\r\n}\r\n\r\nfunction isApiErrorLike(err: unknown): err is ApiError {\r\n  return (\r\n    !!err &&\r\n    typeof err === \"object\" &&\r\n    typeof (err as any).code === \"string\" &&\r\n    typeof (err as any).message === \"string\"\r\n  );\r\n}\r\n\r\nexport const structuresService = {\r\n  async getCatalog(): Promise<ApiResponse<{ catalog: BuildingSpec[] }>> {\r\n    try {\r\n      const res = await api.get<ApiResponse<{ catalog: BuildingSpec[] }>>(\r\n        \"/game/structures/catalog\"\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<{ catalog: BuildingSpec[] }>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<{ catalog: BuildingSpec[] }>;\r\n    }\r\n  },\r\n\r\n  async getStatus(): Promise<ApiResponse<{ status: StructuresStatusDTO }>> {\r\n    try {\r\n      const res = await api.get<ApiResponse<{ status: StructuresStatusDTO }>>(\r\n        \"/game/structures/status\"\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<{ status: StructuresStatusDTO }>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<{ status: StructuresStatusDTO }>;\r\n    }\r\n  },\r\n\r\n  async start(\r\n    locationCoord: string,\r\n    buildingKey: BuildingKey\r\n  ): Promise<ApiResponse<any>> {\r\n    try {\r\n      const res = await api.post<ApiResponse<any>>(\"/game/structures/start\", {\r\n        locationCoord,\r\n        buildingKey,\r\n      });\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        // Soft-path for idempotency conflicts: return error data instead of throwing\r\n        if (\r\n          err.code === \"ALREADY_IN_PROGRESS\" ||\r\n          err.status === 409 ||\r\n          err.code === \"HTTP_409\"\r\n        ) {\r\n          return {\r\n            success: false,\r\n            code: err.code,\r\n            message: err.message,\r\n            details: err.details,\r\n            // preserve optional reasons array if provided by server\r\n            reasons:\r\n              (err.details && (err.details.reasons as string[] | undefined)) ||\r\n              undefined,\r\n          } as ApiResponse<any>;\r\n        }\r\n\r\n        // For other errors, bubble normalized ApiError for global handling\r\n        throw err;\r\n      }\r\n\r\n      // Non-axios/unknown error: wrap as generic network error for callers that catch DTO\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<any>;\r\n    }\r\n  },\r\n\r\n  // List queued structures (inactive Building docs). Optional base filter.\r\n  async getQueue(baseCoord?: string): Promise<ApiResponse<{ queue: any[] }>> {\r\n    try {\r\n      const params = baseCoord ? { base: baseCoord } : undefined;\r\n      const res = await api.get<ApiResponse<{ queue: any[] }>>(\r\n        \"/game/structures/queue\",\r\n        { params }\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<{ queue: any[] }>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<{ queue: any[] }>;\r\n    }\r\n  },\r\n\r\n  // Cancel a queued structure item by its _id\r\n  async cancelQueueItem(\r\n    id: string\r\n  ): Promise<\r\n    ApiResponse<{\r\n      cancelledId: string;\r\n      revertedUpgrade?: boolean;\r\n      deleted?: boolean;\r\n      refundedCredits?: number;\r\n    }>\r\n  > {\r\n    try {\r\n      const res = await api.delete<\r\n        ApiResponse<{\r\n          cancelledId: string;\r\n          revertedUpgrade?: boolean;\r\n          deleted?: boolean;\r\n          refundedCredits?: number;\r\n        }>\r\n      >(`/game/structures/queue/${id}`);\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        };\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      };\r\n    }\r\n  },\r\n};\r\n\r\nexport default structuresService;\r\n","import axios from 'axios';\r\nimport { ApiResponse, DefenseKey, DefenseSpec } from '@game/shared';\r\nimport { attachMetrics } from './httpInstrumentation';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: { 'Content-Type': 'application/json' },\r\n});\r\nattachMetrics(api, 'defenses');\r\n\r\n// Auth token\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem('auth-storage');\r\n  if (token) {\r\n    try {\r\n      const parsed = JSON.parse(token);\r\n      if (parsed.state?.token) {\r\n        (config.headers as any).Authorization = `Bearer ${parsed.state.token}`;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing auth token', e);\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\n// 401 handling\r\napi.interceptors.response.use(\r\n  (r) => r,\r\n  (error) => {\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem('auth-storage');\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// DTOs\r\nexport interface DefensesStatusDTO {\r\n  techLevels: Record<string, number>;\r\n  eligibility: Record<\r\n    DefenseKey,\r\n    {\r\n      canStart: boolean;\r\n      reasons: string[];\r\n    }\r\n  >;\r\n}\r\n\r\nexport const defensesService = {\r\n  async getCatalog(): Promise<ApiResponse<{ catalog: DefenseSpec[] }>> {\r\n    const res = await api.get<ApiResponse<{ catalog: DefenseSpec[] }>>('/game/defenses/catalog');\r\n    return res.data;\r\n  },\r\n\r\n  async getStatus(): Promise<ApiResponse<{ status: DefensesStatusDTO }>> {\r\n    const res = await api.get<ApiResponse<{ status: DefensesStatusDTO }>>('/game/defenses/status');\r\n    return res.data;\r\n  },\r\n\r\n  async start(locationCoord: string, defenseKey: DefenseKey): Promise<ApiResponse<any>> {\r\n    try {\r\n      const res = await api.post<ApiResponse<any>>('/game/defenses/start', { locationCoord, defenseKey });\r\n      return res.data;\r\n    } catch (err: any) {\r\n      // Extract error details from axios response\r\n      const status = err?.response?.status;\r\n      const data = err?.response?.data ?? {};\r\n      const code = data.code as string | undefined;\r\n      const message = (data.message || data.error || 'Request failed') as string;\r\n\r\n      // Soft-path for idempotency conflicts: return error data instead of throwing\r\n      if (code === 'ALREADY_IN_PROGRESS' || status === 409) {\r\n        return { \r\n          success: false, \r\n          code, \r\n          message, \r\n          details: data.details,\r\n          reasons: data.reasons\r\n        };\r\n      }\r\n\r\n      // For other errors, rethrow to maintain existing error handling\r\n      throw err;\r\n    }\r\n  },\r\n};\r\n\r\nexport default defensesService;\r\n","import axios from 'axios';\r\nimport { ApiResponse, UnitKey, UnitSpec } from '@game/shared';\r\nimport { attachMetrics } from './httpInstrumentation';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: { 'Content-Type': 'application/json' },\r\n});\r\nattachMetrics(api, 'units');\r\n\r\n// Auth token\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem('auth-storage');\r\n  if (token) {\r\n    try {\r\n      const parsed = JSON.parse(token);\r\n      if (parsed.state?.token) {\r\n        (config.headers as any).Authorization = `Bearer ${parsed.state.token}`;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing auth token', e);\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\n// 401 handling\r\napi.interceptors.response.use(\r\n  (r) => r,\r\n  (error) => {\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem('auth-storage');\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// DTOs\r\nexport interface UnitsStatusDTO {\r\n  techLevels: Record<string, number>;\r\n  eligibility: Record<\r\n    UnitKey,\r\n    {\r\n      canStart: boolean;\r\n      reasons: string[];\r\n    }\r\n  >;\r\n}\r\n\r\nexport const unitsService = {\r\n  async getCatalog(): Promise<ApiResponse<{ catalog: UnitSpec[] }>> {\r\n    const res = await api.get<ApiResponse<{ catalog: UnitSpec[] }>>('/game/units/catalog');\r\n    return res.data;\r\n  },\r\n\r\n  async getStatus(): Promise<ApiResponse<{ status: UnitsStatusDTO }>> {\r\n    const res = await api.get<ApiResponse<{ status: UnitsStatusDTO }>>('/game/units/status');\r\n    return res.data;\r\n  },\r\n\r\n  async start(locationCoord: string, unitKey: UnitKey): Promise<ApiResponse<any>> {\r\n    try {\r\n      const res = await api.post<ApiResponse<any>>('/game/units/start', { locationCoord, unitKey });\r\n      return res.data;\r\n    } catch (err: any) {\r\n      const status = err?.response?.status;\r\n      const data = err?.response?.data ?? {};\r\n      const code = data.code as string | undefined;\r\n      const message = (data.message || data.error || 'Request failed') as string;\r\n      \r\n      if (code === 'ALREADY_IN_PROGRESS' || status === 409) {\r\n        // Soft-path: return error response instead of throwing\r\n        return { success: false, code, message, details: data.details, reasons: data.reasons };\r\n      }\r\n      throw err; // let caller handle other errors\r\n    }\r\n  },\r\n};\r\n\r\nexport default unitsService;\r\n","import axios from 'axios';\r\nimport { ApiResponse, UnitKey } from '@game/shared';\r\nimport { attachMetrics } from './httpInstrumentation';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: { 'Content-Type': 'application/json' },\r\n});\r\nattachMetrics(api, 'fleets');\r\n\r\n// Auth token\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem('auth-storage');\r\n  if (token) {\r\n    try {\r\n      const parsed = JSON.parse(token);\r\n      if (parsed.state?.token) {\r\n        (config.headers as any).Authorization = `Bearer ${parsed.state.token}`;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing auth token', e);\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\n// 401 handling\r\napi.interceptors.response.use(\r\n  (r) => r,\r\n  (error) => {\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem('auth-storage');\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport interface BaseUnitsDTO {\r\n  base: string;\r\n  counts: Record<UnitKey, number>;\r\n  total: number;\r\n}\r\n\r\nexport interface FleetListRow {\r\n  _id: string;\r\n  name: string;\r\n  ownerName: string;\r\n  arrival: null;\r\n  sizeCredits: number;\r\n}\r\nexport interface FleetsListDTO {\r\n  fleets: FleetListRow[];\r\n}\r\n\r\nexport interface FleetUnitRow {\r\n  unitKey: string;\r\n  name: string;\r\n  count: number;\r\n}\r\n\r\nexport interface FleetDetailDTO {\r\n  fleet: {\r\n    _id: string;\r\n    name: string;\r\n    locationCoord: string;\r\n    ownerName: string;\r\n    units: FleetUnitRow[];\r\n    sizeCredits: number;\r\n  };\r\n}\r\n\r\nconst fleetsService = {\r\n  async getBaseUnits(baseCoord: string): Promise<ApiResponse<BaseUnitsDTO>> {\r\n    const res = await api.get<ApiResponse<BaseUnitsDTO>>('/game/base-units', { params: { base: baseCoord } });\r\n    return res.data;\r\n  },\r\n\r\n  async getFleets(baseCoord?: string): Promise<ApiResponse<FleetsListDTO>> {\r\n    const res = await api.get<ApiResponse<FleetsListDTO>>('/game/fleets', {\r\n      params: baseCoord ? { base: baseCoord } : undefined\r\n    });\r\n    return res.data;\r\n  },\r\n\r\n  async getFleet(id: string): Promise<ApiResponse<FleetDetailDTO>> {\r\n    const res = await api.get<ApiResponse<FleetDetailDTO>>(`/game/fleets/${id}`);\r\n    return res.data;\r\n  }\r\n};\r\n\r\nexport default fleetsService;\r\n","import axios from 'axios';\r\nimport { ApiResponse, CapacityResult } from '@game/shared';\r\nimport { attachMetrics } from './httpInstrumentation';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\nconst api = axios.create({\r\n  baseURL: API_BASE_URL,\r\n  headers: { 'Content-Type': 'application/json' },\r\n});\r\n\r\nattachMetrics(api, 'capacities');\r\n\r\n// Auth token\r\napi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem('auth-storage');\r\n  if (token) {\r\n    try {\r\n      const parsed = JSON.parse(token);\r\n      if (parsed.state?.token) {\r\n        (config.headers as any).Authorization = `Bearer ${parsed.state.token}`;\r\n      }\r\n    } catch (e) {\r\n      console.error('Error parsing auth token', e);\r\n    }\r\n  }\r\n  return config;\r\n});\r\n\r\n// 401 handling\r\napi.interceptors.response.use(\r\n  (r) => r,\r\n  (error) => {\r\n    if (error.response?.status === 401) {\r\n      localStorage.removeItem('auth-storage');\r\n      window.location.href = '/login';\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport interface CapacitiesDTO {\r\n  construction: CapacityResult;\r\n  production: CapacityResult;\r\n  research: CapacityResult;\r\n}\r\n\r\n// In-flight request coalescing (prevents parallel identical GETs from fanning out)\r\nconst inflightCapacities = new Map<string, Promise<ApiResponse<CapacitiesDTO>>>();\r\n\r\nexport const capacitiesService = {\r\n  async getStatus(coord: string): Promise<ApiResponse<CapacitiesDTO>> {\r\n    const key = `capacities:${coord}`;\r\n\r\n    const existing = inflightCapacities.get(key);\r\n    if (existing) {\r\n      return existing;\r\n    }\r\n\r\n    const requestPromise = (async () => {\r\n      try {\r\n        const res = await api.get<ApiResponse<CapacitiesDTO>>(\r\n          `/game/capacities/${encodeURIComponent(coord)}`\r\n        );\r\n        return res.data;\r\n      } finally {\r\n        inflightCapacities.delete(key);\r\n      }\r\n    })();\r\n\r\n    inflightCapacities.set(key, requestPromise);\r\n    return requestPromise;\r\n  },\r\n};\r\n\r\nexport default capacitiesService;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport universeService, { UniverseLocationData } from '../../services/universeService';\r\nimport capacitiesService from '../../services/capacitiesService';\r\nimport baseStatsService, { BaseStatsDTO } from '../../services/baseStatsService';\r\nimport { useModalStore } from '../../stores/modalStore';\r\nimport type { CapacityResult } from '@game/shared';\r\n\r\ntype PlanetInfoBlockProps = {\r\n  coord: string; // Full coordinate like A00:10:22:10\r\n  showLinkToPlanetPage?: boolean;\r\n  showBudgets?: boolean;\r\n  refreshKey?: number;\r\n};\r\n\r\nconst Row: React.FC<{ label: string; value?: React.ReactNode }> = ({ label, value }) => {\r\n  if (value === undefined || value === null || value === '') return null;\r\n  return (\r\n    <div className=\"flex justify-between text-sm\">\r\n      <span className=\"text-gray-400\">{label}</span>\r\n      <span className=\"text-white\">{value}</span>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst PlanetInfoBlock: React.FC<PlanetInfoBlockProps> = ({ coord, showLinkToPlanetPage = true, showBudgets = true, refreshKey }) => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [data, setData] = useState<UniverseLocationData | null>(null);\r\n  const [caps, setCaps] = useState<{ construction?: number; production?: number; research?: number } | null>(null);\r\n  const [capResults, setCapResults] = useState<{\r\n    construction: CapacityResult;\r\n    production: CapacityResult;\r\n    research: CapacityResult;\r\n  } | null>(null);\r\n  const [baseStats, setBaseStats] = useState<BaseStatsDTO | null>(null);\r\n  const { openModal } = useModalStore();\r\n\r\n  const fmt = (n: number | undefined | null) => {\r\n    const val = typeof n === 'number' ? n : 0;\r\n    const display = Math.round(val * 10) / 10;\r\n    return (\r\n      <span className=\"font-mono\" title={val.toFixed(2)}>\r\n        {display.toLocaleString(undefined, { maximumFractionDigits: 1 })}\r\n        <span className=\"text-gray-400\"> cred./h</span>\r\n      </span>\r\n    );\r\n  };\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    setLoading(true);\r\n    setError(null);\r\n    setData(null);\r\n    setCaps(null);\r\n    setCapResults(null);\r\n    setBaseStats(null);\r\n\r\n    universeService\r\n      .getLocationByCoord(coord)\r\n      .then((res) => {\r\n        if (!mounted) return;\r\n        if (res.success && res.data) {\r\n          setData(res.data);\r\n        } else {\r\n          setError(res.error || 'Failed to load planet info.');\r\n        }\r\n      })\r\n      .catch(() => {\r\n        if (mounted) setError('Network error while loading planet info.');\r\n      })\r\n      .finally(() => {\r\n        if (mounted) setLoading(false);\r\n      });\r\n\r\n    // Fetch capacities for this coord\r\n    capacitiesService\r\n      .getStatus(coord)\r\n      .then((res) => {\r\n        if (!mounted) return;\r\n        if ((res as any).success && (res as any).data) {\r\n          const d: any = (res as any).data;\r\n          setCapResults(d as {\r\n            construction: CapacityResult;\r\n            production: CapacityResult;\r\n            research: CapacityResult;\r\n          });\r\n          setCaps({\r\n            construction: d.construction?.value ?? 0,\r\n            production: d.production?.value ?? 0,\r\n            research: d.research?.value ?? 0,\r\n          });\r\n        }\r\n      })\r\n      .catch(() => {});\r\n\r\n    // Fetch base stats (area/energy/population budgets and owner income)\r\n    baseStatsService\r\n      .get(coord)\r\n      .then((res) => {\r\n        if (!mounted) return;\r\n        if (res.success && res.data) {\r\n          setBaseStats(res.data.stats);\r\n        }\r\n      })\r\n      .catch(() => {});\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [coord, refreshKey]);\r\n\r\n  return (\r\n    <div className=\"mt-4\">\r\n      <h3 className=\"text-lg font-semibold mb-3 text-empire-gold\"> Planet Information</h3>\r\n\r\n      {/* States */}\r\n      {loading && <div className=\"text-gray-400 text-sm\">Loading planet data...</div>}\r\n      {error && (\r\n        <div className=\"p-2 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* Details */}\r\n      {!loading && !error && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n          <div className=\"space-y-1.5\">\r\n            <Row label=\"Type\" value={data?.type}></Row>\r\n            <Row label=\"Owner\" value={data?.owner?.username ?? 'Unclaimed'}></Row>\r\n            {typeof data?.orbitPosition === 'number' && <Row label=\"Orbit Pos\" value={data?.orbitPosition}></Row>}\r\n            <Row label=\"Terrain\" value={data?.terrain?.type}></Row>\r\n            {typeof data?.result?.area === 'number' && (\r\n              <Row label=\"Area\" value={data?.result?.area}></Row>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-1.5\">\r\n            {typeof data?.result?.solarEnergy === 'number' && (\r\n              <Row label=\"Solar Energy\" value={data?.result?.solarEnergy}></Row>\r\n            )}\r\n            {typeof data?.result?.fertility === 'number' && (\r\n              <Row label=\"Fertility\" value={data?.result?.fertility}></Row>\r\n            )}\r\n            {typeof data?.result?.yields?.metal === 'number' && (\r\n              <Row label=\"Metal\" value={data.result.yields.metal} />\r\n            )}\r\n            {typeof data?.result?.yields?.crystals === 'number' && (\r\n              <Row label=\"Crystal\" value={data.result.yields.crystals} />\r\n            )}\r\n            {typeof data?.result?.yields?.gas === 'number' && (\r\n              <Row label=\"Gas\" value={data.result.yields.gas} />\r\n            )}\r\n          </div>\r\n\r\n          {/* Economy and income (mocked) */}\r\n          <div className=\"md:col-span-2 space-y-1.5 pt-1 border-t border-gray-700\">\r\n            <Row\r\n              label=\"Economy\"\r\n              value={fmt(baseStats?.ownerIncomeCredPerHour ?? 0)}\r\n            />\r\n            <Row\r\n              label=\"Owner Income\"\r\n              value={\r\n                <span className=\"font-mono\">\r\n                  {Math.round(baseStats?.ownerIncomeCredPerHour ?? 0).toLocaleString()}\r\n                  <span className=\"text-gray-400\"> cred./h</span>\r\n                </span>\r\n              }\r\n            />\r\n          </div>\r\n\r\n          {/* Income breakdown */}\r\n          <div className=\"md:col-span-2 space-y-1.5\">\r\n            <Row\r\n              label=\"Construction\"\r\n              value={fmt(caps?.construction)}\r\n            />\r\n            <Row\r\n              label=\"Production\"\r\n              value={fmt(caps?.production)}\r\n            />\r\n            <Row\r\n              label=\"Research\"\r\n              value={fmt(caps?.research)}\r\n            />\r\n            <div className=\"text-right\">\r\n              <button\r\n                onClick={() => {\r\n                  if (capResults) {\r\n                    openModal('capacity_breakdown', { coord, capacities: capResults });\r\n                  }\r\n                }}\r\n                className=\"text-sm text-blue-400 hover:text-blue-300\"\r\n                title=\"View detailed capacity sources\"\r\n              >\r\n                View breakdown \r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Base Budgets */}\r\n          {showBudgets && baseStats && (\r\n            <div className=\"md:col-span-2 space-y-1.5 pt-1 border-t border-gray-700\">\r\n              <Row\r\n                label=\"Area Usage\"\r\n                value={\r\n                  <span className=\"font-mono\">\r\n                    {baseStats.area.used.toLocaleString()} / {baseStats.area.total.toLocaleString()}\r\n                    <span className=\"text-gray-400\"> (free {baseStats.area.free.toLocaleString()})</span>\r\n                  </span>\r\n                }\r\n              />\r\n              <Row\r\n                label=\"Energy Balance\"\r\n                value={\r\n                  <span className=\"font-mono\">\r\n                    +{baseStats.energy.produced.toLocaleString()}\r\n                    <span className=\"text-gray-400\"> prod</span>\r\n                    {'  '}\r\n                    {baseStats.energy.consumed.toLocaleString()}\r\n                    <span className=\"text-gray-400\"> cons</span>\r\n                    {'  '}\r\n                    ={' '}\r\n                    <span className={baseStats.energy.balance >= 0 ? 'text-green-300' : 'text-red-300'}>\r\n                      {baseStats.energy.balance.toLocaleString()}\r\n                    </span>\r\n                  </span>\r\n                }\r\n              />\r\n              <Row\r\n                label=\"Population\"\r\n                value={\r\n                  <span className=\"font-mono\">\r\n                    {baseStats.population.used.toLocaleString()} / {baseStats.population.capacity.toLocaleString()}\r\n                    <span className=\"text-gray-400\"> (free {baseStats.population.free.toLocaleString()})</span>\r\n                  </span>\r\n                }\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Star-specific fallback details if this coord points to a star */}\r\n          {data?.starOverhaul?.kind && (\r\n            <div className=\"md:col-span-2 text-sm text-gray-400\">\r\n              Star Kind: <span className=\"text-white\">{data.starOverhaul.kind}</span>\r\n            </div>\r\n          )}\r\n          {data?.starProperties && (\r\n            <div className=\"md:col-span-2 text-xs text-gray-400\">\r\n              Star: class {data.starProperties.spectralClass}, {data.starProperties.temperatureK}K\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Link to full page */}\r\n      {!loading && !error && showLinkToPlanetPage && (\r\n        <div className=\"mt-3 text-right\">\r\n          <Link\r\n            to={`/planet/${encodeURIComponent(coord)}`}\r\n            className=\"text-sm text-blue-400 hover:text-blue-300\"\r\n            title=\"Open full planet view\"\r\n          >\r\n            View Planet \r\n          </Link>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PlanetInfoBlock;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport universeService, { UniverseLocationData } from '../../services/universeService';\r\n\r\ntype PlanetVisualProps = {\r\n  coord: string;\r\n  className?: string;\r\n};\r\n\r\nconst PlanetVisual: React.FC<PlanetVisualProps> = ({ coord, className }) => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [data, setData] = useState<UniverseLocationData | null>(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    setLoading(true);\r\n    setError(null);\r\n    setData(null);\r\n\r\n    universeService\r\n      .getLocationByCoord(coord)\r\n      .then((res) => {\r\n        if (!mounted) return;\r\n        if (res.success && res.data) {\r\n          setData(res.data);\r\n        } else {\r\n          setError(res.error || 'Failed to load planet visual.');\r\n        }\r\n      })\r\n      .catch(() => {\r\n        if (mounted) setError('Network error while loading planet visual.');\r\n      })\r\n      .finally(() => {\r\n        if (mounted) setLoading(false);\r\n      });\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [coord]);\r\n\r\n  const planetVisualStyle = useMemo<React.CSSProperties>(() => {\r\n    const type = data?.type || 'planet';\r\n    const themes: Record<string, string> = {\r\n      terrestrial:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, #487a3a 21%, #2b4f28 60%, #132515 100%)',\r\n      gas_giant:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.15) 18%, #7a62b7 20%, #4f3a8a 58%, #2a174f 100%)',\r\n      ice:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.4) 22%, #78a9d6 23%, #3c6d99 60%, #1c3550 100%)',\r\n      desert:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 18%, #e0b34a 20%, #a97a2a 60%, #5e3b10 100%)',\r\n      volcanic:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,200,200,0.7), rgba(255,200,200,0.2) 20%, #cc2b2b 22%, #7a1e1e 60%, #330d0d 100%)',\r\n      planet:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, rgba(40,80,140,1) 21%, rgba(20,40,80,1) 60%, rgba(10,20,40,1) 100%)',\r\n      asteroid:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.2) 18%, #7b6f62 20%, #4a423b 60%, #26221e 100%)',\r\n      star:\r\n        'radial-gradient(circle at 30% 30%, rgba(255,255,200,0.9), rgba(255,255,200,0.4) 22%, #ffd27a 24%, #e0a53a 60%, #8a5a0a 100%)',\r\n    };\r\n    const background = themes[type] || themes.planet;\r\n    return {\r\n      background,\r\n      boxShadow: '0 0 40px rgba(100,150,255,0.3), inset 0 0 30px rgba(0,0,0,0.6)',\r\n    };\r\n  }, [data]);\r\n\r\n  const sizeClass =\r\n    className && className.trim().length > 0 ? className : 'w-56 h-56 md:w-64 md:h-64';\r\n\r\n  if (loading) {\r\n    return (\r\n      <div\r\n        className={`rounded-full ${sizeClass} animate-pulse bg-gray-600/40`}\r\n        aria-label=\"Loading planet preview\"\r\n      />\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div\r\n        className={`rounded-full ${sizeClass} bg-gray-700 flex items-center justify-center text-xs text-gray-300`}\r\n        aria-label=\"Planet preview unavailable\"\r\n        title={error}\r\n      >\r\n        Preview unavailable\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`rounded-full shadow-lg ${sizeClass}`}\r\n      style={planetVisualStyle}\r\n      aria-label=\"Planet preview\"\r\n    />\r\n  );\r\n};\r\n\r\nexport default PlanetVisual;\r\n","import api, { ApiError } from \"./api\";\r\nimport { ApiResponse, BuildingKey, CapacityResult } from \"@game/shared\";\r\n\r\n// Types for combined base stats + capacities\r\nexport interface BaseStatsDTO {\r\n  area: { total: number; used: number; free: number };\r\n  energy: { produced: number; consumed: number; balance: number };\r\n  population: { used: number; capacity: number; free: number };\r\n  ownerIncomeCredPerHour: number;\r\n}\r\n\r\nexport interface BasesStatsData {\r\n  coord: string;\r\n  stats: BaseStatsDTO;\r\n  capacities: {\r\n    construction: CapacityResult;\r\n    production: CapacityResult;\r\n    research: CapacityResult;\r\n  };\r\n}\r\n\r\n// Types for per-base structures listing\r\nexport interface BaseStructureItem {\r\n  key: BuildingKey;\r\n  name: string;\r\n  currentLevel: number;\r\n  nextLevel: number;\r\n  creditsCostNext: number;\r\n  energyDelta: number;\r\n  requires: Array<{ key: string; level: number }>;\r\n  canStart: boolean;\r\n  reasons: string[];\r\n  etaMinutes: number;\r\n}\r\n\r\nexport interface BaseStructuresData {\r\n  coord: string;\r\n  constructionPerHour: number;\r\n  items: BaseStructureItem[];\r\n  activeConstruction?: { key: BuildingKey; completionAt: string } | null;\r\n}\r\n\r\nfunction isApiErrorLike(err: unknown): err is ApiError {\r\n  return (\r\n    !!err &&\r\n    typeof err === \"object\" &&\r\n    typeof (err as any).code === \"string\" &&\r\n    typeof (err as any).message === \"string\"\r\n  );\r\n}\r\n\r\nexport const basesService = {\r\n  async getBaseStats(coord: string): Promise<ApiResponse<BasesStatsData>> {\r\n    try {\r\n      const res = await api.get<ApiResponse<BasesStatsData>>(\r\n        `/game/bases/${encodeURIComponent(coord)}/stats`\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<BasesStatsData>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<BasesStatsData>;\r\n    }\r\n  },\r\n\r\n  async getBaseStructures(coord: string): Promise<ApiResponse<BaseStructuresData>> {\r\n    try {\r\n      const res = await api.get<ApiResponse<BaseStructuresData>>(\r\n        `/game/bases/${encodeURIComponent(coord)}/structures`\r\n      );\r\n      return res.data;\r\n    } catch (err) {\r\n      if (isApiErrorLike(err)) {\r\n        return {\r\n          success: false,\r\n          code: err.code,\r\n          message: err.message,\r\n          details: err.details,\r\n        } as ApiResponse<BaseStructuresData>;\r\n      }\r\n      return {\r\n        success: false,\r\n        code: \"NETWORK_ERROR\",\r\n        message: \"Network error\",\r\n      } as ApiResponse<BaseStructuresData>;\r\n    }\r\n  },\r\n};\r\n\r\nexport default basesService;\r\n","import React from 'react';\r\nimport { useNetwork } from '../../contexts/NetworkContext';\r\n\r\ninterface NetworkAwareButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n  children: React.ReactNode;\r\n  /**\r\n   * Whether the button requires network connectivity to function\r\n   * @default true\r\n   */\r\n  requiresNetwork?: boolean;\r\n  /**\r\n   * Optional custom tooltip when disabled due to network issues\r\n   */\r\n  networkDisabledTooltip?: string;\r\n  /**\r\n   * Optional custom className when disabled due to network issues\r\n   */\r\n  networkDisabledClassName?: string;\r\n}\r\n\r\nconst NetworkAwareButton: React.FC<NetworkAwareButtonProps> = ({\r\n  children,\r\n  requiresNetwork = true,\r\n  networkDisabledTooltip = 'Action unavailable while offline',\r\n  networkDisabledClassName = 'opacity-50 cursor-not-allowed',\r\n  disabled,\r\n  className = '',\r\n  ...props\r\n}) => {\r\n  const { isFullyConnected } = useNetwork();\r\n  const isNetworkDisabled = requiresNetwork && !isFullyConnected;\r\n  const isActuallyDisabled = disabled || isNetworkDisabled;\r\n\r\n  const getTooltip = () => {\r\n    if (disabled) return props.title;\r\n    if (isNetworkDisabled) return networkDisabledTooltip;\r\n    return props.title;\r\n  };\r\n\r\n  const getClassName = () => {\r\n    const baseClasses = className || 'px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700';\r\n    if (isNetworkDisabled) {\r\n      return `${baseClasses} ${networkDisabledClassName}`;\r\n    }\r\n    return baseClasses;\r\n  };\r\n\r\n  return (\r\n    <button\r\n      {...props}\r\n      disabled={isActuallyDisabled}\r\n      title={getTooltip()}\r\n      className={getClassName()}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default NetworkAwareButton;\r\n","import React, { useMemo } from \"react\";\r\nimport NetworkAwareButton from \"../ui/NetworkAwareButton\";\r\n\r\nexport interface Eligibility {\r\n  canStart: boolean;\r\n  reasons: string[];\r\n}\r\n\r\nexport interface Column<T> {\r\n  key: string;\r\n  header: string;\r\n  align?: \"left\" | \"right\";\r\n  className?: string;\r\n  render: (item: T) => React.ReactNode;\r\n}\r\n\r\nexport interface BuildTableProps<T> {\r\n  // Card header\r\n  title: string;\r\n  summary?: React.ReactNode;\r\n  loading?: boolean;\r\n  onRefresh?: () => void;\r\n\r\n  // Data\r\n  items: T[];\r\n\r\n  // Identity/test hooks\r\n  getKey: (item: T) => string;\r\n\r\n  // First column content\r\n  getTitleText: (item: T) => string | React.ReactNode;\r\n  getDescriptionText?: (item: T) => string | React.ReactNode;\r\n\r\n  // Eligibility for reasons line and action tooltip/disable\r\n  getEligibility: (item: T) => Eligibility;\r\n\r\n  // Middle columns (excluding first \"Title\" and last \"Action\")\r\n  columns: Column<T>[];\r\n\r\n  // Action column\r\n  onAction: (item: T) => void | Promise<void>;\r\n  onQueue?: (item: T) => Promise<{ success: boolean; eventId?: number; error?: string }>;\r\n  isOffline?: boolean;\r\n  actionLabel?: (item: T, eligible: boolean, loading?: boolean, isOffline?: boolean) => string;\r\n  actionTestIdPrefix?: string; // default \"action\"\r\n  nameTestIdPrefix?: string; // default \"name\"\r\n\r\n  // Sorting (default: leave order as provided)\r\n  defaultSort?: (a: T, b: T) => number;\r\n\r\n  // Optional table-level test id\r\n  tableTestId?: string; // default \"build-table\"\r\n\r\n  // Optional custom column headers\r\n  firstColumnHeader?: string;\r\n  actionHeader?: string;\r\n}\r\n\r\n/**\r\n * BuildTable (generic)\r\n * - Implements standardized compact table styling and behavior per .clinerules/tabular-build-ui-standard-and-test-plan.md\r\n * - First column: name (white), optional description (gray), and red reasons line when ineligible\r\n * - Last column: right-aligned Start/Build action button with disabled tooltip listing reasons\r\n * - Sticky header, compact rows, consistent classes\r\n */\r\nconst BuildTable = <T,>(props: BuildTableProps<T>) => {\r\n  const {\r\n    title,\r\n    summary,\r\n    loading,\r\n    onRefresh,\r\n    items,\r\n    getKey,\r\n    getTitleText,\r\n    getDescriptionText,\r\n    getEligibility,\r\n    columns,\r\n    onAction,\r\n    actionLabel,\r\n    actionTestIdPrefix = \"action\",\r\n    nameTestIdPrefix = \"name\",\r\n    defaultSort,\r\n    firstColumnHeader,\r\n    actionHeader,\r\n    tableTestId = \"build-table\",\r\n  } = props;\r\n\r\n  const sortedItems = useMemo(() => {\r\n    if (!items) return [];\r\n    if (typeof defaultSort === \"function\") {\r\n      return items.slice().sort(defaultSort);\r\n    }\r\n    return items;\r\n  }, [items, defaultSort]);\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">{title}</h3>\r\n        <div className=\"flex items-center gap-2\">\r\n          {summary}\r\n          {onRefresh && (\r\n            <button\r\n              onClick={onRefresh}\r\n              className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n              disabled={loading}\r\n            >\r\n              {loading ? \"Loading...\" : \"Refresh\"}\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"overflow-x-auto\">\r\n        <table data-testid={tableTestId} className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              {/* First column header (e.g., Defense | Structure | Technology | Unit) */}\r\n              <th className=\"py-2 px-3 text-left\">{firstColumnHeader ?? \"\"}</th>\r\n              {columns.map((col) => (\r\n                <th\r\n                  key={col.key}\r\n                  className={`py-2 px-3 ${col.align === \"right\" ? \"text-right\" : \"text-left\"}`}\r\n                >\r\n                  {col.header}\r\n                </th>\r\n              ))}\r\n              <th className=\"py-2 px-3 text-right\">{actionHeader ?? \"\"}</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {sortedItems.map((item) => {\r\n              const key = getKey(item);\r\n              const eligibility = getEligibility(item);\r\n              const { canStart, reasons } = eligibility;\r\n              const reasonsLine =\r\n                !canStart && Array.isArray(reasons) && reasons.length > 0 ? reasons.join(\"; \") : \"\";\r\n\r\n              const buttonLabel =\r\n                typeof actionLabel === \"function\"\r\n                  ? actionLabel(item, canStart, loading)\r\n                  : loading\r\n                  ? \"...\"\r\n                  : canStart\r\n                  ? \"Start\"\r\n                  : \"Unavailable\";\r\n\r\n              return (\r\n                <tr\r\n                  key={key}\r\n                  data-testid={`row-${key}`}\r\n                  className=\"border-b border-gray-800 hover:bg-gray-800/60\"\r\n                >\r\n                  {/* Title / description / reasons */}\r\n                  <td className=\"py-2 px-3 align-top\">\r\n                    <div className=\"text-white\" data-testid={`${nameTestIdPrefix}-${key}`}>\r\n                      {getTitleText(item)}\r\n                    </div>\r\n                    {getDescriptionText && (\r\n                      <div className=\"text-xs text-gray-400\">{getDescriptionText(item)}</div>\r\n                    )}\r\n                    {reasonsLine && (\r\n                      <div className=\"text-xs text-red-300 mt-1\">{reasonsLine}</div>\r\n                    )}\r\n                  </td>\r\n\r\n                  {/* Middle columns */}\r\n                  {columns.map((col) => (\r\n                    <td\r\n                      key={col.key}\r\n                      className={`py-2 px-3 align-top ${\r\n                        col.align === \"right\" ? \"text-right\" : \"text-left\"\r\n                      } ${col.className || \"\"}`}\r\n                    >\r\n                      {col.render(item)}\r\n                    </td>\r\n                  ))}\r\n\r\n                  {/* Action column */}\r\n                  <td className=\"py-2 px-3 text-right align-top\">\r\n                    <NetworkAwareButton\r\n                      data-testid={`${actionTestIdPrefix}-${key}`}\r\n                      disabled={!canStart || !!loading}\r\n                      onClick={() => onAction(item)}\r\n                      title={!canStart && reasonsLine ? reasonsLine : undefined}\r\n                      className={`px-3 py-1 rounded text-sm font-medium transition-colors ${\r\n                        canStart && !loading\r\n                          ? \"bg-blue-600 hover:bg-blue-700 text-white\"\r\n                          : \"bg-gray-600 text-gray-400 cursor-not-allowed\"\r\n                      }`}\r\n                      requiresNetwork={true}\r\n                      networkDisabledTooltip=\"Action unavailable while offline\"\r\n                    >\r\n                      {buttonLabel}\r\n                    </NetworkAwareButton>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BuildTable;\r\n","import * as React from \"react\";\r\nimport type { BuildingKey, BuildingSpec } from \"@game/shared\";\r\nimport { getStructureCreditCostForLevel } from \"@game/shared\";\r\nimport type { StructuresStatusDTO } from \"../../services/structuresService\";\r\nimport { useModalStore } from \"../../stores/modalStore\";\r\nimport BuildTable, { type Column, type Eligibility } from \"./BuildTable\";\r\n\r\ninterface StructuresBuildTableProps {\r\n  catalog: BuildingSpec[];\r\n  status: StructuresStatusDTO | null;\r\n  levels?: Partial<Record<BuildingKey, number>>;\r\n  loading: boolean;\r\n  onRefresh: () => void;\r\n  onStart: (key: BuildingKey) => Promise<void> | void;\r\n  onQueue?: (s: BuildingSpec) => Promise<{ success: boolean; eventId?: number }>;\r\n  isOffline?: boolean;\r\n  constructionPerHour?: number;\r\n  activeConstruction?: { key: BuildingKey; completionAt: string } | null;\r\n  locationCoord?: string;\r\n  // Planet context for displaying per-base energy gain hints\r\n  planetSolarEnergy?: number;\r\n  planetGasYield?: number;\r\n  // Additional planet context for metal/crystals/fertility hints\r\n  planetMetalYield?: number;\r\n  planetCrystalsYield?: number;\r\n  planetFertility?: number;\r\n  actionLabel?: (s: BuildingSpec, eligible: boolean, isLoading: boolean, isOffline: boolean) => string;\r\n}\r\n\r\n/**\r\n * StructuresBuildTable\r\n * - Consolidated onto generic BuildTable with standardized styling/behavior\r\n * - Columns per .clinerules/tabular-build-ui-standard-and-test-plan.md:\r\n *   Structure | Credits | Energy | Economy | Population | Area | Advanced | Requires | Time | Build\r\n */\r\nconst StructuresBuildTable: React.FC<StructuresBuildTableProps> = ({\r\n  catalog,\r\n  status,\r\n  levels,\r\n  loading,\r\n  onRefresh,\r\n  onStart,\r\n  constructionPerHour,\r\n  activeConstruction,\r\n  planetSolarEnergy,\r\n  planetGasYield,\r\n  planetMetalYield,\r\n  planetCrystalsYield,\r\n  planetFertility,\r\n}) => {\r\n  const structs = React.useMemo<BuildingSpec[]>(\r\n    () => (catalog || []).slice().sort((a, b) => a.creditsCost - b.creditsCost),\r\n    [catalog]\r\n  );\r\n\r\n  const [expandedKey, setExpandedKey] = React.useState<string | null>(null);\r\n  const { openModal } = useModalStore();\r\n\r\n  // Active construction (global gray-out)\r\n  const hasActive = !!activeConstruction;\r\n\r\n  // Tick every second while construction is active to update countdown\r\n  const [, forceTick] = React.useReducer((x: number) => x + 1, 0);\r\n  React.useEffect(() => {\r\n    if (!hasActive) return;\r\n    const id = window.setInterval(() => forceTick(), 1000);\r\n    return () => window.clearInterval(id);\r\n  }, [hasActive, activeConstruction?.completionAt]);\r\n\r\n\r\n\r\n  const formatDuration = (credits: number, perHour: number): string => {\r\n    const totalSeconds = Math.max(1, Math.round((credits / perHour) * 3600));\r\n    const h = Math.floor(totalSeconds / 3600);\r\n    const m = Math.floor((totalSeconds % 3600) / 60);\r\n    const s = totalSeconds % 60;\r\n    return `${h}h ${m}m ${s}s`;\r\n  };\r\n\r\n  // Copied/kept in sync with GameInfoModal.StructuresTable\r\n  const getStructureEffect = (s: BuildingSpec): string => {\r\n    switch (s.key) {\r\n      case \"urban_structures\":\r\n        return \"Increases population capacity by base fertility.\";\r\n      case \"solar_plants\":\r\n        return \"Increases base energy output by base solar energy.\";\r\n      case \"gas_plants\":\r\n        return \"Increases base energy output by base gas resource.\";\r\n      case \"fusion_plants\":\r\n      case \"antimatter_plants\":\r\n      case \"orbital_plants\":\r\n        return `Increases base energy output by ${s.energyDelta}.`;\r\n      case \"research_labs\":\r\n        return \"Increases bases research by 8, allows new technologies.\";\r\n      case \"metal_refineries\":\r\n        return \"Increases production and construction by base metal resource.\";\r\n      case \"crystal_mines\":\r\n        return \"Increases economy by base crystals resource.\";\r\n      case \"robotic_factories\":\r\n        return \"Increases production and construction by 2.\";\r\n      case \"shipyards\":\r\n        return \"Increases production by 2 and allows new units.\";\r\n      case \"orbital_shipyards\":\r\n        return \"Increases production by 8 and allows new units.\";\r\n      case \"spaceports\":\r\n        return `Increases economy by ${s.economy} and allows trade routes.`;\r\n      case \"command_centers\":\r\n        return \"Adds 5% fleet attack power at base and allows 1 occupation.\";\r\n      case \"nanite_factories\":\r\n        return \"Increases production and construction by 4.\";\r\n      case \"android_factories\":\r\n        return \"Increases production and construction by 6.\";\r\n      case \"economic_centers\":\r\n        return `Increases economy by ${s.economy}.`;\r\n      case \"terraform\":\r\n        return \"Increases base area by 5.\";\r\n      case \"multi_level_platforms\":\r\n        return \"Increases base area by 10.\";\r\n      case \"orbital_base\":\r\n        return \"Increases population capacity by 10.\";\r\n      case \"jump_gate\":\r\n        return \"Increases fleet speed by 70% and allows travel between galaxies.\";\r\n      case \"biosphere_modification\":\r\n        return \"Increases planet fertility by 1.\";\r\n      case \"capital\":\r\n        return \"Increases economy by 10 and other bases by 1. -15% empire income while occupied.\";\r\n      default:\r\n        if (s.energyDelta > 0) return `Increases base energy output by ${s.energyDelta}.`;\r\n        if (s.energyDelta < 0) return `Consumes ${Math.abs(s.energyDelta)} energy.`;\r\n        if (s.economy > 0) return `Increases economy by ${s.economy}.`;\r\n        return \"\";\r\n    }\r\n  };\r\n\r\n  const NO_AREA_KEYS: Array<BuildingSpec[\"key\"]> = [\"orbital_base\", \"jump_gate\"];\r\n  const AREA_INCREASE: Partial<Record<BuildingSpec[\"key\"], number>> = {\r\n    terraform: 5,\r\n    multi_level_platforms: 10,\r\n  };\r\n\r\n  const renderArea = (s: BuildingSpec): string => {\r\n    if (NO_AREA_KEYS.includes(s.key)) return \"\";\r\n    const inc = AREA_INCREASE[s.key as keyof typeof AREA_INCREASE];\r\n    if (typeof inc === \"number\") return `+${inc}`;\r\n    if (typeof s.areaRequired === \"number\") {\r\n      return s.areaRequired === 0 ? \"\" : `-${s.areaRequired}`;\r\n    }\r\n    // Default: most items cost 1 area\r\n    return \"-1\";\r\n  };\r\n\r\n  const getRequiresText = (s: BuildingSpec): string => {\r\n    return s.techPrereqs.length === 0\r\n      ? \"\"\r\n      : s.techPrereqs.map((p) => `${p.key.replace(/_/g, \" \")} ${p.level}`).join(\", \");\r\n  };\r\n\r\n  const columns: Column<BuildingSpec>[] = [\r\n    {\r\n      key: \"credits\",\r\n      header: \"Credits\",\r\n      align: \"left\",\r\n      render: (s) => {\r\n        const currentLevel = levels?.[s.key as BuildingKey] ?? 0;\r\n        const nextLevel = currentLevel + 1;\r\n        let nextCost: number | null = null;\r\n        try {\r\n          nextCost = getStructureCreditCostForLevel(s.key as BuildingKey, nextLevel);\r\n        } catch {\r\n          // If no canonical table is defined yet: allow L1 fallback, block upgrades\r\n          nextCost = currentLevel === 0 ? s.creditsCost : null;\r\n        }\r\n        return typeof nextCost === \"number\" ? nextCost.toLocaleString() : \"\";\r\n      },\r\n    },\r\n    {\r\n      key: \"energy\",\r\n      header: \"Energy\",\r\n      align: \"left\",\r\n      render: (s) =>\r\n        s.key === \"solar_plants\" || s.key === \"gas_plants\"\r\n          ? \"\"\r\n          : s.energyDelta === 0\r\n          ? \"\"\r\n          : String(s.energyDelta),\r\n    },\r\n    {\r\n      key: \"economy\",\r\n      header: \"Economy\",\r\n      align: \"left\",\r\n      render: (s) => (s.economy === 0 ? \"\" : s.economy),\r\n    },\r\n    {\r\n      key: \"population\",\r\n      header: \"Population\",\r\n      align: \"left\",\r\n      render: (s) => (s.key === \"orbital_base\" ? \"+10\" : s.populationRequired === 0 ? \"\" : `-${s.populationRequired}`),\r\n    },\r\n    {\r\n      key: \"area\",\r\n      header: \"Area\",\r\n      align: \"left\",\r\n      render: (s) => renderArea(s),\r\n    },\r\n    {\r\n      key: \"advanced\",\r\n      header: \"Advanced\",\r\n      align: \"left\",\r\n      render: (s) => (s.advanced ? \"x\" : \"\"),\r\n    },\r\n    {\r\n      key: \"requires\",\r\n      header: \"Requires\",\r\n      align: \"left\",\r\n      render: (s) => {\r\n        const text = getRequiresText(s);\r\n        const hasReq = s.techPrereqs.length > 0;\r\n        if (!hasReq) {\r\n          return <span className=\"text-gray-400\">{text}</span>;\r\n        }\r\n        const techLevels = status?.techLevels || {};\r\n        const met = s.techPrereqs.every((p) => (techLevels[p.key] ?? 0) >= p.level);\r\n        return <span className={met ? \"text-green-400\" : \"text-red-400\"}>{text}</span>;\r\n      },\r\n    },\r\n    {\r\n      key: \"time\",\r\n      header: \"Time\",\r\n      align: \"left\",\r\n      render: (s) => {\r\n        if (!(typeof constructionPerHour === \"number\" && constructionPerHour > 0)) return \"\";\r\n        const currentLevel = levels?.[s.key as BuildingKey] ?? 0;\r\n        const nextLevel = currentLevel + 1;\r\n        let nextCost: number | null = null;\r\n        try {\r\n          nextCost = getStructureCreditCostForLevel(s.key as BuildingKey, nextLevel);\r\n        } catch {\r\n          nextCost = currentLevel === 0 ? s.creditsCost : null;\r\n        }\r\n        return typeof nextCost === \"number\" ? formatDuration(nextCost, constructionPerHour) : \"\";\r\n      },\r\n    },\r\n  ];\r\n\r\n  const getEligibility = (s: BuildingSpec): Eligibility => {\r\n    const elig = status?.eligibility[s.key as BuildingKey];\r\n    // Allow queue behavior: enable all eligible rows to Queue (including the active one)\r\n    const canStart = !!elig?.canStart;\r\n    const reasons = elig?.reasons || [];\r\n    return { canStart, reasons };\r\n  };\r\n\r\n  const getTitleText = (s: BuildingSpec): React.ReactNode => {\r\n    const lvl = levels?.[s.key as BuildingKey] ?? 0;\r\n\r\n    // Determine per-base inline hint based on planet context\r\n    let hintLabel: string | null = null;\r\n    let hintValue: number | null = null;\r\n    if (s.key === \"solar_plants\" && typeof planetSolarEnergy === \"number\") {\r\n      hintLabel = \"energy\";\r\n      hintValue = planetSolarEnergy;\r\n    } else if (s.key === \"gas_plants\" && typeof planetGasYield === \"number\") {\r\n      hintLabel = \"energy\";\r\n      hintValue = planetGasYield;\r\n    } else if (s.key === \"metal_refineries\" && typeof planetMetalYield === \"number\") {\r\n      hintLabel = \"metal\";\r\n      hintValue = planetMetalYield;\r\n    } else if (s.key === \"urban_structures\" && typeof planetFertility === \"number\") {\r\n      hintLabel = \"fertility\";\r\n      hintValue = planetFertility;\r\n    } else if (s.key === \"crystal_mines\" && typeof planetCrystalsYield === \"number\") {\r\n      hintLabel = \"crystals\";\r\n      hintValue = planetCrystalsYield;\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className=\"text-white cursor-pointer\"\r\n        data-testid={`name-${s.key}`}\r\n        onClick={() => setExpandedKey(expandedKey === s.key ? null : s.key)}\r\n      >\r\n        {s.name}\r\n        {lvl > 0 ? ` (Level ${lvl})` : \"\"}\r\n        {typeof hintValue === \"number\" && hintLabel && (\r\n          <span className=\"ml-2 text-xs text-gray-400\">{`(+${hintValue.toLocaleString()} ${hintLabel} here)`}</span>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const getDescriptionText = (s: BuildingSpec): React.ReactNode => {\r\n    const elig = status?.eligibility[s.key as BuildingKey];\r\n    // Align with getEligibility(): all eligible rows can start, including active ones\r\n    const canStart = !!elig?.canStart;\r\n    const reasons = elig?.reasons || [];\r\n    const showReasons = !canStart && reasons.length > 0;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"text-xs text-gray-400\">{getStructureEffect(s)}</div>\r\n        {showReasons && <div className=\"text-xs text-red-300 mt-1\">{reasons.join(\"; \")}</div>}\r\n        {expandedKey === s.key && (\r\n          <div className=\"mt-2 space-y-1\">\r\n            <div className=\"text-sm text-gray-300\">\r\n              <span className=\"text-gray-400\">Population:</span> {s.populationRequired} per level\r\n            </div>\r\n            <div className=\"text-sm text-gray-300\">\r\n              <span className=\"text-gray-400\">Area:</span>{\" \"}\r\n              {(() => {\r\n                if (NO_AREA_KEYS.includes(s.key)) return \"\";\r\n                if (typeof s.areaRequired === \"number\") {\r\n                  return s.areaRequired === 0 ? \"\" : `-${s.areaRequired} per level`;\r\n                }\r\n                return \"-1 per level\";\r\n              })()}\r\n            </div>\r\n            <div className=\"text-sm text-gray-300\">\r\n              <span className=\"text-gray-400\">Short Name:</span>{\" \"}\r\n              {s.key\r\n                .split(\"_\")\r\n                .map((w) => w[0]?.toUpperCase() || \"\")\r\n                .join(\"\")}\r\n            </div>\r\n            <div className=\"pt-1 flex gap-6 text-sm\">\r\n              <button\r\n                className=\"text-empire-gold hover:underline\"\r\n                onClick={() => openModal(\"levels_table\", { structureKey: s.key as BuildingKey })}\r\n              >\r\n                Levels Table\r\n              </button>\r\n              <button\r\n                className=\"text-yellow-400 hover:underline\"\r\n                onClick={() => window.alert(\"Downgrade not yet implemented\")}\r\n              >\r\n                Downgrade 1 Level\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <BuildTable<BuildingSpec>\r\n      title=\"Structures\"\r\n      firstColumnHeader=\"Structure\"\r\n      actionHeader=\"Build\"\r\n      summary={undefined}\r\n      loading={loading}\r\n      onRefresh={onRefresh}\r\n      items={structs}\r\n      getKey={(s) => s.key}\r\n      getTitleText={getTitleText}\r\n      getDescriptionText={getDescriptionText}\r\n      getEligibility={getEligibility}\r\n      columns={columns}\r\n      onAction={(s) => onStart(s.key as BuildingKey)}\r\n      actionLabel={(_, eligible, isLoading) => {\r\n        if (isLoading) return \"...\";\r\n        if (hasActive) {\r\n          return eligible ? \"Queue\" : \"Unavailable\";\r\n        }\r\n        return eligible ? \"Build\" : \"Unavailable\";\r\n      }}\r\n      actionTestIdPrefix=\"start\"\r\n      nameTestIdPrefix=\"name\"\r\n      defaultSort={(a, b) => a.creditsCost - b.creditsCost}\r\n      tableTestId=\"build-table\"\r\n    />\r\n  );\r\n};\r\n\r\nexport default StructuresBuildTable;\r\n","import * as React from \"react\";\r\n\r\ntype ToastType = \"success\" | \"info\" | \"error\";\r\n\r\nexport interface ToastItem {\r\n  id: string;\r\n  type: ToastType;\r\n  text: string;\r\n  durationMs?: number;\r\n}\r\n\r\ninterface ToastContextType {\r\n  toasts: ToastItem[];\r\n  addToast: (t: Omit<ToastItem, \"id\">) => string;\r\n  removeToast: (id: string) => void;\r\n  clearToasts: () => void;\r\n}\r\n\r\nconst ToastContext = React.createContext<ToastContextType | undefined>(undefined);\r\n\r\nexport const useToast = (): ToastContextType => {\r\n  const ctx = React.useContext(ToastContext);\r\n  if (!ctx) {\r\n    throw new Error(\"useToast must be used within a ToastProvider\");\r\n  }\r\n  return ctx;\r\n};\r\n\r\nexport const ToastProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [toasts, setToasts] = React.useState<ToastItem[]>([]);\r\n\r\n  const addToast = React.useCallback((t: Omit<ToastItem, \"id\">) => {\r\n    const id = Math.random().toString(36).slice(2);\r\n    const item: ToastItem = { id, ...t };\r\n    setToasts((prev) => [...prev, item]);\r\n\r\n    if (t.durationMs !== 0) {\r\n      const duration = typeof t.durationMs === \"number\" ? t.durationMs : 3500;\r\n      window.setTimeout(() => {\r\n        setToasts((prev) => prev.filter((x) => x.id !== id));\r\n      }, duration);\r\n    }\r\n    return id;\r\n  }, []);\r\n\r\n  const removeToast = React.useCallback((id: string) => {\r\n    setToasts((prev) => prev.filter((x) => x.id !== id));\r\n  }, []);\r\n\r\n  const clearToasts = React.useCallback(() => setToasts([]), []);\r\n\r\n  const value = React.useMemo(\r\n    () => ({ toasts, addToast, removeToast, clearToasts }),\r\n    [toasts, addToast, removeToast, clearToasts]\r\n  );\r\n\r\n  return <ToastContext.Provider value={value}>{children}</ToastContext.Provider>;\r\n};\r\n\r\n/**\r\n * Fixed viewport that renders toasts in the top-right corner.\r\n * Accessibility: role=\"status\" + aria-live=\"polite\"\r\n */\r\nexport const ToastViewport: React.FC = () => {\r\n  const { toasts, removeToast } = useToast();\r\n\r\n  return (\r\n    <div className=\"fixed top-4 right-4 z-50 space-y-2\">\r\n      {toasts.map((t) => {\r\n        const base = \"px-4 py-2 rounded shadow text-sm flex items-start gap-3\";\r\n        const color =\r\n          t.type === \"error\"\r\n            ? \"bg-red-900/70 text-red-200 border border-red-700\"\r\n            : t.type === \"success\"\r\n            ? \"bg-green-900/70 text-green-200 border border-green-700\"\r\n            : \"bg-gray-800/80 text-gray-200 border border-gray-700\";\r\n        const dotColor =\r\n          t.type === \"error\" ? \"bg-red-400\" : t.type === \"success\" ? \"bg-green-400\" : \"bg-blue-400\";\r\n        const title =\r\n          t.type === \"error\" ? \"Error\" : t.type === \"success\" ? \"Success\" : \"Notice\";\r\n\r\n        return (\r\n          <div\r\n            key={t.id}\r\n            className={`${base} ${color}`}\r\n            role=\"status\"\r\n            aria-live=\"polite\"\r\n            title={title}\r\n          >\r\n            <span\r\n              className={`mt-1 inline-block w-2 h-2 rounded-full ${dotColor}`}\r\n            />\r\n            <div className=\"flex-1\">{t.text}</div>\r\n            <button\r\n              className=\"text-xs text-gray-400 hover:text-white\"\r\n              onClick={() => removeToast(t.id)}\r\n              aria-label=\"Dismiss\"\r\n            >\r\n              \r\n            </button>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport { useNetwork } from \"../../contexts/NetworkContext\";\r\nimport { useToast } from \"../../contexts/ToastContext\";\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport type { TechnologyKey, TechnologySpec } from \"@game/shared\";\r\nimport { getTechCreditCostForLevel } from \"@game/shared\";\r\nimport type { TechStatusDTO } from \"../../services/techService\";\r\nimport { useModalStore } from \"../../stores/modalStore\";\r\nimport BuildTable, { type Column, type Eligibility } from \"./BuildTable\";\r\n\r\n/**\r\n * ResearchBuildTable (Research)\r\n * - Consolidated onto generic BuildTable to enforce unified styling/behavior\r\n * - Columns per .clinerules/tabular-build-ui-standard-and-test-plan.md:\r\n *   Technology | Credits | Labs | Requires | Effect | Time | Start\r\n */\r\ninterface ResearchBuildTableProps {\r\n  catalog: TechnologySpec[];\r\n  status: TechStatusDTO | null;\r\n  loading: boolean;\r\n  onRefresh: () => void;\r\n  onStart: (key: TechnologyKey) => Promise<void> | void;\r\n  onQueue?: (payload: any) => Promise<void>;\r\n  locationCoord?: string;\r\n  researchPerHour?: number;\r\n  activeResearch?: { key: TechnologyKey; completesAt: string } | null;\r\n}\r\n\r\nconst ResearchBuildTable: React.FC<ResearchBuildTableProps> = ({\r\n  catalog,\r\n  status,\r\n  loading,\r\n  onRefresh,\r\n  onStart,\r\n  onQueue,\r\n  locationCoord,\r\n  researchPerHour,\r\n  activeResearch,\r\n}) => {\r\n  const { openModal } = useModalStore();\r\n\r\n  const { isFullyConnected } = useNetwork();\r\n  const isOffline = !isFullyConnected;\r\n\r\n  const { empire } = useAuthStore();\r\n  const empireId = empire?._id;\r\n\r\n  const { addToast } = useToast();\r\n\r\n  // Active research (global gray-out)\r\n  const hasActive = !!activeResearch;\r\n\r\n  const handleStart = async (key: TechnologyKey) => {\r\n    if (isOffline) {\r\n      if (!onQueue || !locationCoord || !empireId) {\r\n        addToast({ type: 'error', text: 'Cannot queue: missing context' });\r\n        return;\r\n      }\r\n\r\n      const payload = {\r\n        kind: 'research' as const,\r\n        empireId,\r\n        locationCoord,\r\n        catalogKey: key,\r\n        identityKey: `${empireId}-research-${key}-${Date.now()}`,\r\n      };\r\n\r\n      try {\r\n        await onQueue(payload);\r\n        addToast({ type: 'success', text: 'Research queued for sync when online' });\r\n      } catch (error) {\r\n        console.error('Queue error:', error);\r\n        addToast({ type: 'error', text: 'Failed to queue research' });\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Online: call original onStart\r\n    if (onStart) {\r\n      await onStart(key);\r\n    }\r\n  };\r\n\r\n  // Tick every second while research is active to update countdown\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  const [, forceTick] = React.useReducer((x: number) => x + 1, 0);\r\n  React.useEffect(() => {\r\n    if (!hasActive) return;\r\n    const id = window.setInterval(() => forceTick(), 1000);\r\n    return () => window.clearInterval(id);\r\n  }, [hasActive, activeResearch?.completesAt]);\r\n\r\n\r\n\r\n  const formatDuration = (credits: number, perHour: number): string => {\r\n    const totalSeconds = Math.max(1, Math.round((credits / perHour) * 3600));\r\n    const h = Math.floor(totalSeconds / 3600);\r\n    const m = Math.floor((totalSeconds % 3600) / 60);\r\n    const s = totalSeconds % 60;\r\n    return `${h}h ${m}m ${s}s`;\r\n  };\r\n\r\n  const formatRequires = (t: TechnologySpec): string => {\r\n    if (!t.prerequisites || t.prerequisites.length === 0) return \"\";\r\n    return t.prerequisites.map((p) => `${p.key.replace(/_/g, \" \")} ${p.level}`).join(\", \");\r\n  };\r\n\r\n  const columns: Column<TechnologySpec>[] = [\r\n    {\r\n      key: \"credits\",\r\n      header: \"Credits\",\r\n      align: \"left\",\r\n      render: (t) => {\r\n        const level = Math.max(0, status?.techLevels[t.key as TechnologyKey] ?? 0);\r\n        const nextLevel = level + 1;\r\n        const nextCost = getTechCreditCostForLevel(t.key as TechnologyKey, nextLevel);\r\n        return nextCost.toLocaleString();\r\n      },\r\n    },\r\n    {\r\n      key: \"labs\",\r\n      header: \"Labs\",\r\n      align: \"left\",\r\n      render: (t) => t.requiredLabs,\r\n    },\r\n    {\r\n      key: \"requires\",\r\n      header: \"Requires\",\r\n      align: \"left\",\r\n      render: (t) => {\r\n        const text = formatRequires(t);\r\n        const hasReq = !!t.prerequisites && t.prerequisites.length > 0;\r\n        if (!hasReq) {\r\n          return <span className=\"text-gray-400\">{text}</span>;\r\n        }\r\n        const met = t.prerequisites.every((p) => {\r\n          const current = Math.max(0, status?.techLevels[p.key as TechnologyKey] ?? 0);\r\n          return current >= p.level;\r\n        });\r\n        return <span className={met ? \"text-green-400\" : \"text-red-400\"}>{text}</span>;\r\n      },\r\n    },\r\n    {\r\n      key: \"effect\",\r\n      header: \"Effect\",\r\n      align: \"left\",\r\n      render: (t) => (t.description ? \"\" : \"\"),\r\n    },\r\n    {\r\n      key: \"time\",\r\n      header: \"Time\",\r\n      align: \"left\",\r\n      render: (t) => {\r\n        const level = Math.max(0, status?.techLevels[t.key as TechnologyKey] ?? 0);\r\n        const nextLevel = level + 1;\r\n        const nextCost = getTechCreditCostForLevel(t.key as TechnologyKey, nextLevel);\r\n        return typeof researchPerHour === \"number\" && researchPerHour > 0\r\n          ? formatDuration(nextCost, researchPerHour)\r\n          : \"\";\r\n      },\r\n    },\r\n  ];\r\n\r\n  const getEligibility = (t: TechnologySpec): Eligibility => {\r\n    const elig = status?.eligibility[t.key as TechnologyKey];\r\n    const reasons = elig?.reasons || [];\r\n    // Credits-only blocked rows are allowed to enqueue\r\n    const creditsOnly = reasons.length > 0 && reasons.every((r) => /credit/i.test(String(r)));\r\n    // Allow queue behavior: enable all eligible rows to Queue (including the active one)\r\n    const canStart = !!elig?.canStart || creditsOnly;\r\n    return { canStart, reasons };\r\n  };\r\n\r\n  const getTitleText = (t: TechnologySpec): React.ReactNode => {\r\n    const level = Math.max(0, status?.techLevels[t.key as TechnologyKey] ?? 0);\r\n    return (\r\n      <div\r\n        className=\"text-white cursor-pointer hover:underline\"\r\n        data-testid={`name-${t.key}`}\r\n        onClick={() => openModal(\"research_levels_table\", { techKey: t.key as TechnologyKey })}\r\n      >\r\n        {t.name}\r\n        {level > 0 ? ` (Level ${level})` : \"\"}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const getDescriptionText = (t: TechnologySpec): React.ReactNode => {\r\n    return t.description ? <div className=\"text-xs text-gray-400\">{t.description}</div> : null;\r\n  };\r\n\r\n  // Summary (header right) per table standard: show Credits and Labs, plus Refresh button from BuildTable\r\n  const summary = status ? (\r\n    <div className=\"flex items-center gap-3\">\r\n      <div className=\"text-sm text-gray-300\">\r\n        Credits: <span className=\"text-empire-gold font-mono\">{status.credits.toLocaleString()}</span>\r\n      </div>\r\n      <div className=\"text-sm text-gray-300\">\r\n        Labs: <span className=\"text-blue-400 font-semibold\">{status.baseLabTotal}</span>\r\n      </div>\r\n    </div>\r\n  ) : (\r\n    <div className=\"text-sm text-gray-300\">Credits:   Labs: </div>\r\n  );\r\n\r\n  // Helper: determine if this row is credits-only blocked (eligible to queue even with no active)\r\n  const isCreditsOnlyBlocked = (t: TechnologySpec) => {\r\n    const elig = status?.eligibility[t.key as TechnologyKey];\r\n    const reasons = elig?.reasons || [];\r\n    return reasons.length > 0 && reasons.every((r) => /credit/i.test(String(r)));\r\n  };\r\n\r\n  return (\r\n    <BuildTable<TechnologySpec>\r\n      title=\"Base Research\"\r\n      firstColumnHeader=\"Technology\"\r\n      actionHeader=\"Start / Queue\"\r\n      summary={summary}\r\n      loading={loading}\r\n      onRefresh={onRefresh}\r\n      items={(catalog || []).slice().sort((a, b) => a.creditsCost - b.creditsCost)}\r\n      getKey={(t) => t.key}\r\n      getTitleText={getTitleText}\r\n      getDescriptionText={getDescriptionText}\r\n      getEligibility={getEligibility}\r\n      columns={columns}\r\n      onAction={(t) => handleStart(t.key as TechnologyKey)}\r\n      isOffline={isOffline}\r\n      actionLabel={(t, eligible, isLoading) => {\r\n        if (isLoading) return \"...\";\r\n        const creditOnly = isCreditsOnlyBlocked(t);\r\n        if (isOffline) {\r\n          return eligible ? \"Queue\" : \"Unavailable\";\r\n        }\r\n        if (hasActive) {\r\n          return eligible ? \"Queue\" : \"Unavailable\";\r\n        }\r\n        // No active research: if credits-only blocked, we enqueue\r\n        if (eligible && creditOnly) return \"Queue\";\r\n        return eligible ? \"Start\" : \"Unavailable\";\r\n      }}\r\n      actionTestIdPrefix=\"start\"\r\n      nameTestIdPrefix=\"name\"\r\n      defaultSort={(a, b) => a.creditsCost - b.creditsCost}\r\n      tableTestId=\"build-table\"\r\n    />\r\n  );\r\n};\r\n\r\nexport default ResearchBuildTable;\r\n","import * as React from \"react\";\r\nimport { getTechSpec, type TechnologyKey } from \"@game/shared\";\r\nimport techService from \"../../services/techService\";\r\n\r\ninterface TechQueueItem {\r\n  _id?: string;\r\n  locationCoord: string;\r\n  techKey: TechnologyKey;\r\n  startedAt: string | Date;\r\n  completesAt?: string | Date | null;\r\n  status: \"pending\" | \"completed\" | \"cancelled\";\r\n}\r\n\r\ninterface ResearchQueuePanelProps {\r\n  baseCoord?: string; // optional: filter by base; if omitted, show all pending for empire\r\n  onChanged?: () => void | Promise<void>; // notify parent to refresh credits/status/etc\r\n}\r\n\r\nconst formatEta = (msRemaining: number) => {\r\n  if (msRemaining <= 0) return \"Completing now\";\r\n  const totalSeconds = Math.ceil(msRemaining / 1000);\r\n  const hours = Math.floor(totalSeconds / 3600);\r\n  const minutes = Math.ceil((totalSeconds % 3600) / 60);\r\n  if (hours <= 0) return `${minutes}m`;\r\n  return `${hours}h ${minutes}m`;\r\n};\r\n\r\nconst percentBetween = (start: number, end: number, now: number) => {\r\n  const total = end - start;\r\n  if (total <= 0) return 100;\r\n  const elapsed = now - start;\r\n  return Math.max(0, Math.min(100, (elapsed / total) * 100));\r\n};\r\n\r\nconst ResearchQueuePanel: React.FC<ResearchQueuePanelProps> = ({ baseCoord, onChanged }) => {\r\n  const [queue, setQueue] = React.useState<TechQueueItem[]>([]);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const [tick, setTick] = React.useState(0);\r\n  const [cancelingId, setCancelingId] = React.useState<string | null>(null);\r\n\r\n  const fetchQueue = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await techService.getQueue(baseCoord);\r\n      if (res.success) {\r\n        setQueue(res.data?.queue || []);\r\n      } else {\r\n        setError(res.error || \"Failed to load research queue\");\r\n      }\r\n    } catch (e: any) {\r\n      setError(e?.response?.data?.error || \"Network error while loading research queue\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    fetchQueue();\r\n    const id = window.setInterval(() => setTick((t) => t + 1), 30000);\r\n    return () => clearInterval(id);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [baseCoord]);\r\n\r\n  const underway = React.useMemo(\r\n    () => queue.filter((q) => q.status === \"pending\" && !!q.completesAt),\r\n    [queue, tick]\r\n  );\r\n  const waiting = React.useMemo(\r\n    () => queue.filter((q) => q.status === \"pending\" && !q.completesAt),\r\n    [queue, tick]\r\n  );\r\n\r\n  const handleCancel = async (id?: string) => {\r\n    if (!id) return;\r\n    const yes = window.confirm(\"Cancel this research item?\");\r\n    if (!yes) return;\r\n\r\n    try {\r\n      setCancelingId(id);\r\n      const res = await techService.cancelQueueItem(id);\r\n      if (!res.success) {\r\n        setError(res.error || res.message || \"Failed to cancel queue item\");\r\n        return;\r\n      }\r\n      // Refresh list\r\n      await fetchQueue();\r\n      // Notify parent to refresh budgets/status where needed\r\n      if (onChanged) {\r\n        await onChanged();\r\n      }\r\n    } catch (e: any) {\r\n      setError(e?.response?.data?.error || \"Network error while cancelling\");\r\n    } finally {\r\n      setCancelingId(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"game-card\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Research Queue</h3>\r\n        <button\r\n          onClick={fetchQueue}\r\n          className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n          disabled={loading}\r\n        >\r\n          {loading ? \"Refreshing...\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {queue.length === 0 && !loading ? (\r\n        <div className=\"p-4 bg-gray-700 rounded-lg border border-gray-600 text-gray-300\">\r\n          No technology research queued.\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {/* Underway (scheduled) */}\r\n          <div>\r\n            <div className=\"text-sm text-gray-300 mb-2\">Underway</div>\r\n            {underway.length === 0 ? (\r\n              <div className=\"p-3 bg-gray-800/60 border border-gray-700 rounded text-gray-400\">\r\n                None currently underway.\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {underway.map((item) => {\r\n                  const spec = getTechSpec(item.techKey);\r\n                  const started = new Date(item.startedAt).getTime();\r\n                  const completes = new Date(item.completesAt as any).getTime();\r\n                  const now = Date.now();\r\n                  const percent = percentBetween(started, completes, now);\r\n                  const eta = formatEta(completes - now);\r\n\r\n                  return (\r\n                    <div\r\n                      key={item._id || `${item.techKey}-${item.locationCoord}-${item.startedAt}`}\r\n                      className=\"p-4 bg-gray-700 rounded-lg border border-gray-600\"\r\n                    >\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <div className=\"font-medium text-white flex items-center gap-2\">\r\n                          {spec.name} <span className=\"text-xs text-gray-400\">({item.techKey})</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-xs px-2 py-1 rounded bg-gray-800 text-purple-300\">\r\n                            {item.locationCoord}\r\n                          </span>\r\n                          <button\r\n                            onClick={() => handleCancel(item._id)}\r\n                            className=\"text-xs px-2 py-1 bg-red-700 text-white rounded hover:bg-red-800 disabled:opacity-50\"\r\n                            disabled={cancelingId === item._id}\r\n                            title=\"Cancel this research item\"\r\n                          >\r\n                            {cancelingId === item._id ? \"Cancelling...\" : \"Cancel\"}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {spec.description && (\r\n                        <p className=\"text-sm text-gray-400 mb-3\">{spec.description}</p>\r\n                      )}\r\n\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"w-full bg-gray-600 rounded-full h-2\">\r\n                          <div\r\n                            className=\"bg-purple-600 h-2 rounded-full transition-all duration-300\"\r\n                            style={{ width: `${Math.min(100, Math.max(0, percent))}%` }}\r\n                          />\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-between text-xs text-gray-400\">\r\n                          <span>{percent.toFixed(1)}% complete</span>\r\n                          <span>ETA: {eta}</span>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-between text-xs text-gray-500\">\r\n                          <span>Started: {new Date(item.startedAt).toLocaleString()}</span>\r\n                          <span>Completes: {new Date(item.completesAt as any).toLocaleString()}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Waiting (unscheduled) */}\r\n          <div>\r\n            <div className=\"text-sm text-gray-300 mb-2\">Waiting</div>\r\n            {waiting.length === 0 ? (\r\n              <div className=\"p-3 bg-gray-800/60 border border-gray-700 rounded text-gray-400\">\r\n                No queued items waiting for credits/capacity.\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                {waiting.map((item, idx) => {\r\n                  const spec = getTechSpec(item.techKey);\r\n                  return (\r\n                    <div\r\n                      key={item._id || `${item.techKey}-${item.locationCoord}-${item.startedAt}-waiting`}\r\n                      className=\"flex items-center justify-between p-3 bg-gray-800/60 border border-gray-700 rounded\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <span className=\"text-xs text-gray-400 w-5 text-right\">{idx + 1}.</span>\r\n                        <div className=\"text-white\">\r\n                          {spec.name} <span className=\"text-xs text-gray-400\">({item.techKey})</span>\r\n                        </div>\r\n                        <span className=\"text-xs px-2 py-1 rounded bg-gray-900 text-purple-300\">\r\n                          {item.locationCoord}\r\n                        </span>\r\n                        <span className=\"text-xs text-gray-400\">(Queued)</span>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => handleCancel(item._id)}\r\n                        className=\"text-xs px-2 py-1 bg-red-700 text-white rounded hover:bg-red-800 disabled:opacity-50\"\r\n                        disabled={cancelingId === item._id}\r\n                        title=\"Cancel this queued item\"\r\n                      >\r\n                        {cancelingId === item._id ? \"Cancelling...\" : \"Cancel\"}\r\n                      </button>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResearchQueuePanel;\r\n","import * as React from \"react\";\r\nimport { getBuildingSpec, type BuildingKey } from \"@game/shared\";\r\nimport structuresService from \"../../services/structuresService\";\r\n\r\ninterface StructureQueueItem {\r\n  _id?: string;\r\n  locationCoord: string;\r\n  catalogKey?: BuildingKey | string;\r\n  displayName?: string;\r\n  constructionStarted?: string | Date | null;\r\n  constructionCompleted?: string | Date | null;\r\n  pendingUpgrade?: boolean;\r\n  isActive?: boolean; // should be false for queued\r\n}\r\n\r\ninterface StructuresQueuePanelProps {\r\n  baseCoord?: string; // optional: filter by base; if omitted, show all pending for empire\r\n  onChanged?: () => void | Promise<void>; // notify parent to refresh credits/status/etc\r\n}\r\n\r\nconst formatEta = (msRemaining: number) => {\r\n  if (msRemaining <= 0) return \"Completing now\";\r\n  const totalSeconds = Math.ceil(msRemaining / 1000);\r\n  const hours = Math.floor(totalSeconds / 3600);\r\n  const minutes = Math.ceil((totalSeconds % 3600) / 60);\r\n  if (hours <= 0) return `${minutes}m`;\r\n  return `${hours}h ${minutes}m`;\r\n};\r\n\r\nconst percentBetween = (start: number, end: number, now: number) => {\r\n  const total = end - start;\r\n  if (total <= 0) return 100;\r\n  const elapsed = now - start;\r\n  return Math.max(0, Math.min(100, (elapsed / total) * 100));\r\n};\r\n\r\nconst resolveName = (item: StructureQueueItem) => {\r\n  const key = (item.catalogKey || \"\") as BuildingKey | string;\r\n  if (key) {\r\n    try {\r\n      return getBuildingSpec(key as BuildingKey).name;\r\n    } catch {\r\n      // fall through\r\n    }\r\n  }\r\n  return item.displayName || String(key || \"Unknown Structure\");\r\n};\r\n\r\nconst StructuresQueuePanel: React.FC<StructuresQueuePanelProps> = ({ baseCoord, onChanged }) => {\r\n  const [queue, setQueue] = React.useState<StructureQueueItem[]>([]);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const [success, setSuccess] = React.useState<string | null>(null);\r\n  const [tick, setTick] = React.useState(0);\r\n  const [cancelingId, setCancelingId] = React.useState<string | null>(null);\r\n\r\n  const fetchQueue = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    setSuccess(null);\r\n    try {\r\n      const res = await structuresService.getQueue(baseCoord);\r\n      if (res.success) {\r\n        setQueue(res.data?.queue || []);\r\n      } else {\r\n        setError((res as any).error || \"Failed to load construction queue\");\r\n      }\r\n    } catch (e: any) {\r\n      setError(e?.response?.data?.error || \"Network error while loading construction queue\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    fetchQueue();\r\n    const id = window.setInterval(() => setTick((t) => t + 1), 30000);\r\n    return () => clearInterval(id);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [baseCoord]);\r\n\r\n  const underway = React.useMemo(\r\n    () => queue.filter((q) => !!q.constructionCompleted),\r\n    [queue, tick]\r\n  );\r\n  const waiting = React.useMemo(\r\n    () => queue.filter((q) => !q.constructionCompleted),\r\n    [queue, tick]\r\n  );\r\n\r\n  const handleCancel = async (id?: string) => {\r\n    if (!id) return;\r\n    const yes = window.confirm(\"Cancel this construction item?\");\r\n    if (!yes) return;\r\n\r\n    try {\r\n      setCancelingId(id);\r\n      const res = await structuresService.cancelQueueItem(id);\r\n      if (!res.success) {\r\n        setError((res as any).error || res.message || \"Failed to cancel queue item\");\r\n        return;\r\n      }\r\n      // Show refunded amount (if provided)\r\n      const refunded = Number(res.data?.refundedCredits || 0);\r\n      if (refunded > 0) {\r\n        setSuccess(`Cancelled. Refunded ${refunded.toLocaleString()} credits.`);\r\n        // auto-clear after a short delay\r\n        window.setTimeout(() => setSuccess(null), 4000);\r\n      } else {\r\n        setSuccess(\"Construction queue item cancelled.\");\r\n        window.setTimeout(() => setSuccess(null), 3000);\r\n      }\r\n      // Refresh list\r\n      await fetchQueue();\r\n      // Notify parent to refresh budgets/status where needed\r\n      if (onChanged) {\r\n        await onChanged();\r\n      }\r\n    } catch (e: any) {\r\n      setError(e?.response?.data?.error || \"Network error while cancelling\");\r\n    } finally {\r\n      setCancelingId(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"game-card\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Construction Queue</h3>\r\n        <button\r\n          onClick={fetchQueue}\r\n          className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n          disabled={loading}\r\n        >\r\n          {loading ? \"Refreshing...\" : \"Refresh\"}\r\n        </button>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      {success && (\r\n        <div className=\"p-3 bg-green-900/40 border border-green-700 rounded-md text-green-200 mb-3\">\r\n          {success}\r\n        </div>\r\n      )}\r\n\r\n      {queue.length === 0 && !loading ? (\r\n        <div className=\"p-4 bg-gray-700 rounded-lg border border-gray-600 text-gray-300\">\r\n          No structures queued for construction.\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {/* Underway (scheduled) */}\r\n          <div>\r\n            <div className=\"text-sm text-gray-300 mb-2\">Underway</div>\r\n            {underway.length === 0 ? (\r\n              <div className=\"p-3 bg-gray-800/60 border border-gray-700 rounded text-gray-400\">\r\n                None currently underway.\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {underway.map((item) => {\r\n                  const name = resolveName(item);\r\n                  const started = item.constructionStarted ? new Date(item.constructionStarted).getTime() : Date.now();\r\n                  const completes = new Date(item.constructionCompleted as any).getTime();\r\n                  const now = Date.now();\r\n                  const percent = percentBetween(started, completes, now);\r\n                  const eta = formatEta(completes - now);\r\n                  // If this item is scheduled to start later, surface the wait time explicitly.\r\n                  const startsInMs =\r\n                    Number.isFinite(started) && started > now ? Math.max(0, started - now) : 0;\r\n\r\n                  return (\r\n                    <div\r\n                      key={item._id || `${item.catalogKey}-${item.locationCoord}-${item.constructionStarted}`}\r\n                      className=\"p-4 bg-gray-700 rounded-lg border border-gray-600\"\r\n                    >\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <div className=\"font-medium text-white flex items-center gap-2\">\r\n                          {name}\r\n                          {item.catalogKey && (\r\n                            <span className=\"text-xs text-gray-400\">({String(item.catalogKey)})</span>\r\n                          )}\r\n                          {item.pendingUpgrade ? (\r\n                            <span className=\"text-xs text-yellow-300 ml-2\">(Upgrade)</span>\r\n                          ) : (\r\n                            <span className=\"text-xs text-blue-300 ml-2\">(New)</span>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-xs px-2 py-1 rounded bg-gray-800 text-blue-300\">\r\n                            {item.locationCoord}\r\n                          </span>\r\n                          <button\r\n                            onClick={() => handleCancel(item._id)}\r\n                            className=\"text-xs px-2 py-1 bg-red-700 text-white rounded hover:bg-red-800 disabled:opacity-50\"\r\n                            disabled={cancelingId === item._id}\r\n                            title=\"Cancel this construction item\"\r\n                          >\r\n                            {cancelingId === item._id ? \"Cancelling...\" : \"Cancel\"}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"w-full bg-gray-600 rounded-full h-2\">\r\n                          <div\r\n                            className=\"bg-green-600 h-2 rounded-full transition-all duration-300\"\r\n                            style={{ width: `${Math.min(100, Math.max(0, percent))}%` }}\r\n                          />\r\n                        </div>\r\n\r\n                        {startsInMs > 0 && (\r\n                          <div className=\"text-xs text-gray-400\">\r\n                            Starts in: {formatEta(startsInMs)}\r\n                          </div>\r\n                        )}\r\n\r\n                        <div className=\"flex justify-between text-xs text-gray-400\">\r\n                          <span>{percent.toFixed(1)}% complete</span>\r\n                          <span>ETA: {eta}</span>\r\n                        </div>\r\n\r\n                        <div className=\"flex justify-between text-xs text-gray-500\">\r\n                          <span>\r\n                            Started:{\" \"}\r\n                            {item.constructionStarted\r\n                              ? new Date(item.constructionStarted).toLocaleString()\r\n                              : \"\"}\r\n                          </span>\r\n                          <span>Completes: {new Date(item.constructionCompleted as any).toLocaleString()}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Waiting (unscheduled) */}\r\n          <div>\r\n            <div className=\"text-sm text-gray-300 mb-2\">Waiting</div>\r\n            {waiting.length === 0 ? (\r\n              <div className=\"p-3 bg-gray-800/60 border border-gray-700 rounded text-gray-400\">\r\n                No queued items waiting for credits/capacity.\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-2\">\r\n                {waiting.map((item, idx) => {\r\n                  const name = resolveName(item);\r\n                  return (\r\n                    <div\r\n                      key={item._id || `${item.catalogKey}-${item.locationCoord}-${item.constructionStarted}-waiting`}\r\n                      className=\"flex items-center justify-between p-3 bg-gray-800/60 border border-gray-700 rounded\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <span className=\"text-xs text-gray-400 w-5 text-right\">{idx + 1}.</span>\r\n                        <div className=\"text-white\">\r\n                          {name}{\" \"}\r\n                          {item.catalogKey && (\r\n                            <span className=\"text-xs text-gray-400\">({String(item.catalogKey)})</span>\r\n                          )}\r\n                        </div>\r\n                        <span className=\"text-xs px-2 py-1 rounded bg-gray-900 text-blue-300\">\r\n                          {item.locationCoord}\r\n                        </span>\r\n                        <span className=\"text-xs text-gray-400\">(Queued)</span>\r\n                        {item.pendingUpgrade ? (\r\n                          <span className=\"text-xs text-yellow-300 ml-1\">(Upgrade)</span>\r\n                        ) : null}\r\n                      </div>\r\n                      <button\r\n                        onClick={() => handleCancel(item._id)}\r\n                        className=\"text-xs px-2 py-1 bg-red-700 text-white rounded hover:bg-red-800 disabled:opacity-50\"\r\n                        disabled={cancelingId === item._id}\r\n                        title=\"Cancel this queued item\"\r\n                      >\r\n                        {cancelingId === item._id ? \"Cancelling...\" : \"Cancel\"}\r\n                      </button>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StructuresQueuePanel;\r\n","import React from \"react\";\r\nimport { useNetwork } from \"../../contexts/NetworkContext\";\r\nimport { useToast } from \"../../contexts/ToastContext\";\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport type { DefenseKey, DefenseSpec } from \"@game/shared\";\r\nimport type { DefensesStatusDTO } from \"../../services/defensesService\";\r\nimport BuildTable, { type Column, type Eligibility } from \"./BuildTable\";\r\n\r\n/**\r\n * DefensesBuildTable\r\n * - Consolidated onto generic BuildTable to enforce unified styling/behavior\r\n * - Columns per .clinerules/tabular-build-ui-standard-and-test-plan.md:\r\n *   Defense | Credits | Energy | Area | Requires | Start\r\n */\r\ninterface DefensesBuildTableProps {\r\n  catalog: DefenseSpec[];\r\n  status: DefensesStatusDTO | null;\r\n  loading: boolean;\r\n  onRefresh: () => void;\r\n  onStart: (key: DefenseKey) => Promise<void> | void;\r\n  onQueue?: (payload: any) => Promise<any>;\r\n  locationCoord?: string;\r\n}\r\n\r\nconst DefensesBuildTable: React.FC<DefensesBuildTableProps> = ({\r\n  catalog,\r\n  status,\r\n  loading,\r\n  onRefresh,\r\n  onStart,\r\n  onQueue,\r\n  locationCoord,\r\n}) => {\r\n  const formatRequires = (d: DefenseSpec): string => {\r\n    if (!d.techPrereqs || d.techPrereqs.length === 0) return \"\";\r\n    return d.techPrereqs.map((p) => `${p.key.replace(/_/g, \" \")} ${p.level}`).join(\", \");\r\n  };\r\n\r\n  const renderArea = (d: DefenseSpec): string => {\r\n    if (typeof d.areaRequired === \"number\") {\r\n      return d.areaRequired === 0 ? \"\" : `-${d.areaRequired}`;\r\n    }\r\n    // Default: most items cost 1 area\r\n    return \"-1\";\r\n  };\r\n\r\n  const getDefenseDescriptor = (d: DefenseSpec): string => {\r\n    const parts: string[] = [];\r\n    if (d.weapon) parts.push(`Weapon: ${d.weapon}`);\r\n    if (typeof d.attack === \"number\") parts.push(`Attack ${d.attack}`);\r\n    if (typeof d.armour === \"number\") parts.push(`Armour ${d.armour}`);\r\n    if (typeof d.shield === \"number\") parts.push(`Shield ${d.shield}`);\r\n    return parts.length ? parts.join(\"  \") : \"\";\r\n  };\r\n\r\n  // Optional: preserve prior UX when no status is available\r\n  if (!status) {\r\n    return (\r\n      <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h3 className=\"text-lg font-semibold text-empire-gold\">Defenses</h3>\r\n          <button\r\n            onClick={onRefresh}\r\n            className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n          >\r\n            {loading ? \"Loading...\" : \"Refresh\"}\r\n          </button>\r\n        </div>\r\n        <div className=\"text-gray-400\">\r\n          {loading ? \"Loading defenses...\" : \"No status available.\"}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const columns: Column<DefenseSpec>[] = [\r\n    {\r\n      key: \"credits\",\r\n      header: \"Credits\",\r\n      align: \"left\",\r\n      render: (d) => d.creditsCost.toLocaleString(),\r\n    },\r\n    {\r\n      key: \"energy\",\r\n      header: \"Energy\",\r\n      align: \"left\",\r\n      render: (d) => (d.energyDelta === 0 ? \"\" : String(d.energyDelta)),\r\n    },\r\n    {\r\n      key: \"area\",\r\n      header: \"Area\",\r\n      align: \"left\",\r\n      render: (d) => renderArea(d),\r\n    },\r\n    {\r\n      key: \"requires\",\r\n      header: \"Requires\",\r\n      align: \"left\",\r\n      render: (d) => {\r\n        const text = formatRequires(d);\r\n        const hasReq = !!d.techPrereqs && d.techPrereqs.length > 0;\r\n        if (!hasReq) {\r\n          return <span className=\"text-gray-400\">{text}</span>;\r\n        }\r\n        const techLevels = (status?.techLevels as Record<string, number>) || {};\r\n        const met = d.techPrereqs!.every((p) => (techLevels[p.key] ?? 0) >= p.level);\r\n        return <span className={met ? \"text-green-400\" : \"text-red-400\"}>{text}</span>;\r\n      },\r\n    },\r\n  ];\r\n\r\n  const { isFullyConnected } = useNetwork();\r\n  const { addToast } = useToast();\r\n  const { empire } = useAuthStore();\r\n\r\n  const handleStart = async (key: string) => {\r\n    if (!isFullyConnected) {\r\n      if (!empire) {\r\n        addToast({ type: 'error', text: 'Not authenticated' });\r\n        return;\r\n      }\r\n      const payload = {\r\n        empireId: empire._id,\r\n        locationCoord,\r\n        catalogKey: key,\r\n      };\r\n      const options = {\r\n        identityKey: `${empire._id}:${locationCoord}:${key}`,\r\n      };\r\n      if (!window.desktop?.eventQueue) {\r\n        addToast({ type: 'error', text: 'Desktop API not available' });\r\n        return;\r\n      }\r\n      const res = await window.desktop.eventQueue.enqueue('defenses', payload, options);\r\n      if (res?.success) {\r\n        addToast({ type: 'success', text: `Queued ${key} for sync` });\r\n      } else {\r\n        addToast({ type: 'error', text: res?.error || 'Failed to queue defense' });\r\n      }\r\n      return;\r\n    }\r\n    onStart?.(key as DefenseKey);\r\n  };\r\n  \r\n  const handleQueue = async (payload: any) => {\r\n    return onQueue ? await onQueue(payload) : { success: false, error: 'Queue not available' };\r\n  };\r\n\r\n  const getEligibility = (d: DefenseSpec): Eligibility => {\r\n    const elig = status.eligibility[d.key as DefenseKey];\r\n    return {\r\n      canStart: !!elig?.canStart,\r\n      reasons: elig?.reasons || [],\r\n    };\r\n  };\r\n\r\n  return (\r\n    <BuildTable<DefenseSpec>\r\n      title=\"Defenses\"\r\n      firstColumnHeader=\"Defense\"\r\n      actionHeader=\"Start\"\r\n      summary={undefined}\r\n      loading={loading}\r\n      onRefresh={onRefresh}\r\n      items={(catalog || [])}\r\n      getKey={(d) => d.key}\r\n      getTitleText={(d) => d.name}\r\n      getDescriptionText={(d) => getDefenseDescriptor(d)}\r\n      getEligibility={getEligibility}\r\n      columns={columns}\r\n      onAction={(d) => handleStart(d.key as DefenseKey)}\r\n      onQueue={handleQueue}\r\n      isOffline={!isFullyConnected}\r\n      actionLabel={(_d, eligible, isLoading, isOffline) => {\r\n        if (isLoading) return \"...\";\r\n        if (isOffline) {\r\n          return eligible ? \"Queue\" : \"Unavailable\";\r\n        }\r\n        return eligible ? \"Start\" : \"Unavailable\";\r\n      }}\r\n      actionTestIdPrefix=\"start\"\r\n      nameTestIdPrefix=\"name\"\r\n      defaultSort={(a, b) => a.creditsCost - b.creditsCost}\r\n      tableTestId=\"build-table\"\r\n    />\r\n  );\r\n};\r\n\r\nexport default DefensesBuildTable;\r\n","import * as React from \"react\";\r\nimport { useMemo, useState } from \"react\";\r\nimport type { UnitKey, UnitSpec } from \"@game/shared\";\r\nimport type { UnitsStatusDTO } from \"../../services/unitsService\";\r\n\r\n/**\r\n * UnitsBuildTable (Fleets  Quantity-based UI)\r\n *\r\n * Phase 1 (UI only):\r\n * - Replace per-row Start button with a numeric Quantity input\r\n * - Compute per-unit time from production capacity (credits/capacity per hour)\r\n * - Show running totals (credits and time) with Reset/Submit controls\r\n * - Submit is wired via onSubmit prop; server quantity support comes in a later phase\r\n */\r\n\r\ninterface UnitsBuildTableProps {\r\n  catalog: UnitSpec[];\r\n  status: UnitsStatusDTO | null;\r\n  loading: boolean;\r\n  onRefresh: () => void;\r\n  onQueue?: (items: { key: UnitKey; quantity: number }[], totals: { credits: number; minutes: number }) => Promise<void>;\r\n  isOffline?: boolean;\r\n\r\n  // Production capacity (credits per hour) for this base\r\n  productionPerHour?: number | null;\r\n\r\n  // Called when user clicks Submit with non-zero quantities\r\n  onSubmit?: (\r\n    items: { key: UnitKey; quantity: number }[],\r\n    totals: { credits: number; minutes: number }\r\n  ) => void | Promise<void>;\r\n}\r\n\r\nconst formatRequires = (u: UnitSpec): { text: string; hasRequirements: boolean } => {\r\n  const techs = (u.techPrereqs || [])\r\n    .map((p) => `${p.key.replace(/_/g, \" \")} ${p.level}`)\r\n    .join(\", \");\r\n\r\n  const shipyardReq =\r\n    typeof u.requiredShipyardLevel === \"number\"\r\n      ? typeof u.requiredOrbitalShipyardLevel === \"number\"\r\n        ? `Shipyard ${u.requiredShipyardLevel} (Orbital ${u.requiredOrbitalShipyardLevel})`\r\n        : `Shipyard ${u.requiredShipyardLevel}`\r\n      : \"\";\r\n\r\n  const parts: string[] = [];\r\n  if (techs) parts.push(techs);\r\n  if (shipyardReq) parts.push(shipyardReq);\r\n\r\n  const text = parts.length ? parts.join(\"  \") : \"\";\r\n  const hasRequirements = parts.length > 0;\r\n  return { text, hasRequirements };\r\n};\r\n\r\nconst getDescriptor = (u: UnitSpec): string => {\r\n  const parts: string[] = [];\r\n  parts.push(`Drive: ${u.drive ?? \"\"}`);\r\n  parts.push(`Weapon: ${u.weapon ?? \"\"}`);\r\n  if (typeof u.speed !== \"undefined\") parts.push(`Speed: ${u.speed}`);\r\n  if (typeof u.hangar !== \"undefined\") parts.push(`Hangar: ${u.hangar}`);\r\n  return parts.join(\"  \");\r\n};\r\n\r\nfunction minutesFromCredits(creditsCost: number, productionPerHour?: number | null): number | null {\r\n  const cap = Math.max(0, Number(productionPerHour || 0));\r\n  if (!Number.isFinite(cap) || cap <= 0) return null;\r\n  const hours = creditsCost / cap;\r\n  const minutes = Math.max(1, Math.ceil(hours * 60));\r\n  return minutes;\r\n}\r\n\r\nfunction formatMinutes(totalMinutes: number): string {\r\n  if (!Number.isFinite(totalMinutes) || totalMinutes <= 0) return \"0m\";\r\n  const h = Math.floor(totalMinutes / 60);\r\n  const m = totalMinutes % 60;\r\n  if (h > 0) return `${h}h ${m}m`;\r\n  return `${m}m`;\r\n}\r\n\r\nconst UnitsBuildTable: React.FC<UnitsBuildTableProps> = ({\r\n  catalog,\r\n  status,\r\n  loading,\r\n  onRefresh,\r\n  productionPerHour,\r\n  onSubmit,\r\n}) => {\r\n  const [quantities, setQuantities] = useState<Record<string, number>>({});\r\n\r\n\r\n  const items = useMemo(() => catalog || [], [catalog]);\r\n\r\n  const perUnitMinutesByKey = useMemo(() => {\r\n    const map = new Map<string, number | null>();\r\n    for (const u of items) {\r\n      map.set(u.key, minutesFromCredits(u.creditsCost, productionPerHour));\r\n    }\r\n    return map;\r\n  }, [items, productionPerHour]);\r\n\r\n  const totals = useMemo(() => {\r\n    let totalCredits = 0;\r\n    let totalMinutes = 0;\r\n    for (const u of items) {\r\n      const q = Math.max(0, Math.floor(quantities[u.key] || 0));\r\n      if (q <= 0) continue;\r\n      totalCredits += q * Math.max(0, Number(u.creditsCost || 0));\r\n      const perMin = perUnitMinutesByKey.get(u.key) ?? null;\r\n      if (perMin && perMin > 0) {\r\n        totalMinutes += q * perMin;\r\n      }\r\n    }\r\n    return { totalCredits, totalMinutes };\r\n  }, [items, quantities, perUnitMinutesByKey]);\r\n\r\n  const handleChangeQty = (key: string, value: string) => {\r\n    const n = Math.max(0, Math.floor(Number(value || 0)));\r\n    setQuantities((prev) => ({ ...prev, [key]: n }));\r\n  };\r\n\r\n  const handleReset = () => setQuantities({});\r\n\r\n  const handleSubmit = async () => {\r\n    const payload = items\r\n      .map((u) => ({ key: u.key as UnitKey, quantity: Math.max(0, Math.floor(quantities[u.key] || 0)) }))\r\n      .filter((p) => p.quantity > 0);\r\n\r\n    if (payload.length === 0) return;\r\n\r\n    if (typeof onSubmit === \"function\") {\r\n      await onSubmit(payload, { credits: totals.totalCredits, minutes: totals.totalMinutes });\r\n    } else {\r\n      // Temporary placeholder if no handler provided\r\n      // eslint-disable-next-line no-alert\r\n      alert(\r\n        `Submit not yet wired.\\nTotal credits: ${totals.totalCredits.toLocaleString()}\\nTotal time: ${formatMinutes(\r\n          totals.totalMinutes\r\n        )}`\r\n      );\r\n    }\r\n  };\r\n\r\n  const getEligibility = (u: UnitSpec): { canStart: boolean; reasons: string[] } => {\r\n    const elig = status?.eligibility?.[u.key as UnitKey];\r\n    return {\r\n      canStart: !!elig?.canStart,\r\n      reasons: elig?.reasons || [],\r\n    };\r\n  };\r\n\r\n  return (\r\n    <div className=\"game-card !bg-gray-900 border border-gray-700\">\r\n      {/* Header with summary & controls */}\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold\">Fleets</h3>\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"text-xs text-gray-300\">\r\n            <span className=\"mr-4\">\r\n              Total credits:{\" \"}\r\n              <span className=\"font-mono text-white\">{totals.totalCredits.toLocaleString()}</span>\r\n            </span>\r\n            <span>\r\n              Total time: <span className=\"font-mono text-white\">{formatMinutes(totals.totalMinutes)}</span>\r\n            </span>\r\n          </div>\r\n          <button\r\n            onClick={onRefresh}\r\n            className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n          >\r\n            {loading ? \"Loading...\" : \"Refresh\"}\r\n          </button>\r\n          <button\r\n            onClick={handleReset}\r\n            className=\"text-xs px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-800\"\r\n          >\r\n            Reset\r\n          </button>\r\n          <button\r\n            onClick={handleSubmit}\r\n            disabled={loading || totals.totalCredits <= 0}\r\n            className={`text-xs px-3 py-1 rounded ${\r\n              loading || totals.totalCredits <= 0\r\n                ? \"bg-gray-600 text-gray-400 cursor-not-allowed\"\r\n                : \"bg-blue-600 hover:bg-blue-700 text-white\"\r\n            }`}\r\n          >\r\n            Submit\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead className=\"sticky top-0 bg-gray-800\">\r\n            <tr className=\"text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 px-3 text-left\">Unit</th>\r\n              <th className=\"py-2 px-3 text-left\">Credits</th>\r\n              <th className=\"py-2 px-3 text-left\">Energy</th>\r\n              <th className=\"py-2 px-3 text-left\">Hangar</th>\r\n              <th className=\"py-2 px-3 text-left\">Time</th>\r\n              <th className=\"py-2 px-3 text-right\">Quantity</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {items.map((u) => {\r\n              const key = u.key;\r\n              const { canStart, reasons } = getEligibility(u);\r\n              const reasonsLine =\r\n                !canStart && Array.isArray(reasons) && reasons.length > 0 ? reasons.join(\"; \") : \"\";\r\n\r\n              const perUnitMinutes = perUnitMinutesByKey.get(key) ?? null;\r\n\r\n              return (\r\n                <tr key={key} className=\"border-b border-gray-800 hover:bg-gray-800/60\">\r\n                  {/* Name + descriptor + reasons */}\r\n                  <td className=\"py-2 px-3 align-top\">\r\n                    <div className=\"text-white\">{u.name}</div>\r\n                    <div className=\"text-xs text-gray-400\">{getDescriptor(u)}</div>\r\n                    {reasonsLine && (\r\n                      <div className=\"text-xs text-red-300 mt-1\">{reasonsLine}</div>\r\n                    )}\r\n                    {/* Requirements summary (tech/shipyard) */}\r\n                    {formatRequires(u).hasRequirements && (\r\n                      <div className=\"text-xs text-gray-500 mt-1\">{formatRequires(u).text}</div>\r\n                    )}\r\n                  </td>\r\n\r\n                  {/* Credits */}\r\n                  <td className=\"py-2 px-3 align-top\">\r\n                    {u.creditsCost.toLocaleString()}\r\n                  </td>\r\n\r\n                  {/* Energy */}\r\n                  <td className=\"py-2 px-3 align-top\">\r\n                    {u.energyDelta === 0 || typeof u.energyDelta !== \"number\" ? \"\" : String(u.energyDelta)}\r\n                  </td>\r\n\r\n                  {/* Hangar */}\r\n                  <td className=\"py-2 px-3 align-top\">\r\n                    {typeof u.hangar === \"number\" && u.hangar !== 0 ? u.hangar : \"\"}\r\n                  </td>\r\n\r\n                  {/* Time (per unit) */}\r\n                  <td className=\"py-2 px-3 align-top\">\r\n                    {perUnitMinutes && perUnitMinutes > 0 ? formatMinutes(perUnitMinutes) : \"\"}\r\n                  </td>\r\n\r\n                  {/* Quantity input */}\r\n                  <td className=\"py-2 px-3 align-top text-right\">\r\n                    <input\r\n                      type=\"number\"\r\n                      min={0}\r\n                      step={1}\r\n                      inputMode=\"numeric\"\r\n                      pattern=\"[0-9]*\"\r\n                      value={quantities[key] ?? \"\"}\r\n                      onChange={(e) => handleChangeQty(key, e.target.value)}\r\n                      disabled={!canStart || loading}\r\n                      title={!canStart && reasonsLine ? reasonsLine : undefined}\r\n                      className={`w-24 px-2 py-1 rounded text-right font-mono bg-gray-800 border ${\r\n                        canStart && !loading\r\n                          ? \"border-gray-600 text-white\"\r\n                          : \"border-gray-700 text-gray-400 cursor-not-allowed\"\r\n                      }`}\r\n                    />\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Footer note about capacity source */}\r\n      <div className=\"px-3 py-2 text-xs text-gray-400\">\r\n        {productionPerHour && productionPerHour > 0\r\n          ? `Time is computed from production capacity: ${productionPerHour.toLocaleString()} credits/hour`\r\n          : \"Time is unavailable until this base has production capacity.\"}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UnitsBuildTable;\r\n","import * as React from \"react\";\r\n\r\nexport interface StatLinkProps {\r\n  onClick: () => void;\r\n  /**\r\n   * Display text for the link button.\r\n   * Defaults to \"View breakdown \" to keep header stat cards consistent.\r\n   */\r\n  title?: string;\r\n  /**\r\n   * Optional test id passed through to the underlying button as data-testid.\r\n   */\r\n  dataTestId?: string;\r\n  /**\r\n   * Optional className override/extension if needed by callers.\r\n   */\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * StatLink\r\n * Small link-style button used in header stat cards to open breakdown modals.\r\n * Centralizes copy and styling to prevent drift across Area/Energy/Population.\r\n */\r\nexport const StatLink: React.FC<StatLinkProps> = ({\r\n  onClick,\r\n  title = \"View breakdown \",\r\n  dataTestId,\r\n  className,\r\n}) => {\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      className={[\"text-blue-400 hover:text-blue-300 text-xs\", className].filter(Boolean).join(\" \")}\r\n      {...(dataTestId ? { \"data-testid\": dataTestId } : {})}\r\n    >\r\n      {title}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default StatLink;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport type { FleetListRow } from '../../services/fleetsService';\r\nimport type {\r\n  TechnologySpec,\r\n  TechnologyKey,\r\n  BuildingSpec,\r\n  DefenseSpec,\r\n  UnitSpec,\r\n  BuildingKey\r\n} from '@game/shared';\r\nimport { getBuildingsList, computeEnergyBalance } from '@game/shared';\r\nimport techService, { TechStatusDTO } from '../../services/techService';\r\nimport structuresService, { StructuresStatusDTO } from '../../services/structuresService';\r\nimport defensesService, { DefensesStatusDTO } from '../../services/defensesService';\r\nimport unitsService, { UnitsStatusDTO } from '../../services/unitsService';\r\nimport fleetsService from '../../services/fleetsService';\r\nimport PlanetInfoBlock from './PlanetInfoBlock';\r\nimport PlanetVisual from './PlanetVisual';\r\nimport baseStatsService, { BaseStatsDTO } from '../../services/baseStatsService';\r\nimport basesService from '../../services/basesService';\r\nimport universeService from '../../services/universeService';\r\nimport StructuresBuildTable from './StructuresBuildTable';\r\nimport ResearchBuildTable from './ResearchBuildTable';\r\nimport ResearchQueuePanel from './ResearchQueuePanel';\r\nimport StructuresQueuePanel from './StructuresQueuePanel';\r\nimport DefensesBuildTable from './DefensesBuildTable';\r\nimport UnitsBuildTable from './UnitsBuildTable';\r\nimport capacitiesService, { CapacitiesDTO } from '../../services/capacitiesService';\r\nimport StatLink from '../ui/StatLink';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useModalStore } from '../../stores/modalStore';\r\nimport type { Building } from '@game/shared';\r\nimport { useNetwork } from '../../contexts/NetworkContext';\r\nimport { useToast } from '../../contexts/ToastContext';\r\n\r\n/** Helpers for building display names (catalog-key-first) */\r\nconst getBuildingLabel = (b: Building | ClientBuilding): string => {\r\n  // 1. Primary: API-provided displayName (basesService.getBaseStructures gives canonical names)\r\n  if (b.displayName && b.displayName.trim().length > 0) return b.displayName;\r\n\r\n  // 2. Fallback: catalogSpec lookup (shared catalog is authoritative)\r\n  if (b.catalogKey) {\r\n    try {\r\n      const buildings = getBuildingsList();\r\n      const spec = buildings.find(spec => spec.key === b.catalogKey);\r\n      if (spec) return spec.name;\r\n    } catch {\r\n      // catalog not yet loaded, fall through to fallback\r\n    }\r\n  }\r\n\r\n  // 3. Last resort: catalog key itself\r\n  return b.catalogKey || 'Unknown Structure';\r\n};\r\n\r\n// Local helper type to reflect file-based buildings for overview display\r\n// Making construction fields optional to handle mock data without type errors\r\ntype ClientBuilding = {\r\n  _id: string;\r\n  type: Building['type']; // Simpler type needed for overview display\r\n  displayName?: string;\r\n  catalogKey?: string;\r\n  level: number;\r\n  isActive: boolean;\r\n  constructionStarted?: Date | null; // Optional for mock data\r\n  constructionCompleted?: Date | null; // Optional for mock data\r\n  empireId: string;\r\n  locationCoord: string;\r\n};\r\n\r\nconst formatEta = (date?: string | Date | null) => {\r\n  if (!date) return '';\r\n  const ms = new Date(date).getTime() - Date.now();\r\n  if (ms <= 0) return 'Completing...';\r\n  const totalSec = Math.ceil(ms / 1000);\r\n  const m = Math.floor(totalSec / 60);\r\n  const s = totalSec % 60;\r\n  return `${m}m ${s}s`;\r\n};\r\n\r\nfunction StatItem({\r\n  label,\r\n  main,\r\n  sub\r\n}: {\r\n  label: string;\r\n  main: React.ReactNode;\r\n  sub?: React.ReactNode;\r\n}): JSX.Element {\r\n  return (\r\n    <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n      <div className=\"text-xs text-gray-400\">{label}</div>\r\n      <div className=\"mt-1 text-lg text-white font-mono\">{main}</div>\r\n      {sub && <div className=\"text-xs text-gray-400 mt-0.5\">{sub}</div>}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface BaseDetailProps {\r\n  base: any;\r\n  onBack: () => void;\r\n  initialActivePanel?: 'overview' | 'fleet' | 'defense' | 'research' | 'structures' | 'trade';\r\n  onPanelChange?: (panel: 'overview' | 'fleet' | 'defense' | 'research' | 'structures' | 'trade') => void;\r\n  onStart?: (key: string) => Promise<void> | void;\r\n}\r\n\r\nconst BaseDetail: React.FC<BaseDetailProps> = ({ base, onBack, initialActivePanel, onPanelChange, onStart }) => {\r\n  const [activePanel, setActivePanel] = useState<\r\n    'overview' | 'fleet' | 'defense' | 'research' | 'structures' | 'trade'\r\n  >(initialActivePanel ?? 'overview');\r\n  const [refreshKey, setRefreshKey] = useState(0);\r\n  // Sync with initialActivePanel from props (e.g., ?tab= in URL) so back/forward and refresh restore the tab\r\n  useEffect(() => {\r\n    if (initialActivePanel && initialActivePanel !== activePanel) {\r\n      setActivePanel(initialActivePanel);\r\n    }\r\n  }, [initialActivePanel]);\r\n  const [notice, setNotice] = useState<string | null>(null);\r\n  const showNotice = (msg: string) => {\r\n    setNotice(msg);\r\n    window.setTimeout(() => setNotice(null), 3000);\r\n  };\r\n\r\n  // Live buildings for Overview\r\n  const [buildings, setBuildings] = useState<ClientBuilding[]>([]);\r\n  const [buildingsLoading, setBuildingsLoading] = useState(false);\r\n  const [buildingsError, setBuildingsError] = useState<string | null>(null);\r\n\r\n  // Fleets (Garrison) state\r\n  const [fleetsLoading, setFleetsLoading] = useState(false);\r\n  const [fleetsError, setFleetsError] = useState<string | null>(null);\r\n  const [fleets, setFleets] = useState<FleetListRow[]>([]);\r\n\r\n  // Fleets (Overview)  MVP renders a single \"Garrison\" row based on completed unit production\r\n\r\n  // Header budgets (Area/Energy/Population)\r\n  const [baseStats, setBaseStats] = useState<BaseStatsDTO | null>(null);\r\n  const { checkAuth } = useAuthStore();\r\n  const { openModal } = useModalStore();\r\n\r\n  const refreshHeaderBudgets = async () => {\r\n    if (!base?.locationCoord) return;\r\n    try {\r\n      const res = await baseStatsService.get(base.locationCoord);\r\n      if (res.success && res.data) {\r\n        setBaseStats(res.data.stats);\r\n      }\r\n    } catch {\r\n      // ignore transient errors\r\n    } finally {\r\n      setRefreshKey((k) => k + 1);\r\n    }\r\n  };\r\n\r\n  const loadBuildings = async () => {\r\n    try {\r\n      setBuildingsError(null);\r\n      setBuildingsLoading(true);\r\n      const res = await basesService.getBaseStructures(base.locationCoord);\r\n      if (res.success && res.data) {\r\n        // Convert to legacy format for Overview display\r\n        const convertedBuildings: ClientBuilding[] = [];\r\n        for (const item of res.data.items) {\r\n          if (item.currentLevel > 0) {\r\n            const building: ClientBuilding = {\r\n              _id: `${base.locationCoord}-${item.key}`,\r\n              type: 'metal_mine', // Legacy type - not used in display\r\n              level: item.currentLevel,\r\n              isActive: true,\r\n              constructionStarted: null,\r\n              constructionCompleted: null,\r\n              displayName: item.name,\r\n              catalogKey: item.key,\r\n              empireId: base.empireId || '',\r\n              locationCoord: base.locationCoord\r\n            };\r\n            convertedBuildings.push(building);\r\n          }\r\n        }\r\n        setBuildings(convertedBuildings);\r\n      } else {\r\n        setBuildingsError(res.error || 'Failed to load buildings');\r\n      }\r\n    } catch {\r\n      setBuildingsError('Network error');\r\n    } finally {\r\n      setBuildingsLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadFleets = async () => {\r\n    if (!base?.locationCoord) return;\r\n    try {\r\n      setFleetsError(null);\r\n      setFleetsLoading(true);\r\n      const res = await fleetsService.getFleets(base.locationCoord);\r\n      if (res.success && res.data) {\r\n        setFleets(Array.isArray(res.data.fleets) ? res.data.fleets : []);\r\n      } else {\r\n        setFleetsError(res.error || 'Failed to load fleets');\r\n      }\r\n    } catch {\r\n      setFleetsError('Network error');\r\n    } finally {\r\n      setFleetsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (activePanel === 'overview' && base?.locationCoord) {\r\n      loadBuildings();\r\n      loadFleets();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activePanel, base?.locationCoord]);\r\n\r\n  // While any structures are under construction on Overview, poll and bump refreshKey\r\n  useEffect(() => {\r\n    if (activePanel !== 'overview') return;\r\n    if (!buildings || buildings.length === 0) return;\r\n    const hasInactive = buildings.some((b) => !b.isActive);\r\n    if (!hasInactive) return;\r\n\r\n    const id = window.setInterval(() => {\r\n      loadBuildings();\r\n      setRefreshKey((k) => k + 1);\r\n    }, 15000);\r\n\r\n    return () => {\r\n      window.clearInterval(id);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activePanel, buildings]);\r\n\r\n  // Research state\r\n  const [catalog, setCatalog] = useState<TechnologySpec[]>([]);\r\n  const [status, setStatus] = useState<TechStatusDTO | null>(null);\r\n  const [researchLoading, setResearchLoading] = useState(false);\r\n  const [researchError, setResearchError] = useState<string | null>(null);\r\n  const [activeResearch, setActiveResearch] = useState<{ key: TechnologyKey; completesAt: string } | null>(null);\r\n\r\n  // Structures state\r\n  const [structuresCatalog, setStructuresCatalog] = useState<BuildingSpec[]>([]);\r\n  const [structuresStatus, setStructuresStatus] = useState<StructuresStatusDTO | null>(null);\r\n  const [structuresLoading, setStructuresLoading] = useState(false);\r\n  const [structuresError, setStructuresError] = useState<string | null>(null);\r\n  const [baseLevels, setBaseLevels] = useState<Partial<Record<BuildingKey, number>>>({});\r\n  const [activeConstruction, setActiveConstruction] = useState<{ key: BuildingKey; completionAt: string } | null>(null);\r\n  const [constructionPerHour, setConstructionPerHour] = useState<number | undefined>(undefined);\r\n\r\n  // Capacities state (for time calculations in Structures table)\r\n  const [capacities, setCapacities] = useState<CapacitiesDTO | null>(null);\r\n  // Planet energy context for per-base Solar/Gas hints in Structures table\r\n  const [planetSolarEnergy, setPlanetSolarEnergy] = useState<number | null>(null);\r\n  const [planetGasYield, setPlanetGasYield] = useState<number | null>(null);\r\n  // Additional planet context for Metal/Crystals/Fertility hints\r\n  const [planetMetalYield, setPlanetMetalYield] = useState<number | null>(null);\r\n  const [planetCrystalsYield, setPlanetCrystalsYield] = useState<number | null>(null);\r\n  const [planetFertility, setPlanetFertility] = useState<number | null>(null);\r\n\r\n  // Defenses state\r\n  const [defensesCatalog, setDefensesCatalog] = useState<DefenseSpec[]>([]);\r\n  const [defensesStatus, setDefensesStatus] = useState<DefensesStatusDTO | null>(null);\r\n  const [defensesLoading, setDefensesLoading] = useState(false);\r\n  const [defensesError, setDefensesError] = useState<string | null>(null);\r\n\r\n  // Units state\r\n  const [unitsCatalog, setUnitsCatalog] = useState<UnitSpec[]>([]);\r\n  const [unitsStatus, setUnitsStatus] = useState<UnitsStatusDTO | null>(null);\r\n  const [unitsLoading, setUnitsLoading] = useState(false);\r\n  const [unitsError, setUnitsError] = useState<string | null>(null);\r\n\r\n  const loadResearchData = async () => {\r\n    try {\r\n      setResearchError(null);\r\n      const [catRes, statRes] = await Promise.all([\r\n        techService.getCatalog(),\r\n        techService.getStatus(base.locationCoord)\r\n      ]);\r\n      if (catRes.success) setCatalog(catRes.data!.catalog);\r\n      else setResearchError(catRes.error || 'Failed to load catalog');\r\n\r\n      if (statRes.success) setStatus(statRes.data!.status);\r\n      else setResearchError(statRes.error || 'Failed to load status');\r\n    } catch (e) {\r\n      setResearchError('Failed to load research data');\r\n    }\r\n  };\r\n\r\n  const loadResearchQueue = async () => {\r\n    if (!base?.locationCoord) return;\r\n    try {\r\n      const res = await techService.getQueue(base.locationCoord);\r\n      if (res.success && res.data) {\r\n        const queue = res.data.queue || [];\r\n        const first = queue.length > 0 ? queue[0] : null;\r\n        if (first) {\r\n          setActiveResearch({\r\n            key: first.techKey as TechnologyKey,\r\n            completesAt: String(first.completesAt),\r\n          });\r\n        } else {\r\n          setActiveResearch(null);\r\n        }\r\n      }\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (activePanel === 'research') {\r\n      loadResearchData();\r\n      loadResearchQueue();\r\n      loadCapacitiesData();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activePanel, base?.locationCoord]);\r\n\r\n  const loadStructuresData = async () => {\r\n    try {\r\n      setStructuresError(null);\r\n      setStructuresLoading(true);\r\n      const [catRes, statRes] = await Promise.all([\r\n        structuresService.getCatalog(),\r\n        structuresService.getStatus()\r\n      ]);\r\n      if (catRes.success) setStructuresCatalog(catRes.data!.catalog);\r\n      else setStructuresError(catRes.error || 'Failed to load structures catalog');\r\n\r\n      if (statRes.success) setStructuresStatus(statRes.data!.status);\r\n      else setStructuresError(statRes.error || 'Failed to load structures status');\r\n    } catch (e) {\r\n      setStructuresError('Failed to load structures data');\r\n    } finally {\r\n      setStructuresLoading(false);\r\n    }\r\n  };\r\n  \r\n  const loadBaseStructures = async () => {\r\n    if (!base?.locationCoord) return;\r\n    try {\r\n      const res = await basesService.getBaseStructures(base.locationCoord);\r\n      if (res.success && res.data) {\r\n        const map: Partial<Record<BuildingKey, number>> = {};\r\n        for (const item of res.data.items) {\r\n          map[item.key as BuildingKey] = item.currentLevel || 0;\r\n        }\r\n        setBaseLevels(map);\r\n        setConstructionPerHour(res.data.constructionPerHour);\r\n        setActiveConstruction(res.data.activeConstruction ?? null);\r\n      }\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  };\r\n  \r\n  // Fetch capacities for this base to compute \"Time\" in table\r\n  const loadCapacitiesData = async () => {\r\n    if (!base?.locationCoord) return;\r\n    try {\r\n      const res = await capacitiesService.getStatus(base.locationCoord);\r\n      if (res.success && res.data) {\r\n        setCapacities(res.data);\r\n      }\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  };\r\n\r\n  // Fetch planet-specific energy context for Solar/Gas Plants hinting\r\n  const loadPlanetEnergyContext = async () => {\r\n    if (!base?.locationCoord) return;\r\n    try {\r\n      const res = await universeService.getLocationByCoord(base.locationCoord);\r\n      if (res.success && res.data) {\r\n        setPlanetSolarEnergy(typeof res.data.result?.solarEnergy === 'number' ? res.data.result!.solarEnergy : null);\r\n        setPlanetGasYield(typeof res.data.result?.yields?.gas === 'number' ? res.data.result!.yields!.gas : null);\r\n        setPlanetMetalYield(typeof res.data.result?.yields?.metal === 'number' ? res.data.result!.yields!.metal : null);\r\n        setPlanetCrystalsYield(typeof res.data.result?.yields?.crystals === 'number' ? res.data.result!.yields!.crystals : null);\r\n        setPlanetFertility(typeof res.data.result?.fertility === 'number' ? res.data.result!.fertility : null);\r\n      }\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  };\r\n\r\n  const loadBaseLevels = async () => {\r\n    // Already handled by loadBaseStructures() which also updates baseLevels\r\n    return;\r\n  };\r\n\r\n  const { isFullyConnected } = useNetwork();\r\n  const { addToast } = useToast();\r\n  const { empire } = useAuthStore();\r\n\r\n  const handleStart = async (key: string) => {\r\n    if (!isFullyConnected) {\r\n      if (!empire) {\r\n        addToast({ type: 'error', text: 'Not authenticated' });\r\n        return;\r\n      }\r\n      const payload = {\r\n        empireId: empire._id,\r\n        locationCoord: base.locationCoord,\r\n        catalogKey: key,\r\n      };\r\n      const options = {\r\n        identityKey: `${empire._id}:${base.locationCoord}:${key}`,\r\n      };\r\n      if (!window.desktop?.eventQueue) {\r\n        addToast({ type: 'error', text: 'Desktop API not available' });\r\n        return;\r\n      }\r\n      const res = await window.desktop.eventQueue.enqueue('structures', payload, options);\r\n      if (res?.success) {\r\n        addToast({ type: 'success', text: `Queued ${key} for sync` });\r\n      } else {\r\n        addToast({ type: 'error', text: res?.error || 'Failed to queue structure' });\r\n      }\r\n      return;\r\n    }\r\n    onStart?.(key);\r\n  };\r\n\r\n  const handleQueue = async (s: BuildingSpec): Promise<{ success: boolean; eventId?: number }> => {\r\n    if (!empire) {\r\n      addToast({ type: 'error', text: 'Not authenticated' });\r\n      return { success: false };\r\n    }\r\n    const payload = {\r\n      empireId: empire._id,\r\n      locationCoord: base.locationCoord,\r\n      catalogKey: s.key,\r\n    };\r\n    const options = {\r\n      identityKey: `${empire._id}:${base.locationCoord}:${s.key}`,\r\n    };\r\n    if (!window.desktop?.eventQueue) {\r\n      addToast({ type: 'error', text: 'Desktop API not available' });\r\n      return { success: false };\r\n    }\r\n    const res = await window.desktop.eventQueue.enqueue('structures', payload, options);\r\n    if (res?.success) {\r\n      addToast({ type: 'success', text: `Queued ${s.name} for sync` });\r\n      return { success: true, eventId: res.eventId ? parseInt(res.eventId) : undefined };\r\n    } else {\r\n      addToast({ type: 'error', text: res?.error || 'Failed to queue structure' });\r\n      return { success: false };\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (activePanel === 'structures') {\r\n      loadStructuresData();\r\n      loadBaseStructures();\r\n      loadCapacitiesData();\r\n      loadBaseLevels();\r\n      loadPlanetEnergyContext();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activePanel]);\r\n\r\n  const loadDefensesData = async () => {\r\n    try {\r\n      setDefensesError(null);\r\n      setDefensesLoading(true);\r\n      const [catRes, statRes] = await Promise.all([\r\n        defensesService.getCatalog(),\r\n        defensesService.getStatus()\r\n      ]);\r\n      if (catRes.success) setDefensesCatalog(catRes.data!.catalog);\r\n      else setDefensesError(catRes.error || 'Failed to load defenses catalog');\r\n\r\n      if (statRes.success) setDefensesStatus(statRes.data!.status);\r\n      else setDefensesError(statRes.error || 'Failed to load defenses status');\r\n    } catch (e) {\r\n      setDefensesError('Failed to load defenses data');\r\n    } finally {\r\n      setDefensesLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (activePanel === 'defense') {\r\n      loadDefensesData();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activePanel, base?.locationCoord]);\r\n\r\n  const loadUnitsData = async () => {\r\n    try {\r\n      setUnitsError(null);\r\n      setUnitsLoading(true);\r\n      const [catRes, statRes] = await Promise.all([\r\n        unitsService.getCatalog(),\r\n        unitsService.getStatus()\r\n      ]);\r\n      if (catRes.success) setUnitsCatalog(catRes.data!.catalog);\r\n      else setUnitsError(catRes.error || 'Failed to load units catalog');\r\n\r\n      if (statRes.success) setUnitsStatus(statRes.data!.status);\r\n      else setUnitsError(statRes.error || 'Failed to load units status');\r\n    } catch (e) {\r\n      setUnitsError('Failed to load units data');\r\n    } finally {\r\n      setUnitsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (activePanel === 'fleet') {\r\n      loadUnitsData();\r\n      loadCapacitiesData();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [activePanel, base?.locationCoord]);\r\n\r\n  // Fetch header budgets (area/energy/population) for this base location\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    setBaseStats(null);\r\n    if (base?.locationCoord) {\r\n      baseStatsService\r\n        .get(base.locationCoord)\r\n        .then((res) => {\r\n          if (!mounted) return;\r\n          if (res.success && res.data) {\r\n            setBaseStats(res.data.stats);\r\n          }\r\n        })\r\n        .catch(() => {});\r\n    }\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [base?.locationCoord]);\r\n\r\n  // View Energy Breakdown (modal)\r\n  /**\r\n   * Authoritative sources:\r\n   * - Server totals via baseStatsService.get()\r\n   * - Per-structure metadata via @game/shared catalogs (energyDelta)\r\n   * - Planet context via universeService.getLocationByCoord (solarEnergy, gasYield)\r\n   * - Totals computed with computeEnergyBalance({ includeQueuedReservations: true })\r\n   */\r\n  const handleViewEnergyBreakdown = async () => {\r\n    try {\r\n      if (!base?.locationCoord) return;\r\n\r\n      const [structuresRes, planetRes] = await Promise.all([\r\n        basesService.getBaseStructures(base.locationCoord),\r\n        universeService.getLocationByCoord(base.locationCoord)\r\n      ]);\r\n\r\n      if (!structuresRes.success || !structuresRes.data) return;\r\n\r\n      const items = structuresRes.data.items || [];\r\n      const levels: Record<string, number> = {};\r\n      for (const it of items) {\r\n        levels[String(it.key)] = Math.max(0, Number(it.currentLevel || 0));\r\n      }\r\n\r\n      const solarEnergy = typeof (planetRes as any)?.data?.result?.solarEnergy === 'number'\r\n        ? (planetRes as any).data.result.solarEnergy\r\n        : 0;\r\n      const gasYield = typeof (planetRes as any)?.data?.result?.yields?.gas === 'number'\r\n        ? (planetRes as any).data.result.yields.gas\r\n        : 0;\r\n\r\n      const buildingsAtBase = Object.entries(levels)\r\n        .filter(([_, lv]) => (lv || 0) > 0)\r\n        .map(([key, lv]) => ({ key, level: lv as number, isActive: true }));\r\n\r\n      const totals = computeEnergyBalance({\r\n        buildingsAtBase,\r\n        location: { solarEnergy, gasYield },\r\n        includeQueuedReservations: true\r\n      });\r\n\r\n      // Build per-source breakdown using shared catalog specs\r\n      const catalog = getBuildingsList();\r\n      const nameByKey = new Map(catalog.map((spec) => [spec.key, spec.name]));\r\n      const deltaByKey = new Map(catalog.map((spec) => [spec.key, Number(spec.energyDelta || 0)]));\r\n\r\n      const baseline = 2;\r\n      const solar = (levels['solar_plants'] || 0) * solarEnergy;\r\n      const gas = (levels['gas_plants'] || 0) * gasYield;\r\n\r\n      const producers: Array<{ key: string; name: string; value: number }> = [];\r\n      const consumers: Array<{ key: string; name: string; value: number }> = [];\r\n\r\n      for (const [key, lv] of Object.entries(levels)) {\r\n        if (!lv) continue;\r\n        if (key === 'solar_plants' || key === 'gas_plants') continue;\r\n\r\n        const d = deltaByKey.get(key as BuildingKey) || 0;\r\n        if (!d) continue;\r\n\r\n        const name = nameByKey.get(key as BuildingKey) || key;\r\n        if (d >= 0) {\r\n          producers.push({ key, name, value: lv * d });\r\n        } else {\r\n          consumers.push({ key, name, value: lv * Math.abs(d) });\r\n        }\r\n      }\r\n\r\n      openModal('energy_breakdown', {\r\n        coord: base.locationCoord,\r\n        totals,\r\n        breakdown: {\r\n          baseline,\r\n          solar,\r\n          gas,\r\n          producers: producers.sort((a, b) => b.value - a.value),\r\n          consumers: consumers.sort((a, b) => b.value - a.value),\r\n        },\r\n      });\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  };\r\n\r\n  // View Area Usage Breakdown (modal)\r\n  /**\r\n   * Authoritative sources:\r\n   * - Server totals via baseStatsService.get() (area.used/free/total)\r\n   * - Per-structure area via @game/shared catalogs (areaRequired  level)\r\n   * - Sorted descending by per-structure area consumption\r\n   */\r\n  const handleViewAreaBreakdown = async () => {\r\n    try {\r\n      if (!base?.locationCoord) return;\r\n\r\n      const structuresRes = await basesService.getBaseStructures(base.locationCoord);\r\n      if (!structuresRes.success || !structuresRes.data) return;\r\n\r\n      const items = structuresRes.data.items || [];\r\n      const levels: Record<string, number> = {};\r\n      for (const it of items) {\r\n        levels[String(it.key)] = Math.max(0, Number(it.currentLevel || 0));\r\n      }\r\n\r\n      const catalog = getBuildingsList();\r\n      const nameByKey = new Map(catalog.map((spec) => [spec.key, spec.name]));\r\n      const areaByKey = new Map(catalog.map((spec) => [spec.key, Number(spec.areaRequired || 0)]));\r\n\r\n      const consumers: Array<{ key: string; name: string; value: number }> = [];\r\n      for (const [key, lv] of Object.entries(levels)) {\r\n        if (!lv) continue;\r\n        const a = areaByKey.get(key as BuildingKey) || 0;\r\n        if (!a) continue;\r\n        const name = nameByKey.get(key as BuildingKey) || key;\r\n        consumers.push({ key, name, value: lv * a });\r\n      }\r\n\r\n      openModal('area_breakdown', {\r\n        coord: base.locationCoord,\r\n        totals: {\r\n          used: baseStats?.area.used ?? 0,\r\n          free: baseStats?.area.free ?? 0,\r\n          total: baseStats?.area.total ?? 0\r\n        },\r\n        breakdown: {\r\n          consumers: consumers.sort((a, b) => b.value - a.value)\r\n        }\r\n      });\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  };\r\n\r\n  // View Population Breakdown (modal)\r\n  /**\r\n   * Authoritative sources:\r\n   * - Server totals via baseStatsService.get() (population.used/free/capacity)\r\n   * - Per-structure users via @game/shared catalogs (populationRequired  level)\r\n   * - Capacity sources: placeholder (totals-only note if none defined)\r\n   */\r\n  const handleViewPopulationBreakdown = async () => {\r\n    try {\r\n      if (!base?.locationCoord) return;\r\n\r\n      const structuresRes = await basesService.getBaseStructures(base.locationCoord);\r\n      if (!structuresRes.success || !structuresRes.data) return;\r\n\r\n      const items = structuresRes.data.items || [];\r\n      const levels: Record<string, number> = {};\r\n      for (const it of items) {\r\n        levels[String(it.key)] = Math.max(0, Number(it.currentLevel || 0));\r\n      }\r\n\r\n      const catalog = getBuildingsList();\r\n      const nameByKey = new Map(catalog.map((spec) => [spec.key, spec.name]));\r\n      const popReqByKey = new Map(catalog.map((spec) => [spec.key, Number(spec.populationRequired || 0)]));\r\n\r\n      const users: Array<{ key: string; name: string; value: number }> = [];\r\n      for (const [key, lv] of Object.entries(levels)) {\r\n        if (!lv) continue;\r\n        const p = popReqByKey.get(key as BuildingKey) || 0;\r\n        if (!p) continue;\r\n        const name = nameByKey.get(key as BuildingKey) || key;\r\n        users.push({ key, name, value: lv * p });\r\n      }\r\n\r\n      openModal('population_breakdown', {\r\n        coord: base.locationCoord,\r\n        totals: {\r\n          used: baseStats?.population.used ?? 0,\r\n          free: baseStats?.population.free ?? 0,\r\n          capacity: baseStats?.population.capacity ?? 0\r\n        },\r\n        breakdown: {\r\n          users: users.sort((a, b) => b.value - a.value),\r\n          sources: []\r\n        }\r\n      });\r\n    } catch {\r\n      // non-fatal\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Base Header */}\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-center mb-4\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <button\r\n              onClick={onBack}\r\n              className=\"text-gray-400 hover:text-white transition-colors\"\r\n              title=\"Back to overview\"\r\n            >\r\n               Back\r\n            </button>\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-empire-gold\">{base.name}</h1>\r\n              <p className=\"text-gray-400 font-mono\">{base.locationCoord}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {baseStats && (\r\n          <div className=\"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n            <StatItem\r\n              label=\"Area Usage\"\r\n              main={\r\n                <span className={baseStats.area.free > 0 ? 'text-green-300' : 'text-red-300'}>\r\n                  {baseStats.area.used.toLocaleString()} / {baseStats.area.total.toLocaleString()}\r\n                </span>\r\n              }\r\n              sub={\r\n                <StatLink\r\n                  onClick={handleViewAreaBreakdown}\r\n                  dataTestId=\"area-breakdown-link\"\r\n                  title=\"View breakdown \"\r\n                />\r\n              }\r\n            />\r\n            <StatItem\r\n              label=\"Energy Balance\"\r\n              main={\r\n                <span className={baseStats.energy.balance >= 0 ? 'text-green-300' : 'text-red-300'}>\r\n                  {baseStats.energy.balance.toLocaleString()}\r\n                </span>\r\n              }\r\n              sub={\r\n                <StatLink\r\n                  onClick={handleViewEnergyBreakdown}\r\n                  dataTestId=\"energy-breakdown-link\"\r\n                  title=\"View breakdown \"\r\n                />\r\n              }\r\n            />\r\n            <StatItem\r\n              label=\"Population\"\r\n              main={\r\n                <span className={baseStats.population.free > 0 ? 'text-green-300' : 'text-red-300'}>\r\n                  {baseStats.population.used.toLocaleString()} / {baseStats.population.capacity.toLocaleString()}\r\n                </span>\r\n              }\r\n              sub={\r\n                <StatLink\r\n                  onClick={handleViewPopulationBreakdown}\r\n                  dataTestId=\"population-breakdown-link\"\r\n                  title=\"View breakdown \"\r\n                />\r\n              }\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Base Planet Info */}\r\n        <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n          {/* Left: Planet picture (same style as Planet page) */}\r\n          <div className=\"p-4 rounded-lg border border-gray-600 bg-gray-800/60 flex items-center justify-center\">\r\n            <PlanetVisual coord={base.locationCoord} className=\"w-56 h-56 md:w-64 md:h-64\" />\r\n          </div>\r\n\r\n          {/* Right: Planet information (details + link) */}\r\n          <div className=\"p-4 rounded-lg border border-gray-600 bg-gray-800/60\">\r\n            <PlanetInfoBlock coord={base.locationCoord} refreshKey={refreshKey} showBudgets={false} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Panel Navigation */}\r\n      <div className=\"game-card\">\r\n        <div className=\"flex border-b border-gray-600\">\r\n          <button\r\n            data-testid=\"tab-overview\"\r\n            onClick={() => { setActivePanel('overview'); onPanelChange?.('overview'); }}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activePanel === 'overview'\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200'\r\n            }`}\r\n          >\r\n             Overview\r\n          </button>\r\n          <button\r\n            data-testid=\"tab-fleet\"\r\n            onClick={() => { setActivePanel('fleet'); onPanelChange?.('fleet'); }}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activePanel === 'fleet'\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200'\r\n            }`}\r\n          >\r\n             Production\r\n          </button>\r\n          <button\r\n            data-testid=\"tab-defense\"\r\n            onClick={() => { setActivePanel('defense'); onPanelChange?.('defense'); }}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activePanel === 'defense'\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200'\r\n            }`}\r\n          >\r\n             Defense\r\n          </button>\r\n          <button\r\n            data-testid=\"tab-research\"\r\n            onClick={() => { setActivePanel('research'); onPanelChange?.('research'); }}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activePanel === 'research'\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200'\r\n            }`}\r\n          >\r\n             Research\r\n          </button>\r\n          <button\r\n            data-testid=\"tab-structures\"\r\n            onClick={() => { setActivePanel('structures'); onPanelChange?.('structures'); }}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activePanel === 'structures'\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200'\r\n            }`}\r\n          >\r\n             Structures\r\n          </button>\r\n          <button\r\n            data-testid=\"tab-trade\"\r\n            onClick={() => { setActivePanel('trade'); onPanelChange?.('trade'); }}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activePanel === 'trade'\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200'\r\n            }`}\r\n          >\r\n             Trade\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {notice && (\r\n        <div className=\"game-card\">\r\n          <div data-testid=\"notice-banner\" className=\"p-3 bg-blue-900/50 border border-blue-700 rounded-md text-blue-200\">\r\n            {notice}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Panel Content */}\r\n      {activePanel === 'overview' && (\r\n        <div className=\"space-y-6\">\r\n          {/* Fleets */}\r\n          <div className=\"game-card\">\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n              <h3 className=\"text-lg font-semibold text-empire-gold\">Fleets</h3>\r\n              <button\r\n                onClick={loadFleets}\r\n                className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n              >\r\n                {fleetsLoading ? 'Loading...' : 'Refresh'}\r\n              </button>\r\n            </div>\r\n            {fleetsError && (\r\n              <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3\">\r\n                {fleetsError}\r\n              </div>\r\n            )}\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"text-gray-300\">\r\n                  <tr className=\"border-b border-gray-700\">\r\n                    <th className=\"text-left py-1 pr-4\">Fleet</th>\r\n                    <th className=\"text-left py-1 pr-4\">Player</th>\r\n                    <th className=\"text-left py-1 pr-4\">Arrival</th>\r\n                    <th className=\"text-right py-1\">Size</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"text-white\">\r\n                  {fleets.length > 0 ? (\r\n                    fleets.map((f) => (\r\n                      <tr key={f._id} className=\"border-b border-gray-800/60\">\r\n                        <td className=\"py-1 pr-4\">\r\n                          <Link to={`/fleets/${f._id}`} className=\"text-blue-300 hover:text-blue-200\">\r\n                            {f.name}\r\n                          </Link>\r\n                        </td>\r\n                        <td className=\"py-1 pr-4 text-gray-200\">{f.ownerName || ''}</td>\r\n                        <td className=\"py-1 pr-4 text-gray-300\"></td>\r\n                        <td className=\"py-1 text-right font-mono\">{f.sizeCredits.toLocaleString()}</td>\r\n                      </tr>\r\n                    ))\r\n                  ) : (\r\n                    <tr>\r\n                      <td colSpan={4} className=\"py-3 text-center text-gray-400\">\r\n                        No fleets detected in orbit.\r\n                      </td>\r\n                    </tr>\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Structures (mock data) */}\r\n          <div className=\"game-card\">\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n              <h3 className=\"text-lg font-semibold text-empire-gold\">Structures</h3>\r\n              <button\r\n                onClick={loadBuildings}\r\n                className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n              >\r\n                {buildingsLoading ? 'Loading...' : 'Refresh'}\r\n              </button>\r\n            </div>\r\n            {buildingsError && (\r\n              <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3\">\r\n                {buildingsError}\r\n              </div>\r\n            )}\r\n            <div className=\"grid md:grid-cols-2 gap-8\">\r\n              {/* Left column - main structures */}\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"min-w-full text-sm\">\r\n                  <thead className=\"text-gray-300\">\r\n                    <tr className=\"border-b border-gray-700\">\r\n                      <th className=\"text-left py-1 pr-4\">Structures</th>\r\n                      <th className=\"text-right py-1\">Level</th>\r\n                      <th className=\"text-left py-1 pl-4\">Status</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"text-white\">\r\n                    {buildings.map((b, i) => (\r\n                      <tr key={b._id || i} className=\"border-b border-gray-800/60\">\r\n                        <td className=\"py-1 pr-4 text-gray-200\">{getBuildingLabel(b)}</td>\r\n                        <td className=\"py-1 text-right font-mono\">{b.level}</td>\r\n                        <td className=\"py-1 pl-4\">\r\n                          {b.isActive ? (\r\n                            <span className=\"text-green-400\">Active</span>\r\n                          ) : (\r\n                            <span className=\"text-yellow-300\">\r\n                              Under construction  ETA {formatEta(b.constructionCompleted)}\r\n                            </span>\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n\r\n              {/* Right column - special structures + defenses */}\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n                {/* Special structures */}\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"min-w-full text-sm\">\r\n                    <thead className=\"text-gray-300\">\r\n                      <tr className=\"border-b border-gray-700\">\r\n                        <th className=\"text-left py-1 pr-4\">Structures</th>\r\n                        <th className=\"text-right py-1\">Level</th>\r\n                        <th className=\"text-left py-1 pl-4\">Status</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"text-white\">\r\n                      {buildings\r\n                        .filter((b) => b.type === 'command_center' || b.type === 'shipyard')\r\n                        .map((b, i) => (\r\n                          <tr key={b._id || i} className=\"border-b border-gray-800/60\">\r\n                            <td className=\"py-1 pr-4 text-gray-200\">{getBuildingLabel(b)}</td>\r\n                            <td className=\"py-1 text-right font-mono\">{b.level}</td>\r\n                            <td className=\"py-1 pl-4\">\r\n                              {b.isActive ? (\r\n                                <span className=\"text-green-400\">Active</span>\r\n                              ) : (\r\n                                <span className=\"text-yellow-300\">\r\n                                  Under construction  ETA {formatEta(b.constructionCompleted)}\r\n                                </span>\r\n                              )}\r\n                            </td>\r\n                          </tr>\r\n                        ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n\r\n                {/* Defenses */}\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"min-w-full text-sm\">\r\n                    <thead className=\"text-gray-300\">\r\n                      <tr className=\"border-b border-gray-700\">\r\n                        <th className=\"text-left py-1 pr-4\">Defenses</th>\r\n                        <th className=\"text-right py-1\">Level</th>\r\n                        <th className=\"text-left py-1 pl-4\">Status</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"text-white\">\r\n                      {buildings\r\n                        .filter((b) => b.type === 'defense_station')\r\n                        .map((b, i) => (\r\n                          <tr key={b._id || i} className=\"border-b border-gray-800/60\">\r\n                            <td className=\"py-1 pr-4 text-gray-200\">{getBuildingLabel(b)}</td>\r\n                            <td className=\"py-1 text-right font-mono\">{b.level}</td>\r\n                            <td className=\"py-1 pl-4\">\r\n                              {b.isActive ? (\r\n                                <span className=\"text-green-400\">Active</span>\r\n                              ) : (\r\n                                <span className=\"text-yellow-300\">\r\n                                  Under construction  ETA {formatEta(b.constructionCompleted)}\r\n                                </span>\r\n                              )}\r\n                            </td>\r\n                          </tr>\r\n                        ))}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {activePanel === 'structures' && (\r\n        <div className=\"space-y-6\">\r\n          {structuresError && (\r\n            <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200\">\r\n              {structuresError}\r\n            </div>\r\n          )}\r\n          <StructuresQueuePanel\r\n            baseCoord={base.locationCoord}\r\n            onChanged={async () => {\r\n              await Promise.all([checkAuth(true), refreshHeaderBudgets()]);\r\n              await loadStructuresData();\r\n              await loadCapacitiesData();\r\n              await loadBaseLevels();\r\n              await loadPlanetEnergyContext();\r\n            }}\r\n          />\r\n          <StructuresBuildTable\r\n            catalog={structuresCatalog}\r\n            status={structuresStatus}\r\n            levels={baseLevels}\r\n            loading={structuresLoading}\r\n            onRefresh={() => {\r\n              loadStructuresData();\r\n              loadCapacitiesData();\r\n              loadBaseLevels();\r\n              loadPlanetEnergyContext();\r\n            }}\r\n            onStart={handleStart}\r\n            onQueue={handleQueue}\r\n            isOffline={!isFullyConnected}\r\n            actionLabel={(_s, eligible, isLoading, isOffline) => {\r\n              if (isLoading) return \"...\";\r\n              if (isOffline) {\r\n                return eligible ? \"Queue\" : \"Unavailable\";\r\n              }\r\n              return eligible ? \"Build\" : \"Unavailable\";\r\n            }}\r\n            constructionPerHour={constructionPerHour ?? capacities?.construction?.value}\r\n            activeConstruction={activeConstruction}\r\n            locationCoord={base.locationCoord}\r\n            planetSolarEnergy={planetSolarEnergy ?? undefined}\r\n            planetGasYield={planetGasYield ?? undefined}\r\n            planetMetalYield={planetMetalYield ?? undefined}\r\n            planetCrystalsYield={planetCrystalsYield ?? undefined}\r\n            planetFertility={planetFertility ?? undefined}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {activePanel === 'trade' && (\r\n        <div className=\"game-card text-center\">\r\n          <div className=\"py-12\">\r\n            <div className=\"text-6xl mb-4\"></div>\r\n            <h3 className=\"text-xl font-semibold mb-2 text-gray-300\">Trade Center</h3>\r\n            <p className=\"text-gray-400 mb-6\">\r\n              Trade systems are coming soon. Use the Structures tab to build infrastructure that unlocks trading.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {activePanel === 'fleet' && (\r\n        <div className=\"space-y-6\">\r\n          {unitsError && (\r\n            <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200\">\r\n              {unitsError}\r\n            </div>\r\n          )}\r\n          <UnitsBuildTable\r\n            catalog={unitsCatalog}\r\n            status={unitsStatus}\r\n            loading={unitsLoading}\r\n            onRefresh={loadUnitsData}\r\n            productionPerHour={capacities?.production?.value}\r\n            onSubmit={async (items, totals) => {\r\n              try {\r\n                setUnitsError(null);\r\n                let queued = 0;\r\n                let conflicts = 0;\r\n                let failed = 0;\r\n                const failedReasons: string[] = [];\r\n\r\n                // Submit each unit quantity as individual start requests (Phase A API is per-unit)\r\n                for (const { key, quantity } of items) {\r\n                  const qty = Math.max(0, Math.floor(quantity || 0));\r\n                  for (let i = 0; i < qty; i++) {\r\n                    try {\r\n                      const res: any = await unitsService.start(base.locationCoord, key as any);\r\n                      if (res?.success) {\r\n                        queued++;\r\n                      } else if ((res?.code === 'ALREADY_IN_PROGRESS') || res?.status === 409) {\r\n                        conflicts++;\r\n                      } else {\r\n                        failed++;\r\n                        const msg = (res?.message || res?.error || 'Failed');\r\n                        if (Array.isArray(res?.reasons) && res.reasons.length) {\r\n                          failedReasons.push(...res.reasons);\r\n                        } else {\r\n                          failedReasons.push(String(msg));\r\n                        }\r\n                      }\r\n                    } catch (e: any) {\r\n                      failed++;\r\n                      const msg = e?.response?.data?.message || e?.message || 'Request failed';\r\n                      const reasons = e?.response?.data?.reasons;\r\n                      if (Array.isArray(reasons) && reasons.length) {\r\n                        failedReasons.push(...reasons);\r\n                      } else {\r\n                        failedReasons.push(String(msg));\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n\r\n                // Refresh auth/resources and units status after submissions\r\n                await Promise.all([checkAuth(true), refreshHeaderBudgets()]);\r\n                await loadUnitsData();\r\n\r\n                // Build summary notice using original totals time\r\n                const h = Math.floor(totals.minutes / 60);\r\n                const m = totals.minutes % 60;\r\n                const timeText = h > 0 ? `${h}h ${m}m` : `${m}m`;\r\n                showNotice(\r\n                  `Queued ${queued.toLocaleString()}  conflicts ${conflicts.toLocaleString()}  failed ${failed.toLocaleString()}  ${timeText}`\r\n                );\r\n\r\n                if (failed > 0) {\r\n                  const unique = Array.from(new Set(failedReasons.map(String)));\r\n                  setUnitsError(`Some items failed: ${unique.join('; ')}`);\r\n                }\r\n              } catch {\r\n                setUnitsError('Production submission failed.');\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {activePanel === 'defense' && (\r\n        <div className=\"space-y-6\">\r\n          {defensesError && (\r\n            <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200\">\r\n              {defensesError}\r\n            </div>\r\n          )}\r\n          <DefensesBuildTable\r\n            catalog={defensesCatalog}\r\n            status={defensesStatus}\r\n            loading={defensesLoading}\r\n            onRefresh={loadDefensesData}\r\n            onStart={async (key) => {\r\n              try {\r\n                setDefensesLoading(true);\r\n                setDefensesError(null);\r\n                const res = await defensesService.start(base.locationCoord, key);\r\n                if (!res.success) {\r\n                  if (res.code === 'ALREADY_IN_PROGRESS') {\r\n                    // Soft-path: Show non-destructive message and refresh data\r\n                    console.info('Defense already in progress:', res.message);\r\n                    showNotice('Already in progress  refreshed.');\r\n                    // Refresh data to show current state\r\n                    await Promise.all([checkAuth(true), refreshHeaderBudgets()]);\r\n                    await loadDefensesData();\r\n                  } else {\r\n                    setDefensesError(res.error || res.message || 'Failed to start defense');\r\n                  }\r\n                } else {\r\n                  await Promise.all([checkAuth(true), refreshHeaderBudgets()]);\r\n                  await loadDefensesData();\r\n                }\r\n              } catch {\r\n                setDefensesError('Network error');\r\n              } finally {\r\n                setDefensesLoading(false);\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {activePanel === 'research' && (\r\n        <div className=\"space-y-6\">\r\n          <ResearchQueuePanel\r\n            baseCoord={base.locationCoord}\r\n            onChanged={async () => {\r\n              await Promise.all([checkAuth(true), refreshHeaderBudgets()]);\r\n              await loadResearchData();\r\n              await loadResearchQueue();\r\n              await loadCapacitiesData();\r\n            }}\r\n          />\r\n          {researchError && (\r\n            <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200\">\r\n              {researchError}\r\n            </div>\r\n          )}\r\n          <ResearchBuildTable\r\n            catalog={catalog}\r\n            status={status}\r\n            loading={researchLoading}\r\n            researchPerHour={capacities?.research?.value}\r\n            activeResearch={activeResearch}\r\n            onRefresh={() => {\r\n              loadResearchData();\r\n              loadResearchQueue();\r\n              loadCapacitiesData();\r\n            }}\r\n            onStart={async (techKey) => {\r\n              try {\r\n                setResearchLoading(true);\r\n                setResearchError(null);\r\n                const result = await techService.start(base.locationCoord, techKey as TechnologyKey);\r\n                if (!result.success) {\r\n                  if (result.code === 'ALREADY_IN_PROGRESS') {\r\n                    // Soft-path: Show non-destructive message and refresh data\r\n                    console.info('Research already in progress:', result.message);\r\n                    showNotice('Already in progress  refreshed.');\r\n                    // Refresh data to show current state\r\n                    await Promise.all([checkAuth(true), refreshHeaderBudgets()]);\r\n                    await loadResearchData();\r\n                    await loadResearchQueue();\r\n                    await loadCapacitiesData();\r\n                  } else {\r\n                    setResearchError(result.error || result.message || 'Failed to start technology');\r\n                  }\r\n                } else {\r\n                  await Promise.all([checkAuth(true), refreshHeaderBudgets()]);\r\n                  await loadResearchData();\r\n                  await loadResearchQueue();\r\n                  await loadCapacitiesData();\r\n                }\r\n              } catch {\r\n                setResearchError('Network error');\r\n              } finally {\r\n                setResearchLoading(false);\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BaseDetail;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { useBaseStore } from '../../stores/baseStore';\r\nimport { Empire } from '@game/shared';\r\nimport axios from 'axios';\r\nimport BaseOverview from './BaseOverview';\r\nimport BaseDetail from './BaseDetail';\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\n// Create axios instance with auth token handling\r\nconst createAuthenticatedApi = () => {\r\n  const api = axios.create({\r\n    baseURL: API_BASE_URL,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n  });\r\n\r\n  // Add auth token to requests\r\n  api.interceptors.request.use((config) => {\r\n    const token = localStorage.getItem('auth-storage');\r\n    if (token) {\r\n      try {\r\n        const parsed = JSON.parse(token);\r\n        if (parsed.state?.token) {\r\n          config.headers.Authorization = `Bearer ${parsed.state.token}`;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error parsing auth token:', error);\r\n      }\r\n    }\r\n    return config;\r\n  });\r\n\r\n  // Handle auth errors\r\n  api.interceptors.response.use(\r\n    (response) => response,\r\n    (error) => {\r\n      if (error.response?.status === 401) {\r\n        localStorage.removeItem('auth-storage');\r\n        window.location.href = '/login';\r\n      }\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n\r\n  return api;\r\n};\r\n\r\ninterface BaseManagementProps {\r\n  empire: Empire;\r\n  onUpdate: () => void;\r\n}\r\n\r\nconst BaseManagement: React.FC<BaseManagementProps> = ({ empire }) => {\r\n  const { \r\n    selectedBaseId, \r\n    bases, \r\n    loading, \r\n    error,\r\n    setSelectedBase,\r\n    setBases,\r\n    setLoading,\r\n    setError,\r\n    getSelectedBase\r\n  } = useBaseStore();\r\n\r\n  const [activeTab, setActiveTab] = useState<'overview' | 'detail'>('overview');\r\n  const api = createAuthenticatedApi();\r\n\r\n  // Fetch all bases for the empire\r\n  const fetchBases = async () => {\r\n    if (!empire) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Fetch colonies\r\n      const coloniesResponse = await api.get('/game/territories');\r\n      if (!coloniesResponse.data.success) {\r\n        throw new Error(coloniesResponse.data.error || 'Failed to fetch territories');\r\n      }\r\n\r\n      const territories = coloniesResponse.data.data.territories;\r\n      \r\n      // For each territory, fetch buildings and calculate production\r\n      const basesData = await Promise.all(\r\n        territories.map(async (territory: any) => {\r\n          try {\r\n            // Fetch buildings for this location\r\n            const buildingsResponse = await api.get(`/game/buildings/location/${territory.coord}`);\r\n            const buildings = buildingsResponse.data.success ? buildingsResponse.data.data.buildings : [];\r\n\r\n            // Get construction queue (buildings not yet active)\r\n            const constructionQueue = buildings.filter((building: any) => !building.isActive);\r\n\r\n            // Minimal base shape for UI; cast as any to satisfy store typing\r\n            const base: any = {\r\n              _id: territory._id ?? territory.coord,\r\n              name: territory.name ?? territory.coord,\r\n              locationCoord: territory.coord,\r\n              buildings,\r\n              constructionQueue\r\n            };\r\n\r\n            return base;\r\n          } catch (error) {\r\n            console.error(`Error fetching buildings for ${territory.coord}:`, error);\r\n            return null;\r\n          }\r\n        })\r\n      );\r\n      // Filter out any failed requests\r\n      const validBases = basesData.filter(base => base !== null);\r\n      setBases(validBases);\r\n      \r\n      // If no base is selected and we have bases, select the first one\r\n      if (!selectedBaseId && validBases.length > 0) {\r\n        setSelectedBase(validBases[0]._id);\r\n        setActiveTab('detail');\r\n      }\r\n      \r\n    } catch (err) {\r\n      console.error('Error fetching bases:', err);\r\n      setError('Failed to load bases. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  \r\n  // Handle base selection\r\n  const handleBaseSelect = (baseId: string) => {\r\n    setSelectedBase(baseId);\r\n    setActiveTab('detail');\r\n  };\r\n\r\n  // Handle tab change\r\n  const handleTabChange = (tab: 'overview' | 'detail') => {\r\n    setActiveTab(tab);\r\n    if (tab === 'overview') {\r\n      setSelectedBase(null);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (empire) {\r\n      fetchBases();\r\n    }\r\n  }, [empire]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-400\">Loading bases...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-red-400 mb-4\"> {error}</div>\r\n          <button \r\n            onClick={fetchBases}\r\n            className=\"game-button\"\r\n          >\r\n            Retry\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const selectedBase = getSelectedBase();\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header with Navigation */}\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h1 className=\"text-2xl font-bold text-empire-gold\">Empire Management</h1>\r\n          <div className=\"flex items-center gap-4\">\r\n            <span className=\"text-sm text-gray-400\">\r\n              {bases.length} {bases.length === 1 ? 'Base' : 'Bases'}\r\n            </span>\r\n            <button\r\n              onClick={fetchBases}\r\n              className=\"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n            >\r\n              Refresh\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tab Navigation */}\r\n        <div className=\"flex border-b border-gray-600\">\r\n          <button\r\n            onClick={() => handleTabChange('overview')}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activeTab === 'overview'\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200'\r\n            }`}\r\n          >\r\n            All Bases Overview\r\n          </button>\r\n          <button\r\n            onClick={() => handleTabChange('detail')}\r\n            disabled={!selectedBase}\r\n            className={`px-4 py-2 font-medium transition-colors ${\r\n              activeTab === 'detail' && selectedBase\r\n                ? 'text-blue-400 border-b-2 border-blue-400'\r\n                : 'text-gray-400 hover:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed'\r\n            }`}\r\n          >\r\n            {selectedBase ? `${selectedBase.name}` : 'Select a Base'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content Area */}\r\n      {activeTab === 'overview' ? (\r\n        <BaseOverview \r\n          bases={bases}\r\n          empire={empire}\r\n          onBaseSelect={handleBaseSelect}\r\n          onUpdate={fetchBases}\r\n        />\r\n      ) : selectedBase ? (\r\n        <BaseDetail \r\n          base={selectedBase}\r\n          onBack={() => handleTabChange('overview')}\r\n        />\r\n      ) : (\r\n        <div className=\"game-card text-center\">\r\n          <p className=\"text-gray-400 mb-4\">No base selected</p>\r\n          <button\r\n            onClick={() => handleTabChange('overview')}\r\n            className=\"game-button\"\r\n          >\r\n            View All Bases\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BaseManagement;\r\n","import React from 'react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport BaseManagement from './BaseManagement';\r\n\r\nconst BasesPage: React.FC = () => {\r\n  const { empire, isLoading } = useAuthStore();\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-400\">Loading bases...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!empire) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-gray-300 mb-2\">No empire data available.</p>\r\n          <p className=\"text-gray-500 text-sm\">Please create an empire or refresh the page.</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // BaseManagement currently requires an onUpdate prop in its type, but doesn't consume it.\r\n  // Provide a no-op handler to satisfy typing.\r\n  return <BaseManagement empire={empire} onUpdate={() => {}} />;\r\n};\r\n\r\nexport default BasesPage;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { useNavigate, useParams, useSearchParams } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport universeService from '../../services/universeService';\r\nimport BaseDetail from './BaseDetail';\r\nimport PlanetInfoBlock from './PlanetInfoBlock';\r\nimport PlanetVisual from './PlanetVisual';\r\nimport basesService from '../../services/basesService';\r\nimport baseStatsService, { BaseStatsDTO } from '../../services/baseStatsService';\r\nimport type { Building, BuildingType } from '@game/shared';\r\nimport { getBuildingSpec } from '@game/shared';\r\n\r\nconst StatItem: React.FC<{ label: string; main: React.ReactNode; sub?: React.ReactNode }> = ({ label, main, sub }) => (\r\n  <div className=\"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3\">\r\n    <div className=\"text-xs text-gray-400\">{label}</div>\r\n    <div className=\"mt-1 text-lg text-white font-mono\">{main}</div>\r\n    {sub && <div className=\"text-xs text-gray-400 mt-0.5\">{sub}</div>}\r\n  </div>\r\n);\r\n\r\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3001/api';\r\n\r\n// Axios with auth header\r\nfunction createAuthenticatedApi() {\r\n  const api = axios.create({\r\n    baseURL: API_BASE_URL,\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  api.interceptors.request.use((config) => {\r\n    try {\r\n      const raw = localStorage.getItem('auth-storage');\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        const token = parsed?.state?.token;\r\n        if (token) {\r\n          (config.headers as any).Authorization = `Bearer ${token}`;\r\n        }\r\n      }\r\n    } catch {\r\n      // ignore\r\n    }\r\n    return config;\r\n  });\r\n  return api;\r\n}\r\n\r\ntype FetchedBuildings = Array<{\r\n  _id: string;\r\n  type: string;\r\n  level: number;\r\n  isActive: boolean;\r\n  constructionStarted?: string;\r\n  constructionCompleted?: string;\r\n}>;\r\n\r\n\r\ntype ClientBuilding = Building & {\r\n  displayName?: string;\r\n  catalogKey?: string;\r\n};\r\n\r\nconst BUILDING_DISPLAY_NAME: Record<BuildingType, string> = {\r\n  metal_mine: 'Metal Mine',\r\n  energy_plant: 'Energy Plant',\r\n  factory: 'Manufacturing Plant',\r\n  research_lab: 'Research Laboratory',\r\n  defense_station: 'Defense Station',\r\n  shipyard: 'Shipyard',\r\n  command_center: 'Command Center',\r\n  habitat: 'Habitat Module',\r\n};\r\n\r\nconst getBuildingLabel = (b: ClientBuilding): string => {\r\n  if (b.displayName && b.displayName.trim().length > 0) return b.displayName;\r\n  if (b.catalogKey) {\r\n    try {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      return getBuildingSpec(b.catalogKey as any).name;\r\n    } catch {\r\n      // ignore and fall back\r\n    }\r\n  }\r\n  return BUILDING_DISPLAY_NAME[b.type] ?? b.type;\r\n};\r\n\r\nconst BasePage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { coord } = useParams<{ coord: string }>();\r\n  const [searchParams] = useSearchParams();\r\n  const api = useMemo(() => createAuthenticatedApi(), []);\r\n  const { user, empire } = useAuthStore();\r\n\r\n  const tabParamRaw = searchParams.get('tab');\r\n  // Support canonical deep-link aliases like ?tab=fleets -> 'fleet'\r\n  const tabParam = tabParamRaw === 'fleets' ? 'fleet' : tabParamRaw;\r\n  const initialPanel = (tabParam === 'overview' || tabParam === 'fleet' || tabParam === 'defense' || tabParam === 'research' || tabParam === 'structures' || tabParam === 'trade')\r\n    ? (tabParam as 'overview' | 'fleet' | 'defense' | 'research' | 'structures' | 'trade')\r\n    : undefined;\r\n\r\n  // Keep ?tab= in URL in sync with the active panel so refresh/back/forward restore the same tab\r\n  const handlePanelChange = (panel: 'overview' | 'fleet' | 'defense' | 'research' | 'structures' | 'trade') => {\r\n    const next = new URLSearchParams(searchParams);\r\n    next.set('tab', panel);\r\n    // Update just the search portion, keep current path (/base/:coord)\r\n    navigate({ search: `?${next.toString()}` }, { replace: true });\r\n  };\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Location/owner\r\n  const [ownerUsername, setOwnerUsername] = useState<string | null>(null);\r\n  const [ownerId, setOwnerId] = useState<string | null>(null);\r\n\r\n  // Buildings/derived base for owner view\r\n  const [baseObj, setBaseObj] = useState<any | null>(null);\r\n  const [publicBuildings, setPublicBuildings] = useState<ClientBuilding[]>([]);\r\n  const [publicBuildingsError, setPublicBuildingsError] = useState<string | null>(null);\r\n  const [baseStats, setBaseStats] = useState<BaseStatsDTO | null>(null);\r\n\r\n  const isOwner = !!user && !!ownerId && user._id === ownerId;\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      if (!coord) {\r\n        setError('Missing coordinate');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      setLoading(true);\r\n      setError(null);\r\n      try {\r\n        // 1) Fetch location to determine owner\r\n        const locRes = await universeService.getLocationByCoord(coord);\r\n        if (!mounted) return;\r\n        if (!locRes.success || !locRes.data) {\r\n          setError(locRes.error || 'Failed to load location');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        setOwnerUsername(locRes.data.owner?.username ?? null);\r\n        setOwnerId(locRes.data.owner?.id ?? null);\r\n\r\n        // 2a) Fetch base stats (area/energy/population budgets and owner income) for header display\r\n        try {\r\n          const bs = await baseStatsService.get(coord);\r\n          if (mounted && bs.success && bs.data) {\r\n            setBaseStats(bs.data.stats);\r\n          }\r\n        } catch {\r\n          // ignore stats errors in public view\r\n        }\r\n\r\n        // 2) Fetch buildings: owner sees full BaseDetail, public view shows read-only structures\r\n        if (user && locRes.data.owner?.id === user._id) {\r\n          const bRes = await api.get(`/game/buildings/location/${encodeURIComponent(coord)}`);\r\n          const buildingsRaw: FetchedBuildings = bRes.data?.data?.buildings || [];\r\n\r\n          const constructionQueue = buildingsRaw.filter((b) => !b.isActive);\r\n          \r\n\r\n          const derivedBase = {\r\n            _id: coord, // use coord as id\r\n            empireId: empire?._id,\r\n            locationCoord: coord,\r\n            name: `Base ${coord}`,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n      \r\n            constructionQueue,\r\n          };\r\n\r\n          setBaseObj(derivedBase);\r\n          setPublicBuildings([]);\r\n          setPublicBuildingsError(null);\r\n        } else {\r\n          setBaseObj(null);\r\n          // public view: load real buildings at this location\r\n          try {\r\n            setPublicBuildingsError(null);\r\n            const res = await basesService.getBaseStructures(coord);\r\n            if (res.success && res.data) {\r\n              // Convert to display format with catalogKey-first naming\r\n              const displayBuildings: ClientBuilding[] = res.data.items.map((item: any) => ({\r\n                ...item,\r\n                displayName: item.name,\r\n                catalogKey: item.key,\r\n                level: item.currentLevel,\r\n                isActive: true,\r\n                _id: `${coord}-${item.key}`,\r\n                type: item.type || 'unknown', // fallback for legacy display\r\n                empireId: undefined,\r\n                locationCoord: coord\r\n              }));\r\n              setPublicBuildings(displayBuildings);\r\n            } else {\r\n              setPublicBuildings([]);\r\n              setPublicBuildingsError(res.error || 'Failed to load buildings');\r\n            }\r\n          } catch {\r\n            setPublicBuildings([]);\r\n            setPublicBuildingsError('Network error while loading buildings');\r\n          }\r\n        }\r\n      } catch (e) {\r\n        if (!mounted) return;\r\n        setError('Network error while loading base');\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [coord, api, user, empire?._id]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"py-10 text-center text-gray-300\">Loading base...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"py-6 text-center text-red-300\">{error}</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Owner view -> full BaseDetail\r\n  if (isOwner && baseObj && empire) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"game-card mb-0\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold text-empire-gold\">{baseObj.name}</h1>\r\n              <p className=\"text-gray-400 font-mono\">{coord}</p>\r\n            </div>\r\n            <button\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600\"\r\n              onClick={() => navigate(-1)}\r\n            >\r\n               Back\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <BaseDetail\r\n          base={baseObj}\r\n          onBack={() => navigate(-1)}\r\n          initialActivePanel={initialPanel}\r\n          onPanelChange={handlePanelChange}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Public view (non-owner)\r\n\r\n  // Mock data for public view sections (Fleets and Structures)\r\n  const mockFleets = [\r\n    { fleet: 'Fleet 9', player: '[P.M.R] Vanity333', arrival: '', size: '17,670' }\r\n  ];\r\n\r\n\r\n\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-white\">Base (Public View)</h1>\r\n            <p className=\"text-sm text-gray-400\">{coord}</p>\r\n          </div>\r\n          <button\r\n            className=\"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600\"\r\n            onClick={() => navigate(-1)}\r\n          >\r\n             Back\r\n          </button>\r\n        </div>\r\n        <div className=\"text-sm text-gray-300\">\r\n          Owner: <span className=\"text-empire-gold\">{ownerUsername ?? ''}</span>\r\n        </div>\r\n\r\n        {baseStats && (\r\n          <div className=\"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n            <StatItem\r\n              label=\"Area Usage\"\r\n              main={\r\n                <span>\r\n                  {baseStats.area.used.toLocaleString()} / {baseStats.area.total.toLocaleString()}\r\n                </span>\r\n              }\r\n              sub={<span>(free {baseStats.area.free.toLocaleString()})</span>}\r\n            />\r\n            <StatItem\r\n              label=\"Energy Balance\"\r\n              main={\r\n                <span className={baseStats.energy.balance >= 0 ? 'text-green-300' : 'text-red-300'}>\r\n                  {baseStats.energy.balance.toLocaleString()}\r\n                </span>\r\n              }\r\n              sub={\r\n                <span>\r\n                  +{baseStats.energy.produced.toLocaleString()} prod {' '}{baseStats.energy.consumed.toLocaleString()} cons\r\n                </span>\r\n              }\r\n            />\r\n            <StatItem\r\n              label=\"Population\"\r\n              main={\r\n                <span>\r\n                  {baseStats.population.used.toLocaleString()} / {baseStats.population.capacity.toLocaleString()}\r\n                </span>\r\n              }\r\n              sub={<span>(free {baseStats.population.free.toLocaleString()})</span>}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Planet image + information */}\r\n      <div className=\"game-card\">\r\n        <div className=\"grid md:grid-cols-2 gap-6 items-start\">\r\n          <div className=\"flex items-center justify-center\">\r\n            <PlanetVisual coord={coord!} className=\"w-56 h-56 md:w-72 md:h-72\" />\r\n          </div>\r\n          <div>\r\n            <PlanetInfoBlock coord={coord!} showLinkToPlanetPage={false} showBudgets={false} />\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-3 text-center\">\r\n          <span className=\"text-yellow-300\">Move fleet here</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Fleets (mock data) */}\r\n      <div className=\"game-card\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold mb-3\">Fleets</h3>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full text-sm\">\r\n            <thead className=\"text-gray-300\">\r\n              <tr className=\"border-b border-gray-700\">\r\n                <th className=\"text-left py-1 pr-4\">Fleet</th>\r\n                <th className=\"text-left py-1 pr-4\">Player</th>\r\n                <th className=\"text-left py-1 pr-4\">Arrival</th>\r\n                <th className=\"text-right py-1\">Size</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"text-white\">\r\n              {mockFleets.map((f, i) => (\r\n                <tr key={i} className=\"border-b border-gray-800/60\">\r\n                  <td className=\"py-1 pr-4 text-blue-300 hover:text-blue-200 cursor-default\">{f.fleet}</td>\r\n                  <td className=\"py-1 pr-4 text-gray-200\">{f.player}</td>\r\n                  <td className=\"py-1 pr-4 text-gray-300\">{f.arrival}</td>\r\n                  <td className=\"py-1 text-right font-mono\">{f.size}</td>\r\n                </tr>\r\n              ))}\r\n              {mockFleets.length === 0 && (\r\n                <tr>\r\n                  <td colSpan={4} className=\"py-3 text-center text-gray-400\">No fleets detected in orbit.</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Structures */}\r\n      <div className=\"game-card\">\r\n        <h3 className=\"text-lg font-semibold text-empire-gold mb-3\">Structures</h3>\r\n        {publicBuildingsError && (\r\n          <div className=\"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3\">\r\n            {publicBuildingsError}\r\n          </div>\r\n        )}\r\n        <div className=\"grid md:grid-cols-2 gap-8\">\r\n          {/* Left column - main structures */}\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full text-sm\">\r\n              <thead className=\"text-gray-300\">\r\n                <tr className=\"border-b border-gray-700\">\r\n                  <th className=\"text-left py-1 pr-4\">Structures</th>\r\n                  <th className=\"text-right py-1\">Level</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"text-white\">\r\n                {publicBuildings\r\n                  .filter((b) => b.type !== 'defense_station')\r\n                  .map((b, i) => (\r\n                    <tr key={b._id || i} className=\"border-b border-gray-800/60\">\r\n                      <td className=\"py-1 pr-4 text-gray-200\">{getBuildingLabel(b)}</td>\r\n                      <td className=\"py-1 text-right font-mono\">{b.level}</td>\r\n                    </tr>\r\n                  ))}\r\n                {publicBuildings.length === 0 && (\r\n                  <tr>\r\n                    <td colSpan={2} className=\"py-3 text-center text-gray-400\">No structures detected.</td>\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n\r\n          {/* Right column - special structures + defenses */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n            {/* Special structures */}\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"text-gray-300\">\r\n                  <tr className=\"border-b border-gray-700\">\r\n                    <th className=\"text-left py-1 pr-4\">Structures</th>\r\n                    <th className=\"text-right py-1\">Level</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"text-white\">\r\n                  {publicBuildings\r\n                    .filter((b) => b.type === 'command_center' || b.type === 'shipyard')\r\n                    .map((b, i) => (\r\n                      <tr key={b._id || i} className=\"border-b border-gray-800/60\">\r\n                        <td className=\"py-1 pr-4 text-gray-200\">{getBuildingLabel(b)}</td>\r\n                        <td className=\"py-1 text-right font-mono\">{b.level}</td>\r\n                      </tr>\r\n                    ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n\r\n            {/* Defenses */}\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"text-gray-300\">\r\n                  <tr className=\"border-b border-gray-700\">\r\n                    <th className=\"text-left py-1 pr-4\">Defenses</th>\r\n                    <th className=\"text-right py-1\">Level</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"text-white\">\r\n                  {publicBuildings\r\n                    .filter((b) => b.type === 'defense_station')\r\n                    .map((b, i) => (\r\n                      <tr key={b._id || i} className=\"border-b border-gray-800/60\">\r\n                        <td className=\"py-1 pr-4 text-gray-200\">{getBuildingLabel(b)}</td>\r\n                        <td className=\"py-1 text-right font-mono\">{b.level}</td>\r\n                      </tr>\r\n                    ))}\r\n                  {publicBuildings.filter((b) => b.type === 'defense_station').length === 0 && (\r\n                    <tr>\r\n                      <td colSpan={2} className=\"py-3 text-center text-gray-400\">No defenses detected.</td>\r\n                    </tr>\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BasePage;\r\n","import React from 'react';\r\n\r\nexport type HelpTopicId =\r\n  | 'introduction'\r\n  | 'map'\r\n  | 'coordinates'\r\n  | 'credits'\r\n  | 'bases'\r\n  | 'technologies'\r\n  | 'trade'\r\n  | 'fleets'\r\n  | 'attacks'\r\n  | 'combat'\r\n  | 'experience'\r\n  | 'newbies'\r\n  | 'empire'\r\n  | 'guild'\r\n  | 'commanders'\r\n  | 'upgrading'\r\n  | 'vacation_mode'\r\n  | 'others'\r\n  | 'starting_guide'\r\n  | 'occupied_guide'\r\n  | 'dictionary';\r\n\r\nexport interface HelpTopic {\r\n  id: HelpTopicId;\r\n  title: string;\r\n  content: React.ReactNode;\r\n  group?: 'main' | 'footer';\r\n}\r\n\r\n\r\nexport const helpTopics: HelpTopic[] = [\r\n  {\r\n    id: 'introduction',\r\n    title: 'Introduction',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Attrition is a massively multiplayer online game of space strategy. Build bases, expand your\r\n          influence, research new technologies, command fleets, wage battles, form alliances, and grow a powerful\r\n          interstellar empire.\r\n        </p>\r\n        <p>\r\n          Each player starts from a single astro and can expand into a fullfledged empire from there. Use the left\r\n          navigation to explore specific topics. The FAQ and assistant tools can be added later as separate tabs if\r\n          desired.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'map',\r\n    title: 'Map',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Each server on Attrition has many galaxies. Each galaxy has hundreds of stars and thousands of planets and\r\n          asteroids. No two galaxies are the same; each is different from the others.\r\n        </p>\r\n        <p>\r\n          A galaxy is divided into 100 square regions, laid out in a 10 x 10 grid. Each region can contain stars; some\r\n          regions have several dozen stars, while others only have a few (and sometimes none at all).\r\n        </p>\r\n        <p>\r\n          Each star on the map represents a solar system, which can have several astros (a term used to refer to\r\n          planets and other objects that orbit stars). Most astros can support bases, which allow a player to expand\r\n          their empire. Only one base can be on any given astro, but bases can be expanded and improved by building\r\n          various structures. All astros have certain common characteristics, such as terrain type, construction area,\r\n          solar energy, fertility and various resources (namely metal, gas, and crystals).\r\n        </p>\r\n        <p>\r\n          A player can only see detailed information about bases or fleets owned by other players if they have a base or\r\n          fleet somewhere in that region of space, or if one of their guild members has a base or fleet in that star\r\n          system.\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Wormholes</h3>\r\n        <p>A wormhole is a portal that creates a shortcut, allowing for fast travel.</p>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>\r\n            In each galaxy, there are 2 randomly placed wormholes with fixed positions. Being one located centrally\r\n            (regions 44/45/54/55) and other placed in the outer regions.\r\n          </li>\r\n          <li>\r\n            Players can use the wormholes to travel to any location with a speed boost. By using wormholes, stellar\r\n            units can travel to other galaxies. Death Stars are not able to use wormholes.\r\n          </li>\r\n          <li>\r\n            Wormholes provide a speed factor of 1+0.5*n, where n is the floor(average of the top 5 server Jump Gates).\r\n            For example, if the average top 5 Jump Gates is level 2, then the Wormhole speed factor becomes\r\n            1+0.5*2=2, meaning the fleet will move 2x the normal speed.\r\n          </li>\r\n          <li>\r\n            In newly opened galaxy clusters, the wormholes speed bonus depend on that cluster's Jump Gates until fleets\r\n            can move from older to new clusters, then all server Jump Gates count.\r\n          </li>\r\n          <li>\r\n            To use a wormhole, the player must place the desired fleet at the location of the wormhole and select the\r\n            option 'Use Wormhole' to use it.\r\n          </li>\r\n          <li>It's not possible to build bases at wormhole locations</li>\r\n        </ul>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'coordinates',\r\n    title: 'Coordinates',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Attrition uses a specialized coordinate system to denote locations, as detailed below (all numbers are separated by colons):\r\n        </p>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>\r\n            First, the galaxy coordinate is designated by the initial of whatever server is being viewed followed by a number representing the specific galaxy on that server. For example, in server Alpha, the first galaxy is represented by A00.\r\n          </li>\r\n          <li>\r\n            Next, the region coordinate is designated by what row and column of the galaxy it is in. For example, the region in row 5 and the column of 1 is represented by the number 51, for a region address of A00:51.\r\n          </li>\r\n          <li>\r\n            Third, the system coordinate is designated by what row and column of the region it is in, in the same manner as the region coordinate. So a system in the top-right corner of the region would be represented by the number 09, for a system address of A00:51:09.\r\n          </li>\r\n          <li>\r\n            Fourth, the astro coordinate is designated by the star orbit number. Thus, the first planet for the above system would have an astro address of A00:51:09:01. A star can upwards of 20 astros.\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'credits',\r\n    title: 'Credits',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Credits are the monetary unit used in Attrition, and are the basis of the game's economy. Credits are used to build structures and defenses on bases, to set up trade routes, to produce fleet (ships), and to invest in researching new technologies.\r\n        </p>\r\n        <p>\r\n          Credits are received every hour on the hour, based on the total economy of a player's empire. There are three main methods of increasing the amount of credits gained: building structures to improve an individual base's economy, establishing trade routes between bases, and occupying the bases of another player's. In addition, a player can also gain more credits by recycling debris left at an astro after ships are destroyed, plundering trade routes, and by pillaging bases that have been conquered, or by scrapping ships or base structures that have been previously built.\r\n        </p>\r\n        <p>\r\n          The main goal of Attrition is to optimize the resources at each base so as to efficiently improve them and use them to expand one's empire, by conquering other bases or by building new bases, and thus to increase one's credit income. Diplomacy and treaties as Alliances and Mutual Defense Pacts are good ways to achieve this objective.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'bases',\r\n    title: 'Bases',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Having a base on a planet means that a player owns that planet, and can use it to build various structures, most of which boost the base's ability to construct new buildings, produce new ships, and research new technologies, and many of which improve its economy, thus boosting the player's credit income.\r\n        </p>\r\n        <p>\r\n          Player can build defensive structures at bases to protect the base, shipyards to produce starships, and research labs to research technologies, beside others structures.\r\n        </p>\r\n        <p>\r\n          All structures cost a certain amount of credits, which directly affects how long it takes the structure to be built, and require a certain amount of energy as well. Most structures require one 'area' on the planet and one 'population' unit for each level, although there are some exceptions; for example, Urban Structures do not require a population unit, and Terraforming and Orbital Bases require neither area nor population.\r\n        </p>\r\n        <p>\r\n          Defenses are a special kind of structure that automatically help to protect a base from other players who attack it, and also protect that player's ships in orbit around the base. However, defenses will not protect the fleets of guild members who might be in orbit around that base.\r\n        </p>\r\n        <p>\r\n          To determine how long it will take a base to construct a new structure, divide the credit cost of the structure by the base's construction rating (which is measured in a number of credits that can be spent per hour); for example, a new base can construct buildings at the rate of 12 credits per hour, and a metal refinery initially costs 1 credit. Thus, it takes 1/12 of an hour to build the metal refinery, or 5 minutes.\r\n        </p>\r\n        <p>\r\n          Fleet (ships) can only be produced at bases which have shipyards at them. Like structures, ships have a credit cost and will require a certain amount of time to build (determined by the base's production rating, again measured in a number of credits that can be spent each hour). In addition, most ships require multiple shipyards to be built, and all ships have technological requirements that must be met in order to be built at all.\r\n        </p>\r\n        <p>\r\n          Likewise, technologies can only be researched at bases which have built research labs. As might be expected, they have a cost in credits and take a certain amount of time to research (this time determined by the base's research rating).\r\n        </p>\r\n        <p>\r\n          The only way to build new bases is to construct outpost ships and send them to empty planets. Thus, it is important to scout potential base locations first, to ensure that a player does not waste time by sending an outpost ship to a planet which already has a base or by building a base on a bad planet. Once a base is constructed, it can be managed in the same manner as a player's existing bases.\r\n        </p>\r\n        <p>\r\n          A player can also conquer other players' bases, which are then occupied by the conquering player. However, this does not allow the conqueror to control the occupied base; instead, they receive 30% of the base's income. The base also suffers an additional 30% reduction to its construction and research ratings, and a 30% reduction to its production rating.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'technologies',\r\n    title: 'Technologies',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Researching new technologies primarily increase the capacities of a player's ships and bases.\r\n        </p>\r\n        <p>\r\n          They also unlock new structures and starships that can be built, and grant access to more advanced technologies to further develop your empire.\r\n        </p>\r\n        <p>\r\n          You can only research technologies at bases with research labs on them. Nearly all technologies require multiple research labs.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'trade',\r\n    title: 'Trade',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Once a base has at least one spaceport built, it can start a trade route with another base.\r\n        </p>\r\n        <p>\r\n          The setting cost of a trade route is equal to 2 times the distance between the two bases. For example, a trade route from a base located in A00:49:10 to a base located in A00:59:10 will cost 20 credits, since they are 10 lightyears apart.\r\n        </p>\r\n        <p>\r\n          If a trade route is set between 2 different players, both players pay half the trade route cost.\r\n        </p>\r\n        <p>\r\n          A trade route will provide income to a base, equivalent to:\r\n        </p>\r\n        <p>\r\n          Trade Income = Sqrt(Lowest base's income) x [ 1 + Sqrt(2*Distance)/75 + Sqrt(Players)/10 ]\r\n        </p>\r\n        <p>\r\n          Where Players is the number of players involved in your trade network.\r\n        </p>\r\n        <p>\r\n          A base can have one trade route for each 5 levels of spaceports - 1 route at level 1, another at level 5, another at level 10, etc.\r\n        </p>\r\n        <p>\r\n          Trade routes can be plundered by other players, which terminates the trade route and gives a profit to the plunderer, equal to the trade route's cost.\r\n        </p>\r\n        <h3 className=\"text-lg font-semibold\">Closing trade routes</h3>\r\n        <p>\r\n          When a trade route is canceled, each trading partner receives a 50% refund. The route then enters a \"Closing\" status for 12 hours if under 1000 distance, or 24 hours if longer. Pillaging a base yields 50% of the cost of any closing trade routes, which are then terminated.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'fleets',\r\n    title: 'Fleets',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          The main way which players can attack other players is through using fleets, and can also be used to defend against another player's attack. You build ships at shipyards, a fleet being a group of ships. A fleet can be used to protect a base, or attack another player's fleets or bases.\r\n        </p>\r\n        <p>Fleets can be moved to other astros.</p>\r\n        <p>\r\n          Fleets from several players can be moved to the same location. If a player has two or more fleets headed to the same astro, they will automatically merge once both have arrived at the planet. No fleet will automatically attack any other fleet unless directed to by the player who owns it. The only way to launch an attack is to select the fleet number, select 'Attack' from the menu, then choose the target of the attack.\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Detection time</h3>\r\n        <p>\r\n          Fleets from players outside your guild, can only be detected, once it is a certain arriving time from its destination, the detection time is given by the following formula:\r\n        </p>\r\n        <p>\r\n          Detection time (hrs) = 24*((-200000/((Size*1.6*0.9^Stealth tech)+200000))+1) + 1/120\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Fleet Limit</h3>\r\n        <p>\r\n          Fleets are limited by the player's industrial capability to support them. The maximum total size of a player's fleet is based on their total production capacity, including any commander bonuses.\r\n        </p>\r\n        <p>Maximum Supported Fleet Size = Total Production * 2500</p>\r\n        <p>\r\n          Once the total fleet size reaches this maximum limit, it is no longer possible to produce new units unless the production capacity is increased.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'attacks',\r\n    title: 'Attacks',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          A successful attack on a base does two things. First, it allows the attacking player to occupy the base, transferring 30% of the base's credit income to the occupier. This represents a tribute from the conquered base to the occupier. No structures can be destroyed by an attack, although base defenses have a percentage rating which represents how effective they are. Base defenses are automatically set at 0% once a base is occupied, and will automatically regenerate by 1% every hour after an occupation ends.\r\n        </p>\r\n        <p>\r\n          Second, a successful attack will also give the attacker a percentage of the defending player's credits, due to the attacking ships ransacking the resources and materials (represented by credits) stored there. The actual amount is determined by the following formula:\r\n        </p>\r\n        <p>\r\n          Pillage = (number of hours since last pillage; max 100)% * (Base Economy/Total Bases Economy) * Base Owner Credits.\r\n        </p>\r\n        <p>In NPC bases: Pillage = number of hours since last pillage (max 100)% * Base Economy * 16</p>\r\n        <p>Also an additional pillage bonus is given</p>\r\n        <p>Additional Pillage bonus: (base actual income - new income)^2 * 5</p>\r\n        <p>\r\n          No base can be pillaged more than once every 24 hours, however. Additional attacks launched during this time will result in the base being occupied, but will not give additional credits from pillaging.\r\n        </p>\r\n        <p>\r\n          An occupied base has 30% less construction, production and research capacity. This makes any tasks performed at the base take longer.\r\n        </p>\r\n        <p>\r\n          If ships are destroyed during an attack, 20% of the cost of the units destroyed will be given to each player as combat loot, and 40% will be converted into debris which will remain at the location of the attack. A player can collect those debris by sending recyclers to that astro, recyclers will work automatically, converting debris into credits every hour.\r\n        </p>\r\n        <p>\r\n          The combat loot can be collected in the game credits page. Uncollected loot is automatically credited to the player's account after 24 hours.\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Unrest</h3>\r\n        <p>\r\n          Bases that are occupied or have being occupied or pillaged in the last 24 hours, increases unrest by 10% each day.\r\n        </p>\r\n        <p>\r\n          However, if a base has not been occupied or pillaged in the last 24 hours, its unrest level decreases by 10% each day, down to a minimum of 0%.\r\n        </p>\r\n        <p>\r\n          When unrest reaches 100% the base owner will have an Revolt button that will free the base from occupation.\r\n        </p>\r\n        <p>\r\n          It's important to note that the enemy fleet remains present at the base but cannot occupy it. However, they can still attack your fleet if you have any located at the base.\r\n        </p>\r\n        <p>\r\n          While a base's unrest level is at 50% or higher, it cant get a new occupation (but the base and fleet can still be attacked, but a successful attack on the base will not result in pillaging). Additionally, if the base's unrest level is at 50% or higher and there are fleets present that do not belong to the base owner or their guild, the Jump Gates of the base are disabled.\r\n        </p>\r\n        <p>\r\n          When a base's unrest level decreases from 50% to 40%, all of its defenses are fully restored. At this point, the base becomes open to occupation again, and its Jump Gates can be used.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'combat',\r\n    title: 'Combat',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <h3 className=\"text-lg font-semibold\">Combat basics</h3>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>Attack = The amount of damage a unit deals.</li>\r\n          <li>Armour = The amount of damage a unit can receive before being killed.</li>\r\n          <li>\r\n            Shielding = The shielding of a unit prevents damage equal to itself from each shot of enemy fire.\r\n          </li>\r\n        </ul>\r\n        <p>\r\n          (Note: 1% of the attack always cross the shields, except Ion Bombers and Ion Frigates of which 50% damage crosses any shielding)\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Example</h3>\r\n        <p>\r\n          A Cruiser that deals 40 damage against a Titan with 30 shielding will only deal 10 damage to the Titan. If the Titan has 4000 armour then it will take 400 Cruisers to one shot kill it.\r\n        </p>\r\n        <p>(note: to simplify the 1% of cross-shield damage was not considered in this example)</p>\r\n\r\n        <p>\r\n          For ships of Cruiser type and up any damage dealt to it that is not sufficient to kill it will leave a percentage of a ship behind. This will require 50% of the cost to build the ship to repair modified by the percentage of damage dealt to the ship (ie a Battleships at 0.6 will cost 400 credits to repair).\r\n        </p>\r\n        <p>Bases defenses will auto repair at 1% per hour in non occupied bases.</p>\r\n        <p>Max number of fighters that can target a unit in a combat round = 2 x unit size.</p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'experience',\r\n    title: 'Experience',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          After combat, players gain experience points based on the total destruction to both players multiplied by a % based on the difference of levels between players.\r\n        </p>\r\n        <p>If the enemy's level is above your level:</p>\r\n        <p>XP = (enemy/your level) /20 * Total Fleet destroyed</p>\r\n        <p>(max: 10% * Total fleet destroyed)</p>\r\n        <p>If your level is above the enemy's level:</p>\r\n        <p>XP = (enemy/your level)^2 /20 * Total Fleet destroyed</p>\r\n        <p>Combat with NPCs:</p>\r\n        <p>XP = 5% * Total Fleet destroyed</p>\r\n        <p>\r\n          The total combat experience points a player has does not directly measure how well they fight, it only means that they have been involved in more or larger battles, and against stronger opponents.\r\n        </p>\r\n        <p>\r\n          It works also as a small compensation for players that are fighting higher level players, and an incentive to players to fight players at their own level or even above.\r\n        </p>\r\n        <p>Experience points can be spent on commanders.</p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'newbies',\r\n    title: 'Newbies',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <h3 className=\"text-lg font-semibold\">Newbie Protection</h3>\r\n        <p>In order to protect newbies (new players) the following rules are applied:</p>\r\n        <p>--------------------------------------------------------------------------------</p>\r\n        <p>Players under level 10 - Player bases cant be attacked.</p>\r\n        <p>Players over level 10 - Bases can only be attacked by players within 150% of the defender's level.</p>\r\n        <p>\r\n          These protections are only valid to the player bases and not to his fleets outside of his bases or to unguarded trade routes.\r\n        </p>\r\n        <p>\r\n          These protections are not valid in occupied bases if the attack is done by the occupier or someone from the same guild.\r\n        </p>\r\n        <p>\r\n          If a protected player attacks others over the protection level outside his bases he/she loses his protection for 48 hours.\r\n        </p>\r\n        <p>--------------------------------------------------------------------------------</p>\r\n        <p>\r\n          If a player attacks/occupies a player less than 65% of their level; then they only get x% of the pillage/trade route plunder/occupation income.\r\n        </p>\r\n        <p>x% = Defender level / Attacker level x 100%</p>\r\n        <p>--------------------------------------------------------------------------------</p>\r\n        <p>\r\n          However, if you start surrounded by stronger players, it is recommended that you join a guild as soon as possible, to gain protection from stronger players.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'empire',\r\n    title: 'Empire',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          A player's empire is represented by all of that player's bases and fleet and all bases occupied by that player.\r\n        </p>\r\n        <p>\r\n          The three main ways of measuring an empire's strength; the total economy of the empire, the total amount of fleet that the empire has, and the total technological development of the empire.\r\n        </p>\r\n        <p>\r\n          The latter two are measured in credits spent in each category. Finally, another indicator of an empire's strength is the player's level. This is calculated with the following formula:\r\n        </p>\r\n        <p>Player Level = (Economy x 100 + fleet + technology) ^ 0.25</p>\r\n        <p>(The ^ symbol denotes an exponent; ^.25 means to take the 4th root)</p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'guild',\r\n    title: 'Guild',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          A guild is a group of players that work together under the same banner. It is run by the player who is\r\n          designated as the guildmaster, and other players can play important roles in the guild (diplomacy, for\r\n          example). Guilds can be democratic, anarchistic, totalitarian, and/or some many other types of government.\r\n          Players can join for various reasons, most often due to friends wanting to work together and players wanting\r\n          to find protection.\r\n        </p>\r\n        <p>\r\n          A guild generally provides protection to its members (safety in numbers), and a member can usually count on\r\n          assistance and support from other guildmembers.\r\n        </p>\r\n        <p>Guild members have access to a guild board where they can easily communicate with others guild members.</p>\r\n        <p>\r\n          Guilds can also have their own website and messageboard/web forum, which is recommended to improve guild\r\n          communication.\r\n        </p>\r\n        <p>\r\n          A player can create a new guild, or apply to join an existing guild. The guildmaster has the authority of\r\n          accepting new members, kicking existing members (although any player can withdraw from a guild at any time for\r\n          any reason), and even to appoint a new guild master from one of the other guild members. Guildmasters can also\r\n          give individual members permissions to help out around the guild.\r\n        </p>\r\n        <p>\r\n          Obviously, members of the same guild are unable to attack each other or otherwise interfere with another guild\r\n          member's fleets or planets.\r\n        </p>\r\n        <p>\r\n          An indicator of a guild strength is the guild's level. This is calculated with the following formula:\r\n        </p>\r\n        <p>Guild Level = (Guild Economy x 100 + Guild Fleet + Avg. Guild Technology) ^ 0.25</p>\r\n        <p>(The ^ symbol denotes an exponent; ^.25 means to take the 4th root)</p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'commanders',\r\n    title: 'Commanders',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Commanders can be recruited and trained to give specific bonuses. You can do so by using either experience\r\n          points or credits.\r\n        </p>\r\n        <p>\r\n          A base can only have one base commander assigned there, giving a bonus that is based on the commander's\r\n          skill and level.\r\n        </p>\r\n        <p>\r\n          When a base is pillaged or successfully attacked, there is a 10% chance that each commander located there will\r\n          be killed. Commanders not in duty can also die.\r\n        </p>\r\n        <p>\r\n          When a construction commander is assigned to a base, it cannot be removed if the base has a structure\r\n          currently being constructed. The same goes for research commanders while researching and production commanders\r\n          while building ships.\r\n        </p>\r\n        <p>\r\n          Also, if a commander is assigned to a base you must wait at least 48 hours before removing their assigned\r\n          task.\r\n        </p>\r\n        <p>\r\n          You must have at least 1 command center to recruit a commander. The maximum number of commanders you can have\r\n          is equal to the level of your Computer technology.\r\n        </p>\r\n        <p>\r\n          When your commander is in the commander pool, it takes 10 minutes to get to any of your bases. You can move\r\n          your commanders between bases, the travel duration being equivalent to a scout ship's travel time.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'upgrading',\r\n    title: 'Upgrading',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>Upgrading will remove advertising and add extra game features, improving gameplay.</p>\r\n        <p>Upgrade costs less than 0.06 per day if you upgrading 12 months.</p>\r\n        <p>\r\n          At the game account/upgrade page you can compare the game upgraded account versus free accounts, and\r\n          see the upgrades prices.\r\n        </p>\r\n        <p>\r\n          We accept several payment methods, as PayPal, credit card, wire transfer, Western Union, and phone (DaoPay).\r\n        </p>\r\n        <p>You can also upgrade others players accounts, by going to their game profiles.</p>\r\n        <p>New game accounts start upgraded for the first 7 days of play.</p>\r\n        <h3 className=\"text-lg font-semibold\">Why should I upgrade my account?</h3>\r\n        <p>\r\n          This is needed to allow us to pay for servers, personnel and to support further development. This also\r\n          ensures sustainability and the long term success of Attrition which benefits all players.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'vacation_mode',\r\n    title: 'Vacation Mode',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          Player can select to be in vacation mode, if for some reason they will be away from the game during several days.\r\n        </p>\r\n        <h3 className=\"text-lg font-semibold\">Vacation Mode Rules</h3>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>Only upgraded players can set the vacation mode.</li>\r\n          <li>Vacation mode cannot be removed for 72 hours except within the first hour it's set.</li>\r\n          <li>After the vacation mode is removed you can only start attacks after 4 hours.</li>\r\n          <li>After vacation mode is removed it can only be reactivated after 5 days.</li>\r\n          <li>Vacation mode can only be used for 35 days in a civil year.</li>\r\n        </ul>\r\n        <h3 className=\"text-lg font-semibold\">While in vacation mode</h3>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>Your bases cannot be attacked (only comes into effect 24 hours after vacation mode is set).</li>\r\n          <li>Your fleets outside your bases and on your occupied bases can still be attacked.</li>\r\n          <li>Your occupied bases can still be attacked and pillaged during vacation mode.</li>\r\n          <li>Your profile will display a vacation mode badge (only comes into effect 24 hours after vacation mode is set).</li>\r\n          <li>You get half of your economy income, even after 4 days of inactivity.</li>\r\n          <li>You cannot move or do any other action with your fleets.</li>\r\n          <li>Your recyclers don't collect debris.</li>\r\n          <li>You cannot start or queue new constructions, productions, research or trade routes.</li>\r\n          <li>Constructions and researches that are already in the queue stay there, but the time to complete them doubles.</li>\r\n          <li>Your guild mates cannot use your bases jump gates.</li>\r\n        </ul>\r\n      </div>\r\n    ),\r\n  },\r\n  {\r\n    id: 'others',\r\n    title: 'Others',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <h3 className=\"text-lg font-semibold\">Messages</h3>\r\n        <p>\r\n          Attrition includes a private messaging system that allows a player to contact any other player in the game.\r\n        </p>\r\n        <p>\r\n          Players are responsible for the contents of their communications. offensive, racist, pornographic material, and\r\n          other such harmful comments are prohibited, and may result in the game administration deleting or otherwise\r\n          preventing a user from communciating who violates this rule.\r\n        </p>\r\n        <p>If you wish to save any messages that have been sent to you, there is a savebox available.</p>\r\n        <p>\r\n          All players can place other players into their contacts list, which is a quick way of keeping track of them so\r\n          they are easily located to send messages to.\r\n        </p>\r\n        <p>In addition, players can also block other players if they do not wish to receive messages from that player.</p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Notes</h3>\r\n        <p>\r\n          Each player has the ability to create and store individual notes, allowing easy access to important\r\n          information for later review. You can edit and delete current notes.\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Bookmarks</h3>\r\n        <p>Each player has the ability to store individual location bookmarks.</p>\r\n        <p>\r\n          Those locations are shown when you go at the fleet movement page, so you can fast select those locations as\r\n          fleet destinations.\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Recruiting</h3>\r\n        <p>Help promoting Attrition.</p>\r\n        <p>If you use your recruit link to bring new players to game, you will get extra credits as bonus.</p>\r\n        <p>\r\n          For each recruit upgraded you will receive a one turn bonus of 10% of your total economy (up to a max. of\r\n          100%). This bonus is given daily at server time 0h.\r\n        </p>\r\n        <p>\r\n          There are game banners with your recruit link attached, in the account/banner page. All you need to do is copy\r\n          the appropriate code into your HTML page.\r\n        </p>\r\n        <p>\r\n          (Note: Players must join the same server as you using your recruit link to be your recruit. The trial upgrade\r\n          does not count as upgraded)\r\n        </p>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Forum</h3>\r\n        <p>\r\n          The game forum is a place where players can talk about game-related subjects, such as politics, guild\r\n          recruitment, game feedback, support, and assistance, and there are also alternative languages forums.\r\n        </p>\r\n        <p>\r\n          Offensive or otherwise harmful comments are prohibited, and may result in a player being suspended or banned\r\n          from the forums or game.\r\n        </p>\r\n      </div>\r\n    ),\r\n  },\r\n\r\n  // Footer group (separated visually on the left list)\r\n  {\r\n    id: 'starting_guide',\r\n    title: 'Starting Guide',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>\r\n          If you have just started the game, there is a good chance that many other players are already playing, and that they are far stronger than you. You should not worry too much about these players now, as the game will protect your bases against stronger players in the first few days.\r\n        </p>\r\n        <p>\r\n          So, your first concern should be to raise your base construction, in order to make structures build faster. We advise you to build a few Metal Refineries first, as these will not only improve your construction and production capacities, but will also increase your economy.\r\n        </p>\r\n        <p>\r\n          After you get Metal Refineries up to about level 4, you will probably have noticed that they are getting more expensive and taking longer to build every time. So now you should build a Research Labs, and research Computer technology up to level 2, to unlock the Robotic Factories structures. These are similar to Metal Refineries, so you can build both alternately to compensate for the increase in the prices at each level.\r\n        </p>\r\n        <p>\r\n          Next, while you continue to build structures, you should research Energy technology up to level 6, to unlock Fusion Plants. These are more expensive than Solar Plants and Gas Plants, but will allow you to generate more Energy each time (unless you're lucky to be on a planet with solar or gas energy 4).\r\n        </p>\r\n        <p>\r\n          At some point you should also start building some Shipyards, because they are cheap at the start and they will also help boost your economy (and you never know when you'll need them).\r\n        </p>\r\n        <p>\r\n          Now you probably have a few levels of Metal Refineries and Robotic Factories, and a relatively fast Construction, and your credits are running out, right? It's time to raise your Economy a little more. Build some Spaceports and set up a Trade Route with someone who has a good Economy (don't forget to ask for permission first, and if you are in a guild, try to make it with someone from your guild).\r\n        </p>\r\n        <p>\r\n          Crystal Mines are also great to raise your Economy, but only if you're lucky enough to have started on a planet with Crystals (in that case you should have been building them since earlier on in the guide).\r\n        </p>\r\n        <p>\r\n          Well, now you have a decent Construction, Production, and Economy, and everything is getting even more expensive. You need to prepare to set up new bases on other planets, wich means you'll have to create Outpost Ships.\r\n        </p>\r\n        <p>\r\n          If you look at the game Tables you'll see that you need Warp Drive (1) to unlock the Outpost Ship, but that also means that you will first need to have Research Labs (8), Stellar Drive (4), and Energy (8). Finally, you will need Shipyards (8) in order to build your Outpost ship. It may seem a lot, but this should take less than one day, if you keep your Construction and Research queues full.\r\n        </p>\r\n        <p>\r\n          When you're done, just choose an astro, move your Outpost Ship there, and when it arrives choose 'Build Base' from the Fleet Menu (note that you'll have to pay 100 credits to construct up your first new Base, and this value will increase with each new base).\r\n        </p>\r\n        <p>\r\n          Now you should evolve your second Base faster than the first one and your Economy will rise fast too. But be weary of other players trying to Conquer you. By now, you should have started to prepare your defenses too!\r\n        </p>\r\n        <p>\r\n          Is recommended that you join a guild early as possible, to get some protection from stronger players.\r\n        </p>\r\n        <p>Have a good game! :-)</p>\r\n      </div>\r\n    ),\r\n    group: 'footer',\r\n  },\r\n  {\r\n    id: 'occupied_guide',\r\n    title: 'Occupied Guide',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <p>Simple strategy guide to follow, when your bases are occupied.</p>\r\n        <p>There are several ways and tactics to get rid of occupations. Here are some tips and hints to achieve that goal:</p>\r\n        <ol className=\"list-decimal pl-6 space-y-1\">\r\n          <li>Build a lot of command centers. The more the better.</li>\r\n          <li>\r\n            Match the unit you build to attack an occupier. If they have a lot of unshielded craft, use fighters. If they have mostly cruisers or heavy cruisers, use bombers or heavy bombers. With battleships, use heavy bombers. If they have really big units, use ion bombers.\r\n          </li>\r\n          <li>Don't get into a pattern of always attacking at a certain time.</li>\r\n          <li>\r\n            If there's a lot of debris, use recyclers to collect the debris. However, don't leave the recyclers there.\r\n          </li>\r\n          <li>\r\n            Bases that are occupied increases unrest by 10% each day. When unrest reaches 100% you can Revolt and free the base from occupation. While a base is with unrest at 50% or more it cant get a new occupation. When a base unrest decreases from 50% to 40% the base gets all the defenses restored. So is good to build defenses to make harder your base get occupied again.\r\n          </li>\r\n        </ol>\r\n        <p>\r\n          If you do a good job, the occupier will start losing more credits than he earns from your bases, increasing significantly your chances that he/she will withdraw and leave you alone.\r\n        </p>\r\n        <p>\r\n          Still, your best option will always be to join a good guild and get help from other players to liberate your bases.\r\n        </p>\r\n        <p>Diplomacy is also very important against a much stronger opponent. Try talking him out of your bases.</p>\r\n        <p>\r\n          If all this fails, your final and more desperate solution may be to disband your bases and relocate to a safer area. For each base you disband you get a portion of the base's structures value in discount when establishing new bases to replace the ones you disbanded.\r\n        </p>\r\n      </div>\r\n    ),\r\n    group: 'footer',\r\n  },\r\n  {\r\n    id: 'dictionary',\r\n    title: 'ATT Dictionary',\r\n    content: (\r\n      <div className=\"space-y-4\">\r\n        <h3 className=\"text-lg font-semibold\">General</h3>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>ATT = Attrition</li>\r\n          <li>Acc = Account</li>\r\n          <li>Newbie = New player</li>\r\n          <li>Mod = Moderator</li>\r\n          <li>Indy = Independent player not associated with a guild</li>\r\n          <li>Exp = Combat Experience</li>\r\n          <li>Farm (verb) = Occupying a base for an extended period</li>\r\n          <li>AI = Artificial Intelligence</li>\r\n          <li>Tech = Technology</li>\r\n          <li>Loc = Location</li>\r\n          <li>TR = Trade Routes</li>\r\n          <li>JG = Gate = Jump Gate</li>\r\n          <li>CC = Command Centers</li>\r\n          <li>UC = United Colonies (a NPC account)</li>\r\n          <li>P-rings = Rings = Planetary Ring</li>\r\n          <li>P-shield = Planetary Shield</li>\r\n        </ul>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Diplomacy</h3>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>NAP = Non Aggression Pact</li>\r\n          <li>MDP = Mutual Defense Pact</li>\r\n          <li>Bloodpact = very strong alliance</li>\r\n          <li>KOS = Kill On Sight</li>\r\n          <li>CF = Cease Fire</li>\r\n          <li>ToA = Treaty of Armistice</li>\r\n        </ul>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Ship Terms</h3>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>FT = Fighter</li>\r\n          <li>BO = Bombers</li>\r\n          <li>HB = Heavy Bombers</li>\r\n          <li>IB = Ion Bomber</li>\r\n          <li>CV = Vette = Corvette</li>\r\n          <li>RC = Cyclers = Recyclers</li>\r\n          <li>DE = Destroyers</li>\r\n          <li>FR = Frigate</li>\r\n          <li>IF = Ion Frigate</li>\r\n          <li>SS = Scout = Scout Ship</li>\r\n          <li>OS = Outpost Ship</li>\r\n          <li>CR = Cruiser</li>\r\n          <li>CA = Carrier</li>\r\n          <li>HC = Heavy Cruiser</li>\r\n          <li>BS = Battleship</li>\r\n          <li>FC = Fleet Carrier</li>\r\n          <li>DN = Dread = Dreadnought</li>\r\n          <li>TI = Titan</li>\r\n          <li>LV = Levi = Leviathan</li>\r\n          <li>DS = Death Star</li>\r\n        </ul>\r\n\r\n        <h3 className=\"text-lg font-semibold\">Combat</h3>\r\n        <ul className=\"list-disc pl-6 space-y-1\">\r\n          <li>Waves = breaking an assault into multiple attacks</li>\r\n          <li>Meat Shields = many small units to keep your large units safer</li>\r\n          <li>Ratio = Kill Ratio, eg: losses: 1000 / 6000 = 6:1 kill ratio for attacker</li>\r\n        </ul>\r\n      </div>\r\n    ),\r\n    group: 'footer',\r\n  },\r\n];\r\n\r\nexport const defaultTopicId: HelpTopicId = 'introduction';\r\n","import React from 'react';\r\n\r\nexport type FaqTopicId =\r\n  | 'astro_empires'\r\n  | 'upgraded_account'\r\n  | 'game_account'\r\n  | 'recruiting_players'\r\n  | 'guilds'\r\n  | 'bases'\r\n  | 'colonization'\r\n  | 'trade'\r\n  | 'fleets'\r\n  | 'commanders'\r\n  | 'attacks_on_bases'\r\n  | 'recyclers'\r\n  | 'players'\r\n  | 'server_npcs'\r\n  | 'inactivity'\r\n  | 'others'\r\n  | 'shared_ips';\r\n\r\nexport interface FaqItem {\r\n  q: string;\r\n  a: React.ReactNode;\r\n}\r\n\r\nexport interface FaqTopic {\r\n  id: FaqTopicId;\r\n  title: string;\r\n  items: FaqItem[];\r\n  group?: 'main' | 'footer';\r\n}\r\n\r\nexport const defaultFaqTopicId: FaqTopicId = 'astro_empires';\r\n\r\nexport const faqTopics: FaqTopic[] = [\r\n  {\r\n    id: 'astro_empires',\r\n    title: 'Astro Empires',\r\n    items: [\r\n      {\r\n        q: 'What is Astro Empires?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Astro Empires is a persistent space strategy game where you build bases, manage resources,\r\n              research technologies, trade, command fleets, and coordinate with a guild to expand your empire.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I progress efficiently?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Focus on establishing stable economic bases, researching key technologies, and using trade routes\r\n              to sustain growth. Coordinate fleet movements to protect assets and seize opportunities.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'upgraded_account',\r\n    title: 'Upgraded Account',\r\n    items: [\r\n      {\r\n        q: 'I have just created a game account, but I noticed that it will expire in few days. What does that mean?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Every new game account starts off with an account upgrade lasting 7 days. After those seven\r\n              days, the account turns into a free account unless the owner of the account (or anyone else)\r\n              upgraded it beforehand.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'After my upgrade expires what happens?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              After your account upgrade expires your account becomes a free account, free accounts shows\r\n              advertising and are limited in some features, compare here.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Do I lose my bases above 9, or my advanced structures above level 5 if my account upgrade expires?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No, you get to keep what you already have, but you cannot build any more bases or advanced\r\n              structures than their current number/level.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How does Upgrading an account work?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Upgrading will improve your gameplay, removing site advertising and add extra features to your\r\n              account. See the upgrade page for more information.\r\n            </p>\r\n            <p>\r\n              This is needed in order to ensure the long term success and sustainability of the Astro Empires\r\n              game, to the benefit of all players.\r\n            </p>\r\n            <p>\r\n              This allows us to have fast and reliable servers, remove most game limits, and help us to\r\n              improve this game.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Which payment processors you are using?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>We accept payments via debit/credit card and PayPal.</p>\r\n            <p>It is also possible to pay via Wire Transfer or Western Union.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What are the upgrade prices in US Dollars or other currencies?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              To convert Euros into other currencies, please check on the internet, for example on this\r\n              website: https://www.xe.com.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I pay with U.S. Dollars instead of Euros?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              When you pay via debit/credit card or Paypal the payments are converted automatically from your\r\n              currency to Euros.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'I am having problem upgrading via Paypal, what can I do?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>Try to contact Paypal directly if you are having problem with your credit card.</p>\r\n            <p>\r\n              If you are still unable to upgrade, you can pay by alternative ways such as debit/credit card,\r\n              wire transfer or Western Union (available at most post offices).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How long takes to I get my account upgraded after the payment?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              If you pay using your credit card or PayPal account, the account upgrade takes place\r\n              immediately after payment.\r\n            </p>\r\n            <p>If you pay via wire transfer the account upgrade takes about 1 or 2 business days.</p>\r\n            <p>If you pay via Western Union the account upgrade takes about 1 or 2 business days.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'My account upgrade expiration date is not correct.',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              This is most probably because you understand a different date format, for example 05-10-2007,\r\n              mean day 5 of October 2007, as this is the date format (day-month-year) used in most European\r\n              Countries including Portugal where the game is established. In the US and other far-western\r\n              countries, the date goes month-day-year.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Are credit card payments charged recurringly?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>The payments are one-time; they do not recur.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I split upgrade time between game accounts?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>No, it is not possible.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I upgrade a friends game account?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Just go to that player profile page and click on Upgrade this account and follow the prompts\r\n              to complete the upgrade process.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I pay real money for in game credits?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>No. ATT does not run such a system.</p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'game_account',\r\n    title: 'Game Account',\r\n    items: [\r\n      {\r\n        q: 'How can I change my account password or email?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Go to your game account page and click on Profile, then at your profile page click on Edit\r\n              Profile.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I share the one account with my brother and or friend?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>No. Account sharing is explicitly forbidden in AE for it is seen as unfair.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How can I delete my game account?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>Go to your account page, and click on Delete Account.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I transfer upgrade time from one game account to other game account?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No, is not possible (the only exception is when you delete your account to restart on a new\r\n              one, see below).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'I want to restart, how can I do that?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              To restart your game account, go to your game account page, and there is a Restart Account\r\n              option.\r\n            </p>\r\n            <p>\r\n              If your account is above a certain level, it may not be possible to restart it directly. In\r\n              this case, you will need to delete your game account and start a new one in the same server. If\r\n              you have upgraded your account, you can contact the game's support with both account numbers\r\n              (the deleted account and the new one) and request to transfer any remaining upgrade time\r\n              between accounts.\r\n            </p>\r\n            <p>\r\n              <strong>Important:</strong> Transfer upgrade time between accounts is only possible if you\r\n              restart in the same server.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I start over with my current technology/credits?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No. Is not possible to restart with your current credits or technology, you can only restart\r\n              with a complete new account.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'recruiting_players',\r\n    title: 'Recruiting Players',\r\n    items: [\r\n      {\r\n        q: 'If I advertise this game to others, will I receive something?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              If you give someone your recruit link (found in Account/Recruits) and they sign up for the game, they become your recruit.\r\n            </p>\r\n            <p>\r\n              For each upgraded recruit you will receive a one-turn bonus of 10% of your total economy (up to a maximum of 100%). This bonus is awarded daily at 00:00 server time.\r\n            </p>\r\n            <p>\r\n              Note: The 7-day trial upgrade does not count toward this bonus. The recruit must also join the same game server as your recruit-link account for you to receive the bonus.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'I have recruited a friend to game, but he/she is not displayed as my recruit.',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              A player must join the game by using your recruit link, and in the same server, for them to become your recruit.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I request to an Attrition staff to change a player to be my recruit as I told him about the game?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No. They must join using your recruit link, otherwise they will not be your recruit.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'guilds',\r\n    title: 'Guilds',\r\n    items: [\r\n      {\r\n        q: 'What is a Guild?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              A Guild is a group of players within the same organization, run by players themselves. It could be democratic, anarchistic, totalitarian, etc. Any player can join a guild for whatever reasons, and more simply a guild can just be a group of friends.\r\n            </p>\r\n            <p>\r\n              Each guild is supposed to provide mutual protection for all guild members, and a place where they can draw support and assistance from the other players (guildees, as they are often referred to).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I join a guild?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              To join a guild, go to that guilds profile and click Request to join this guild.\r\n            </p>\r\n            <p>\r\n              Your request must be accepted by a member of that guild with permission to accept new members.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Do I have to be a certain level to join a guild?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              There is no level requirement to apply to a guild. However, some guilds may set their own minimum thresholds.\r\n            </p>\r\n            <p>\r\n              You cannot apply to join a guild if you are already in one.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Is there any limit of number of members in a guild?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>Guilds are limited to 50 members.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What does the inactivity column mean at the guild page?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              It shows how long it has been since each player last accessed that server.\r\n            </p>\r\n            <p>\r\n              Example: an inactivity of 30 min means they last accessed the game 30 minutes ago.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'When defending a guild members base, will his defenses and/or command centers assist you in defending?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Base defenses assist only the base owner, not other members of their guild. The same applies to command centers.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How is a guild level calculated?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              <strong>Guild Level</strong> = (Guild Economy  100 + Guild Fleet + Avg. Guild Technology) ^ 0.25\r\n            </p>\r\n            <p>\r\n              (The ^ symbol denotes an exponent; ^0.25 means to take the fourth root.)\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n{\r\n  id: 'bases',\r\n  title: 'Bases',\r\n  items: [\r\n    {\r\n      q: 'How do I get more energy at my base?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            To increase the amount of energy your base has, build energy facilities (usually known as power\r\n            plants) such as solar plants, gas plants and fusion plants. These all increase the base energy.\r\n            You can also build antimatter plants, which provide a large amount of energy compared to the\r\n            other energy facilities.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'Why cannot I build anything?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            If you cannot build anything, then you are either out of population, energy or land. To increase\r\n            population build more Urban Centers and Orbital Bases; for energy build different plants and for\r\n            land build Terraforms and Multi-Level Platforms.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'I do not see the structure Crystal Mines on my building screen. Why is that so?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            Your planet does not have any crystals on it (only Crystallines, Asteroids, Craters, and\r\n            Metallics do).\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'If I make a Biosphere Modification, does it affect the Urban Structure I already have?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>It gives you the bonus for every Urban Structure you already have.</p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'How can I decrease a level of my building?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            To decrease your buildings you need to click on the name of the building on your construction\r\n            screen. You will then be given a list of the costs to build each level and an option to disband\r\n            one level, you will get 50% of the cost back as a discount in the price of your next base.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'I disbanded a base but did not receive any credits.',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            You do not receive credits for disbanding bases; instead, the credits go into a discount which\r\n            is taken away from the cost of your next base. You can view this discount in your game Account\r\n            page.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'I downgraded a structure/defense base but did not receive any credits.',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            Works just like the above (I disbanded a base did not receive any credits).\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'Can I disband my home planet?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            Yes, it is no different than disbanding any other base, however you must have always at least\r\n            one base.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: \"Why don't my construction or other events update? They keep showing the -\",\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            When the server is too busy, the game events (construction, production, research, fleets arrive,\r\n            etc..) can take some time to update.\r\n          </p>\r\n          <p>\r\n            This also occurs after a server downtime, but all will be back to normal in seconds or minutes.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'Why do my game events (constructions etc..) keep restarting their times?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            Probably you are seeing an old page saved in your browser cache, which is not updated, try to\r\n            select on your browser options to always load the web pages instead of display pages saved in\r\n            your browser cache.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'Why I cannot see my bases or fleets on the galaxy map?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            Check if you are seeing the galaxy where you have your bases/fleets, if not change the galaxy\r\n            you want to see.\r\n          </p>\r\n          <p>\r\n            If this is not the problem, check your browser options to see if the JavaScript is active.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      q: 'Do I get the same credits disbanding the base at once, or I should downgrade the buildings before disbanding?',\r\n      a: (\r\n        <div className=\"space-y-2\">\r\n          <p>\r\n            You will get the same amount of credits (in discount on the next base construction) in both\r\n            ways, so the first is recommended for convenience.\r\n          </p>\r\n        </div>\r\n      ),\r\n    },\r\n  ],\r\n},\r\n  {\r\n    id: 'colonization',\r\n    title: 'Colonization',\r\n    items: [\r\n      {\r\n        q: 'How much do bases cost?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>Every base you build will cost more than the previous base.</p>\r\n            <p>\r\n              <strong>New bases cost:</strong> 100, 200, 500, 1k, 2k, 5k, 10k, 20k, 50k, 100k, 200k, 400k,\r\n              650k, 1M, 1.5M, 2.5M, 4M, 6.5M, 10M, 15M, 25M, 40M, 65M, 100M, 150M, 250M, 400M, 650M, ...\r\n            </p>\r\n            <p>\r\n              However, if you delete one of your bases the next one will cost <strong>25%</strong> of the\r\n              cost it would have.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What decides a good planet to colonize from a bad planet?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              This depends on what you want the astro to do: fleet production, boosting your economy,\r\n              research, etc.\r\n            </p>\r\n            <p>\r\n              For <strong>economy</strong>, aim for either an <strong>Asteroid</strong> or a{' '}\r\n              <strong>Crystalline</strong> (though Crystallines are rarer).\r\n            </p>\r\n            <p>\r\n              For <strong>production</strong>, <strong>Rockies</strong> are the best, with{' '}\r\n              <strong>Metallics</strong> and <strong>Craters</strong> also filling this role well.\r\n            </p>\r\n            <p>\r\n              For <strong>research</strong>, <strong>Gaia</strong>, <strong>Earthly</strong>, or{' '}\r\n              <strong>Arid</strong> are usually preferred due to large area and high fertility, though they\r\n              suit most tasks well.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How can I build another base on an empty planet?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>Build an <strong>Outpost Ship</strong>.</p>\r\n            <p>\r\n              Move the Outpost Ship to the desired location (escorting it with other ships is recommended).\r\n            </p>\r\n            <p>\r\n              Go into the fleet with the Outpost Ship and click Build base.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Do I lose my Outpost Ship when I build a new base?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>Yes. An Outpost Ship is only usable to build one base.</p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'trade',\r\n    title: 'Trade',\r\n    items: [\r\n      {\r\n        q: 'How do I get more trade routes?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              You get more trade routes by building <strong>Spaceports</strong>. Spaceports increase the\r\n              available number of trades for a base by one at levels <strong>1, 5, 10, 15, 20</strong> and\r\n              so on.\r\n            </p>\r\n            <p>Each Spaceport also increases your base economy by <strong>2 credits/hour</strong>.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How is a trade income calculated?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              <strong>Trade Income</strong> = Sqrt(Lowest base's income)  [ 1 + Sqrt(2  Distance)/75 +\r\n              Sqrt(Players)/10 ]\r\n            </p>\r\n            <p>\r\n              <strong>Players</strong> = number of different players you trade with.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I trade with myself?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Yes. There is no real disadvantage other than you only count as one trading partner.\r\n            </p>\r\n            <p>\r\n              When you trade with yourself you get twice the value for the trade route, but it occupies two\r\n              slots (one on each base).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I boost the income from trade routes?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>These are the main ways to increase trade income:</p>\r\n            <ul className=\"list-disc pl-5 space-y-1\">\r\n              <li>Increase the economy of the bases involved in the trade route.</li>\r\n              <li>Increase the distance between the bases.</li>\r\n              <li>Increase the total number of different players you trade with.</li>\r\n            </ul>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How can I plunder trade routes?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Access your fleet and click on the <strong>Piracy</strong> option. Your fleet must be stationed\r\n              at the targeted base, and there must be no opposing fleets present  including the base owner,\r\n              their guild members, or fleets belonging to the owner of the trade routes destination base.\r\n            </p>\r\n            <p>Base defenses alone will not prevent plundering of trade routes.</p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'fleets',\r\n    title: 'Fleets',\r\n    items: [\r\n      {\r\n        q: 'How do I build fleets?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              To build fleets (ships) at a base, there must be at least one level of <strong>Shipyards</strong>, and you must have researched at least one level of the <strong>Laser</strong> technology. This allows you to build Fighters, the cheapest ship.\r\n            </p>\r\n            <p>\r\n              More expensive and stronger ships require higher Shipyard levels and additional technologies to be produced.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'I have the tech researched for a ship but cannot build it! Why not?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              You likely do not meet the <strong>Shipyard level requirements</strong> for that ship at the current base. Ensure the bases Shipyards are at or above the required level.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What does fleet size mean?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              The fleet size is the total cost in credits of every ship in the fleet added together.\r\n            </p>\r\n            <p>\r\n              Example: 500 Fighters (cost 5 credits each) have a fleet size of 2,500.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I move my fleets?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Once you have ships capable of moving on their own (<strong>Corvettes</strong> are the first), go to <strong>Fleets</strong>, click the fleet, enter valid coordinates, choose amounts to move, then click Move.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I move fighters from base to base?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Hangar-requiring ships (Fighters, Bombers, Heavy Bombers, Ion Bombers) must move along with ships that have hangar capacity (e.g., Carriers). There is a limit to how many hangar units can be carried.\r\n            </p>\r\n            <p>\r\n              Example: A Carrier with hangar 60 can carry up to 60 Fighters/Bombers, or 30 Heavy Bombers/Ion Bombers.\r\n            </p>\r\n            <p>\r\n              To move them, specify how many to move with the carrier. You can also click the Hangar link to move the maximum number possible.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I use jump gates?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              To use one of your (or your guildmates) jump gates, place the fleet at the astro with the jump gate and send the fleet somewhere  the game will automatically use the gate when applicable.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I redirect my fleets in transit?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No. Once a fleet is in transit, you can either let it continue to its destination or recall it to its origin.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'If one of my bases is occupied, can I build fleet there and can I move that fleet?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Yes. You can build and move fleet from an occupied base. This allows you to fight back and potentially free the base.\r\n            </p>\r\n            <p>\r\n              Note: While occupied, the bases economy is cut by <strong>1/3</strong>, and construction, production, and research capacities are reduced by <strong>30%</strong>.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'commanders',\r\n    title: 'Commanders',\r\n    items: [\r\n      {\r\n        q: 'How are names determined for Commanders when you recruit them?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>All names are randomly generated, but you can rename your Commanders.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'I have a commander at a base but it has no effect, why is this?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              You must assign commanders to be Base Commander of a base in order for their effect to take place.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What exactly does dismissing commanders do?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              It is similar to demolishing structures or decommissioning fleet; you do not gain any of your\r\n              credits or XP back.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Do commanders use jump gates?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              When moving a commander to another base, they will use a jump gate if there is one available.\r\n            </p>\r\n            <p>Note that you must de-assign a commander before moving them.</p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'attacks_on_bases',\r\n    title: 'Attacks on Bases',\r\n    items: [\r\n      {\r\n        q: 'What happens to my base if someone attacks it?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              If your base is attacked, the <strong>structures</strong> will suffer no damage.\r\n            </p>\r\n            <p>\r\n              Your base <strong>defences</strong> and any <strong>fleet</strong> you have at that base will\r\n              attempt to protect your base. Fleets can be destroyed; defences cannot be destroyed but can be\r\n              damaged.\r\n            </p>\r\n            <p>\r\n              If the attack is successful and they occupy your base, they receive <strong>30%</strong> of your\r\n              base income each hour. You still have full control over the base.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How is pillage calculated?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              <strong>At a players base:</strong> (number of hours since last pillage; max 100)%  (Base\r\n              Economy / Total Bases Economy)  Base Owner Credits\r\n            </p>\r\n            <p>\r\n              <strong>At an NPC base:</strong> (number of hours since last pillage; max 100)%  Base Economy \r\n              16\r\n            </p>\r\n            <p>\r\n              <strong>Additional Pillage bonus:</strong> (base actual income  new income)<sup>2</sup>  5\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How is experience calculated?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              <strong>If the enemy level is above your level:</strong>\r\n              <br />\r\n              XP = (enemy / your level) / 20  Total Fleet destroyed\r\n              <br />\r\n              (max: 10%  Total Fleet destroyed)\r\n            </p>\r\n            <p>\r\n              <strong>If your level is above the enemy level:</strong>\r\n              <br />\r\n              XP = (enemy / your level)<sup>2</sup> / 20  Total Fleet destroyed\r\n            </p>\r\n            <p>\r\n              <strong>Combat with NPCs:</strong>\r\n              <br />\r\n              XP = 5%  Total Fleet destroyed\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'After occupation ends, how does a base get back the economy it lost?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>It recovers 1 economy per 8 hours until it reaches the normal economy.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How can I repair my defenses?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              They repair themselves automatically by <strong>1% per hour</strong>, but they do not repair\r\n              while the base is occupied.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'recyclers',\r\n    title: 'Recyclers',\r\n    items: [\r\n      {\r\n        q: 'How to use Recyclers?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Deploy your Recyclers to an astro with <strong>debris</strong> present. Each Recycler will automatically collect <strong>10 credits</strong> from the debris field at <strong>xx:30</strong> every hour.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How much debris is left after a unit has been destroyed?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              If ships are destroyed during an attack, <strong>40%</strong> of the cost of the units destroyed is converted into debris, which remains at the location of the attack.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'players',\r\n    title: 'Players',\r\n    items: [\r\n      {\r\n        q: 'How is a player level calculated?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              <strong>Player Level</strong> = (Economy  100 + Fleet + Technology) ^ 0.25\r\n            </p>\r\n            <p>(The ^ symbol denotes an exponent; ^0.25 means to take the 4th root.)</p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'server_npcs',\r\n    title: 'Server NPCs',\r\n    items: [\r\n      {\r\n        q: 'What is U.C. base stability?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              United Colonies bases lose <strong>3%</strong> stability every day at <strong>00:00</strong> server time.\r\n            </p>\r\n            <p>\r\n              Once base stability reaches 0%, the base disbands (this can take a few minutes).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'inactivity',\r\n    title: 'Inactivity',\r\n    items: [\r\n      {\r\n        q: 'What will happen to my bases and fleets if I do not login regularly?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              If a player does not log in for <strong>4 days</strong>, that player stops receiving income from bases until they log in again.\r\n            </p>\r\n            <p>\r\n              When a <strong>free</strong> player profile is marked as inactive, their bases' stability begins at 100% and degrades by <strong>3% daily</strong>. Once stability reaches zero, the account will be deleted soon after. If the player logs in during this period, the bases' stability is restored to 100%.\r\n            </p>\r\n            <p>\r\n              Deleting an account includes deletion of all things related to the account, including player bases, fleets, credits, etc.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How long does a player need to be inactive before this shows up in his profile?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <ul className=\"list-disc pl-5 space-y-1\">\r\n              <li>\r\n                <strong>Accounts under 80 days old:</strong> Inactivity appears when it exceeds half the account's age (minimum of 10 days of inactivity).\r\n              </li>\r\n              <li>\r\n                <strong>Accounts 80 days or older:</strong> Inactivity appears after 40 days of inactivity.\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'others',\r\n    title: 'Others',\r\n    items: [\r\n      {\r\n        q: 'Can a friend account sit for me?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>No. With the advent of Vacation Mode, Account Sitting is no longer allowed in the game.</p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I report a game exploit?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Please contact us directly regarding that  see the contact page for how to reach us.\r\n            </p>\r\n            <p>\r\n              Important: Never share a game exploit with anyone. Always send us all related information about\r\n              it directly.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Where can I make suggestions to improve the game?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              You can post ideas and suggestions in the game forum under the Feature Requests section. Feel\r\n              free to discuss them with other players. Note that while staff regularly read these topics, they\r\n              may not always have time to reply.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How do I report a player cheating?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Please contact us directly with all the information you have  see the contact page for details.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What is Server Time?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Server time is set to <strong>GMT+1</strong>. Battles, payments, and all times in the game are\r\n              recorded in server time. There is also a clock at the top centre of the screen that shows\r\n              server time.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: \"What does the '-' at the time counter mean?\",\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              It means the client-side timer reached zero. Refresh the page to load updated data. If after\r\n              refresh the counter is still '-', the server has not yet processed the event (can happen when\r\n              the server is busy).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'When do new galaxies / servers get added?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              New galaxies are added occasionally in batches of 10 when the universe gets too crowded. New\r\n              servers are added about every six months.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'I have the same value in one category of the ranks as another player, how are ranks sorted in this case?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              When more than one player or guild has the same value in the ranks, the ordering favors the\r\n              player/guild with the lower account number (appears on top).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'shared_ips',\r\n    title: 'Shared IPs',\r\n    items: [\r\n      {\r\n        q: 'Why did I get a warning claiming that I was using a shared IP?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              It means one or more Astro Empires accounts are connecting to the internet with the same public\r\n              IP address as you.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Does this mean AE thinks I am cheating?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No. It does not mean you are cheating or have a second account  only that your IP is shared\r\n              with other Astro Empires account(s).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Why does Astro Empires have rules about shared IPs?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              We prohibit shared IP usage for free accounts and limit some interactions to help prevent\r\n              cheating and second accounts. This helps keep the game fair for all players.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Why am I being accused of using a shared IP? I do not think I am using one.',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>If you are unsure, possible reasons include:</p>\r\n            <ul className=\"list-disc pl-5 space-y-1\">\r\n              <li>Someone else at your home also plays.</li>\r\n              <li>\r\n                You log in from a public or shared network (school, work, library, cybercafe, hotel, airport,\r\n                LAN party, etc.), and someone there plays as well.\r\n              </li>\r\n              <li>You are using a public proxy server.</li>\r\n              <li>\r\n                You logged in at a friends house or allowed a friend to log in from yours. Even once can\r\n                appear in our system  do not do it again and it will not be a problem.\r\n              </li>\r\n              <li>Your ISP uses shared IPs for some clients.</li>\r\n              <li>You are accessing from a mobile connection.</li>\r\n            </ul>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What can I do if I am caught using a shared IP?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              You must either use a unique IP address or follow the shared IP rules:\r\n            </p>\r\n            <ol className=\"list-decimal pl-5 space-y-1\">\r\n              <li>Your account must be upgraded (the first 7 days trial period does not count).</li>\r\n              <li>\r\n                You are forbidden to attack, occupy bases, or take debris from players with the same IP.\r\n              </li>\r\n              <li>\r\n                You are forbidden to make joint attacks on bases with accounts with the same IP (e.g., one or\r\n                more accounts attacking and another occupying the base or collecting the debris).\r\n              </li>\r\n              <li>\r\n                You are forbidden to transfer occupied bases to other players with the same IP.\r\n              </li>\r\n            </ol>\r\n            <p>\r\n              If you are playing with a friend on the same network and cannot comply with the rules above,\r\n              one of you must delete your account so the other can continue.\r\n            </p>\r\n            <p>\r\n              If you only received an initial warning, simply stop using shared IPs  your account will not be\r\n              deleted.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'My account was suspended while I was absent from the game, what can I do now?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              If your account is upgraded, contact us with your account number. If your account is free, you\r\n              will be required to upgrade to reactivate it. Do not delay or your account might be deleted.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'What if I do not want or cannot afford to upgrade my account? Can I still use a shared IP?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Rules apply equally to all players; we cannot make exceptions. If you do not want or cannot\r\n              upgrade, you cannot use shared IPs.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Is there any way to use the same IP for two accounts without having to upgrade my account?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Yes. You may play one account on one game server and the other on a different server. Shared IPs\r\n              are not allowed within the same server, but you can use the same IP across different servers (one\r\n              account per server).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'I already upgraded my account, why were others using the same IP suspended?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              Other players using the same IP must also upgrade their own accounts or they will be suspended.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'How does this IP address thing work? I do not think anyone is using my IP.',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              In private local networks (e.g., school or office), multiple devices share the same public IP,\r\n              so different computers can appear as the same address.\r\n            </p>\r\n            <p>\r\n              Many ISPs use <strong>dynamic IPs</strong>, meaning your IP can change over time and may have\r\n              been used recently by someone else.\r\n            </p>\r\n            <p>\r\n              Some ISPs use <strong>carrier-grade NAT</strong> where several customers share one IP\r\n              simultaneously (common with mobile and satellite connections).\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'If I stop using a shared IP do I still need to upgrade my account?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No. If you stop using a shared IP after the first warnings, you do not need to upgrade. If your\r\n              account is already suspended, you will need to upgrade to reactivate it.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        q: 'Can I know which accounts are sharing the same IP as me?',\r\n        a: (\r\n          <div className=\"space-y-2\">\r\n            <p>\r\n              No. Due to privacy laws we cannot share that information. The other person(s) may not want you\r\n              to know they are also playing from the same location.\r\n            </p>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n  },\r\n];\r\n","import * as React from \"react\";\r\n\r\nexport interface UpdateInfo {\r\n  version: string;\r\n  releaseDate?: string;\r\n  releaseNotes?: string;\r\n}\r\n\r\nexport interface DownloadProgress {\r\n  percent: number;\r\n  transferred: number;\r\n  total: number;\r\n  bytesPerSecond: number;\r\n}\r\n\r\nexport interface UpdateState {\r\n  // Update availability\r\n  updateAvailable: boolean;\r\n  updateDownloaded: boolean;\r\n  checkingForUpdate: boolean;\r\n  \r\n  // Update info\r\n  updateInfo?: UpdateInfo;\r\n  downloadProgress?: DownloadProgress;\r\n  \r\n  // Error state\r\n  error?: string;\r\n  \r\n  // User preferences\r\n  autoCheckEnabled: boolean;\r\n  lastChecked?: Date;\r\n}\r\n\r\ninterface UpdateContextType {\r\n  state: UpdateState;\r\n  \r\n  // Actions\r\n  checkForUpdates: () => Promise<void>;\r\n  downloadUpdate: () => Promise<void>;\r\n  installUpdate: () => Promise<void>;\r\n  dismissUpdate: () => void;\r\n  setAutoCheck: (enabled: boolean) => void;\r\n}\r\n\r\nconst UpdateContext = React.createContext<UpdateContextType | undefined>(undefined);\r\n\r\nexport const useUpdate = (): UpdateContextType => {\r\n  const ctx = React.useContext(UpdateContext);\r\n  if (!ctx) {\r\n    throw new Error(\"useUpdate must be used within an UpdateProvider\");\r\n  }\r\n  return ctx;\r\n};\r\n\r\n// Check if running in desktop environment\r\nconst isDesktop = typeof window !== 'undefined' && (window as any).desktop?.updater;\r\n\r\nexport const UpdateProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [state, setState] = React.useState<UpdateState>({\r\n    updateAvailable: false,\r\n    updateDownloaded: false,\r\n    checkingForUpdate: false,\r\n    autoCheckEnabled: true,\r\n  });\r\n\r\n  // Handle update events from main process\r\n  React.useEffect(() => {\r\n    if (!isDesktop) return;\r\n\r\n    const desktop = (window as any).desktop;\r\n    let cleanup: (() => void) | null = null;\r\n\r\n    try {\r\n      cleanup = desktop.updater.onUpdateEvent((eventData: { type: string; data: any }) => {\r\n        const { type, data } = eventData;\r\n\r\n        switch (type) {\r\n          case 'update-checking':\r\n            setState(prev => ({ \r\n              ...prev, \r\n              checkingForUpdate: true, \r\n              error: undefined \r\n            }));\r\n            break;\r\n\r\n          case 'update-available':\r\n            setState(prev => ({\r\n              ...prev,\r\n              checkingForUpdate: false,\r\n              updateAvailable: true,\r\n              updateInfo: {\r\n                version: data.version,\r\n                releaseDate: data.releaseDate,\r\n                releaseNotes: data.releaseNotes,\r\n              },\r\n            }));\r\n            break;\r\n\r\n          case 'update-not-available':\r\n            setState(prev => ({\r\n              ...prev,\r\n              checkingForUpdate: false,\r\n              lastChecked: new Date(),\r\n            }));\r\n            break;\r\n\r\n          case 'update-download-progress':\r\n            setState(prev => ({\r\n              ...prev,\r\n              downloadProgress: {\r\n                percent: data.percent,\r\n                transferred: data.transferred,\r\n                total: data.total,\r\n                bytesPerSecond: data.bytesPerSecond,\r\n              },\r\n            }));\r\n            break;\r\n\r\n          case 'update-downloaded':\r\n            setState(prev => ({\r\n              ...prev,\r\n              updateDownloaded: true,\r\n              downloadProgress: undefined,\r\n            }));\r\n            break;\r\n\r\n          case 'update-error':\r\n            setState(prev => ({\r\n              ...prev,\r\n              checkingForUpdate: false,\r\n              error: data.message,\r\n              downloadProgress: undefined,\r\n            }));\r\n            break;\r\n\r\n          case 'update-restart-later':\r\n            // User chose to restart later, just clear the download progress\r\n            setState(prev => ({\r\n              ...prev,\r\n              downloadProgress: undefined,\r\n            }));\r\n            break;\r\n\r\n          default:\r\n            console.warn('[UpdateContext] Unknown update event:', type, data);\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.error('[UpdateContext] Failed to setup update event listener:', error);\r\n    }\r\n\r\n    return () => {\r\n      if (cleanup) {\r\n        cleanup();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Load initial update status\r\n  React.useEffect(() => {\r\n    if (!isDesktop) return;\r\n\r\n    const loadStatus = async () => {\r\n      try {\r\n        const desktop = (window as any).desktop;\r\n        const response = await desktop.updater.getStatus();\r\n        \r\n        if (response.success) {\r\n          setState(prev => ({\r\n            ...prev,\r\n            updateAvailable: response.status.updateAvailable,\r\n            updateDownloaded: response.status.updateDownloaded,\r\n            checkingForUpdate: response.status.checkingForUpdate,\r\n            downloadProgress: response.status.downloadProgress,\r\n          }));\r\n        }\r\n      } catch (error) {\r\n        console.error('[UpdateContext] Failed to load initial update status:', error);\r\n      }\r\n    };\r\n\r\n    loadStatus();\r\n  }, []);\r\n\r\n  const checkForUpdates = React.useCallback(async () => {\r\n    if (!isDesktop) {\r\n      console.warn('[UpdateContext] checkForUpdates called in non-desktop environment');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const desktop = (window as any).desktop;\r\n      const response = await desktop.updater.checkForUpdates();\r\n      \r\n      if (!response.success) {\r\n        setState(prev => ({ ...prev, error: response.error }));\r\n      }\r\n    } catch (error) {\r\n      console.error('[UpdateContext] Check for updates failed:', error);\r\n      setState(prev => ({ \r\n        ...prev, \r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n        checkingForUpdate: false,\r\n      }));\r\n    }\r\n  }, []);\r\n\r\n  const downloadUpdate = React.useCallback(async () => {\r\n    if (!isDesktop || !state.updateAvailable) return;\r\n\r\n    try {\r\n      const desktop = (window as any).desktop;\r\n      const response = await desktop.updater.downloadUpdate();\r\n      \r\n      if (!response.success) {\r\n        setState(prev => ({ ...prev, error: response.error }));\r\n      }\r\n    } catch (error) {\r\n      console.error('[UpdateContext] Download update failed:', error);\r\n      setState(prev => ({ \r\n        ...prev, \r\n        error: error instanceof Error ? error.message : 'Unknown error' \r\n      }));\r\n    }\r\n  }, [state.updateAvailable]);\r\n\r\n  const installUpdate = React.useCallback(async () => {\r\n    if (!isDesktop || !state.updateDownloaded) return;\r\n\r\n    try {\r\n      const desktop = (window as any).desktop;\r\n      const response = await desktop.updater.installUpdate();\r\n      \r\n      // If we get here, the app should be restarting\r\n      if (!response.success) {\r\n        setState(prev => ({ ...prev, error: response.error }));\r\n      }\r\n    } catch (error) {\r\n      console.error('[UpdateContext] Install update failed:', error);\r\n      setState(prev => ({ \r\n        ...prev, \r\n        error: error instanceof Error ? error.message : 'Unknown error' \r\n      }));\r\n    }\r\n  }, [state.updateDownloaded]);\r\n\r\n  const dismissUpdate = React.useCallback(() => {\r\n    setState(prev => ({\r\n      ...prev,\r\n      updateAvailable: false,\r\n      updateInfo: undefined,\r\n      downloadProgress: undefined,\r\n      error: undefined,\r\n    }));\r\n  }, []);\r\n\r\n  const setAutoCheck = React.useCallback((enabled: boolean) => {\r\n    setState(prev => ({ ...prev, autoCheckEnabled: enabled }));\r\n    // Could also persist this setting to localStorage\r\n    localStorage.setItem('autoUpdateCheck', enabled.toString());\r\n  }, []);\r\n\r\n  // Load auto-check preference from localStorage\r\n  React.useEffect(() => {\r\n    const stored = localStorage.getItem('autoUpdateCheck');\r\n    if (stored !== null) {\r\n      setState(prev => ({ ...prev, autoCheckEnabled: stored === 'true' }));\r\n    }\r\n  }, []);\r\n\r\n  const value = React.useMemo(\r\n    () => ({\r\n      state,\r\n      checkForUpdates,\r\n      downloadUpdate,\r\n      installUpdate,\r\n      dismissUpdate,\r\n      setAutoCheck,\r\n    }),\r\n    [state, checkForUpdates, downloadUpdate, installUpdate, dismissUpdate, setAutoCheck]\r\n  );\r\n\r\n  return <UpdateContext.Provider value={value}>{children}</UpdateContext.Provider>;\r\n};\r\n\r\n// Helper function to format file size\r\nexport const formatBytes = (bytes: number): string => {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n};\r\n\r\n// Helper function to format download speed\r\nexport const formatSpeed = (bytesPerSecond: number): string => {\r\n  return formatBytes(bytesPerSecond) + '/s';\r\n};\r\n","import * as React from \"react\";\r\nimport { useUpdate } from \"../../contexts/UpdateContext\";\r\nimport { useToast } from \"../../contexts/ToastContext\";\r\n\r\n/**\r\n * UpdateSettings Component\r\n * \r\n * Allows users to control update preferences and manually check for updates\r\n * Can be integrated into a settings panel or help page\r\n */\r\nconst UpdateSettings: React.FC = () => {\r\n  const { state, checkForUpdates, setAutoCheck } = useUpdate();\r\n  const { addToast } = useToast();\r\n  const [isChecking, setIsChecking] = React.useState(false);\r\n\r\n  // Check if we're running in desktop environment\r\n  const isDesktop = typeof window !== 'undefined' && (window as any).desktop?.updater;\r\n\r\n  if (!isDesktop) {\r\n    return (\r\n      <div className=\"bg-gray-800/50 border border-gray-600 rounded-lg p-4\">\r\n        <h3 className=\"text-lg font-medium text-gray-200 mb-2\">App Updates</h3>\r\n        <p className=\"text-sm text-gray-400\">\r\n          Update functionality is only available in the desktop version of Attrition.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleManualCheck = async () => {\r\n    setIsChecking(true);\r\n    try {\r\n      await checkForUpdates();\r\n      \r\n      // Show appropriate message based on result\r\n      setTimeout(() => {\r\n        if (state.updateAvailable) {\r\n          addToast({ type: \"info\", text: \"Update found! Check the notification to download.\" });\r\n        } else if (!state.error) {\r\n          addToast({ type: \"success\", text: \"You're running the latest version!\" });\r\n        }\r\n      }, 1000); // Small delay to let the state update\r\n    } catch (error) {\r\n      addToast({ \r\n        type: \"error\", \r\n        text: `Failed to check for updates: ${error instanceof Error ? error.message : 'Unknown error'}` \r\n      });\r\n    } finally {\r\n      setIsChecking(false);\r\n    }\r\n  };\r\n\r\n  const handleAutoCheckToggle = (enabled: boolean) => {\r\n    setAutoCheck(enabled);\r\n    addToast({ \r\n      type: \"success\", \r\n      text: `Automatic update checks ${enabled ? 'enabled' : 'disabled'}` \r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-gray-800/50 border border-gray-600 rounded-lg p-4 space-y-4\">\r\n      <h3 className=\"text-lg font-medium text-gray-200 mb-2\">App Updates</h3>\r\n      \r\n      {/* Current Status */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center justify-between text-sm\">\r\n          <span className=\"text-gray-400\">Status:</span>\r\n          <span className=\"text-gray-200\">\r\n            {state.updateAvailable \r\n              ? \"Update available\" \r\n              : state.checkingForUpdate \r\n                ? \"Checking...\" \r\n                : \"Up to date\"\r\n            }\r\n          </span>\r\n        </div>\r\n        \r\n        {state.lastChecked && (\r\n          <div className=\"flex items-center justify-between text-sm\">\r\n            <span className=\"text-gray-400\">Last checked:</span>\r\n            <span className=\"text-gray-200\">\r\n              {state.lastChecked.toLocaleString()}\r\n            </span>\r\n          </div>\r\n        )}\r\n        \r\n        {state.updateInfo && (\r\n          <div className=\"flex items-center justify-between text-sm\">\r\n            <span className=\"text-gray-400\">Available version:</span>\r\n            <span className=\"text-green-400\">{state.updateInfo.version}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Manual Check Button */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <p className=\"text-sm font-medium text-gray-200\">Manual Check</p>\r\n          <p className=\"text-xs text-gray-400\">Check for updates immediately</p>\r\n        </div>\r\n        <button\r\n          onClick={handleManualCheck}\r\n          disabled={isChecking || state.checkingForUpdate}\r\n          className={`px-4 py-2 rounded text-sm font-medium transition-colors ${\r\n            isChecking || state.checkingForUpdate\r\n              ? 'bg-gray-600 text-gray-400 cursor-not-allowed'\r\n              : 'bg-blue-600 hover:bg-blue-500 text-white'\r\n          }`}\r\n        >\r\n          {isChecking || state.checkingForUpdate ? (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-400\"></div>\r\n              <span>Checking...</span>\r\n            </div>\r\n          ) : (\r\n            'Check Now'\r\n          )}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Auto-check Setting */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <p className=\"text-sm font-medium text-gray-200\">Automatic Updates</p>\r\n          <p className=\"text-xs text-gray-400\">\r\n            Automatically check for updates every hour\r\n          </p>\r\n        </div>\r\n        <label className=\"relative inline-flex items-center cursor-pointer\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={state.autoCheckEnabled}\r\n            onChange={(e) => handleAutoCheckToggle(e.target.checked)}\r\n            className=\"sr-only peer\"\r\n          />\r\n          <div className=\"w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600\"></div>\r\n        </label>\r\n      </div>\r\n\r\n      {/* Update Progress/Status */}\r\n      {state.downloadProgress && (\r\n        <div className=\"border-t border-gray-600 pt-4\">\r\n          <div className=\"flex items-center justify-between text-sm mb-2\">\r\n            <span className=\"text-gray-400\">Downloading update:</span>\r\n            <span className=\"text-blue-400\">{Math.round(state.downloadProgress.percent)}%</span>\r\n          </div>\r\n          <div className=\"w-full bg-gray-700 rounded-full h-2\">\r\n            <div \r\n              className=\"bg-blue-500 h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${state.downloadProgress.percent}%` }}\r\n            ></div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {state.updateDownloaded && (\r\n        <div className=\"border-t border-gray-600 pt-4\">\r\n          <div className=\"flex items-center space-x-2 text-green-400\">\r\n            <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\r\n            <span className=\"text-sm\">Update ready to install</span>\r\n          </div>\r\n          <p className=\"text-xs text-gray-400 mt-1\">\r\n            The update will be installed when you restart the application.\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Error Display */}\r\n      {state.error && (\r\n        <div className=\"border-t border-gray-600 pt-4\">\r\n          <div className=\"flex items-center space-x-2 text-red-400\">\r\n            <div className=\"w-2 h-2 bg-red-400 rounded-full\"></div>\r\n            <span className=\"text-sm\">Update Error</span>\r\n          </div>\r\n          <p className=\"text-xs text-gray-400 mt-1\">{state.error}</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Information */}\r\n      <div className=\"border-t border-gray-600 pt-4\">\r\n        <p className=\"text-xs text-gray-500\">\r\n          Updates are downloaded and verified automatically. The application will only restart \r\n          when you choose to install an update.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UpdateSettings;\r\n","import React, { useMemo, useState } from 'react';\r\nimport { helpTopics, defaultTopicId, type HelpTopic, type HelpTopicId } from './helpData';\r\nimport { faqTopics, defaultFaqTopicId, type FaqTopic, type FaqTopicId } from './faqData';\r\nimport UpdateSettings from '../ui/UpdateSettings';\r\n\r\ntype HelpTab = 'help' | 'faq' | 'ai' | 'settings';\r\n\r\nconst HelpPage: React.FC = () => {\r\n  // Top-level tab state\r\n  const [tab, setTab] = useState<HelpTab>('help');\r\n\r\n  // Help tab state\r\n  const [helpSelectedId, setHelpSelectedId] = useState<HelpTopicId>(defaultTopicId);\r\n\r\n  // FAQ tab state\r\n  const [faqSelectedId, setFaqSelectedId] = useState<FaqTopicId>(defaultFaqTopicId);\r\n\r\n  // Compute Help view data\r\n  const helpView = useMemo(() => {\r\n    const main = helpTopics.filter((t) => (t.group ?? 'main') === 'main');\r\n    const footer = helpTopics.filter((t) => t.group === 'footer');\r\n    const found = helpTopics.find((t) => t.id === helpSelectedId) ?? helpTopics[0];\r\n    return { mainTopics: main, footerTopics: footer, current: found as HelpTopic };\r\n  }, [helpSelectedId]);\r\n\r\n  // Compute FAQ view data (supporting optional group like help)\r\n  const faqView = useMemo(() => {\r\n    const main = faqTopics.filter((t) => (t.group ?? 'main') === 'main');\r\n    const footer = faqTopics.filter((t) => t.group === 'footer');\r\n    const found = faqTopics.find((t) => t.id === faqSelectedId) ?? faqTopics[0];\r\n    return { mainTopics: main, footerTopics: footer, current: found as FaqTopic };\r\n  }, [faqSelectedId]);\r\n\r\n  // Tab button renderer\r\n  const TabButton: React.FC<{ value: HelpTab; label: string }> = ({ value, label }) => (\r\n    <button\r\n      onClick={() => setTab(value)}\r\n      className={`px-4 py-2 rounded-md text-sm font-semibold border border-gray-700 ${\r\n        tab === value ? 'bg-gray-700 text-empire-gold' : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n      }`}\r\n    >\r\n      {label}\r\n    </button>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Top tabs */}\r\n      <div className=\"flex gap-2\">\r\n        <TabButton value=\"help\" label=\"Help\" />\r\n        <TabButton value=\"faq\" label=\"FAQ\" />\r\n        <TabButton value=\"ai\" label=\"AI Helper\" />\r\n        <TabButton value=\"settings\" label=\"Settings\" />\r\n      </div>\r\n\r\n      {/* Views */}\r\n      {tab === 'help' && (\r\n        <div className=\"flex gap-6\">\r\n          {/* Left navigation list */}\r\n          <aside className=\"w-64 bg-gray-800 border border-gray-700 rounded-lg p-3 max-h-[72vh] overflow-auto\">\r\n            <h2 className=\"text-center text-empire-gold font-semibold mb-2\">Help</h2>\r\n            <nav className=\"space-y-1\">\r\n              {helpView.mainTopics.map((topic) => {\r\n                const active = topic.id === helpSelectedId;\r\n                return (\r\n                  <button\r\n                    key={topic.id}\r\n                    onClick={() => setHelpSelectedId(topic.id)}\r\n                    className={`w-full text-left px-3 py-2 rounded text-sm font-semibold ${\r\n                      active ? 'bg-gray-700 text-empire-gold' : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n                    }`}\r\n                  >\r\n                    {topic.title}\r\n                  </button>\r\n                );\r\n              })}\r\n            </nav>\r\n\r\n            {helpView.footerTopics.length > 0 && (\r\n              <div className=\"mt-4 pt-4 border-t border-gray-700 space-y-1\">\r\n                {helpView.footerTopics.map((topic) => {\r\n                  const active = topic.id === helpSelectedId;\r\n                  return (\r\n                    <button\r\n                      key={topic.id}\r\n                      onClick={() => setHelpSelectedId(topic.id)}\r\n                      className={`w-full text-left px-3 py-2 rounded text-sm font-semibold ${\r\n                        active ? 'bg-gray-700 text-empire-gold' : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n                      }`}\r\n                    >\r\n                      {topic.title}\r\n                    </button>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </aside>\r\n\r\n          {/* Main content panel */}\r\n          <section className=\"flex-1 bg-gray-800 border border-gray-700 rounded-lg p-6 min-h-[60vh]\">\r\n            <h1 className=\"text-2xl font-bold mb-4\">{helpView.current.title}</h1>\r\n            <div className=\"prose prose-invert max-w-none\">{helpView.current.content}</div>\r\n          </section>\r\n        </div>\r\n      )}\r\n\r\n      {tab === 'faq' && (\r\n        <div className=\"flex gap-6\">\r\n          {/* Left navigation list for FAQ */}\r\n          <aside className=\"w-64 bg-gray-800 border border-gray-700 rounded-lg p-3 max-h-[72vh] overflow-auto\">\r\n            <h2 className=\"text-center text-empire-gold font-semibold mb-2\">FAQ</h2>\r\n            <nav className=\"space-y-1\">\r\n              {faqView.mainTopics.map((topic) => {\r\n                const active = topic.id === faqSelectedId;\r\n                return (\r\n                  <button\r\n                    key={topic.id}\r\n                    onClick={() => setFaqSelectedId(topic.id)}\r\n                    className={`w-full text-left px-3 py-2 rounded text-sm font-semibold ${\r\n                      active ? 'bg-gray-700 text-empire-gold' : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n                    }`}\r\n                  >\r\n                    {topic.title}\r\n                  </button>\r\n                );\r\n              })}\r\n            </nav>\r\n\r\n            {faqView.footerTopics.length > 0 && (\r\n              <div className=\"mt-4 pt-4 border-t border-gray-700 space-y-1\">\r\n                {faqView.footerTopics.map((topic) => {\r\n                  const active = topic.id === faqSelectedId;\r\n                  return (\r\n                    <button\r\n                      key={topic.id}\r\n                      onClick={() => setFaqSelectedId(topic.id)}\r\n                      className={`w-full text-left px-3 py-2 rounded text-sm font-semibold ${\r\n                        active ? 'bg-gray-700 text-empire-gold' : 'text-gray-300 hover:text-white hover:bg-gray-700'\r\n                      }`}\r\n                    >\r\n                      {topic.title}\r\n                    </button>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </aside>\r\n\r\n          {/* FAQ content panel */}\r\n          <section className=\"flex-1 bg-gray-800 border border-gray-700 rounded-lg p-6 min-h-[60vh]\">\r\n            <h1 className=\"text-2xl font-bold mb-4\">{faqView.current.title}</h1>\r\n            <div className=\"prose prose-invert max-w-none\">\r\n              {faqView.current.items.length === 0 ? (\r\n                <p className=\"text-gray-400\">Content coming soon.</p>\r\n              ) : (\r\n                <div className=\"space-y-6\">\r\n                  {faqView.current.items.map((it, idx) => (\r\n                    <div key={idx} className=\"space-y-2\">\r\n                      <h3 className=\"text-lg font-semibold\">{it.q}</h3>\r\n                      <div className=\"space-y-2\">{it.a}</div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n        </div>\r\n      )}\r\n\r\n      {tab === 'ai' && (\r\n        <section className=\"bg-gray-800 border border-gray-700 rounded-lg p-6 min-h-[40vh]\">\r\n          <h1 className=\"text-2xl font-bold mb-2\">AI Helper</h1>\r\n          <div className=\"prose prose-invert max-w-none\">\r\n            <p className=\"text-gray-300\">\r\n              An AI helper experience will be available here to answer questions, summarize topics, and\r\n              guide new players. This section is a placeholder and will be implemented in a future update.\r\n            </p>\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {tab === 'settings' && (\r\n        <div className=\"space-y-6\">\r\n          <section className=\"bg-gray-800 border border-gray-700 rounded-lg p-6\">\r\n            <h1 className=\"text-2xl font-bold mb-4\">Application Settings</h1>\r\n            <p className=\"text-gray-300 mb-6\">\r\n              Configure your Attrition desktop application preferences and settings.\r\n            </p>\r\n            \r\n            <div className=\"space-y-6\">\r\n              <UpdateSettings />\r\n            </div>\r\n          </section>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default HelpPage;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate, Link } from 'react-router-dom';\r\nimport fleetsService, { FleetDetailDTO } from '../../services/fleetsService';\r\n\r\nconst FleetPage: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [fleet, setFleet] = useState<FleetDetailDTO['fleet'] | null>(null);\r\n\r\n  const loadFleet = async () => {\r\n    if (!id) {\r\n      setError('Missing fleet id');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    try {\r\n      setError(null);\r\n      setLoading(true);\r\n      const res = await fleetsService.getFleet(id);\r\n      if (res.success && res.data) {\r\n        setFleet(res.data.fleet);\r\n      } else {\r\n        setError(res.error || 'Failed to load fleet');\r\n      }\r\n    } catch {\r\n      setError('Network error while loading fleet');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadFleet();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [id]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"py-10 text-center text-gray-300\">Loading fleet</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"game-card\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h1 className=\"text-2xl font-bold text-empire-gold\">Fleet</h1>\r\n            <button\r\n              onClick={() => navigate(-1)}\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600\"\r\n            >\r\n               Back\r\n            </button>\r\n          </div>\r\n          <div className=\"p-3 bg-red-900/50 border border-red-700 rounded text-red-200\">\r\n            {error}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!fleet) {\r\n    return (\r\n      <div className=\"game-card\">\r\n        <div className=\"py-10 text-center text-gray-300\">Fleet not found.</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-start justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-empire-gold\">{fleet.name}</h1>\r\n            <div className=\"text-gray-400 font-mono\">\r\n              {fleet.locationCoord}{' '}\r\n              <span className=\"text-gray-500\"></span>{' '}\r\n              Owner: <span className=\"text-gray-300\">{fleet.ownerName || ''}</span>\r\n            </div>\r\n            <div className=\"mt-1 text-gray-300\">\r\n              Size: <span className=\"font-mono\">{fleet.sizeCredits.toLocaleString()}</span> credits\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            {/* Stub actions (disabled) */}\r\n            <button\r\n              disabled\r\n              title=\"Coming soon\"\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed\"\r\n            >\r\n              Move\r\n            </button>\r\n            <button\r\n              disabled\r\n              title=\"Coming soon\"\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed\"\r\n            >\r\n              Attack\r\n            </button>\r\n            <button\r\n              disabled\r\n              title=\"Coming soon\"\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed\"\r\n            >\r\n              Build Base\r\n            </button>\r\n            <button\r\n              disabled\r\n              title=\"Coming soon\"\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed\"\r\n            >\r\n              Rename\r\n            </button>\r\n            <button\r\n              disabled\r\n              title=\"Coming soon\"\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed\"\r\n            >\r\n              Disband\r\n            </button>\r\n            <button\r\n              onClick={() => navigate(-1)}\r\n              className=\"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600\"\r\n            >\r\n               Back\r\n            </button>\r\n          </div>\r\n        </div>\r\n        {/* Link to base page */}\r\n        <div className=\"mt-2\">\r\n          <Link\r\n            to={`/base/${encodeURIComponent(fleet.locationCoord)}`}\r\n            className=\"text-blue-300 hover:text-blue-200\"\r\n          >\r\n            View Base\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Composition */}\r\n      <div className=\"game-card\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h3 className=\"text-lg font-semibold text-empire-gold\">Composition</h3>\r\n          <button\r\n            onClick={loadFleet}\r\n            className=\"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n          >\r\n            Refresh\r\n          </button>\r\n        </div>\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full text-sm\">\r\n            <thead className=\"text-gray-300\">\r\n              <tr className=\"border-b border-gray-700\">\r\n                <th className=\"text-left py-1 pr-4\">Unit</th>\r\n                <th className=\"text-left py-1 pr-4\">Key</th>\r\n                <th className=\"text-right py-1\">Count</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"text-white\">\r\n              {fleet.units && fleet.units.length > 0 ? (\r\n                fleet.units.map((u, idx) => (\r\n                  <tr key={`${u.unitKey}-${idx}`} className=\"border-b border-gray-800/60\">\r\n                    <td className=\"py-1 pr-4 text-gray-200\">{u.name || u.unitKey}</td>\r\n                    <td className=\"py-1 pr-4 text-gray-400 font-mono\">{u.unitKey}</td>\r\n                    <td className=\"py-1 text-right font-mono\">{u.count.toLocaleString()}</td>\r\n                  </tr>\r\n                ))\r\n              ) : (\r\n                <tr>\r\n                  <td colSpan={3} className=\"py-3 text-center text-gray-400\">\r\n                    No units in this fleet.\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FleetPage;\r\n","import * as React from 'react';\r\n\r\nconst HOURS_OPTIONS = [1, 6, 24, 168]; // 1h, 6h, 24h, 7d\r\n\r\nfunction downloadString(data: string, filename: string, type: string) {\r\n  try {\r\n    const blob = new Blob([data], { type });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.setAttribute('href', url);\r\n    a.setAttribute('download', filename);\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    a.remove();\r\n    URL.revokeObjectURL(url);\r\n  } catch (err) {\r\n    console.error('Download failed:', err);\r\n  }\r\n}\r\n\r\nconst PerformancePage: React.FC = () => {\r\n  const [hours, setHours] = React.useState<number>(24);\r\n  const [loading, setLoading] = React.useState<boolean>(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const [stats, setStats] = React.useState<any | null>(null);\r\n  const [thresholds, setThresholds] = React.useState<Array<{ op?: string; p95Ms?: number; failRatePct?: number }>>([]);\r\n  const [breaches, setBreaches] = React.useState<Array<{ op?: string; metric: 'p95Ms' | 'failRatePct'; value: number; threshold: number; windowHours: number; ts: number }>>([]);\r\n\r\n  const isDesktop = typeof window !== 'undefined' && !!window.desktop?.perf;\r\n\r\n  const fetchStats = React.useCallback(async (h: number) => {\r\n    if (!isDesktop) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await window.desktop!.perf.getStats(h);\r\n      if (res.success) {\r\n        setStats(res.stats || null);\r\n      } else {\r\n        setError(res.error || 'Failed to load stats');\r\n        setStats(null);\r\n      }\r\n    } catch (e: any) {\r\n      console.error('perf:getStats failed', e);\r\n      setError(e?.message || 'Failed to load stats');\r\n      setStats(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [isDesktop]);\r\n\r\n  React.useEffect(() => {\r\n    if (isDesktop) {\r\n      fetchStats(hours);\r\n    }\r\n  }, [hours, isDesktop, fetchStats]);\r\n\r\n  // Load thresholds\r\n  const loadThresholds = React.useCallback(async () => {\r\n    if (!isDesktop) return;\r\n    try {\r\n      const res = await window.desktop!.perf.getThresholds();\r\n      if (res.success) {\r\n        setThresholds(res.thresholds || []);\r\n      }\r\n    } catch (e) {\r\n      // noop\r\n    }\r\n  }, [isDesktop]);\r\n\r\n  const loadBreaches = React.useCallback(async (h: number) => {\r\n    if (!isDesktop) return;\r\n    try {\r\n      const res = await window.desktop!.perf.getThresholdBreaches(h);\r\n      if (res.success) {\r\n        setBreaches(res.breaches || []);\r\n      }\r\n    } catch (e) {\r\n      // noop\r\n    }\r\n  }, [isDesktop]);\r\n\r\n  React.useEffect(() => {\r\n    if (isDesktop) {\r\n      loadThresholds();\r\n      loadBreaches(hours);\r\n    }\r\n  }, [isDesktop, hours, loadThresholds, loadBreaches]);\r\n\r\n  const handleExport = async (format: 'json' | 'csv') => {\r\n    if (!isDesktop) return;\r\n    try {\r\n      const res = await window.desktop!.perf.export(format, hours);\r\n      if (res.success && typeof res.data === 'string') {\r\n        const fname = `sync_performance_${hours}h.${format === 'json' ? 'json' : 'csv'}`;\r\n        downloadString(res.data, fname, format === 'json' ? 'application/json' : 'text/csv');\r\n      } else {\r\n        alert(`Export failed: ${res.error || 'unknown error'}`);\r\n      }\r\n    } catch (e: any) {\r\n      alert(`Export failed: ${e?.message || 'exception'}`);\r\n    }\r\n  };\r\n\r\n  const handleClear = async () => {\r\n    if (!isDesktop) return;\r\n    const doClear = window.confirm('Clear stored performance metrics now? This cannot be undone.');\r\n    if (!doClear) return;\r\n    try {\r\n      const res = await window.desktop!.perf.clear();\r\n      if (res.success) {\r\n        // Reload stats after clear\r\n        fetchStats(hours);\r\n      } else {\r\n        alert(`Clear failed: ${res.error || 'unknown error'}`);\r\n      }\r\n    } catch (e: any) {\r\n      alert(`Clear failed: ${e?.message || 'exception'}`);\r\n    }\r\n  };\r\n\r\n  if (!isDesktop) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n          <h2 className=\"text-xl font-semibold mb-2\">Performance Monitoring</h2>\r\n          <p className=\"text-gray-400\">\r\n            Desktop-only feature. Launch the Electron desktop app to view sync performance metrics.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const opsByType = stats?.operationsByType ? Object.entries(stats.operationsByType as Record<string, any>) : [];\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h2 className=\"text-xl font-semibold\">Performance Monitoring</h2>\r\n          <div className=\"flex items-center gap-3\">\r\n            <label className=\"text-sm text-gray-300\">Window:</label>\r\n            <select\r\n              className=\"bg-gray-700 text-white text-sm px-2 py-1 rounded\"\r\n              value={hours}\r\n              onChange={(e) => setHours(Number(e.target.value))}\r\n              disabled={loading}\r\n            >\r\n              {HOURS_OPTIONS.map((h) => (\r\n                <option key={h} value={h}>{h}h</option>\r\n              ))}\r\n            </select>\r\n            <button\r\n              onClick={() => handleExport('json')}\r\n              className=\"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n              disabled={loading}\r\n            >\r\n              Export JSON\r\n            </button>\r\n            <button\r\n              onClick={() => handleExport('csv')}\r\n              className=\"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n              disabled={loading}\r\n            >\r\n              Export CSV\r\n            </button>\r\n            <button\r\n              onClick={handleClear}\r\n              className=\"text-sm px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700\"\r\n              disabled={loading}\r\n            >\r\n              Clear\r\n            </button>\r\n          </div>\r\n        </div>\r\n        {loading && (\r\n          <div className=\"text-gray-400 mt-3\">Loading...</div>\r\n        )}\r\n        {error && (\r\n          <div className=\"text-red-400 mt-3\">Error: {error}</div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Stats overview */}\r\n      {stats && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n            <div className=\"text-gray-400 text-sm\">Success Rate</div>\r\n            <div className=\"text-2xl font-bold\">{(stats.successRate ?? 0).toFixed(1)}%</div>\r\n          </div>\r\n          <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n            <div className=\"text-gray-400 text-sm\">Avg / Median</div>\r\n            <div className=\"text-2xl font-bold\">\r\n              {Math.round(stats.averageDurationMs ?? 0)}ms\r\n              <span className=\"text-gray-400 text-base ml-2\">\r\n                ({Math.round(stats.medianDurationMs ?? 0)}ms)\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n            <div className=\"text-gray-400 text-sm\">P95 / P99</div>\r\n            <div className=\"text-2xl font-bold\">\r\n              {Math.round(stats.p95DurationMs ?? 0)}ms\r\n              <span className=\"text-gray-400 text-base ml-2\">\r\n                ({Math.round(stats.p99DurationMs ?? 0)}ms)\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n            <div className=\"text-gray-400 text-sm\">Throughput</div>\r\n            <div className=\"text-2xl font-bold\">\r\n              {(stats.throughput?.operationsPerMinute ?? 0).toFixed(1)} ops/min\r\n            </div>\r\n            <div className=\"text-gray-400 text-sm\">\r\n              {(stats.throughput?.bytesPerSecond ?? 0).toFixed(0)} B/s\r\n            </div>\r\n          </div>\r\n          <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n            <div className=\"text-gray-400 text-sm\">Total Operations</div>\r\n            <div className=\"text-2xl font-bold\">{stats.totalOperations ?? 0}</div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Operation breakdown (minimal) */}\r\n      {opsByType.length > 0 && (\r\n        <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n          <h3 className=\"text-lg font-semibold mb-3\">Operations Breakdown</h3>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full text-sm\">\r\n              <thead>\r\n                <tr className=\"text-left text-gray-300 border-b border-gray-700\">\r\n                  <th className=\"py-2 pr-4\">Operation</th>\r\n                  <th className=\"py-2 pr-4\">Count</th>\r\n                  <th className=\"py-2 pr-4\">Success</th>\r\n                  <th className=\"py-2 pr-4\">Avg (ms)</th>\r\n                  <th className=\"py-2 pr-4\">p95 (ms)</th>\r\n                  <th className=\"py-2 pr-4\">p99 (ms)</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {opsByType.map(([op, s]: any) => (\r\n                  <tr key={op} className=\"border-b border-gray-800 hover:bg-gray-750/50\">\r\n                    <td className=\"py-2 pr-4\">{op}</td>\r\n                    <td className=\"py-2 pr-4\">{s.count ?? 0}</td>\r\n                    <td className=\"py-2 pr-4\">{(s.successRate ?? 0).toFixed(1)}%</td>\r\n                    <td className=\"py-2 pr-4\">{Math.round(s.avgDuration ?? 0)}</td>\r\n                    <td className=\"py-2 pr-4\">{Math.round(s.p95DurationMs ?? 0)}</td>\r\n                    <td className=\"py-2 pr-4\">{Math.round(s.p99DurationMs ?? 0)}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Error distribution */}\r\n      {stats?.errorDistribution && Object.keys(stats.errorDistribution).length > 0 && (\r\n        <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n          <h3 className=\"text-lg font-semibold mb-3\">Error Distribution</h3>\r\n          <ul className=\"list-disc ml-6 text-sm text-gray-300\">\r\n            {Object.entries(stats.errorDistribution as Record<string, number>).map(([err, count]) => (\r\n              <li key={err} className=\"mb-1\">\r\n                <span className=\"text-gray-400\">{err}:</span> {count}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n\r\n      {/* Thresholds editor and breach warnings */}\r\n      <ThresholdsPanel\r\n        hours={hours}\r\n        thresholds={thresholds}\r\n        breaches={breaches}\r\n        onChange={setThresholds}\r\n        onReload={() => { loadThresholds(); loadBreaches(hours); }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Thresholds panel subcomponent\r\n */\r\nconst ThresholdsPanel: React.FC<{\r\n  hours: number;\r\n  thresholds: Array<{ op?: string; p95Ms?: number; failRatePct?: number }>;\r\n  breaches: Array<{ op?: string; metric: 'p95Ms' | 'failRatePct'; value: number; threshold: number; windowHours: number; ts: number }>;\r\n  onChange: (t: Array<{ op?: string; p95Ms?: number; failRatePct?: number }>) => void;\r\n  onReload: () => void;\r\n}> = ({ hours, thresholds, breaches, onChange, onReload }) => {\r\n  const [saving, setSaving] = React.useState(false);\r\n\r\n  const addRow = () => {\r\n    onChange([...(thresholds || []), { op: '', p95Ms: undefined, failRatePct: undefined }]);\r\n  };\r\n  const removeRow = (idx: number) => {\r\n    const next = [...thresholds];\r\n    next.splice(idx, 1);\r\n    onChange(next);\r\n  };\r\n  const updateRow = (idx: number, patch: Partial<{ op?: string; p95Ms?: number; failRatePct?: number }>) => {\r\n    const next = [...thresholds];\r\n    next[idx] = { ...(next[idx] || {}), ...patch };\r\n    onChange(next);\r\n  };\r\n\r\n  const save = async () => {\r\n    if (!window.desktop?.perf?.setThresholds) return;\r\n    setSaving(true);\r\n    try {\r\n      const sanitized = (thresholds || []).map(t => ({\r\n        op: (t.op || '')?.trim() || undefined,\r\n        p95Ms: typeof t.p95Ms === 'number' && !Number.isNaN(t.p95Ms) ? t.p95Ms : undefined,\r\n        failRatePct: typeof t.failRatePct === 'number' && !Number.isNaN(t.failRatePct) ? t.failRatePct : undefined,\r\n      }));\r\n      const res = await window.desktop.perf.setThresholds(sanitized);\r\n      if (!res.success) {\r\n        alert('Failed to save thresholds');\r\n      } else {\r\n        onReload();\r\n      }\r\n    } catch (e: any) {\r\n      alert(`Save failed: ${e?.message || 'exception'}`);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-gray-800 border border-gray-700 rounded p-4\">\r\n      <div className=\"flex items-center justify-between mb-3\">\r\n        <h3 className=\"text-lg font-semibold\">Thresholds & Breaches</h3>\r\n        <div className=\"text-sm text-gray-300\">\r\n          Window: <span className=\"font-mono\">{hours}h</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Breaches */}\r\n      {breaches.length > 0 ? (\r\n        <div className=\"mb-4 p-3 rounded bg-yellow-900/40 border border-yellow-700 text-yellow-300\">\r\n          <div className=\"font-medium mb-1\">Active Breaches ({breaches.length})</div>\r\n          <ul className=\"list-disc ml-6\">\r\n            {breaches.map((b, i) => (\r\n              <li key={`${b.metric}-${b.op ?? 'global'}-${i}`}>\r\n                <span className=\"font-mono\">{b.op ?? 'GLOBAL'}</span> {b.metric} = {Math.round(b.value)} {'>'} {Math.round(b.threshold)}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      ) : (\r\n        <div className=\"mb-4 p-3 rounded bg-green-900/30 border border-green-700 text-green-300\">\r\n          No threshold breaches detected.\r\n        </div>\r\n      )}\r\n\r\n      {/* Editor */}\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full text-sm\">\r\n          <thead>\r\n            <tr className=\"text-left text-gray-300 border-b border-gray-700\">\r\n              <th className=\"py-2 pr-4\">Operation (optional)</th>\r\n              <th className=\"py-2 pr-4\">p95 (ms)</th>\r\n              <th className=\"py-2 pr-4\">Fail Rate (%)</th>\r\n              <th className=\"py-2 pr-4\"></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {(thresholds || []).map((t, idx) => (\r\n              <tr key={idx} className=\"border-b border-gray-800\">\r\n                <td className=\"py-2 pr-4\">\r\n                  <input\r\n                    className=\"bg-gray-700 text-white text-sm px-2 py-1 rounded w-full\"\r\n                    placeholder=\"e.g., flush_structures (leave blank for GLOBAL)\"\r\n                    value={t.op ?? ''}\r\n                    onChange={(e) => updateRow(idx, { op: e.target.value })}\r\n                  />\r\n                </td>\r\n                <td className=\"py-2 pr-4\">\r\n                  <input\r\n                    className=\"bg-gray-700 text-white text-sm px-2 py-1 rounded w-28\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    step={1}\r\n                    value={t.p95Ms ?? ''}\r\n                    onChange={(e) => updateRow(idx, { p95Ms: e.target.value === '' ? undefined : Number(e.target.value) })}\r\n                  />\r\n                </td>\r\n                <td className=\"py-2 pr-4\">\r\n                  <input\r\n                    className=\"bg-gray-700 text-white text-sm px-2 py-1 rounded w-28\"\r\n                    type=\"number\"\r\n                    min={0}\r\n                    max={100}\r\n                    step={0.1}\r\n                    value={t.failRatePct ?? ''}\r\n                    onChange={(e) => updateRow(idx, { failRatePct: e.target.value === '' ? undefined : Number(e.target.value) })}\r\n                  />\r\n                </td>\r\n                <td className=\"py-2 pr-4\">\r\n                  <button\r\n                    onClick={() => removeRow(idx)}\r\n                    className=\"text-sm px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n                  >\r\n                    Remove\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-3 mt-3\">\r\n        <button\r\n          onClick={addRow}\r\n          className=\"text-sm px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n        >\r\n          Add Threshold\r\n        </button>\r\n        <button\r\n          onClick={save}\r\n          className=\"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50\"\r\n          disabled={saving}\r\n        >\r\n          {saving ? 'Saving' : 'Save Thresholds'}\r\n        </button>\r\n        <button\r\n          onClick={onReload}\r\n          className=\"text-sm px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700\"\r\n        >\r\n          Reload\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PerformancePage;\r\n","import * as React from \"react\";\r\nimport { useSync } from \"../../contexts/SyncContext\";\r\nimport { useToast } from \"../../contexts/ToastContext\";\r\n\r\n/**\r\n * Effect-only component that surfaces user feedback for sync operations.\r\n * - On transition syncing -> idle: show a success toast with counts/duration when available\r\n * - On transition to error: show an error toast (lastError when present)\r\n *\r\n * This does not render visible UI. Mount it once near the app root.\r\n */\r\nconst SyncFeedback: React.FC = () => {\r\n  const { status } = useSync();\r\n  const { addToast } = useToast();\r\n\r\n  const prevStateRef = React.useRef<\"idle\" | \"syncing\" | \"error\">(status.state);\r\n  const prevQueuedRef = React.useRef<number>(status.queuedCount);\r\n  const prevRunAtRef = React.useRef<number | undefined>(status.lastRunAt);\r\n\r\n  React.useEffect(() => {\r\n    const prevState = prevStateRef.current;\r\n\r\n    // Transition: error state entered\r\n    if (status.state === \"error\" && prevState !== \"error\") {\r\n      const message = status.lastError ? String(status.lastError) : \"Sync error\";\r\n      addToast({ type: \"error\", text: message, durationMs: 4000 });\r\n    }\r\n\r\n    // Transition: syncing -> idle (completed a cycle)\r\n    if (prevState === \"syncing\" && status.state === \"idle\") {\r\n      // Heuristics: count of flushed = previous queued (approx) if it dropped to 0; otherwise show generic completion\r\n      const flushed = prevQueuedRef.current || 0;\r\n      const hasNewRun =\r\n        typeof status.lastRunAt === \"number\" &&\r\n        status.lastRunAt !== prevRunAtRef.current;\r\n\r\n      let text = \"Sync complete\";\r\n      if (flushed > 0) {\r\n        text = `Synced ${flushed} ${flushed === 1 ? \"action\" : \"actions\"}`;\r\n      } else if (hasNewRun) {\r\n        text = \"Sync up to date\";\r\n      }\r\n\r\n      if (typeof status.lastDurationMs === \"number\" && status.lastDurationMs >= 0) {\r\n        const sec = Math.max(0.1, Math.round(status.lastDurationMs / 100) / 10);\r\n        text += ` (${sec}s)`;\r\n      }\r\n\r\n      addToast({ type: \"success\", text, durationMs: 3000 });\r\n    }\r\n\r\n    // Persist previous snapshot\r\n    prevStateRef.current = status.state;\r\n    prevQueuedRef.current = status.queuedCount;\r\n    prevRunAtRef.current = status.lastRunAt;\r\n  }, [status, addToast]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default SyncFeedback;\r\n","import * as React from \"react\";\r\nimport { useUpdate, formatBytes, formatSpeed } from \"../../contexts/UpdateContext\";\r\nimport { useToast } from \"../../contexts/ToastContext\";\r\n\r\n/**\r\n * UpdateNotification Component\r\n * \r\n * Displays update notifications, download progress, and install prompts\r\n * Shows as an overlay when updates are available or downloading\r\n */\r\nconst UpdateNotification: React.FC = () => {\r\n  const { state, downloadUpdate, installUpdate, dismissUpdate, checkForUpdates } = useUpdate();\r\n  const { addToast } = useToast();\r\n  const [isMinimized, setIsMinimized] = React.useState(false);\r\n\r\n  // Don't render anything if no update is available and not checking\r\n  if (!state.updateAvailable && !state.checkingForUpdate && !state.downloadProgress && !state.updateDownloaded) {\r\n    return null;\r\n  }\r\n\r\n  // Handle download button click\r\n  const handleDownload = async () => {\r\n    try {\r\n      await downloadUpdate();\r\n      addToast({ type: \"info\", text: \"Update download started...\" });\r\n    } catch (error) {\r\n      addToast({ \r\n        type: \"error\", \r\n        text: `Failed to start download: ${error instanceof Error ? error.message : 'Unknown error'}` \r\n      });\r\n    }\r\n  };\r\n\r\n  // Handle install button click\r\n  const handleInstall = async () => {\r\n    try {\r\n      await installUpdate();\r\n      addToast({ type: \"info\", text: \"Installing update and restarting...\" });\r\n    } catch (error) {\r\n      addToast({ \r\n        type: \"error\", \r\n        text: `Failed to install update: ${error instanceof Error ? error.message : 'Unknown error'}` \r\n      });\r\n    }\r\n  };\r\n\r\n  // Handle dismiss\r\n  const handleDismiss = () => {\r\n    dismissUpdate();\r\n    addToast({ type: \"info\", text: \"Update dismissed. You can check for updates later in settings.\" });\r\n  };\r\n\r\n  // Render checking state\r\n  if (state.checkingForUpdate && !state.updateAvailable) {\r\n    return (\r\n      <div className=\"fixed top-16 right-4 z-40 bg-gray-800/95 border border-gray-600 rounded-lg shadow-xl p-4 max-w-sm\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-400\"></div>\r\n          <span className=\"text-gray-200\">Checking for updates...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render error state\r\n  if (state.error) {\r\n    return (\r\n      <div className=\"fixed top-16 right-4 z-40 bg-red-900/90 border border-red-600 rounded-lg shadow-xl p-4 max-w-sm\">\r\n        <div className=\"flex items-start space-x-3\">\r\n          <div className=\"flex-shrink-0 w-5 h-5 rounded-full bg-red-400 mt-0.5\"></div>\r\n          <div className=\"flex-1\">\r\n            <h4 className=\"font-medium text-red-100\">Update Error</h4>\r\n            <p className=\"text-sm text-red-200 mt-1\">{state.error}</p>\r\n            <div className=\"flex space-x-2 mt-3\">\r\n              <button\r\n                onClick={() => checkForUpdates()}\r\n                className=\"px-3 py-1 text-xs bg-red-600 hover:bg-red-500 text-white rounded transition-colors\"\r\n              >\r\n                Retry\r\n              </button>\r\n              <button\r\n                onClick={handleDismiss}\r\n                className=\"px-3 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors\"\r\n              >\r\n                Dismiss\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render download progress\r\n  if (state.downloadProgress) {\r\n    const progress = state.downloadProgress;\r\n    const progressPercent = Math.round(progress.percent);\r\n\r\n    if (isMinimized) {\r\n      return (\r\n        <div className=\"fixed top-16 right-4 z-40 bg-blue-900/90 border border-blue-600 rounded-lg shadow-xl p-3\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <div className=\"w-4 h-4 bg-blue-600 rounded\">\r\n              <div \r\n                className=\"h-full bg-blue-400 rounded transition-all duration-300\"\r\n                style={{ width: `${progressPercent}%` }}\r\n              ></div>\r\n            </div>\r\n            <span className=\"text-blue-100 text-sm\">{progressPercent}%</span>\r\n            <button\r\n              onClick={() => setIsMinimized(false)}\r\n              className=\"text-blue-300 hover:text-blue-100 text-sm\"\r\n              title=\"Expand\"\r\n            >\r\n              \r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"fixed top-16 right-4 z-40 bg-blue-900/90 border border-blue-600 rounded-lg shadow-xl p-4 max-w-sm\">\r\n        <div className=\"flex items-start justify-between mb-2\">\r\n          <h4 className=\"font-medium text-blue-100\">Downloading Update</h4>\r\n          <button\r\n            onClick={() => setIsMinimized(true)}\r\n            className=\"text-blue-300 hover:text-blue-100 text-sm\"\r\n            title=\"Minimize\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n        \r\n        {/* Progress Bar */}\r\n        <div className=\"w-full bg-blue-800 rounded-full h-2.5 mb-2\">\r\n          <div \r\n            className=\"bg-blue-400 h-2.5 rounded-full transition-all duration-300\"\r\n            style={{ width: `${progressPercent}%` }}\r\n          ></div>\r\n        </div>\r\n        \r\n        {/* Progress Details */}\r\n        <div className=\"flex justify-between text-sm text-blue-200 mb-2\">\r\n          <span>{progressPercent}%</span>\r\n          <span>{formatBytes(progress.transferred)} / {formatBytes(progress.total)}</span>\r\n        </div>\r\n        \r\n        {/* Download Speed */}\r\n        <div className=\"text-xs text-blue-300\">\r\n          {formatSpeed(progress.bytesPerSecond)}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render update ready to install\r\n  if (state.updateDownloaded) {\r\n    return (\r\n      <div className=\"fixed top-16 right-4 z-40 bg-green-900/90 border border-green-600 rounded-lg shadow-xl p-4 max-w-sm\">\r\n        <div className=\"flex items-start space-x-3\">\r\n          <div className=\"flex-shrink-0 w-5 h-5 rounded-full bg-green-400 mt-0.5\"></div>\r\n          <div className=\"flex-1\">\r\n            <h4 className=\"font-medium text-green-100\">Update Ready!</h4>\r\n            <p className=\"text-sm text-green-200 mt-1\">\r\n              {state.updateInfo?.version && `Version ${state.updateInfo.version} `}\r\n              has been downloaded and is ready to install.\r\n            </p>\r\n            <div className=\"flex space-x-2 mt-3\">\r\n              <button\r\n                onClick={handleInstall}\r\n                className=\"px-3 py-1 text-sm bg-green-600 hover:bg-green-500 text-white rounded transition-colors font-medium\"\r\n              >\r\n                Restart & Install\r\n              </button>\r\n              <button\r\n                onClick={handleDismiss}\r\n                className=\"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors\"\r\n              >\r\n                Later\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render update available\r\n  if (state.updateAvailable) {\r\n    return (\r\n      <div className=\"fixed top-16 right-4 z-40 bg-orange-900/90 border border-orange-600 rounded-lg shadow-xl p-4 max-w-sm\">\r\n        <div className=\"flex items-start space-x-3\">\r\n          <div className=\"flex-shrink-0 w-5 h-5 rounded-full bg-orange-400 mt-0.5\"></div>\r\n          <div className=\"flex-1\">\r\n            <h4 className=\"font-medium text-orange-100\">Update Available</h4>\r\n            {state.updateInfo && (\r\n              <div className=\"text-sm text-orange-200 mt-1\">\r\n                <p><strong>Version:</strong> {state.updateInfo.version}</p>\r\n                {state.updateInfo.releaseDate && (\r\n                  <p><strong>Released:</strong> {new Date(state.updateInfo.releaseDate).toLocaleDateString()}</p>\r\n                )}\r\n              </div>\r\n            )}\r\n            \r\n            {/* Release Notes Preview */}\r\n            {state.updateInfo?.releaseNotes && (\r\n              <details className=\"mt-2\">\r\n                <summary className=\"text-xs text-orange-300 cursor-pointer hover:text-orange-100\">\r\n                  What's New\r\n                </summary>\r\n                <div className=\"mt-1 text-xs text-orange-200 max-h-32 overflow-y-auto\">\r\n                  {state.updateInfo.releaseNotes}\r\n                </div>\r\n              </details>\r\n            )}\r\n            \r\n            <div className=\"flex space-x-2 mt-3\">\r\n              <button\r\n                onClick={handleDownload}\r\n                className=\"px-3 py-1 text-sm bg-orange-600 hover:bg-orange-500 text-white rounded transition-colors font-medium\"\r\n              >\r\n                Download\r\n              </button>\r\n              <button\r\n                onClick={handleDismiss}\r\n                className=\"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors\"\r\n              >\r\n                Skip\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport default UpdateNotification;\r\n","import * as React from 'react';\r\nimport { HashRouter, BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';\r\nimport { useAuthStore } from './stores/authStore';\r\nimport { NetworkProvider } from './contexts/NetworkContext';\r\nimport { SyncProvider } from './contexts/SyncContext';\r\nimport ConnectionBanner from './components/layout/ConnectionBanner';\r\nimport Login from './components/auth/Login';\r\nimport Register from './components/auth/Register';\r\nimport Dashboard from './components/game/Dashboard';\r\nimport Layout from './components/layout/Layout';\r\nimport GalaxyPage from './components/game/GalaxyPage';\r\nimport PlanetPage from './components/game/PlanetPage';\r\nimport BasesPage from './components/game/BasesPage';\r\nimport BasePage from './components/game/BasePage';\r\nimport HelpPage from './components/help/HelpPage';\r\nimport FleetPage from './components/game/FleetPage';\r\nimport PerformancePage from './components/admin/PerformancePage';\r\nimport { ToastProvider, ToastViewport } from './contexts/ToastContext';\r\nimport { UpdateProvider } from './contexts/UpdateContext';\r\nimport SyncFeedback from './components/ui/SyncFeedback';\r\nimport UpdateNotification from './components/ui/UpdateNotification';\r\n\r\nconst isDesktop = typeof window !== 'undefined' && (((window as any).desktop) || window.location.protocol === 'file:');\r\nconst RouterComponent = isDesktop ? HashRouter : BrowserRouter;\r\n\r\nfunction App() {\r\n  const isAuthed = useAuthStore((s) => s.getIsAuthed());\r\n  const isLoading = useAuthStore((s) => s.isLoading);\r\n  // Backward-compat shim for existing ternaries that check `user ? ... : ...`\r\n  const user = isAuthed ? ({} as any) : null;\r\n\r\n  // Listen for global auth:unauthorized to immediately clear auth state (prevents redirect oscillation)\r\n  React.useEffect(() => {\r\n    const handler = () => {\r\n      try {\r\n        useAuthStore.getState().unauthorize();\r\n      } catch {}\r\n    };\r\n    window.addEventListener('auth:unauthorized' as any, handler);\r\n    return () => {\r\n      window.removeEventListener('auth:unauthorized' as any, handler);\r\n    };\r\n  }, []);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"game-container flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto\"></div>\r\n          <p className=\"mt-4 text-lg\">Loading Attrition...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <NetworkProvider>\r\n      <ToastProvider>\r\n        <UpdateProvider>\r\n          <SyncProvider>\r\n            <RouterComponent>\r\n              <ConnectionBanner />\r\n              <ToastViewport />\r\n              <UpdateNotification />\r\n              <SyncFeedback />\r\n            <div className=\"game-container\">\r\n            <Routes>\r\n              {/* Public routes */}\r\n              <Route \r\n                path=\"/login\" \r\n                element={user ? <Navigate to=\"/dashboard\" replace /> : <Login />} \r\n              />\r\n              <Route \r\n                path=\"/register\" \r\n                element={user ? <Navigate to=\"/dashboard\" replace /> : <Register />} \r\n              />\r\n              \r\n              {/* Protected routes */}\r\n              <Route \r\n                path=\"/dashboard\" \r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <Dashboard />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                } \r\n              />\r\n              \r\n              <Route \r\n                path=\"/galaxy\" \r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <GalaxyPage />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                } \r\n              />\r\n              <Route \r\n                path=\"/bases\" \r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <BasesPage />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                } \r\n              />\r\n              <Route \r\n                path=\"/help\" \r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <HelpPage />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                } \r\n              />\r\n              \r\n              <Route \r\n                path=\"/planet/:coord\" \r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <PlanetPage />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                } \r\n              />\r\n              <Route\r\n                path=\"/base/:coord\"\r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <BasePage />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                }\r\n              />\r\n              <Route \r\n                path=\"/fleets/:id\" \r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <FleetPage />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                } \r\n              />\r\n              \r\n              <Route \r\n                path=\"/admin/performance\" \r\n                element={\r\n                  user ? (\r\n                    <Layout>\r\n                      <PerformancePage />\r\n                    </Layout>\r\n                  ) : (\r\n                    <Navigate to=\"/login\" replace />\r\n                  )\r\n                } \r\n              />\r\n\r\n              {/* Default redirect */}\r\n              <Route \r\n                path=\"/\" \r\n                element={<Navigate to={user ? \"/dashboard\" : \"/login\"} replace />} \r\n              />\r\n              \r\n              {/* Catch all */}\r\n              <Route \r\n                path=\"*\" \r\n                element={<Navigate to={user ? \"/dashboard\" : \"/login\"} replace />} \r\n              />\r\n            </Routes>\r\n          </div>\r\n        </RouterComponent>\r\n          </SyncProvider>\r\n        </UpdateProvider>\r\n      </ToastProvider>\r\n    </NetworkProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom/client'\r\nimport App from './App.tsx'\r\nimport './index.css'\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n)\r\n"],"names":["f","require$$0","k","Symbol","for","l","m","Object","prototype","hasOwnProperty","n","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","p","key","ref","__self","__source","q","c","a","g","b","d","e","h","call","defaultProps","$$typeof","type","props","_owner","current","reactJsxRuntime_production_min","jsx","jsxs","jsxRuntimeModule","exports","Action","_extends","assign","bind","target","i","arguments","length","source","apply","this","client","createRoot","hydrateRoot","PopStateEventType","invariant","value","message","Error","warning","cond","console","warn","getHistoryState","location","index","usr","state","idx","createLocation","to","pathname","search","hash","parsePath","Math","random","toString","substr","createPath","_ref","charAt","path","parsedPath","hashIndex","indexOf","searchIndex","getUrlBasedHistory","getLocation","createHref","validateLocation","options","window","document","defaultView","v5Compat","globalHistory","history","action","Pop","listener","getIndex","handlePop","nextIndex","delta","createURL","base","origin","href","replace","URL","replaceState","listen","fn","addEventListener","removeEventListener","encodeLocation","url","push","Push","historyState","pushState","error","DOMException","name","Replace","go","ResultType","matchRoutes","routes","locationArg","basename","stripBasename","branches","flattenRoutes","sort","score","siblings","slice","every","compareIndexes","routesMeta","map","meta","childrenIndex","rankRouteBranches","matches","decoded","decodePath","matchRouteBranch","matchRoutesImpl","parentsMeta","parentPath","flattenRoute","route","relativePath","caseSensitive","startsWith","joinPaths","concat","children","computeScore","forEach","_route$path","includes","exploded","explodeOptionalSegments","segments","split","first","rest","isOptional","endsWith","required","restExploded","join","result","subpath","paramRe","dynamicSegmentValue","indexRouteValue","emptySegmentValue","staticSegmentValue","splatPenalty","isSplat","s","initialScore","some","filter","reduce","segment","test","branch","allowPartial","matchedParams","matchedPathname","end","remainingPathname","match","matchPath","params","pathnameBase","normalizePathname","pattern","matcher","compiledParams","regexpSource","_","paramName","RegExp","compilePath","captureGroups","memo","splatValue","v","decodeURIComponent","toLowerCase","startIndex","nextChar","getInvalidPathError","char","field","dest","JSON","stringify","getResolveToMatches","v7_relativeSplatPath","pathMatches","getPathContributingMatches","resolveTo","toArg","routePathnames","locationPathname","isPathRelative","from","isEmptyPath","toPathname","routePathnameIndex","toSegments","shift","fromPathname","pop","resolvePathname","normalizeSearch","normalizeHash","resolvePath","hasExplicitTrailingSlash","hasCurrentTrailingSlash","paths","validMutationMethodsArr","Set","validRequestMethodsArr","DataRouterContext","React.createContext","DataRouterStateContext","NavigationContext","LocationContext","RouteContext","outlet","isDataRoute","RouteErrorContext","useInRouterContext","React.useContext","useLocation","UNSAFE_invariant","useIsomorphicLayoutEffect","cb","static","React.useLayoutEffect","useNavigate","router","ctx","useDataRouterContext","DataRouterHook","UseNavigateStable","id","useCurrentRouteId","DataRouterStateHook","activeRef","React.useRef","React.useCallback","navigate","fromRouteId","useNavigateStable","dataRouterContext","future","navigator","routePathnamesJson","UNSAFE_getResolveToMatches","parse","relative","useNavigateUnstable","useParams","routeMatch","useResolvedPath","_temp2","React.useMemo","useRoutes","dataRouterState","parentMatches","parentParams","parentPathnameBase","locationFromContext","_parsedLocationArg$pa","parsedLocationArg","parentSegments","renderedMatches","_dataRouterState","_future","errors","v7_partialHydration","initialized","errorIndex","findIndex","min","renderFallback","fallbackIndex","HydrateFallback","hydrateFallbackElement","loaderData","needsToRunLoader","loader","lazy","reduceRight","shouldRenderHydrateFallback","errorElement","defaultErrorElement","alreadyWarned$1","getChildren","Component","React.createElement","element","RenderedRoute","routeContext","ErrorBoundary","RenderErrorBoundary","revalidation","component","_renderMatches","Provider","navigationType","useRoutesImpl","DefaultErrorComponent","_state$errors","useDataRouterState","routeId","useRouteError","status","statusText","internal","isRouteErrorResponse","stack","preStyles","padding","backgroundColor","React.Fragment","style","fontStyle","React.Component","constructor","super","getDerivedStateFromError","getDerivedStateFromProps","componentDidCatch","errorInfo","render","staticContext","_deepestRenderedBoundaryId","hookName","useRouteContext","thisRoute","logV6DeprecationWarnings","renderFuture","routerFuture","v7_startTransition","Navigate","_ref4","isStatic","jsonPath","React.useEffect","Route","_props","Router","_ref5","basenameProp","locationProp","staticProp","navigationContext","locationContext","trailingPathname","Routes","_ref6","createRoutesFromChildren","React.Children","React.isValidElement","treePath","hasErrorBoundary","shouldRevalidate","handle","createSearchParams","init","URLSearchParams","Array","isArray","keys","Promise","_excluded","__reactRouterVersion","startTransitionImpl","React","isBrowser","createElement","ABSOLUTE_URL_REGEX","Link","React.forwardRef","_ref7","absoluteHref","onClick","reloadDocument","preventScrollReset","viewTransition","excluded","sourceKeys","_objectWithoutPropertiesLoose","UNSAFE_NavigationContext","isExternal","currentUrl","targetUrl","protocol","_temp","joinedPathname","useHref","internalOnClick","replaceProp","event","button","metaKey","altKey","ctrlKey","shiftKey","isModifiedEvent","shouldProcessLinkClick","preventDefault","useLinkClickHandler","defaultPrevented","useSearchParams","defaultInit","defaultSearchParamsRef","hasSetSearchParamsRef","searchParams","locationSearch","defaultSearchParams","has","getAll","append","setSearchParams","nextInit","navigateOptions","newSearchParams","createJSONStorage","getStorage","storage","_e","getItem","_a","str2","str","then","setItem","newValue","removeItem","toThenable","input","onFulfilled","_onRejected","_onFulfilled","catch","onRejected","persist","config","baseOptions","__vite_import_meta_env__","set","get","api","localStorage","serialize","deserialize","partialize","version","merge","persistedState","currentState","hasHydrated","hydrationListeners","finishHydrationListeners","args","thenableSerialize","errorInSync","thenable","serializedValue","savedSetState","setState","configResult","stateFromStorage","hydrate","postRehydrationCallback","onRehydrateStorage","storageValue","deserializedStorageValue","migrate","migratedState","_a2","setOptions","newOptions","clearStorage","getOptions","rehydrate","onHydrate","add","delete","onFinishHydration","oldImpl","getInitialState","_b","migrationResult","migrated","skipHydration","newImpl","registry","getKey","method","toUpperCase","baseURL","attachMetrics","process","env","NODE_ENV","anyApi","__metricsAttached","interceptors","request","use","now","Date","inflight","recentTimestamps","entry","timestamps","pruneOld","debug","response","max","cfg","reject","currentToken","setToken","token","getToken","clearToken","axios","create","headers","isRefreshing","tokenExpiry","proactiveRefreshTimer","decodeToken","base64","jsonPayload","atob","charCodeAt","scheduleTokenRefresh","clearTimeout","exp","delay","log","round","setTimeout","async","performTokenRefresh","desktop","auth","refresh","ok","setMemToken","setTokenWithScheduling","bearer","getMemToken","timeLeft","newToken","Authorization","original","_retry","clearMemToken","tokens","deleteRefresh","inflightGetProfile","lastProfile","lastProfileTs","authService","login","email","password","resp","success","data","post","isAxiosError","register","username","getProfile","force","logout","PACKET_TYPES","PACKET_TYPES_REVERSE","ERROR_PACKET","withNativeBlob","Blob","withNativeArrayBuffer","ArrayBuffer","isView","obj","buffer","encodePacket","supportsBinary","callback","encodeBlobAsBase64","fileReader","FileReader","onload","content","readAsDataURL","toArray","Uint8Array","byteOffset","byteLength","TEXT_ENCODER","chars","lookup","decodePacket","encodedPacket","binaryType","mapBinary","decodeBase64Packet","substring","encoded1","encoded2","encoded3","encoded4","bufferLength","len","arraybuffer","bytes","decode","SEPARATOR","String","fromCharCode","createPacketEncoderStream","TransformStream","transform","packet","controller","arrayBuffer","encoded","TextEncoder","encode","encodePacketToBinary","payloadLength","header","DataView","setUint8","view","setUint16","setBigUint64","BigInt","enqueue","TEXT_DECODER","totalLength","chunks","acc","chunk","concatChunks","size","j","Emitter","mixin","on","_callbacks","once","off","removeListener","removeAllListeners","callbacks","splice","emit","emitReserved","listeners","hasListeners","nextTick","resolve","setTimeoutFn","globalThisShim","self","Function","pick","attr","NATIVE_SET_TIMEOUT","globalThis","NATIVE_CLEAR_TIMEOUT","installTimerFunctions","opts","useNativeTimers","clearTimeoutFn","utf8Length","ceil","randomString","TransportError","reason","description","context","Transport","writable","query","socket","forceBase64","onError","open","readyState","doOpen","close","doClose","onClose","send","packets","write","onOpen","onData","onPacket","details","pause","onPause","createUri","schema","_hostname","_port","_query","hostname","port","secure","Number","encodedQuery","encodeURIComponent","Polling","_polling","_poll","total","doPoll","encodedPayload","encodedPackets","decodedPacket","decodePayload","count","encodePayload","doWrite","uri","timestampRequests","timestampParam","sid","b64","XMLHttpRequest","err","hasCORS","empty","BaseXHR","isSSL","xd","req","xhrStatus","pollXhr","Request","createRequest","_opts","_method","_uri","_data","_create","xdomain","xhr","_xhr","extraHeaders","setDisableHeaderCheck","setRequestHeader","cookieJar","addCookies","withCredentials","requestTimeout","timeout","onreadystatechange","parseCookies","getResponseHeader","_onLoad","_onError","_index","requestsCount","requests","_cleanup","fromError","abort","responseText","attachEvent","unloadHandler","hasXHR2","newRequest","responseType","isReactNative","product","BaseWS","protocols","ws","createSocket","addEventListeners","onopen","autoUnref","_socket","unref","onclose","closeEvent","onmessage","ev","onerror","lastPacket","WebSocketCtor","WebSocket","MozWebSocket","transports","websocket","_packet","webtransport","_transport","WebTransport","transportOptions","closed","ready","createBidirectionalStream","stream","decoderStream","maxPayload","TextDecoder","expectedLength","isBinary","headerArray","getUint16","getUint32","pow","createPacketDecoderStream","MAX_SAFE_INTEGER","reader","readable","pipeThrough","getReader","encoderStream","pipeTo","_writer","getWriter","read","done","polling","re","parts","src","exec","host","authority","ipv6uri","pathNames","regx","names","queryKey","$0","$1","$2","withEventListeners","OFFLINE_EVENT_LISTENERS","SocketWithoutUpgrade","writeBuffer","_prevBufferLen","_pingInterval","_pingTimeout","_maxPayload","_pingTimeoutTime","Infinity","parsedUri","_transportsByName","t","transportName","agent","upgrade","rememberUpgrade","addTrailingSlash","rejectUnauthorized","perMessageDeflate","threshold","closeOnBeforeunload","qs","qry","pairs","pair","_beforeunloadEventListener","transport","_offlineEventListener","_onClose","_cookieJar","createCookieJar","_open","createTransport","EIO","priorWebsocketSuccess","setTransport","_onDrain","_onPacket","flush","onHandshake","_sendPacket","_resetPingTimeout","code","pingInterval","pingTimeout","_pingTimeoutTimer","upgrading","_getWritablePackets","payloadSize","_hasPingExpired","hasExpired","msg","compress","cleanupAndClose","waitForUpgrade","tryAllTransports","SocketWithUpgrade","_upgrades","_probe","failed","onTransportOpen","cleanup","freezeTransport","onTransportClose","onupgrade","_filterUpgrades","upgrades","filteredUpgrades","o","DEFAULT_TRANSPORTS","withNativeFile","File","hasBinary","toJSON","deconstructPacket","buffers","packetData","pack","_deconstructPacket","attachments","placeholder","_placeholder","num","newData","reconstructPacket","_reconstructPacket","RESERVED_EVENTS","PacketType","isObject","Decoder","reviver","reconstructor","decodeString","isBinaryEvent","BINARY_EVENT","BINARY_ACK","EVENT","ACK","BinaryReconstructor","takeBinaryData","start","buf","nsp","next","payload","tryParse","isPayloadValid","CONNECT","DISCONNECT","CONNECT_ERROR","destroy","finishedReconstruction","reconPack","binData","replacer","encodeAsString","encodeAsBinary","deconstruction","unshift","freeze","connect","connect_error","disconnect","disconnecting","newListener","Socket","io","connected","recovered","receiveBuffer","sendBuffer","_queue","_queueSeq","ids","acks","flags","_autoConnect","disconnected","subEvents","subs","onpacket","active","_readyState","_c","retries","fromQueue","volatile","_addToQueue","ack","_registerAckCallback","isTransportWritable","engine","isConnected","notifyOutgoingListeners","ackTimeout","timer","withError","emitWithAck","arg1","arg2","tryCount","pending","responseArgs","_drainQueue","_sendConnectPacket","_pid","pid","offset","_lastOffset","_clearAcks","onconnect","onevent","onack","ondisconnect","emitEvent","_anyListeners","sent","emitBuffered","subDestroy","onAny","prependAny","offAny","listenersAny","onAnyOutgoing","_anyOutgoingListeners","prependAnyOutgoing","offAnyOutgoing","listenersAnyOutgoing","Backoff","ms","factor","jitter","attempts","duration","rand","deviation","floor","reset","setMin","setMax","setJitter","Manager","nsps","reconnection","reconnectionAttempts","reconnectionDelay","reconnectionDelayMax","randomizationFactor","backoff","_parser","parser","encoder","Encoder","decoder","autoConnect","_reconnection","skipReconnect","_reconnectionAttempts","_reconnectionDelay","_randomizationFactor","_reconnectionDelayMax","_timeout","maybeReconnectOnOpen","_reconnecting","reconnect","Engine","openSubDestroy","errorSub","onping","ondata","ondecoded","_destroy","_close","onreconnect","attempt","cache","parsed","loc","sameNamespace","forceNew","multiplex","getApiBaseUrl","baseUrl","getSocketBaseUrl","apiUrl","socketUrl","cachedConfig","getCurrentApiConfig","isProduction","environment","httpsEnforced","isDesktop","forceDevMode","getApiConfig","warnings","isSecure","validateApiSecurity","IS_TEST","apiConfig","API_BASE_URL","rid","refreshPromise","refreshAccessToken","refreshFn","res","toApiErrorFromAxiosError","codeVal","msgVal","normalized","axErr","_retry401Replayed","dispatchEvent","CustomEvent","finally","nextCfg","_retry401","replayErr","norm","transientStatus","isTransientHttp","isNetworkLike","_retriedOnce","r","retryErr","lastRefreshFailAt","connectSocket","provideToken","mem","raw","getStoredToken","socketOptions","disconnectSocket","useAuthStore","user","empire","isLoading","rt","refreshToken","saveRefresh","unauthorize","clearError","setLoading","loading","getIsAuthed","checkAuth","hasRefresh","probe","w","__AUTH_CHECK_RAN__","getState","NetworkContext","createContext","useNetwork","useContext","NetworkProvider","setStatus","useState","isOnline","onLine","isApiReachable","lastChecked","isFullyConnected","useEffect","checkConnectivity","startTime","AbortController","timeoutId","statusUrl","fetch","signal","latencyMs","handleOnline","prev","handleOffline","intervalId","setInterval","clearInterval","contextValue","SyncContext","useSync","SyncProvider","pollMs","React.useState","queuedCount","tick","recentError","lastRunAt","lastDurationMs","db","events","getPendingCount","perf","getMetrics","interesting","operation","timestamp","latest","getTime","durationMs","nextState","lastError","ConnectionBanner","networkStatus","isVisible","setIsVisible","isSuccess","isWarning","isError","className","toLocaleTimeString","Login","setEmail","setPassword","onSubmit","htmlFor","autoComplete","onChange","disabled","Register","setUsername","confirmPassword","setConfirmPassword","useModalStore","isOpen","openModal","closeModal","Modal","title","handleEscape","body","overflow","sm","md","lg","xl","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","ResearchModal","onUpdate","activeTab","setActiveTab","researchProjects","setResearchProjects","setError","researchTemplates","researchCost","benefits","other","resourceBonus","creditsPerHour","createAuthenticatedApi","fetchResearchProjects","getResearchIcon","military","economic","exploration","getResearchColor","resources","credits","toLocaleString","category","template","project","isCompleted","isResearchAvailable","canAfford","benefit","handleStartResearch","progress","researchProgress","getResearchProgress","estimatedTime","hoursRemaining","estimateCompletionTime","width","toFixed","_id","completedAt","toLocaleDateString","parseCoord","coordStr","server","galaxy","parseInt","region","system","formatCoord","coord","padStart","COLONIZATION_COSTS","util","objectUtil","assertEqual","assertIs","_arg","assertNever","_x","arrayToEnum","items","item","getValidEnumValues","validKeys","objectKeys","filtered","objectValues","object","find","arr","checker","isInteger","val","isFinite","joinValues","array","separator","jsonStringifyReplacer","mergeShapes","second","ZodParsedType","getParsedType","undefined","string","isNaN","nan","number","boolean","function","bigint","symbol","null","promise","Map","date","unknown","ZodIssueCode","ZodError","issues","addIssue","sub","addIssues","actualProto","setPrototypeOf","__proto__","format","_mapper","mapper","issue","fieldErrors","_errors","processError","unionErrors","returnTypeError","argumentsError","curr","el","assert","isEmpty","flatten","formErrors","firstEl","errorMap","_ctx","invalid_type","received","expected","invalid_literal","unrecognized_keys","invalid_union","invalid_union_discriminator","invalid_enum_value","invalid_arguments","invalid_return_type","invalid_date","invalid_string","validation","position","too_small","exact","inclusive","minimum","too_big","maximum","custom","invalid_intersection_types","not_multiple_of","multipleOf","not_finite","defaultError","overrideErrorMap","defaultErrorMap","addIssueToContext","issueData","overrideMap","errorMaps","fullPath","fullIssue","errorMessage","maps","reverse","makeIssue","common","contextualErrorMap","schemaErrorMap","x","ParseStatus","dirty","mergeArray","results","arrayValue","INVALID","mergeObjectAsync","syncPairs","mergeObjectSync","finalObject","alwaysSet","DIRTY","OK","isAborted","isDirty","isValid","isAsync","errorUtil","errToObj","ParseInputLazyPath","parent","_cachedPath","_path","_key","handleResult","_error","processCreateParams","invalid_type_error","required_error","iss","ZodType","_def","_getType","_getOrReturnCtx","parsedType","_processInputParams","_parseSync","_parse","_parseAsync","safeParse","parseAsync","safeParseAsync","maybeAsyncResult","refine","check","getIssueProperties","_refinement","refinement","refinementData","ZodEffects","typeName","ZodFirstPartyTypeKind","effect","superRefine","def","spa","optional","nullable","nullish","or","and","brand","default","describe","pipe","readonly","isNullable","vendor","validate","ZodOptional","ZodNullable","ZodArray","ZodPromise","option","ZodUnion","incoming","ZodIntersection","defaultValueFunc","ZodDefault","innerType","defaultValue","ZodBranded","catchValueFunc","ZodCatch","catchValue","This","ZodPipeline","ZodReadonly","cuidRegex","cuid2Regex","ulidRegex","uuidRegex","nanoidRegex","jwtRegex","durationRegex","emailRegex","emojiRegex","ipv4Regex","ipv4CidrRegex","ipv6Regex","ipv6CidrRegex","base64Regex","base64urlRegex","dateRegexSource","dateRegex","timeRegexSource","secondsRegexSource","precision","timeRegex","datetimeRegex","regex","local","isValidIP","ip","isValidJWT","jwt","alg","padEnd","typ","isValidCidr","ZodString","coerce","checks","kind","tooBig","tooSmall","lastIndex","trim","_regex","_addCheck","emoji","uuid","nanoid","cuid","cuid2","ulid","base64url","cidr","datetime","time","minLength","maxLength","nonempty","isDatetime","ch","isDate","isTime","isDuration","isEmail","isURL","isEmoji","isUUID","isNANOID","isCUID","isCUID2","isULID","isIP","isCIDR","isBase64","isBase64url","floatSafeRemainder","step","valDecCount","stepDecCount","decCount","ZodNumber","gte","lte","setLimit","gt","lt","int","positive","negative","nonpositive","nonnegative","finite","safe","MIN_SAFE_INTEGER","minValue","maxValue","isInt","ZodBigInt","_getInvalidInput","ZodBoolean","Boolean","ZodDate","minDate","maxDate","ZodSymbol","ZodUndefined","ZodNull","ZodAny","_any","ZodUnknown","_unknown","ZodNever","never","ZodVoid","void","exactLength","all","deepPartialify","ZodObject","newShape","shape","fieldSchema","unwrap","ZodTuple","_cached","nonstrict","passthrough","augment","extend","_getCached","shapeKeys","extraKeys","catchall","unknownKeys","keyValidator","strict","strip","augmentation","merging","setKey","mask","omit","deepPartial","partial","newField","keyof","createZodEnum","strictCreate","lazycreate","childCtx","mergeValues","aType","bType","valid","bKeys","sharedKeys","newObj","sharedValue","newArray","types","handleParsed","parsedLeft","parsedRight","merged","left","right","itemIndex","schemas","ZodMap","keySchema","keyType","valueSchema","valueType","entries","finalMap","ZodSet","minSize","maxSize","finalizeSet","elements","parsedSet","values","ZodLazy","getter","ZodLiteral","ZodEnum","expectedValues","_cache","enum","enumValues","Values","Enum","extract","newDef","exclude","opt","ZodNativeEnum","nativeEnumValues","promisified","sourceType","checkCtx","arg","fatal","processed","executeRefinement","inner","createWithPreprocess","preprocess","removeDefault","newCtx","removeCatch","ZodNaN","inResult","in","out","handleAsync","stringType","numberType","anyType","unknownType","arrayType","objectType","enumType","z.object","z.string","coordinateSchema","z.number","y","systemId","fleetId","destination","z.any","empireId","maxPlayers","gameSpeed","startingResources","minerals","energy","planetSchema","z.enum","population","infrastructure","mines","factories","research_labs","defense_stations","coordinates","planets","z.array","owner","defenseLevel","health","maxHealth","attack","defense","speed","cargo","capacity","z.unknown","contentHash","technologies","buildings","defenses","units","profile","economyPerHour","fleetScore","technologyScore","level","userId","deviceId","schemaVersion","catalogs","generateSeedFromCoordinate","coordinate","abs","technologyCatalog","creditsCost","requiredLabs","prerequisites","computer","armour","laser","missiles","stellar_drive","plasma","warp_drive","shielding","ion","stealth","photon","artificial_intelligence","disruptor","cybernetics","tachyon_communications","anti_gravity","getTechSpec","getTechCreditCostForLevel","specOrKey","spec","targetLevel","cost","buildingsCatalog","urban_structures","energyDelta","economy","populationRequired","areaRequired","techPrereqs","mappedType","solar_plants","gas_plants","fusion_plants","antimatter_plants","advanced","orbital_plants","metal_refineries","crystal_mines","robotic_factories","command_centers","shipyards","orbital_shipyards","spaceports","nanite_factories","android_factories","economic_centers","terraform","multi_level_platforms","orbital_base","jump_gate","biosphere_modification","capital","getBuildingsList","getBuildingSpec","addResourceDelta","existing","metal","gas","crystals","TERRAIN_BASELINES","Arid","fertility","areaPlanet","areaMoon","Asteroid","Craters","Crystalline","Earthly","Gaia","Glacial","Magma","Metallic","Oceanic","Radioactive","Rocky","Toxic","Tundra","Volcanic","BASE_SOLAR_ENERGY","BASE_FERTILITY","getBasePosition","clampPosition","solarEnergy","STAR_KIND_WEIGHTS","weight","cumulativeWeights","sum","last","pickStarKindFromCoord","indexForKind","seed","normalizedFromSeed","defensesCatalog","barracks","weapon","shield","laser_turrets","missile_turrets","plasma_turrets","ion_turrets","photon_turrets","disruptor_turrets","deflection_shields","planetary_shield","planetary_ring","unitsCatalog","fighter","drive","hangar","requiredShipyardLevel","bomber","heavy_bomber","ion_bomber","corvette","recycler","destroyer","frigate","ion_frigate","scout_ship","outpost_ship","cruiser","carrier","heavy_cruiser","battleship","fleet_carrier","dreadnought","requiredOrbitalShipyardLevel","titan","leviathan","death_star","LEVEL_CREDITS","getStructureCreditCostForLevel","table","NaN","safeGetSpec","inFlightByUrl","resultCache","getWithDedupe","cached","ts","universeService","getLocationByCoord","getSystemBodies","getGalaxyRegionSummaries","getGalaxyRegionStarColors","getRegionSystems","GalaxyModal","territories","setTerritories","coordinateInput","setCoordinateInput","locationData","setLocationData","colonyName","setColonyName","colonizationCostCredits","baseCount","hasDeletedBase","baseCost","getColonizationCost","fetchTerritories","handleLocationSearch","getLocationIcon","canAffordColonization","territory","servers","generateRandomCoordinate","homeSystem","terrain","orbitPosition","yields","area","starOverhaul","Fragment","locationCoord","FleetModal","tabs","label","SectionHeaderStrip","setActive","TechnologiesTable","techs","useMemo","requires","StructuresTable","structs","getStructureEffect","NO_AREA_KEYS","AREA_INCREASE","renderArea","inc","DefensesTable","defs","getDefenseDescription","UnitsTable","renderShipyardReq","u","getUnitDescription","CapacitiesSection","TerrainsSection","TerrainsTable","AstroPositionTable","StarKindEffectsTable","rows","localeCompare","positions","gasByPos","kinds","selected","setSelected","deltas","resourceDelta","solarEnergyDelta","fertilityDelta","getStarKindModifiers","solar","fert","GameInfoModal","initialTab","Section","groups","baseline","tech","commander","isBuildingSource","classifyCapacityBreakdown","breakdown","GroupBlock","CapacityBreakdownModal","capacities","construction","production","research","fmtEnergy","SectionRow","Block","totalLabel","EnergyBreakdownModal","totals","producersSum","producers","it","consumersSum","consumers","produced","consumed","balance","reservedNegative","reserved","fmt","Row","AreaBreakdownModal","usedSum","used","free","PopulationBreakdownModal","users","sources","usersSum","sourcesSum","computeSharedCredits","hasCanonicalStructureCostForLevel","STRUCTURE_LEVEL_TABLES","populationCapacity","energyOutput","researchOutput","productionOutput","economyOutput","tradeRoutes","commandPoints","increasedArea","STRUCTURE_LEVEL_META","subtitle","useBaseStore","selectedBaseId","bases","setSelectedBase","baseId","setBases","updateBase","updates","addBase","removeBase","getSelectedBase","getBaseById","getTotalBases","StructureLevelsModal","structureKey","isMetalRefineries","isSolarPlants","isGasPlants","isUrbanStructures","isCrystalMines","selectedBase","metalRating","setMetalRating","solarRating","setSolarRating","gasRating","setGasRating","crystalRating","setCrystalRating","fertilityRating","setFertilityRating","didCancel","rating","load","positionBase","hasPopulationCapacity","hasEnergyOutput","hasResearchOutput","hasEconomyOutput","hasTradeRoutes","hasCommandPoints","hasProductionOutput","hasIncreasedArea","colSpan","ENERGY_LEVEL_ROWS","baseEnergyOutputPct","labs","COMPUTER_LEVEL_ROWS","campaignFleets","ARMOUR_LEVEL_ROWS","unitsArmourPct","LASER_LEVEL_ROWS","laserWeaponsAttackPct","MISSILES_LEVEL_ROWS","missilesWeaponsAttackPct","STELLAR_DRIVE_LEVEL_ROWS","stellarUnitsSpeedPct","PLASMA_LEVEL_ROWS","plasmaWeaponsAttackPct","PHOTON_LEVEL_ROWS","photonWeaponsAttackPct","WARP_DRIVE_LEVEL_ROWS","warpUnitsSpeedPct","SHIELDING_LEVEL_ROWS","unitsShieldStrengthPct","STEALTH_LEVEL_ROWS","ARTIFICIAL_INTELLIGENCE_LEVEL_ROWS","baseResearchOutputPct","CYBERNETICS_LEVEL_ROWS","baseConstructionProductionOutputPct","ION_LEVEL_ROWS","ionWeaponsAttackPct","DISRUPTOR_LEVEL_ROWS","disruptorWeaponsAttackPct","TACHYON_COMMUNICATIONS_LEVEL_ROWS","ANTI_GRAVITY_LEVEL_ROWS","RESEARCH_LEVEL_TABLES","tables","buildDefaultTables","RESEARCH_LEVEL_META","METRIC_PRIORITY","METRIC_LABELS","METRIC_KIND","ResearchLevelsModal","techKey","visibleMetricKey","selectVisibleMetricKey","hasCreditsOnly","computeHasCreditsOnly","showLabsBlock","emptyStateColSpan","ModalManager","sk","tk","getModalTitle","getModalSize","renderModalContent","Dashboard","dashboardData","setDashboardData","empireCreationName","setEmpireCreationName","showCreateEmpire","setShowCreateEmpire","apiClient","fetchDashboardData","techEntries","getTechEntries","tl","techLevels","serverInfo","statusService","getStatus","isApiErrorLike","StatusDot","showLabel","colorClass","dotSizeClass","labelColorClass","role","SyncDot","baseColorClass","pulseClass","aria","Layout","syncStatus","connectionState","showStatusLabel","statusTitle","serverStatus","setServerStatus","pauseUntil","fetchStatus","handler","playersOnline","seconds","formatUptime","uptimeSeconds","useUniverseMapStore","zoomLevel","selectedCoordinate","viewport","centerX","centerY","zoom","galaxyData","regionData","systemData","showGrid","showTerritories","showFleets","showResources","showOverhaulData","searchQuery","searchResults","systemTimeScalar","regionDataVersion","setZoomLevel","setSelectedCoordinate","navigateToCoordinate","getZoomLevelFromCoordinate","navigateToUniverse","navigateToGalaxy","navigateToRegion","navigateToSystem","zoomIn","levels","currentIndex","zoomOut","setViewport","panViewport","deltaX","deltaY","setGalaxyData","galaxyId","newGalaxyData","setRegionData","newRegionData","setSystemData","newSystemData","clearCache","toggleGrid","toggleTerritories","toggleFleets","toggleResources","toggleOverhaulData","setSearchQuery","setSearchResults","setSystemTimeScalar","getCurrentRegionKey","getCurrentSystemKey","NavigationBreadcrumb","onUniverse","onGalaxy","onRegion","LocationTooltip","tooltipStyle","top","innerWidth","fleets","UNIVERSE_LAYOUT","galaxySize","cols","GALAXY_LAYOUT","regionSize","STANDARD_ORBITS","calculateFittedGridLayout","canvasWidth","canvasHeight","baseItemSize","basePadding","margin","baseTotalWidth","baseTotalHeight","availableWidth","availableHeight","scale","itemSize","totalWidth","totalHeight","startX","startY","getClickedIndex","clickX","clickY","relativeX","relativeY","col","row","createOffscreenLayer","height","canvas","drawToLayer","layer","draw","getContext","clearRect","composeLayers","targetCtx","layers","drawImage","buildCachedLayer","keyPrefix","deps","builder","seen","WeakSet","stable","getCacheKeyFromDeps","clearLayerCache","predicate","RegionView","regionSystems","setRegionSystems","layerCacheRef","useRef","systems","systemsWithStars","star","fillStyle","fillRect","drawStarField","gctx","drawRegionGridLayer","computeSystemsHash","rctx","drawSystemsInRegion","brightness","sin","radius","gradient","createRadialGradient","addColorStop","calculateRegionGridLayout","gridW","gridH","gridX","gridY","cellW","cellH","strokeStyle","lineWidth","beginPath","moveTo","lineTo","sys","systemX","systemY","spectralClass","sysCoord","coordForStar","starKind","baseHex","color","YELLOW","ORANGE","WHITE","BLUE","RED_GIANT","SUPER_GIANT","WHITE_DWARF","NEUTRON","displayHex","enhanceStarColor","drawStarSystemAtPosition","font","textAlign","coordString","fillText","hexToRgba","hex","alpha","hexToRgb","rgbToHsl","hue2rgb","toHex","hslToHex","starColor","resolvedColor","save","prevComposite","globalCompositeOperation","glowGradient","innerAlpha","arc","PI","restore","systemCoord","getBodyPositionAtTime","timeScalar","angle","cos","orbitRadius","mapServerBodiesToSystemBodies","serverBodies","labelNum","isPlanet","isAsteroid","hasColony","PerformanceMonitor","enabled","warnStreakSeconds","frames","performance","fps","belowThresholdCount","update","SystemView","animationRef","enableFpsMonitor","perfMonitorRef","running","bgLayer","drawOrbit","drawStarSystemDetail","requestAnimationFrame","cancelAnimationFrame","starCoordStr","starType","bodies","drawCentralStar","drawCelestialBody","drawResourceLegend","starRadius","coronaGrad","ownerName","drawResourceIndicators","resource","intensity","indicatorX","indicatorY","legendX","legendY","strokeRect","itemY","fmtSigned","StarInfoPanel","hasStar","class","orbitModifiers","text","ZOOM_CONFIGS","getAuthHeader","tokenStr","RegionSummaryQueue","queue","inFlight","pausedUntil","backoffMs","destroyed","clear","task","priority","run","sleep","starColors","fetchRegionSystems","isRateLimit","__rateLimit","retryMs","__retryMs","VITE_API_URL","retryAfter","retrySec","json","UniverseMap","canvasRef","containerRef","canvasSize","setCanvasSize","mousePosition","setMousePosition","hoveredLocation","hoveredRegion","setHoveredRegion","canvasReady","setCanvasReady","prefetchKeyRef","queueRef","handleResize","useCallback","rect","getBoundingClientRect","newSize","handleMouseMove","clientX","clientY","fitted","handleCanvasClick","layout","calculateGridLayout","handleUniverseViewClick","regionId","handleGalaxyViewClick","dx","dy","summary","cachedBodies","clickedBody","nearestBody","nearestDistSq","POSITIVE_INFINITY","bx","by","distSq","globalThreshold","hx","hy","planetBodyIndex","planetCoord","rafId","cancelled","prefetchKey","regions","fromEntries","res2","drawGalaxy","arm","spiralRadius","spiralX","spiralY","coreGradient","drawRegionInGalaxy","mini","sx","sy","coordGalaxy","coordRegion","renderCurrentView","palette","colors","drawUniverseView","titleWidth","measureText","drawGalaxyView","boxW","boxH","tx","ty","animationId","animate","starPanel","systemKey","starBody","coordText","onMouseMove","onMouseLeave","GalaxyPage","PlanetPage","isValidCoordinate","components","setData","mounted","goSystem","planetVisualStyle","themes","terrestrial","gas_giant","ice","desert","volcanic","planet","asteroid","background","boxShadow","bodyLabel","apiType","displayType","displayName","starProperties","temperatureK","inflightBaseStats","baseStatsService","requestPromise","formatRemainingMs","totalSeconds","minutes","hours","ProgressBar","percent","barColor","trackColor","pct","BaseEventsTable","onRowClick","setItems","econMap","setEconMap","fetchSummary","fetchBaseEcon","ownerIncome","stats","ownerIncomeCredPerHour","baseEconomy","econ","econData","occupier","queued","remaining","researchWaiting","researchText","stopPropagation","BaseOverview","onBaseSelect","techService","getCatalog","baseCoord","reasons","getQueue","cancelQueueItem","structuresService","buildingKey","defensesService","defenseKey","unitsService","unitKey","fleetsService","inflightCapacities","capacitiesService","PlanetInfoBlock","showLinkToPlanetPage","showBudgets","refreshKey","caps","setCaps","capResults","setCapResults","baseStats","setBaseStats","display","maximumFractionDigits","PlanetVisual","sizeClass","basesService","getBaseStats","getBaseStructures","NetworkAwareButton","requiresNetwork","networkDisabledTooltip","networkDisabledClassName","isNetworkDisabled","isActuallyDisabled","baseClasses","getClassName","BuildTable","onRefresh","getTitleText","getDescriptionText","getEligibility","columns","onAction","actionLabel","actionTestIdPrefix","nameTestIdPrefix","defaultSort","firstColumnHeader","actionHeader","tableTestId","sortedItems","align","eligibility","canStart","reasonsLine","buttonLabel","StructuresBuildTable","catalog","onStart","constructionPerHour","activeConstruction","planetSolarEnergy","planetGasYield","planetMetalYield","planetCrystalsYield","planetFertility","expandedKey","setExpandedKey","hasActive","forceTick","React.useReducer","completionAt","currentLevel","nextLevel","nextCost","getRequiresText","met","perHour","formatDuration","lvl","hintLabel","hintValue","elig","showReasons","alert","eligible","ToastContext","useToast","ToastProvider","toasts","setToasts","addToast","removeToast","clearToasts","ToastViewport","dotColor","ResearchBuildTable","onQueue","researchPerHour","activeResearch","isOffline","completesAt","formatRequires","baseLabTotal","creditsOnly","catalogKey","identityKey","handleStart","creditOnly","isCreditsOnlyBlocked","ResearchQueuePanel","onChanged","setQueue","setTick","cancelingId","setCancelingId","fetchQueue","underway","waiting","handleCancel","confirm","started","startedAt","completes","elapsed","percentBetween","eta","msRemaining","formatEta","resolveName","StructuresQueuePanel","setSuccess","constructionCompleted","refunded","refundedCredits","constructionStarted","startsInMs","pendingUpgrade","DefensesBuildTable","getDefenseDescriptor","eventQueue","_d","shipyardReq","hasRequirements","getDescriptor","minutesFromCredits","productionPerHour","cap","formatMinutes","totalMinutes","UnitsBuildTable","quantities","setQuantities","perUnitMinutesByKey","totalCredits","perMin","quantity","perUnitMinutes","inputMode","handleChangeQty","StatLink","dataTestId","getBuildingLabel","totalSec","StatItem","main","BaseDetail","onBack","initialActivePanel","onPanelChange","activePanel","setActivePanel","setRefreshKey","notice","setNotice","showNotice","setBuildings","buildingsLoading","setBuildingsLoading","buildingsError","setBuildingsError","fleetsLoading","setFleetsLoading","fleetsError","setFleetsError","setFleets","refreshHeaderBudgets","loadBuildings","convertedBuildings","building","isActive","loadFleets","getFleets","setCatalog","researchLoading","setResearchLoading","researchError","setResearchError","setActiveResearch","structuresCatalog","setStructuresCatalog","structuresStatus","setStructuresStatus","structuresLoading","setStructuresLoading","structuresError","setStructuresError","baseLevels","setBaseLevels","setActiveConstruction","setConstructionPerHour","setCapacities","setPlanetSolarEnergy","setPlanetGasYield","setPlanetMetalYield","setPlanetCrystalsYield","setPlanetFertility","setDefensesCatalog","defensesStatus","setDefensesStatus","defensesLoading","setDefensesLoading","defensesError","setDefensesError","setUnitsCatalog","unitsStatus","setUnitsStatus","unitsLoading","setUnitsLoading","unitsError","setUnitsError","loadResearchData","catRes","statRes","loadResearchQueue","loadCapacitiesData","loadStructuresData","loadPlanetEnergyContext","loadBaseLevels","loadBaseStructures","loadDefensesData","loadUnitsData","structuresRes","nameByKey","areaByKey","lv","planetRes","gasYield","buildingsAtBase","includeQueuedReservations","isQueuedConsumer","computeEnergyBalance","deltaByKey","popReqByKey","sizeCredits","eventId","_s","conflicts","failedReasons","qty","timeText","unique","info","BaseManagement","fetchBases","coloniesResponse","validBases","buildingsResponse","constructionQueue","handleTabChange","tab","BasesPage","BUILDING_DISPLAY_NAME","metal_mine","energy_plant","factory","research_lab","defense_station","shipyard","command_center","habitat","BasePage","tabParamRaw","tabParam","initialPanel","handlePanelChange","panel","ownerUsername","setOwnerUsername","ownerId","setOwnerId","baseObj","setBaseObj","publicBuildings","setPublicBuildings","publicBuildingsError","setPublicBuildingsError","isOwner","locRes","bs","bRes","createdAt","updatedAt","displayBuildings","mockFleets","fleet","player","arrival","helpTopics","group","faqTopics","UpdateContext","useUpdate","updater","UpdateProvider","updateAvailable","updateDownloaded","checkingForUpdate","autoCheckEnabled","onUpdateEvent","eventData","updateInfo","releaseDate","releaseNotes","downloadProgress","transferred","bytesPerSecond","loadStatus","checkForUpdates","downloadUpdate","installUpdate","dismissUpdate","setAutoCheck","stored","formatBytes","parseFloat","UpdateSettings","isChecking","setIsChecking","checked","handleAutoCheckToggle","HelpPage","setTab","helpSelectedId","setHelpSelectedId","faqSelectedId","setFaqSelectedId","helpView","mainTopics","footerTopics","faqView","TabButton","topic","FleetPage","setFleet","loadFleet","getFleet","HOURS_OPTIONS","PerformancePage","setHours","setStats","thresholds","setThresholds","breaches","setBreaches","fetchStats","getStats","loadThresholds","getThresholds","loadBreaches","getThresholdBreaches","handleExport","export","fname","filename","blob","createObjectURL","setAttribute","appendChild","click","remove","revokeObjectURL","downloadString","opsByType","operationsByType","successRate","averageDurationMs","medianDurationMs","p95DurationMs","p99DurationMs","throughput","operationsPerMinute","totalOperations","op","avgDuration","errorDistribution","ThresholdsPanel","onReload","saving","setSaving","updateRow","patch","metric","p95Ms","failRatePct","removeRow","sanitized","SyncFeedback","prevStateRef","prevQueuedRef","prevRunAtRef","prevState","flushed","hasNewRun","UpdateNotification","isMinimized","setIsMinimized","handleDownload","handleInstall","handleDismiss","progressPercent","RouterComponent","historyRef","querySelector","getAttribute","setStateImpl","newState","UNSAFE_logV6DeprecationWarnings","App","isAuthed","ReactDOM","getElementById","StrictMode"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,50,51,52,53,54,55,56]}
import{r as e,a as t,b as s,R as a}from"./react-CXpB6dOV.js";import{a as r,c as n}from"./vendor-CpG0i1O1.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var i={exports:{}},o={},l=e,c=Symbol.for("react.element"),d=Symbol.for("react.fragment"),u=Object.prototype.hasOwnProperty,h=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,m={key:!0,ref:!0,__self:!0,__source:!0};function p(e,t,s){var a,r={},n=null,i=null;for(a in void 0!==s&&(n=""+s),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(i=t.ref),t)u.call(t,a)&&!m.hasOwnProperty(a)&&(r[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===r[a]&&(r[a]=t[a]);return{$$typeof:c,type:e,key:n,ref:i,props:r,_owner:h.current}}o.Fragment=d,o.jsx=p,o.jsxs=p,i.exports=o;var y,g,x=i.exports,f={},b=t;
/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},v.apply(this,arguments)}f.createRoot=b.createRoot,f.hydrateRoot=b.hydrateRoot,(g=y||(y={})).Pop="POP",g.Push="PUSH",g.Replace="REPLACE";const j="popstate";function w(e,t){if(!1===e||null==e)throw new Error(t)}function N(e,t){if(!e){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(s){}}}function k(e,t){return{usr:e.state,key:e.key,idx:t}}function S(e,t,s,a){return void 0===s&&(s=null),v({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?C(t):t,{state:s,key:t&&t.key||a||Math.random().toString(36).substr(2,8)})}function _(e){let{pathname:t="/",search:s="",hash:a=""}=e;return s&&"?"!==s&&(t+="?"===s.charAt(0)?s:"?"+s),a&&"#"!==a&&(t+="#"===a.charAt(0)?a:"#"+a),t}function C(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substr(s),e=e.substr(0,s));let a=e.indexOf("?");a>=0&&(t.search=e.substr(a),e=e.substr(0,a)),e&&(t.pathname=e)}return t}function P(e,t,s,a){void 0===a&&(a={});let{window:r=document.defaultView,v5Compat:n=!1}=a,i=r.history,o=y.Pop,l=null,c=d();function d(){return(i.state||{idx:null}).idx}function u(){o=y.Pop;let e=d(),t=null==e?null:e-c;c=e,l&&l({action:o,location:m.location,delta:t})}function h(e){let t="null"!==r.location.origin?r.location.origin:r.location.href,s="string"==typeof e?e:_(e);return s=s.replace(/ $/,"%20"),w(t,"No window.location.(origin|href) available to create URL for href: "+s),new URL(s,t)}null==c&&(c=0,i.replaceState(v({},i.state,{idx:c}),""));let m={get action(){return o},get location(){return e(r,i)},listen(e){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(j,u),l=e,()=>{r.removeEventListener(j,u),l=null}},createHref:e=>t(r,e),createURL:h,encodeLocation(e){let t=h(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){o=y.Push;let a=S(m.location,e,t);s&&s(a,e),c=d()+1;let u=k(a,c),h=m.createHref(a);try{i.pushState(u,"",h)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;r.location.assign(h)}n&&l&&l({action:o,location:m.location,delta:1})},replace:function(e,t){o=y.Replace;let a=S(m.location,e,t);s&&s(a,e),c=d();let r=k(a,c),u=m.createHref(a);i.replaceState(r,"",u),n&&l&&l({action:o,location:m.location,delta:0})},go:e=>i.go(e)};return m}var A,R;function T(e,t,s){return void 0===s&&(s="/"),function(e,t,s){let a="string"==typeof t?C(t):t,r=H(a.pathname||"/",s);if(null==r)return null;let n=E(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let s=e.length===t.length&&e.slice(0,-1).every((e,s)=>e===t[s]);return s?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(n);let i=null;for(let o=0;null==i&&o<n.length;++o){let e=z(r);i=W(n[o],e)}return i}(e,t,s)}function E(e,t,s,a){void 0===t&&(t=[]),void 0===s&&(s=[]),void 0===a&&(a="");let r=(e,r,n)=>{let i={relativePath:void 0===n?e.path||"":n,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};i.relativePath.startsWith("/")&&(w(i.relativePath.startsWith(a),'Absolute route path "'+i.relativePath+'" nested under path "'+a+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),i.relativePath=i.relativePath.slice(a.length));let o=Y([a,i.relativePath]),l=s.concat(i);e.children&&e.children.length>0&&(w(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),E(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:D(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var s;if(""!==e.path&&null!=(s=e.path)&&s.includes("?"))for(let a of O(e.path))r(e,t,a);else r(e,t)}),t}function O(e){let t=e.split("/");if(0===t.length)return[];let[s,...a]=t,r=s.endsWith("?"),n=s.replace(/\?$/,"");if(0===a.length)return r?[n,""]:[n];let i=O(a.join("/")),o=[];return o.push(...i.map(e=>""===e?n:[n,e].join("/"))),r&&o.push(...i),o.map(t=>e.startsWith("/")&&""===t?"/":t)}(R=A||(A={})).data="data",R.deferred="deferred",R.redirect="redirect",R.error="error";const I=/^:[\w-]+$/,M=3,F=2,$=1,L=10,q=-2,U=e=>"*"===e;function D(e,t){let s=e.split("/"),a=s.length;return s.some(U)&&(a+=q),t&&(a+=F),s.filter(e=>!U(e)).reduce((e,t)=>e+(I.test(t)?M:""===t?$:L),a)}function W(e,t,s){let{routesMeta:a}=e,r={},n="/",i=[];for(let o=0;o<a.length;++o){let e=a[o],s=o===a.length-1,l="/"===n?t:t.slice(n.length)||"/",c=B({path:e.relativePath,caseSensitive:e.caseSensitive,end:s},l),d=e.route;if(!c)return null;Object.assign(r,c.params),i.push({params:r,pathname:Y([n,c.pathname]),pathnameBase:V(Y([n,c.pathnameBase])),route:d}),"/"!==c.pathnameBase&&(n=Y([n,c.pathnameBase]))}return i}function B(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[s,a]=function(e,t,s){void 0===t&&(t=!1);void 0===s&&(s=!0);N("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let a=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,s)=>(a.push({paramName:t,isOptional:null!=s}),s?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(a.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let n=new RegExp(r,t?void 0:"i");return[n,a]}(e.path,e.caseSensitive,e.end),r=t.match(s);if(!r)return null;let n=r[0],i=n.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:a.reduce((e,t,s)=>{let{paramName:a,isOptional:r}=t;if("*"===a){let e=o[s]||"";i=n.slice(0,n.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[s];return e[a]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:n,pathnameBase:i,pattern:e}}function z(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return N(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function H(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,a=e.charAt(s);return a&&"/"!==a?null:e.slice(s)||"/"}function Z(e,t,s,a){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(a)+"].  Please separate it out to the `to."+s+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function G(e,t){let s=function(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}(e);return t?s.map((e,t)=>t===s.length-1?e.pathname:e.pathnameBase):s.map(e=>e.pathnameBase)}function K(e,t,s,a){let r;void 0===a&&(a=!1),"string"==typeof e?r=C(e):(r=v({},e),w(!r.pathname||!r.pathname.includes("?"),Z("?","pathname","search",r)),w(!r.pathname||!r.pathname.includes("#"),Z("#","pathname","hash",r)),w(!r.search||!r.search.includes("#"),Z("#","search","hash",r)));let n,i=""===e||""===r.pathname,o=i?"/":r.pathname;if(null==o)n=s;else{let e=t.length-1;if(!a&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}n=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:s,search:a="",hash:r=""}="string"==typeof e?C(e):e,n=s?s.startsWith("/")?s:function(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?s.length>1&&s.pop():"."!==e&&s.push(e)}),s.length>1?s.join("/"):"/"}(s,t):t;return{pathname:n,search:J(a),hash:Q(r)}}(r,n),c=o&&"/"!==o&&o.endsWith("/"),d=(i||"."===o)&&s.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}const Y=e=>e.join("/").replace(/\/\/+/g,"/"),V=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),J=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",Q=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";const X=["post","put","patch","delete"];new Set(X);const ee=["get",...X];
/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function te(){return te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},te.apply(this,arguments)}new Set(ee);const se=e.createContext(null),ae=e.createContext(null),re=e.createContext(null),ne=e.createContext(null),ie=e.createContext({outlet:null,matches:[],isDataRoute:!1}),oe=e.createContext(null);function le(){return null!=e.useContext(ne)}function ce(){return le()||w(!1),e.useContext(ne).location}function de(t){e.useContext(re).static||e.useLayoutEffect(t)}function ue(){let{isDataRoute:t}=e.useContext(ie);return t?function(){let{router:t}=function(){let t=e.useContext(se);return t||w(!1),t}(be.UseNavigateStable),s=je(ve.UseNavigateStable),a=e.useRef(!1);return de(()=>{a.current=!0}),e.useCallback(function(e,r){void 0===r&&(r={}),a.current&&("number"==typeof e?t.navigate(e):t.navigate(e,te({fromRouteId:s},r)))},[t,s])}():function(){le()||w(!1);let t=e.useContext(se),{basename:s,future:a,navigator:r}=e.useContext(re),{matches:n}=e.useContext(ie),{pathname:i}=ce(),o=JSON.stringify(G(n,a.v7_relativeSplatPath)),l=e.useRef(!1);return de(()=>{l.current=!0}),e.useCallback(function(e,a){if(void 0===a&&(a={}),!l.current)return;if("number"==typeof e)return void r.go(e);let n=K(e,JSON.parse(o),i,"path"===a.relative);null==t&&"/"!==s&&(n.pathname="/"===n.pathname?s:Y([s,n.pathname])),(a.replace?r.replace:r.push)(n,a.state,a)},[s,r,o,i,t])}()}function he(){let{matches:t}=e.useContext(ie),s=t[t.length-1];return s?s.params:{}}function me(t,s){let{relative:a}=void 0===s?{}:s,{future:r}=e.useContext(re),{matches:n}=e.useContext(ie),{pathname:i}=ce(),o=JSON.stringify(G(n,r.v7_relativeSplatPath));return e.useMemo(()=>K(t,JSON.parse(o),i,"path"===a),[t,o,i,a])}function pe(t,s){return function(t,s,a,r){le()||w(!1);let{navigator:n}=e.useContext(re),{matches:i}=e.useContext(ie),o=i[i.length-1],l=o?o.params:{};!o||o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d,u=ce();if(s){var h;let e="string"==typeof s?C(s):s;"/"===c||(null==(h=e.pathname)?void 0:h.startsWith(c))||w(!1),d=e}else d=u;let m=d.pathname||"/",p=m;if("/"!==c){let e=c.replace(/^\//,"").split("/");p="/"+m.replace(/^\//,"").split("/").slice(e.length).join("/")}let g=T(t,{pathname:p}),x=function(t,s,a,r){var n;void 0===s&&(s=[]);void 0===a&&(a=null);void 0===r&&(r=null);if(null==t){var i;if(!a)return null;if(a.errors)t=a.matches;else{if(!(null!=(i=r)&&i.v7_partialHydration&&0===s.length&&!a.initialized&&a.matches.length>0))return null;t=a.matches}}let o=t,l=null==(n=a)?void 0:n.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||w(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,d=-1;if(a&&r&&r.v7_partialHydration)for(let e=0;e<o.length;e++){let t=o[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(d=e),t.route.id){let{loaderData:e,errors:s}=a,r=t.route.loader&&void 0===e[t.route.id]&&(!s||void 0===s[t.route.id]);if(t.route.lazy||r){c=!0,o=d>=0?o.slice(0,d+1):[o[0]];break}}}return o.reduceRight((t,r,n)=>{let i,u=!1,h=null,m=null;var p;a&&(i=l&&r.route.id?l[r.route.id]:void 0,h=r.route.errorElement||ge,c&&(d<0&&0===n?(we[p="route-fallback"]||(we[p]=!0),u=!0,m=null):d===n&&(u=!0,m=r.route.hydrateFallbackElement||null)));let y=s.concat(o.slice(0,n+1)),g=()=>{let s;return s=i?h:u?m:r.route.Component?e.createElement(r.route.Component,null):r.route.element?r.route.element:t,e.createElement(fe,{match:r,routeContext:{outlet:t,matches:y,isDataRoute:null!=a},children:s})};return a&&(r.route.ErrorBoundary||r.route.errorElement||0===n)?e.createElement(xe,{location:a.location,revalidation:a.revalidation,component:h,error:i,children:g(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):g()},null)}(g&&g.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:Y([c,n.encodeLocation?n.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:Y([c,n.encodeLocation?n.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),i,a,r);if(s&&x)return e.createElement(ne.Provider,{value:{location:te({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:y.Pop}},x);return x}(t,s)}function ye(){let t=function(){var t;let s=e.useContext(oe),a=function(){let t=e.useContext(ae);return t||w(!1),t}(),r=je();if(void 0!==s)return s;return null==(t=a.errors)?void 0:t[r]}(),s=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),a=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return e.createElement(e.Fragment,null,e.createElement("h2",null,"Unexpected Application Error!"),e.createElement("h3",{style:{fontStyle:"italic"}},s),a?e.createElement("pre",{style:r},a):null,null)}const ge=e.createElement(ye,null);class xe extends e.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?e.createElement(ie.Provider,{value:this.props.routeContext},e.createElement(oe.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function fe(t){let{routeContext:s,match:a,children:r}=t,n=e.useContext(se);return n&&n.static&&n.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=a.route.id),e.createElement(ie.Provider,{value:s},r)}var be=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(be||{}),ve=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(ve||{});function je(t){let s=function(){let t=e.useContext(ie);return t||w(!1),t}(),a=s.matches[s.matches.length-1];return a.route.id||w(!1),a.route.id}const we={};function Ne(e,t){null==e||e.v7_startTransition,null==e||e.v7_relativeSplatPath}function ke(t){let{to:s,replace:a,state:r,relative:n}=t;le()||w(!1);let{future:i,static:o}=e.useContext(re),{matches:l}=e.useContext(ie),{pathname:c}=ce(),d=ue(),u=K(s,G(l,i.v7_relativeSplatPath),c,"path"===n),h=JSON.stringify(u);return e.useEffect(()=>d(JSON.parse(h),{replace:a,state:r,relative:n}),[d,h,n,a,r]),null}function Se(e){w(!1)}function _e(t){let{basename:s="/",children:a=null,location:r,navigationType:n=y.Pop,navigator:i,static:o=!1,future:l}=t;le()&&w(!1);let c=s.replace(/^\/*/,"/"),d=e.useMemo(()=>({basename:c,navigator:i,static:o,future:te({v7_relativeSplatPath:!1},l)}),[c,l,i,o]);"string"==typeof r&&(r=C(r));let{pathname:u="/",search:h="",hash:m="",state:p=null,key:g="default"}=r,x=e.useMemo(()=>{let e=H(u,c);return null==e?null:{location:{pathname:e,search:h,hash:m,state:p,key:g},navigationType:n}},[c,u,h,m,p,g,n]);return null==x?null:e.createElement(re.Provider,{value:d},e.createElement(ne.Provider,{children:a,value:x}))}function Ce(e){let{children:t,location:s}=e;return pe(Pe(t),s)}function Pe(t,s){void 0===s&&(s=[]);let a=[];return e.Children.forEach(t,(t,r)=>{if(!e.isValidElement(t))return;let n=[...s,r];if(t.type===e.Fragment)return void a.push.apply(a,Pe(t.props.children,n));t.type!==Se&&w(!1),t.props.index&&t.props.children&&w(!1);let i={id:t.props.id||n.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(i.children=Pe(t.props.children,n)),a.push(i)}),a}
/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},Ae.apply(this,arguments)}function Re(e){return void 0===e&&(e=""),new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,s)=>{let a=e[s];return t.concat(Array.isArray(a)?a.map(e=>[s,e]):[[s,a]])},[]))}new Promise(()=>{});const Te=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(Vl){}const Ee=s.startTransition;const Oe="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Ie=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Me=e.forwardRef(function(t,s){let a,{onClick:r,relative:n,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:u,viewTransition:h}=t,m=function(e,t){if(null==e)return{};var s,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)s=n[a],t.indexOf(s)>=0||(r[s]=e[s]);return r}(t,Te),{basename:p}=e.useContext(re),y=!1;if("string"==typeof d&&Ie.test(d)&&(a=d,Oe))try{let e=new URL(window.location.href),t=d.startsWith("//")?new URL(e.protocol+d):new URL(d),s=H(t.pathname,p);t.origin===e.origin&&null!=s?d=s+t.search+t.hash:y=!0}catch(Vl){}let g=function(t,s){let{relative:a}=void 0===s?{}:s;le()||w(!1);let{basename:r,navigator:n}=e.useContext(re),{hash:i,pathname:o,search:l}=me(t,{relative:a}),c=o;return"/"!==r&&(c="/"===o?r:Y([r,o])),n.createHref({pathname:c,search:l,hash:i})}(d,{relative:n}),x=function(t,s){let{target:a,replace:r,state:n,preventScrollReset:i,relative:o,viewTransition:l}=void 0===s?{}:s,c=ue(),d=ce(),u=me(t,{relative:o});return e.useCallback(e=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(e,a)){e.preventDefault();let s=void 0!==r?r:_(d)===_(u);c(t,{replace:s,state:n,preventScrollReset:i,relative:o,viewTransition:l})}},[d,c,u,r,n,a,t,i,o,l])}(d,{replace:o,state:l,target:c,preventScrollReset:u,relative:n,viewTransition:h});return e.createElement("a",Ae({},m,{href:a||g,onClick:y||i?r:function(e){r&&r(e),e.defaultPrevented||x(e)},ref:s,target:c}))});var Fe,$e,Le,qe;function Ue(t){let s=e.useRef(Re(t)),a=e.useRef(!1),r=ce(),n=e.useMemo(()=>function(e,t){let s=Re(e);return t&&t.forEach((e,a)=>{s.has(a)||t.getAll(a).forEach(e=>{s.append(a,e)})}),s}(r.search,a.current?null:s.current),[r.search]),i=ue(),o=e.useCallback((e,t)=>{const s=Re("function"==typeof e?e(n):e);a.current=!0,i("?"+s,t)},[i,n]);return[n,o]}($e=Fe||(Fe={})).UseScrollRestoration="useScrollRestoration",$e.UseSubmit="useSubmit",$e.UseSubmitFetcher="useSubmitFetcher",$e.UseFetcher="useFetcher",$e.useViewTransitionState="useViewTransitionState",(qe=Le||(Le={})).UseFetcher="useFetcher",qe.UseFetchers="useFetchers",qe.UseScrollRestoration="useScrollRestoration";const De={},We=e=>(t,s,a)=>{const r=a.subscribe;a.subscribe=(e,t,s)=>{let n=e;if(t){const r=(null==s?void 0:s.equalityFn)||Object.is;let i=e(a.getState());n=s=>{const a=e(s);if(!r(i,a)){const e=i;t(i=a,e)}},(null==s?void 0:s.fireImmediately)&&t(i,i)}return r(n)};return e(t,s,a)};function Be(e,t){let s;try{s=e()}catch(a){return}return{getItem:e=>{var t;const a=e=>null===e?null:JSON.parse(e,void 0),r=null!=(t=s.getItem(e))?t:null;return r instanceof Promise?r.then(a):a(r)},setItem:(e,t)=>s.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>s.removeItem(e)}}const ze=e=>t=>{try{const s=e(t);return s instanceof Promise?s:{then:e=>ze(e)(s),catch(e){return this}}}catch(Vl){return{then(e){return this},catch:t=>ze(t)(Vl)}}},He=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?("production"!==(De?"production":void 0)&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),((e,t)=>(s,a,r)=>{let n={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const o=new Set,l=new Set;let c;try{c=n.getStorage()}catch(g){}if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),s(...e)},a,r);const d=ze(n.serialize),u=()=>{const e=n.partialize({...a()});let t;const s=d({state:e,version:n.version}).then(e=>c.setItem(n.name,e)).catch(e=>{t=e});if(t)throw t;return s},h=r.setState;r.setState=(e,t)=>{h(e,t),u()};const m=e((...e)=>{s(...e),u()},a,r);let p;const y=()=>{var e;if(!c)return;i=!1,o.forEach(e=>e(a()));const t=(null==(e=n.onRehydrateStorage)?void 0:e.call(n,a()))||void 0;return ze(c.getItem.bind(c))(n.name).then(e=>{if(e)return n.deserialize(e)}).then(e=>{if(e){if("number"!=typeof e.version||e.version===n.version)return e.state;if(n.migrate)return n.migrate(e.state,e.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}}).then(e=>{var t;return p=n.merge(e,null!=(t=a())?t:m),s(p,!0),u()}).then(()=>{null==t||t(p,void 0),i=!0,l.forEach(e=>e(p))}).catch(e=>{null==t||t(void 0,e)})};return r.persist={setOptions:e=>{n={...n,...e},e.getStorage&&(c=e.getStorage())},clearStorage:()=>{null==c||c.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>y(),hasHydrated:()=>i,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},y(),p||m})(e,t)):((e,t)=>(s,a,r)=>{let n={storage:Be(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1;const o=new Set,l=new Set;let c=n.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${n.name}', the given storage is currently unavailable.`),s(...e)},a,r);const d=()=>{const e=n.partialize({...a()});return c.setItem(n.name,{state:e,version:n.version})},u=r.setState;r.setState=(e,t)=>{u(e,t),d()};const h=e((...e)=>{s(...e),d()},a,r);let m;r.getInitialState=()=>h;const p=()=>{var e,t;if(!c)return;i=!1,o.forEach(e=>{var t;return e(null!=(t=a())?t:h)});const r=(null==(t=n.onRehydrateStorage)?void 0:t.call(n,null!=(e=a())?e:h))||void 0;return ze(c.getItem.bind(c))(n.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===n.version)return[!1,e.state];if(n.migrate)return[!0,n.migrate(e.state,e.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[r,i]=e;if(m=n.merge(i,null!=(t=a())?t:h),s(m,!0),r)return d()}).then(()=>{null==r||r(m,void 0),m=a(),i=!0,l.forEach(e=>e(m))}).catch(e=>{null==r||r(void 0,e)})};return r.persist={setOptions:e=>{n={...n,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(n.name)},getOptions:()=>n,rehydrate:()=>p(),hasHydrated:()=>i,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},n.skipHydration||p(),m||h})(e,t),Ze={};function Ge(e){return`${(e.method||"get").toUpperCase()} ${e.baseURL?`${e.baseURL}${e.url}`:e.url||""}`}function Ke(e,t){if("undefined"!=typeof process&&"production"===process?.env?.NODE_ENV||!1)return;const s=e;s.__metricsAttached||(s.__metricsAttached=!0,e.interceptors.request.use(e=>{const s=Ge(e),a=Date.now();Ze[s]||(Ze[s]={inflight:0,recentTimestamps:[]});const r=Ze[s];return r.inflight+=1,r.recentTimestamps.push(a),function(e,t){for(;e.length>0&&t-e[0]>2e3;)e.shift()}(r.recentTimestamps,a),r.recentTimestamps.length>=5&&console.warn(`[http-metrics:${t}] Burst detected: ${r.recentTimestamps.length} requests in 2000ms for ${s}`),console.debug(`[http-metrics:${t}] > start (${r.inflight} inflight) ${s}`),e}),e.interceptors.response.use(e=>{const s=Ge(e.config),a=Ze[s];return a&&(a.inflight=Math.max(0,a.inflight-1),console.debug(`[http-metrics:${t}] < ok (${a.inflight} inflight) ${s} [${e.status}]`)),e},e=>{try{const s=e?.config;if(s){const a=Ge(s),r=Ze[a];if(r){r.inflight=Math.max(0,r.inflight-1);const s=e?.response?.status??"ERR";console.debug(`[http-metrics:${t}] < err (${r.inflight} inflight) ${a} [${s}]`)}}}catch{}return Promise.reject(e)}))}let Ye=null;function Ve(e){Ye=e??null}function Je(){return Ye}function Qe(){Ye=null}function Xe(){return"undefined"!=typeof window&&window.location?.href?.includes("localhost")||"undefined"!=typeof window&&window.location?.href?.includes("127.0.0.1")||"undefined"!=typeof window&&window.location?.href?.includes("packages/client")||"undefined"!=typeof process&&process.execPath?.includes("node_modules")?(console.log("ðŸ”§ Development indicators found - using development API"),console.log("ðŸŽ¯ === FINAL PRODUCTION DETECTION RESULT: false (dev indicators found) ==="),!1):(console.log("ðŸš€ No development indicators found - using production API"),console.log("ðŸŽ¯ === FINAL PRODUCTION DETECTION RESULT: true (no dev indicators) ==="),!0)}function et(){let e;if(Xe()){e=`https://${"attrition-game.onrender.com"}/api`,console.log(`ðŸ–¥ï¸ Desktop Production API: ${e}`)}else e="http://localhost:3001/api",console.log(`ðŸ–¥ï¸ Desktop Development API: ${e}`);return e}function tt(e){const t=e.replace(/\/api\/?$/,"");return e.startsWith("http://")&&!t.startsWith("http://")?t.replace(/^https:/,"http:"):t}let st=null;function at(){if(!st){st=function(){const e=Xe(),t="production",s=et(),a=tt(s),r=e,n={apiUrl:s,socketUrl:a,httpsEnforced:r,isProduction:e,isDesktop:!0,environment:t};return console.log("ðŸ–¥ï¸ Desktop API Configuration:",{environment:t,isProduction:e,httpsEnforced:r,apiUrl:s,socketUrl:a,forceDevMode:"false"}),e&&!s.startsWith("https://")&&console.warn("âš ï¸ Desktop Production Warning: Consider using HTTPS for security"),n}();!function(e){const t=[];let s=!0;return e.isProduction&&!e.apiUrl.startsWith("https://")&&(t.push("Using HTTP in production build - HTTPS recommended"),s=!1),e.isProduction&&(e.apiUrl.includes("localhost")||e.apiUrl.includes("127.0.0.1"))&&(t.push("Using localhost in production build - production server recommended"),s=!1),e.httpsEnforced&&!e.socketUrl.startsWith("https://")&&(t.push("WebSocket URL should use HTTPS when HTTPS is enforced"),s=!1),t.length>0&&console.warn("âš ï¸  API Security Warnings:",t),{isSecure:s,warnings:t}}(st).isSecure&&st.isProduction&&console.error("âŒ API configuration failed security validation in production")}return st}tt(et());const rt=at().apiUrl,nt=r.create({baseURL:rt,headers:{"Content-Type":"application/json"}});Ke(nt,"auth");let it=!1,ot=null,lt=null;const ct=e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)}catch{return null}},dt=e=>{lt&&(clearTimeout(lt),lt=null);const t=ct(e);if(t?.exp){ot=1e3*t.exp;const e=Date.now(),s=ot-3e5-e;s>0&&s<864e5&&(console.log(`[AUTH] Scheduling proactive token refresh in ${Math.round(s/1e3)}s`),lt=setTimeout(async()=>{console.log("[AUTH] Proactive token refresh triggered"),await ut()},s))}},ut=async()=>{if(it)return console.log("[AUTH] Refresh already in progress, waiting..."),null;try{if(it=!0,console.log("[AUTH] Performing token refresh..."),"undefined"!=typeof window&&window.desktop?.auth?.refresh){const e=await window.desktop.auth.refresh();if(e?.ok&&e.token)return Ve(e.token),dt(e.token),console.log("[AUTH] Token refreshed successfully"),e.token}return console.warn("[AUTH] Token refresh failed"),null}catch(e){return console.error("[AUTH] Token refresh error:",e),null}finally{it=!1}},ht=e=>{Ve(e),dt(e)};nt.interceptors.request.use(async e=>{const t=Je();if(t){const s=ct(t);if(s?.exp){const t=Date.now()/1e3,a=s.exp-t;if(a<120&&!it){console.log(`[AUTH] Token expires in ${Math.round(a)}s, attempting refresh...`);const t=await ut();if(t)return e.headers=e.headers??{},e.headers.Authorization=`Bearer ${t}`,e}}e.headers=e.headers??{},e.headers.Authorization=`Bearer ${t}`}return e}),nt.interceptors.response.use(e=>e,async e=>{const t=e?.response?.status,s=e?.config||{};if(401===t&&!s._retry&&"undefined"!=typeof window&&window.desktop?.auth?.refresh){s._retry=!0,console.log("[AUTH] 401 response, attempting token refresh...");const e=await ut();if(e)return console.log("[AUTH] Retrying original request with new token"),s.headers=s.headers||{},s.headers.Authorization=`Bearer ${e}`,nt.request(s)}if(401===t){try{localStorage.removeItem("auth-storage")}catch{}try{Qe()}catch{}try{window.desktop?.tokens?.deleteRefresh&&await window.desktop.tokens.deleteRefresh()}catch{}"undefined"!=typeof window&&("file:"===window.location.protocol?window.location.hash="#/login":window.location.href="/login")}return Promise.reject(e)});let mt=null,pt=null,yt=0;const gt={async login(e,t){console.log("[AUTH-SERVICE] Login called with:",{email:e,password:t?"[PRESENT]":"[MISSING]"});try{if("undefined"!=typeof window&&window.desktop?.auth?.login){console.log("[AUTH-SERVICE] Using desktop IPC auth.login");const s=await window.desktop.auth.login(e,t);return console.log("[AUTH-SERVICE] Desktop IPC response:",s),s?.success&&s.data?.token&&ht(s.data.token),s}const s=(await nt.post("/auth/login",{email:e,password:t})).data;return s?.success&&s.data?.token&&ht(s.data.token),s}catch(s){if(r.isAxiosError(s)&&s.response)return s.response.data;throw new Error("Network error occurred")}},async register(e,t,s){try{if("undefined"!=typeof window&&window.desktop?.auth?.register){const a=await window.desktop.auth.register(e,t,s);return a?.success&&a.data?.token&&ht(a.data.token),a}const a=(await nt.post("/auth/register",{email:e,username:t,password:s})).data;return a?.success&&a.data?.token&&ht(a.data.token),a}catch(a){if(r.isAxiosError(a)&&a.response)return a.response.data;throw new Error("Network error occurred")}},async getProfile(e=!1){const t=Date.now();return!e&&pt&&t-yt<5e3?pt:(!e&&mt||(e&&(mt=null),mt=(async()=>{try{const e=(await nt.get("/auth/me")).data;return e&&e.success&&(pt=e,yt=Date.now()),e}catch(e){if(r.isAxiosError(e)&&e.response)return e.response.data;throw new Error("Network error occurred")}finally{mt=null}})()),await mt)},async logout(){try{await nt.post("/auth/logout")}catch(e){console.error("Logout error:",e)}finally{if(lt&&(clearTimeout(lt),lt=null),ot=null,Qe(),localStorage.removeItem("auth-storage"),"undefined"!=typeof window&&window.desktop?.tokens?.deleteRefresh)try{await window.desktop.tokens.deleteRefresh()}catch(e){console.error("Error clearing refresh token:",e)}}}},xt=Object.create(null);xt.open="0",xt.close="1",xt.ping="2",xt.pong="3",xt.message="4",xt.upgrade="5",xt.noop="6";const ft=Object.create(null);Object.keys(xt).forEach(e=>{ft[xt[e]]=e});const bt={type:"error",data:"parser error"},vt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),jt="function"==typeof ArrayBuffer,wt=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Nt=({type:e,data:t},s,a)=>vt&&t instanceof Blob?s?a(t):kt(t,a):jt&&(t instanceof ArrayBuffer||wt(t))?s?a(t):kt(new Blob([t]),a):a(xt[e]+(t||"")),kt=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+(e||""))},s.readAsDataURL(e)};function St(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let _t;const Ct="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pt="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let Ql=0;Ql<64;Ql++)Pt[Ct.charCodeAt(Ql)]=Ql;const At="function"==typeof ArrayBuffer,Rt=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Et(e,t)};const s=e.charAt(0);if("b"===s)return{type:"message",data:Tt(e.substring(1),t)};return ft[s]?e.length>1?{type:ft[s],data:e.substring(1)}:{type:ft[s]}:bt},Tt=(e,t)=>{if(At){const s=(e=>{let t,s,a,r,n,i=.75*e.length,o=e.length,l=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);const c=new ArrayBuffer(i),d=new Uint8Array(c);for(t=0;t<o;t+=4)s=Pt[e.charCodeAt(t)],a=Pt[e.charCodeAt(t+1)],r=Pt[e.charCodeAt(t+2)],n=Pt[e.charCodeAt(t+3)],d[l++]=s<<2|a>>4,d[l++]=(15&a)<<4|r>>2,d[l++]=(3&r)<<6|63&n;return c})(e);return Et(s,t)}return{base64:!0,data:e}},Et=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Ot=String.fromCharCode(30);function It(){return new TransformStream({transform(e,t){!function(e,t){vt&&e.data instanceof Blob?e.data.arrayBuffer().then(St).then(t):jt&&(e.data instanceof ArrayBuffer||wt(e.data))?t(St(e.data)):Nt(e,!1,e=>{_t||(_t=new TextEncoder),t(_t.encode(e))})}(e,s=>{const a=s.length;let r;if(a<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,a);else if(a<65536){r=new Uint8Array(3);const e=new DataView(r.buffer);e.setUint8(0,126),e.setUint16(1,a)}else{r=new Uint8Array(9);const e=new DataView(r.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(a))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(s)})}})}let Mt;function Ft(e){return e.reduce((e,t)=>e+t.length,0)}function $t(e,t){if(e[0].length===t)return e.shift();const s=new Uint8Array(t);let a=0;for(let r=0;r<t;r++)s[r]=e[0][a++],a===e[0].length&&(e.shift(),a=0);return e.length&&a<e[0].length&&(e[0]=e[0].slice(a)),s}function Lt(e){if(e)return function(e){for(var t in Lt.prototype)e[t]=Lt.prototype[t];return e}(e)}Lt.prototype.on=Lt.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Lt.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},Lt.prototype.off=Lt.prototype.removeListener=Lt.prototype.removeAllListeners=Lt.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,a=this._callbacks["$"+e];if(!a)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<a.length;r++)if((s=a[r])===t||s.fn===t){a.splice(r,1);break}return 0===a.length&&delete this._callbacks["$"+e],this},Lt.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],a=1;a<arguments.length;a++)t[a-1]=arguments[a];if(s){a=0;for(var r=(s=s.slice(0)).length;a<r;++a)s[a].apply(this,t)}return this},Lt.prototype.emitReserved=Lt.prototype.emit,Lt.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Lt.prototype.hasListeners=function(e){return!!this.listeners(e).length};const qt="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Ut="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Dt(e,...t){return t.reduce((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t),{})}const Wt=Ut.setTimeout,Bt=Ut.clearTimeout;function zt(e,t){t.useNativeTimers?(e.setTimeoutFn=Wt.bind(Ut),e.clearTimeoutFn=Bt.bind(Ut)):(e.setTimeoutFn=Ut.setTimeout.bind(Ut),e.clearTimeoutFn=Ut.clearTimeout.bind(Ut))}function Ht(e){return"string"==typeof e?function(e){let t=0,s=0;for(let a=0,r=e.length;a<r;a++)t=e.charCodeAt(a),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(a++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))}function Zt(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class Gt extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class Kt extends Lt{constructor(e){super(),this.writable=!1,zt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new Gt(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Rt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}(e);return t.length?"?"+t:""}}class Yt extends Kt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const s=e.split(Ot),a=[];for(let r=0;r<s.length;r++){const e=Rt(s[r],t);if(a.push(e),"error"===e.type)break}return a})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const s=e.length,a=new Array(s);let r=0;e.forEach((e,n)=>{Nt(e,!1,e=>{a[n]=e,++r===s&&t(a.join(Ot))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Zt()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let Vt=!1;try{Vt="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Jl){}const Jt=Vt;function Qt(){}class Xt extends Yt{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}let es=class e extends Lt{constructor(e,t,s){super(),this.createRequest=e,zt(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=void 0!==s.data?s.data:null,this._create()}_create(){var t;const s=Dt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const a=this._xhr=this.createRequest(s);try{a.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){a.setDisableHeaderCheck&&a.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&a.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(Vl){}if("POST"===this._method)try{a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Vl){}try{a.setRequestHeader("Accept","*/*")}catch(Vl){}null===(t=this._opts.cookieJar)||void 0===t||t.addCookies(a),"withCredentials"in a&&(a.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(a.timeout=this._opts.requestTimeout),a.onreadystatechange=()=>{var e;3===a.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(a.getResponseHeader("set-cookie"))),4===a.readyState&&(200===a.status||1223===a.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof a.status?a.status:0)},0))},a.send(this._data)}catch(Vl){return void this.setTimeoutFn(()=>{this._onError(Vl)},0)}"undefined"!=typeof document&&(this._index=e.requestsCount++,e.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(t){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=Qt,t)try{this._xhr.abort()}catch(Vl){}"undefined"!=typeof document&&delete e.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};if(es.requestsCount=0,es.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",ts);else if("function"==typeof addEventListener){addEventListener("onpagehide"in Ut?"pagehide":"unload",ts,!1)}function ts(){for(let e in es.requests)es.requests.hasOwnProperty(e)&&es.requests[e].abort()}const ss=function(){const e=as({xdomain:!1});return e&&null!==e.responseType}();function as(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Jt))return new XMLHttpRequest}catch(Vl){}if(!t)try{return new(Ut[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(Vl){}}const rs="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class ns extends Kt{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=rs?{}:Dt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(Jl){return this.emitReserved("error",Jl)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],a=t===e.length-1;Nt(s,this.supportsBinary,e=>{try{this.doWrite(s,e)}catch(Vl){}a&&qt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Zt()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const is=Ut.WebSocket||Ut.MozWebSocket;const os={websocket:class extends ns{createSocket(e,t,s){return rs?new is(e,t,s):t?new is(e,t):new is(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends Kt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(Jl){return this.emitReserved("error",Jl)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){Mt||(Mt=new TextDecoder);const s=[];let a=0,r=-1,n=!1;return new TransformStream({transform(i,o){for(s.push(i);;){if(0===a){if(Ft(s)<1)break;const e=$t(s,1);n=!(128&~e[0]),r=127&e[0],a=r<126?3:126===r?1:2}else if(1===a){if(Ft(s)<2)break;const e=$t(s,2);r=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),a=3}else if(2===a){if(Ft(s)<8)break;const e=$t(s,8),t=new DataView(e.buffer,e.byteOffset,e.length),n=t.getUint32(0);if(n>Math.pow(2,21)-1){o.enqueue(bt);break}r=n*Math.pow(2,32)+t.getUint32(4),a=3}else{if(Ft(s)<r)break;const e=$t(s,r);o.enqueue(Rt(n?e:Mt.decode(e),t)),a=0}if(0===r||r>e){o.enqueue(bt);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),a=It();a.readable.pipeTo(e.writable),this._writer=a.writable.getWriter();const r=()=>{s.read().then(({done:e,value:t})=>{e||(this.onPacket(t),r())}).catch(e=>{})};r();const n={type:"open"};this.query.sid&&(n.data=`{"sid":"${this.query.sid}"}`),this._writer.write(n).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],a=t===e.length-1;this._writer.write(s).then(()=>{a&&qt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends Xt{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=ss&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new es(as,this.uri(),e)}}},ls=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,cs=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ds(e){if(e.length>8e3)throw"URI too long";const t=e,s=e.indexOf("["),a=e.indexOf("]");-1!=s&&-1!=a&&(e=e.substring(0,s)+e.substring(s,a).replace(/:/g,";")+e.substring(a,e.length));let r=ls.exec(e||""),n={},i=14;for(;i--;)n[cs[i]]=r[i]||"";return-1!=s&&-1!=a&&(n.source=t,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=!0),n.pathNames=function(e,t){const s=/\/{2,9}/g,a=t.replace(s,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||a.splice(0,1);"/"==t.slice(-1)&&a.splice(a.length-1,1);return a}(0,n.path),n.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,a){t&&(s[t]=a)}),s}(0,n.query),n}const us="function"==typeof addEventListener&&"function"==typeof removeEventListener,hs=[];us&&addEventListener("offline",()=>{hs.forEach(e=>e())},!1);class ms extends Lt{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const s=ds(e);t.hostname=s.host,t.secure="https"===s.protocol||"wss"===s.protocol,t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=ds(t.host).host);zt(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},s=e.split("&");for(let a=0,r=s.length;a<r;a++){let e=s[a].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),us&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},hs.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&ms.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",ms.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s&&(e+=Ht(s)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,qt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,a){if("function"==typeof t&&(a=t,t=void 0),"function"==typeof s&&(a=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),a&&this.once("flush",a),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(ms.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),us&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=hs.indexOf(this._offlineEventListener);-1!==e&&hs.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}ms.protocol=4;class ps extends ms{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;ms.priorWebsocketSuccess=!1;const a=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!s)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ms.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function r(){s||(s=!0,c(),t.close(),t=null)}const n=e=>{const s=new Error("probe error: "+e);s.transport=t.name,r(),this.emitReserved("upgradeError",s)};function i(){n("transport closed")}function o(){n("socket closed")}function l(e){t&&e.name!==t.name&&r()}const c=()=>{t.removeListener("open",a),t.removeListener("error",n),t.removeListener("close",i),this.off("close",o),this.off("upgrading",l)};t.once("open",a),t.once("error",n),t.once("close",i),this.once("close",o),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let ys=class extends ps{constructor(e,t={}){const s="object"==typeof e?e:t;(!s.transports||s.transports&&"string"==typeof s.transports[0])&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(e=>os[e]).filter(e=>!!e)),super(e,s)}};const gs="function"==typeof ArrayBuffer,xs=Object.prototype.toString,fs="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===xs.call(Blob),bs="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===xs.call(File);function vs(e){return gs&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||fs&&e instanceof Blob||bs&&e instanceof File}function js(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(js(e[t]))return!0;return!1}if(vs(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return js(e.toJSON(),!0);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&js(e[s]))return!0;return!1}function ws(e){const t=[],s=e.data,a=e;return a.data=Ns(s,t),a.attachments=t.length,{packet:a,buffers:t}}function Ns(e,t){if(!e)return e;if(vs(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let a=0;a<e.length;a++)s[a]=Ns(e[a],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(s[a]=Ns(e[a],t));return s}return e}function ks(e,t){return e.data=Ss(e.data,t),delete e.attachments,e}function Ss(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=Ss(e[s],t);else if("object"==typeof e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=Ss(e[s],t));return e}const _s=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var Cs,Ps;(Ps=Cs||(Cs={}))[Ps.CONNECT=0]="CONNECT",Ps[Ps.DISCONNECT=1]="DISCONNECT",Ps[Ps.EVENT=2]="EVENT",Ps[Ps.ACK=3]="ACK",Ps[Ps.CONNECT_ERROR=4]="CONNECT_ERROR",Ps[Ps.BINARY_EVENT=5]="BINARY_EVENT",Ps[Ps.BINARY_ACK=6]="BINARY_ACK";function As(e){return"[object Object]"===Object.prototype.toString.call(e)}class Rs extends Lt{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===Cs.BINARY_EVENT;s||t.type===Cs.BINARY_ACK?(t.type=s?Cs.EVENT:Cs.ACK,this.reconstructor=new Ts(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!vs(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===Cs[s.type])throw new Error("unknown packet type "+s.type);if(s.type===Cs.BINARY_EVENT||s.type===Cs.BINARY_ACK){const a=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const r=e.substring(a,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(r)}if("/"===e.charAt(t+1)){const a=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}s.nsp=e.substring(a,t)}else s.nsp="/";const a=e.charAt(t+1);if(""!==a&&Number(a)==a){const a=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(a,t+1))}if(e.charAt(++t)){const a=this.tryParse(e.substr(t));if(!Rs.isPayloadValid(s.type,a))throw new Error("invalid payload");s.data=a}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(Vl){return!1}}static isPayloadValid(e,t){switch(e){case Cs.CONNECT:return As(t);case Cs.DISCONNECT:return void 0===t;case Cs.CONNECT_ERROR:return"string"==typeof t||As(t);case Cs.EVENT:case Cs.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===_s.indexOf(t[0]));case Cs.ACK:case Cs.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ts{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ks(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Es=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Rs,Encoder:class{constructor(e){this.replacer=e}encode(e){return e.type!==Cs.EVENT&&e.type!==Cs.ACK||!js(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Cs.EVENT?Cs.BINARY_EVENT:Cs.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Cs.BINARY_EVENT&&e.type!==Cs.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ws(e),s=this.encodeAsString(t.packet),a=t.buffers;return a.unshift(s),a}},get PacketType(){return Cs},protocol:5},Symbol.toStringTag,{value:"Module"}));function Os(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const Is=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ms extends Lt{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Os(e,"open",this.onopen.bind(this)),Os(e,"packet",this.onpacket.bind(this)),Os(e,"error",this.onerror.bind(this)),Os(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,a,r;if(Is.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:Cs.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,s=t.pop();this._registerAckCallback(e,s),n.id=e}const i=null===(a=null===(s=this.io.engine)||void 0===s?void 0:s.transport)||void 0===a?void 0:a.writable,o=this.connected&&!(null===(r=this.io.engine)||void 0===r?void 0:r._hasPingExpired());return this.flags.volatile&&!i||(o?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var s;const a=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===a)return void(this.acks[e]=t);const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},a),n=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,e)};n.withError=!0,this.acks[e]=n}emitWithAck(e,...t){return new Promise((s,a)=>{const r=(e,t)=>e?a(e):s(t);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...a)=>{if(s!==this._queue[0])return;return null!==e?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...a)),s.pending=!1,this._drainQueue()}),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Cs.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Cs.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Cs.EVENT:case Cs.BINARY_EVENT:this.onevent(e);break;case Cs.ACK:case Cs.BINARY_ACK:this.onack(e);break;case Cs.DISCONNECT:this.ondisconnect();break;case Cs.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...a){s||(s=!0,t.packet({type:Cs.ACK,id:e,data:a}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Cs.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function Fs(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Fs.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+s:e-s}return 0|Math.min(e,this.max)},Fs.prototype.reset=function(){this.attempts=0},Fs.prototype.setMin=function(e){this.ms=e},Fs.prototype.setMax=function(e){this.max=e},Fs.prototype.setJitter=function(e){this.jitter=e};class $s extends Lt{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,zt(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=t.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new Fs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const a=t.parser||Es;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ys(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const a=Os(t,"open",function(){s.onopen(),e&&e()}),r=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},n=Os(t,"error",r);if(!1!==this._timeout){const e=this._timeout,s=this.setTimeoutFn(()=>{a(),r(new Error("timeout")),t.close()},e);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}return this.subs.push(a),this.subs.push(n),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Os(e,"ping",this.onping.bind(this)),Os(e,"data",this.ondata.bind(this)),Os(e,"error",this.onerror.bind(this)),Os(e,"close",this.onclose.bind(this)),Os(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(Vl){this.onclose("parse error",Vl)}}ondecoded(e){qt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Ms(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t){if(this.nsps[s].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),null===(s=this.engine)||void 0===s||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ls={};function qs(e,t){"object"==typeof e&&(t=e,e=void 0);const s=function(e,t="",s){let a=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==s?s.protocol+"//"+e:"https://"+e),a=ds(e)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";const r=-1!==a.host.indexOf(":")?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+r+":"+a.port+t,a.href=a.protocol+"://"+r+(s&&s.port===a.port?"":":"+a.port),a}(e,(t=t||{}).path||"/socket.io"),a=s.source,r=s.id,n=s.path,i=Ls[r]&&n in Ls[r].nsps;let o;return t.forceNew||t["force new connection"]||!1===t.multiplex||i?o=new $s(a,t):(Ls[r]||(Ls[r]=new $s(a,t)),o=Ls[r]),s.query&&!t.query&&(t.query=s.queryKey),o.socket(s.path,t)}Object.assign(qs,{Manager:$s,Socket:Ms,io:qs,connect:qs});const Us="undefined"!=typeof process&&"test"===process?.env?.NODE_ENV,Ds=at(),Ws=Ds.apiUrl;Ds.httpsEnforced?console.log("ðŸ” API Service: HTTPS enforcement active for production build"):Ds.isProduction&&!Ds.apiUrl.startsWith("https://")&&console.warn("âš ï¸  API Service: Production build using HTTP - HTTPS recommended");const Bs=r.create({baseURL:Ws,timeout:1e4,headers:{"Content-Type":"application/json"}});Ke(Bs,"api"),Bs.interceptors.request.use(e=>{const t=Je(),s=e.headers??{};t&&("function"==typeof s.set?s.set("Authorization",`Bearer ${t}`):s.Authorization=`Bearer ${t}`);if(!(("function"==typeof s.get?s.get("x-request-id"):s["x-request-id"])||void 0)){const e=`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;"function"==typeof s.set?s.set("x-request-id",e):s["x-request-id"]=e}return e.headers=s,e});let zs=null,Hs=async()=>{try{const e=window?.desktop?.auth?.refresh;if(!e)return null;const t=await e();return t&&t.ok&&t.token?(Ve(t.token),t.token):null}catch{return null}};function Zs(e){if(e.response){const t=e.response.status,s=e.response.data;return s&&!1===s.success?{code:s.code||"SERVER_ERROR",message:s.message||"Request failed",details:s.details??s,status:t}:{code:`HTTP_${t}`,message:s&&(s.message||s.error)||e.response.statusText||"HTTP Error",details:s,status:t}}const t=e?.code,s=e?.message;return"ECONNABORTED"===t||"string"==typeof s&&s.toLowerCase().includes("timeout")?{code:"TIMEOUT",message:"Request timed out"}:{code:"NETWORK_ERROR",message:"Network error"}}Bs.interceptors.response.use(e=>{const t=e?.data;if(t&&!1===t.success){const s={code:t.code||"SERVER_ERROR",message:t.message||"Request failed",details:t.details,status:e.status};return Promise.reject(s)}return e},async e=>{const t=e;if(!t?.response&&("ECONNABORTED"===t?.code||"string"==typeof t?.message&&t.message.toLowerCase().includes("timeout")))return Promise.reject({code:"TIMEOUT",message:"Request timed out"});const s=t?.response?.status,a=t?.config||{};if(401===s){if(a._retry401Replayed){if(Qe(),!Us&&"undefined"!=typeof window)try{try{window.dispatchEvent(new CustomEvent("auth:unauthorized"))}catch{}"file:"===window.location.protocol?window.location.hash="#/login":window.location.href="/login"}catch{}return Promise.reject({code:"UNAUTHORIZED",message:"Session expired",status:401})}zs||(zs=Hs().finally(()=>{zs=null}));const e=await zs;if(!e){if(Qe(),!Us&&"undefined"!=typeof window)try{try{window.dispatchEvent(new CustomEvent("auth:unauthorized"))}catch{}"file:"===window.location.protocol?window.location.hash="#/login":window.location.href="/login"}catch{}return Promise.reject({code:"UNAUTHORIZED",message:"Session expired",status:401})}{const t={...a,_retry401:!0,_retry401Replayed:!0,headers:{...a.headers||{},Authorization:`Bearer ${e}`}};try{return await Bs.request(t)}catch(d){const e=r.isAxiosError(d)?Zs(d):{code:"NETWORK_ERROR",message:"Network error"};return Promise.reject(e)}}}const n=(a.method||"get").toLowerCase(),i=t?.response?.status,o=502===i||503===i||504===i,l=!t?.response&&("ECONNABORTED"===t?.code||"string"==typeof t?.message&&t.message.toLowerCase().includes("network"));if("get"===n&&!a._retriedOnce&&(o||l)){a._retriedOnce=!0,await new Promise(e=>setTimeout(e,200));try{return await Bs.request(a)}catch(u){const e=u,t=r.isAxiosError(u)?Zs(u):"ECONNABORTED"===e?.code||"string"==typeof e?.message&&e.message.toLowerCase().includes("timeout")?{code:"TIMEOUT",message:"Request timed out"}:{code:"NETWORK_ERROR",message:"Network error"};return Promise.reject(t)}}const c=r.isAxiosError(t)?Zs(t):"ECONNABORTED"===t?.code||"string"==typeof t?.message&&t.message.toLowerCase().includes("timeout")?{code:"TIMEOUT",message:"Request timed out"}:{code:"NETWORK_ERROR",message:"Network error"};return Promise.reject(c)});const Gs="undefined"!=typeof process&&"test"===process?.env?.NODE_ENV;let Ks=null,Ys=null,Vs=0;const Js=at();function Qs(e){const t=Js.socketUrl,s=(e?e():null)??function(){const e=Je();if(e)return e;try{const e=localStorage.getItem("auth-storage");if(!e)return null;const t=JSON.parse(e);return t?.state?.token||null}catch{return null}}();if(Ks&&Ks.connected)return Ks;const a={transports:["websocket","polling"],auth:{token:s||""},autoConnect:!0};return Js.httpsEnforced?(a.secure=!0,a.rejectUnauthorized=!0,a.transports=["websocket"],console.log("ðŸ” Socket: HTTPS enforcement active - using secure WebSocket connection")):(a.secure=!1,a.transports=["websocket","polling"],console.log("ðŸ”“ Socket: Development mode - using insecure WebSocket connection to",t)),Js.isProduction&&!t.startsWith("https://")&&console.warn("âš ï¸  Socket: Production build using insecure WebSocket connection"),console.log("ðŸ”Œ Attempting WebSocket connection to:",t,"with options:",a),Ks=qs(t,a),Ks.on("connect",()=>{console.log("âœ… WebSocket connected successfully! Socket ID:",Ks?.id)}),Ks.on("disconnect",e=>{console.log("âŒ WebSocket disconnected. Reason:",e)}),Ks.on("connect_error",e=>{console.log("ðŸ”¥ WebSocket connection error:",e.message,e)}),Ks.on("connect_error",async e=>{if(console.log("ðŸ”„ WebSocket auth error, attempting token refresh:",e?.message),Date.now()-Vs<5e3)console.log("âš ï¸ Skipping refresh - too recent");else try{Ys||(Ys=Hs().finally(()=>{Ys=null}));const e=await Ys;if(e)Ve(e),Ks&&(Ks.auth={...Ks.auth||{},token:e},Ks.connected||Ks.connect());else{Vs=Date.now(),Qe();try{if(!Gs&&"undefined"!=typeof window){try{window.dispatchEvent(new CustomEvent("auth:unauthorized"))}catch{}"file:"===window.location.protocol?window.location.hash="#/login":window.location.href="/login"}}catch{}}}catch{}}),Ks.on("disconnect",()=>{}),Ks}function Xs(){return Ks}function ea(){try{Ks&&(Ks.removeAllListeners(),Ks.disconnect(),Ks=null)}catch{}}console.log("ðŸ” Socket Debug - API Config:",{socketUrl:Js.socketUrl,httpsEnforced:Js.httpsEnforced,isProduction:Js.isProduction,isDesktop:Js.isDesktop});const ta=n()(He((e,t)=>({user:null,empire:null,token:null,isLoading:!0,error:null,login:async(s,a)=>{console.log("[AUTH-STORE] Login called with:",{email:s,password:a?"[PRESENT]":"[MISSING]"});try{e({isLoading:!0,error:null}),console.log("[AUTH-STORE] Calling authService.login...");const r=await gt.login(s,a);if(console.log("[AUTH-STORE] AuthService response:",r),r.success&&r.data){e({user:r.data.user,empire:r.data.empire||null,token:r.data.token,isLoading:!1,error:null});try{Ve(r.data.token)}catch{}try{const e=r.data?.refreshToken;"undefined"!=typeof window&&window.desktop?.tokens?.saveRefresh&&e&&await window.desktop.tokens.saveRefresh(e)}catch{}try{Qs(()=>t().token)}catch{}}else e({error:r.message||r.error||"Login failed",isLoading:!1})}catch(r){e({error:r instanceof Error?r.message:"Login failed",isLoading:!1})}},register:async(s,a,r)=>{try{e({isLoading:!0,error:null});const n=await gt.register(s,a,r);if(n.success&&n.data){e({user:n.data.user,empire:n.data.empire||null,token:n.data.token,isLoading:!1,error:null});try{Ve(n.data.token)}catch{}try{const e=n.data?.refreshToken;"undefined"!=typeof window&&window.desktop?.tokens?.saveRefresh&&e&&await window.desktop.tokens.saveRefresh(e)}catch{}try{Qs(()=>t().token)}catch{}}else e({error:n.message||n.error||"Registration failed",isLoading:!1})}catch(n){e({error:n instanceof Error?n.message:"Registration failed",isLoading:!1})}},logout:()=>{gt.logout();try{"undefined"!=typeof window&&window.desktop?.tokens?.deleteRefresh&&window.desktop.tokens.deleteRefresh()}catch{}try{Qe()}catch{}try{ea()}catch{}e({user:null,empire:null,token:null,error:null})},unauthorize:()=>{try{Qe()}catch{}try{ea()}catch{}e({user:null,empire:null,token:null,isLoading:!1,error:null})},clearError:()=>{e({error:null})},setLoading:t=>{e({isLoading:t})},getIsAuthed:()=>{const{token:e,user:s}=t();return!!e&&!!s},checkAuth:async(s=!1)=>{let{token:a}=t();if(!a&&"undefined"!=typeof window&&window.desktop?.tokens?.hasRefresh&&window.desktop?.auth?.refresh)try{const t=await window.desktop.tokens.hasRefresh();if(t?.ok&&t.has){const t=await window.desktop.auth.refresh();t?.ok&&t.token&&(Ve(t.token),e({token:t.token}),a=t.token)}}catch{}if(a)try{e({isLoading:!0});const a=await gt.getProfile(s);if(a.success&&a.data){e({user:a.data.user,empire:a.data.empire||null,isLoading:!1,error:null});try{Qs(()=>t().token)}catch{}}else{e({user:null,empire:null,token:null,isLoading:!1,error:null});try{ea()}catch{}}}catch{e({user:null,empire:null,token:null,isLoading:!1,error:null});try{ea()}catch{}}else{e({user:null,empire:null,isLoading:!1,error:null});try{ea()}catch{}}}}),{name:"auth-storage",partialize:e=>({user:e.user,empire:e.empire})}));if("undefined"!=typeof window){const e=window;e.__AUTH_CHECK_RAN__||(e.__AUTH_CHECK_RAN__=!0,ta.getState().checkAuth())}const sa=e.createContext(void 0),aa=()=>{const t=e.useContext(sa);if(!t)throw new Error("useNetwork must be used within a NetworkProvider");return t},ra=({children:t})=>{const[s,a]=e.useState({isOnline:navigator.onLine,isApiReachable:!0,lastChecked:Date.now()}),r=s.isOnline&&s.isApiReachable;e.useEffect(()=>{const e=async()=>{try{const e=Date.now(),t=new AbortController,s=setTimeout(()=>t.abort(),5e3),r=`${at().apiUrl.replace("/api","")}/api/status`;console.log("ðŸ” NetworkContext: Checking connectivity to:",r);const n=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"},signal:t.signal});clearTimeout(s);const i=Date.now()-e;console.log("âœ… NetworkContext: API connectivity check result:",{ok:n.ok,status:n.status,latencyMs:i}),a({isOnline:!0,isApiReachable:n.ok,lastChecked:Date.now(),latencyMs:n.ok?i:void 0,error:n.ok?void 0:`HTTP ${n.status}`})}catch(e){a({isOnline:!0,isApiReachable:!1,lastChecked:Date.now(),error:"AbortError"===e.name?"timeout":e.message||"network_error"})}};e();const t=()=>{a(e=>({...e,isOnline:!0,lastChecked:Date.now()})),e()},s=()=>{a({isOnline:!1,isApiReachable:!1,lastChecked:Date.now()})};window.addEventListener("online",t),window.addEventListener("offline",s);const r=setInterval(e,3e4);return()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s),clearInterval(r)}},[]);const n={status:s,isFullyConnected:r};return x.jsx(sa.Provider,{value:n,children:t})},na=e.createContext(void 0),ia=()=>{const t=e.useContext(na);if(!t)throw new Error("useSync must be used within a SyncProvider");return t};const oa=({children:t,pollMs:s=5e3})=>{const{isFullyConnected:a}=aa(),[r,n]=e.useState({state:"idle",queuedCount:0});e.useEffect(()=>{let e;const t=async()=>{try{const e="undefined"!=typeof window&&!!window.desktop;let t,s,i,o=0;if(e){try{const e=await(window.desktop?.db?.events?.getPendingCount?.(null));e&&e.success&&(o="number"==typeof e.count?e.count:0)}catch{}try{const e=await(window.desktop?.perf?.getMetrics?.(1));if(e&&e.success&&Array.isArray(e.data)){const a=e.data.filter(e=>e&&"object"==typeof e&&("flush_cycle_complete"===e.operation||"bootstrap_complete"===e.operation)).sort((e,t)=>(t.timestamp??0)-(e.timestamp??0));if(a.length>0){const e=a[0];s="number"==typeof e.timestamp?e.timestamp:e.timestamp?new Date(e.timestamp).getTime():void 0,i="number"==typeof e.durationMs?e.durationMs:void 0;const r=Date.now();!!s&&r-s<=12e4&&!1===e.success&&(t=e.error||"sync_failed")}}}catch{}}const l=(r={queuedCount:o,isFullyConnected:a,recentError:t}).recentError?"error":r.queuedCount>0&&r.isFullyConnected?"syncing":"idle";n({state:l,queuedCount:o,lastRunAt:s,lastDurationMs:i,lastError:t})}catch{}finally{e=window.setTimeout(t,s)}var r};return t(),()=>{e&&window.clearTimeout(e)}},[a,s]);const i=e.useMemo(()=>({status:r}),[r]);return x.jsx(na.Provider,{value:i,children:t})},la=()=>{const{status:t,isFullyConnected:s}=aa(),[a,r]=e.useState(!1);if(e.useEffect(()=>{if(!s){r(!0);const e=setTimeout(()=>{s&&r(!1)},3e3);return()=>clearTimeout(e)}r(!1)},[s]),!a)return null;const n=t.isOnline?t.isApiReachable?"online":"degraded":"offline",i=t.isOnline?t.isApiReachable?"Connected to server":"Server unreachable":"No internet connection",o="online"===n,l="degraded"===n,c="offline"===n;return x.jsx("div",{className:"fixed top-0 left-0 right-0 z-50",children:x.jsxs("div",{className:`\n          flex items-center justify-between px-4 py-2 text-sm font-medium transition-all duration-300 ease-in-out\n          ${o?"bg-green-600":""}\n          ${l?"bg-yellow-600":""}\n          ${c?"bg-red-600":""}\n        `,children:[x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("div",{className:"w-2 h-2 rounded-full "+(o?"bg-green-200":l?"bg-yellow-200":"bg-red-200")}),x.jsx("span",{children:i}),t.latencyMs&&x.jsxs("span",{className:"text-xs opacity-75",children:["(",t.latencyMs,"ms)"]})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[!o&&t.lastChecked&&x.jsxs("span",{className:"text-xs opacity-75",children:["Last checked: ",new Date(t.lastChecked).toLocaleTimeString()]}),x.jsx("button",{onClick:()=>r(!1),className:"opacity-75 hover:opacity-100 transition-opacity",children:"Ã—"})]})]})})},ca="attrition-saved-credentials",da=()=>{const[t,s]=e.useState(""),[a,r]=e.useState(""),[n,i]=e.useState(!1),{login:o,isLoading:l,error:c,clearError:d}=ta();e.useEffect(()=>{const e=(()=>{try{const e=localStorage.getItem(ca);return e?JSON.parse(e):null}catch(c){return console.warn("Failed to load credentials:",c),null}})();e&&e.rememberMe&&(s(e.email),r(e.password),i(!0))},[]);return x.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:x.jsxs("div",{className:"max-w-md w-full space-y-8",children:[x.jsxs("div",{children:[x.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white",children:"Welcome to Attrition"}),x.jsx("p",{className:"mt-2 text-center text-sm text-gray-400",children:"Sign in to your account"})]}),x.jsx("form",{className:"mt-8 space-y-6",onSubmit:async e=>{e.preventDefault(),d(),n?(e=>{try{localStorage.setItem(ca,JSON.stringify(e))}catch(c){console.warn("Failed to save credentials:",c)}})({email:t,password:a,rememberMe:!0}):(()=>{try{localStorage.removeItem(ca)}catch(c){console.warn("Failed to clear credentials:",c)}})(),await o(t,a)},children:x.jsxs("div",{className:"game-card",children:[c&&x.jsx("div",{className:"mb-4 p-3 bg-red-600 bg-opacity-20 border border-red-600 rounded text-red-400 text-sm",children:c}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address"}),x.jsx("input",{id:"email","data-testid":"login-email",name:"email",type:"email",autoComplete:"email",required:!0,className:"game-input w-full",placeholder:"Enter your email",value:t,onChange:e=>s(e.target.value)})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),x.jsx("input",{id:"password","data-testid":"login-password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"game-input w-full",placeholder:"Enter your password",value:a,onChange:e=>r(e.target.value)})]})]}),x.jsx("div",{className:"mt-6",children:x.jsx("button",{type:"submit","data-testid":"login-submit",disabled:l,className:"game-button w-full",children:l?x.jsxs("div",{className:"flex items-center justify-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing in..."]}):"Sign in"})}),x.jsx("div",{className:"mt-4 flex items-center justify-center",children:x.jsxs("label",{className:"flex items-center text-sm text-gray-300 cursor-pointer",children:[x.jsx("input",{type:"checkbox",checked:n,onChange:e=>i(e.target.checked),className:"mr-2 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500 focus:ring-2"}),"Remember me"]})}),x.jsx("div",{className:"mt-4 text-center",children:x.jsxs("p",{className:"text-sm text-gray-400",children:["Don't have an account?"," ",x.jsx(Me,{to:"/register",className:"text-blue-400 hover:text-blue-300",children:"Create one here"})]})})]})})]})})},ua=()=>{const[t,s]=e.useState(""),[a,r]=e.useState(""),[n,i]=e.useState(""),[o,l]=e.useState(""),{register:c,isLoading:d,error:u,clearError:h}=ta();return x.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900",children:x.jsxs("div",{className:"max-w-md w-full space-y-8",children:[x.jsxs("div",{children:[x.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-white",children:"Join Attrition"}),x.jsx("p",{className:"mt-2 text-center text-sm text-gray-400",children:"Create your account and build your empire"})]}),x.jsx("form",{className:"mt-8 space-y-6",onSubmit:async e=>{e.preventDefault(),h(),n===o&&await c(t,a,n)},children:x.jsxs("div",{className:"game-card",children:[u&&x.jsx("div",{className:"mb-4 p-3 bg-red-600 bg-opacity-20 border border-red-600 rounded text-red-400 text-sm",children:u}),n!==o&&o&&x.jsx("div",{className:"mb-4 p-3 bg-red-600 bg-opacity-20 border border-red-600 rounded text-red-400 text-sm",children:"Passwords do not match"}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address"}),x.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"game-input w-full",placeholder:"Enter your email",value:t,onChange:e=>s(e.target.value)})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),x.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"game-input w-full",placeholder:"Choose a username",value:a,onChange:e=>r(e.target.value)})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-2",children:"Password"}),x.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,className:"game-input w-full",placeholder:"Create a password",value:n,onChange:e=>i(e.target.value)})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-2",children:"Confirm Password"}),x.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:"password",autoComplete:"new-password",required:!0,className:"game-input w-full",placeholder:"Confirm your password",value:o,onChange:e=>l(e.target.value)})]})]}),x.jsx("div",{className:"mt-6",children:x.jsx("button",{type:"submit",disabled:d||n!==o,className:"game-button w-full",children:d?x.jsxs("div",{className:"flex items-center justify-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating account..."]}):"Create Account"})}),x.jsx("div",{className:"mt-4 text-center",children:x.jsxs("p",{className:"text-sm text-gray-400",children:["Already have an account?"," ",x.jsx(Me,{to:"/login",className:"text-blue-400 hover:text-blue-300",children:"Sign in here"})]})})]})})]})})},ha=n(e=>({isOpen:!1,type:null,data:null,openModal:(t,s)=>e({isOpen:!0,type:t,data:s}),closeModal:()=>e({isOpen:!1,type:null,data:null})})),ma=({isOpen:t,onClose:s,title:a,children:r,size:n="lg"})=>{if(e.useEffect(()=>{const e=e=>{"Escape"===e.key&&s()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,s]),!t)return null;return x.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[x.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-75 backdrop-blur-sm",onClick:s}),x.jsxs("div",{className:`relative bg-gray-800 rounded-lg shadow-2xl border border-gray-600 w-full mx-4 ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl","2xl":"max-w-6xl"}[n]} max-h-[90vh] overflow-hidden`,children:[x.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-600",children:[x.jsx("h2",{className:"text-xl font-semibold text-white",children:a}),x.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors p-1 rounded-md hover:bg-gray-700",children:x.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),x.jsx("div",{className:"p-4 overflow-y-auto max-h-[calc(90vh-80px)]",children:r})]})]})},pa=({empire:t,onUpdate:s})=>{const[a,r]=e.useState("available"),[n,i]=e.useState([]),[o,l]=e.useState(!1),[c,d]=e.useState(null),u=[{type:"military",name:"Advanced Weaponry",description:"Develop more powerful weapons for your defense stations and fleets.",researchCost:500,benefits:{other:["Increases defense station effectiveness by 25%","Unlocks advanced weapon systems"]}},{type:"military",name:"Shield Technology",description:"Research protective shield systems for buildings and ships.",researchCost:750,benefits:{other:["Reduces building damage by 20%","Unlocks shield generators"]}},{type:"military",name:"Tactical Systems",description:"Improve command and control systems for better military coordination.",researchCost:1e3,benefits:{other:["Increases fleet coordination","Unlocks advanced military buildings"]}},{type:"economic",name:"Mining Efficiency",description:"Improve mining techniques to extract more resources from deposits.",researchCost:300,benefits:{resourceBonus:{creditsPerHour:10},other:["Increases all mine production by 20%"]}},{type:"economic",name:"Energy Optimization",description:"Develop more efficient energy production and distribution systems.",researchCost:400,benefits:{resourceBonus:{creditsPerHour:15},other:["Increases all energy plant production by 20%"]}},{type:"economic",name:"Industrial Automation",description:"Automate production processes to increase factory output.",researchCost:600,benefits:{other:["Increases factory production by 30%","Reduces construction time by 10%"]}},{type:"economic",name:"Trade Networks",description:"Establish efficient trade routes to boost economic growth.",researchCost:800,benefits:{other:["Increases credit generation by 25%","Unlocks trade buildings"]}},{type:"exploration",name:"Advanced Sensors",description:"Develop better scanning technology to explore the galaxy more effectively.",researchCost:350,benefits:{other:["Reveals more information about locations","Increases exploration range"]}},{type:"exploration",name:"Faster-Than-Light Travel",description:"Research improved propulsion systems for faster interstellar travel.",researchCost:1200,benefits:{other:["Reduces fleet travel time by 50%","Unlocks advanced ship designs"]}},{type:"exploration",name:"Xenobiology",description:"Study alien life forms and ecosystems for scientific advancement.",researchCost:500,benefits:{resourceBonus:{creditsPerHour:20},other:["Increases research lab efficiency by 25%"]}},{type:"exploration",name:"Terraforming Technology",description:"Develop the ability to transform hostile worlds into habitable colonies.",researchCost:1500,benefits:{other:["Unlocks terraforming equipment","Increases colony growth rate"]}}],h=Bs,m=async()=>{try{const e=await h.get("/game/research");e.data.success&&i(e.data.data.researchProjects)}catch(Jl){console.error("Error fetching research projects:",Jl),d("Failed to load research projects")}},p=e=>({military:"âš”ï¸",economic:"ðŸ’°",exploration:"ðŸš€"}[e]||"ðŸ”¬"),y=e=>({military:"text-red-400",economic:"text-yellow-400",exploration:"text-blue-400"}[e]||"text-purple-400");return e.useEffect(()=>{m();const e=setInterval(()=>{m()},6e4);return()=>clearInterval(e)},[]),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex space-x-1 bg-gray-700 p-1 rounded-lg",children:[x.jsx("button",{onClick:()=>r("available"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("available"===a?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"ðŸ”¬ Available"}),x.jsx("button",{onClick:()=>r("active"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("active"===a?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"â³ In Progress"}),x.jsx("button",{onClick:()=>r("completed"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("completed"===a?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"âœ… Completed"})]}),c&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200",children:c}),x.jsxs("div",{className:"p-3 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-gray-300",children:"Available Credits for Research:"}),x.jsxs("span",{className:"text-yellow-400 font-mono text-lg",children:["ðŸ’° ",t.resources.credits.toLocaleString()]})]}),x.jsxs("div",{className:"flex items-center justify-between mt-1",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Research funded by credits"}),x.jsx("span",{className:"text-blue-400 text-sm",children:"Pay per project"})]})]}),"available"===a&&x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white",children:"Available Research Projects"}),["military","economic","exploration"].map(e=>x.jsxs("div",{className:"space-y-3",children:[x.jsxs("h4",{className:`font-medium capitalize flex items-center gap-2 ${y(e)}`,children:[p(e)," ",e," Research"]}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:u.filter(t=>t.type===e&&(e=>!n.some(t=>t.name===e.name&&(t.isCompleted||!t.isCompleted)))(t)).map(e=>{const a=t.resources.credits>=e.researchCost;return x.jsxs("div",{className:"p-4 rounded-lg border "+(a?"border-gray-600 bg-gray-700":"border-red-600 bg-red-900/20"),children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsxs("h5",{className:"font-medium text-white flex items-center gap-2",children:[p(e.type)," ",e.name]}),x.jsxs("span",{className:"text-xs px-2 py-1 rounded "+(a?"bg-yellow-600 text-white":"bg-red-600 text-white"),children:["ðŸ’° ",e.researchCost.toLocaleString()]})]}),x.jsx("p",{className:"text-sm text-gray-400 mb-3",children:e.description}),x.jsx("div",{className:"space-y-2",children:x.jsxs("div",{className:"text-xs",children:[x.jsx("span",{className:"text-gray-400",children:"Benefits:"}),x.jsxs("ul",{className:"mt-1 space-y-1",children:[e.benefits.resourceBonus&&x.jsx("li",{className:"text-green-400",children:e.benefits.resourceBonus.creditsPerHour&&`+${e.benefits.resourceBonus.creditsPerHour} Credits/hour`}),e.benefits.other?.map((e,t)=>x.jsxs("li",{className:"text-blue-400",children:["â€¢ ",e]},t))]})]})}),x.jsx("button",{onClick:()=>(async e=>{if(t.resources.credits<e.researchCost)d("Insufficient credits");else{l(!0),d(null);try{const t=await h.post("/game/territories/colonize",{type:e.type,name:e.name,description:e.description,researchCost:e.researchCost});t.data.success?(await m(),s(),r("active")):d(t.data.error||"Failed to start research")}catch(Jl){d(Jl.response?.data?.error||"Network error. Please try again.")}finally{l(!1)}}})(e),disabled:!a||o,className:"w-full mt-3 py-2 px-4 rounded-md text-sm font-medium transition-colors "+(a?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"),children:o?"Starting Research...":"Fund Research"})]},e.name)})})]},e))]}),"active"===a&&x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white",children:"Active Research Projects"}),0===n.filter(e=>!e.isCompleted).length?x.jsx("p",{className:"text-gray-400",children:"No active research projects. Start a new research project to see progress here!"}):x.jsx("div",{className:"space-y-3",children:n.filter(e=>!e.isCompleted).map(e=>{const t=(e=>Math.min(100,e.researchProgress/e.researchCost*100))(e),s=(e=>{const t=(e.researchCost-e.researchProgress)/10;return t<1?"Less than 1 hour":t<24?`${Math.ceil(t)} hours`:`${Math.ceil(t/24)} days`})(e);return x.jsxs("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[p(e.type)," ",e.name]}),x.jsx("span",{className:`text-xs px-2 py-1 rounded ${y(e.type)} bg-gray-800`,children:e.type})]}),x.jsx("p",{className:"text-sm text-gray-400 mb-3",children:e.description}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-400",children:"Progress:"}),x.jsxs("span",{className:"text-white",children:[e.researchProgress.toLocaleString()," / ",e.researchCost.toLocaleString()]})]}),x.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:x.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${t}%`}})}),x.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[x.jsxs("span",{children:[t.toFixed(1),"% complete"]}),x.jsxs("span",{children:["ETA: ",s]})]})]})]},e._id)})})]}),"completed"===a&&x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white",children:"Completed Research"}),0===n.filter(e=>e.isCompleted).length?x.jsx("p",{className:"text-gray-400",children:"No completed research yet. Complete research projects to see them here!"}):x.jsx("div",{className:"space-y-3",children:n.filter(e=>e.isCompleted).map(e=>x.jsxs("div",{className:"p-4 bg-green-900/20 rounded-lg border border-green-600",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:["âœ… ",p(e.type)," ",e.name]}),x.jsxs("span",{className:"text-xs text-green-400",children:["Completed ",e.completedAt?new Date(e.completedAt).toLocaleDateString():"Recently"]})]}),x.jsx("p",{className:"text-sm text-gray-400 mb-2",children:e.description}),x.jsx("div",{className:"text-xs text-green-400",children:"âœ¨ Research benefits are now active across your empire!"})]},e._id))})]})]})};function ya(e){const t=e.match(/^([A-Z])(\d{2}):(\d{2}):(\d{2}):(\d{2})$/);if(!t)throw new Error(`Invalid coordinate format: ${e}. Expected format: A00:10:22:10`);return{server:t[1],galaxy:parseInt(t[2],10),region:parseInt(t[3],10),system:parseInt(t[4],10),body:parseInt(t[5],10)}}function ga(e){return`${e.server}${e.galaxy.toString().padStart(2,"0")}:${e.region.toString().padStart(2,"0")}:${e.system.toString().padStart(2,"0")}:${e.body.toString().padStart(2,"0")}`}const xa=[100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5,2e5,4e5,65e4,1e6,15e5,25e5,4e6,65e5,1e7,15e6,25e6,4e7,65e6,1e8,15e7,25e7,4e8,65e7];var fa,ba,va;(ba=fa||(fa={})).assertEqual=e=>{},ba.assertIs=function(e){},ba.assertNever=function(e){throw new Error},ba.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},ba.getValidEnumValues=e=>{const t=ba.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),s={};for(const a of t)s[a]=e[a];return ba.objectValues(s)},ba.objectValues=e=>ba.objectKeys(e).map(function(t){return e[t]}),ba.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},ba.find=(e,t)=>{for(const s of e)if(t(s))return s},ba.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,ba.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},ba.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(va||(va={})).mergeShapes=(e,t)=>({...e,...t});const ja=fa.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wa=e=>{switch(typeof e){case"undefined":return ja.undefined;case"string":return ja.string;case"number":return Number.isNaN(e)?ja.nan:ja.number;case"boolean":return ja.boolean;case"function":return ja.function;case"bigint":return ja.bigint;case"symbol":return ja.symbol;case"object":return Array.isArray(e)?ja.array:null===e?ja.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?ja.promise:"undefined"!=typeof Map&&e instanceof Map?ja.map:"undefined"!=typeof Set&&e instanceof Set?ja.set:"undefined"!=typeof Date&&e instanceof Date?ja.date:ja.object;default:return ja.unknown}},Na=fa.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ka extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},s={_errors:[]},a=e=>{for(const r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(a);else if("invalid_return_type"===r.code)a(r.returnTypeError);else if("invalid_arguments"===r.code)a(r.argumentsError);else if(0===r.path.length)s._errors.push(t(r));else{let e=s,a=0;for(;a<r.path.length;){const s=r.path[a];a===r.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(r))):e[s]=e[s]||{_errors:[]},e=e[s],a++}}};return a(this),s}static assert(e){if(!(e instanceof ka))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,fa.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const a of this.issues)if(a.path.length>0){const s=a.path[0];t[s]=t[s]||[],t[s].push(e(a))}else s.push(e(a));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}ka.create=e=>new ka(e);const Sa=(e,t)=>{let s;switch(e.code){case Na.invalid_type:s=e.received===ja.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Na.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,fa.jsonStringifyReplacer)}`;break;case Na.unrecognized_keys:s=`Unrecognized key(s) in object: ${fa.joinValues(e.keys,", ")}`;break;case Na.invalid_union:s="Invalid input";break;case Na.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${fa.joinValues(e.options)}`;break;case Na.invalid_enum_value:s=`Invalid enum value. Expected ${fa.joinValues(e.options)}, received '${e.received}'`;break;case Na.invalid_arguments:s="Invalid function arguments";break;case Na.invalid_return_type:s="Invalid function return type";break;case Na.invalid_date:s="Invalid date";break;case Na.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:fa.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Na.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Na.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Na.custom:s="Invalid input";break;case Na.invalid_intersection_types:s="Intersection results could not be merged";break;case Na.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case Na.not_finite:s="Number must be finite";break;default:s=t.defaultError,fa.assertNever(e)}return{message:s}};let _a=Sa;function Ca(e,t){const s=_a,a=(e=>{const{data:t,path:s,errorMaps:a,issueData:r}=e,n=[...s,...r.path||[]],i={...r,path:n};if(void 0!==r.message)return{...r,path:n,message:r.message};let o="";const l=a.filter(e=>!!e).slice().reverse();for(const c of l)o=c(i,{data:t,defaultError:o}).message;return{...r,path:n,message:o}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===Sa?void 0:Sa].filter(e=>!!e)});e.common.issues.push(a)}class Pa{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const a of t){if("aborted"===a.status)return Aa;"dirty"===a.status&&e.dirty(),s.push(a.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const a of t){const e=await a.key,t=await a.value;s.push({key:e,value:t})}return Pa.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const a of t){const{key:t,value:r}=a;if("aborted"===t.status)return Aa;if("aborted"===r.status)return Aa;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"===t.value||void 0===r.value&&!a.alwaysSet||(s[t.value]=r.value)}return{status:e.value,value:s}}}const Aa=Object.freeze({status:"aborted"}),Ra=e=>({status:"dirty",value:e}),Ta=e=>({status:"valid",value:e}),Ea=e=>"aborted"===e.status,Oa=e=>"dirty"===e.status,Ia=e=>"valid"===e.status,Ma=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Fa,$a;($a=Fa||(Fa={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},$a.toString=e=>"string"==typeof e?e:e?.message;class La{constructor(e,t,s,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const qa=(e,t)=>{if(Ia(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ka(e.common.issues);return this._error=t,this._error}}};function Ua(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:a,description:r}=e;if(t&&(s||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:r};return{errorMap:(t,r)=>{const{message:n}=e;return"invalid_enum_value"===t.code?{message:n??r.defaultError}:void 0===r.data?{message:n??a??r.defaultError}:"invalid_type"!==t.code?{message:r.defaultError}:{message:n??s??r.defaultError}},description:r}}class Da{get description(){return this._def.description}_getType(e){return wa(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:wa(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Pa,ctx:{common:e.parent.common,data:e.data,parsedType:wa(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ma(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){const s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wa(e)},a=this._parseSync({data:e,path:s.path,parent:s});return qa(s,a)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wa(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return Ia(s)?{value:s.value}:{issues:t.common.issues}}catch(Jl){Jl?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>Ia(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wa(e)},a=this._parse({data:e,path:s.path,parent:s}),r=await(Ma(a)?a:Promise.resolve(a));return qa(s,r)}refine(e,t){const s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{const r=e(t),n=()=>a.addIssue({code:Na.custom,...s(t)});return"undefined"!=typeof Promise&&r instanceof Promise?r.then(e=>!!e||(n(),!1)):!!r||(n(),!1)})}refinement(e,t){return this._refinement((s,a)=>!!e(s)||(a.addIssue("function"==typeof t?t(s,a):t),!1))}_refinement(e){return new qr({schema:this,typeName:Kr.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ur.create(this,this._def)}nullable(){return Dr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return kr.create(this)}promise(){return Lr.create(this,this._def)}or(e){return Cr.create([this,e],this._def)}and(e){return Ar.create(this,e,this._def)}transform(e){return new qr({...Ua(this._def),schema:this,typeName:Kr.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Wr({...Ua(this._def),innerType:this,defaultValue:t,typeName:Kr.ZodDefault})}brand(){return new Hr({typeName:Kr.ZodBranded,type:this,...Ua(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Br({...Ua(this._def),innerType:this,catchValue:t,typeName:Kr.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Zr.create(this,e)}readonly(){return Gr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Wa=/^c[^\s-]{8,}$/i,Ba=/^[0-9a-z]+$/,za=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ha=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Za=/^[a-z0-9_-]{21}$/i,Ga=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ka=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ya=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let Va;const Ja=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Qa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Xa=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,er=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,tr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,sr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ar="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",rr=new RegExp(`^${ar}$`);function nr(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function ir(e){return new RegExp(`^${nr(e)}$`)}function or(e){let t=`${ar}T${nr(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}function lr(e,t){return!("v4"!==t&&t||!Ja.test(e))||!("v6"!==t&&t||!Xa.test(e))}function cr(e,t){if(!Ga.test(e))return!1;try{const[s]=e.split(".");if(!s)return!1;const a=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),r=JSON.parse(atob(a));return"object"==typeof r&&null!==r&&((!("typ"in r)||"JWT"===r?.typ)&&(!!r.alg&&(!t||r.alg===t)))}catch{return!1}}function dr(e,t){return!("v4"!==t&&t||!Qa.test(e))||!("v6"!==t&&t||!er.test(e))}class ur extends Da{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==ja.string){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.string,received:t.parsedType}),Aa}const t=new Pa;let s;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const r=e.data.length>a.value,n=e.data.length<a.value;(r||n)&&(s=this._getOrReturnCtx(e,s),r?Ca(s,{code:Na.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):n&&Ca(s,{code:Na.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)Ya.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"email",code:Na.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)Va||(Va=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Va.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"emoji",code:Na.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)Ha.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"uuid",code:Na.invalid_string,message:a.message}),t.dirty());else if("nanoid"===a.kind)Za.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"nanoid",code:Na.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)Wa.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"cuid",code:Na.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)Ba.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"cuid2",code:Na.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)za.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"ulid",code:Na.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),Ca(s,{validation:"url",code:Na.invalid_string,message:a.message}),t.dirty()}else if("regex"===a.kind){a.regex.lastIndex=0;a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"regex",code:Na.invalid_string,message:a.message}),t.dirty())}else if("trim"===a.kind)e.data=e.data.trim();else if("includes"===a.kind)e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty());else if("toLowerCase"===a.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===a.kind)e.data=e.data.toUpperCase();else if("startsWith"===a.kind)e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty());else if("endsWith"===a.kind)e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty());else if("datetime"===a.kind){or(a).test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.invalid_string,validation:"datetime",message:a.message}),t.dirty())}else if("date"===a.kind){rr.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.invalid_string,validation:"date",message:a.message}),t.dirty())}else if("time"===a.kind){ir(a).test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.invalid_string,validation:"time",message:a.message}),t.dirty())}else"duration"===a.kind?Ka.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"duration",code:Na.invalid_string,message:a.message}),t.dirty()):"ip"===a.kind?lr(e.data,a.version)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"ip",code:Na.invalid_string,message:a.message}),t.dirty()):"jwt"===a.kind?cr(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"jwt",code:Na.invalid_string,message:a.message}),t.dirty()):"cidr"===a.kind?dr(e.data,a.version)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"cidr",code:Na.invalid_string,message:a.message}),t.dirty()):"base64"===a.kind?tr.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"base64",code:Na.invalid_string,message:a.message}),t.dirty()):"base64url"===a.kind?sr.test(e.data)||(s=this._getOrReturnCtx(e,s),Ca(s,{validation:"base64url",code:Na.invalid_string,message:a.message}),t.dirty()):fa.assertNever(a);return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement(t=>e.test(t),{validation:t,code:Na.invalid_string,...Fa.errToObj(s)})}_addCheck(e){return new ur({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Fa.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Fa.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Fa.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Fa.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Fa.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Fa.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Fa.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Fa.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Fa.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Fa.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Fa.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Fa.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Fa.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Fa.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...Fa.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Fa.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Fa.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Fa.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Fa.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Fa.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Fa.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Fa.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Fa.errToObj(t)})}nonempty(e){return this.min(1,Fa.errToObj(e))}trim(){return new ur({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ur({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ur({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function hr(e,t){const s=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,r=s>a?s:a;return Number.parseInt(e.toFixed(r).replace(".",""))%Number.parseInt(t.toFixed(r).replace(".",""))/10**r}ur.create=e=>new ur({checks:[],typeName:Kr.ZodString,coerce:e?.coerce??!1,...Ua(e)});class mr extends Da{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==ja.number){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.number,received:t.parsedType}),Aa}let t;const s=new Pa;for(const a of this._def.checks)if("int"===a.kind)fa.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty());else if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty())}else"multipleOf"===a.kind?0!==hr(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.not_finite,message:a.message}),s.dirty()):fa.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Fa.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Fa.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Fa.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Fa.toString(t))}setLimit(e,t,s,a){return new mr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Fa.toString(a)}]})}_addCheck(e){return new mr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Fa.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Fa.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Fa.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Fa.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Fa.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Fa.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Fa.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Fa.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Fa.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&fa.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}mr.create=e=>new mr({checks:[],typeName:Kr.ZodNumber,coerce:e?.coerce||!1,...Ua(e)});class pr extends Da{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ja.bigint)return this._getInvalidInput(e);let t;const s=new Pa;for(const a of this._def.checks)if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty())}else"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Ca(t,{code:Na.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):fa.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.bigint,received:t.parsedType}),Aa}gte(e,t){return this.setLimit("min",e,!0,Fa.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Fa.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Fa.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Fa.toString(t))}setLimit(e,t,s,a){return new pr({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Fa.toString(a)}]})}_addCheck(e){return new pr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Fa.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Fa.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Fa.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Fa.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Fa.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}pr.create=e=>new pr({checks:[],typeName:Kr.ZodBigInt,coerce:e?.coerce??!1,...Ua(e)});class yr extends Da{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==ja.boolean){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.boolean,received:t.parsedType}),Aa}return Ta(e.data)}}yr.create=e=>new yr({typeName:Kr.ZodBoolean,coerce:e?.coerce||!1,...Ua(e)});class gr extends Da{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==ja.date){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.date,received:t.parsedType}),Aa}if(Number.isNaN(e.data.getTime())){return Ca(this._getOrReturnCtx(e),{code:Na.invalid_date}),Aa}const t=new Pa;let s;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),Ca(s,{code:Na.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):fa.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new gr({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Fa.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Fa.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}gr.create=e=>new gr({checks:[],coerce:e?.coerce||!1,typeName:Kr.ZodDate,...Ua(e)});class xr extends Da{_parse(e){if(this._getType(e)!==ja.symbol){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.symbol,received:t.parsedType}),Aa}return Ta(e.data)}}xr.create=e=>new xr({typeName:Kr.ZodSymbol,...Ua(e)});class fr extends Da{_parse(e){if(this._getType(e)!==ja.undefined){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.undefined,received:t.parsedType}),Aa}return Ta(e.data)}}fr.create=e=>new fr({typeName:Kr.ZodUndefined,...Ua(e)});class br extends Da{_parse(e){if(this._getType(e)!==ja.null){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.null,received:t.parsedType}),Aa}return Ta(e.data)}}br.create=e=>new br({typeName:Kr.ZodNull,...Ua(e)});class vr extends Da{constructor(){super(...arguments),this._any=!0}_parse(e){return Ta(e.data)}}vr.create=e=>new vr({typeName:Kr.ZodAny,...Ua(e)});class jr extends Da{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ta(e.data)}}jr.create=e=>new jr({typeName:Kr.ZodUnknown,...Ua(e)});class wr extends Da{_parse(e){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.never,received:t.parsedType}),Aa}}wr.create=e=>new wr({typeName:Kr.ZodNever,...Ua(e)});class Nr extends Da{_parse(e){if(this._getType(e)!==ja.undefined){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.void,received:t.parsedType}),Aa}return Ta(e.data)}}Nr.create=e=>new Nr({typeName:Kr.ZodVoid,...Ua(e)});class kr extends Da{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),a=this._def;if(t.parsedType!==ja.array)return Ca(t,{code:Na.invalid_type,expected:ja.array,received:t.parsedType}),Aa;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,r=t.data.length<a.exactLength.value;(e||r)&&(Ca(t,{code:e?Na.too_big:Na.too_small,minimum:r?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),s.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(Ca(t,{code:Na.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),s.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(Ca(t,{code:Na.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((e,s)=>a.type._parseAsync(new La(t,e,t.path,s)))).then(e=>Pa.mergeArray(s,e));const r=[...t.data].map((e,s)=>a.type._parseSync(new La(t,e,t.path,s)));return Pa.mergeArray(s,r)}get element(){return this._def.type}min(e,t){return new kr({...this._def,minLength:{value:e,message:Fa.toString(t)}})}max(e,t){return new kr({...this._def,maxLength:{value:e,message:Fa.toString(t)}})}length(e,t){return new kr({...this._def,exactLength:{value:e,message:Fa.toString(t)}})}nonempty(e){return this.min(1,e)}}function Sr(e){if(e instanceof _r){const t={};for(const s in e.shape){const a=e.shape[s];t[s]=Ur.create(Sr(a))}return new _r({...e._def,shape:()=>t})}return e instanceof kr?new kr({...e._def,type:Sr(e.element)}):e instanceof Ur?Ur.create(Sr(e.unwrap())):e instanceof Dr?Dr.create(Sr(e.unwrap())):e instanceof Rr?Rr.create(e.items.map(e=>Sr(e))):e}kr.create=(e,t)=>new kr({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Kr.ZodArray,...Ua(t)});class _r extends Da{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=fa.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==ja.object){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.object,received:t.parsedType}),Aa}const{status:t,ctx:s}=this._processInputParams(e),{shape:a,keys:r}=this._getCached(),n=[];if(!(this._def.catchall instanceof wr&&"strip"===this._def.unknownKeys))for(const o in s.data)r.includes(o)||n.push(o);const i=[];for(const o of r){const e=a[o],t=s.data[o];i.push({key:{status:"valid",value:o},value:e._parse(new La(s,t,s.path,o)),alwaysSet:o in s.data})}if(this._def.catchall instanceof wr){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of n)i.push({key:{status:"valid",value:t},value:{status:"valid",value:s.data[t]}});else if("strict"===e)n.length>0&&(Ca(s,{code:Na.unrecognized_keys,keys:n}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of n){const a=s.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new La(s,a,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of i){const s=await t.key,a=await t.value;e.push({key:s,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>Pa.mergeObjectSync(t,e)):Pa.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Fa.errToObj,new _r({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{const a=this._def.errorMap?.(t,s).message??s.defaultError;return"unrecognized_keys"===t.code?{message:Fa.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new _r({...this._def,unknownKeys:"strip"})}passthrough(){return new _r({...this._def,unknownKeys:"passthrough"})}extend(e){return new _r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new _r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Kr.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new _r({...this._def,catchall:e})}pick(e){const t={};for(const s of fa.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new _r({...this._def,shape:()=>t})}omit(e){const t={};for(const s of fa.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new _r({...this._def,shape:()=>t})}deepPartial(){return Sr(this)}partial(e){const t={};for(const s of fa.objectKeys(this.shape)){const a=this.shape[s];e&&!e[s]?t[s]=a:t[s]=a.optional()}return new _r({...this._def,shape:()=>t})}required(e){const t={};for(const s of fa.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof Ur;)e=e._def.innerType;t[s]=e}return new _r({...this._def,shape:()=>t})}keyof(){return Mr(fa.objectKeys(this.shape))}}_r.create=(e,t)=>new _r({shape:()=>e,unknownKeys:"strip",catchall:wr.create(),typeName:Kr.ZodObject,...Ua(t)}),_r.strictCreate=(e,t)=>new _r({shape:()=>e,unknownKeys:"strict",catchall:wr.create(),typeName:Kr.ZodObject,...Ua(t)}),_r.lazycreate=(e,t)=>new _r({shape:e,unknownKeys:"strip",catchall:wr.create(),typeName:Kr.ZodObject,...Ua(t)});class Cr extends Da{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map(async e=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const a of e)if("dirty"===a.result.status)return t.common.issues.push(...a.ctx.common.issues),a.result;const s=e.map(e=>new ka(e.ctx.common.issues));return Ca(t,{code:Na.invalid_union,unionErrors:s}),Aa});{let e;const a=[];for(const n of s){const s={...t,common:{...t.common,issues:[]},parent:null},r=n._parseSync({data:t.data,path:t.path,parent:s});if("valid"===r.status)return r;"dirty"!==r.status||e||(e={result:r,ctx:s}),s.common.issues.length&&a.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const r=a.map(e=>new ka(e));return Ca(t,{code:Na.invalid_union,unionErrors:r}),Aa}}get options(){return this._def.options}}function Pr(e,t){const s=wa(e),a=wa(t);if(e===t)return{valid:!0,data:e};if(s===ja.object&&a===ja.object){const s=fa.objectKeys(t),a=fa.objectKeys(e).filter(e=>-1!==s.indexOf(e)),r={...e,...t};for(const n of a){const s=Pr(e[n],t[n]);if(!s.valid)return{valid:!1};r[n]=s.data}return{valid:!0,data:r}}if(s===ja.array&&a===ja.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let a=0;a<e.length;a++){const r=Pr(e[a],t[a]);if(!r.valid)return{valid:!1};s.push(r.data)}return{valid:!0,data:s}}return s===ja.date&&a===ja.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}Cr.create=(e,t)=>new Cr({options:e,typeName:Kr.ZodUnion,...Ua(t)});class Ar extends Da{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),a=(e,a)=>{if(Ea(e)||Ea(a))return Aa;const r=Pr(e.value,a.value);return r.valid?((Oa(e)||Oa(a))&&t.dirty(),{status:t.value,value:r.data}):(Ca(s,{code:Na.invalid_intersection_types}),Aa)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Ar.create=(e,t,s)=>new Ar({left:e,right:t,typeName:Kr.ZodIntersection,...Ua(s)});class Rr extends Da{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ja.array)return Ca(s,{code:Na.invalid_type,expected:ja.array,received:s.parsedType}),Aa;if(s.data.length<this._def.items.length)return Ca(s,{code:Na.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Aa;!this._def.rest&&s.data.length>this._def.items.length&&(Ca(s,{code:Na.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new La(s,e,s.path,t)):null}).filter(e=>!!e);return s.common.async?Promise.all(a).then(e=>Pa.mergeArray(t,e)):Pa.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Rr({...this._def,rest:e})}}Rr.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Rr({items:e,typeName:Kr.ZodTuple,rest:null,...Ua(t)})};class Tr extends Da{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ja.map)return Ca(s,{code:Na.invalid_type,expected:ja.map,received:s.parsedType}),Aa;const a=this._def.keyType,r=this._def.valueType,n=[...s.data.entries()].map(([e,t],n)=>({key:a._parse(new La(s,e,s.path,[n,"key"])),value:r._parse(new La(s,t,s.path,[n,"value"]))}));if(s.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const s of n){const a=await s.key,r=await s.value;if("aborted"===a.status||"aborted"===r.status)return Aa;"dirty"!==a.status&&"dirty"!==r.status||t.dirty(),e.set(a.value,r.value)}return{status:t.value,value:e}})}{const e=new Map;for(const s of n){const a=s.key,r=s.value;if("aborted"===a.status||"aborted"===r.status)return Aa;"dirty"!==a.status&&"dirty"!==r.status||t.dirty(),e.set(a.value,r.value)}return{status:t.value,value:e}}}}Tr.create=(e,t,s)=>new Tr({valueType:t,keyType:e,typeName:Kr.ZodMap,...Ua(s)});class Er extends Da{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ja.set)return Ca(s,{code:Na.invalid_type,expected:ja.set,received:s.parsedType}),Aa;const a=this._def;null!==a.minSize&&s.data.size<a.minSize.value&&(Ca(s,{code:Na.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&s.data.size>a.maxSize.value&&(Ca(s,{code:Na.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const r=this._def.valueType;function n(e){const s=new Set;for(const a of e){if("aborted"===a.status)return Aa;"dirty"===a.status&&t.dirty(),s.add(a.value)}return{status:t.value,value:s}}const i=[...s.data.values()].map((e,t)=>r._parse(new La(s,e,s.path,t)));return s.common.async?Promise.all(i).then(e=>n(e)):n(i)}min(e,t){return new Er({...this._def,minSize:{value:e,message:Fa.toString(t)}})}max(e,t){return new Er({...this._def,maxSize:{value:e,message:Fa.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Er.create=(e,t)=>new Er({valueType:e,minSize:null,maxSize:null,typeName:Kr.ZodSet,...Ua(t)});class Or extends Da{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Or.create=(e,t)=>new Or({getter:e,typeName:Kr.ZodLazy,...Ua(t)});class Ir extends Da{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Ca(t,{received:t.data,code:Na.invalid_literal,expected:this._def.value}),Aa}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Mr(e,t){return new Fr({values:e,typeName:Kr.ZodEnum,...Ua(t)})}Ir.create=(e,t)=>new Ir({value:e,typeName:Kr.ZodLiteral,...Ua(t)});class Fr extends Da{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return Ca(t,{expected:fa.joinValues(s),received:t.parsedType,code:Na.invalid_type}),Aa}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return Ca(t,{received:t.data,code:Na.invalid_enum_value,options:s}),Aa}return Ta(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Fr.create(e,{...this._def,...t})}exclude(e,t=this._def){return Fr.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}Fr.create=Mr;class $r extends Da{_parse(e){const t=fa.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==ja.string&&s.parsedType!==ja.number){const e=fa.objectValues(t);return Ca(s,{expected:fa.joinValues(e),received:s.parsedType,code:Na.invalid_type}),Aa}if(this._cache||(this._cache=new Set(fa.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=fa.objectValues(t);return Ca(s,{received:s.data,code:Na.invalid_enum_value,options:e}),Aa}return Ta(e.data)}get enum(){return this._def.values}}$r.create=(e,t)=>new $r({values:e,typeName:Kr.ZodNativeEnum,...Ua(t)});class Lr extends Da{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ja.promise&&!1===t.common.async)return Ca(t,{code:Na.invalid_type,expected:ja.promise,received:t.parsedType}),Aa;const s=t.parsedType===ja.promise?t.data:Promise.resolve(t.data);return Ta(s.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Lr.create=(e,t)=>new Lr({type:e,typeName:Kr.ZodPromise,...Ua(t)});class qr extends Da{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Kr.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),a=this._def.effect||null,r={addIssue:e=>{Ca(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(r.addIssue=r.addIssue.bind(r),"preprocess"===a.type){const e=a.transform(s.data,r);if(s.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return Aa;const a=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===a.status?Aa:"dirty"===a.status||"dirty"===t.value?Ra(a.value):a});{if("aborted"===t.value)return Aa;const a=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===a.status?Aa:"dirty"===a.status||"dirty"===t.value?Ra(a.value):a}}if("refinement"===a.type){const e=e=>{const t=a.refinement(e,r);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===a.status?Aa:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(s=>"aborted"===s.status?Aa:("dirty"===s.status&&t.dirty(),e(s.value).then(()=>({status:t.value,value:s.value}))))}if("transform"===a.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Ia(e))return Aa;const n=a.transform(e.value,r);if(n instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(e=>Ia(e)?Promise.resolve(a.transform(e.value,r)).then(e=>({status:t.value,value:e})):Aa)}fa.assertNever(a)}}qr.create=(e,t,s)=>new qr({schema:e,typeName:Kr.ZodEffects,effect:t,...Ua(s)}),qr.createWithPreprocess=(e,t,s)=>new qr({schema:t,effect:{type:"preprocess",transform:e},typeName:Kr.ZodEffects,...Ua(s)});class Ur extends Da{_parse(e){return this._getType(e)===ja.undefined?Ta(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ur.create=(e,t)=>new Ur({innerType:e,typeName:Kr.ZodOptional,...Ua(t)});class Dr extends Da{_parse(e){return this._getType(e)===ja.null?Ta(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Dr.create=(e,t)=>new Dr({innerType:e,typeName:Kr.ZodNullable,...Ua(t)});class Wr extends Da{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===ja.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Wr.create=(e,t)=>new Wr({innerType:e,typeName:Kr.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Ua(t)});class Br extends Da{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Ma(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ka(s.common.issues)},input:s.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new ka(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Br.create=(e,t)=>new Br({innerType:e,typeName:Kr.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Ua(t)});class zr extends Da{_parse(e){if(this._getType(e)!==ja.nan){const t=this._getOrReturnCtx(e);return Ca(t,{code:Na.invalid_type,expected:ja.nan,received:t.parsedType}),Aa}return{status:"valid",value:e.data}}}zr.create=e=>new zr({typeName:Kr.ZodNaN,...Ua(e)});class Hr extends Da{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Zr extends Da{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Aa:"dirty"===e.status?(t.dirty(),Ra(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})()}{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Aa:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new Zr({in:e,out:t,typeName:Kr.ZodPipeline})}}class Gr extends Da{_parse(e){const t=this._def.innerType._parse(e),s=e=>(Ia(e)&&(e.value=Object.freeze(e.value)),e);return Ma(t)?t.then(e=>s(e)):s(t)}unwrap(){return this._def.innerType}}var Kr,Yr;Gr.create=(e,t)=>new Gr({innerType:e,typeName:Kr.ZodReadonly,...Ua(t)}),(Yr=Kr||(Kr={})).ZodString="ZodString",Yr.ZodNumber="ZodNumber",Yr.ZodNaN="ZodNaN",Yr.ZodBigInt="ZodBigInt",Yr.ZodBoolean="ZodBoolean",Yr.ZodDate="ZodDate",Yr.ZodSymbol="ZodSymbol",Yr.ZodUndefined="ZodUndefined",Yr.ZodNull="ZodNull",Yr.ZodAny="ZodAny",Yr.ZodUnknown="ZodUnknown",Yr.ZodNever="ZodNever",Yr.ZodVoid="ZodVoid",Yr.ZodArray="ZodArray",Yr.ZodObject="ZodObject",Yr.ZodUnion="ZodUnion",Yr.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Yr.ZodIntersection="ZodIntersection",Yr.ZodTuple="ZodTuple",Yr.ZodRecord="ZodRecord",Yr.ZodMap="ZodMap",Yr.ZodSet="ZodSet",Yr.ZodFunction="ZodFunction",Yr.ZodLazy="ZodLazy",Yr.ZodLiteral="ZodLiteral",Yr.ZodEnum="ZodEnum",Yr.ZodEffects="ZodEffects",Yr.ZodNativeEnum="ZodNativeEnum",Yr.ZodOptional="ZodOptional",Yr.ZodNullable="ZodNullable",Yr.ZodDefault="ZodDefault",Yr.ZodCatch="ZodCatch",Yr.ZodPromise="ZodPromise",Yr.ZodBranded="ZodBranded",Yr.ZodPipeline="ZodPipeline",Yr.ZodReadonly="ZodReadonly";const Vr=ur.create,Jr=mr.create,Qr=vr.create,Xr=jr.create;wr.create;const en=kr.create,tn=_r.create;Cr.create,Ar.create,Rr.create;const sn=Fr.create;Lr.create,Ur.create,Dr.create,tn({email:Vr().email("Invalid email format"),password:Vr().min(6,"Password must be at least 6 characters")}),tn({email:Vr().email("Invalid email format"),username:Vr().min(3,"Username must be at least 3 characters").max(20,"Username must be less than 20 characters").regex(/^[a-zA-Z0-9_]+$/,"Username can only contain letters, numbers, and underscores"),password:Vr().min(6,"Password must be at least 6 characters").max(100,"Password must be less than 100 characters")});const an=tn({x:Jr().int().min(0),y:Jr().int().min(0)});tn({name:Vr().min(3,"Empire name must be at least 3 characters").max(30,"Empire name must be less than 30 characters").regex(/^[a-zA-Z0-9\s]+$/,"Empire name can only contain letters, numbers, and spaces")}),tn({name:Vr().min(3,"Empire name must be at least 3 characters").max(30,"Empire name must be less than 30 characters").regex(/^[a-zA-Z0-9\s]+$/,"Empire name can only contain letters, numbers, and spaces").optional()}),tn({name:Vr().min(3,"Fleet name must be at least 3 characters").max(20,"Fleet name must be less than 20 characters"),systemId:Vr().min(1,"System ID is required")}),tn({fleetId:Vr().min(1,"Fleet ID is required"),destination:an}),tn({type:Vr().min(1,"Action type is required"),payload:Qr(),empireId:Vr().min(1,"Empire ID is required")}),tn({maxPlayers:Jr().int().min(2).max(1e3),gameSpeed:Jr().min(.1).max(10),startingResources:tn({credits:Jr().int().min(0),minerals:Jr().int().min(0),energy:Jr().int().min(0)})});const rn=tn({name:Vr().min(1).max(50),type:sn(["terrestrial","gas_giant","ice","desert","volcanic"]),size:sn(["small","medium","large"]),population:Jr().int().min(0),infrastructure:tn({mines:Jr().int().min(0),factories:Jr().int().min(0),research_labs:Jr().int().min(0),defense_stations:Jr().int().min(0)}),resources:tn({minerals:Jr().int().min(0),energy:Jr().int().min(0)})});tn({name:Vr().min(1).max(50),coordinates:an,planets:en(rn),owner:Vr().optional(),resources:tn({minerals:Jr().int().min(0),energy:Jr().int().min(0)}),defenseLevel:Jr().int().min(0)}),tn({type:sn(["scout","fighter","cruiser","battleship","transport"]),health:Jr().int().min(0),maxHealth:Jr().int().min(1),attack:Jr().int().min(0),defense:Jr().int().min(0),speed:Jr().min(0),cargo:tn({minerals:Jr().int().min(0),energy:Jr().int().min(0),capacity:Jr().int().min(0)}).optional()}),tn({data:Xr(),version:Vr().optional(),contentHash:Vr().optional()}),tn({technologies:Xr().optional(),buildings:Xr().optional(),defenses:Xr().optional(),units:Xr().optional()}),tn({user:tn({_id:Qr(),username:Vr(),email:Vr().email()}).passthrough(),empire:Qr(),profile:tn({economyPerHour:Jr(),fleetScore:Jr(),technologyScore:Jr(),level:Jr()}).passthrough()}).passthrough(),tn({userId:Vr(),deviceId:Vr(),data:Xr(),schemaVersion:Jr().int().min(1).optional()}),tn({catalogs:Vr().optional(),profile:Vr().optional(),timestamp:Vr().optional()}).optional();const nn=(e,t=0)=>{let s=0;const a=e+t.toString();for(let r=0;r<a.length;r++){s=(s<<5)-s+a.charCodeAt(r),s&=s}return Math.abs(s)},on={energy:{key:"energy",name:"Energy",description:"Increases all bases energy output by 5%.",creditsCost:2,requiredLabs:1,prerequisites:[]},computer:{key:"computer",name:"Computer",description:"Allows one campaign fleet per level.",creditsCost:2,requiredLabs:1,prerequisites:[]},armour:{key:"armour",name:"Armour",description:"Increases units and defenses armour by 5%.",creditsCost:4,requiredLabs:2,prerequisites:[]},laser:{key:"laser",name:"Laser",description:"Increases laser weapons power by 5%.",creditsCost:4,requiredLabs:2,prerequisites:[{key:"energy",level:2}]},missiles:{key:"missiles",name:"Missiles",description:"Increases missile weapons power by 5%.",creditsCost:8,requiredLabs:4,prerequisites:[{key:"computer",level:4}]},stellar_drive:{key:"stellar_drive",name:"Stellar Drive",description:"Increases stellar units speed by 5%.",creditsCost:16,requiredLabs:5,prerequisites:[{key:"energy",level:6}]},plasma:{key:"plasma",name:"Plasma",description:"Increases plasma weapons power by 5%.",creditsCost:32,requiredLabs:6,prerequisites:[{key:"energy",level:6},{key:"laser",level:4}]},warp_drive:{key:"warp_drive",name:"Warp Drive",description:"Increases warp units speed by 5%.",creditsCost:64,requiredLabs:8,prerequisites:[{key:"energy",level:8},{key:"stellar_drive",level:4}]},shielding:{key:"shielding",name:"Shielding",description:"Increases units and defenses shield by 5%.",creditsCost:128,requiredLabs:10,prerequisites:[{key:"energy",level:10}]},ion:{key:"ion",name:"Ion",description:"Increases ion weapons power by 5%.",creditsCost:256,requiredLabs:12,prerequisites:[{key:"energy",level:12},{key:"laser",level:10}]},stealth:{key:"stealth",name:"Stealth",description:"Decreases the time your own fleets can be detected before they arrive.",creditsCost:512,requiredLabs:14,prerequisites:[{key:"energy",level:14}]},photon:{key:"photon",name:"Photon",description:"Increases photon weapons power by 5%.",creditsCost:1024,requiredLabs:16,prerequisites:[{key:"energy",level:16},{key:"plasma",level:8}]},artificial_intelligence:{key:"artificial_intelligence",name:"Artificial Intelligence",description:"Increases all bases research output by 5%.",creditsCost:2048,requiredLabs:18,prerequisites:[{key:"computer",level:20}]},disruptor:{key:"disruptor",name:"Disruptor",description:"Increases disruptor weapons power by 5%.",creditsCost:4096,requiredLabs:20,prerequisites:[{key:"energy",level:20},{key:"laser",level:18}]},cybernetics:{key:"cybernetics",name:"Cybernetics",description:"Increases all bases construction and production by 5%.",creditsCost:8192,requiredLabs:22,prerequisites:[{key:"artificial_intelligence",level:6}]},tachyon_communications:{key:"tachyon_communications",name:"Tachyon Communications",description:"Allows 1 research link between 2 bases (min labs 20).",creditsCost:32768,requiredLabs:24,prerequisites:[{key:"energy",level:24},{key:"computer",level:24}]},anti_gravity:{key:"anti_gravity",name:"Anti-Gravity",description:"Decreases orbital structures construction time by 5% and increases Death Star speed by 5%.",creditsCost:1e5,requiredLabs:26,prerequisites:[{key:"energy",level:26},{key:"computer",level:26}]}};function ln(e){return on[e]}function cn(e,t){const s="string"==typeof e?ln(e):e,a=Math.max(0,Number(s.creditsCost||0)),r=Math.max(1,Math.floor(t||1));if(r<=1)return a;let n=a;for(let i=2;i<=r;i++)n=Math.round(1.5*n);return Math.max(1,n)}const dn={urban_structures:{key:"urban_structures",name:"Urban Structures",creditsCost:1,energyDelta:0,economy:0,populationRequired:0,areaRequired:1,techPrereqs:[],mappedType:"habitat"},solar_plants:{key:"solar_plants",name:"Solar Plants",creditsCost:1,energyDelta:1,economy:0,populationRequired:1,areaRequired:1,techPrereqs:[],mappedType:"energy_plant"},gas_plants:{key:"gas_plants",name:"Gas Plants",creditsCost:1,energyDelta:1,economy:0,populationRequired:1,areaRequired:1,techPrereqs:[],mappedType:"energy_plant"},fusion_plants:{key:"fusion_plants",name:"Fusion Plants",creditsCost:20,energyDelta:4,economy:0,populationRequired:1,areaRequired:1,techPrereqs:[{key:"energy",level:6}],mappedType:"energy_plant"},antimatter_plants:{key:"antimatter_plants",name:"Antimatter Plants",creditsCost:2e3,energyDelta:10,economy:0,populationRequired:1,areaRequired:1,advanced:!0,techPrereqs:[{key:"energy",level:20}],mappedType:"energy_plant"},orbital_plants:{key:"orbital_plants",name:"Orbital Plants",creditsCost:4e4,energyDelta:12,economy:0,populationRequired:1,areaRequired:0,advanced:!0,techPrereqs:[{key:"energy",level:25}],mappedType:"energy_plant"},research_labs:{key:"research_labs",name:"Research Labs",creditsCost:2,energyDelta:-1,economy:0,populationRequired:1,areaRequired:1,techPrereqs:[],mappedType:"research_lab"},metal_refineries:{key:"metal_refineries",name:"Metal Refineries",creditsCost:1,energyDelta:-1,economy:1,populationRequired:1,areaRequired:1,techPrereqs:[],mappedType:"factory"},crystal_mines:{key:"crystal_mines",name:"Crystal Mines",creditsCost:2,energyDelta:-1,economy:0,populationRequired:1,areaRequired:1,techPrereqs:[],mappedType:"habitat"},robotic_factories:{key:"robotic_factories",name:"Robotic Factories",creditsCost:5,energyDelta:-1,economy:1,populationRequired:1,areaRequired:1,techPrereqs:[{key:"computer",level:2}],mappedType:"factory"},command_centers:{key:"command_centers",name:"Command Centers",creditsCost:20,energyDelta:-1,economy:0,populationRequired:1,areaRequired:1,techPrereqs:[{key:"computer",level:6}],mappedType:"command_center"},shipyards:{key:"shipyards",name:"Shipyards",creditsCost:5,energyDelta:-1,economy:1,populationRequired:1,areaRequired:1,techPrereqs:[],mappedType:"shipyard"},orbital_shipyards:{key:"orbital_shipyards",name:"Orbital Shipyards",creditsCost:1e4,energyDelta:-12,economy:2,populationRequired:1,areaRequired:0,techPrereqs:[{key:"cybernetics",level:2}],mappedType:"shipyard"},spaceports:{key:"spaceports",name:"Spaceports",creditsCost:5,energyDelta:-1,economy:2,populationRequired:1,areaRequired:1,techPrereqs:[],mappedType:"habitat"},nanite_factories:{key:"nanite_factories",name:"Nanite Factories",creditsCost:80,energyDelta:-2,economy:2,populationRequired:1,areaRequired:1,techPrereqs:[{key:"computer",level:10},{key:"laser",level:8}],mappedType:"factory"},android_factories:{key:"android_factories",name:"Android Factories",creditsCost:1e3,energyDelta:-4,economy:2,populationRequired:1,areaRequired:1,techPrereqs:[{key:"artificial_intelligence",level:4}],mappedType:"factory"},economic_centers:{key:"economic_centers",name:"Economic Centers",creditsCost:80,energyDelta:-2,economy:3,populationRequired:1,areaRequired:1,techPrereqs:[{key:"computer",level:10}],mappedType:"habitat"},terraform:{key:"terraform",name:"Terraform",creditsCost:80,energyDelta:0,economy:0,populationRequired:0,areaRequired:1,techPrereqs:[{key:"computer",level:10},{key:"energy",level:10}],mappedType:"habitat"},multi_level_platforms:{key:"multi_level_platforms",name:"Multi-Level Platforms",creditsCost:1e4,energyDelta:0,economy:0,populationRequired:0,advanced:!0,techPrereqs:[{key:"armour",level:22}],mappedType:"habitat"},orbital_base:{key:"orbital_base",name:"Orbital Base",creditsCost:2e3,energyDelta:0,economy:0,populationRequired:0,advanced:!0,techPrereqs:[{key:"computer",level:20}],mappedType:"habitat"},jump_gate:{key:"jump_gate",name:"Jump Gate",creditsCost:5e3,energyDelta:-12,economy:0,populationRequired:1,advanced:!0,techPrereqs:[{key:"warp_drive",level:12},{key:"energy",level:20}],mappedType:"defense_station"},biosphere_modification:{key:"biosphere_modification",name:"Biosphere Modification",creditsCost:2e4,energyDelta:-24,economy:0,populationRequired:1,advanced:!0,techPrereqs:[{key:"computer",level:24},{key:"energy",level:24}],mappedType:"habitat"},capital:{key:"capital",name:"Capital",creditsCost:15e3,energyDelta:-12,economy:10,populationRequired:1,advanced:!0,techPrereqs:[{key:"tachyon_communications",level:1}],mappedType:"command_center"}};function un(e){return dn[e]}const hn=function(){return Object.values(dn)},mn=(e,t)=>({metal:(e?.metal??0)+(t.metal??0),gas:(e?.gas??0)+(t.gas??0),crystals:(e?.crystals??0)+(t.crystals??0)}),pn={Arid:{metal:3,gas:3,crystals:0,fertility:5,areaPlanet:95,areaMoon:83},Asteroid:{metal:4,gas:2,crystals:2,fertility:4,areaMoon:65},Craters:{metal:4,gas:2,crystals:2,fertility:4,areaPlanet:85,areaMoon:75},Crystalline:{metal:3,gas:2,crystals:3,fertility:4,areaPlanet:80,areaMoon:71},Earthly:{metal:3,gas:3,crystals:0,fertility:6,areaPlanet:85,areaMoon:75},Gaia:{metal:3,gas:2,crystals:0,fertility:6,areaPlanet:90,areaMoon:79},Glacial:{metal:2,gas:4,crystals:0,fertility:5,areaPlanet:95,areaMoon:83},Magma:{metal:3,gas:5,crystals:0,fertility:5,areaPlanet:80,areaMoon:71},Metallic:{metal:4,gas:2,crystals:2,fertility:4,areaPlanet:85,areaMoon:75},Oceanic:{metal:2,gas:4,crystals:0,fertility:6,areaPlanet:80,areaMoon:71},Radioactive:{metal:3,gas:4,crystals:0,fertility:4,areaPlanet:90,areaMoon:79},Rocky:{metal:4,gas:2,crystals:0,fertility:5,areaPlanet:85,areaMoon:75},Toxic:{metal:3,gas:5,crystals:0,fertility:4,areaPlanet:90,areaMoon:79},Tundra:{metal:3,gas:3,crystals:0,fertility:5,areaPlanet:95,areaMoon:83},Volcanic:{metal:3,gas:5,crystals:0,fertility:5,areaPlanet:80,areaMoon:71}},yn=[5,4,3,2,1,0,0,0],gn=[-1,0,1,1,2,2,3,3],xn=e=>{const t=jn(e);return{solarEnergy:yn[t-1],fertility:gn[t-1]}},fn=[{kind:"YELLOW",weight:.35},{kind:"ORANGE",weight:.3},{kind:"WHITE",weight:.12},{kind:"BLUE",weight:.08},{kind:"RED_GIANT",weight:.06},{kind:"SUPER_GIANT",weight:.03},{kind:"WHITE_DWARF",weight:.04},{kind:"NEUTRON",weight:.02}],bn=(()=>{const e=[];let t=0;for(const a of fn)t+=a.weight,e.push(t);const s=e[e.length-1];if(Math.abs(s-1)>1e-6)for(let a=0;a<e.length;a++)e[a]=e[a]/s;return e})(),vn=(e,t=101)=>{const s=(e=>Math.abs(e%1e6)/1e6)(nn(e,t));for(let a=0;a<bn.length;a++)if(s<=bn[a])return fn[a].kind;return fn[fn.length-1].kind},jn=e=>Math.min(8,Math.max(1,Math.floor(e||1))),wn={barracks:{key:"barracks",name:"Barracks",creditsCost:5,energyDelta:-1,techPrereqs:[],mappedType:"defense_station",weapon:"laser",attack:4,armour:4,shield:0,areaRequired:1},laser_turrets:{key:"laser_turrets",name:"Laser Turrets",creditsCost:10,energyDelta:-1,techPrereqs:[{key:"laser",level:1}],mappedType:"defense_station",weapon:"laser",attack:8,armour:8,shield:0,areaRequired:1},missile_turrets:{key:"missile_turrets",name:"Missile Turrets",creditsCost:20,energyDelta:-1,techPrereqs:[{key:"missiles",level:1}],mappedType:"defense_station",weapon:"missiles",attack:16,armour:16,shield:0,areaRequired:1},plasma_turrets:{key:"plasma_turrets",name:"Plasma Turrets",creditsCost:100,energyDelta:-2,techPrereqs:[{key:"plasma",level:1},{key:"armour",level:6}],mappedType:"defense_station",weapon:"plasma",attack:24,armour:24,shield:0,areaRequired:1},ion_turrets:{key:"ion_turrets",name:"Ion Turrets",creditsCost:250,energyDelta:-3,techPrereqs:[{key:"ion",level:1},{key:"armour",level:10},{key:"shielding",level:2}],mappedType:"defense_station",weapon:"ion",attack:40,armour:40,shield:2,areaRequired:1},photon_turrets:{key:"photon_turrets",name:"Photon Turrets",creditsCost:1e3,energyDelta:-4,techPrereqs:[{key:"photon",level:1},{key:"armour",level:14},{key:"shielding",level:6}],mappedType:"defense_station",weapon:"photon",attack:80,armour:80,shield:6,areaRequired:1},disruptor_turrets:{key:"disruptor_turrets",name:"Disruptor Turrets",creditsCost:4e3,energyDelta:-8,techPrereqs:[{key:"disruptor",level:1},{key:"armour",level:18},{key:"shielding",level:8}],mappedType:"defense_station",weapon:"disruptor",attack:320,armour:320,shield:8,areaRequired:1},deflection_shields:{key:"deflection_shields",name:"Deflection Shields",creditsCost:4e3,energyDelta:-8,techPrereqs:[{key:"ion",level:6},{key:"shielding",level:10}],mappedType:"defense_station",weapon:"ion",attack:2,armour:640,shield:16,areaRequired:1},planetary_shield:{key:"planetary_shield",name:"Planetary Shield",creditsCost:25e3,energyDelta:-16,techPrereqs:[{key:"ion",level:10},{key:"shielding",level:14}],mappedType:"defense_station",weapon:"ion",attack:4,armour:2e3,shield:20,areaRequired:1},planetary_ring:{key:"planetary_ring",name:"Planetary Ring",creditsCost:5e4,energyDelta:-24,techPrereqs:[{key:"photon",level:10},{key:"armour",level:22},{key:"shielding",level:12}],mappedType:"defense_station",weapon:"photon",attack:1600,armour:1e3,shield:12,areaRequired:1}};const Nn={fighter:{key:"fighter",name:"Fighter",creditsCost:5,drive:"Inter",weapon:"laser",attack:2,armour:2,shield:0,hangar:-1,speed:0,requiredShipyardLevel:1,techPrereqs:[{key:"laser",level:1}],description:"Good fighting unit against unshielded units."},bomber:{key:"bomber",name:"Bomber",creditsCost:10,drive:"Inter",weapon:"missiles",attack:4,armour:2,shield:0,hangar:-1,speed:0,requiredShipyardLevel:2,techPrereqs:[{key:"missiles",level:1}],description:"Good fighting unit against unshielded and low shield units."},heavy_bomber:{key:"heavy_bomber",name:"Heavy Bomber",creditsCost:30,drive:"Inter",weapon:"plasma",attack:10,armour:4,shield:0,hangar:-2,speed:0,requiredShipyardLevel:3,techPrereqs:[{key:"plasma",level:14}],description:"Good fighting unit against medium shielded units."},ion_bomber:{key:"ion_bomber",name:"Ion Bomber",creditsCost:60,drive:"Inter",weapon:"ion",attack:12,armour:4,shield:1,hangar:-2,speed:3,techPrereqs:[{key:"ion",level:10},{key:"shielding",level:10}],description:"Good against high shielded units, 50% power cross shields."},corvette:{key:"corvette",name:"Corvette",creditsCost:20,drive:"Stellar",weapon:"laser",attack:4,armour:4,shield:0,hangar:0,speed:10,requiredShipyardLevel:4,techPrereqs:[{key:"laser",level:2},{key:"stellar_drive",level:1},{key:"armour",level:2}],description:"Very fast unit, good against unshielded units."},recycler:{key:"recycler",name:"Recycler",creditsCost:30,drive:"Stellar*",weapon:"laser",attack:2,armour:2,shield:0,hangar:0,speed:8,requiredShipyardLevel:5,techPrereqs:[{key:"laser",level:1},{key:"stellar_drive",level:1},{key:"armour",level:2}],description:"Can collect debris and convert them into credits."},destroyer:{key:"destroyer",name:"Destroyer",creditsCost:40,drive:"Stellar",weapon:"plasma",attack:8,armour:8,shield:0,hangar:0,speed:8,requiredShipyardLevel:6,techPrereqs:[{key:"plasma",level:1},{key:"stellar_drive",level:2},{key:"armour",level:6}],description:"Fast unit, good against low shielded units."},frigate:{key:"frigate",name:"Frigate",creditsCost:80,drive:"Stellar",weapon:"missiles",attack:12,armour:12,shield:0,hangar:4,speed:6,requiredShipyardLevel:8,techPrereqs:[{key:"missiles",level:6},{key:"stellar_drive",level:4},{key:"armour",level:8}],description:"Versatile unit, has 4 hangar space."},ion_frigate:{key:"ion_frigate",name:"Ion Frigate",creditsCost:120,drive:"Stellar",weapon:"ion",attack:14,armour:12,shield:1,hangar:4,speed:6,requiredShipyardLevel:8,techPrereqs:[{key:"ion",level:10},{key:"stellar_drive",level:4},{key:"armour",level:8},{key:"shielding",level:10}],description:"Versatile unit, 50% power cross shields."},scout_ship:{key:"scout_ship",name:"Scout Ship",creditsCost:40,drive:"Warp",weapon:"laser",attack:1,armour:2,shield:0,hangar:0,speed:12,requiredShipyardLevel:4,techPrereqs:[{key:"warp_drive",level:1}],description:"Faster ship, good for scouting."},outpost_ship:{key:"outpost_ship",name:"Outpost Ship",creditsCost:100,drive:"Warp",weapon:"laser",attack:2,armour:4,shield:0,hangar:0,speed:4,requiredShipyardLevel:8,techPrereqs:[{key:"warp_drive",level:1}],description:"Warp unit that can build a new base."},cruiser:{key:"cruiser",name:"Cruiser",creditsCost:200,drive:"Warp",weapon:"plasma",attack:24,armour:24,shield:2,hangar:4,speed:5,requiredShipyardLevel:10,techPrereqs:[{key:"plasma",level:4},{key:"warp_drive",level:2},{key:"armour",level:10},{key:"shielding",level:2}],description:"Versatile unit, good for long range action and escort."},carrier:{key:"carrier",name:"Carrier",creditsCost:400,drive:"Warp",weapon:"missiles",attack:12,armour:24,shield:2,hangar:80,speed:5,requiredShipyardLevel:12,techPrereqs:[{key:"missiles",level:6},{key:"warp_drive",level:4},{key:"armour",level:10},{key:"shielding",level:2}],description:"Unit with 80 hangar spaces."},heavy_cruiser:{key:"heavy_cruiser",name:"Heavy Cruiser",creditsCost:500,drive:"Warp",weapon:"plasma",attack:48,armour:48,shield:4,hangar:8,speed:4,requiredShipyardLevel:12,techPrereqs:[{key:"plasma",level:6},{key:"warp_drive",level:4},{key:"armour",level:12},{key:"shielding",level:4}],description:"Strong unit, good against large units."},battleship:{key:"battleship",name:"Battleship",creditsCost:2e3,drive:"Warp",weapon:"ion",attack:168,armour:128,shield:10,hangar:40,speed:4,requiredShipyardLevel:16,techPrereqs:[{key:"ion",level:6},{key:"warp_drive",level:8},{key:"armour",level:16},{key:"shielding",level:8}],description:"Strong unit, good against large units."},fleet_carrier:{key:"fleet_carrier",name:"Fleet Carrier",creditsCost:2500,drive:"Warp",weapon:"ion",attack:64,armour:96,shield:8,hangar:500,speed:4,requiredShipyardLevel:16,techPrereqs:[{key:"ion",level:4},{key:"warp_drive",level:8},{key:"armour",level:14},{key:"shielding",level:6}],description:"Large carrier with 500 hangar spaces."},dreadnought:{key:"dreadnought",name:"Dreadnought",creditsCost:1e4,drive:"Warp",weapon:"photon",attack:756,armour:512,shield:20,hangar:200,speed:3,requiredShipyardLevel:20,requiredOrbitalShipyardLevel:1,techPrereqs:[{key:"photon",level:6},{key:"warp_drive",level:12},{key:"armour",level:20},{key:"shielding",level:10}],description:"Very strong combat unit."},titan:{key:"titan",name:"Titan",creditsCost:5e4,drive:"Warp",weapon:"disruptor",attack:3500,armour:2048,shield:30,hangar:1e3,speed:3,requiredShipyardLevel:22,requiredOrbitalShipyardLevel:3,techPrereqs:[{key:"disruptor",level:6},{key:"warp_drive",level:14},{key:"armour",level:22},{key:"shielding",level:14}],description:"Very large and strong combat unit."},leviathan:{key:"leviathan",name:"Leviathan",creditsCost:2e5,drive:"Warp",weapon:"photon",attack:1e4,armour:6600,shield:40,hangar:4e3,speed:2,requiredShipyardLevel:24,requiredOrbitalShipyardLevel:5,techPrereqs:[{key:"photon",level:12},{key:"warp_drive",level:18},{key:"armour",level:24},{key:"shielding",level:16}],description:"Huge combat unit, gives +5% power and armour to fleet."},death_star:{key:"death_star",name:"Death Star",creditsCost:5e5,drive:"Warp",weapon:"disruptor",attack:26500,armour:14e3,shield:60,hangar:1e4,speed:2,requiredShipyardLevel:26,requiredOrbitalShipyardLevel:7,techPrereqs:[{key:"disruptor",level:10},{key:"warp_drive",level:20},{key:"armour",level:26},{key:"shielding",level:18}],description:"Biggest unit, canâ€™t use jump gates, gives +10% power and armour to fleet."}};const kn={urban_structures:[1,2,3,4,6,8,12,18,26,39,58,87,130,195,292,438,657,986,1478,2217],solar_plants:[1,2,3,4,6,8,12,18,26,39,58,87,130],gas_plants:[1,2,3,4,6,8,12,18,26,39,58,87,130,195],metal_refineries:[1,2,3,4,6,8,12,18,26,39,58,87,130,195,292,438,657,986,1478,2217,3326],fusion_plants:[20,30,45,68,102,152,228,342,513,769,1154,1730,2595,3893,5839,8758,13137,19706,29558],research_labs:[2,3,5,7,11,16,23,35,52,77,116,173,260,390,584,876,1314,1971,2956,4434,6651,9976,14944,22446,33669,50503,75754,113631,170446,255669],robotic_factories:[5,8,12,17,26,38,57,86,129,193,289,433,649,974,1460,2190,3285],shipyards:[5,8,12,17,26,38,57,86,129,193,289,433,649,974,1460,2190,3285,4927,7390,11085,16627,24940,37410,56114,84171,126256,189384,284076,426114],orbital_shipyards:[1e4,15e3,22500,33750,50625,75938,113907,170860,256290],spaceports:[5,8,12,17,26,38,57,86,129,193,289,433,649,974,1460,2190,3285,4927,7390,11085],command_centers:[20,30,45,68,102,152,228,342,513,769,1154,1730,2595,3893],android_factories:[1e3,1500,2250,3375,5063,7594,11391,17086,25629,38444,57666,86498],economic_centers:[80,120,180,270,405,608,912,1367,2051,3076,4614,6920,10380],terraform:[80,120,180,270,405,608,912,1367,2051,3076,4614,6920,10380],multi_level_platforms:[1e4,15e3,22500,33750,50625,75938,113907,170860,256290,384434,576651],orbital_base:[2e3,3e3,4500,6750,10125,15188,22782,34172,51258],crystal_mines:[2,3,5,7,11,16,23,35],antimatter_plants:[2e3,3e3,4500,6750,10125,15188,22782,34172,51258],orbital_plants:[4e4,6e4,9e4,135e3,202500,303750,455625,683438,1025157],nanite_factories:[80,120,180,270,405,608,912,1367,2051,3076,4614,6920,10380],jump_gate:[5e3,7500,11250,16875,25313,37970,56955,85433,128150],biosphere_modification:[2e4,3e4,45e3,67500,101250,151875,227813,341720,512580],capital:[15e3,22500,33750,50625,75938,113907,170861,256292,384438]};function Sn(e,t){if(!Number.isFinite(t)||t<=0)throw new Error(`Invalid level ${t} for building ${e}`);const s=kn[e];if(s&&t<=s.length){const e=s[t-1];if(Number.isFinite(e)&&e>=0)return e}if(1===t){const t=un(e),s=Number(t?.creditsCost??NaN);if(Number.isFinite(s)&&s>=0)return s}throw new Error(`No canonical cost defined for ${e} at level ${t}`)}function _n(e){try{return un(e)}catch{return}}const Cn=new Map,Pn=new Map;async function An(e){const t=Date.now(),s=Pn.get(e);if(s&&t-s.ts<3e3)return s.data;const a=Cn.get(e);if(a)return await a;const r=(async()=>{try{const t=(await Bs.get(e)).data;return t&&t.success&&Pn.set(e,{ts:Date.now(),data:t}),t}catch(t){if(t&&"object"==typeof t&&"string"==typeof t.code)return{success:!1,code:t.code,message:t.message||"Request failed",details:t.details,status:t.status};throw new Error("Network error occurred")}finally{Cn.delete(e)}})();return Cn.set(e,r),await r}const Rn={async getLocationByCoord(e){const t=`/universe/coord/${encodeURIComponent(e)}`;return await An(t)},async getSystemBodies(e,t,s,a){const r=`/universe/system/${encodeURIComponent(e)}/${t}/${s}/${a}`;return await An(r)},async getGalaxyRegionSummaries(e,t){const s=`/universe/galaxy/${encodeURIComponent(e)}/${t}/regions`;return await An(s)},async getGalaxyRegionStarColors(e,t){const s=`/universe/galaxy/${encodeURIComponent(e)}/${t}/region-stars`;return await An(s)},async getRegionSystems(e,t,s){const a=`/universe/region/${encodeURIComponent(e)}/${t}/${s}`;return await An(a)}},Tn=({empire:t,onUpdate:s})=>{const[a,r]=e.useState("map"),[n,i]=e.useState([]),[o,l]=e.useState(""),[c,d]=e.useState(null),[u,h]=e.useState(""),[m,p]=e.useState(!1),[y,g]=e.useState(null),f=function(e,t){const s=xa[Math.min(e,xa.length-1)]||65e7;return t?Math.floor(.25*s):s}(t.baseCount||0,t.hasDeletedBase||!1),b=Bs,v=ue(),{closeModal:j}=ha(),w=async()=>{try{const e=await b.get("/game/territories");e.data.success&&i(e.data.data.territories)}catch(Jl){console.error("Error fetching territories:",Jl),g("Failed to load territories")}},N=async()=>{const e=o.trim().toUpperCase();if(!e)return void g("Please enter a coordinate");if(/^[A-Z]\d{2}:\d{2}:\d{2}:\d{2}$/.test(e)){p(!0),g(null),d(null);try{const t=await Rn.getLocationByCoord(e);t.success&&t.data?d(t.data):(d(null),g(t.error||"Location not found"))}catch(Jl){g(Jl.response?.data?.error||"Network error. Please try again.")}finally{p(!1)}}else g("Invalid coordinate format. Use A00:10:22:10")},k=e=>"planet"===e?"ðŸŒ":"â˜„ï¸",S=()=>t.resources.credits>=f;return e.useEffect(()=>{w()},[]),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex space-x-1 bg-gray-700 p-1 rounded-lg",children:[x.jsx("button",{onClick:()=>{j(),v("/galaxy")},className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("map"===a?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"ðŸ—ºï¸ Universe Map"}),x.jsx("button",{onClick:()=>r("territories"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("territories"===a?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"ðŸ›ï¸ My Territories"}),x.jsx("button",{onClick:()=>r("explore"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("explore"===a?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"ðŸ” Explore"}),x.jsx("button",{onClick:()=>r("colonize"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors "+("colonize"===a?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"ðŸš€ Colonize"})]}),y&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200",children:y}),"territories"===a&&x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white",children:"Empire Territories"}),x.jsx("div",{className:"p-3 bg-gray-700 rounded-lg border border-gray-600",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-gray-300",children:"Total Territories:"}),x.jsx("span",{className:"text-blue-400 font-mono text-lg",children:n.length})]})}),0===n.length?x.jsx("p",{className:"text-gray-400",children:"No territories found. Start exploring to find new worlds to colonize!"}):x.jsx("div",{className:"space-y-3",children:n.map(e=>{return x.jsxs("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[k(e.type)," ",e.coord]}),x.jsx("span",{className:"text-xs px-2 py-1 bg-blue-600 text-white rounded capitalize",children:e.type})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("span",{className:"text-gray-400",children:"Fertility:"}),x.jsxs("div",{className:"font-mono "+(s=e.result?.fertility||0,s>=8?"text-green-400":s>=6?"text-yellow-400":s>=4?"text-orange-400":"text-red-400"),children:[e.result?.fertility||"â€”","/10"]})]}),x.jsxs("div",{children:[x.jsx("span",{className:"text-gray-400",children:"Solar Energy:"}),x.jsxs("div",{className:"font-mono "+(t=e.result?.solarEnergy||0,t>=8?"text-green-400":t>=6?"text-yellow-400":t>=4?"text-orange-400":"text-red-400"),children:[e.result?.solarEnergy||"â€”","/10"]})]})]})]},e.coord);var t,s})})]}),"explore"===a&&x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white",children:"Galaxy Explorer"}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Enter Coordinate (Format: A00:10:22:10)"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("input",{type:"text",value:o,onChange:e=>l(e.target.value.toUpperCase()),placeholder:"A00:10:22:10",className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",maxLength:12}),x.jsx("button",{onClick:N,disabled:m||!o.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Searching...":"Explore"})]})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{onClick:()=>l((()=>{const e=["A","B","C"];return`${e[Math.floor(Math.random()*e.length)]}${Math.floor(10*Math.random()).toString().padStart(2,"0")}:${Math.floor(100*Math.random()).toString().padStart(2,"0")}:${Math.floor(100*Math.random()).toString().padStart(2,"0")}:${Math.floor(20*Math.random()).toString().padStart(2,"0")}`})()),className:"px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 text-sm",children:"ðŸŽ² Random Location"}),x.jsx("button",{onClick:()=>l(t.homeSystem||""),className:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm",children:"ðŸ  Home System"})]}),c&&x.jsxs("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsxs("h4",{className:"font-semibold mb-3 text-blue-400 flex items-center gap-2",children:[k(c.type)," Location Details"]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[x.jsxs("div",{children:[x.jsxs("p",{children:[x.jsx("span",{className:"text-gray-400",children:"Coordinate:"})," ",c.coord]}),x.jsxs("p",{children:[x.jsx("span",{className:"text-gray-400",children:"Type:"})," ",x.jsx("span",{className:"capitalize",children:c.type})]}),x.jsxs("p",{children:[x.jsx("span",{className:"text-gray-400",children:"Fertility:"}),x.jsx("span",{className:"ml-1 text-gray-200",children:c.result?.fertility??"â€”"})]}),x.jsxs("p",{children:[x.jsx("span",{className:"text-gray-400",children:"Owner:"}),x.jsx("span",{className:c.owner?"text-red-400":"text-green-400",children:c.owner?c.owner.username:"Unowned"})]})]}),x.jsxs("div",{children:[x.jsx("p",{className:"text-gray-400 mb-1",children:"Overhaul:"}),x.jsxs("p",{className:"text-gray-200",children:["Terrain: ",c.terrain?.type??"â€”"]}),x.jsxs("p",{className:"text-gray-200",children:["Orbit Pos: ",c.orbitPosition??"â€”"]}),x.jsxs("p",{className:"text-gray-200",children:["Solar Energy: ",c.result?.solarEnergy??"â€”"]}),c.result?.yields&&x.jsxs("p",{className:"text-gray-200",children:["Yields (M/G/C): ",c.result.yields.metal,"/",c.result.yields.gas,"/",c.result.yields.crystals]}),"number"==typeof c.result?.area&&x.jsxs("p",{className:"text-gray-200",children:["Area: ",c.result.area]}),c.starOverhaul?.kind&&x.jsxs("p",{className:"text-yellow-300",children:["Star Kind: ",c.starOverhaul.kind]})]})]}),c.context&&x.jsxs("div",{className:"text-xs text-gray-400 border-t border-gray-600 pt-3",children:["Galaxy ",c.context.galaxy," â€¢ Region ",c.context.region," â€¢ System ",c.context.system," â€¢ Body ",c.context.body]}),!c.owner&&x.jsx("button",{onClick:()=>{r("colonize"),l(c.coord)},className:"w-full mt-3 py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded-md transition-colors",children:"ðŸš€ Colonize This Location"})]})]})]}),"colonize"===a&&x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold text-white",children:"Establish New Colony"}),x.jsxs("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsx("h4",{className:"font-medium text-white mb-3",children:"Colonization Cost"}),x.jsxs("div",{className:"text-center",children:[x.jsxs("div",{className:t.resources.credits>=f?"text-yellow-400":"text-red-400",children:["ðŸ’° ",f.toLocaleString()]}),x.jsx("div",{className:"text-xs text-gray-400",children:"Credits"}),x.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Base #",(t.baseCount||0)+1," â€¢ ",t.hasDeletedBase?"25% Discount Applied":"No Discount"]})]}),!S()&&x.jsx("div",{className:"mt-3 p-2 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm",children:"âš ï¸ Insufficient resources for colonization"})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Target Location Coordinate"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("input",{type:"text",value:o,onChange:e=>l(e.target.value.toUpperCase()),placeholder:"A00:10:22:10",className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",maxLength:12}),x.jsx("button",{onClick:N,disabled:m||!o.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Checking...":"Check"})]})]}),c&&x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsx("h4",{className:"font-semibold mb-3 text-blue-400",children:"Target Location"}),x.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsxs("p",{children:[x.jsx("span",{className:"text-gray-400",children:"Coordinate:"})," ",c.coord]}),x.jsxs("p",{children:[x.jsx("span",{className:"text-gray-400",children:"Type:"})," ",x.jsx("span",{className:"capitalize",children:c.type})]}),x.jsxs("p",{children:[x.jsx("span",{className:"text-gray-400",children:"Status:"}),x.jsx("span",{className:c.owner?"text-red-400":"text-green-400",children:c.owner?"Owned":"Available"})]})]}),x.jsxs("div",{children:[x.jsx("p",{className:"text-gray-400 mb-1",children:"Overhaul:"}),x.jsxs("p",{className:"text-gray-200",children:["Fertility: ",c.result?.fertility??"â€”"]}),c.result?.yields&&x.jsxs("p",{className:"text-gray-200",children:["Yields (M/G/C): ",c.result.yields.metal,"/",c.result.yields.gas,"/",c.result.yields.crystals]})]})]})]}),!c.owner&&x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Colony Name"}),x.jsx("input",{type:"text",value:u,onChange:e=>h(e.target.value),placeholder:"Enter colony name...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:30}),x.jsx("button",{onClick:async()=>{if(!c)return void g("No location selected");if(!u.trim())return void g("Please enter a colony name");if(c.owner)return void g("Location is already owned");if(t.resources.credits>=f){p(!0),g(null);try{const e=await b.post("/game/territories/colonize",{locationCoord:c.coord,colonyName:u.trim()});e.data.success?(await w(),s(),r("territories"),d(null),h(""),l("")):g(e.data.error||"Failed to colonize location")}catch(Jl){g(Jl.response?.data?.error||"Network error. Please try again.")}finally{p(!1)}}else g("Insufficient resources for colonization")},disabled:m||!u.trim()||!S(),className:"w-full mt-3 py-3 px-4 rounded-md font-medium transition-colors "+(S()&&u.trim()?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"),children:m?"Establishing Colony...":"ðŸš€ Establish Colony"})]}),c.owner&&x.jsxs("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200",children:["This location is already owned by ",c.owner.username,". Find another location to colonize."]})]})]})]})]})},En={getBaseUnits:async e=>(await Bs.get("/game/base-units",{params:{base:e}})).data,getFleets:async e=>(await Bs.get("/game/fleets",{params:e?{base:e}:void 0})).data,getFleet:async e=>(await Bs.get(`/game/fleets/${e}`)).data,getFleetStatus:async e=>(await Bs.get(`/game/fleets/${e}/status`)).data,dispatchFleet:async(e,t)=>(await Bs.post(`/game/fleets/${e}/dispatch`,{destinationCoord:t})).data,recallFleet:async(e,t)=>(await Bs.put(`/game/fleets/${e}/recall`,{reason:t})).data,estimateTravelTime:async(e,t)=>(await Bs.post(`/game/fleets/${e}/estimate-travel`,{destinationCoord:t})).data},On=({children:e,requiresNetwork:t=!0,networkDisabledTooltip:s="Action unavailable while offline",networkDisabledClassName:a="opacity-50 cursor-not-allowed",disabled:r,className:n="",...i})=>{const{isFullyConnected:o}=aa(),l=t&&!o,c=r||l;return x.jsx("button",{...i,disabled:c,title:r?i.title:l?s:i.title,className:(()=>{const e=n||"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700";return l?`${e} ${a}`:e})(),children:e})},In=n()(He((e,t)=>({zoomLevel:"universe",selectedCoordinate:null,viewport:{centerX:0,centerY:0,zoom:1},galaxyData:new Map,regionData:new Map,systemData:new Map,isLoading:!1,error:null,showGrid:!0,showTerritories:!0,showFleets:!0,showResources:!1,showOverhaulData:!1,searchQuery:"",searchResults:[],systemTimeScalar:null,regionDataVersion:0,setZoomLevel:t=>e({zoomLevel:t}),setSelectedCoordinate:t=>{console.log("[UniverseMapStore] setSelectedCoordinate called with:",{coord:t,hasServer:t?.server?"yes":"no",hasGalaxy:"number"==typeof t?.galaxy?"yes":"no",hasRegion:"number"==typeof t?.region?"yes":"no",hasSystem:"number"==typeof t?.system?"yes":"no",coordString:t?`${t.server||"?"}${"number"==typeof t.galaxy?t.galaxy:"?"}:${"number"==typeof t.region?t.region:"?"}${"number"==typeof t.system?":"+t.system:""}`:"null"}),e({selectedCoordinate:t})},navigateToCoordinate:s=>{const a=t().getZoomLevelFromCoordinate(s);e({selectedCoordinate:s,zoomLevel:a,viewport:{centerX:s.galaxy,centerY:s.region,zoom:"universe"===a?1:"galaxy"===a?2:"region"===a?4:8}})},navigateToUniverse:()=>{e({zoomLevel:"universe",selectedCoordinate:null,viewport:{centerX:0,centerY:0,zoom:1}})},navigateToGalaxy:s=>{console.log("[UniverseMapStore] navigateToGalaxy called with:",s);try{if("number"!=typeof s)return void console.error("[UniverseMapStore] Invalid galaxy parameter:",s);const a={zoomLevel:"galaxy",selectedCoordinate:{server:t().selectedCoordinate?.server??"A",galaxy:s,region:0,system:0,body:0},viewport:{centerX:s,centerY:0,zoom:2}};console.log("[UniverseMapStore] Setting state:",a),e(a)}catch(a){console.error("[UniverseMapStore] Error in navigateToGalaxy:",a)}},navigateToRegion:(s,a)=>{console.log("[UniverseMapStore] navigateToRegion called with:",{galaxy:s,region:a});try{if("number"!=typeof s||"number"!=typeof a)return void console.error("[UniverseMapStore] Invalid parameters for navigateToRegion:",{galaxy:s,region:a});const r={zoomLevel:"region",selectedCoordinate:{server:t().selectedCoordinate?.server??"A",galaxy:s,region:a,system:0,body:0},viewport:{centerX:s,centerY:a,zoom:4}};console.log("[UniverseMapStore] Setting state:",r),e(r)}catch(r){console.error("[UniverseMapStore] Error in navigateToRegion:",r)}},navigateToSystem:(s,a,r)=>{const n=t().selectedCoordinate?.server??"A";e({zoomLevel:"system",selectedCoordinate:{server:n,galaxy:s,region:a,system:r,body:0},viewport:{centerX:s,centerY:a,zoom:8}})},zoomIn:()=>{const{zoomLevel:s}=t(),a=["universe","galaxy","region","system"],r=a.indexOf(s);r<a.length-1&&e({zoomLevel:a[r+1]})},zoomOut:()=>{const{zoomLevel:s}=t(),a=["universe","galaxy","region","system"],r=a.indexOf(s);r>0&&e({zoomLevel:a[r-1]})},setViewport:t=>e({viewport:t}),panViewport:(s,a)=>{const{viewport:r}=t();e({viewport:{...r,centerX:r.centerX+s,centerY:r.centerY+a}})},setGalaxyData:(s,a)=>{const{galaxyData:r}=t(),n=new Map(r);n.set(s,a),e({galaxyData:n})},setRegionData:(s,a)=>{const{regionData:r}=t(),n=new Map(r);n.set(s,a),e({regionData:n,regionDataVersion:(t().regionDataVersion??0)+1})},setSystemData:(s,a)=>{const{systemData:r}=t(),n=new Map(r);n.set(s,a),e({systemData:n})},clearCache:()=>e({galaxyData:new Map,regionData:new Map,systemData:new Map}),setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),toggleGrid:()=>e(e=>({showGrid:!e.showGrid})),toggleTerritories:()=>e(e=>({showTerritories:!e.showTerritories})),toggleFleets:()=>e(e=>({showFleets:!e.showFleets})),toggleResources:()=>e(e=>({showResources:!e.showResources})),toggleOverhaulData:()=>e(e=>({showOverhaulData:!e.showOverhaulData})),setSearchQuery:t=>e({searchQuery:t}),setSearchResults:t=>e({searchResults:t}),setSystemTimeScalar:t=>e({systemTimeScalar:t}),getCurrentRegionKey:()=>{const{selectedCoordinate:e}=t();return e?`${e.server}${e.galaxy}:${e.region}`:null},getCurrentSystemKey:()=>{const{selectedCoordinate:e}=t();return e?`${e.server}${e.galaxy}:${e.region}:${e.system}`:null},getZoomLevelFromCoordinate:e=>e.body>0||e.system>0?"system":e.region>=0?"region":e.galaxy>=0?"galaxy":"universe"}),{name:"universe-map-storage",partialize:e=>({zoomLevel:e.zoomLevel,selectedCoordinate:e.selectedCoordinate,viewport:e.viewport,showGrid:e.showGrid,showTerritories:e.showTerritories,showFleets:e.showFleets,showResources:e.showResources,showOverhaulData:e.showOverhaulData}),onRehydrateStorage:()=>(e,t)=>{t?console.error("[UniverseMapStore] Rehydration error:",t):console.log("[UniverseMapStore] State rehydrated:",{selectedCoordinate:e?.selectedCoordinate,zoomLevel:e?.zoomLevel,hasCoordServer:e?.selectedCoordinate?.server?"yes":"no",hasCoordGalaxy:"number"==typeof e?.selectedCoordinate?.galaxy?"yes":"no",hasCoordRegion:"number"==typeof e?.selectedCoordinate?.region?"yes":"no",hasCoordSystem:"number"==typeof e?.selectedCoordinate?.system?"yes":"no"})}})),Mn=({location:e,position:t})=>{if(!e)return null;const{showOverhaulData:s}=In(),a={left:t.x+15,top:t.y-10,transform:t.x>window.innerWidth-300?"translateX(-100%)":"none"};return x.jsxs("div",{className:"absolute z-50 bg-gray-900 border border-gray-600 rounded-lg p-3 shadow-lg pointer-events-none",style:a,children:[x.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[x.jsx("span",{className:"text-lg",children:(r=e.type,"planet"===r?"ðŸŒ":"â˜„ï¸")}),x.jsxs("div",{children:[x.jsx("div",{className:"text-white font-semibold",children:e.coord}),x.jsx("div",{className:"text-xs text-gray-400 capitalize",children:e.type})]})]}),x.jsxs("div",{className:"mb-2",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Owner: "}),x.jsx("span",{className:e.owner?"text-red-400":"text-green-400",children:e.owner?e.owner.username:"Unowned"})]}),x.jsx("div",{className:"space-y-1",children:s&&x.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-600 space-y-1",children:[x.jsx("div",{className:"text-xs text-blue-300 font-semibold",children:"Overhaul"}),e.terrain&&x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Terrain:"}),x.jsx("span",{className:"text-sm text-gray-200",children:e.terrain?.type})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Orbit Pos:"}),x.jsx("span",{className:"text-sm text-gray-200",children:e.orbitPosition??"â€”"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Solar Energy:"}),x.jsx("span",{className:"text-sm text-gray-200",children:e.result?.solarEnergy??"â€”"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Fertility:"}),x.jsx("span",{className:"text-sm text-gray-200",children:e.result?.fertility??"â€”"})]}),e.result?.yields&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Yields (M/G/C):"}),x.jsxs("span",{className:"text-sm text-gray-200",children:[e.result.yields.metal,"/",e.result.yields.gas,"/",e.result.yields.crystals]})]}),"number"==typeof e.result?.area&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Area:"}),x.jsx("span",{className:"text-sm text-gray-200",children:e.result.area})]})]}),e.starOverhaul?.kind&&x.jsx(x.Fragment,{children:x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400 text-sm",children:"Star Kind:"}),x.jsx("span",{className:"text-sm text-yellow-300",children:e.starOverhaul.kind})]})})]})}),e.context&&x.jsx("div",{className:"mt-2 pt-2 border-t border-gray-600",children:x.jsxs("div",{className:"text-xs text-gray-400",children:["Galaxy ",e.context.galaxy," â€¢ Region ",e.context.region," â€¢ System ",e.context.system," â€¢ Body ",e.context.body]})}),e.buildings&&e.buildings.length>0&&x.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-600",children:[x.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Buildings:"}),x.jsxs("div",{className:"text-xs text-blue-400",children:[e.buildings.length," structure",1!==e.buildings.length?"s":""]})]}),e.fleets&&e.fleets.length>0&&x.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-600",children:[x.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Fleets:"}),x.jsxs("div",{className:"text-xs text-red-400",children:[e.fleets.length," fleet",1!==e.fleets.length?"s":""," present"]})]})]});var r},Fn={galaxySize:80,padding:20,cols:8,rows:5},$n={regionSize:60,padding:10,cols:10,rows:10},Ln=[60,90,120,150,180,210,240,270],qn=(e,t,s,a,r,n,i=16)=>{const o=r*s+(r-1)*a,l=n*s+(n-1)*a,c=Math.max(0,e-2*i),d=Math.max(0,t-2*i),u=Math.min(c/o,d/l),h=s*u,m=a*u,p=r*h+(r-1)*m,y=n*h+(n-1)*m;return{scale:u,itemSize:h,padding:m,startX:(e-p)/2,startY:(t-y)/2,totalWidth:p,totalHeight:y,margin:i}},Un=(e,t,s,a,r,n,i,o,l,c)=>{if(e<s||e>s+l||t<a||t>a+c)return null;const d=e-s,u=t-a,h=Math.floor(d/(r+n)),m=Math.floor(u/(r+n));if(d%(r+n)<r&&u%(r+n)<r&&h<i&&m<o){return m*i+h}return null};function Dn(e,t){const s=document.createElement("canvas");return s.width=e,s.height=t,s}function Wn(e,t){const s=e.getContext("2d");s&&(s.clearRect(0,0,e.width,e.height),t(s))}function Bn(e,t){for(const s of t)e.drawImage(s,0,0)}function zn(e,t,s,a){const r=`${e}:${function(e){const t=new WeakSet,s=e=>{const a=typeof e;if(null===e||"number"===a||"boolean"===a)return JSON.stringify(e);if("string"===a)return JSON.stringify(e);if("undefined"===a)return'"__undef__"';if("function"===a||"symbol"===a)return`"__${a}__"`;if(Array.isArray(e))return`[${e.map(e=>s(e)).join(",")}]`;if("object"===a)return t.has(e)?'"__circular__"':(t.add(e),`{${Object.keys(e).sort().map(t=>`${JSON.stringify(t)}:${s(e[t])}`).join(",")}}`);try{return JSON.stringify(e)}catch{return`"${String(e)}"`}};try{return s(e)}catch{return Object.keys(e).sort().map(t=>`${t}=${String(e[t])}`).join("&")}}(t)}`,n=s.get(r);if(n)return n;const i=a();return s.set(r,i),i}function Hn(e,t){for(const s of e.keys())t&&!t(s)||e.delete(s)}const Zn=({canvas:t,selectedCoordinate:s,showTerritories:a})=>{const[r,n]=e.useState([]),{setRegionData:i}=In(),o=e.useRef(new Map);return e.useEffect(()=>{s&&(async()=>{try{const e=await Rn.getRegionSystems(s.server,s.galaxy,s.region);if(e?.success&&e?.data){const t=e.data.systems||[];n(t);const a=`${s.server}${s.galaxy}:${s.region}`,r=t.filter(e=>!!e&&e.star).map(e=>e.system);i(a,{systemsWithStars:r})}else n([])}catch{n([])}})()},[s?.server,s?.galaxy,s?.region,i]),e.useEffect(()=>{const e=t.getContext("2d");if(!e||!s)return;e.fillStyle="#0a0a1a",e.fillRect(0,0,t.width,t.height),Gn(e,t.width,t.height);Bn(e,[zn("region:grid",{width:t.width,height:t.height},o.current,()=>{const e=Dn(t.width,t.height);return Wn(e,e=>{Yn(e,t.width,t.height)}),e}),zn("region:systems",{server:s.server,galaxy:s.galaxy,region:s.region,systems:Qn(r),showTerritories:a},o.current,()=>{const e=Dn(t.width,t.height);return Wn(e,e=>{Vn(e,t.width,t.height,s,r,a)}),e})])},[t,s,a,r]),e.useEffect(()=>{Hn(o.current,e=>e.startsWith("region:grid")||e.startsWith("region:systems"))},[t.width,t.height]),null},Gn=(e,t,s)=>{const a=1e-4*Date.now();for(let r=0;r<150;r++){const n=43*r%t,i=71*r%s,o=.4+.6*Math.sin(a+.2*r),l=.8+.4*Math.sin(1.2*a+.1*r);e.fillStyle=`rgba(255, 255, 255, ${.8*o})`,e.fillRect(n,i,l,l)}for(let r=0;r<3;r++){const n=200*r%t,i=150*r%s,o=80+40*Math.sin(a+r),l=e.createRadialGradient(n,i,0,n,i,o);l.addColorStop(0,`rgba(200, 100, 255, ${.08*Math.sin(a+r)})`),l.addColorStop(1,"rgba(200, 100, 255, 0)"),e.fillStyle=l,e.fillRect(n-o,i-o,2*o,2*o)}},Kn=(e,t)=>{const s=e-100,a=t-160;return{gridX:50,gridY:80,gridW:s,gridH:a,cols:10,rows:10,cellW:s/10,cellH:a/10}},Yn=(e,t,s)=>{const a=e.createRadialGradient(t/2,s/2,0,t/2,s/2,Math.max(t,s)/2);a.addColorStop(0,"rgba(20, 20, 40, 0.3)"),a.addColorStop(1,"rgba(10, 10, 20, 0.1)"),e.fillStyle=a,e.fillRect(0,0,t,s);const{gridX:r,gridY:n,gridW:i,gridH:o,cols:l,rows:c,cellW:d,cellH:u}=Kn(t,s);e.strokeStyle="rgba(100,150,255,0.25)",e.lineWidth=1;for(let h=0;h<=l;h++){const t=r+h*d;e.beginPath(),e.moveTo(t,n),e.lineTo(t,n+o),e.stroke()}for(let h=0;h<=c;h++){const t=n+h*u;e.beginPath(),e.moveTo(r,t),e.lineTo(r+i,t),e.stroke()}},Vn=(e,t,s,a,r,n)=>{const{gridX:i,gridY:o,gridH:l,cols:c,cellW:d,cellH:u}=Kn(t,s);r.forEach(t=>{const s=t.system%c,r=Math.floor(t.system/c),l=i+s*d+d/2,h=o+r*u+u/2,m=t.star,p=m?.spectralClass||void 0,y=t.coord,g=y&&2===y.split(":").length?`${y}:00`:y,x=g?vn(g,101):void 0,f=m?.color||(x?{YELLOW:"#FFF4EA",ORANGE:"#FFD2A1",WHITE:"#CAD7FF",BLUE:"#9BB0FF",RED_GIANT:"#FF9E7B",SUPER_GIANT:"#FFE29A",WHITE_DWARF:"#E6F1FF",NEUTRON:"#AFBFFF"}[x]:void 0),b=f?Xn(f,p):void 0;ei(e,l,h,10,.75,a,t.system,n,b)}),e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="bold 20px monospace",e.textAlign="center";const h=`${a.server}${a.galaxy.toString().padStart(2,"0")}:${a.region.toString().padStart(2,"0")}`;e.fillText(`Galaxy ${a.galaxy} > Region ${a.region}`,t/2,35),e.fillStyle="rgba(255, 255, 150, 0.8)",e.font="14px monospace",e.fillText(`(${h})`,t/2,55),r&&0!==r.length||(e.fillStyle="rgba(255,255,255,0.6)",e.font="14px monospace",e.fillText("No star systems in this region (from DB).",t/2,o+l/2))},Jn=(e,t)=>{try{const s=e.replace("#",""),a=3===s.length?s.split("").map(e=>e+e).join(""):s,r=parseInt(a,16);return`rgba(${r>>16&255}, ${r>>8&255}, ${255&r}, ${t})`}catch{return`rgba(255, 255, 255, ${t})`}},Qn=e=>{try{let t=e.length;for(let s=0;s<e.length;s++){const a=e[s],r=a?.system??0,n="string"==typeof a?.star?.color?a.star.color:"";t=(t<<5)-t+(65535&r^255&(n.length>=7?parseInt(n.slice(1,3),16):0)),t|=0}return`${e.length}:${t>>>0}`}catch{return`${e?.length??0}:0`}},Xn=(e,t)=>{try{const{r:s,g:a,b:r}=(e=>{const t=e.replace("#",""),s=3===t.length?t.split("").map(e=>e+e).join(""):t,a=parseInt(s,16);return{r:a>>16&255,g:a>>8&255,b:255&a}})(e);let{h:n,s:i,l:o}=((e,t,s)=>{e/=255,t/=255,s/=255;const a=Math.max(e,t,s),r=Math.min(e,t,s);let n=0,i=0;const o=(a+r)/2;if(a!==r){const l=a-r;switch(i=o>.5?l/(2-a-r):l/(a+r),a){case e:n=(t-s)/l+(t<s?6:0);break;case t:n=(s-e)/l+2;break;case s:n=(e-t)/l+4}n/=6}return{h:n,s:i,l:o}})(s,a,r);switch(t){case"O":case"B":i=Math.min(1,1.6*i+.25),o=Math.min(.88,.95*o+.1);break;case"A":case"F":i=Math.min(1,1.35*i+.15),o=Math.min(.86,1*o+.05);break;case"G":i=Math.min(1,1.25*i+.12),o=Math.min(.84,1*o);break;case"K":case"M":i=Math.min(1,1.45*i+.2),o=Math.min(.8,.95*o+.02);break;default:i=Math.min(1,1.3*i+.15),o=Math.min(.85,o)}return((e,t,s)=>{const a=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e);let r,n,i;if(0===t)r=n=i=s;else{const o=s<.5?s*(1+t):s+t-s*t,l=2*s-o;r=a(l,o,e+1/3),n=a(l,o,e),i=a(l,o,e-1/3)}const o=e=>Math.round(255*e).toString(16).padStart(2,"0");return`#${o(r)}${o(n)}${o(i)}`})(n,i,o)}catch{return e}},ei=(e,t,s,a,r,n,i,o,l)=>{const c=l??"#FFFFFF";e.save();const d=e.globalCompositeOperation;e.globalCompositeOperation="lighter";const u=e.createRadialGradient(t,s,0,t,s,2.4*a),h=Math.min(1,.75+.25*r);u.addColorStop(0,Jn(c,h)),u.addColorStop(1,Jn(c,0)),e.fillStyle=u,e.beginPath(),e.arc(t,s,2.4*a,0,2*Math.PI),e.fill(),e.globalCompositeOperation=d,e.restore(),e.fillStyle=c,e.beginPath(),e.arc(t,s,a,0,2*Math.PI),e.fill(),e.fillStyle=Jn(c,Math.min(1,.85)),e.beginPath(),e.arc(t,s,.55*a,0,2*Math.PI),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.25)",e.beginPath(),e.arc(t,s,.18*a,0,2*Math.PI),e.fill(),e.strokeStyle=Jn(c,.9),e.lineWidth=1,e.beginPath(),e.arc(t,s,a+1.2,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="10px monospace",e.textAlign="center";const m=`${n.server}${n.galaxy.toString().padStart(2,"0")}:${n.region.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`;e.fillText(m,t,s+a+15)};function ti(e,t,s,a){const r=(t+30*e.id)%(2*Math.PI);return{x:s+Math.cos(r)*e.orbitRadius,y:a+Math.sin(r)*e.orbitRadius}}function si(e){if(!e||0===e.length)return[];const t=[];for(const s of e){const e=ya(s.coord);if(0===e.body)continue;const a=e.body-1,r=e.body.toString().padStart(2,"0"),n="planet"===s.type,i="asteroid"===s.type,o=n?5:2.5,l=n?"#2b4f28":"#8B7355";t.push({id:a,type:n?"planet":"asteroid",name:i?`Asteroid ${r}`:`Planet ${r}`,orbitRadius:Ln[a%Ln.length],size:o,color:l,fertility:"number"==typeof s.result?.fertility?Math.max(0,Math.min(10,Math.round(s.result.fertility))):n?5:1,resources:{metal:"number"==typeof s.result?.yields?.metal?Math.max(0,Math.min(10,Math.round(s.result.yields.metal))):5,energy:"number"==typeof s.result?.yields?.gas?Math.max(0,Math.min(10,Math.round(s.result.yields.gas))):5,research:"number"==typeof s.result?.yields?.crystals?Math.max(0,Math.min(10,Math.round(s.result.yields.crystals))):5},owner:s.owner??null,hasColony:!!s.owner})}return t}class ai{constructor(e,t=30,s=3){this.enabled=e,this.threshold=t,this.warnStreakSeconds=s}frames=0;last="undefined"!=typeof performance?performance.now():Date.now();fps=0;belowThresholdCount=0;update(e){return this.frames++,e-this.last>=1e3&&(this.fps=this.frames,this.frames=0,this.last=e,this.enabled&&("undefined"!=typeof console&&"function"==typeof console.debug&&console.debug(`[SystemView] ${this.fps} fps`),this.fps<this.threshold?(this.belowThresholdCount++,this.belowThresholdCount>=this.warnStreakSeconds&&("undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(`[SystemView] Sustained low FPS (${this.fps} < ${this.threshold}) for ${this.warnStreakSeconds}s`),this.belowThresholdCount=0)):this.belowThresholdCount=0)),this.fps}}const ri=({canvas:t,selectedCoordinate:s,empire:a,showResources:r,serverBodies:n})=>{const{setSystemTimeScalar:i}=In(),o=e.useRef(new Map),l=e.useRef(null),c="undefined"!=typeof window&&!!window.localStorage&&"1"===window.localStorage.getItem("enableFpsMonitor"),d=e.useRef(null);return e.useEffect(()=>{const e=t.getContext("2d");if(!e||!s)return;let a=!0;d.current=new ai(c);const u=()=>{if(!a)return;e.fillStyle="#0a0a1a",e.fillRect(0,0,t.width,t.height),ni(e,t.width,t.height);const h=5e-4*Date.now();i(h);const m=zn("system:background",{width:t.width,height:t.height},o.current,()=>{const e=Dn(t.width,t.height);return Wn(e,t=>{const s=e.width/2,a=e.height/2;Ln.forEach(e=>li(t,s,a,e))}),e});Bn(e,[m]),ii(e,t.width,t.height,s,r,h,n);{const t="undefined"!=typeof performance?performance.now():Date.now(),s=d.current?d.current.update(t):0;c&&(e.fillStyle="rgba(0,255,0,0.85)",e.font="10px monospace",e.textAlign="left",e.fillText(`${s} fps`,8,16))}l.current=requestAnimationFrame(u)};return u(),()=>{a=!1,l.current&&(cancelAnimationFrame(l.current),l.current=null)}},[t,s,r,a,n,i,c]),e.useEffect(()=>{Hn(o.current,e=>e.startsWith("system:background"))},[t.width,t.height]),null},ni=(e,t,s)=>{const a=1e-4*Date.now();for(let r=0;r<100;r++){const n=47*r%t,i=83*r%s,o=.5+.5*Math.sin(a+.3*r),l=1+.5*Math.sin(.8*a+.15*r);e.fillStyle=`rgba(255, 255, 255, ${.9*o})`,e.fillRect(n,i,l,l)}for(let r=0;r<2;r++){const n=300*r%t,i=200*r%s,o=120+60*Math.sin(a+r),l=e.createRadialGradient(n,i,0,n,i,o);l.addColorStop(0,`rgba(255, 200, 100, ${.05*Math.sin(a+r)})`),l.addColorStop(1,"rgba(255, 200, 100, 0)"),e.fillStyle=l,e.fillRect(n-o,i-o,2*o,2*o)}},ii=(e,t,s,a,r,n,i)=>{const o=t/2,l=s/2,c=ga({...a,body:0}),d={color:{YELLOW:"#FFF4EA",ORANGE:"#FFD2A1",WHITE:"#CAD7FF",BLUE:"#9BB0FF",RED_GIANT:"#FF9E7B",SUPER_GIANT:"#FFE29A",WHITE_DWARF:"#E6F1FF",NEUTRON:"#AFBFFF"}[vn(c,101)]||"#FFF4EA"},u=i&&i.length?si(i):[];oi(e,o,l,d),u.forEach(t=>{ci(e,o,l,t,r,n)}),e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="bold 16px monospace",e.textAlign="center";const h=`${a.server}${a.galaxy.toString().padStart(2,"0")}:${a.region.toString().padStart(2,"0")}:${a.system.toString().padStart(2,"0")}`;e.fillText(`System ${a.system}`,t/2,30),e.fillStyle="rgba(255, 255, 150, 0.8)",e.font="12px monospace",e.fillText(`(${h})`,t/2,50),r&&ui(e,t,s)},oi=(e,t,s,a)=>{const r=(e,t)=>{try{const s=e.replace("#",""),a=3===s.length?s.split("").map(e=>e+e).join(""):s,r=parseInt(a,16);return`rgba(${r>>16&255}, ${r>>8&255}, ${255&r}, ${t})`}catch{return`rgba(255, 255, 255, ${t})`}},n=.001*Date.now(),i=15+3*Math.sin(n),o=(e=>{try{const{r:t,g:s,b:a}=(e=>{const t=e.replace("#",""),s=3===t.length?t.split("").map(e=>e+e).join(""):t,a=parseInt(s,16);return{r:a>>16&255,g:a>>8&255,b:255&a}})(e);let{h:r,s:n,l:i}=((e,t,s)=>{e/=255,t/=255,s/=255;const a=Math.max(e,t,s),r=Math.min(e,t,s);let n=0,i=0;const o=(a+r)/2;if(a!==r){const l=a-r;switch(i=o>.5?l/(2-a-r):l/(a+r),a){case e:n=(t-s)/l+(t<s?6:0);break;case t:n=(s-e)/l+2;break;case s:n=(e-t)/l+4}n/=6}return{h:n,s:i,l:o}})(t,s,a);return n=Math.min(1,1.5*n+.2),i=Math.min(.86,1*i+.05),((e,t,s)=>{const a=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e);let r,n,i;if(0===t)r=n=i=s;else{const o=s<.5?s*(1+t):s+t-s*t,l=2*s-o;r=a(l,o,e+1/3),n=a(l,o,e),i=a(l,o,e-1/3)}const o=e=>Math.round(255*e).toString(16).padStart(2,"0");return`#${o(r)}${o(n)}${o(i)}`})(r,n,i)}catch{return e}})(a.color);e.save();const l=e.globalCompositeOperation;e.globalCompositeOperation="lighter";const c=e.createRadialGradient(t,s,0,t,s,2.8*i);c.addColorStop(0,r(o,.75)),c.addColorStop(1,r(o,0)),e.fillStyle=c,e.beginPath(),e.arc(t,s,2.8*i,0,2*Math.PI),e.fill(),e.globalCompositeOperation=l,e.restore(),e.fillStyle=o,e.beginPath(),e.arc(t,s,i,0,2*Math.PI),e.fill(),e.fillStyle=r(o,.9),e.beginPath(),e.arc(t,s,.6*i,0,2*Math.PI),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.25)",e.beginPath(),e.arc(t,s,.22*i,0,2*Math.PI),e.fill(),e.strokeStyle=r(o,.95),e.lineWidth=1,e.beginPath(),e.arc(t,s,i+1.5,0,2*Math.PI),e.stroke()},li=(e,t,s,a)=>{e.strokeStyle="rgba(100, 100, 100, 0.2)",e.lineWidth=1,e.beginPath(),e.arc(t,s,a,0,2*Math.PI),e.stroke()},ci=(e,t,s,a,r,n)=>{const{x:i,y:o}=ti(a,n,t,s);if(e.fillStyle=a.color,e.beginPath(),e.arc(i,o,a.size,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke(),a.hasColony){e.strokeStyle="#00ff00",e.lineWidth=2,e.beginPath(),e.arc(i,o,a.size+2,0,2*Math.PI),e.stroke();const t=a.owner?.username??"Unknown";e.fillStyle="rgba(0, 255, 0, 0.9)",e.font="8px monospace",e.textAlign="center",e.fillText(t,i,o-a.size-8)}r&&di(e,i,o,a),e.fillStyle="rgba(255, 255, 255, 0.8)",e.font="10px monospace",e.textAlign="center",e.fillText(a.name,i,o+a.size+12)},di=(e,t,s,a)=>{[{value:a.resources.metal,color:"#C0C0C0",symbol:"M"},{value:a.resources.energy,color:"#4169E1",symbol:"E"}].forEach((r,n)=>{const i=r.value/10,o=t-10+10*n,l=s-a.size-8;e.fillStyle=`rgba(${hi(r.color)}, ${i})`,e.fillRect(o,l,8,4),e.fillStyle="rgba(255, 255, 255, 0.8)",e.font="8px monospace",e.textAlign="center",e.fillText(r.symbol,o+4,l+3)})},ui=(e,t,s)=>{const a=t-150,r=s-80;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(a,r,140,70),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.strokeRect(a,r,140,70),e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="bold 12px monospace",e.textAlign="left",e.fillText("Resources",a+5,r+15);e.font="10px monospace",[{color:"#C0C0C0",label:"Metal (M)"},{color:"#4169E1",label:"Energy (E)"}].forEach((t,s)=>{const n=r+25+12*s;e.fillStyle=t.color,e.fillRect(a+5,n,8,8),e.fillStyle="rgba(255, 255, 255, 0.8)",e.fillText(t.label,a+18,n+7)})},hi=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(t){return`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`}return"255, 255, 255"},mi=e=>e>=0?`+${e}`:`${e}`,pi=({starType:e,coord:t,hasStar:s,starOverhaul:a})=>{return x.jsx("div",{className:"absolute top-4 left-4 z-20",children:x.jsx("div",{className:"min-w-[240px] bg-gray-900/80 border border-gray-700 rounded-lg p-3 shadow-lg backdrop-blur-sm",children:s||void 0===s?x.jsxs("div",{className:"text-gray-300",children:[x.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[x.jsx("div",{className:"w-5 h-5 rounded-full border border-gray-600 shadow-inner",style:{backgroundColor:e?.color||"#ffffff"},title:"Star color"}),x.jsxs("div",{className:"leading-tight",children:[x.jsx("div",{className:"text-sm font-semibold text-white",children:e?`${e.name} (${e.class})`:"Star"}),t&&x.jsxs("div",{className:"text-xs text-gray-400",children:["(",t,")"]})]}),a?.kind&&x.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full bg-blue-600/30 text-blue-200 text-[11px] border border-blue-500/40 whitespace-nowrap",children:(r=a.kind,r.replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase()))})]}),x.jsxs("div",{className:"mt-2 text-sm",children:[x.jsx("div",{className:"text-gray-400 mb-1",children:"Orbit Modifiers"}),a?.orbitModifiers&&a.orbitModifiers.length>0?x.jsx("div",{className:"space-y-1 max-h-52 overflow-y-auto pr-1",children:a.orbitModifiers.slice().sort((e,t)=>e.position-t.position).map(e=>{const t=[];if(e.solarEnergyDelta&&t.push(`Solar Energy ${mi(e.solarEnergyDelta)}`),e.fertilityDelta&&t.push(`Fertility ${mi(e.fertilityDelta)}`),e.resourceDelta){const s=e.resourceDelta.metal??0,a=e.resourceDelta.gas??0,r=e.resourceDelta.crystals??0;s&&t.push(`Metal ${mi(s)}`),a&&t.push(`Gas ${mi(a)}`),r&&t.push(`Crystals ${mi(r)}`)}const s=t.length?t.join(" â€¢ "):"No changes";return x.jsxs("div",{className:"flex items-start gap-2",children:[x.jsxs("div",{className:"text-gray-400 w-8",children:["P",e.position]}),x.jsx("div",{className:"text-gray-200",children:s})]},e.position)})}):x.jsx("div",{className:"text-gray-400",children:"No orbit modifiers available"})]})]}):x.jsxs("div",{className:"text-gray-300",children:[x.jsx("div",{className:"flex items-center gap-2 mb-2",children:x.jsx("span",{className:"text-sm font-semibold text-white",children:"System Star"})}),x.jsx("div",{className:"text-red-300 text-sm",children:"No star in this system"}),t&&x.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["(",t,")"]})]})})});var r},yi=({fleets:t,canvasSize:s,zoomLevel:a,selectedCoordinate:r,onFleetClick:n})=>{const i=e.useRef(null),o=e=>{if(!r||!e)return null;if("number"!=typeof e.galaxy||"number"!=typeof e.region||"number"!=typeof e.system||"number"!=typeof e.body)return console.warn("[FleetMapOverlay] Invalid fleet coordinate:",e),null;switch(a){case"universe":return{x:e.galaxy/40*s.width,y:e.galaxy/40*s.height};case"galaxy":return r&&void 0!==r.galaxy&&e.galaxy===r.galaxy?{x:e.region%10/10*s.width,y:Math.floor(e.region/10)/10*s.height}:null;case"region":return r&&void 0!==r.galaxy&&void 0!==r.region&&e.galaxy===r.galaxy&&e.region===r.region?{x:e.system%10/10*s.width,y:Math.floor(e.system/10)/10*s.height}:null;case"system":if(!r||void 0===r.galaxy||void 0===r.region||void 0===r.system||e.galaxy!==r.galaxy||e.region!==r.region||e.system!==r.system)return null;const t=e.body/20*2*Math.PI,a=50+15*e.body,n=s.width/2,i=s.height/2;return{x:n+Math.cos(t)*a,y:i+Math.sin(t)*a};default:return null}},l=()=>{if(!i.current)return;const e=i.current,a=e.getContext("2d");a&&(a.clearRect(0,0,s.width,s.height),e.width=s.width,e.height=s.height,t.forEach(e=>{if(!e||!e.coord)return void console.warn("[FleetMapOverlay] Invalid fleet data:",e);let t;if("string"==typeof e.coord){const s=e.coord.match(/^([A-Z])(\d{2}):(\d{2}):(\d{2}):(\d{2})$/);if(!s)return void console.warn("[FleetMapOverlay] Unable to parse fleet coordinate:",e.coord);t={server:s[1],galaxy:parseInt(s[2],10),region:parseInt(s[3],10),system:parseInt(s[4],10),body:parseInt(s[5],10)}}else{if(!e.coordinate)return void console.warn("[FleetMapOverlay] No coordinate found for fleet:",e);t=e.coordinate}const s=o(t);if(s&&c(a,s.x,s.y,e,!1),e.isMoving&&e.movement){const t=o(e.movement.origin),s=o(e.movement.destination);if(t&&s){d(a,t,s,e.movement.progress);const r={x:t.x+(s.x-t.x)*e.movement.progress,y:t.y+(s.y-t.y)*e.movement.progress};c(a,r.x,r.y,e,!0),u(a,s.x,s.y)}}}))},c=(e,t,s,r,n)=>{const i="system"===a?12:"region"===a?8:6;e.beginPath(),e.arc(t,s,i,0,2*Math.PI),e.fillStyle=n?"#60A5FA":"#10B981",e.fill(),e.beginPath(),e.arc(t,s,i,0,2*Math.PI),e.strokeStyle=n?"#3B82F6":"#059669",e.lineWidth=2,e.stroke(),e.fillStyle="#FFFFFF",e.font=`${Math.max(8,i-2)}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("ðŸš€",t,s),"system"!==a&&"region"!==a||(e.fillStyle="#E5E7EB",e.font="10px Arial",e.textAlign="center",e.textBaseline="top",e.fillText(r.name||r.fleetName||"Fleet",t,s+i+2)),n&&r.movement&&(e.fillStyle="#FCD34D",e.font="8px Arial",e.textAlign="center",e.textBaseline="bottom",e.fillText(`${Math.round(100*r.movement.progress)}%`,t,s-i-2))},d=(e,t,s,a)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y),e.strokeStyle="#6366F1",e.lineWidth=2,e.setLineDash([5,5]),e.stroke(),e.setLineDash([]);const r=t.x+(s.x-t.x)*a,n=t.y+(s.y-t.y)*a;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(r,n),e.strokeStyle="#10B981",e.lineWidth=3,e.stroke(),e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI),e.fillStyle="#EF4444",e.fill();const i=Math.atan2(s.y-t.y,s.x-t.x);e.save(),e.translate(r,n),e.rotate(i),e.beginPath(),e.moveTo(8,0),e.lineTo(-4,-4),e.lineTo(-4,4),e.closePath(),e.fillStyle="#10B981",e.fill(),e.restore()},u=(e,t,s)=>{const a=8+2*Math.sin(Date.now()/500);e.beginPath(),e.arc(t,s,a,0,2*Math.PI),e.fillStyle="rgba(248, 113, 113, 0.3)",e.fill(),e.beginPath(),e.arc(t,s,8,0,2*Math.PI),e.fillStyle="#F87171",e.fill(),e.beginPath(),e.arc(t,s,8,0,2*Math.PI),e.strokeStyle="#EF4444",e.lineWidth=2,e.stroke(),e.fillStyle="#FFFFFF",e.font="8px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("ðŸŽ¯",t,s)};return e.useEffect(()=>{l()},[t,s,a,r]),e.useEffect(()=>{if(!t.some(e=>e.isMoving))return;const e=setInterval(()=>{l()},1e3);return()=>clearInterval(e)},[t]),x.jsx("canvas",{ref:i,className:"absolute inset-0 pointer-events-none",style:{width:s.width,height:s.height,zIndex:10,pointerEvents:n?"auto":"none"},onClick:e=>{if(!n||!i.current)return;const s=i.current.getBoundingClientRect(),r=e.clientX-s.left,l=e.clientY-s.top;for(const i of t){const e=o(i.coordinate);if(!e)continue;const t=Math.sqrt(Math.pow(r-e.x,2)+Math.pow(l-e.y,2)),s="system"===a?15:10;if(t<=s){n(i.fleetId);break}if(i.isMoving&&i.movement){const e=o(i.movement.origin),t=o(i.movement.destination);if(e&&t){const a={x:e.x+(t.x-e.x)*i.movement.progress,y:e.y+(t.y-e.y)*i.movement.progress};if(Math.sqrt(Math.pow(r-a.x,2)+Math.pow(l-a.y,2))<=s){n(i.fleetId);break}}}}}})},gi={itemSize:60,padding:10,cols:10,rows:10};function xi(){try{const e=localStorage.getItem("auth-storage");if(!e)return{};const t=JSON.parse(e),s=t?.state?.token;if(s)return{Authorization:`Bearer ${s}`}}catch{}return{}}class fi{constructor(e){this.setRegionData=e}queue=[];inFlight=new Set;running=!1;pausedUntil=0;backoffMs=0;destroyed=!1;destroy(){this.destroyed=!0,this.queue=[],this.inFlight.clear()}enqueue(e){this.destroyed||this.inFlight.has(e.key)||this.queue.find(t=>t.key===e.key)||(e.priority?this.queue.unshift(e):this.queue.push(e),this.run())}async run(){if(!this.running&&!this.destroyed){this.running=!0;try{for(;!this.destroyed&&this.queue.length>0;){const e=Date.now();if(e<this.pausedUntil){await this.sleep(this.pausedUntil-e);continue}const t=this.queue.shift();if(!this.inFlight.has(t.key)){this.inFlight.add(t.key);try{const{systemsWithStars:e,starColors:s}=await this.fetchRegionSystems(t.server,t.galaxy,t.region);this.setRegionData(t.key,{systemsWithStars:e,starColors:s}),this.backoffMs=0,await this.sleep(150)}catch(Vl){const s=!0===Vl?.__rateLimit,a="number"==typeof Vl?.__retryMs?Vl.__retryMs:0;if(s){this.backoffMs=this.backoffMs?Math.min(2*this.backoffMs,8e3):1e3;const e=Math.max(this.backoffMs,a);this.pausedUntil=Date.now()+e,this.queue.unshift(t)}else this.setRegionData(t.key,{systemsWithStars:[]}),await this.sleep(150)}finally{this.inFlight.delete(t.key)}}}}finally{this.running=!1}}}async fetchRegionSystems(e,t,s){const a=`${at().apiUrl}/universe/region/${encodeURIComponent(e)}/${t}/${s}`,r={"Content-Type":"application/json",...xi()},n=await fetch(a,{method:"GET",headers:r});if(429===n.status){const e=n.headers.get("Retry-After"),t=e?parseInt(e,10):NaN,s=Number.isFinite(t)?1e3*t:0,a=new Error("Rate limited");throw a.__rateLimit=!0,a.__retryMs=s,a}if(!n.ok)throw new Error(`HTTP ${n.status}`);let i;try{i=await n.json()}catch{throw new Error("Invalid JSON")}if(!i||!0!==i.success||!i.data)throw new Error(i?.error||"Request failed");const o=Array.isArray(i.data.systems)?i.data.systems:[],l={};return{systemsWithStars:o.filter(e=>(e?.star?.color&&(l[e.system]=e.star.color),!!e&&e.star)).map(e=>e.system),starColors:l}}sleep(e){return new Promise(t=>setTimeout(t,e))}}class bi extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return console.error("[UniverseMapErrorBoundary] Caught error:",e),{hasError:!0,error:e}}componentDidCatch(e,t){console.error("[UniverseMapErrorBoundary] Error details:",{error:e,errorInfo:t})}render(){return this.state.hasError?x.jsx("div",{className:"relative w-full h-full bg-gray-900 flex items-center justify-center",children:x.jsxs("div",{className:"text-white text-center p-8",children:[x.jsx("h2",{className:"text-xl font-bold mb-4",children:"Universe Map Error"}),x.jsx("p",{className:"mb-4",children:"An error occurred while rendering the universe map."}),x.jsx("button",{onClick:()=>{console.log("[UniverseMapErrorBoundary] Resetting error state"),this.setState({hasError:!1,error:void 0}),window.location.reload()},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Reload Application"})]})}):this.props.children}}const vi=e=>!(!e||"object"!=typeof e)&&("string"==typeof e.server&&"number"==typeof e.galaxy&&"number"==typeof e.region&&"number"==typeof e.system&&"number"==typeof e.body),ji=({empire:t})=>{const s=ue(),a=e.useRef(null),r=e.useRef(null),[n,i]=e.useState({width:800,height:600}),[o,l]=e.useState({x:0,y:0}),[c]=e.useState(null),[d,u]=e.useState(null),[h,m]=e.useState(!1),[p,y]=e.useState([]),[g,f]=e.useState(!1),b=e.useRef(null),v=e.useRef(null),j=In(),{zoomLevel:w="universe",selectedCoordinate:N=null,viewport:k={centerX:0,centerY:0,zoom:1},isLoading:S=!1,error:_=null,showGrid:C=!0,showTerritories:P=!0,showFleets:A=!0,showResources:R=!1,navigateToGalaxy:T,navigateToRegion:E,navigateToSystem:O,zoomIn:I,zoomOut:M,setError:F,setLoading:$,systemData:L=new Map,setSystemData:q,setRegionData:U,systemTimeScalar:D=null,regionData:W=new Map,regionDataVersion:B=0}=j||{},z=e.useCallback(e=>{try{console.log("[UniverseMap] Safe navigate to galaxy:",e),T&&"number"==typeof e?T(e):console.error("[UniverseMap] Invalid galaxy navigation:",{navigateToGalaxy:T,galaxy:e})}catch(t){console.error("[UniverseMap] Error in safeNavigateToGalaxy:",t)}},[T]),H=e.useCallback((e,t)=>{try{console.log("[UniverseMap] Safe navigate to region:",{galaxy:e,region:t}),E&&"number"==typeof e&&"number"==typeof t?E(e,t):console.error("[UniverseMap] Invalid region navigation:",{navigateToRegion:E,galaxy:e,region:t})}catch(s){console.error("[UniverseMap] Error in safeNavigateToRegion:",s)}},[E]);if(!j)return console.warn("[UniverseMap] Store not initialized, returning null"),x.jsx("div",{className:"relative w-full h-full bg-gray-900 flex items-center justify-center",children:x.jsx("div",{className:"text-white",children:"Loading universe map..."})});const Z=vi(G=N)?G:null;var G;if(console.warn("[UniverseMap] Coordinate debug:",JSON.stringify({originalCoordinate:N,validatedCoordinate:Z,isValid:vi(N),zoomLevel:w,originalHasServer:N?.server?"yes":"no",originalHasGalaxy:"number"==typeof N?.galaxy?`yes (${N.galaxy})`:`no (${typeof N?.galaxy})`,originalHasRegion:"number"==typeof N?.region?`yes (${N.region})`:`no (${typeof N?.region})`,originalHasSystem:"number"==typeof N?.system?`yes (${N.system})`:`no (${typeof N?.system})`,originalHasBody:"number"==typeof N?.body?`yes (${N.body})`:`no (${typeof N?.body})`,validatedHasGalaxy:void 0!==Z?.galaxy?`yes (${Z.galaxy})`:"no"},null,2)),N&&!Z)return console.error("[UniverseMap] Invalid coordinate detected:",N),x.jsx("div",{className:"relative w-full h-full bg-gray-900 flex items-center justify-center",children:x.jsxs("div",{className:"text-white text-center",children:[x.jsx("div",{className:"text-red-400 mb-2",children:"Invalid coordinate data"}),x.jsx("div",{className:"text-sm",children:"Coordinate validation failed"})]})});const K=e.useCallback(()=>{if(r.current){const e=r.current.getBoundingClientRect(),t={width:Math.max(800,e.width-16),height:Math.max(600,e.height-32)};i(t)}},[]),Y=e.useCallback(e=>{const t=a.current?.getBoundingClientRect();if(!t)return;const s=e.clientX-t.left,r=e.clientY-t.top;if(l({x:s,y:r}),"galaxy"===w){const e=qn(n.width,n.height,$n.regionSize,$n.padding,$n.cols,$n.rows),t=Un(s,r,e.startX,e.startY,e.itemSize,e.padding,$n.cols,$n.rows,e.totalWidth,e.totalHeight);u(t)}else null!==d&&u(null)},[w,n,d]),V=e.useCallback(e=>{console.log("[UniverseMap] Click event started",{zoomLevel:w,validatedCoordinate:Z});try{const i=a.current?.getBoundingClientRect();if(!i)return void console.warn("[UniverseMap] Canvas rect not available");const o=e.clientX-i.left,l=e.clientY-i.top;switch(console.log("[UniverseMap] Click coordinates",{x:o,y:l,canvasSize:n}),console.log("[UniverseMap] Mouse event details",{clientX:e.clientX,clientY:e.clientY,rectLeft:i.left,rectTop:i.top,rectWidth:i.width,rectHeight:i.height}),w){case"universe":try{console.log("[UniverseMap] Processing universe view click - no coordinate needed for universe view");const e=((e,t,s,a)=>{const{galaxySize:r,padding:n,cols:i,rows:o}=Fn,l=((e,t,s,a,r,n)=>{const i=r*s+(r-1)*a,o=n*s+(n-1)*a;return{totalWidth:i,totalHeight:o,startX:(e-i)/2,startY:(t-o)/2}})(s,a,r,n,i,o),{totalWidth:c,totalHeight:d,startX:u,startY:h}=l;return Un(e,t,u,h,r,n,i,o,c,d)})(o,l,n.width,n.height);console.log("[UniverseMap] Universe click result",{galaxyId:e,validRange:null!==e&&e>=0&&e<40}),null!==e&&e>=0&&e<40?(console.log(`[UniverseMap] Navigating to galaxy ${e}`),z(e)):console.warn("[UniverseMap] Invalid galaxy click result:",{galaxyId:e,x:o,y:l,canvasSize:n})}catch(t){console.error("[UniverseMap] Error in universe view click handler:",t)}break;case"galaxy":try{console.log("[UniverseMap] Processing galaxy view click");const e=((e,t,s,a)=>{const{regionSize:r,padding:n,cols:i,rows:o}=$n,l=qn(s,a,r,n,i,o);return Un(e,t,l.startX,l.startY,l.itemSize,l.padding,i,o,l.totalWidth,l.totalHeight)})(o,l,n.width,n.height);console.log("[UniverseMap] Galaxy click result",{regionId:e,validatedCoordinate:Z,originalCoordinate:N,validRange:null!==e&&e>=0&&e<100,hasValidCoord:void 0!==Z?.galaxy});const t=Z||N;null!==e&&void 0!==t?.galaxy&&e>=0&&e<100?(console.log(`[UniverseMap] Navigating to region ${e} in galaxy ${t.galaxy}`),H(t.galaxy,e)):console.warn("[UniverseMap] Cannot navigate - invalid regionId or coordinate:",{regionId:e,validatedCoordinate:Z,selectedCoordinate:N,currentCoordinate:t,regionIdNull:null===e,galaxyUndefined:void 0===t?.galaxy,regionIdOutOfRange:null!==e&&(e<0||e>=100)})}catch(t){console.error("[UniverseMap] Error in galaxy view click handler:",t)}break;case"region":if(!Z){console.log("No coordinate selected in region view");break}try{const e=n.width,t=n.height,s=50,a=80,r=e-100,i=t-160,c=10,d=10,u=r/c,h=i/d;if(o>=s&&o<=s+r&&l>=a&&l<=a+i){const e=Math.floor((o-s)/u),t=Math.floor((l-a)/h);if(e>=0&&e<c&&t>=0&&t<d){const r=o-(s+e*u+u/2),n=l-(a+t*h+h/2),i=14;if(r*r+n*n<=i*i){const s=t*c+e;if(Z?.server&&void 0!==Z?.galaxy&&void 0!==Z?.region){const e=`${Z.server}${Z.galaxy}:${Z.region}`,t=W.get(e);t?.systemsWithStars?.includes(s)?(console.log(`[UniverseMap] Clicked system ${s}`),O(Z.galaxy,Z.region,s)):console.log(`[UniverseMap] No star system at ${s} in region`)}else console.warn("[UniverseMap] Invalid validatedCoordinate for region click:",Z)}}}}catch(Jl){console.error("Error handling region click:",Jl)}break;case"system":if(!Z){console.log("No coordinate selected in system view");break}try{const e=n.width/2,t=n.height/2,i=`${Z.server}${Z.galaxy}:${Z.region}:${Z.system}`,c=L.get(i),d=c&&c.length?si(c):[],u=D??5e-4*Date.now();let h=null,m=null,p=Number.POSITIVE_INFINITY;for(const s of d){const{x:a,y:r}=ti(s,u,e,t),n=Math.max(8,Math.min(16,s.size+4)),i=o-a,c=l-r,d=i*i+c*c;if(d<p&&(p=d,m=s),d<=n*n){h=s;break}}if(!h&&m){const e=24;p<=e*e&&(h=m)}if(h){try{const s=a.current,r=s?.getContext("2d");if(r){const{x:s,y:a}=ti(h,u,e,t);r.save(),r.strokeStyle="rgba(0, 255, 0, 0.9)",r.lineWidth=2,r.beginPath(),r.arc(s,a,(h.size||4)+8,0,2*Math.PI),r.stroke(),r.restore()}}catch(r){console.warn("[SystemClick] Debug highlight failed:",r)}console.log("[SystemClick] Navigating to body",h.id,"coord body=",h.id+1,"timeScalar=",u);const n=h.id+1,i=ga({...Z,body:n});s(`/planet/${i}`)}else console.log("[SystemClick] No body matched. nearestDistSq=",p)}catch(Jl){console.error("Error handling system click:",Jl)}}}catch(i){console.error("[UniverseMap] Global error in handleCanvasClick:",i)}},[n,w,Z,s,D,W,L,z,H,O]);e.useEffect(()=>{K();const e=requestAnimationFrame(()=>m(!0));return window.addEventListener("resize",K),()=>{cancelAnimationFrame(e),window.removeEventListener("resize",K)}},[K]),e.useEffect(()=>{if("system"!==w||!Z)return;const e=`${Z.server}${Z.galaxy}:${Z.region}:${Z.system}`;L.has(e)||($(!0),Rn.getSystemBodies(Z.server,Z.galaxy,Z.region,Z.system).then(t=>{t.success&&t.data?q(e,t.data.bodies):F(t.error||"Failed to load system bodies")}).catch(()=>F("Network error loading system bodies")).finally(()=>$(!1)))},[w,Z,L,q,$,F]),e.useEffect(()=>(v.current||(v.current=new fi(U)),()=>{v.current?.destroy(),v.current=null}),[U]),e.useEffect(()=>{let e=!1;return(async()=>{if("galaxy"!==w||!Z)return;const t=Z.server,s=Z.galaxy,a=`${t}${s}`;if(b.current===a)return;try{const r=await Rn.getGalaxyRegionStarColors(t,s);if(!e&&r.success&&r.data){for(const{region:e,systems:a}of r.data.regions||[]){const r=a.map(e=>e.system),n=Object.fromEntries(a.map(e=>[e.system,e.color]));U(`${t}${s}:${e}`,{systemsWithStars:r,starColors:n})}return void(b.current=a)}}catch{}try{const a=await Rn.getGalaxyRegionSummaries(t,s);if(!e&&a.success&&a.data)for(const{region:e,systemsWithStars:r}of a.data.regions||[]){U(`${t}${s}:${e}`,{systemsWithStars:r})}}catch{}const r=v.current;if(!e&&r){for(let e=0;e<100;e++){const a=`${t}${s}:${e}`;r.enqueue({server:t,galaxy:s,region:e,key:a})}b.current=a}})(),()=>{e=!0}},[w,Z?.server,Z?.galaxy,U]),e.useEffect(()=>{if("galaxy"!==w||!Z)return;if(null===d||d<0||d>=100)return;const e=Z.server,t=Z.galaxy,s=`${e}${t}:${d}`;W.has(s)||v.current?.enqueue({server:e,galaxy:t,region:d,key:s,priority:!0})},[w,Z?.server,Z?.galaxy,d,W]),e.useEffect(()=>{A&&t?J():y([])},[A,t]);const J=async()=>{f(!0);try{const e=await En.getFleets();if(e.success&&e.data){const s=(await Promise.all(e.data.fleets.map(async e=>{try{const s=await En.getFleetStatus(e._id);let a="",r="stationed",n="",i=null;return s.success&&s.data&&(a=s.data.fleet.locationCoord,r=s.data.fleet.isMoving?"moving":"stationed",s.data.movement&&(n=s.data.movement.destinationCoord,i=new Date(s.data.movement.estimatedArrivalTime).getTime())),{id:e._id,name:e.name,coord:a,status:r,empireId:t._id,sizeCredits:e.sizeCredits,destinationCoord:"moving"===r?n:void 0,arrivalTime:"moving"===r?i:void 0}}catch(s){return console.warn(`Failed to load status for fleet ${e._id}:`,s),{id:e._id,name:e.name,coord:"",status:"stationed",empireId:t._id,sizeCredits:e.sizeCredits}}}))).filter(e=>e.coord);y(s)}else console.warn("Failed to load fleet data:",e.error),y([])}catch(e){console.error("Error loading fleet data:",e),y([])}finally{f(!1)}},Q=(e,t,s,a,r,n,i)=>{const o=t+a/2,l=s+a/2,c=a/2-5;e.strokeStyle="rgba(100, 150, 255, 0.8)",e.lineWidth=3;for(let u=0;u<3;u++){e.beginPath();for(let t=0;t<4*Math.PI;t+=.1){const s=t/(4*Math.PI)*c,a=t+u*Math.PI*2/3,r=o+Math.cos(a)*s,n=l+Math.sin(a)*s;0===t?e.moveTo(r,n):e.lineTo(r,n)}e.stroke()}const d=e.createRadialGradient(o,l,0,o,l,20);if(d.addColorStop(0,"rgba(255, 255, 150, 1.0)"),d.addColorStop(.5,"rgba(255, 200, 100, 0.8)"),d.addColorStop(1,"rgba(255, 150, 50, 0.2)"),e.fillStyle=d,e.beginPath(),e.arc(o,l,20,0,2*Math.PI),e.fill(),i){const i=n.territories.some(e=>{try{return parseInt(e.substring(1,3),10)===r}catch{return!1}});i&&(e.strokeStyle="#00ff00",e.lineWidth=4,e.beginPath(),e.arc(o,l,c+3,0,2*Math.PI),e.stroke(),e.fillStyle="#00ff00",e.fillRect(t+a-15,s+3,12,8))}e.strokeStyle="rgba(150, 200, 255, 0.6)",e.lineWidth=2,e.beginPath(),e.arc(o,l,c,0,2*Math.PI),e.stroke()},X=(e,t)=>{try{const s=e.replace("#",""),a=3===s.length?s.split("").map(e=>e+e).join(""):s,r=parseInt(a,16);return`rgba(${r>>16&255}, ${r>>8&255}, ${255&r}, ${t})`}catch{return`rgba(255, 255, 255, ${t})`}},ee=(e,t,s,a,r,n,i,o)=>{e.fillStyle="rgba(5, 5, 15, 0.8)",e.fillRect(t,s,a,a);const l=`${Z?.server??"A"}${r}:${n}`,c=W.get(l);if(c?.systemsWithStars?.length){const r=a/10;c.systemsWithStars.forEach(a=>{const n=a%10,i=Math.floor(a/10),o=t+(n+.5)*r,l=s+(i+.5)*r,d=c.starColors?.[a]??"#FFFFFF",u=Math.max(1.4,Math.min(2.4,.12*r)),h=e.createRadialGradient(o,l,0,o,l,3*u);h.addColorStop(0,X(d,.65)),h.addColorStop(1,X(d,0)),e.fillStyle=h,e.beginPath(),e.arc(o,l,3*u,0,2*Math.PI),e.fill(),e.fillStyle=d,e.beginPath(),e.arc(o,l,u,0,2*Math.PI),e.fill()})}if(o){const o=i.territories.some(e=>{try{const t=parseInt(e.substring(1,3),10),s=parseInt(e.substring(4,6),10);return t===r&&s===n}catch{return!1}});o&&(e.strokeStyle="#00ff00",e.lineWidth=3,e.strokeRect(t+1,s+1,a-2,a-2),e.fillStyle="#00ff00",e.fillRect(t+a-10,s+2,8,5))}},te=()=>{const e=a.current;if(!e)return;const s=e.getContext("2d");if(s&&("universe"===w||"galaxy"===w))if(s.fillStyle="#0a0a1a",s.fillRect(0,0,n.width,n.height),(e=>{for(let t=0;t<400;t++){const s=37*t%n.width,a=73*t%n.height,r=nn(`background-${s}-${a}`,t),i=["#9BB0FF","#CAD7FF","#FFF4EA","#FFD2A1","#E6F1FF","#AFBFFF"],o=i[Math.abs(r)%i.length],l=.5+Math.abs(r)%1e3/1e3*1.8;e.fillStyle=o,e.beginPath(),e.arc(s,a,l,0,2*Math.PI),e.fill()}for(let t=0;t<6;t++){const s=157*t%n.width,a=211*t%n.height,r=80+20*t,i=[[80,40,160],[160,80,40],[40,160,80],[160,40,80],[40,80,160],[160,160,40]],o=i[t%i.length],l=e.createRadialGradient(s,a,0,s,a,r);l.addColorStop(0,`rgba(${o[0]}, ${o[1]}, ${o[2]}, 0.15)`),l.addColorStop(1,`rgba(${o[0]}, ${o[1]}, ${o[2]}, 0)`),e.fillStyle=l,e.fillRect(s-r,a-r,2*r,2*r)}})(s),"universe"===w)(e=>{const s=80,a=(n.width-780)/2,r=(n.height-480)/2;if(C){e.strokeStyle="rgba(150, 150, 150, 0.6)",e.lineWidth=1;for(let t=0;t<=8;t++){const s=a+100*t-10;e.beginPath(),e.moveTo(s,r-10),e.lineTo(s,r+480+10),e.stroke()}for(let t=0;t<=5;t++){const s=r+100*t-10;e.beginPath(),e.moveTo(a-10,s),e.lineTo(a+780+10,s),e.stroke()}}for(let n=0;n<40;n++){const i=Math.floor(n/8);Q(e,a+n%8*100,r+100*i,s,n,t,P)}e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="12px monospace",e.textAlign="center";for(let t=0;t<40;t++){const n=a+t%8*100+40,i=r+100*Math.floor(t/8)+s+15;e.fillText(`Galaxy ${t}`,n,i)}})(s);else if((e=>{if(!Z)return;const s=gi,a=qn(n.width,n.height,s.itemSize,s.padding,s.cols,s.rows,16);e.strokeStyle="rgba(100, 150, 255, 0.8)",e.lineWidth=2;for(let t=0;t<=s.cols;t++){const s=a.startX+t*(a.itemSize+a.padding);e.beginPath(),e.moveTo(s,a.startY),e.lineTo(s,a.startY+a.totalHeight),e.stroke()}for(let t=0;t<=s.rows;t++){const s=a.startY+t*(a.itemSize+a.padding);e.beginPath(),e.moveTo(a.startX,s),e.lineTo(a.startX+a.totalWidth,s),e.stroke()}for(let n=0;n<100;n++){const r=Math.floor(n/s.cols),i=n%s.cols,o=a.startX+i*(a.itemSize+a.padding),l=a.startY+r*(a.itemSize+a.padding);ee(e,o,l,a.itemSize,Z.galaxy,n,t,P)}e.fillStyle="rgba(255, 255, 255, 0.9)",e.font="bold 18px monospace",e.textAlign="left",e.fillText(`Galaxy ${Z.server}${Z.galaxy.toString().padStart(2,"0")}`,a.startX,a.startY-20),e.fillStyle="rgba(255, 200, 0, 0.9)",e.font="14px monospace";const r=e.measureText(`Galaxy ${Z.server}${Z.galaxy.toString().padStart(2,"0")}`).width;e.fillText("Change",a.startX+r+20,a.startY-20)})(s),null!==d){const e=`R${d.toString().padStart(2,"0")}`;s.font="12px monospace";const t=4,a=s.measureText(e).width+2*t,r=18;let i=o.x+12,l=o.y-12;i+a>n.width&&(i=n.width-a-4),l-r<0&&(l=r+4),s.fillStyle="rgba(0, 0, 0, 0.7)",s.fillRect(i,l-r,a,r),s.strokeStyle="rgba(255,255,255,0.8)",s.strokeRect(i,l-r,a,r),s.fillStyle="rgba(255,255,255,0.95)",s.fillText(e,i+t,l-5)}};e.useEffect(()=>{let e;const t=()=>{te(),e=requestAnimationFrame(t)};return t(),()=>{e&&cancelAnimationFrame(e)}},[w,k,Z,C,P,A,R,n,B]);let se=null;if("system"===w&&Z)try{const e=`${Z.server}${Z.galaxy}:${Z.region}:${Z.system}`,t=L.get(e),s=t?t.length>0:void 0;let a;if(Array.isArray(t)&&t.length>0){const e=t.find(e=>"star"===e?.type);e&&e.starOverhaul&&(a=e.starOverhaul)}const r=`${Z.server}${Z.galaxy.toString().padStart(2,"0")}:${Z.region.toString().padStart(2,"0")}:${Z.system.toString().padStart(2,"0")}`;se=x.jsx(pi,{coord:r,hasStar:s,starOverhaul:a})}catch(ae){console.error("[UniverseMap] Error creating star panel:",ae),se=null}return I&&M&&F&&Y&&V?x.jsxs("div",{ref:r,className:"relative w-full h-full bg-gray-900 overflow-hidden",style:{border:"2px solid blue"},onClick:e=>console.log("[UniverseMap] Container div clicked!",{target:e.target}),onMouseDown:e=>console.log("[UniverseMap] Container mouse down!",{target:e.target}),children:[x.jsxs("div",{style:{position:"absolute",top:0,left:0,color:"white",zIndex:1e3,background:"rgba(0,0,0,0.8)",padding:"5px"},children:["Canvas: ",n.width,"x",n.height," | Zoom: ",w]}),x.jsx("canvas",{ref:a,width:n.width,height:n.height,onMouseMove:Y,onMouseLeave:()=>u(null),onClick:V,onMouseDown:e=>console.log("[UniverseMap] Canvas mouse down detected!",{x:e.clientX,y:e.clientY}),style:{cursor:"pointer",border:"1px solid red",position:"relative",zIndex:1,pointerEvents:"all"}}),x.jsxs("div",{style:{position:"absolute",top:30,left:0,color:"yellow",zIndex:1001,background:"rgba(0,0,0,0.8)",padding:"5px"},children:["Overlays: Region=","region"===w&&h&&Z?"YES":"NO"," | System=","system"===w&&h&&Z?"YES":"NO"," | Fleet=",A&&h&&p.length>0?"YES":"NO"]}),"region"===w&&h&&Z&&x.jsx(Zn,{canvas:a.current,selectedCoordinate:Z,showTerritories:P}),"system"===w&&h&&Z&&x.jsx(ri,{canvas:a.current,selectedCoordinate:Z,empire:t,showResources:R,serverBodies:L.get(`${Z.server}${Z.galaxy}:${Z.region}:${Z.system}`)}),A&&h&&p.length>0&&x.jsx(yi,{canvas:a.current,fleets:p,zoomLevel:w,selectedCoordinate:Z,canvasSize:n,onFleetClick:e=>{console.log("Fleet clicked:",e)}}),se,c&&x.jsx(Mn,{location:c,position:o}),S&&x.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:x.jsxs("div",{className:"text-white text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),x.jsx("p",{children:"Loading universe data..."})]})}),g&&A&&x.jsx("div",{className:"absolute top-4 right-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded z-40",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"}),x.jsx("span",{className:"text-sm",children:"Loading fleets..."})]})}),_&&x.jsx("div",{className:"absolute top-32 left-1/2 transform -translate-x-1/2 bg-red-900 border border-red-700 text-red-200 px-4 py-2 rounded-md z-30",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsxs("span",{children:["âš ï¸ ",_]}),x.jsx("button",{onClick:()=>F(null),className:"text-red-400 hover:text-red-200",children:"âœ•"})]})}),x.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2 z-10",children:[x.jsx("button",{onClick:I,className:"w-10 h-10 bg-gray-800 border border-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center justify-center",title:"Zoom In",children:"+"}),x.jsx("button",{onClick:M,className:"w-10 h-10 bg-gray-800 border border-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center justify-center",title:"Zoom Out",children:"âˆ’"})]})]}):(console.error("[UniverseMap] Critical functions missing, cannot render safely"),x.jsx("div",{className:"relative w-full h-full bg-gray-900 flex items-center justify-center",children:x.jsx("div",{className:"text-white",children:"Initializing universe map..."})}))},wi=({empire:e})=>e?x.jsx(bi,{children:x.jsx(ji,{empire:e})}):(console.warn("[UniverseMap] No empire provided, rendering loading state"),x.jsx("div",{className:"relative w-full h-full bg-gray-900 flex items-center justify-center",children:x.jsx("div",{className:"text-white",children:"Loading empire data..."})})),Ni=({empire:t,currentLocation:s,onDestinationSelect:a})=>{const[r,n]=e.useState(""),[i,o]=e.useState(""),[l,c]=e.useState(!1),[d,u]=e.useState(null),[h,m]=e.useState("map"),{selectedCoordinate:p,navigateToCoordinate:y,navigateToUniverse:g}=In(),f=e=>{try{const t=e.match(/^([A-Z])(\d{2}):(\d{2}):(\d{2}):(\d{2})$/);if(!t)return null;const[,s,a,r,n,i]=t;return{server:s,galaxy:parseInt(a),region:parseInt(r),system:parseInt(n),body:parseInt(i)}}catch{return null}},b=e=>{const t=e.galaxy.toString().padStart(2,"0"),s=e.region.toString().padStart(2,"0"),a=e.system.toString().padStart(2,"0"),r=e.body.toString().padStart(2,"0");return`${e.server}${t}:${s}:${a}:${r}`},v=async e=>{if(e===s)return u("Cannot dispatch to current location"),!1;if(!(e=>/^[A-Z]\d{2}:\d{2}:\d{2}:\d{2}$/.test(e))(e))return u("Invalid coordinate format. Use format: A00:12:34:56"),!1;c(!0),u(null);try{const t=await Rn.getLocationByCoord(e);if(t.success&&t.data){if("planet"===t.data.type||"asteroid"===t.data.type)return c(!1),!0;u("Invalid destination type. Can only travel to planets or asteroids.")}else u("Destination not found or inaccessible")}catch(t){u("Network error while validating destination")}return c(!1),!1};return e.useEffect(()=>{const e=f(s);e&&y(e)},[s]),x.jsx("div",{className:"space-y-4",children:x.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold mb-4",children:"Select Fleet Destination"}),x.jsxs("div",{className:"mb-4 p-3 bg-gray-700 rounded border border-gray-600",children:[x.jsx("div",{className:"text-sm text-gray-400",children:"Current Location"}),x.jsx("div",{className:"text-white font-mono text-lg",children:s})]}),x.jsxs("div",{className:"flex mb-4 bg-gray-700 p-1 rounded",children:[x.jsx("button",{onClick:()=>m("map"),className:"flex-1 py-2 px-4 rounded text-sm font-medium transition-colors "+("map"===h?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"ðŸ—ºï¸ Map Selection"}),x.jsx("button",{onClick:()=>m("input"),className:"flex-1 py-2 px-4 rounded text-sm font-medium transition-colors "+("input"===h?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:"âŒ¨ï¸ Manual Input"})]}),"map"===h&&x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"p-3 bg-blue-900/30 border border-blue-700 rounded text-blue-200 text-sm",children:[x.jsx("div",{className:"font-medium mb-1",children:"ðŸ“ Map Navigation"}),x.jsxs("ul",{className:"text-xs space-y-1 text-blue-300",children:[x.jsx("li",{children:"â€¢ Navigate through different zoom levels (Universe â†’ Galaxy â†’ Region â†’ System)"}),x.jsx("li",{children:"â€¢ Click on a location to select it as destination"}),x.jsx("li",{children:"â€¢ Use zoom controls or click areas to navigate"}),x.jsxs("li",{children:["â€¢ Selected coordinate: ",p?b(p):"None"]})]})]}),x.jsx("div",{className:"border border-gray-600 rounded-lg overflow-hidden bg-gray-900",children:x.jsx("div",{className:"h-96",children:x.jsx(wi,{empire:t})})}),x.jsxs("div",{className:"flex gap-3",children:[x.jsx("button",{onClick:async()=>{if(!p)return void u("Please select a location on the map");const e=b(p);await v(e)&&(n(e),o(e))},disabled:!p||l,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Validating...":"Use Selected Location"}),x.jsx("button",{onClick:g,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Reset Map View"})]})]}),"input"===h&&x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Destination Coordinate"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("input",{type:"text",value:i,onChange:e=>{o(e.target.value.toUpperCase()),u(null)},placeholder:"A00:12:34:56",className:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-blue-500 font-mono text-white",maxLength:12}),x.jsx("button",{onClick:async()=>{if(!i.trim())return void u("Please enter a coordinate");if(await v(i.trim())){n(i.trim());const e=f(i.trim());e&&y(e)}},disabled:l||!i.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Validating...":"Validate"})]}),x.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Format: ServerGalaxy:Region:System:Body (e.g., A00:12:34:56)"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("div",{className:"text-sm text-gray-400",children:"Quick Options:"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{onClick:()=>o(t.homeSystem||""),className:"px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",disabled:!t.homeSystem,children:"ðŸ  Home System"}),x.jsx("button",{onClick:()=>{const e=["A01:15:25:10","A02:30:45:15","B00:10:20:05"],t=e[Math.floor(Math.random()*e.length)];o(t)},className:"px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",children:"ðŸŽ² Random Location"})]})]})]}),d&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm",children:d}),r&&!d&&x.jsx("div",{className:"p-3 bg-green-900/30 border border-green-700 rounded",children:x.jsxs("div",{className:"text-sm text-green-200",children:[x.jsx("div",{className:"font-medium mb-1",children:"âœ… Valid Destination Selected"}),x.jsx("div",{className:"font-mono text-green-100",children:r})]})}),x.jsx("div",{className:"flex gap-3 mt-6",children:x.jsx("button",{onClick:()=>{r&&a(r)},disabled:!r||!!d,className:"flex-1 bg-green-600 text-white px-4 py-3 rounded font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"ðŸŽ¯ Confirm Destination"})}),x.jsx("div",{className:"mt-4 p-3 bg-gray-700/50 border border-gray-600 rounded",children:x.jsxs("div",{className:"text-sm text-gray-300",children:[x.jsx("div",{className:"font-medium mb-1",children:"ðŸ’¡ Navigation Tips:"}),x.jsxs("ul",{className:"text-xs space-y-1 text-gray-400",children:[x.jsx("li",{children:"â€¢ Use the map view for visual destination selection"}),x.jsx("li",{children:"â€¢ Use manual input for precise coordinate entry"}),x.jsx("li",{children:"â€¢ Fleet can only travel to accessible planets and asteroids"}),x.jsx("li",{children:"â€¢ Coordinate format: Server + Galaxy(2) + Region(2) + System(2) + Body(2)"})]})]})})]})})},ki=e.createContext(void 0),Si=()=>{const t=e.useContext(ki);if(!t)throw new Error("useToast must be used within a ToastProvider");return t},_i=({children:t})=>{const[s,a]=e.useState([]),r=e.useCallback(e=>{const t=Math.random().toString(36).slice(2),s={id:t,...e};if(a(e=>[...e,s]),0!==e.durationMs){const s="number"==typeof e.durationMs?e.durationMs:3500;window.setTimeout(()=>{a(e=>e.filter(e=>e.id!==t))},s)}return t},[]),n=e.useCallback(e=>{a(t=>t.filter(t=>t.id!==e))},[]),i=e.useCallback(()=>a([]),[]),o=e.useMemo(()=>({toasts:s,addToast:r,removeToast:n,clearToasts:i}),[s,r,n,i]);return x.jsx(ki.Provider,{value:o,children:t})},Ci=()=>{const{toasts:e,removeToast:t}=Si();return x.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>{const s="error"===e.type?"bg-red-900/70 text-red-200 border border-red-700":"success"===e.type?"bg-green-900/70 text-green-200 border border-green-700":"warning"===e.type?"bg-yellow-900/70 text-yellow-200 border border-yellow-700":"bg-gray-800/80 text-gray-200 border border-gray-700",a="error"===e.type?"bg-red-400":"success"===e.type?"bg-green-400":"warning"===e.type?"bg-yellow-400":"bg-blue-400",r="error"===e.type?"Error":"success"===e.type?"Success":"warning"===e.type?"Warning":"Notice";return x.jsxs("div",{className:`px-4 py-2 rounded shadow text-sm flex items-start gap-3 ${s}`,role:"status","aria-live":"polite",title:r,children:[x.jsx("span",{className:`mt-1 inline-block w-2 h-2 rounded-full ${a}`}),x.jsx("div",{className:"flex-1",children:e.text}),x.jsx("button",{className:"text-xs text-gray-400 hover:text-white",onClick:()=>t(e.id),"aria-label":"Dismiss",children:"âœ•"})]},e.id)})})},Pi=({fleet:t,empire:s,onDispatch:a,onCancel:r,isDispatching:n})=>{const[i,o]=e.useState(""),[l,c]=e.useState(null),[d,u]=e.useState(!1),[h,m]=e.useState(null),[p,y]=e.useState(!1),{addToast:g}=Si(),f=e=>/^-?\d+:-?\d+:-?\d+$/.test(e.trim());e.useEffect(()=>{if(!i.trim()||!f(i))return c(null),void m(null);if(i.trim()===t.locationCoord)return m("Cannot dispatch to current location"),void c(null);m(null),u(!0);(async()=>{try{const e=await En.estimateTravelTime(t._id,i.trim());if(e.success&&e.data)c(e.data.travelTimeHours);else{console.warn("Failed to estimate travel time:",e.error);c(1)}}catch(e){console.error("Error estimating travel time:",e);c(1)}finally{u(!1)}})()},[i,t.locationCoord,t._id]);return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700",children:[x.jsxs("h3",{className:"text-lg font-semibold text-empire-gold mb-3",children:["Dispatch Fleet: ",t.name]}),x.jsxs("div",{className:"mb-4 text-sm text-gray-300",children:[x.jsxs("div",{children:["Current Location: ",x.jsx("span",{className:"text-white font-mono",children:t.locationCoord})]}),x.jsxs("div",{children:["Fleet Size: ",x.jsx("span",{className:"text-white",children:t.sizeCredits.toLocaleString()})," credits"]}),x.jsxs("div",{children:["Units: ",x.jsx("span",{className:"text-white",children:t.units?.length||0})," unit types"]})]}),x.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i.trim())if(f(i))if(i.trim()!==t.locationCoord)try{m(null);const e=await a(i.trim());e.success?(g({type:"success",text:`Fleet "${t.name}" dispatched to ${i.trim()}`}),r()):(m(e.error||"Failed to dispatch fleet"),g({type:"error",text:e.error||"Failed to dispatch fleet"}))}catch(Jl){const t="Network error while dispatching fleet";m(t),g({type:"error",text:t})}else m("Cannot dispatch to current location");else m("Invalid coordinate format. Use format: x:y:z (e.g., 1:2:3)");else m("Please enter a destination coordinate")},className:"space-y-4",children:[x.jsxs("div",{className:"flex items-center gap-4 pb-2",children:[x.jsx("div",{className:"text-sm font-medium text-gray-300",children:"Selection Method:"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-3 py-1 rounded text-sm "+(p?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-blue-600 text-white"),disabled:n,children:"Manual Input"}),x.jsx("button",{type:"button",onClick:()=>y(!0),className:"px-3 py-1 rounded text-sm "+(p?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),disabled:n,children:"Map Selection"})]})]}),p?x.jsx(Ni,{empire:s,currentLocation:t.locationCoord,onDestinationSelect:o}):x.jsxs("div",{children:[x.jsx("label",{htmlFor:"destination",className:"block text-sm font-medium text-gray-300 mb-2",children:"Destination Coordinates"}),x.jsx("input",{id:"destination",type:"text",value:i,onChange:e=>o(e.target.value),placeholder:"e.g., 1:2:3",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-blue-500 font-mono text-white",disabled:n}),x.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Enter coordinates in the format x:y:z (e.g., 1:2:3)"})]}),i&&x.jsx("div",{className:"p-3 bg-gray-700 border border-gray-600 rounded",children:x.jsxs("div",{className:"text-sm text-gray-300",children:["Selected Destination: ",x.jsx("span",{className:"text-white font-mono",children:i})]})}),d&&x.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"}),"Calculating travel time..."]}),null!==l&&!d&&x.jsx("div",{className:"p-3 bg-blue-900/30 border border-blue-700 rounded",children:x.jsxs("div",{className:"text-sm text-blue-200",children:[x.jsx("div",{className:"font-medium",children:"Estimated Travel Time"}),x.jsx("div",{className:"text-lg font-mono text-blue-100 mt-1",children:(e=>{if(e<1)return`${Math.ceil(60*e)} minutes`;if(e<24)return Math.round(10*e)/10+" hours";{const t=Math.floor(e/24);return`${t} day${t>1?"s":""} ${Math.round(e%24)}h`}})(l)}),x.jsx("div",{className:"text-xs text-blue-300 mt-1",children:"Based on current fleet composition and distance"})]})}),h&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm",children:h}),x.jsxs("div",{className:"flex gap-3 pt-2",children:[x.jsx(On,{type:"submit",disabled:n||!i.trim()||!f(i)||i.trim()===t.locationCoord||d,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:n?x.jsxs("span",{className:"flex items-center justify-center gap-2",children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Dispatching..."]}):"Dispatch Fleet"}),x.jsx("button",{type:"button",onClick:r,disabled:n,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 disabled:opacity-50",children:"Cancel"})]})]})]}),x.jsx("div",{className:"p-3 bg-yellow-900/30 border border-yellow-700 rounded",children:x.jsxs("div",{className:"text-sm text-yellow-200",children:[x.jsx("div",{className:"font-medium mb-1",children:"âš ï¸ Important Notes:"}),x.jsxs("ul",{className:"space-y-1 text-xs text-yellow-300",children:[x.jsx("li",{children:"â€¢ Fleet will be unavailable for other actions while traveling"}),x.jsx("li",{children:"â€¢ You can recall the fleet during travel if needed"}),x.jsx("li",{children:"â€¢ Ensure the destination coordinate exists and is accessible"}),x.jsx("li",{children:"â€¢ Travel time depends on unit types and distance"}),x.jsx("li",{children:"â€¢ Use map selection for visual destination picking with territory info"}),x.jsx("li",{children:"â€¢ Manual entry allows precise coordinate specification"}),x.jsx("li",{children:"â€¢ Map selection validates accessibility automatically"})]})]})})]})},Ai=({movement:t,fleetName:s,onRecall:a,onRefresh:r,showRecallOption:n=!0})=>{const[i,o]=e.useState(null),[l,c]=e.useState(!1),[d,u]=e.useState(!1),[h,m]=e.useState(""),{addToast:p}=Si();e.useEffect(()=>{const e=()=>{if("travelling"!==t.status&&"pending"!==t.status)return void o(null);const e=(new Date).getTime(),s=new Date(t.estimatedArrivalTime).getTime()-e;o(s<=0?0:s/36e5)};e();const s=setInterval(e,6e4);return()=>clearInterval(s)},[t.estimatedArrivalTime,t.status]);const y=e=>{if(e<=0)return"Arriving shortly";if(e<1)return`${Math.ceil(60*e)} minutes`;if(e<24)return Math.round(10*e)/10+" hours";{const t=Math.floor(e/24);return`${t} day${t>1?"s":""} ${Math.round(e%24)}h`}},g=e=>new Date(e).toLocaleString(),f=()=>{if("travelling"!==t.status)return 0;const e=new Date(t.departureTime).getTime(),s=new Date(t.estimatedArrivalTime).getTime(),a=((new Date).getTime()-e)/(s-e)*100;return Math.max(0,Math.min(100,a))},b="travelling"===t.status||"pending"===t.status;return x.jsx("div",{className:"space-y-4",children:x.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Fleet Movement Status"}),r&&x.jsx("button",{onClick:r,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Refresh"})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("span",{className:"text-2xl",title:t.status,children:(e=>{switch(e){case"pending":return"â³";case"travelling":return"ðŸš€";case"arrived":return"ðŸŽ¯";case"recalled":return"â†©ï¸";case"failed":return"âŒ";default:return"â“"}})(t.status)}),x.jsxs("div",{children:[x.jsxs("div",{className:"text-white font-medium",children:["Status: ",x.jsx("span",{className:(e=>{switch(e){case"pending":return"text-yellow-400";case"travelling":return"text-blue-400";case"arrived":return"text-green-400";case"recalled":return"text-orange-400";case"failed":return"text-red-400";default:return"text-gray-400"}})(t.status),children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),x.jsxs("div",{className:"text-sm text-gray-400",children:["Fleet ID: ",t._id]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Origin:"}),x.jsx("div",{className:"text-white font-mono",children:t.originCoord})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Destination:"}),x.jsx("div",{className:"text-white font-mono",children:t.destinationCoord})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Departure:"}),x.jsx("div",{className:"text-white",children:g(t.departureTime)})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Expected Arrival:"}),x.jsx("div",{className:"text-white",children:g(t.estimatedArrivalTime)})]})]}),"travelling"===t.status&&x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{className:"flex justify-between items-center text-sm",children:[x.jsx("span",{className:"text-gray-400",children:"Progress"}),x.jsxs("span",{className:"text-white",children:[Math.round(f()),"%"]})]}),x.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:x.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-1000",style:{width:`${f()}%`}})}),null!==i&&x.jsxs("div",{className:"text-center text-blue-200 font-medium",children:[y(i)," remaining"]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Distance:"}),x.jsxs("div",{className:"text-white",children:[t.distance.toFixed(2)," units"]})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Fleet Speed:"}),x.jsxs("div",{className:"text-white",children:[t.fleetSpeed," u/h"]})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Travel Time:"}),x.jsx("div",{className:"text-white",children:y(t.travelTimeHours)})]})]}),t.actualArrivalTime&&x.jsx("div",{className:"p-3 bg-green-900/30 border border-green-700 rounded",children:x.jsxs("div",{className:"text-sm text-green-200",children:[x.jsx("div",{className:"font-medium",children:"Actual Arrival:"}),x.jsx("div",{className:"text-green-100 mt-1",children:g(t.actualArrivalTime)})]})}),"recalled"===t.status&&t.recallTime&&x.jsx("div",{className:"p-3 bg-orange-900/30 border border-orange-700 rounded",children:x.jsxs("div",{className:"text-sm text-orange-200",children:[x.jsx("div",{className:"font-medium",children:"Recalled:"}),x.jsx("div",{className:"text-orange-100 mt-1",children:g(t.recallTime)}),t.recallReason&&x.jsxs("div",{className:"text-orange-300 mt-1",children:["Reason: ",t.recallReason]})]})})]}),n&&b&&a&&!d&&x.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:x.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700",children:"Recall Fleet"})}),d&&x.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-3",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Recall Reason (Optional)"}),x.jsx("input",{type:"text",value:h,onChange:e=>m(e.target.value),placeholder:"e.g., Emergency return needed",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:border-orange-500 text-white",disabled:l})]}),x.jsxs("div",{className:"flex gap-3",children:[x.jsx(On,{onClick:async()=>{if(a){c(!0);try{const e=await a(h.trim()||void 0);e.success?(p({type:"success",text:`Fleet "${s}" recall order initiated`}),u(!1),m(""),r&&r()):p({type:"error",text:e.error||"Failed to recall fleet"})}catch(Jl){p({type:"error",text:"Network error while recalling fleet"})}finally{c(!1)}}},disabled:l,className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 disabled:opacity-50",children:l?x.jsxs("span",{className:"flex items-center gap-2",children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Recalling..."]}):"Confirm Recall"}),x.jsx("button",{onClick:()=>{u(!1),m("")},disabled:l,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 disabled:opacity-50",children:"Cancel"})]})]})]})})},Ri=({fleetId:t,empire:s,onFleetUpdate:a})=>{const[r,n]=e.useState(!0),[i,o]=e.useState(null),[l,c]=e.useState(null),[d,u]=e.useState(null),[h,m]=e.useState("overview"),[p,y]=e.useState(!1),{addToast:g}=Si(),f=async()=>{try{o(null),n(!0);const e=await En.getFleet(t);if(!e.success||!e.data)return void o(e.error||"Failed to load fleet data");c(e.data.fleet);const s=await En.getFleetStatus(t);s.success&&s.data&&u(s.data)}catch(Jl){o("Network error while loading fleet data")}finally{n(!1)}};e.useEffect(()=>{f()},[t]);const b=async()=>{try{const e=await En.getFleetStatus(t);e.success&&e.data&&(u(e.data),g({type:"info",text:"Fleet status refreshed"}))}catch(Jl){g({type:"error",text:"Failed to refresh fleet status"})}};if(r)return x.jsx("div",{className:"flex items-center justify-center py-8",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-500 border-t-transparent"}),x.jsx("span",{className:"text-gray-300",children:"Loading fleet data..."})]})});if(i||!l)return x.jsxs("div",{className:"p-4 bg-red-900/50 border border-red-700 rounded text-red-200",children:[x.jsx("div",{className:"font-medium",children:"Error Loading Fleet"}),x.jsx("div",{className:"text-sm mt-1",children:i||"Fleet not found"}),x.jsx("button",{onClick:f,className:"mt-2 px-3 py-1 bg-red-700 text-white rounded hover:bg-red-600 text-sm",children:"Retry"})]});const v=d?.fleet.isMoving||!1,j=d?.movement;return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex flex-wrap gap-2 p-3 bg-gray-800 rounded-lg border border-gray-700",children:[x.jsx("button",{onClick:()=>m("overview"),className:"px-4 py-2 rounded text-sm font-medium transition-colors "+("overview"===h?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"Fleet Overview"}),x.jsx("button",{onClick:()=>m("dispatch"),disabled:v,className:"px-4 py-2 rounded text-sm font-medium transition-colors "+("dispatch"===h?"bg-blue-600 text-white":v?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-gray-700 text-gray-300 hover:bg-gray-600"),title:v?"Fleet is currently moving":"Dispatch fleet to new location",children:v?"Fleet Moving":"Dispatch Fleet"}),j&&x.jsxs("button",{onClick:()=>m("movement"),className:"px-4 py-2 rounded text-sm font-medium transition-colors "+("movement"===h?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:["Movement Status",x.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-500 text-white text-xs rounded-full",children:j.status})]})]}),x.jsxs("div",{className:"min-h-[400px]",children:["overview"===h&&x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700",children:[x.jsxs("h3",{className:"text-lg font-semibold text-empire-gold mb-3",children:["Fleet Summary: ",l.name]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[x.jsxs("div",{children:[x.jsx("div",{className:"text-sm text-gray-400",children:"Current Location"}),x.jsx("div",{className:"text-white font-mono text-lg",children:l.locationCoord})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-sm text-gray-400",children:"Fleet Size"}),x.jsxs("div",{className:"text-white text-lg",children:[l.sizeCredits.toLocaleString()," credits"]})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-sm text-gray-400",children:"Unit Types"}),x.jsx("div",{className:"text-white text-lg",children:l.units?.length||0})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-sm text-gray-400",children:"Status"}),x.jsx("div",{className:"text-lg font-medium "+(v?"text-blue-400":"text-green-400"),children:v?"Moving":"Stationed"})]})]}),v&&j&&x.jsx("div",{className:"p-3 bg-blue-900/30 border border-blue-700 rounded",children:x.jsxs("div",{className:"text-sm text-blue-200",children:[x.jsx("div",{className:"font-medium",children:"Currently Moving"}),x.jsxs("div",{className:"mt-1",children:["From ",x.jsx("span",{className:"font-mono",children:j.originCoord})," to"," ",x.jsx("span",{className:"font-mono",children:j.destinationCoord})]}),x.jsxs("div",{className:"text-blue-300 mt-1",children:["Status: ",j.status," â€¢ ETA: ",new Date(j.estimatedArrivalTime).toLocaleString()]})]})}),x.jsxs("div",{className:"flex gap-3 mt-4",children:[x.jsx("button",{onClick:()=>m("dispatch"),disabled:v,className:"px-4 py-2 rounded font-medium "+(v?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:v?"Fleet Moving":"Dispatch Fleet"}),j&&x.jsx("button",{onClick:()=>m("movement"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"View Movement"}),x.jsx("button",{onClick:b,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Refresh Status"})]})]}),x.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700",children:[x.jsx("h4",{className:"text-md font-semibold text-empire-gold mb-3",children:"Fleet Composition"}),l.units&&l.units.length>0?x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-2 pr-4",children:"Unit Type"}),x.jsx("th",{className:"text-left py-2 pr-4",children:"Key"}),x.jsx("th",{className:"text-right py-2",children:"Count"})]})}),x.jsx("tbody",{className:"text-white",children:l.units.map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-2 pr-4 text-gray-200",children:e.name||e.unitKey}),x.jsx("td",{className:"py-2 pr-4 text-gray-400 font-mono",children:e.unitKey}),x.jsx("td",{className:"py-2 text-right font-mono",children:e.count.toLocaleString()})]},`${e.unitKey}-${t}`))})]})}):x.jsx("div",{className:"text-center text-gray-400 py-4",children:"No units in this fleet"})]})]}),"dispatch"===h&&s&&x.jsx(Pi,{fleet:l,empire:s,onDispatch:async e=>{y(!0);try{const s=await En.dispatchFleet(t,e);return s.success&&(await f(),m("movement"),a&&a()),s}catch(Jl){return{success:!1,error:"Network error while dispatching fleet"}}finally{y(!1)}},onCancel:()=>m("overview"),isDispatching:p}),"dispatch"===h&&!s&&x.jsxs("div",{className:"p-4 bg-red-900/50 border border-red-700 rounded text-red-200",children:[x.jsx("div",{className:"font-medium",children:"Empire Data Required"}),x.jsx("div",{className:"text-sm mt-1",children:"Empire information is required for fleet dispatch"})]}),"movement"===h&&j&&x.jsx(Ai,{movement:j,fleetName:l.name,onRecall:async e=>{try{const s=await En.recallFleet(t,e);return s.success&&(await f(),a&&a()),s}catch(Jl){return{success:!1,error:"Network error while recalling fleet"}}},onRefresh:b,showRecallOption:!0}),"movement"===h&&!j&&x.jsxs("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700 text-center",children:[x.jsx("div",{className:"text-gray-400 mb-2",children:"No movement data available"}),x.jsx("button",{onClick:()=>m("overview"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Back to Overview"})]})]})]})},Ti=({onUpdate:t})=>{const[s,a]=e.useState("list"),[r,n]=e.useState(null),[i,o]=e.useState(!0),[l,c]=e.useState(null),[d,u]=e.useState([]),{addToast:h}=Si(),m=async()=>{try{c(null),o(!0);const e=await En.getFleets();e.success&&e.data?u(e.data.fleets):(c(e.error||"Failed to load fleets"),h({type:"error",text:e.error||"Failed to load fleets"}))}catch(Jl){c("Network error while loading fleets"),h({type:"error",text:"Network error while loading fleets"})}finally{o(!1)}};e.useEffect(()=>{m()},[]);const p=()=>{a("list"),n(null),m()},y=()=>{t(),m()};return i?x.jsx("div",{className:"flex items-center justify-center py-12",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-500 border-t-transparent"}),x.jsx("span",{className:"text-gray-300",children:"Loading fleets..."})]})}):"detail"===s&&r?x.jsxs("div",{className:"space-y-4",children:[x.jsx("div",{className:"flex items-center justify-between",children:x.jsx("button",{onClick:p,className:"flex items-center gap-2 px-3 py-2 bg-gray-700 text-gray-200 rounded hover:bg-gray-600 transition-colors",children:"â† Back to Fleet List"})}),x.jsx(Ri,{fleetId:r,onFleetUpdate:y})]}):x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h3",{className:"text-xl font-semibold text-empire-gold",children:"Fleet Management"}),x.jsx("button",{onClick:m,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Refresh"})]}),l&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm",children:l}),0===d.length?x.jsxs("div",{className:"text-center py-12",children:[x.jsx("div",{className:"text-6xl mb-4",children:"ðŸš€"}),x.jsx("h4",{className:"text-lg font-semibold text-white mb-2",children:"No Fleets Available"}),x.jsx("p",{className:"text-gray-400 mb-6",children:"You currently have no fleets. Fleets are created automatically when you build ships at bases with spaceports."}),x.jsxs("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600 text-left max-w-md mx-auto",children:[x.jsx("h5",{className:"font-medium text-white mb-3",children:"How to get fleets:"}),x.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-blue-400",children:"ðŸ—ï¸"}),"Build a Spaceport at your base"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-green-400",children:"âš—ï¸"}),"Research ship technologies"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-yellow-400",children:"ðŸ”§"}),"Construct ships using the Units tab"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-purple-400",children:"ðŸš€"}),"Ships automatically form fleets"]})]})]})]}):x.jsxs("div",{children:[x.jsxs("div",{className:"mb-4 text-sm text-gray-400",children:[d.length," fleet",1!==d.length?"s":""," available"]}),x.jsx("div",{className:"space-y-3",children:d.map(e=>x.jsx("div",{className:"p-4 bg-gray-800 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors cursor-pointer",onClick:()=>{return t=e._id,n(t),void a("detail");var t},children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"flex-1",children:[x.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[x.jsx("h4",{className:"text-lg font-semibold text-white",children:e.name}),e.arrival&&x.jsx("span",{className:"px-2 py-1 bg-blue-500 text-white text-xs rounded-full",children:"Moving"})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Owner"}),x.jsx("div",{className:"text-gray-200",children:e.ownerName})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Size"}),x.jsxs("div",{className:"text-gray-200",children:[e.sizeCredits.toLocaleString()," credits"]})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-gray-400",children:"Status"}),x.jsx("div",{className:e.arrival?"text-blue-400":"text-green-400",children:e.arrival?"In Transit":"Stationed"})]})]})]}),x.jsxs("div",{className:"ml-4",children:[x.jsx("div",{className:"text-right text-sm text-gray-400",children:"Click to manage"}),x.jsx("div",{className:"text-right text-2xl mt-1",children:"â†’"})]})]})},e._id))})]}),x.jsxs("div",{className:"mt-8 p-4 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsx("h4",{className:"font-medium text-white mb-3",children:"ðŸš€ Fleet Movement System Active!"}),x.jsx("p",{className:"text-sm text-gray-300 mb-3",children:"Fleet movement and deployment features are now available! Select a fleet above to dispatch it to new locations."}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300",children:[x.jsxs("div",{children:[x.jsx("h5",{className:"font-medium text-white mb-2",children:"Available Now:"}),x.jsxs("ul",{className:"space-y-1",children:[x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-green-400",children:"âœ…"}),"Fleet deployment and movement"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-green-400",children:"âœ…"}),"Travel time calculations"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-green-400",children:"âœ…"}),"Fleet recall capabilities"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-green-400",children:"âœ…"}),"Real-time status tracking"]})]})]}),x.jsxs("div",{children:[x.jsx("h5",{className:"font-medium text-white mb-2",children:"Coming Soon:"}),x.jsxs("ul",{className:"space-y-1",children:[x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-yellow-400",children:"â³"}),"Combat and warfare systems"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-yellow-400",children:"â³"}),"Map-based destination selection"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-yellow-400",children:"â³"}),"Fleet formations and tactics"]}),x.jsxs("li",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-yellow-400",children:"â³"}),"Exploration missions"]})]})]})]})]})]})},Ei=[{key:"technologies",label:"Technologies"},{key:"structures",label:"Structures"},{key:"defenses",label:"Defenses"},{key:"units",label:"Units"},{key:"capacities",label:"Capacities"},{key:"terrains",label:"Terrains"},{key:"all",label:"All"}],Oi=({active:e,setActive:t})=>x.jsx("div",{className:"mb-4",children:x.jsx("div",{className:"flex gap-1 bg-gray-700 p-1 rounded-lg border border-gray-600",children:Ei.map(s=>x.jsx("button",{onClick:()=>t(s.key),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors "+(e===s.key?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-600"),children:s.label},s.key))})}),Ii=()=>{const t=e.useMemo(()=>Object.values(on).slice().sort((e,t)=>e.creditsCost-t.creditsCost),[]);return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Technologies"})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Technology"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Credits"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Labs Level"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Requires"})]})}),x.jsx("tbody",{children:t.map(e=>{const t=0===e.prerequisites.length?"â€”":e.prerequisites.map(e=>`${ln(e.key).name} ${e.level}`).join(", ");return x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/60",children:[x.jsxs("td",{className:"py-2 px-3",children:[x.jsx("div",{className:"text-white",children:e.name}),e.description?x.jsx("div",{className:"text-xs text-gray-400",children:e.description}):null]}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.creditsCost.toLocaleString()}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.requiredLabs}),x.jsx("td",{className:"py-2 px-3 "+(e.prerequisites.length?"text-red-400":"text-gray-400"),children:t})]},e.key)})})]})})]})},Mi=()=>{const t=e.useMemo(()=>hn().slice().sort((e,t)=>e.creditsCost-t.creditsCost),[]),s=e=>{switch(e.key){case"urban_structures":return"Increases population capacity by base fertility.";case"solar_plants":return"Increases base energy output by base solar energy.";case"gas_plants":return"Increases base energy output by base gas resource.";case"fusion_plants":case"antimatter_plants":case"orbital_plants":return`Increases base energy output by ${e.energyDelta}.`;case"research_labs":return"Increases bases research by 8, allows new technologies.";case"metal_refineries":return"Increases production and construction by base metal resource.";case"crystal_mines":return"Increases economy by base crystals resource.";case"robotic_factories":return"Increases production and construction by 2.";case"shipyards":return"Increases production by 2 and allows new units.";case"orbital_shipyards":return"Increases production by 8 and allows new units.";case"spaceports":return`Increases economy by ${e.economy} and allows trade routes.`;case"command_centers":return"Adds 5% fleet attack power at base and allows 1 occupation.";case"nanite_factories":return"Increases production and construction by 4.";case"android_factories":return"Increases production and construction by 6.";case"economic_centers":return`Increases economy by ${e.economy}.`;case"terraform":return"Increases base area by 5.";case"multi_level_platforms":return"Increases base area by 10.";case"orbital_base":return"Increases population capacity by 10.";case"jump_gate":return"Increases fleet speed by 70% and allows travel between galaxies.";case"biosphere_modification":return"Increases planet fertility by 1.";case"capital":return"Increases economy by 10 and other bases by 1. -15% empire income while occupied.";default:return e.energyDelta>0?`Increases base energy output by ${e.energyDelta}.`:e.energyDelta<0?`Consumes ${Math.abs(e.energyDelta)} energy.`:e.economy>0?`Increases economy by ${e.economy}.`:"â€”"}},a=["orbital_base","jump_gate"],r={terraform:5,multi_level_platforms:10},n=e=>{if(a.includes(e.key))return"";const t=r[e.key];return"number"==typeof t?`+${t}`:"number"==typeof e.areaRequired?0===e.areaRequired?"":`-${e.areaRequired}`:"-1"};return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Structures"})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Structure"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Credits"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Energy"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Economy"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Population"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Area"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Advanced"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Requires"})]})}),x.jsx("tbody",{children:t.map(e=>{const t=0===e.techPrereqs.length?"â€”":e.techPrereqs.map(e=>`${ln(e.key).name} ${e.level}`).join(", ");return x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/60",children:[x.jsxs("td",{className:"py-2 px-3",children:[x.jsx("div",{className:"text-white",children:e.name}),x.jsx("div",{className:"text-xs text-gray-400",children:s(e)})]}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.creditsCost.toLocaleString()}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:"solar_plants"===e.key||"gas_plants"===e.key||0===e.energyDelta?"":String(e.energyDelta)}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:0===e.economy?"":e.economy}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:"orbital_base"===e.key?"+10":0===e.populationRequired?"":`-${e.populationRequired}`}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:n(e)}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.advanced?"x":""}),x.jsx("td",{className:"py-2 px-3 "+(e.techPrereqs.length?"text-red-400":"text-gray-400"),children:t})]},e.key)})})]})})]})},Fi=()=>{const t=e.useMemo(()=>Object.values(wn).slice().sort((e,t)=>e.creditsCost-t.creditsCost),[]),s=e=>{switch(e){case"barracks":return"Help protect your bases, the cheapest defense.";case"laser_turrets":return"Small defenses, good against small units.";case"missile_turrets":return"Small defenses, good against small and medium units.";case"plasma_turrets":case"ion_turrets":return"Average defenses, good against medium units.";case"photon_turrets":return"Big defenses, good against large units.";case"disruptor_turrets":return"Biggest turrets, good against large units.";case"deflection_shields":return"Strong shields that increase bases protection.";case"planetary_shield":return"Planetary shields that increases bases protection.";case"planetary_ring":return"Planetary defensive ring.";default:return""}},a=e=>"number"==typeof e.areaRequired?0===e.areaRequired?"":`-${e.areaRequired}`:"-1";return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Defenses"})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Defense"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Credits"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Weapon"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Attack"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Armour"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Shield"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Energy"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Area"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Requires"})]})}),x.jsx("tbody",{children:t.map(e=>{const t=0===e.techPrereqs.length?"â€”":e.techPrereqs.map(e=>`${ln(e.key).name} ${e.level}`).join(", ");return x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/60",children:[x.jsxs("td",{className:"py-2 px-3",children:[x.jsx("div",{className:"text-white",children:e.name}),x.jsx("div",{className:"text-xs text-gray-400",children:s(e.key)})]}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.creditsCost.toLocaleString()}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.weapon??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.attack?e.attack:""}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.armour?e.armour:""}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:"number"==typeof e.shield&&0!==e.shield?e.shield:""}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:0===e.energyDelta?"":String(e.energyDelta)}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:a(e)}),x.jsx("td",{className:"py-2 px-3 "+(e.techPrereqs.length?"text-red-400":"text-gray-400"),children:t})]},e.key)})})]})}),x.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"Each level of defenses requires 1 Population."})]})},$i=()=>{const t=e.useMemo(()=>Object.values(Nn).slice().sort((e,t)=>e.creditsCost-t.creditsCost),[]),s=e=>e.requiredShipyardLevel&&e.requiredOrbitalShipyardLevel?`${e.requiredShipyardLevel} (${e.requiredOrbitalShipyardLevel})`:e.requiredShipyardLevel?`${e.requiredShipyardLevel}`:"â€”",a=e=>{switch(e){case"fighter":return"Good fighting unit against unshielded units.";case"bomber":return"Good fighting unit against unshielded and low shield units.";case"cruiser":return"Versatile unit, good for long range action and escort.";case"carrier":return"Unit with 80 hangar spaces.";case"fleet_carrier":return"Large carrier with 500 hangar spaces.";case"death_star":return"Biggest unit, canâ€™t use jump gates, gives +10% power and armour to fleet.";default:return""}};return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Units"})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Unit"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Credits"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Drive"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Weapon"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Attack"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Armour"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Shield"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Hangar"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Speed"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Shipyard"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Requires"})]})}),x.jsx("tbody",{children:t.map(e=>{const t=0===e.techPrereqs.length?"â€”":e.techPrereqs.map(e=>`${ln(e.key).name} ${e.level}`).join(", ");return x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/60",children:[x.jsxs("td",{className:"py-2 px-3",children:[x.jsx("div",{className:"text-white",children:e.name}),e.description??a(e.key)?x.jsx("div",{className:"text-xs text-gray-400",children:e.description??a(e.key)}):null]}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.creditsCost.toLocaleString()}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.drive??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.weapon??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.attack??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.armour??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.shield??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.hangar??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:e.speed??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-300",children:s(e)}),x.jsx("td",{className:"py-2 px-3 "+(e.techPrereqs.length?"text-red-400":"text-gray-400"),children:t})]},e.key)})})]})}),x.jsxs("div",{className:"mt-2 text-xs text-gray-400 space-y-1",children:[x.jsx("p",{children:"* Can move a galaxy away (200 distance)."}),x.jsx("p",{children:"Note: Shipyard 20 (1) means that it requires Shipyard Level 20 and Orbital Shipyard Level 1."})]})]})},Li=()=>x.jsx("div",{className:"space-y-6",children:x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Capacities"})}),x.jsxs("div",{className:"space-y-6 text-sm text-gray-200",children:[x.jsxs("div",{children:[x.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Construction Capacity"}),x.jsx("p",{className:"text-gray-300 mb-2",children:"Determines how quickly structures and defenses are built at a base. Measured in credits per hour (cred/h)."}),x.jsxs("ul",{className:"list-disc ml-5 text-gray-300 space-y-1",children:[x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"New Base Baseline:"})," 40 cred/h (even with no capacity buildings)."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Metal Refineries:"})," + base metal resource value per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Robotic Factories:"})," +2 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Nanite Factories:"})," +4 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Android Factories:"})," +6 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Cybernetics Technology:"})," +5% across all bases."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Construction Commander:"})," reduces construction time by 1% per commander level. (Hook)"]})]}),x.jsxs("div",{className:"mt-2 p-2 rounded bg-gray-800 border border-gray-700 text-gray-200",children:[x.jsx("div",{className:"text-gray-300",children:"Formula"}),x.jsx("div",{className:"font-mono text-gray-100",children:"Construction Time (hours) = Structure Cost (credits) / Construction Capacity (cred/h)"})]})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Production Capacity"}),x.jsx("p",{className:"text-gray-300 mb-2",children:"Determines how quickly ships and goods are produced at a base. Measured in cred/h."}),x.jsxs("ul",{className:"list-disc ml-5 text-gray-300 space-y-1",children:[x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Baseline:"})," 0 cred/h (requires structures/tech to increase)."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Shipyards:"})," +2 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Orbital Shipyards:"})," +8 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Metal Refineries:"})," + base metal resource value per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Robotic Factories:"})," +2 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Nanite Factories:"})," +4 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Android Factories:"})," +6 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Cybernetics Technology:"})," +5% across all bases."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Production Commander:"})," reduces production time by 1% per commander level. (Hook)"]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Double Production:"})," optional mode to halve time for extra cost. (Planned)"]})]}),x.jsxs("div",{className:"mt-2 p-2 rounded bg-gray-800 border border-gray-700 text-gray-200",children:[x.jsx("div",{className:"text-gray-300",children:"Formula"}),x.jsx("div",{className:"font-mono text-gray-100",children:"Production Time (hours) = Unit Cost (credits) / Production Capacity (cred/h)"})]})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Research Capacity"}),x.jsx("p",{className:"text-gray-300 mb-2",children:"Determines how quickly technologies can be researched at a base. Measured in cred/h."}),x.jsxs("ul",{className:"list-disc ml-5 text-gray-300 space-y-1",children:[x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Baseline:"})," 0 cred/h."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Research Labs:"})," +8 per level."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Artificial Intelligence Technology:"})," +5% across all bases."]}),x.jsxs("li",{children:[x.jsx("span",{className:"text-empire-gold",children:"Research Commander:"})," reduces research time by 1% per commander level. (Hook)"]})]}),x.jsxs("div",{className:"mt-2 p-2 rounded bg-gray-800 border border-gray-700 text-gray-200",children:[x.jsx("div",{className:"text-gray-300",children:"Formula"}),x.jsx("div",{className:"font-mono text-gray-100",children:"Research Time (hours) = Technology Cost (credits) / Research Capacity (cred/h)"})]})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"text-base font-semibold text-white mb-1",children:"Example Calculations"}),x.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[x.jsxs("div",{className:"p-3 rounded bg-gray-800 border border-gray-700",children:[x.jsx("div",{className:"text-gray-300 font-semibold mb-1",children:"Construction"}),x.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[x.jsx("li",{children:"Structure cost: 100 credits"}),x.jsx("li",{children:"Construction capacity: 20 cred/h"}),x.jsxs("li",{children:["Time: ",x.jsx("span",{className:"font-mono text-white",children:"100 / 20 = 5 hours"})]})]})]}),x.jsxs("div",{className:"p-3 rounded bg-gray-800 border border-gray-700",children:[x.jsx("div",{className:"text-gray-300 font-semibold mb-1",children:"Production"}),x.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[x.jsx("li",{children:"Unit cost: 50 credits"}),x.jsx("li",{children:"Production capacity: 10 cred/h"}),x.jsxs("li",{children:["Time: ",x.jsx("span",{className:"font-mono text-white",children:"50 / 10 = 5 hours"})]})]})]}),x.jsxs("div",{className:"p-3 rounded bg-gray-800 border border-gray-700",children:[x.jsx("div",{className:"text-gray-300 font-semibold mb-1",children:"Research"}),x.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[x.jsx("li",{children:"Technology cost: 80 credits"}),x.jsx("li",{children:"Research capacity: 40 cred/h"}),x.jsxs("li",{children:["Time: ",x.jsx("span",{className:"font-mono text-white",children:"80 / 40 = 2 hours"})]})]})]})]}),x.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"Percent bonuses (e.g., Cybernetics, AI) apply to the total capacity after flat additions. Commander reductions apply to time."})]})]})]})}),qi=()=>x.jsxs("div",{className:"space-y-6",children:[x.jsx(Ui,{}),x.jsx(Di,{}),x.jsx(Wi,{})]}),Ui=()=>{const t=e.useMemo(()=>Object.entries(pn).filter(([e])=>"Asteroid"!==e).map(([e,t])=>({name:e,metal:t.metal??0,gas:t.gas??0,crystals:t.crystals??0,fertility:t.fertility??0,areaPlanet:t.areaPlanet??void 0,areaMoon:t.areaMoon??void 0})).sort((e,t)=>e.name.localeCompare(t.name)),[]);return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Terrains"})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Terrain"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Metal"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Gas"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Crystals"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Fertility"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Area Planet"})]})}),x.jsx("tbody",{children:t.map(e=>x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/60",children:[x.jsx("td",{className:"py-2 px-3 text-white",children:e.name}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.metal}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.gas}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.crystals}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.fertility}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.areaPlanet?e.areaPlanet:"â€”"})]},e.name))})]})}),x.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"Values shown are baseline terrain attributes. Final planet yields and fertility also depend on orbit position and star kind modifiers."})]})},Di=()=>{const t=e.useMemo(()=>Array.from({length:8},(e,t)=>t+1),[]),s=e.useMemo(()=>t.map(e=>({p:e,base:xn(e)})),[t]),a=e.useMemo(()=>[0,0,0,1,1,1,2,2],[]);return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Astro Position Effects (Base)"})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Effect"}),t.map(e=>x.jsxs("th",{className:"py-2 px-3 text-center",children:["P",e]},e))]})}),x.jsxs("tbody",{children:[x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Solar Energy"}),s.map(({p:e,base:t})=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:t.solarEnergy},`se-${e}`))]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Fertility"}),s.map(({p:e,base:t})=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:t.fertility},`fert-${e}`))]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Gas"}),t.map((e,t)=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:a[t]},`gas-${e}`))]})]})]})}),x.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"Star kind can modify these base values further and can add or remove resource yields at certain positions."})]})},Wi=()=>{const t=e.useMemo(()=>fn.map(e=>e.kind),[]),[s,a]=e.useState(t[0]||"YELLOW"),r=e.useMemo(()=>Array.from({length:8},(e,t)=>t+1),[]),n=e.useMemo(()=>r.map(e=>{const t=((e,t)=>{const s=jn(t);let a,r=0,n=0;switch(e){case"RED_GIANT":s>=1&&s<=3&&(n+=-1),s>=5&&s<=8&&(n+=1),s>=1&&s<=4&&(r+=-1),a=mn(a,{gas:2});break;case"SUPER_GIANT":s>=1&&s<=4&&(r+=2),s>=1&&s<=4&&(n+=-2),a=mn(a,{crystals:1});break;case"BLUE":s>=1&&s<=3&&(r+=2),s>=1&&s<=3&&(n+=-2),s>=4&&s<=6&&(a=mn(a,{metal:1,gas:1}));break;case"NEUTRON":s>=1&&s<=3&&(n+=-3),r+=s%2==0?2:-2,s>=4&&s<=8&&(a=mn(a,{metal:3}));break;case"WHITE":s>=1&&s<=5&&(r+=1),s>=2&&s<=4&&(n+=1),s>=3&&s<=6&&(a=mn(a,{gas:1})),a=mn(a,{crystals:-1});break;case"WHITE_DWARF":r+=-2,s>=5&&s<=8&&(n+=2),s>=1&&s<=4&&(a=mn(a,{metal:2})),a=mn(a,{gas:-1});break;case"ORANGE":s>=3&&s<=6&&(n+=1),s>=1&&s<=3&&(a=mn(a,{gas:1}));break;case"YELLOW":s>=2&&s<=4&&(r+=1),n+=1,s>=6&&s<=8&&(a=mn(a,{gas:-1}))}return{solarEnergyDelta:r,fertilityDelta:n,resourceDelta:a}})(s,e);return{p:e,solar:t.solarEnergyDelta,fert:t.fertilityDelta,metal:t.resourceDelta?.metal??0,gas:t.resourceDelta?.gas??0,crystals:t.resourceDelta?.crystals??0}}),[s,r]);return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Star Kind Modifiers by Orbit Position"}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("label",{className:"text-sm text-gray-300",children:"Star Kind:"}),x.jsx("select",{className:"bg-gray-800 border border-gray-600 text-gray-200 text-sm rounded-md px-2 py-1",value:s,onChange:e=>a(e.target.value),children:t.map(e=>x.jsx("option",{value:e,children:e.replace(/_/g," ")},e))})]})]}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Effect Î”"}),r.map(e=>x.jsxs("th",{className:"py-2 px-3 text-center",children:["P",e]},e))]})}),x.jsxs("tbody",{children:[x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Solar Energy"}),n.map(e=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:e.solar},`s-${e.p}`))]}),x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Fertility"}),n.map(e=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:e.fert},`f-${e.p}`))]}),x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Metal"}),n.map(e=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:e.metal},`m-${e.p}`))]}),x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Gas"}),n.map(e=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:e.gas},`g-${e.p}`))]}),x.jsxs("tr",{children:[x.jsx("td",{className:"py-2 px-3 text-white",children:"Crystals"}),n.map(e=>x.jsx("td",{className:"py-2 px-3 text-gray-200 text-center",children:e.crystals},`c-${e.p}`))]})]})]})}),x.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"This table shows how the selected star kind modifies the base orbit effects and terrain yields. Final planet values are: Terrain baseline + Star resource deltas + Base Orbit (Solar/Fertility) + Star Solar/Fertility deltas."})]})},Bi=({initialTab:t})=>{const[s,a]=e.useState(t??"technologies");return x.jsxs("div",{className:"space-y-4",children:[x.jsx(Oi,{active:s,setActive:a}),x.jsxs("div",{className:"max-h-[70vh] overflow-y-auto pr-1",children:["technologies"===s&&x.jsx(Ii,{}),"structures"===s&&x.jsx(Mi,{}),"defenses"===s&&x.jsx(Fi,{}),"units"===s&&x.jsx($i,{}),"capacities"===s&&x.jsx(Li,{}),"terrains"===s&&x.jsx(qi,{}),"all"===s&&x.jsxs("div",{className:"space-y-6",children:[x.jsx(Ii,{}),x.jsx(Mi,{}),x.jsx(Fi,{}),x.jsx($i,{}),x.jsx(qi,{})]})]})]})},zi=({title:e,result:t})=>{const s=function(e=[]){const t={baseline:[],buildings:[],location:[],tech:[],commander:[],other:[]},s=e=>"Shipyards (+2 per level)"===e||e.startsWith("Research Labs")||"Robotic Factories"===e||"Nanite Factories"===e||"Android Factories"===e||e.startsWith("Metal Refineries");for(const a of e){const e=a.source||"";"Baseline"===e?t.baseline.push(a):s(e)?t.buildings.push(a):e.startsWith("Environment:")?t.location.push(a):e.startsWith("Tech:")?t.tech.push(a):"Commander Bonus"===e?t.commander.push(a):t.other.push(a)}return t}(t.breakdown||[]),a=({label:e,items:t})=>t&&0!==t.length?x.jsxs("div",{className:"mb-2",children:[x.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide mb-1",children:e}),x.jsx("div",{className:"space-y-1",children:t.map((t,s)=>{return x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-300",children:t.source}),x.jsx("span",{className:"text-gray-200",children:(a=t,"percent"===a.kind?`+${Math.round(100*a.value)}%`:`+${Math.round(a.value).toLocaleString()} cred./h`)})]},`${e}-${s}`);var a})})]}):null;return x.jsxs("div",{className:"mb-4 border border-gray-700 rounded-lg p-3",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("h4",{className:"font-semibold text-white",children:e}),x.jsxs("div",{className:"text-sm text-gray-300",children:["Total: ",x.jsx("span",{className:"font-mono",children:(r=t.value,`${Math.round(r).toLocaleString()} cred./h`)})]})]}),x.jsx(a,{label:"Baseline",items:s.baseline}),x.jsx(a,{label:"Buildings",items:s.buildings}),x.jsx(a,{label:"Location",items:s.location}),x.jsx(a,{label:"Tech",items:s.tech}),x.jsx(a,{label:"Commander",items:s.commander}),x.jsx(a,{label:"Other",items:s.other})]});var r},Hi=({data:e})=>{if(!e?.capacities)return x.jsx("div",{className:"text-gray-400 text-sm",children:"No capacity data available."});const{coord:t,capacities:s}=e;return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"text-sm text-gray-400",children:["Base: ",x.jsx("span",{className:"text-white",children:t})]}),x.jsx(zi,{title:"Construction Capacity",result:s.construction}),x.jsx(zi,{title:"Production Capacity",result:s.production}),x.jsx(zi,{title:"Research Capacity",result:s.research}),x.jsxs("div",{className:"text-xs text-gray-500",children:["Notes:",x.jsxs("ul",{className:"list-disc ml-5 mt-1",children:[x.jsx("li",{children:"Percent bonuses are applied after summing all flat contributions."}),x.jsx("li",{children:"Cybernetics provides +5% to Construction and Production; Artificial Intelligence provides +5% to Research."}),x.jsx("li",{children:"Values are rounded for display."})]})]})]})},Zi=e=>e.toLocaleString(),Gi=({label:e,value:t,negative:s})=>Number.isFinite(t)&&0!==t?x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-300",children:e}),x.jsxs("span",{className:s?"text-red-300 font-mono":"text-gray-200 font-mono",children:[s?"-":"+",Zi(Math.abs(t))]})]}):null,Ki=({title:e,children:t,total:s,totalLabel:a})=>x.jsxs("div",{className:"mb-4 border border-gray-700 rounded-lg p-3",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("h4",{className:"font-semibold text-white",children:e}),Number.isFinite(s)&&x.jsxs("div",{className:"text-sm text-gray-300",children:[a||"Total",":"," ",x.jsx("span",{className:"font-mono",children:Zi(s)})]})]}),x.jsx("div",{className:"space-y-1",children:t})]}),Yi=({data:e})=>{if(!e)return x.jsx("div",{className:"text-gray-400 text-sm",children:"No energy data available."});const{coord:t,totals:s,breakdown:a}=e,r=(a.baseline||0)+(a.solar||0)+(a.gas||0)+(a.producers||[]).reduce((e,t)=>e+(t.value||0),0),n=(a.consumers||[]).reduce((e,t)=>e+(t.value||0),0);return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"text-sm text-gray-400",children:["Base: ",x.jsx("span",{className:"text-white",children:t})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Produced"}),x.jsxs("div",{className:"mt-1 text-lg text-green-300 font-mono",children:["+",Zi(s.produced)]})]}),x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Consumed"}),x.jsxs("div",{className:"mt-1 text-lg text-red-300 font-mono",children:["-",Zi(s.consumed)]})]}),x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Balance"}),x.jsx("div",{className:"mt-1 text-lg font-mono "+(s.balance>=0?"text-green-300":"text-red-300"),children:Zi(s.balance)})]})]}),x.jsxs(Ki,{title:"Produced",total:r,totalLabel:"Produced",children:[x.jsxs("div",{className:"space-y-1",children:[x.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Baseline & Context"}),x.jsx(Gi,{label:"Baseline",value:a.baseline||0}),x.jsx(Gi,{label:"Solar Plants Ã— solarEnergy",value:a.solar||0}),x.jsx(Gi,{label:"Gas Plants Ã— gasYield",value:a.gas||0})]}),(a.producers||[]).length>0&&x.jsxs("div",{className:"mt-2 space-y-1",children:[x.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Other Producers"}),(a.producers||[]).map(e=>x.jsx(Gi,{label:e.name,value:e.value},`p-${e.key}`))]})]}),x.jsxs(Ki,{title:"Consumed",total:n,totalLabel:"Consumed",children:[0===(a.consumers||[]).length&&x.jsx("div",{className:"text-sm text-gray-400",children:"No energy consumption from structures."}),(a.consumers||[]).map(e=>x.jsx(Gi,{label:e.name,value:-Math.abs(e.value),negative:!0},`c-${e.key}`))]}),"number"==typeof s.reservedNegative||a.reserved&&a.reserved.length>0?x.jsxs(Ki,{title:"Reserved (Queued Consumers)",children:["number"==typeof s.reservedNegative&&0!==s.reservedNegative&&x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-300",children:"Reserved Total"}),x.jsx("span",{className:"text-yellow-300 font-mono",children:Zi(s.reservedNegative)})]}),(a.reserved||[]).map(e=>x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-300",children:e.name}),x.jsx("span",{className:"text-yellow-300 font-mono",children:Zi(e.value)})]},`r-${e.key}`)),a.reserved&&0!==a.reserved.length?null:x.jsx("div",{className:"text-sm text-gray-500",children:"No queued reservations counted."})]}):null,x.jsxs("div",{className:"text-xs text-gray-500",children:["Notes:",x.jsxs("ul",{className:"list-disc ml-5 mt-1 space-y-1",children:[x.jsx("li",{children:"Baseline adds a constant +2 energy per base."}),x.jsx("li",{children:"Solar/Gas plants scale by planet context (solarEnergy / gas yield)."}),x.jsx("li",{children:"Other structures use the catalog energyDelta per level."}),x.jsx("li",{children:"Totals align with the shared helper used by both client and server."})]})]})]})},Vi=e=>e.toLocaleString(),Ji=({label:e,value:t})=>Number.isFinite(t)&&0!==t?x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-300",children:e}),x.jsx("span",{className:"text-gray-200 font-mono",children:Vi(t)})]}):null,Qi=({title:e,children:t,total:s,totalLabel:a})=>x.jsxs("div",{className:"mb-4 border border-gray-700 rounded-lg p-3",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("h4",{className:"font-semibold text-white",children:e}),Number.isFinite(s)&&x.jsxs("div",{className:"text-sm text-gray-300",children:[a||"Total",": ",x.jsx("span",{className:"font-mono",children:Vi(s)})]})]}),x.jsx("div",{className:"space-y-1",children:t})]}),Xi=({data:e})=>{if(!e)return x.jsx("div",{className:"text-gray-400 text-sm",children:"No area data available."});const{coord:t,totals:s,breakdown:a}=e,r=(a.consumers||[]).reduce((e,t)=>e+(t.value||0),0);return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"text-sm text-gray-400",children:["Base: ",x.jsx("span",{className:"text-white",children:t})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Used"}),x.jsx("div",{className:"mt-1 text-lg text-gray-200 font-mono",children:Vi(s.used)})]}),x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Free"}),x.jsx("div",{className:"mt-1 text-lg text-green-300 font-mono",children:Vi(s.free)})]}),x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Total"}),x.jsx("div",{className:"mt-1 text-lg text-gray-200 font-mono",children:Vi(s.total)})]})]}),x.jsxs(Qi,{title:"Structures using area",total:r,totalLabel:"Used",children:[0===(a.consumers||[]).length&&x.jsx("div",{className:"text-sm text-gray-400",children:"No structures currently using area."}),(a.consumers||[]).map(e=>x.jsx(Ji,{label:e.name,value:e.value},`a-${e.key}`))]}),x.jsxs("div",{className:"text-xs text-gray-500",children:["Notes:",x.jsxs("ul",{className:"list-disc ml-5 mt-1 space-y-1",children:[x.jsx("li",{children:"Totals are authoritative from the server Base Stats."}),x.jsx("li",{children:"Per-structure area usage uses catalog areaRequired Ã— level when available."}),x.jsx("li",{children:"Some orbital structures may use 0 area."})]})]})]})},eo=e=>e.toLocaleString(),to=({label:e,value:t})=>Number.isFinite(t)&&0!==t?x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-300",children:e}),x.jsx("span",{className:"text-gray-200 font-mono",children:eo(t)})]}):null,so=({title:e,children:t,total:s,totalLabel:a})=>x.jsxs("div",{className:"mb-4 border border-gray-700 rounded-lg p-3",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("h4",{className:"font-semibold text-white",children:e}),Number.isFinite(s)&&x.jsxs("div",{className:"text-sm text-gray-300",children:[a||"Total",": ",x.jsx("span",{className:"font-mono",children:eo(s)})]})]}),x.jsx("div",{className:"space-y-1",children:t})]}),ao=({data:e})=>{if(!e)return x.jsx("div",{className:"text-gray-400 text-sm",children:"No population data available."});const{coord:t,totals:s,breakdown:a}=e,r=a.users||[],n=a.sources||[],i=r.reduce((e,t)=>e+(t.value||0),0),o=n.reduce((e,t)=>e+(t.value||0),0);return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"text-sm text-gray-400",children:["Base: ",x.jsx("span",{className:"text-white",children:t})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Used"}),x.jsx("div",{className:"mt-1 text-lg text-gray-200 font-mono",children:eo(s.used)})]}),x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Free"}),x.jsx("div",{className:"mt-1 text-lg text-green-300 font-mono",children:eo(s.free)})]}),x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:"Capacity"}),x.jsx("div",{className:"mt-1 text-lg text-gray-200 font-mono",children:eo(s.capacity)})]})]}),x.jsxs(so,{title:"Users (population required by structures)",total:i,totalLabel:"Used",children:[0===r.length&&x.jsx("div",{className:"text-sm text-gray-400",children:"No structures currently consuming population."}),r.map(e=>x.jsx(to,{label:e.name,value:e.value},`u-${e.key}`))]}),x.jsx(so,{title:"Capacity Sources",total:o,totalLabel:"Capacity",children:0===n.length?x.jsx("div",{className:"text-sm text-gray-400",children:"No per-building capacity sources are defined. Showing totals only."}):n.map(e=>x.jsx(to,{label:e.name,value:e.value},`s-${e.key}`))}),x.jsxs("div",{className:"text-xs text-gray-500",children:["Notes:",x.jsxs("ul",{className:"list-disc ml-5 mt-1 space-y-1",children:[x.jsx("li",{children:"Totals (Used/Free/Capacity) are authoritative from the server Base Stats."}),x.jsx("li",{children:"Users are computed from catalog populationRequired Ã— current level per structure."}),x.jsx("li",{children:"If capacity-providing fields are added to the catalog, they will appear under Capacity Sources."})]})]})]})},ro=(e,t)=>t.filter(t=>function(e,t){try{return Sn(e,t),!0}catch{return!1}}(e,t.level)).map(t=>({...t,credits:Sn(e,t.level)})),no={urban_structures:ro("urban_structures",[{level:1,credits:1,populationCapacity:7},{level:2,credits:2,populationCapacity:14},{level:3,credits:3,populationCapacity:21},{level:4,credits:4,populationCapacity:28},{level:5,credits:6,populationCapacity:35},{level:6,credits:8,populationCapacity:42},{level:7,credits:12,populationCapacity:49},{level:8,credits:18,populationCapacity:56},{level:9,credits:26,populationCapacity:63},{level:10,credits:39,populationCapacity:70},{level:11,credits:58,populationCapacity:77},{level:12,credits:87,populationCapacity:84},{level:13,credits:130,populationCapacity:91},{level:14,credits:195,populationCapacity:98},{level:15,credits:292,populationCapacity:105},{level:16,credits:438,populationCapacity:112},{level:17,credits:657,populationCapacity:119},{level:18,credits:986,populationCapacity:126},{level:19,credits:1478,populationCapacity:133},{level:20,credits:2217,populationCapacity:140}]),solar_plants:ro("solar_plants",[{level:1,credits:1,energyOutput:3},{level:2,credits:2,energyOutput:6},{level:3,credits:3,energyOutput:9},{level:4,credits:4,energyOutput:12},{level:5,credits:6,energyOutput:15},{level:6,credits:8,energyOutput:18},{level:7,credits:12,energyOutput:21},{level:8,credits:18,energyOutput:24},{level:9,credits:26,energyOutput:27},{level:10,credits:39,energyOutput:30},{level:11,credits:58,energyOutput:33},{level:12,credits:87,energyOutput:36},{level:13,credits:130,energyOutput:39}]),gas_plants:ro("gas_plants",[{level:1,credits:1,energyOutput:3},{level:2,credits:2,energyOutput:6},{level:3,credits:3,energyOutput:9},{level:4,credits:4,energyOutput:12},{level:5,credits:6,energyOutput:15},{level:6,credits:8,energyOutput:18},{level:7,credits:12,energyOutput:21},{level:8,credits:18,energyOutput:24},{level:9,credits:26,energyOutput:27},{level:10,credits:39,energyOutput:30},{level:11,credits:58,energyOutput:33},{level:12,credits:87,energyOutput:36},{level:13,credits:130,energyOutput:39},{level:14,credits:195,energyOutput:42}]),fusion_plants:ro("fusion_plants",[{level:1,credits:20,energyOutput:4},{level:2,credits:30,energyOutput:8},{level:3,credits:45,energyOutput:12},{level:4,credits:68,energyOutput:16},{level:5,credits:102,energyOutput:20},{level:6,credits:152,energyOutput:24},{level:7,credits:228,energyOutput:28},{level:8,credits:342,energyOutput:32},{level:9,credits:513,energyOutput:36},{level:10,credits:769,energyOutput:40},{level:11,credits:1154,energyOutput:44},{level:12,credits:1730,energyOutput:48},{level:13,credits:2595,energyOutput:52},{level:14,credits:3893,energyOutput:56},{level:15,credits:5839,energyOutput:60},{level:16,credits:8758,energyOutput:64},{level:17,credits:13137,energyOutput:68},{level:18,credits:19706,energyOutput:72},{level:19,credits:29558,energyOutput:76}]),research_labs:ro("research_labs",[{level:1,credits:2,researchOutput:8},{level:2,credits:3,researchOutput:16},{level:3,credits:5,researchOutput:24},{level:4,credits:7,researchOutput:32},{level:5,credits:11,researchOutput:40},{level:6,credits:16,researchOutput:48},{level:7,credits:23,researchOutput:56},{level:8,credits:35,researchOutput:64},{level:9,credits:52,researchOutput:72},{level:10,credits:77,researchOutput:80},{level:11,credits:116,researchOutput:88},{level:12,credits:173,researchOutput:96},{level:13,credits:260,researchOutput:104},{level:14,credits:390,researchOutput:112},{level:15,credits:584,researchOutput:120},{level:16,credits:876,researchOutput:128},{level:17,credits:1314,researchOutput:136},{level:18,credits:1971,researchOutput:144},{level:19,credits:2956,researchOutput:152},{level:20,credits:4434,researchOutput:160},{level:21,credits:6651,researchOutput:168},{level:22,credits:9976,researchOutput:176},{level:23,credits:14944,researchOutput:184},{level:24,credits:22446,researchOutput:192},{level:25,credits:33669,researchOutput:200},{level:26,credits:50503,researchOutput:208},{level:27,credits:75754,researchOutput:216},{level:28,credits:113631,researchOutput:224},{level:29,credits:170446,researchOutput:232},{level:30,credits:255669,researchOutput:240}]),metal_refineries:ro("metal_refineries",[{level:1,credits:1,productionOutput:3},{level:2,credits:2,productionOutput:6},{level:3,credits:3,productionOutput:9},{level:4,credits:4,productionOutput:12},{level:5,credits:6,productionOutput:15},{level:6,credits:8,productionOutput:18},{level:7,credits:12,productionOutput:21},{level:8,credits:18,productionOutput:24},{level:9,credits:26,productionOutput:27},{level:10,credits:39,productionOutput:30},{level:11,credits:58,productionOutput:33},{level:12,credits:87,productionOutput:36},{level:13,credits:130,productionOutput:39},{level:14,credits:195,productionOutput:42},{level:15,credits:292,productionOutput:45},{level:16,credits:438,productionOutput:48},{level:17,credits:657,productionOutput:51},{level:18,credits:986,productionOutput:54},{level:19,credits:1478,productionOutput:57},{level:20,credits:2217,productionOutput:60},{level:21,credits:3326,productionOutput:63}]),robotic_factories:ro("robotic_factories",[{level:1,credits:5,productionOutput:2},{level:2,credits:8,productionOutput:4},{level:3,credits:12,productionOutput:6},{level:4,credits:17,productionOutput:8},{level:5,credits:26,productionOutput:10},{level:6,credits:38,productionOutput:12},{level:7,credits:57,productionOutput:14},{level:8,credits:86,productionOutput:16},{level:9,credits:129,productionOutput:18},{level:10,credits:193,productionOutput:20},{level:11,credits:289,productionOutput:22},{level:12,credits:433,productionOutput:24},{level:13,credits:649,productionOutput:26},{level:14,credits:974,productionOutput:28},{level:15,credits:1460,productionOutput:30},{level:16,credits:2190,productionOutput:32},{level:17,credits:3285,productionOutput:34}]),shipyards:ro("shipyards",[{level:1,credits:5,productionOutput:2},{level:2,credits:8,productionOutput:4},{level:3,credits:12,productionOutput:6},{level:4,credits:17,productionOutput:8},{level:5,credits:26,productionOutput:10},{level:6,credits:38,productionOutput:12},{level:7,credits:57,productionOutput:14},{level:8,credits:86,productionOutput:16},{level:9,credits:129,productionOutput:18},{level:10,credits:193,productionOutput:20},{level:11,credits:289,productionOutput:22},{level:12,credits:433,productionOutput:24},{level:13,credits:649,productionOutput:26},{level:14,credits:974,productionOutput:28},{level:15,credits:1460,productionOutput:30},{level:16,credits:2190,productionOutput:32},{level:17,credits:3285,productionOutput:34},{level:18,credits:4927,productionOutput:36},{level:19,credits:7390,productionOutput:38},{level:20,credits:11085,productionOutput:40},{level:21,credits:16627,productionOutput:42},{level:22,credits:24940,productionOutput:44},{level:23,credits:37410,productionOutput:46},{level:24,credits:56114,productionOutput:48},{level:25,credits:84171,productionOutput:50},{level:26,credits:126256,productionOutput:52},{level:27,credits:189384,productionOutput:54},{level:28,credits:284076,productionOutput:56},{level:29,credits:426114,productionOutput:58}]),orbital_shipyards:ro("orbital_shipyards",[{level:1,credits:1e4,productionOutput:8},{level:2,credits:15e3,productionOutput:16},{level:3,credits:22500,productionOutput:24},{level:4,credits:33750,productionOutput:32},{level:5,credits:50625,productionOutput:40},{level:6,credits:75938,productionOutput:48},{level:7,credits:113907,productionOutput:56},{level:8,credits:170860,productionOutput:64},{level:9,credits:256290,productionOutput:72}]),spaceports:ro("spaceports",[{level:1,credits:5,economyOutput:2,tradeRoutes:1},{level:2,credits:8,economyOutput:4,tradeRoutes:2},{level:3,credits:12,economyOutput:6,tradeRoutes:3},{level:4,credits:17,economyOutput:8,tradeRoutes:4},{level:5,credits:26,economyOutput:10,tradeRoutes:5},{level:6,credits:38,economyOutput:12,tradeRoutes:6},{level:7,credits:57,economyOutput:14,tradeRoutes:7},{level:8,credits:86,economyOutput:16,tradeRoutes:8},{level:9,credits:129,economyOutput:18,tradeRoutes:9},{level:10,credits:193,economyOutput:20,tradeRoutes:10},{level:11,credits:289,economyOutput:22,tradeRoutes:11},{level:12,credits:433,economyOutput:24,tradeRoutes:12},{level:13,credits:649,economyOutput:26,tradeRoutes:13},{level:14,credits:974,economyOutput:28,tradeRoutes:14},{level:15,credits:1460,economyOutput:30,tradeRoutes:15},{level:16,credits:2190,economyOutput:32,tradeRoutes:16},{level:17,credits:3285,economyOutput:34,tradeRoutes:17},{level:18,credits:4927,economyOutput:36,tradeRoutes:18},{level:19,credits:7390,economyOutput:38,tradeRoutes:19},{level:20,credits:11085,economyOutput:40,tradeRoutes:20}]),command_centers:ro("command_centers",[{level:1,credits:20,commandPoints:1},{level:2,credits:30,commandPoints:2},{level:3,credits:45,commandPoints:3},{level:4,credits:68,commandPoints:4},{level:5,credits:102,commandPoints:5},{level:6,credits:152,commandPoints:6},{level:7,credits:228,commandPoints:7},{level:8,credits:342,commandPoints:8},{level:9,credits:513,commandPoints:9},{level:10,credits:769,commandPoints:10},{level:11,credits:1154,commandPoints:11},{level:12,credits:1730,commandPoints:12},{level:13,credits:2595,commandPoints:13},{level:14,credits:3893,commandPoints:14}]),android_factories:ro("android_factories",[{level:1,credits:1e3,productionOutput:6},{level:2,credits:1500,productionOutput:12},{level:3,credits:2250,productionOutput:18},{level:4,credits:3375,productionOutput:24},{level:5,credits:5063,productionOutput:30},{level:6,credits:7594,productionOutput:36},{level:7,credits:11391,productionOutput:42},{level:8,credits:17086,productionOutput:48},{level:9,credits:25629,productionOutput:54},{level:10,credits:38444,productionOutput:60},{level:11,credits:57666,productionOutput:66},{level:12,credits:86498,productionOutput:72}]),economic_centers:ro("economic_centers",[{level:1,credits:80,economyOutput:3},{level:2,credits:120,economyOutput:6},{level:3,credits:180,economyOutput:9},{level:4,credits:270,economyOutput:12},{level:5,credits:405,economyOutput:15},{level:6,credits:608,economyOutput:18},{level:7,credits:912,economyOutput:21},{level:8,credits:1367,economyOutput:24},{level:9,credits:2051,economyOutput:27},{level:10,credits:3076,economyOutput:30},{level:11,credits:4614,economyOutput:33},{level:12,credits:6920,economyOutput:36},{level:13,credits:10380,economyOutput:39}]),terraform:ro("terraform",[{level:1,credits:80,increasedArea:5},{level:2,credits:120,increasedArea:10},{level:3,credits:180,increasedArea:15},{level:4,credits:270,increasedArea:20},{level:5,credits:405,increasedArea:25},{level:6,credits:608,increasedArea:30},{level:7,credits:912,increasedArea:35},{level:8,credits:1367,increasedArea:40},{level:9,credits:2051,increasedArea:45},{level:10,credits:3076,increasedArea:50},{level:11,credits:4614,increasedArea:55},{level:12,credits:6920,increasedArea:60},{level:13,credits:10380,increasedArea:65}]),multi_level_platforms:ro("multi_level_platforms",[{level:1,credits:1e4,increasedArea:10},{level:2,credits:15e3,increasedArea:20},{level:3,credits:22500,increasedArea:30},{level:4,credits:33750,increasedArea:40},{level:5,credits:50625,increasedArea:50},{level:6,credits:75938,increasedArea:60},{level:7,credits:113907,increasedArea:70},{level:8,credits:170860,increasedArea:80},{level:9,credits:256290,increasedArea:90},{level:10,credits:384434,increasedArea:100},{level:11,credits:576651,increasedArea:110}]),orbital_base:ro("orbital_base",[{level:1,credits:2e3,populationCapacity:10},{level:2,credits:3e3,populationCapacity:20},{level:3,credits:4500,populationCapacity:30},{level:4,credits:6750,populationCapacity:40},{level:5,credits:10125,populationCapacity:50},{level:6,credits:15188,populationCapacity:60},{level:7,credits:22782,populationCapacity:70},{level:8,credits:34172,populationCapacity:80},{level:9,credits:51258,populationCapacity:90}]),crystal_mines:ro("crystal_mines",[{level:1,credits:2,economyOutput:2},{level:2,credits:3,economyOutput:4},{level:3,credits:5,economyOutput:6},{level:4,credits:7,economyOutput:8},{level:5,credits:11,economyOutput:10},{level:6,credits:16,economyOutput:12},{level:7,credits:23,economyOutput:14},{level:8,credits:35,economyOutput:16}])},io={urban_structures:{title:"Urban Structures",subtitle:"Each level increases population capacity by base fertility."},solar_plants:{title:"Solar Plants",subtitle:"Each level increases base energy output by base solar energy."},gas_plants:{title:"Gas Plants",subtitle:"Each level increases base energy output by base gas resource."},fusion_plants:{title:"Fusion Plants",subtitle:"Each level increases base energy output by 4."},research_labs:{title:"Research Labs",subtitle:"Each level increases base research capacity by 8, and allows the research of more technologies."},metal_refineries:{title:"Metal Refineries",subtitle:"Each level increases production and construction capacity by base metal resource."},robotic_factories:{title:"Robotic Factories",subtitle:"Each level increases production and construction capacity by 2."},shipyards:{title:"Shipyards",subtitle:"Each level increases base production by 2 and allows the production of more units."},orbital_shipyards:{title:"Orbital Shipyards",subtitle:"Each level increases base production by 8, allows the production of more units and doesn't require area on the base."},spaceports:{title:"Spaceports",subtitle:"Each level increases base economy by 2 and allows trade routes."},command_centers:{title:"Command Centers",subtitle:"Each level increases the number of occupied bases you can have by 1, and add 5% fleet attack power at base location."},android_factories:{title:"Android Factories",subtitle:"Each level increases production and construction capacity by 6."},economic_centers:{title:"Economic Centers",subtitle:"Each level increases base economy by 3."},terraform:{title:"Terraform",subtitle:"Each level increases base construction area by 5, doesn't require population."},multi_level_platforms:{title:"Multi-Level Platforms",subtitle:"Each level increases base construction area by 10, doesn't require population."},orbital_base:{title:"Orbital Base",subtitle:"Each level increase population capacity by 10 and doesn't require area on the base."},crystal_mines:{title:"Crystal Mines",subtitle:"Economy output equals the baseâ€™s crystals attribute (no baseline)."}},oo=n()(He((e,t)=>({selectedBaseId:null,bases:[],loading:!1,error:null,setSelectedBase:t=>e({selectedBaseId:t}),setBases:t=>e({bases:t,error:null}),updateBase:(t,s)=>e(e=>({bases:e.bases.map(e=>e._id===t?{...e,...s}:e)})),addBase:t=>e(e=>({bases:[...e.bases,t]})),removeBase:t=>e(e=>({bases:e.bases.filter(e=>e._id!==t),selectedBaseId:e.selectedBaseId===t?null:e.selectedBaseId})),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),getSelectedBase:()=>{const e=t();return e.selectedBaseId&&e.bases.find(t=>t._id===e.selectedBaseId)||null},getBaseById:e=>t().bases.find(t=>t._id===e)||null,getTotalBases:()=>t().bases.length}),{name:"base-store",partialize:e=>({selectedBaseId:e.selectedBaseId})})),lo=({structureKey:e})=>{if(!e)return x.jsx("div",{className:"text-center py-8",children:x.jsx("p",{className:"text-gray-400",children:"No structure selected."})});const t=no[e]||[],s=io[e],r="metal_refineries"===e,n="solar_plants"===e,i="gas_plants"===e,o="urban_structures"===e,l="crystal_mines"===e,{selectedBaseId:c,bases:d}=oo(e=>({selectedBaseId:e.selectedBaseId,bases:e.bases})),u=a.useMemo(()=>c&&d.find(e=>e._id===c)||null,[c,d]),[h,m]=a.useState(null),[p,y]=a.useState(null),[g,f]=a.useState(null),[b,v]=a.useState(null),[j,w]=a.useState(null);a.useEffect(()=>{let e=!1;return async function(){if(!r)return;const t=u?.locationCoord;if(t)try{const s=await Rn.getLocationByCoord(t);if(s?.success&&s.data){const t=s.data,a=t?.result?.yields?.metal??t?.terrain?.baseline?.metal??null;e||m("number"==typeof a?a:null)}else e||m(null)}catch{e||m(null)}else e||m(null)}(),()=>{e=!0}},[r,u?.locationCoord]),a.useEffect(()=>{let e=!1;return async function(){if(!n)return;const t=u?.locationCoord;if(t)try{const s=await Rn.getLocationByCoord(t);if(s?.success&&s.data){const t=s.data,a=t?.result?.solarEnergy??t?.positionBase?.solarEnergy??null;e||y("number"==typeof a?a:null)}else e||y(null)}catch{e||y(null)}else e||y(null)}(),()=>{e=!0}},[n,u?.locationCoord]),a.useEffect(()=>{let e=!1;return async function(){if(!i)return;const t=u?.locationCoord;if(t)try{const s=await Rn.getLocationByCoord(t);if(s?.success&&s.data){const t=s.data,a=t?.result?.yields?.gas??t?.terrain?.baseline?.gas??null;e||f("number"==typeof a?a:null)}else e||f(null)}catch{e||f(null)}else e||f(null)}(),()=>{e=!0}},[i,u?.locationCoord]),a.useEffect(()=>{let e=!1;return async function(){if(!l)return;const t=u?.locationCoord;if(t)try{const s=await Rn.getLocationByCoord(t);if(s?.success&&s.data){const t=s.data,a=t?.result?.yields?.crystals??t?.terrain?.baseline?.crystals??null;e||v("number"==typeof a?a:null)}else e||v(null)}catch{e||v(null)}else e||v(null)}(),()=>{e=!0}},[l,u?.locationCoord]),a.useEffect(()=>{let e=!1;return async function(){if(!o)return;const t=u?.locationCoord;if(t)try{const s=await Rn.getLocationByCoord(t);if(s?.success&&s.data){const t=s.data,a=t?.result?.fertility??t?.positionBase?.fertility??t?.terrain?.baseline?.fertility??null;e||w("number"==typeof a?a:null)}else e||w(null)}catch{e||w(null)}else e||w(null)}(),()=>{e=!0}},[o,u?.locationCoord]);const N=t.some(e=>"number"==typeof e.populationCapacity),k=t.some(e=>"number"==typeof e.energyOutput),S=t.some(e=>"number"==typeof e.researchOutput),_=t.some(e=>"number"==typeof e.economyOutput),C=t.some(e=>"number"==typeof e.tradeRoutes),P=t.some(e=>"number"==typeof e.commandPoints),A=t.some(e=>"number"==typeof e.productionOutput),R=t.some(e=>"number"==typeof e.increasedArea);return x.jsxs("div",{className:"space-y-3",children:[s?.subtitle&&x.jsx("div",{className:"text-sm text-gray-300",children:s.subtitle}),r&&x.jsx("div",{className:"text-xs text-gray-400",children:null!=h?`Adjusted for base metal rating: ${h} (baseline 3).`:"Baseline shown: metal rating 3. Actual output varies by base."}),n&&x.jsx("div",{className:"text-xs text-gray-400",children:null!=p?`Adjusted for base solar energy: ${p} (baseline 3).`:"Baseline shown: solar energy 3. Actual output varies by base."}),i&&x.jsx("div",{className:"text-xs text-gray-400",children:null!=g?`Adjusted for base gas rating: ${g} (baseline 3).`:"Baseline shown: gas rating 3. Actual output varies by base."}),l&&x.jsx("div",{className:"text-xs text-gray-400",children:null!=b?`Economy output equals base crystals attribute. Using crystals: ${b}.`:"Crystals unavailable for this base; showing static table values."}),o&&x.jsx("div",{className:"text-xs text-gray-400",children:null!=j?`Population capacity at level = fertility Ã— level. Using fertility: ${j}.`:"Fertility unavailable for this base; showing static table values."}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Level"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Credits"}),N&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Population Capacity"}),k&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Energy Output"}),S&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Research Output"}),_&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Economy Output"}),C&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Trade Routes"}),P&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Command Points"}),A&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Production Output"}),R&&x.jsx("th",{className:"py-2 px-3 text-left",children:"Increased Area"})]})}),x.jsx("tbody",{children:0===t.length?x.jsx("tr",{children:x.jsx("td",{colSpan:2+(N?1:0)+(k?1:0)+(S?1:0)+(_?1:0)+(C?1:0)+(P?1:0)+(A?1:0)+(R?1:0),children:"No level data available yet."})}):t.map(e=>x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.level}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.credits.toLocaleString()}),N&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:o&&null!=j?Math.round(e.level*j).toLocaleString():"number"==typeof e.populationCapacity?e.populationCapacity.toLocaleString():""}),k&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.energyOutput?n?Math.round(e.energyOutput*((p??3)/3)).toLocaleString():i?Math.round(e.energyOutput*((g??3)/3)).toLocaleString():e.energyOutput.toLocaleString():""}),S&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.researchOutput?e.researchOutput.toLocaleString():""}),_&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.economyOutput?l&&null!=b?Math.round(b).toLocaleString():e.economyOutput.toLocaleString():""}),C&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.tradeRoutes?e.tradeRoutes.toLocaleString():""}),P&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.commandPoints?e.commandPoints.toLocaleString():""}),A&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.productionOutput?r?Math.round(e.productionOutput*((h??3)/3)).toLocaleString():e.productionOutput.toLocaleString():""}),R&&x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.increasedArea?e.increasedArea.toLocaleString():""})]},e.level))})]})})]})},co=[{level:0,credits:0,baseEnergyOutputPct:100},{level:1,credits:2,baseEnergyOutputPct:105,labs:1,requires:"â€”"},{level:2,credits:3,baseEnergyOutputPct:110},{level:3,credits:5,baseEnergyOutputPct:115},{level:4,credits:7,baseEnergyOutputPct:120},{level:5,credits:11,baseEnergyOutputPct:125},{level:6,credits:16,baseEnergyOutputPct:130},{level:7,credits:23,baseEnergyOutputPct:135},{level:8,credits:35,baseEnergyOutputPct:140},{level:9,credits:52,baseEnergyOutputPct:145},{level:10,credits:77,baseEnergyOutputPct:150},{level:11,credits:116,baseEnergyOutputPct:155},{level:12,credits:173,baseEnergyOutputPct:160},{level:13,credits:260,baseEnergyOutputPct:165},{level:14,credits:390,baseEnergyOutputPct:170},{level:15,credits:584,baseEnergyOutputPct:175},{level:16,credits:876,baseEnergyOutputPct:180},{level:17,credits:1314,baseEnergyOutputPct:185},{level:18,credits:1971,baseEnergyOutputPct:190},{level:19,credits:2956,baseEnergyOutputPct:195},{level:20,credits:4434,baseEnergyOutputPct:200},{level:21,credits:6651,baseEnergyOutputPct:205},{level:22,credits:9976,baseEnergyOutputPct:210},{level:23,credits:14964,baseEnergyOutputPct:215},{level:24,credits:22446,baseEnergyOutputPct:220},{level:25,credits:33669,baseEnergyOutputPct:225}],uo=[{level:0,credits:0,campaignFleets:0},{level:1,credits:2,campaignFleets:1,labs:1,requires:"â€”"},{level:2,credits:3,campaignFleets:2},{level:3,credits:5,campaignFleets:3},{level:4,credits:7,campaignFleets:4},{level:5,credits:11,campaignFleets:5},{level:6,credits:16,campaignFleets:6},{level:7,credits:23,campaignFleets:7},{level:8,credits:35,campaignFleets:8},{level:9,credits:52,campaignFleets:9},{level:10,credits:77,campaignFleets:10},{level:11,credits:116,campaignFleets:11},{level:12,credits:173,campaignFleets:12},{level:13,credits:260,campaignFleets:13},{level:14,credits:390,campaignFleets:14},{level:15,credits:584,campaignFleets:15},{level:16,credits:876,campaignFleets:16},{level:17,credits:1314,campaignFleets:17},{level:18,credits:1971,campaignFleets:18},{level:19,credits:2956,campaignFleets:19},{level:20,credits:4434,campaignFleets:20},{level:21,credits:6651,campaignFleets:21},{level:22,credits:9976,campaignFleets:22},{level:23,credits:14964,campaignFleets:23},{level:24,credits:22446,campaignFleets:24},{level:25,credits:33669,campaignFleets:25}],ho=[{level:0,credits:0,unitsArmourPct:100},{level:1,credits:4,unitsArmourPct:105,labs:2,requires:"â€”"},{level:2,credits:6,unitsArmourPct:110},{level:3,credits:9,unitsArmourPct:115},{level:4,credits:14,unitsArmourPct:120},{level:5,credits:21,unitsArmourPct:125},{level:6,credits:31,unitsArmourPct:130},{level:7,credits:46,unitsArmourPct:135},{level:8,credits:69,unitsArmourPct:140},{level:9,credits:103,unitsArmourPct:145},{level:10,credits:154,unitsArmourPct:150},{level:11,credits:231,unitsArmourPct:155},{level:12,credits:346,unitsArmourPct:160},{level:13,credits:519,unitsArmourPct:165},{level:14,credits:779,unitsArmourPct:170},{level:15,credits:1168,unitsArmourPct:175},{level:16,credits:1752,unitsArmourPct:180},{level:17,credits:2628,unitsArmourPct:185},{level:18,credits:3942,unitsArmourPct:190},{level:19,credits:5912,unitsArmourPct:195},{level:20,credits:8868,unitsArmourPct:200},{level:21,credits:13302,unitsArmourPct:205},{level:22,credits:19952,unitsArmourPct:210},{level:23,credits:29928,unitsArmourPct:215},{level:24,credits:44891,unitsArmourPct:220},{level:25,credits:67337,unitsArmourPct:225},{level:26,credits:101005,unitsArmourPct:230},{level:27,credits:151508,unitsArmourPct:235},{level:28,credits:227261,unitsArmourPct:240},{level:29,credits:340891,unitsArmourPct:245},{level:30,credits:511337,unitsArmourPct:250}],mo=[{level:0,credits:0,laserWeaponsAttackPct:100},{level:1,credits:4,laserWeaponsAttackPct:105,labs:2,requires:"â€”"},{level:2,credits:6,laserWeaponsAttackPct:110},{level:3,credits:9,laserWeaponsAttackPct:115},{level:4,credits:14,laserWeaponsAttackPct:120},{level:5,credits:21,laserWeaponsAttackPct:125},{level:6,credits:31,laserWeaponsAttackPct:130},{level:7,credits:46,laserWeaponsAttackPct:135},{level:8,credits:69,laserWeaponsAttackPct:140},{level:9,credits:103,laserWeaponsAttackPct:145},{level:10,credits:154,laserWeaponsAttackPct:150},{level:11,credits:231,laserWeaponsAttackPct:155},{level:12,credits:346,laserWeaponsAttackPct:160},{level:13,credits:519,laserWeaponsAttackPct:165},{level:14,credits:779,laserWeaponsAttackPct:170},{level:15,credits:1168,laserWeaponsAttackPct:175},{level:16,credits:1752,laserWeaponsAttackPct:180},{level:17,credits:2628,laserWeaponsAttackPct:185},{level:18,credits:3942,laserWeaponsAttackPct:190},{level:19,credits:5912,laserWeaponsAttackPct:195},{level:20,credits:8868,laserWeaponsAttackPct:200},{level:21,credits:13302,laserWeaponsAttackPct:205},{level:22,credits:19952,laserWeaponsAttackPct:210},{level:23,credits:29928,laserWeaponsAttackPct:215},{level:24,credits:44891,laserWeaponsAttackPct:220},{level:25,credits:67337,laserWeaponsAttackPct:225},{level:26,credits:101005,laserWeaponsAttackPct:230},{level:27,credits:151508,laserWeaponsAttackPct:235},{level:28,credits:227261,laserWeaponsAttackPct:240},{level:29,credits:340891,laserWeaponsAttackPct:245},{level:30,credits:511337,laserWeaponsAttackPct:250}],po=[{level:0,credits:0,missilesWeaponsAttackPct:100},{level:1,credits:8,missilesWeaponsAttackPct:105,labs:4,requires:"â€”"},{level:2,credits:12,missilesWeaponsAttackPct:110},{level:3,credits:18,missilesWeaponsAttackPct:115},{level:4,credits:27,missilesWeaponsAttackPct:120},{level:5,credits:41,missilesWeaponsAttackPct:125},{level:6,credits:61,missilesWeaponsAttackPct:130},{level:7,credits:92,missilesWeaponsAttackPct:135},{level:8,credits:137,missilesWeaponsAttackPct:140},{level:9,credits:206,missilesWeaponsAttackPct:145},{level:10,credits:308,missilesWeaponsAttackPct:150},{level:11,credits:462,missilesWeaponsAttackPct:155},{level:12,credits:692,missilesWeaponsAttackPct:160},{level:13,credits:1038,missilesWeaponsAttackPct:165},{level:14,credits:1558,missilesWeaponsAttackPct:170},{level:15,credits:2336,missilesWeaponsAttackPct:175},{level:16,credits:3504,missilesWeaponsAttackPct:180},{level:17,credits:5256,missilesWeaponsAttackPct:185},{level:18,credits:7884,missilesWeaponsAttackPct:190},{level:19,credits:11824,missilesWeaponsAttackPct:195},{level:20,credits:17736,missilesWeaponsAttackPct:200},{level:21,credits:26604,missilesWeaponsAttackPct:205},{level:22,credits:39904,missilesWeaponsAttackPct:210},{level:23,credits:59856,missilesWeaponsAttackPct:215},{level:24,credits:89782,missilesWeaponsAttackPct:220},{level:25,credits:134674,missilesWeaponsAttackPct:225},{level:26,credits:202010,missilesWeaponsAttackPct:230},{level:27,credits:303016,missilesWeaponsAttackPct:235},{level:28,credits:454522,missilesWeaponsAttackPct:240},{level:29,credits:681782,missilesWeaponsAttackPct:245},{level:30,credits:1022674,missilesWeaponsAttackPct:250}],yo=[{level:0,credits:0,stellarUnitsSpeedPct:100},{level:1,credits:16,stellarUnitsSpeedPct:105,labs:5,requires:"â€”"},{level:2,credits:24,stellarUnitsSpeedPct:110},{level:3,credits:36,stellarUnitsSpeedPct:115},{level:4,credits:54,stellarUnitsSpeedPct:120},{level:5,credits:81,stellarUnitsSpeedPct:125},{level:6,credits:122,stellarUnitsSpeedPct:130},{level:7,credits:183,stellarUnitsSpeedPct:135},{level:8,credits:274,stellarUnitsSpeedPct:140},{level:9,credits:411,stellarUnitsSpeedPct:145},{level:10,credits:616,stellarUnitsSpeedPct:150},{level:11,credits:923,stellarUnitsSpeedPct:155},{level:12,credits:1384,stellarUnitsSpeedPct:160},{level:13,credits:2076,stellarUnitsSpeedPct:165},{level:14,credits:3116,stellarUnitsSpeedPct:170},{level:15,credits:4672,stellarUnitsSpeedPct:175},{level:16,credits:7008,stellarUnitsSpeedPct:180},{level:17,credits:10512,stellarUnitsSpeedPct:185},{level:18,credits:15768,stellarUnitsSpeedPct:190},{level:19,credits:23648,stellarUnitsSpeedPct:195},{level:20,credits:35472,stellarUnitsSpeedPct:200},{level:21,credits:53208,stellarUnitsSpeedPct:205},{level:22,credits:79808,stellarUnitsSpeedPct:210},{level:23,credits:119712,stellarUnitsSpeedPct:215},{level:24,credits:179564,stellarUnitsSpeedPct:220},{level:25,credits:269348,stellarUnitsSpeedPct:225},{level:26,credits:404020,stellarUnitsSpeedPct:230},{level:27,credits:606032,stellarUnitsSpeedPct:235},{level:28,credits:909044,stellarUnitsSpeedPct:240},{level:29,credits:1363564,stellarUnitsSpeedPct:245},{level:30,credits:2045348,stellarUnitsSpeedPct:250}],go=[{level:0,credits:0,plasmaWeaponsAttackPct:100},{level:1,credits:32,plasmaWeaponsAttackPct:105,labs:6,requires:"â€”"},{level:2,credits:48,plasmaWeaponsAttackPct:110},{level:3,credits:72,plasmaWeaponsAttackPct:115},{level:4,credits:108,plasmaWeaponsAttackPct:120},{level:5,credits:162,plasmaWeaponsAttackPct:125},{level:6,credits:243,plasmaWeaponsAttackPct:130},{level:7,credits:365,plasmaWeaponsAttackPct:135},{level:8,credits:547,plasmaWeaponsAttackPct:140},{level:9,credits:821,plasmaWeaponsAttackPct:145},{level:10,credits:1231,plasmaWeaponsAttackPct:150},{level:11,credits:1846,plasmaWeaponsAttackPct:155},{level:12,credits:2768,plasmaWeaponsAttackPct:160},{level:13,credits:4152,plasmaWeaponsAttackPct:165},{level:14,credits:6228,plasmaWeaponsAttackPct:170},{level:15,credits:9342,plasmaWeaponsAttackPct:175},{level:16,credits:14013,plasmaWeaponsAttackPct:180},{level:17,credits:21020,plasmaWeaponsAttackPct:185},{level:18,credits:31530,plasmaWeaponsAttackPct:190},{level:19,credits:47295,plasmaWeaponsAttackPct:195},{level:20,credits:70943,plasmaWeaponsAttackPct:200},{level:21,credits:106415,plasmaWeaponsAttackPct:205},{level:22,credits:159623,plasmaWeaponsAttackPct:210},{level:23,credits:239435,plasmaWeaponsAttackPct:215},{level:24,credits:359153,plasmaWeaponsAttackPct:220},{level:25,credits:538730,plasmaWeaponsAttackPct:225},{level:26,credits:808095,plasmaWeaponsAttackPct:230},{level:27,credits:1212143,plasmaWeaponsAttackPct:235},{level:28,credits:1818215,plasmaWeaponsAttackPct:240},{level:29,credits:2727323,plasmaWeaponsAttackPct:245},{level:30,credits:4090985,plasmaWeaponsAttackPct:250}],xo=[{level:0,credits:0,photonWeaponsAttackPct:100},{level:1,credits:1024,photonWeaponsAttackPct:105},{level:2,credits:1536,photonWeaponsAttackPct:110},{level:3,credits:2304,photonWeaponsAttackPct:115},{level:4,credits:3456,photonWeaponsAttackPct:120},{level:5,credits:5184,photonWeaponsAttackPct:125},{level:6,credits:7776,photonWeaponsAttackPct:130},{level:7,credits:11664,photonWeaponsAttackPct:135},{level:8,credits:17496,photonWeaponsAttackPct:140},{level:9,credits:26244,photonWeaponsAttackPct:145},{level:10,credits:39366,photonWeaponsAttackPct:150},{level:11,credits:59049,photonWeaponsAttackPct:155},{level:12,credits:88574,photonWeaponsAttackPct:160},{level:13,credits:132861,photonWeaponsAttackPct:165},{level:14,credits:199291,photonWeaponsAttackPct:170},{level:15,credits:298936,photonWeaponsAttackPct:175},{level:16,credits:448404,photonWeaponsAttackPct:180},{level:17,credits:672606,photonWeaponsAttackPct:185},{level:18,credits:1008908,photonWeaponsAttackPct:190}],fo=[{level:0,credits:0,warpUnitsSpeedPct:100},{level:1,credits:64,warpUnitsSpeedPct:105},{level:2,credits:96,warpUnitsSpeedPct:110},{level:3,credits:144,warpUnitsSpeedPct:115},{level:4,credits:216,warpUnitsSpeedPct:120},{level:5,credits:324,warpUnitsSpeedPct:125},{level:6,credits:486,warpUnitsSpeedPct:130},{level:7,credits:729,warpUnitsSpeedPct:135},{level:8,credits:1094,warpUnitsSpeedPct:140},{level:9,credits:1641,warpUnitsSpeedPct:145},{level:10,credits:2461,warpUnitsSpeedPct:150},{level:11,credits:3691,warpUnitsSpeedPct:155},{level:12,credits:5536,warpUnitsSpeedPct:160},{level:13,credits:8304,warpUnitsSpeedPct:165},{level:14,credits:12456,warpUnitsSpeedPct:170},{level:15,credits:18684,warpUnitsSpeedPct:175},{level:16,credits:28026,warpUnitsSpeedPct:180},{level:17,credits:42038,warpUnitsSpeedPct:185},{level:18,credits:63057,warpUnitsSpeedPct:190},{level:19,credits:94586,warpUnitsSpeedPct:195},{level:20,credits:141878,warpUnitsSpeedPct:200}],bo=[{level:0,credits:0,unitsShieldStrengthPct:100},{level:1,credits:128,unitsShieldStrengthPct:105},{level:2,credits:192,unitsShieldStrengthPct:110},{level:3,credits:288,unitsShieldStrengthPct:115},{level:4,credits:432,unitsShieldStrengthPct:120},{level:5,credits:648,unitsShieldStrengthPct:125},{level:6,credits:972,unitsShieldStrengthPct:130},{level:7,credits:1458,unitsShieldStrengthPct:135},{level:8,credits:2187,unitsShieldStrengthPct:140},{level:9,credits:3281,unitsShieldStrengthPct:145},{level:10,credits:4921,unitsShieldStrengthPct:150},{level:11,credits:7382,unitsShieldStrengthPct:155},{level:12,credits:11072,unitsShieldStrengthPct:160},{level:13,credits:16608,unitsShieldStrengthPct:165},{level:14,credits:24912,unitsShieldStrengthPct:170},{level:15,credits:37367,unitsShieldStrengthPct:175},{level:16,credits:56051,unitsShieldStrengthPct:180},{level:17,credits:84076,unitsShieldStrengthPct:185},{level:18,credits:126114,unitsShieldStrengthPct:190},{level:19,credits:189171,unitsShieldStrengthPct:195},{level:20,credits:283756,unitsShieldStrengthPct:200}],vo=[{level:0,credits:0},{level:1,credits:512},{level:2,credits:768},{level:3,credits:1152},{level:4,credits:1728},{level:5,credits:2592},{level:6,credits:3888},{level:7,credits:5832},{level:8,credits:8748}],jo=[{level:0,credits:0,baseResearchOutputPct:100},{level:1,credits:2048,baseResearchOutputPct:105},{level:2,credits:3072,baseResearchOutputPct:110},{level:3,credits:4608,baseResearchOutputPct:115},{level:4,credits:6912,baseResearchOutputPct:120},{level:5,credits:10368,baseResearchOutputPct:125},{level:6,credits:15552,baseResearchOutputPct:130},{level:7,credits:23328,baseResearchOutputPct:135},{level:8,credits:34992,baseResearchOutputPct:140},{level:9,credits:52488,baseResearchOutputPct:145},{level:10,credits:78732,baseResearchOutputPct:150},{level:11,credits:118098,baseResearchOutputPct:155},{level:12,credits:177147,baseResearchOutputPct:160},{level:13,credits:265721,baseResearchOutputPct:165},{level:14,credits:398581,baseResearchOutputPct:170}],wo=[{level:0,credits:0,baseConstructionProductionOutputPct:100},{level:1,credits:8192,baseConstructionProductionOutputPct:105},{level:2,credits:12288,baseConstructionProductionOutputPct:110},{level:3,credits:18432,baseConstructionProductionOutputPct:115},{level:4,credits:27648,baseConstructionProductionOutputPct:120},{level:5,credits:41472,baseConstructionProductionOutputPct:125},{level:6,credits:62208,baseConstructionProductionOutputPct:130},{level:7,credits:93312,baseConstructionProductionOutputPct:135},{level:8,credits:139968,baseConstructionProductionOutputPct:140},{level:9,credits:209952,baseConstructionProductionOutputPct:145},{level:10,credits:314928,baseConstructionProductionOutputPct:150}],No=[{level:0,credits:0,ionWeaponsAttackPct:100},{level:1,credits:256,ionWeaponsAttackPct:105},{level:2,credits:384,ionWeaponsAttackPct:110},{level:3,credits:576,ionWeaponsAttackPct:115},{level:4,credits:864,ionWeaponsAttackPct:120},{level:5,credits:1296,ionWeaponsAttackPct:125},{level:6,credits:1944,ionWeaponsAttackPct:130},{level:7,credits:2916,ionWeaponsAttackPct:135},{level:8,credits:4374,ionWeaponsAttackPct:140},{level:9,credits:6561,ionWeaponsAttackPct:145},{level:10,credits:9842,ionWeaponsAttackPct:150},{level:11,credits:14762,ionWeaponsAttackPct:155},{level:12,credits:22144,ionWeaponsAttackPct:160},{level:13,credits:33215,ionWeaponsAttackPct:165},{level:14,credits:49823,ionWeaponsAttackPct:170},{level:15,credits:74734,ionWeaponsAttackPct:175},{level:16,credits:112101,ionWeaponsAttackPct:180},{level:17,credits:168152,ionWeaponsAttackPct:185},{level:18,credits:252227,ionWeaponsAttackPct:190}],ko=[{level:0,credits:0,disruptorWeaponsAttackPct:100},{level:1,credits:4096,disruptorWeaponsAttackPct:105},{level:2,credits:6144,disruptorWeaponsAttackPct:110},{level:3,credits:9216,disruptorWeaponsAttackPct:115},{level:4,credits:13824,disruptorWeaponsAttackPct:120},{level:5,credits:20736,disruptorWeaponsAttackPct:125},{level:6,credits:31104,disruptorWeaponsAttackPct:130},{level:7,credits:46656,disruptorWeaponsAttackPct:135},{level:8,credits:69984,disruptorWeaponsAttackPct:140},{level:9,credits:104976,disruptorWeaponsAttackPct:145},{level:10,credits:157464,disruptorWeaponsAttackPct:150},{level:11,credits:236196,disruptorWeaponsAttackPct:155},{level:12,credits:354296,disruptorWeaponsAttackPct:160},{level:13,credits:531444,disruptorWeaponsAttackPct:165},{level:14,credits:797164,disruptorWeaponsAttackPct:170},{level:15,credits:1195744,disruptorWeaponsAttackPct:175},{level:16,credits:1793616,disruptorWeaponsAttackPct:180},{level:17,credits:2690424,disruptorWeaponsAttackPct:185},{level:18,credits:4035632,disruptorWeaponsAttackPct:190}],So=[{level:0,credits:0},{level:1,credits:32768},{level:2,credits:49152},{level:3,credits:73728},{level:4,credits:110592},{level:5,credits:165888},{level:6,credits:248832},{level:7,credits:373248},{level:8,credits:559872}],_o=[{level:0,credits:0},{level:1,credits:1e5},{level:2,credits:15e4},{level:3,credits:225e3},{level:4,credits:337500},{level:5,credits:506250},{level:6,credits:759375},{level:7,credits:1139063},{level:8,credits:1708594},{level:9,credits:2562891},{level:10,credits:3844336},{level:11,credits:5766504},{level:12,credits:8649756}],Co=(()=>{const e=(()=>{const e={};return Object.keys(on).forEach(t=>{const s=on[t],a=s.prerequisites&&s.prerequisites.length>0?s.prerequisites.map(e=>`${e.key.replace(/_/g," ")} ${e.level}`).join(", "):"â€”";e[t]=[{level:1,credits:s.creditsCost,labs:s.requiredLabs,requires:a,effect:s.description||"â€”"}]}),e})();return e.energy=co,e.computer=uo,e.armour=ho,e.laser=mo,e.plasma=go,e.photon=xo,e.missiles=po,e.stellar_drive=yo,e.warp_drive=fo,e.shielding=bo,e.stealth=vo,e.artificial_intelligence=jo,e.cybernetics=wo,e.ion=No,e.disruptor=ko,e.tachyon_communications=So,e.anti_gravity=_o,e})(),Po=(()=>{const e={};return Object.keys(on).forEach(t=>{const s=on[t];e[t]={title:`${s.name} â€” Levels`,subtitle:s.description||void 0}}),e.energy&&(e.energy.subtitle="Each level increases all bases energy output by 5%."),e.artificial_intelligence&&(e.artificial_intelligence.subtitle="Each level increases all bases research output by 5%."),e.computer&&(e.computer.subtitle="Each level allows one campaign fleet and the recruiting of one commander. Each 5 levels allows one auto scout fleet."),e.armour&&(e.armour.subtitle="Each level increases units and defenses armour by 5%."),e.laser&&(e.laser.subtitle="Each level increases laser weapons power by 5%."),e.plasma&&(e.plasma.subtitle="Each level increases plasma weapons power by 5%."),e.photon&&(e.photon.subtitle="Each level increases photon weapons power by 5%."),e.missiles&&(e.missiles.subtitle="Each level increases missile weapons power by 5%."),e.stellar_drive&&(e.stellar_drive.subtitle="Each level increases stellar units travel speed by 5%."),e.warp_drive&&(e.warp_drive.subtitle="Each level increases warp units travel speed by 5%."),e.shielding&&(e.shielding.subtitle="Each level increases units and defenses shield strength by 5%."),e.cybernetics&&(e.cybernetics.subtitle="Each level increases all bases construction and production output by 5%."),e})(),Ao=["baseEnergyOutputPct","baseResearchOutputPct","baseConstructionProductionOutputPct","campaignFleets","unitsArmourPct","unitsShieldStrengthPct","laserWeaponsAttackPct","photonWeaponsAttackPct","missilesWeaponsAttackPct","stellarUnitsSpeedPct","warpUnitsSpeedPct","plasmaWeaponsAttackPct","ionWeaponsAttackPct","disruptorWeaponsAttackPct"],Ro={baseEnergyOutputPct:"Base Energy Output",baseResearchOutputPct:"Base Research Output",baseConstructionProductionOutputPct:"Construction & Production Output",campaignFleets:"Campaign Fleets",unitsArmourPct:"Units Armour",unitsShieldStrengthPct:"Shield Strength",laserWeaponsAttackPct:"Laser Weapons Attack",photonWeaponsAttackPct:"Photon Weapons Attack",missilesWeaponsAttackPct:"Missiles Weapons Attack",stellarUnitsSpeedPct:"Stellar Units Speed",warpUnitsSpeedPct:"Warp Units Speed",plasmaWeaponsAttackPct:"Plasma Weapons Attack",ionWeaponsAttackPct:"Ion Weapons Attack",disruptorWeaponsAttackPct:"Disruptor Weapons Attack"},To={baseEnergyOutputPct:"percent",baseResearchOutputPct:"percent",baseConstructionProductionOutputPct:"percent",campaignFleets:"count",unitsArmourPct:"percent",unitsShieldStrengthPct:"percent",laserWeaponsAttackPct:"percent",photonWeaponsAttackPct:"percent",missilesWeaponsAttackPct:"percent",stellarUnitsSpeedPct:"percent",warpUnitsSpeedPct:"percent",plasmaWeaponsAttackPct:"percent",ionWeaponsAttackPct:"percent",disruptorWeaponsAttackPct:"percent"};const Eo=({techKey:e})=>{if(!e)return x.jsx("div",{className:"text-center py-8",children:x.jsx("p",{className:"text-gray-400",children:"No technology selected."})});const t=Co[e]||[],s=Po[e],a=function(e){return Ao.find(t=>e.some(e=>"number"==typeof e[t]))}(t),r=function(e,t){return e.length>0&&!t&&e.every(e=>"number"!=typeof e.labs&&!e.requires&&!e.effect)}(t,a),n=!a&&!r,i=r?2:a?3:5;return x.jsxs("div",{className:"space-y-3",children:[s?.subtitle&&x.jsx("div",{className:"text-sm text-gray-300",children:s.subtitle}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Level"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Credits"}),a?x.jsx("th",{className:"py-2 px-3 text-left",children:Ro[a]}):n?x.jsxs(x.Fragment,{children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Labs"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Requires"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Effect"})]}):null]})}),x.jsx("tbody",{children:0===t.length?x.jsx("tr",{children:x.jsx("td",{colSpan:i,className:"py-2 px-3 text-gray-400",children:"Coming soon."})}):t.map(e=>x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.level}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.credits?e.credits.toLocaleString():"â€”"}),a?x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e[a]?"percent"===To[a]?`${e[a]}%`:e[a].toLocaleString():"â€”"}):n?x.jsxs(x.Fragment,{children:[x.jsx("td",{className:"py-2 px-3 text-gray-200",children:"number"==typeof e.labs?e.labs.toLocaleString():"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.requires??"â€”"}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:e.effect??"â€”"})]}):null]},e.level))})]})})]})},Oo=({empire:e,onUpdate:t})=>{const{isOpen:s,type:a,closeModal:r,data:n}=ha();if(!s||!a||!e)return null;return x.jsx(ma,{isOpen:s,onClose:r,title:(()=>{switch(a){case"research":return"ðŸ”¬ Research & Development";case"galaxy":return"ðŸ—ºï¸ Galaxy Map";case"fleet":return"ðŸš€ Fleet Management";case"game_info":return"ðŸ“˜ Game Info";case"capacity_breakdown":return"ðŸ“Š Capacity Breakdown";case"energy_breakdown":return"âš¡ Energy Breakdown";case"area_breakdown":return"ðŸ“ Area Usage Breakdown";case"population_breakdown":return"ðŸ‘¥ Population Breakdown";case"levels_table":{const e=n?.structureKey;return e&&io[e]?.title?io[e]?.title:"Levels Table"}case"research_levels_table":{const e=n?.techKey;return e&&Po[e]?.title?Po[e]?.title:"Research Levels"}default:return"Game Interface"}})(),size:(()=>{switch(a){case"research":case"galaxy":return"xl";case"fleet":case"capacity_breakdown":case"energy_breakdown":case"area_breakdown":case"population_breakdown":default:return"lg";case"game_info":return"2xl";case"levels_table":case"research_levels_table":return"md"}})(),children:(()=>{switch(a){case"research":return x.jsx(pa,{empire:e,onUpdate:t});case"galaxy":return x.jsx(Tn,{empire:e,onUpdate:t});case"fleet":return x.jsx(Ti,{onUpdate:t});case"game_info":return x.jsx(Bi,{empire:e,onUpdate:t,initialTab:n?.initialTab});case"capacity_breakdown":return x.jsx(Hi,{data:n});case"energy_breakdown":return x.jsx(Yi,{data:n});case"area_breakdown":return x.jsx(Xi,{data:n});case"population_breakdown":return x.jsx(ao,{data:n});case"levels_table":return x.jsx(lo,{structureKey:n?.structureKey});case"research_levels_table":return x.jsx(Eo,{techKey:n?.techKey});default:return x.jsx("div",{className:"text-center py-8",children:x.jsx("p",{className:"text-gray-400",children:"Modal content not found."})})}})()})},Io=()=>{const{user:t}=ta(),[s,a]=e.useState(null),[r,n]=e.useState(""),[i,o]=e.useState(!1),l=Bs,c=async()=>{try{const e=(await l.get("/game/dashboard")).data;console.log("Dashboard API Response:",e),e.success&&(console.log("Profile data received:",e.data.profile),a(e.data))}catch(Jl){console.error("Error fetching dashboard data:",Jl)}};e.useEffect(()=>{c()},[]);const d=e.useMemo(()=>{return e=s?.empire?.techLevels,e?e instanceof Map?Array.from(e.entries()):"object"==typeof e?Object.entries(e):[]:[];var e},[s?.empire]);return s?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsxs("h1",{className:"text-2xl font-bold mb-2",children:["Welcome to ",s.serverInfo.name,", ",t?.username,"!"]}),x.jsx("p",{className:"text-gray-400",children:s.empire?`Home system: ${s.empire.homeSystem}`:"Setting up your starter base..."})]}),i&&x.jsxs("div",{className:"game-card border-2 border-yellow-500",children:[x.jsx("h3",{className:"text-xl font-semibold mb-4 text-yellow-400",children:"Create Your Empire"}),x.jsx("p",{className:"text-gray-400 mb-4",children:"Welcome, Commander! You're about to establish your space empire. Choose a name that will strike fear into your enemies and inspire your allies."}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"empireName",className:"block text-sm font-medium mb-2",children:"Empire Name"}),x.jsx("input",{type:"text",id:"empireName",value:r,onChange:e=>n(e.target.value),placeholder:"Enter your empire name...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-500",maxLength:30}),x.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"3-30 characters"})]}),x.jsxs("div",{className:"flex gap-3",children:[x.jsx("button",{onClick:async()=>{if(r.trim())try{const e=(await l.post("/game/empire",{name:r})).data;e.success?(o(!1),n(""),await c()):console.error(e.error||"Failed to create empire")}catch(Jl){console.error("Network error. Please try again.",Jl)}},disabled:!r.trim()||r.length<3,className:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Establish Empire"}),x.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Later"})]})]})]}),s.empire?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsx("h3",{className:"text-lg font-semibold text-green-400 mb-4",children:"ðŸŒ Territory & Home"}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-gray-300",children:"Home System:"}),x.jsx("span",{className:"font-mono text-sm",children:s.empire.homeSystem||"Not set"})]}),x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-gray-300",children:"Territories:"}),x.jsx("span",{className:"font-mono text-sm",children:s.empire.territories.length})]}),x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-gray-300",children:"Controlled Systems:"}),x.jsxs("span",{className:"font-mono text-sm",children:[s.empire.territories.slice(0,3).join(", "),s.empire.territories.length>3?"...":""]})]})]})]}),x.jsxs("div",{className:"game-card",children:[x.jsx("h3",{className:"text-lg font-semibold text-purple-400 mb-4",children:"âš¡ Technology"}),x.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:d.length>0?d.map(([e,t])=>x.jsxs("div",{className:"flex items-center justify-between text-sm",children:[x.jsxs("span",{className:"text-gray-300 capitalize",children:[e.replace(/_/g," "),":"]}),x.jsxs("span",{className:"font-mono",children:["Level ",t]})]},e)):x.jsx("div",{className:"text-gray-500 text-sm",children:"No technologies researched"})})]})]}),x.jsxs("div",{className:"game-card",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold mb-4",children:"ðŸ“Š Empire Statistics"}),x.jsxs("div",{className:"text-sm divide-y divide-gray-700/60",children:[x.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[x.jsx("span",{className:"font-medium text-gray-300",children:"Empire Name"}),x.jsx("span",{className:"font-mono",children:s.empire.name})]}),x.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[x.jsx("span",{className:"font-medium text-gray-300",children:"Player"}),x.jsx("span",{className:"font-mono",children:s.user?.username??t?.username??"â€”"})]}),x.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[x.jsx("span",{className:"font-medium text-gray-300",children:"Player ID"}),x.jsx("span",{className:"font-mono",children:s.user?._id??t?._id??"â€”"})]}),x.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[x.jsx("span",{className:"font-medium text-gray-300",children:"Level"}),x.jsxs("span",{className:"font-mono",children:[s.profile?s.profile.level.toFixed(2):"0.00"," ",x.jsx("span",{className:"text-gray-400",children:"(Rank 000)"})]})]}),x.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[x.jsx("span",{className:"font-medium text-gray-300",children:"Economy Rate"}),x.jsxs("span",{className:"font-mono",children:[s.profile?Math.round(s.profile.economyPerHour):"0"," cred./h"]})]}),x.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[x.jsx("span",{className:"font-medium text-gray-300",children:"Fleet Size"}),x.jsx("span",{className:"font-mono",children:s.profile?s.profile.fleetScore:"0"})]}),x.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[x.jsx("span",{className:"font-medium text-gray-300",children:"Technology Score"}),x.jsx("span",{className:"font-mono",children:s.profile?s.profile.technologyScore:"0"})]})]})]})]}):x.jsxs("div",{className:"game-card",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3 text-yellow-400",children:"Starter Setup"}),x.jsx("p",{className:"text-gray-400 mb-4",children:"Your starter base is being prepared. Please refresh shortly."})]}),x.jsxs("div",{className:"game-card",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3 text-space-purple",children:"Phase 3 Features - Now Available!"}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("h4",{className:"font-medium mb-2 text-green-400",children:"ðŸ—ï¸ Building System"}),x.jsx("p",{className:"text-gray-400",children:"Construct mines, factories, research labs, and defense stations. Each building type provides unique benefits and can be upgraded."})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-medium mb-2 text-blue-400",children:"âš¡ Resource Management"}),x.jsx("p",{className:"text-gray-400",children:"Manage Credits, Metal, Energy, and Research points. Buildings automatically produce resources over time."})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-medium mb-2 text-purple-400",children:"ï¿½ Research System"}),x.jsx("p",{className:"text-gray-400",children:"Advance your empire through Military, Economic, and Exploration technologies for powerful bonuses."})]}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-medium mb-2 text-yellow-400",children:"ðŸŒ Territory Expansion"}),x.jsx("p",{className:"text-gray-400",children:"Colonize new worlds to expand your empire. Each territory can support multiple buildings and colonies."})]})]}),x.jsx("div",{className:"mt-4 p-3 bg-blue-900/30 border border-blue-700 rounded-md",children:x.jsxs("p",{className:"text-blue-200 text-sm",children:[x.jsx("span",{className:"font-medium",children:"ðŸŽ® Real-time Gameplay:"})," Resources update automatically every minute. Buildings complete construction over time. Your empire grows even when you're offline!"]})})]}),x.jsx(Oo,{empire:s.empire,onUpdate:c})]}):x.jsx("div",{className:"flex items-center justify-center h-64",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-400",children:"Loading dashboard..."})]})})};const Mo={async getStatus(){try{return(await Bs.get("/status")).data}catch(Jl){return function(e){return!!e&&"object"==typeof e&&"string"==typeof e.code&&"string"==typeof e.message}(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}}},Fo=({state:e,showLabel:t=!1,size:s="sm",title:a,className:r})=>{const n="online"===e?"bg-green-400":"degraded"===e?"bg-yellow-400":"bg-red-400",i="online"===e?"Online":"degraded"===e?"Degraded":"Offline",o="md"===s?"w-3 h-3":"w-2 h-2",l="online"===e?"text-green-400":"degraded"===e?"text-yellow-400":"text-red-400";return x.jsxs("span",{className:`inline-flex items-center gap-2 ${r||""}`,role:"status","aria-label":i,title:a||i,children:[x.jsx("span",{className:`${o} rounded-full ${n}`}),t&&x.jsx("span",{className:`text-xs ${l}`,children:i})]})},$o=({state:e,queuedCount:t,showLabel:s=!1,size:a="sm",title:r,className:n})=>{const i="syncing"===e?"Syncingâ€¦":"error"===e?"Sync error":"Synced",o="md"===a?"w-3 h-3":"w-2 h-2",l="error"===e?"bg-red-400":"bg-blue-400",c="syncing"===e?"animate-pulse":"",d="error"===e?"text-red-400":"text-blue-400",u="syncing"===e?"Syncing":"error"===e?"Sync error":"Synced";return x.jsxs("span",{className:`inline-flex items-center gap-2 ${n||""}`,role:"status","aria-label":u,title:r||i,children:[x.jsx("span",{className:`${o} rounded-full ${l} ${c}`}),s&&x.jsxs("span",{className:`text-xs ${d}`,children:[i,"syncing"===e&&"number"==typeof t&&t>0?` (${t})`:null]})]})};function Lo(e){return!!e&&"object"==typeof e&&"string"==typeof e.code&&"string"==typeof e.message}const qo={async getSummary(){try{return(await Bs.get("/messages/summary")).data}catch(Jl){return Lo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async getInbox(e=1,t=20){try{return(await Bs.get(`/messages/inbox?page=${e}&limit=${t}`)).data}catch(Jl){return Lo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async getSentbox(e=1,t=20){try{return(await Bs.get(`/messages/sent?page=${e}&limit=${t}`)).data}catch(Jl){return Lo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async sendMessage(e){try{return(await Bs.post("/messages",e)).data}catch(Jl){return Lo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async markAsRead(e){if(!e||"string"!=typeof e)return{success:!1,code:"INVALID_INPUT",message:"Invalid message ID"};try{return(await Bs.patch(`/messages/${e}/read`)).data}catch(Jl){if(console.error("markAsRead API error:",Jl),Lo(Jl))return{success:!1,code:Jl.code,message:Jl.message||"Failed to mark message as read",details:Jl.details};return(Jl instanceof Error?Jl.message:"Unknown error").toLowerCase().includes("timeout")?{success:!1,code:"TIMEOUT_ERROR",message:"Request timed out. Please try again."}:{success:!1,code:"NETWORK_ERROR",message:"Network error. Please check your connection."}}},async markAllAsRead(){try{return(await Bs.patch("/messages/mark-all-read")).data}catch(Jl){return Lo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async deleteMessage(e){try{return(await Bs.delete(`/messages/${e}`)).data}catch(Jl){return Lo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async getMessageById(e){try{return(await Bs.get(`/messages/${e}`)).data}catch(Jl){return Lo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}}},Uo={to:"",subject:"",content:"",isSending:!1,error:null},Do=n()(We((e,t)=>({inboxMessages:[],sentboxMessages:[],summary:null,selectedMessage:null,activeTab:"inbox",isLoading:!1,error:null,currentPage:1,totalPages:1,composeForm:{...Uo},loadInbox:async(t=1)=>{e({isLoading:!0,error:null,currentPage:t});try{const s=await qo.getInbox(t,20);s.success&&s.data?e({inboxMessages:s.data.messages,totalPages:s.data.totalPages,isLoading:!1}):e({error:s.message||"Failed to load inbox",isLoading:!1})}catch(s){e({error:s instanceof Error?s.message:"Failed to load inbox",isLoading:!1})}},loadSentbox:async(t=1)=>{e({isLoading:!0,error:null,currentPage:t});try{const s=await qo.getSentbox(t,20);s.success&&s.data?e({sentboxMessages:s.data.messages,totalPages:s.data.totalPages,isLoading:!1}):e({error:s.message||"Failed to load sentbox",isLoading:!1})}catch(s){e({error:s instanceof Error?s.message:"Failed to load sentbox",isLoading:!1})}},loadSummary:async()=>{try{const t=await qo.getSummary();t.success&&t.data&&e({summary:t.data})}catch(t){console.warn("Failed to load message summary:",t)}},sendMessage:async s=>{const a=t();e({composeForm:{...a.composeForm,isSending:!0,error:null}});try{const r=await qo.sendMessage(s);return r.success?(e({composeForm:{...Uo},activeTab:"sentbox"}),t().loadSentbox(),t().loadSummary(),!0):(e({composeForm:{...a.composeForm,isSending:!1,error:r.message||"Failed to send message"}}),!1)}catch(r){return e({composeForm:{...a.composeForm,isSending:!1,error:r instanceof Error?r.message:"Failed to send message"}}),!1}},markAsRead:async s=>{if(s)try{const a=await qo.markAsRead(s);if(a.success){const a=t();e({inboxMessages:a.inboxMessages.map(e=>e._id===s?{...e,isRead:!0}:e),selectedMessage:a.selectedMessage?._id===s?{...a.selectedMessage,isRead:!0}:a.selectedMessage}),t().loadSummary().catch(e=>{console.warn("Failed to refresh message summary after marking as read:",e)})}else console.error("Server responded with error when marking message as read:",a.message),e({error:"Failed to mark message as read. Please try again."})}catch(a){console.error("Failed to mark message as read:",a),e({error:"Network error while marking message as read. Please try again."})}else console.error("markAsRead called with invalid messageId:",s)},markAllAsRead:async()=>{try{if((await qo.markAllAsRead()).success){const s=t();e({inboxMessages:s.inboxMessages.map(e=>({...e,isRead:!0})),selectedMessage:s.selectedMessage?{...s.selectedMessage,isRead:!0}:null}),t().loadSummary()}}catch(s){console.error("Failed to mark all messages as read:",s)}},deleteMessage:async s=>{try{if((await qo.deleteMessage(s)).success){const a=t();e({inboxMessages:a.inboxMessages.filter(e=>e._id!==s),sentboxMessages:a.sentboxMessages.filter(e=>e._id!==s),selectedMessage:a.selectedMessage?._id===s?null:a.selectedMessage}),t().loadSummary()}}catch(a){console.error("Failed to delete message:",a)}},setActiveTab:s=>{e({activeTab:s,selectedMessage:null,error:null}),"inbox"===s?t().loadInbox().catch(t=>{console.error("Failed to load inbox when switching tabs:",t),e({error:"Failed to load inbox messages. Please try again."})}):"sentbox"===s&&t().loadSentbox().catch(t=>{console.error("Failed to load sentbox when switching tabs:",t),e({error:"Failed to load sent messages. Please try again."})})},setSelectedMessage:s=>{e({selectedMessage:s}),s&&!s.isRead&&"inbox"===t().activeTab&&t().markAsRead(s._id).catch(e=>{console.error("Failed to mark message as read:",e)})},clearError:()=>{e({error:null})},updateComposeForm:s=>{const a=t();e({composeForm:{...a.composeForm,...s}})},clearComposeForm:()=>{e({composeForm:{...Uo}})},setComposeRecipient:s=>{const a=t();e({activeTab:"compose",composeForm:{...a.composeForm,to:s}})},refreshData:async()=>{const e=t(),s=[t().loadSummary()];"inbox"===e.activeTab?s.push(t().loadInbox(e.currentPage)):"sentbox"===e.activeTab&&s.push(t().loadSentbox(e.currentPage)),await Promise.all(s)},getUnreadCount:()=>{const e=t();return e.summary?.unreadMessages||0},initializeSocketListeners:()=>{const s=Xs();s&&(s.on("message:new",s=>{const a=t();"inbox"===a.activeTab&&e({inboxMessages:[s,...a.inboxMessages]}),t().loadSummary()}),s.on("message:read",s=>{const a=t();e({inboxMessages:a.inboxMessages.map(e=>e._id===s.messageId?{...e,isRead:s.isRead}:e),selectedMessage:a.selectedMessage?._id===s.messageId?{...a.selectedMessage,isRead:s.isRead}:a.selectedMessage}),t().loadSummary()}),s.on("message:deleted",s=>{const a=t();e({inboxMessages:a.inboxMessages.filter(e=>e._id!==s.messageId),sentboxMessages:a.sentboxMessages.filter(e=>e._id!==s.messageId),selectedMessage:a.selectedMessage?._id===s.messageId?null:a.selectedMessage}),t().loadSummary()}))},cleanupSocketListeners:()=>{const e=Xs();e&&(e.off("message:new"),e.off("message:read"),e.off("message:deleted"))}}))),Wo=({children:t})=>{const{user:s,empire:a,logout:n}=ta(),{openModal:i}=ha(),{status:o,isFullyConnected:l}=aa(),c="undefined"!=typeof window&&!!window.desktop,{status:d}=ia(),{getUnreadCount:u,loadSummary:h,initializeSocketListeners:m,cleanupSocketListeners:p}=Do(),[y,g]=e.useState(null),f=o.isOnline?o.isApiReachable?"online":"degraded":"offline",b="online"!==f,v="offline"===f?"No internet connection. Actions are limited; queued items will sync later.":"degraded"===f?"Server unreachable. Viewing cached data; actions are limited.":"Online",[j,w]=e.useState(null);e.useEffect(()=>(h(),m(),()=>{p()}),[]),e.useEffect(()=>{if(c&&window.desktop?.getVersion)try{window.desktop.getVersion().then(e=>{"string"==typeof e&&e.trim().length>0&&g(e)}).catch(()=>{})}catch{}let e,t=0;const s=async()=>{if(!(Date.now()<t)&&l)try{const e=await Mo.getStatus();e&&e.success&&e.data&&w(e.data)}catch(Jl){r.isAxiosError(Jl)&&429===Jl.response?.status&&(t=Date.now()+6e4)}};return s(),e=window.setInterval(s,3e4),()=>{e&&window.clearInterval(e)}},[l]),e.useEffect(()=>{const e=Xs();if(!e)return;const t=e=>{w(t=>t?{...t,playersOnline:e.playersOnline}:t)};return e.on("presence:update",t),()=>{e.off("presence:update",t)}},[]);return x.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[x.jsx("nav",{className:"game-nav",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{className:"flex items-center space-x-4",children:[x.jsx("h1",{className:"text-xl font-bold text-blue-400",children:"Attrition"}),y&&x.jsxs("span",{className:"text-sm text-gray-400",children:["v",y]}),x.jsx("span",{className:"text-sm text-gray-400",children:"Alpha Server"})]}),x.jsxs("div",{className:"flex items-center space-x-6",children:[x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(Fo,{state:f,showLabel:b,size:"sm",title:v}),"online"===f&&o.latencyMs?x.jsxs("span",{className:"text-xs text-gray-400",children:["(",o.latencyMs,"ms)"]}):null]}),x.jsx("div",{className:"flex items-center gap-2",children:x.jsx($o,{state:d.state,queuedCount:d.queuedCount,showLabel:"idle"!==d.state,size:"sm",title:"error"===d.state?d.lastError||"Sync error":"syncing"===d.state?"Flushing queued changesâ€¦":"Synced"})})]}),x.jsx("button",{onClick:()=>i("galaxy"),className:"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Open Galaxy"}),a&&x.jsx("div",{className:"flex items-center space-x-4 text-sm",children:x.jsxs("div",{className:"resource-display",children:[x.jsx("span",{className:"text-empire-gold",children:"ðŸ’°"}),x.jsx("span",{children:a.resources.credits.toLocaleString()})]})}),x.jsxs(Me,{to:"/messages",className:"relative flex items-center px-3 py-1 text-sm bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors",children:[x.jsx("span",{className:"mr-1",children:"ðŸ“§"}),"Messages",u()>0&&x.jsx("span",{className:"absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full",children:u()>99?"99+":u()})]}),x.jsxs("div",{className:"flex items-center space-x-3",children:[x.jsxs("div",{className:"text-right",children:[x.jsx("div",{className:"text-sm font-medium",children:s?.username}),a&&x.jsx("div",{className:"text-xs text-gray-400",children:a.name})]}),x.jsx("button",{onClick:n,className:"text-sm text-gray-400 hover:text-white transition-colors",children:"Logout"})]})]})]})}),x.jsxs("div",{className:"flex",children:[x.jsxs("aside",{className:"game-sidebar",children:[x.jsxs("nav",{className:"space-y-2",children:[x.jsx(Me,{to:"/dashboard",className:"block px-3 py-2 rounded text-sm font-medium bg-gray-700 text-white",children:"Dashboard"}),x.jsx(Me,{to:"/bases",className:"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Bases"}),x.jsx(Me,{to:"/galaxy",className:"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Galaxy Map"}),x.jsx("button",{onClick:()=>i("game_info"),className:"block w-full text-left px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Game Info"}),x.jsx(Me,{to:"/help",className:"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Help"}),x.jsxs(Me,{to:"/messages",className:"relative block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:["Messages",u()>0&&x.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-red-500 text-white rounded-full",children:u()})]}),c&&x.jsx(Me,{to:"/admin/performance",className:"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Performance"}),x.jsx("a",{href:"#",className:"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Fleets"}),x.jsx("a",{href:"#",className:"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Research"}),x.jsx("a",{href:"#",className:"block px-3 py-2 rounded text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700 transition-colors",children:"Diplomacy"})]}),x.jsxs("div",{className:"mt-8 p-3 bg-gray-700 rounded",children:[x.jsx("h3",{className:"text-sm font-medium mb-2",children:"Server Status"}),x.jsxs("div",{className:"space-y-1 text-xs",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Status:"}),x.jsx("span",{className:"OK"===j?.status?"status-online":"text-red-400",children:"OK"===j?.status?"Online":"Offline"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Players:"}),x.jsx("span",{children:j?j.playersOnline:"â€”"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"Uptime:"}),x.jsx("span",{children:j?(e=>{const t=Math.floor(e/86400),s=Math.floor(e%86400/3600),a=Math.floor(e%3600/60);return t>0?`${t}d ${s}h`:s>0?`${s}h ${a}m`:`${a}m`})(j.uptimeSeconds):"â€”"})]}),x.jsxs("div",{className:"flex justify-between pt-1 border-t border-gray-600 mt-1",children:[x.jsx("span",{children:"Network:"}),x.jsx("span",{className:l?"text-green-400":"text-red-400",children:l?"Connected":"Disconnected"})]}),o.latencyMs&&x.jsxs("div",{className:"flex justify-between text-gray-400",children:[x.jsx("span",{children:"Latency:"}),x.jsxs("span",{children:[o.latencyMs,"ms"]})]})]})]})]}),x.jsx("main",{className:"game-main",children:t})]}),x.jsx(Oo,{empire:a||null,onUpdate:()=>{}})]})},Bo=({selectedCoordinate:e,zoomLevel:t,onUniverse:s,onGalaxy:a,onRegion:r})=>{if(!e)return x.jsx("div",{className:"bg-gray-800 border border-gray-600 rounded-lg px-4 py-3",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-yellow-400 font-bold text-lg",children:"Universe Overview"}),x.jsx("span",{className:"text-gray-400 text-sm",children:"(Select a galaxy to explore)"})]})});return x.jsx("div",{className:"bg-gray-800 border border-gray-600 rounded-lg px-4 py-3",children:x.jsxs("div",{className:"flex items-center gap-2 text-lg",children:[x.jsx("button",{onClick:()=>{s()},className:"text-blue-400 hover:text-blue-300 transition-colors font-medium",children:"Universe"}),void 0!==e?.galaxy&&e.galaxy>=0&&x.jsxs(x.Fragment,{children:[x.jsx("span",{className:"text-gray-400",children:">"}),x.jsxs("button",{onClick:()=>{void 0!==e?.galaxy&&a(e.galaxy)},className:"transition-colors font-medium "+("galaxy"===t||"universe"===t?"text-yellow-400":"text-blue-400 hover:text-blue-300"),children:["Galaxy ",e.server,e.galaxy.toString().padStart(2,"0")]})]}),void 0!==e?.region&&e.region>=0&&"universe"!==t&&"galaxy"!==t&&x.jsxs(x.Fragment,{children:[x.jsx("span",{className:"text-gray-400",children:">"}),x.jsxs("button",{onClick:()=>{void 0!==e?.galaxy&&void 0!==e?.region&&r(e.galaxy,e.region)},className:"transition-colors font-medium "+("region"===t?"text-yellow-400":"text-blue-400 hover:text-blue-300"),children:["Region ",e.region.toString().padStart(2,"0")]})]}),void 0!==e?.system&&e.system>=0&&"system"===t&&x.jsxs(x.Fragment,{children:[x.jsx("span",{className:"text-gray-400",children:">"}),x.jsxs("span",{className:"text-yellow-400 font-medium",children:["System ",e.system.toString().padStart(2,"0")]})]})]})})},zo=()=>{const{empire:e}=ta(),{selectedCoordinate:t,zoomLevel:s,navigateToUniverse:a,navigateToGalaxy:r,navigateToRegion:n}=In(),i=(o=t)&&"string"==typeof o.server&&o.server.length>0&&"number"==typeof o.galaxy&&o.galaxy>=0&&"number"==typeof o.region&&o.region>=0&&"number"==typeof o.system&&o.system>=0&&"number"==typeof o.body&&o.body>=0?t:(e=>e?{server:e.server||"",galaxy:"number"==typeof e.galaxy?e.galaxy:0,region:"number"==typeof e.region?e.region:0,system:"number"==typeof e.system?e.system:0,body:"number"==typeof e.body?e.body:0}:null)(t);var o;return x.jsxs("div",{className:"space-y-4",children:[x.jsx("div",{className:"game-card",children:x.jsx(Bo,{selectedCoordinate:i,zoomLevel:s,onUniverse:a,onGalaxy:r,onRegion:n})}),e?x.jsx("div",{className:"game-card p-0 h-[75vh] overflow-hidden",children:x.jsx(wi,{empire:e})}):x.jsx("div",{className:"game-card border-2 border-yellow-500",children:x.jsx("p",{className:"text-yellow-300",children:"You need to create an empire before using the universe map."})})]})},Ho=()=>{const t=ue(),{coord:s}=he(),{navigateToUniverse:a,navigateToGalaxy:r,navigateToRegion:n,navigateToSystem:i}=In(),o=!!s&&function(e){try{const t=ya(e);return t.galaxy>=0&&t.galaxy<=39&&t.region>=0&&t.region<=99&&t.system>=0&&t.system<=99&&t.body>=0&&t.body<=19}catch{return!1}}(s),l=e.useMemo(()=>o?ya(s):null,[s,o]),[c,d]=e.useState(!0),[u,h]=e.useState(null),[m,p]=e.useState(null);e.useEffect(()=>{if(!o)return d(!1),void h("Invalid coordinate format. Expected A00:10:22:10");let e=!0;return d(!0),h(null),Rn.getLocationByCoord(s).then(t=>{e&&(t.success&&t.data?p(t.data):h(t.error||"Unable to load data."))}).catch(()=>{e&&h("Network error occurred while loading data.")}).finally(()=>{e&&d(!1)}),()=>{e=!1}},[s,o]);const y=()=>{l&&(i(l.galaxy,l.region,l.system),t("/galaxy"))},g=e.useMemo(()=>{const e={terrestrial:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, #487a3a 21%, #2b4f28 60%, #132515 100%)",gas_giant:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.15) 18%, #7a62b7 20%, #4f3a8a 58%, #2a174f 100%)",ice:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.4) 22%, #78a9d6 23%, #3c6d99 60%, #1c3550 100%)",desert:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 18%, #e0b34a 20%, #a97a2a 60%, #5e3b10 100%)",volcanic:"radial-gradient(circle at 30% 30%, rgba(255,200,200,0.7), rgba(255,200,200,0.2) 20%, #cc2b2b 22%, #7a1e1e 60%, #330d0d 100%)",planet:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, rgba(40,80,140,1) 21%, rgba(20,40,80,1) 60%, rgba(10,20,40,1) 100%)",asteroid:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.2) 18%, #7b6f62 20%, #4a423b 60%, #26221e 100%)",star:"radial-gradient(circle at 30% 30%, rgba(255,255,200,0.9), rgba(255,255,200,0.4) 22%, #ffd27a 24%, #e0a53a 60%, #8a5a0a 100%)"};return{background:e[m?.type||"planet"]||e.planet,boxShadow:"0 0 40px rgba(100,150,255,0.3), inset 0 0 30px rgba(0,0,0,0.6)"}},[m]),f=l?l.body.toString().padStart(2,"0"):"",b=m?.type,v=b??(0===l?.body?"star":void 0)??"body",j="star"===v?"Star":"planet"===v?`Planet ${f}`:"asteroid"===v?`Asteroid ${f}`:l?`Body ${f}`:"Body";return x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl font-bold text-white",children:j}),x.jsx("p",{className:"text-sm text-gray-400",children:o?`A${l.galaxy.toString().padStart(2,"0")}:${l.region.toString().padStart(2,"0")}:${l.system.toString().padStart(2,"0")}:${l.body.toString().padStart(2,"0")}`:s||"Unknown"})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{className:"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",onClick:()=>t(-1),title:"Go Back",children:"â† Back"}),x.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:y,title:"Back to System",children:"â­¯ System"})]})]}),l&&x.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[x.jsx("button",{className:"text-blue-400 hover:text-blue-200",onClick:()=>{a(),t("/galaxy")},children:"Universe"}),x.jsx("span",{className:"text-gray-500",children:"â€º"}),x.jsxs("button",{className:"text-blue-400 hover:text-blue-200",onClick:()=>{l&&(r(l.galaxy),t("/galaxy"))},children:["Galaxy C",l.galaxy.toString().padStart(2,"0")]}),x.jsx("span",{className:"text-gray-500",children:"â€º"}),x.jsxs("button",{className:"text-blue-400 hover:text-blue-200",onClick:()=>{l&&(n(l.galaxy,l.region),t("/galaxy"))},children:["Region ",l.region.toString().padStart(2,"0")]}),x.jsx("span",{className:"text-gray-500",children:"â€º"}),x.jsxs("button",{className:"text-blue-400 hover:text-blue-200",onClick:y,children:["System ",l.system.toString().padStart(2,"0")]}),x.jsx("span",{className:"text-gray-500",children:"â€º"}),x.jsx("span",{className:"text-gray-300",children:j})]}),!o&&x.jsx("div",{className:"mt-3 text-red-400",children:"Invalid coordinate format. Expected A00:10:22:10"})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsx("div",{className:"game-card flex items-center justify-center",children:x.jsx("div",{className:"w-64 h-64 md:w-80 md:h-80 rounded-full shadow-lg",style:g,"aria-label":"Planet preview"})}),x.jsxs("div",{className:"game-card",children:[x.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"star"===v?"Star Information":"planet"===v?"Planet Information":"asteroid"===v?"Asteroid Information":"Body Information"}),c?x.jsx("div",{className:"text-gray-400",children:"Loading data..."}):u?x.jsx("div",{className:"text-red-400",children:u}):x.jsxs("div",{className:"space-y-2 text-gray-300",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Type"}),x.jsx("span",{className:"text-white",children:m?.type??"â€”"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Owner"}),x.jsx("span",{className:"text-white",children:m?.owner?.username??"Unclaimed"})]}),(m?.terrain||"number"==typeof m?.orbitPosition||m?.result)&&x.jsxs(x.Fragment,{children:[m?.terrain?.type&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Terrain"}),x.jsx("span",{className:"text-white",children:m.terrain.type})]}),"number"==typeof m?.orbitPosition&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Orbit Pos"}),x.jsx("span",{className:"text-white",children:m.orbitPosition})]}),"number"==typeof m?.result?.solarEnergy&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Solar Energy"}),x.jsx("span",{className:"text-white",children:m.result.solarEnergy})]}),"number"==typeof m?.result?.fertility&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Fertility"}),x.jsx("span",{className:"text-white",children:m.result.fertility})]}),m?.result?.yields&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Yields (M/G/C)"}),x.jsxs("span",{className:"text-white",children:[m.result.yields.metal,"/",m.result.yields.gas,"/",m.result.yields.crystals]})]}),"number"==typeof m?.result?.area&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Area"}),x.jsx("span",{className:"text-white",children:m.result.area})]}),m?.starOverhaul?.kind&&x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-400",children:"Star Kind"}),x.jsx("span",{className:"text-white",children:m.starOverhaul.kind})]})]}),m?.starProperties&&x.jsxs("div",{className:"mt-3 text-sm text-gray-400",children:["Star: class ",m.starProperties.spectralClass,", ",m.starProperties.temperatureK,"K"]})]})]})]}),m?.owner?x.jsxs("div",{className:"game-card",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full text-sm",children:[x.jsx("thead",{className:"bg-gradient-to-r from-indigo-900/60 to-indigo-700/40 border border-indigo-500/60",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-3 py-2 text-left text-gray-200",children:"Base"}),x.jsx("th",{className:"px-3 py-2 text-left text-gray-200",children:"Owner"}),x.jsx("th",{className:"px-3 py-2 text-left text-gray-200",children:"Occupier"}),x.jsx("th",{className:"px-3 py-2 text-right text-gray-200",children:"Economy"})]})}),x.jsx("tbody",{className:"border border-indigo-500/40",children:x.jsxs("tr",{className:"border-t border-indigo-500/30",children:[x.jsx("td",{className:"px-3 py-2",children:x.jsx(Me,{to:`/base/${encodeURIComponent(s)}`,className:"text-blue-300 underline decoration-dotted hover:text-blue-200",title:"Open base page",children:"Home Planet h"})}),x.jsx("td",{className:"px-3 py-2 text-empire-gold",children:m?.owner?.username??"â€”"}),x.jsx("td",{className:"px-3 py-2 text-gray-300",children:"â€”"}),x.jsx("td",{className:"px-3 py-2 text-right text-yellow-300 font-mono",children:"0 / 0"})]})})]})}),x.jsx("div",{className:"mt-3 text-center",children:x.jsx("span",{className:"text-yellow-300 hover:text-yellow-200 cursor-default",children:"Move fleet here"})})]}):x.jsx("div",{className:"game-card",children:x.jsx("div",{className:"py-4 text-center",children:x.jsx("span",{className:"text-yellow-300 hover:text-yellow-200 cursor-default",children:"Move fleet here"})})})]})},Zo=new Map,Go={async get(e){const t=`base-stats:${e}`,s=Zo.get(t);if(s)return s;const a=(async()=>{try{return(await Bs.get(`/game/base-stats/${encodeURIComponent(e)}`)).data}finally{Zo.delete(t)}})();return Zo.set(t,a),a}};function Ko(e){const t=Math.max(0,Math.floor(e/1e3));let s=Math.floor(t/60);t>0&&0===s&&(s=1);const a=Math.floor(s/60);if(a>=1){return`${a}h ${(s%60).toString().padStart(2,"0")}m`}return`${s}m`}const Yo=({percent:e,color:t})=>{const s="green"===t?"bg-green-500":"purple"===t?"bg-purple-500":"bg-red-500",a="green"===t?"bg-green-900/40":"purple"===t?"bg-purple-900/40":"bg-red-900/40",r=Math.min(100,Math.max(0,Math.floor(e)));return x.jsx("div",{className:`h-2 w-40 sm:w-48 rounded ${a}`,children:x.jsx("div",{className:`h-2 rounded ${s}`,style:{width:`${r}%`}})})},Vo=({onRowClick:t})=>{const[s,a]=e.useState([]),[r,n]=e.useState(!0),[i,o]=e.useState(null),[l,c]=e.useState({}),d=Bs,u=async()=>{n(!0),o(null);try{const e=await d.get("/game/bases/summary");if(e.data?.success){const t=e.data.data?.bases||[];a(t),await h(t)}else o(e.data?.error||"Failed to load base summaries")}catch(Vl){console.error("Error fetching base summaries:",Vl),o("Failed to load base summaries. Please try again.")}finally{n(!1)}};e.useEffect(()=>{u()},[]);const h=async e=>{try{const t=await Promise.all(e.map(async e=>{try{const t=await Go.get(e.location),s=Math.round(t.data?.stats.ownerIncomeCredPerHour??0),a=s;return[e.location,{owner:s,base:a}]}catch{return[e.location,{owner:0,base:0}]}})),s={};t.forEach(([e,t])=>{s[e]=t}),c(s)}catch{}};return r?x.jsxs("div",{className:"game-card",children:[x.jsx("div",{className:"flex items-center justify-between mb-3",children:x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Bases Events"})}),x.jsx("div",{className:"flex items-center justify-center py-8",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto mb-3"}),x.jsx("p",{className:"text-gray-400",children:"Loading base events..."})]})})]}):i?x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Bases Events"}),x.jsx("button",{onClick:u,className:"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Refresh"})]}),x.jsxs("div",{className:"text-center",children:[x.jsxs("div",{className:"text-red-400 mb-4",children:["âš ï¸ ",i]}),x.jsx("button",{onClick:u,className:"game-button",children:"Retry"})]})]}):x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Bases Events"}),x.jsx("button",{onClick:u,className:"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Refresh"})]}),0===s.length?x.jsx("div",{className:"text-center py-6 text-gray-400",children:"No bases found."}):x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Base"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Location"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Economy"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Occupier"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Construction"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Production"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Research"})]})}),x.jsx("tbody",{children:s.map(e=>{const s=l[e.location],a=`${Math.round(s?.owner??0)} / ${Math.round(s?.base??0)}`,r=e.occupier?e.occupier.name||"Occupied":"â€”",n=e.production.next&&e.production.queued>0?`${e.production.next.name} (${Ko(e.production.next.remaining)})`:`(${e.production.queued})`,i=!!e.research&&e.research.remaining<=0,o=e.research?i?`${e.research.name} (waiting)`:`${e.research.name} (${Ko(e.research.remaining)})`:"â€”";return x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/60 cursor-pointer",onClick:()=>t?.(e.baseId),children:[x.jsx("td",{className:"py-2 px-3 text-white",children:e.name}),x.jsx("td",{className:"py-2 px-3 font-mono text-gray-300",children:e.location}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:a}),x.jsx("td",{className:"py-2 px-3",children:x.jsx("span",{className:e.occupier?"text-yellow-400":"text-gray-400",children:r})}),x.jsx("td",{className:"py-2 px-3",children:x.jsx("div",{className:"flex flex-col gap-1",children:x.jsx(Me,{to:`/base/${encodeURIComponent(e.location)}?tab=structures`,onClick:e=>e.stopPropagation(),className:(e.construction.queued>0?"text-yellow-400":"text-gray-400")+" hover:text-yellow-300","aria-label":`View structures for ${e.name}`,children:"â€”"})})}),x.jsx("td",{className:"py-2 px-3",children:x.jsxs("div",{className:"flex flex-col gap-1",children:[x.jsx(Me,{to:`/base/${encodeURIComponent(e.location)}?tab=fleets`,onClick:e=>e.stopPropagation(),className:(e.production.queued>0?"text-yellow-400":"text-gray-400")+" hover:text-yellow-300","aria-label":`View fleets for ${e.name}`,children:n}),"number"==typeof e.production.next?.percent&&(e.production.next?.remaining||0)>0?x.jsx(Yo,{percent:e.production.next.percent,color:"red"}):null]})}),x.jsx("td",{className:"py-2 px-3 text-gray-200",children:x.jsxs("div",{className:"flex flex-col gap-1",children:[x.jsx(Me,{to:`/base/${encodeURIComponent(e.location)}?tab=research`,onClick:e=>e.stopPropagation(),className:"hover:text-yellow-300","aria-label":`View research for ${e.name}`,children:o}),"number"!=typeof e.research?.percent||i?null:x.jsx(Yo,{percent:e.research.percent,color:"purple"})]})})]},e.baseId)})})]})})]})},Jo=({bases:e,onBaseSelect:t,onUpdate:s})=>0===e.length?x.jsx("div",{className:"game-card text-center",children:x.jsxs("div",{className:"py-12",children:[x.jsx("div",{className:"text-6xl mb-4",children:"ðŸ—ï¸"}),x.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-300",children:"No Bases Found"}),x.jsx("p",{className:"text-gray-400 mb-6",children:"You haven't established any bases yet. Start by colonizing a location to build your first base."}),x.jsx("button",{onClick:s,className:"game-button",children:"Refresh Bases"})]})}):x.jsx("div",{className:"space-y-6",children:x.jsx(Vo,{onRowClick:t})});function Qo(e){return!!e&&"object"==typeof e&&"string"==typeof e.code&&"string"==typeof e.message}const Xo={async getCatalog(){try{return(await Bs.get("/game/tech/catalog")).data}catch(Jl){return Qo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async getStatus(e){try{return(await Bs.get("/game/tech/status",{params:{base:e}})).data}catch(Jl){return Qo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async start(e,t){try{return(await Bs.post("/game/tech/start",{locationCoord:e,techKey:t})).data}catch(Jl){if(Qo(Jl)){if("ALREADY_IN_PROGRESS"===Jl.code||409===Jl.status||"HTTP_409"===Jl.code)return{success:!1,code:Jl.code,message:Jl.message,details:Jl.details,reasons:Jl.details&&Jl.details.reasons||void 0};throw Jl}return{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async getQueue(e){try{const t=e?{base:e}:void 0;return(await Bs.get("/game/tech/queue",{params:t})).data}catch(Jl){return Qo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async cancelQueueItem(e){try{return(await Bs.delete(`/game/tech/queue/${encodeURIComponent(e)}`)).data}catch(Jl){return Qo(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}}};function el(e){return!!e&&"object"==typeof e&&"string"==typeof e.code&&"string"==typeof e.message}const tl={async getCatalog(){try{return(await Bs.get("/game/structures/catalog")).data}catch(Jl){return el(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async start(e,t){try{return(await Bs.post(`/game/bases/${encodeURIComponent(e)}/structures/${encodeURIComponent(t)}/construct`)).data}catch(Jl){return el(Jl)?Jl:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async cancelConstruction(e){try{return(await Bs.delete(`/game/bases/${encodeURIComponent(e)}/structures/cancel`)).data}catch(Jl){return el(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}}},sl={getCatalog:async()=>(await Bs.get("/game/defenses/catalog")).data,getStatus:async()=>(await Bs.get("/game/defenses/status")).data,async start(e,t){try{return(await Bs.post("/game/defenses/start",{locationCoord:e,defenseKey:t})).data}catch(Jl){const t=Jl?.response?.status,s=Jl?.response?.data??{},a=s.code,r=s.message||s.error||"Request failed";if("ALREADY_IN_PROGRESS"===a||409===t)return{success:!1,code:a,message:r,details:s.details,reasons:s.reasons};throw Jl}}},al={getCatalog:async()=>(await Bs.get("/game/units/catalog")).data,async getStatus(e){const t=e?{locationCoord:e}:void 0;return(await Bs.get("/game/units/status",{params:t})).data},async start(e,t){try{return(await Bs.post("/game/units/start",{locationCoord:e,unitKey:t})).data}catch(Jl){const t=Jl?.response?.status,s=Jl?.response?.data??{},a=s.code,r=s.message||s.error||"Request failed";if("ALREADY_IN_PROGRESS"===a||409===t)return{success:!1,code:a,message:r,details:s.details,reasons:s.reasons};throw Jl}},async getProductionQueue(e){try{const t=e?{base:e}:void 0;return(await Bs.get("/game/units/queue",{params:t})).data}catch(Jl){const t=Jl?.response?.data??{};return{success:!1,code:t.code||"NETWORK_ERROR",message:t.message||t.error||"Failed to get production queue",details:t.details}}},async cancelProduction(e){try{return(await Bs.delete(`/game/units/queue/${encodeURIComponent(e)}`)).data}catch(Jl){const t=Jl?.response?.data??{};return{success:!1,code:t.code||"NETWORK_ERROR",message:t.message||t.error||"Failed to cancel production",details:t.details}}}},rl=new Map,nl={async getStatus(e){const t=`capacities:${e}`,s=rl.get(t);if(s)return s;const a=(async()=>{try{return(await Bs.get(`/game/capacities/${encodeURIComponent(e)}`)).data}finally{rl.delete(t)}})();return rl.set(t,a),a}},il=({label:e,value:t})=>null==t||""===t?null:x.jsxs("div",{className:"flex justify-between text-sm",children:[x.jsx("span",{className:"text-gray-400",children:e}),x.jsx("span",{className:"text-white",children:t})]}),ol=({coord:t,showLinkToPlanetPage:s=!0,showBudgets:a=!0,refreshKey:r})=>{const[n,i]=e.useState(!0),[o,l]=e.useState(null),[c,d]=e.useState(null),[u,h]=e.useState(null),[m,p]=e.useState(null),[y,g]=e.useState(null),{openModal:f}=ha(),b=e=>{const t="number"==typeof e?e:0,s=Math.round(10*t)/10;return x.jsxs("span",{className:"font-mono",title:t.toFixed(2),children:[s.toLocaleString(void 0,{maximumFractionDigits:1}),x.jsx("span",{className:"text-gray-400",children:" cred./h"})]})};return e.useEffect(()=>{let e=!0;return i(!0),l(null),d(null),h(null),p(null),g(null),Rn.getLocationByCoord(t).then(t=>{e&&(t.success&&t.data?d(t.data):l(t.error||"Failed to load planet info."))}).catch(()=>{e&&l("Network error while loading planet info.")}).finally(()=>{e&&i(!1)}),nl.getStatus(t).then(t=>{if(e&&t.success&&t.data){const e=t.data;p(e),h({construction:e.construction?.value??0,production:e.production?.value??0,research:e.research?.value??0})}}).catch(()=>{}),Go.get(t).then(t=>{e&&t.success&&t.data&&g(t.data.stats)}).catch(()=>{}),()=>{e=!1}},[t,r]),x.jsxs("div",{className:"mt-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3 text-empire-gold",children:"ðŸª Planet Information"}),n&&x.jsx("div",{className:"text-gray-400 text-sm",children:"Loading planet data..."}),o&&x.jsx("div",{className:"p-2 bg-red-900/50 border border-red-700 rounded text-red-200 text-sm",children:o}),!n&&!o&&x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[x.jsxs("div",{className:"space-y-1.5",children:[x.jsx(il,{label:"Type",value:c?.type}),x.jsx(il,{label:"Owner",value:c?.owner?.username??"Unclaimed"}),"number"==typeof c?.orbitPosition&&x.jsx(il,{label:"Orbit Pos",value:c?.orbitPosition}),x.jsx(il,{label:"Terrain",value:c?.terrain?.type}),"number"==typeof c?.result?.area&&x.jsx(il,{label:"Area",value:c?.result?.area})]}),x.jsxs("div",{className:"space-y-1.5",children:["number"==typeof c?.result?.solarEnergy&&x.jsx(il,{label:"Solar Energy",value:c?.result?.solarEnergy}),"number"==typeof c?.result?.fertility&&x.jsx(il,{label:"Fertility",value:c?.result?.fertility}),"number"==typeof c?.result?.yields?.metal&&x.jsx(il,{label:"Metal",value:c.result.yields.metal}),"number"==typeof c?.result?.yields?.crystals&&x.jsx(il,{label:"Crystal",value:c.result.yields.crystals}),"number"==typeof c?.result?.yields?.gas&&x.jsx(il,{label:"Gas",value:c.result.yields.gas})]}),x.jsxs("div",{className:"md:col-span-2 space-y-1.5 pt-1 border-t border-gray-700",children:[x.jsx(il,{label:"Economy",value:b(y?.ownerIncomeCredPerHour??0)}),x.jsx(il,{label:"Owner Income",value:x.jsxs("span",{className:"font-mono",children:[Math.round(y?.ownerIncomeCredPerHour??0).toLocaleString(),x.jsx("span",{className:"text-gray-400",children:" cred./h"})]})})]}),x.jsxs("div",{className:"md:col-span-2 space-y-1.5",children:[x.jsx(il,{label:"Construction",value:b(u?.construction)}),x.jsx(il,{label:"Production",value:b(u?.production)}),x.jsx(il,{label:"Research",value:b(u?.research)}),x.jsx("div",{className:"text-right",children:x.jsx("button",{onClick:()=>{m&&f("capacity_breakdown",{coord:t,capacities:m})},className:"text-sm text-blue-400 hover:text-blue-300",title:"View detailed capacity sources",children:"View breakdown âŸ¶"})})]}),a&&y&&x.jsxs("div",{className:"md:col-span-2 space-y-1.5 pt-1 border-t border-gray-700",children:[x.jsx(il,{label:"Area Usage",value:x.jsxs("span",{className:"font-mono",children:[y.area.used.toLocaleString()," / ",y.area.total.toLocaleString(),x.jsxs("span",{className:"text-gray-400",children:[" (free ",y.area.free.toLocaleString(),")"]})]})}),x.jsx(il,{label:"Energy Balance",value:x.jsxs("span",{className:"font-mono",children:["+",y.energy.produced.toLocaleString(),x.jsx("span",{className:"text-gray-400",children:" prod"}),"  ","âˆ’",y.energy.consumed.toLocaleString(),x.jsx("span",{className:"text-gray-400",children:" cons"}),"  ","="," ",x.jsx("span",{className:y.energy.balance>=0?"text-green-300":"text-red-300",children:y.energy.balance.toLocaleString()})]})}),x.jsx(il,{label:"Population",value:x.jsxs("span",{className:"font-mono",children:[y.population.used.toLocaleString()," / ",y.population.capacity.toLocaleString(),x.jsxs("span",{className:"text-gray-400",children:[" (free ",y.population.free.toLocaleString(),")"]})]})})]}),c?.starOverhaul?.kind&&x.jsxs("div",{className:"md:col-span-2 text-sm text-gray-400",children:["Star Kind: ",x.jsx("span",{className:"text-white",children:c.starOverhaul.kind})]}),c?.starProperties&&x.jsxs("div",{className:"md:col-span-2 text-xs text-gray-400",children:["Star: class ",c.starProperties.spectralClass,", ",c.starProperties.temperatureK,"K"]})]}),!n&&!o&&s&&x.jsx("div",{className:"mt-3 text-right",children:x.jsx(Me,{to:`/planet/${encodeURIComponent(t)}`,className:"text-sm text-blue-400 hover:text-blue-300",title:"Open full planet view",children:"View Planet âŸ¶"})})]})},ll=({coord:t,className:s})=>{const[a,r]=e.useState(!0),[n,i]=e.useState(null),[o,l]=e.useState(null);e.useEffect(()=>{let e=!0;return r(!0),i(null),l(null),Rn.getLocationByCoord(t).then(t=>{e&&(t.success&&t.data?l(t.data):i(t.error||"Failed to load planet visual."))}).catch(()=>{e&&i("Network error while loading planet visual.")}).finally(()=>{e&&r(!1)}),()=>{e=!1}},[t]);const c=e.useMemo(()=>{const e={terrestrial:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, #487a3a 21%, #2b4f28 60%, #132515 100%)",gas_giant:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.15) 18%, #7a62b7 20%, #4f3a8a 58%, #2a174f 100%)",ice:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.4) 22%, #78a9d6 23%, #3c6d99 60%, #1c3550 100%)",desert:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 18%, #e0b34a 20%, #a97a2a 60%, #5e3b10 100%)",volcanic:"radial-gradient(circle at 30% 30%, rgba(255,200,200,0.7), rgba(255,200,200,0.2) 20%, #cc2b2b 22%, #7a1e1e 60%, #330d0d 100%)",planet:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.2) 20%, rgba(40,80,140,1) 21%, rgba(20,40,80,1) 60%, rgba(10,20,40,1) 100%)",asteroid:"radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.2) 18%, #7b6f62 20%, #4a423b 60%, #26221e 100%)",star:"radial-gradient(circle at 30% 30%, rgba(255,255,200,0.9), rgba(255,255,200,0.4) 22%, #ffd27a 24%, #e0a53a 60%, #8a5a0a 100%)"};return{background:e[o?.type||"planet"]||e.planet,boxShadow:"0 0 40px rgba(100,150,255,0.3), inset 0 0 30px rgba(0,0,0,0.6)"}},[o]),d=s&&s.trim().length>0?s:"w-56 h-56 md:w-64 md:h-64";return a?x.jsx("div",{className:`rounded-full ${d} animate-pulse bg-gray-600/40`,"aria-label":"Loading planet preview"}):n?x.jsx("div",{className:`rounded-full ${d} bg-gray-700 flex items-center justify-center text-xs text-gray-300`,"aria-label":"Planet preview unavailable",title:n,children:"Preview unavailable"}):x.jsx("div",{className:`rounded-full shadow-lg ${d}`,style:c,"aria-label":"Planet preview"})};function cl(e){return!!e&&"object"==typeof e&&"string"==typeof e.code&&"string"==typeof e.message}const dl={async getBaseStats(e){try{return(await Bs.get(`/game/bases/${encodeURIComponent(e)}/stats`)).data}catch(Jl){return cl(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}},async getBaseStructures(e){try{return(await Bs.get(`/game/bases/${encodeURIComponent(e)}/structures`)).data}catch(Jl){return cl(Jl)?{success:!1,code:Jl.code,message:Jl.message,details:Jl.details}:{success:!1,code:"NETWORK_ERROR",message:"Network error"}}}},ul=t=>{const{title:s,summary:a,loading:r,onRefresh:n,items:i,getKey:o,getTitleText:l,getDescriptionText:c,getEligibility:d,columns:u,onAction:h,actionLabel:m,actionTestIdPrefix:p="action",nameTestIdPrefix:y="name",defaultSort:g,firstColumnHeader:f,actionHeader:b,tableTestId:v="build-table"}=t,j=e.useMemo(()=>i?"function"==typeof g?i.slice().sort(g):i:[],[i,g]);return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:s}),x.jsxs("div",{className:"flex items-center gap-2",children:[a,n&&x.jsx("button",{onClick:n,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",disabled:r,children:r?"Loading...":"Refresh"})]})]}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{"data-testid":v,className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:f??""}),u.map(e=>x.jsx("th",{className:"py-2 px-3 "+("right"===e.align?"text-right":"text-left"),children:e.header},e.key)),x.jsx("th",{className:"py-2 px-3 text-right",children:b??""})]})}),x.jsx("tbody",{children:j.map(e=>{const t=o(e),s=d(e),{canStart:a,reasons:n}=s,i=!a&&Array.isArray(n)&&n.length>0?n.join("; "):"",g="function"==typeof m?m(e,a,r):r?"...":a?"Start":"Unavailable";return x.jsxs("tr",{"data-testid":`row-${t}`,className:"border-b border-gray-800 hover:bg-gray-800/60",children:[x.jsxs("td",{className:"py-2 px-3 align-top",children:[x.jsx("div",{className:"text-white","data-testid":`${y}-${t}`,children:l(e)}),c&&x.jsx("div",{className:"text-xs text-gray-400",children:c(e)}),i&&x.jsx("div",{className:"text-xs text-red-300 mt-1",children:i})]}),u.map(t=>x.jsx("td",{className:`py-2 px-3 align-top ${"right"===t.align?"text-right":"text-left"} ${t.className||""}`,children:t.render(e)},t.key)),x.jsx("td",{className:"py-2 px-3 text-right align-top",children:x.jsx(On,{"data-testid":`${p}-${t}`,disabled:!a||!!r,onClick:()=>h(e),title:!a&&i?i:void 0,className:"px-3 py-1 rounded text-sm font-medium transition-colors "+(a&&!r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"),requiresNetwork:!0,networkDisabledTooltip:"Action unavailable while offline",children:g})})]},t)})})]})})]})},hl=({catalog:t,status:s,levels:a,loading:r,onRefresh:n,onStart:i,constructionPerHour:o,activeConstruction:l,techLevels:c,planetSolarEnergy:d,planetGasYield:u,planetMetalYield:h,planetCrystalsYield:m,planetFertility:p})=>{const y=e.useMemo(()=>(t||[]).slice().sort((e,t)=>e.creditsCost-t.creditsCost),[t]),[g,f]=e.useState(null),{openModal:b}=ha(),v=!!l,[,j]=e.useReducer(e=>e+1,0);e.useEffect(()=>{if(!v)return;const e=window.setInterval(()=>j(),1e3);return()=>window.clearInterval(e)},[v,l?.completionAt]);const w=e=>{switch(e.key){case"urban_structures":return"Increases population capacity by base fertility.";case"solar_plants":return"Increases base energy output by base solar energy.";case"gas_plants":return"Increases base energy output by base gas resource.";case"fusion_plants":case"antimatter_plants":case"orbital_plants":return`Increases base energy output by ${e.energyDelta}.`;case"research_labs":return"Increases bases research by 8, allows new technologies.";case"metal_refineries":return"Increases production and construction by base metal resource.";case"crystal_mines":return"Increases economy by base crystals resource.";case"robotic_factories":return"Increases production and construction by 2.";case"shipyards":return"Increases production by 2 and allows new units.";case"orbital_shipyards":return"Increases production by 8 and allows new units.";case"spaceports":return`Increases economy by ${e.economy} and allows trade routes.`;case"command_centers":return"Adds 5% fleet attack power at base and allows 1 occupation.";case"nanite_factories":return"Increases production and construction by 4.";case"android_factories":return"Increases production and construction by 6.";case"economic_centers":return`Increases economy by ${e.economy}.`;case"terraform":return"Increases base area by 5.";case"multi_level_platforms":return"Increases base area by 10.";case"orbital_base":return"Increases population capacity by 10.";case"jump_gate":return"Increases fleet speed by 70% and allows travel between galaxies.";case"biosphere_modification":return"Increases planet fertility by 1.";case"capital":return"Increases economy by 10 and other bases by 1. -15% empire income while occupied.";default:return e.energyDelta>0?`Increases base energy output by ${e.energyDelta}.`:e.energyDelta<0?`Consumes ${Math.abs(e.energyDelta)} energy.`:e.economy>0?`Increases economy by ${e.economy}.`:"â€”"}},N=["orbital_base","jump_gate"],k={terraform:5,multi_level_platforms:10},S=[{key:"credits",header:"Credits",align:"left",render:e=>{const t=a?.[e.key]??0,s=t+1;let r=null;try{r=Sn(e.key,s)}catch{r=0===t?e.creditsCost:null}return"number"==typeof r?r.toLocaleString():"â€”"}},{key:"energy",header:"Energy",align:"left",render:e=>"solar_plants"===e.key||"gas_plants"===e.key||0===e.energyDelta?"":String(e.energyDelta)},{key:"economy",header:"Economy",align:"left",render:e=>0===e.economy?"":e.economy},{key:"population",header:"Population",align:"left",render:e=>"orbital_base"===e.key?"+10":0===e.populationRequired?"":`-${e.populationRequired}`},{key:"area",header:"Area",align:"left",render:e=>(e=>{if(N.includes(e.key))return"";const t=k[e.key];return"number"==typeof t?`+${t}`:"number"==typeof e.areaRequired?0===e.areaRequired?"":`-${e.areaRequired}`:"-1"})(e)},{key:"advanced",header:"Advanced",align:"left",render:e=>e.advanced?"x":""},{key:"requires",header:"Requires",align:"left",render:e=>{const t=(e=>0===e.techPrereqs.length?"â€”":e.techPrereqs.map(e=>`${e.key.replace(/_/g," ")} ${e.level}`).join(", "))(e);if(!(e.techPrereqs.length>0))return x.jsx("span",{className:"text-gray-400",children:t});const s=c||{},a=e.techPrereqs.every(e=>Math.max(0,s[e.key]??0)>=e.level);return x.jsx("span",{className:a?"text-green-400":"text-red-400",children:t})}},{key:"time",header:"Time",align:"left",render:e=>{if(!("number"==typeof o&&o>0))return"â€”";const t=a?.[e.key]??0,s=t+1;let r=null;try{r=Sn(e.key,s)}catch{r=0===t?e.creditsCost:null}return"number"==typeof r?((e,t)=>{const s=Math.max(1,Math.round(e/t*3600));return`${Math.floor(s/3600)}h ${Math.floor(s%3600/60)}m ${s%60}s`})(r,o):"â€”"}}];return x.jsx(ul,{title:"Structures",firstColumnHeader:"Structure",actionHeader:"Build",summary:void 0,loading:r,onRefresh:n,items:y,getKey:e=>e.key,getTitleText:e=>{const t=a?.[e.key]??0;let s=null,r=null;return"solar_plants"===e.key&&"number"==typeof d?(s="energy",r=d):"gas_plants"===e.key&&"number"==typeof u?(s="energy",r=u):"metal_refineries"===e.key&&"number"==typeof h?(s="metal",r=h):"urban_structures"===e.key&&"number"==typeof p?(s="fertility",r=p):"crystal_mines"===e.key&&"number"==typeof m&&(s="crystals",r=m),x.jsxs("div",{className:"text-white cursor-pointer","data-testid":`name-${e.key}`,onClick:()=>f(g===e.key?null:e.key),children:[e.name,t>0?` (Level ${t})`:"","number"==typeof r&&s&&x.jsx("span",{className:"ml-2 text-xs text-gray-400",children:`(+${r.toLocaleString()} ${s} here)`})]})},getDescriptionText:e=>{const t=s?.eligibility[e.key],a=!!t?.canStart,r=t?.reasons||[],n=!a&&r.length>0;return x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"text-xs text-gray-400",children:w(e)}),n&&x.jsx("div",{className:"text-xs text-red-300 mt-1",children:r.join("; ")}),g===e.key&&x.jsxs("div",{className:"mt-2 space-y-1",children:[x.jsxs("div",{className:"text-sm text-gray-300",children:[x.jsx("span",{className:"text-gray-400",children:"Population:"})," ",e.populationRequired," per level"]}),x.jsxs("div",{className:"text-sm text-gray-300",children:[x.jsx("span",{className:"text-gray-400",children:"Area:"})," ",N.includes(e.key)?"â€”":"number"==typeof e.areaRequired?0===e.areaRequired?"â€”":`-${e.areaRequired} per level`:"-1 per level"]}),x.jsxs("div",{className:"text-sm text-gray-300",children:[x.jsx("span",{className:"text-gray-400",children:"Short Name:"})," ",e.key.split("_").map(e=>e[0]?.toUpperCase()||"").join("")]}),x.jsxs("div",{className:"pt-1 flex gap-6 text-sm",children:[x.jsx("button",{className:"text-empire-gold hover:underline",onClick:()=>b("levels_table",{structureKey:e.key}),children:"Levels Table"}),x.jsx("button",{className:"text-yellow-400 hover:underline",onClick:()=>window.alert("Downgrade not yet implemented"),children:"Downgrade 1 Level"})]})]})]})},getEligibility:e=>{const t=s?.eligibility[e.key];return{canStart:!!t?.canStart&&!v,reasons:t?.reasons||[]}},columns:S,onAction:e=>i(e.key),actionLabel:(e,t,s)=>s?"...":v?"Unavailable":t?"Build":"Unavailable",actionTestIdPrefix:"start",nameTestIdPrefix:"name",defaultSort:(e,t)=>e.creditsCost-t.creditsCost,tableTestId:"build-table"})},ml=({catalog:t,status:s,loading:a,onRefresh:r,onStart:n,onQueue:i,locationCoord:o,researchPerHour:l,activeResearch:c})=>{const{openModal:d}=ha(),{isFullyConnected:u}=aa(),h=!u,{empire:m}=ta(),p=m?._id,{addToast:y}=Si(),g=!!c,[,f]=e.useReducer(e=>e+1,0);e.useEffect(()=>{if(!g)return;const e=window.setInterval(()=>f(),1e3);return()=>window.clearInterval(e)},[g,c?.completesAt]);const b=[{key:"credits",header:"Credits",align:"left",render:e=>{const t=Math.max(0,s?.techLevels[e.key]??0)+1;return cn(e.key,t).toLocaleString()}},{key:"labs",header:"Labs",align:"left",render:e=>e.requiredLabs},{key:"requires",header:"Requires",align:"left",render:e=>{const t=(e=>e.prerequisites&&0!==e.prerequisites.length?e.prerequisites.map(e=>`${e.key.replace(/_/g," ")} ${e.level}`).join(", "):"â€”")(e);if(!(!!e.prerequisites&&e.prerequisites.length>0))return x.jsx("span",{className:"text-gray-400",children:t});const a=e.prerequisites.every(e=>Math.max(0,s?.techLevels[e.key]??0)>=e.level);return x.jsx("span",{className:a?"text-green-400":"text-red-400",children:t})}},{key:"effect",header:"Effect",align:"left",render:e=>e.description?"":"â€”"},{key:"time",header:"Time",align:"left",render:e=>{const t=Math.max(0,s?.techLevels[e.key]??0)+1,a=cn(e.key,t);return"number"==typeof l&&l>0?((e,t)=>{const s=Math.max(1,Math.round(e/t*3600));return`${Math.floor(s/3600)}h ${Math.floor(s%3600/60)}m ${s%60}s`})(a,l):"â€”"}}],v=s?x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs("div",{className:"text-sm text-gray-300",children:["Credits: ",x.jsx("span",{className:"text-empire-gold font-mono",children:s.credits.toLocaleString()})]}),x.jsxs("div",{className:"text-sm text-gray-300",children:["Labs: ",x.jsx("span",{className:"text-blue-400 font-semibold",children:s.baseLabTotal})]})]}):x.jsx("div",{className:"text-sm text-gray-300",children:"Credits: â€” Â· Labs: â€”"});return x.jsx(ul,{title:"Base Research",firstColumnHeader:"Technology",actionHeader:"Start / Queue",summary:v,loading:a,onRefresh:r,items:(t||[]).slice().sort((e,t)=>e.creditsCost-t.creditsCost),getKey:e=>e.key,getTitleText:e=>{const t=Math.max(0,s?.techLevels[e.key]??0);return x.jsxs("div",{className:"text-white cursor-pointer hover:underline","data-testid":`name-${e.key}`,onClick:()=>d("research_levels_table",{techKey:e.key}),children:[e.name,t>0?` (Level ${t})`:""]})},getDescriptionText:e=>e.description?x.jsx("div",{className:"text-xs text-gray-400",children:e.description}):null,getEligibility:e=>{const t=s?.eligibility[e.key],a=t?.reasons||[],r=a.length>0&&a.every(e=>/credit/i.test(String(e)));return{canStart:!!t?.canStart||r,reasons:a}},columns:b,onAction:e=>(async e=>{if(h){if(!i||!o||!p)return void y({type:"error",text:"Cannot queue: missing context"});const s={kind:"research",empireId:p,locationCoord:o,catalogKey:e,identityKey:`${p}-research-${e}-${Date.now()}`};try{await i(s),y({type:"success",text:"Research queued for sync when online"})}catch(t){console.error("Queue error:",t),y({type:"error",text:"Failed to queue research"})}return}n&&await n(e)})(e.key),isOffline:h,actionLabel:(e,t,a)=>{if(a)return"...";const r=(e=>{const t=s?.eligibility[e.key],a=t?.reasons||[];return a.length>0&&a.every(e=>/credit/i.test(String(e)))})(e);return h||g?t?"Queue":"Unavailable":t&&r?"Queue":t?"Start":"Unavailable"},actionTestIdPrefix:"start",nameTestIdPrefix:"name",defaultSort:(e,t)=>e.creditsCost-t.creditsCost,tableTestId:"build-table"})},pl=({baseCoord:t,onChanged:s})=>{const[a,r]=e.useState([]),[n,i]=e.useState(!1),[o,l]=e.useState(null),[c,d]=e.useState(0),[u,h]=e.useState(null),m=async()=>{i(!0),l(null);try{const e=await Xo.getQueue(t);e.success?r(e.data?.queue||[]):l(e.error||"Failed to load research queue")}catch(Vl){l(Vl?.response?.data?.error||"Network error while loading research queue")}finally{i(!1)}};e.useEffect(()=>{m();const e=window.setInterval(()=>d(e=>e+1),3e4),t=window.setInterval(()=>{m()},6e4);return()=>{clearInterval(e),clearInterval(t)}},[t]);const p=e.useMemo(()=>a.filter(e=>"pending"===e.status&&!!e.completesAt),[a,c]),y=e.useMemo(()=>a.filter(e=>"pending"===e.status&&!e.completesAt),[a,c]),g=async e=>{if(!e)return;if(window.confirm("Cancel this research item?"))try{h(e);const t=await Xo.cancelQueueItem(e);if(!t.success)return void l(t.error||t.message||"Failed to cancel queue item");await m(),s&&await s()}catch(Vl){l(Vl?.response?.data?.error||"Network error while cancelling")}finally{h(null)}};return x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Research Queue"}),x.jsx("button",{onClick:m,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",disabled:n,children:n?"Refreshing...":"Refresh"})]}),o&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3",children:o}),0!==a.length||n?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{children:[x.jsx("div",{className:"text-sm text-gray-300 mb-2",children:"Underway"}),0===p.length?x.jsx("div",{className:"p-3 bg-gray-800/60 border border-gray-700 rounded text-gray-400",children:"None currently underway."}):x.jsx("div",{className:"space-y-3",children:p.map(e=>{const t=ln(e.techKey),s=new Date(e.startedAt).getTime(),a=new Date(e.completesAt).getTime(),r=Date.now(),n=((e,t,s)=>{const a=t-e;if(a<=0)return 100;const r=s-e;return Math.max(0,Math.min(100,r/a*100))})(s,a,r),i=(e=>{if(e<=0)return"Completing now";const t=Math.ceil(e/1e3),s=Math.floor(t/3600),a=Math.ceil(t%3600/60);return s<=0?`${a}m`:`${s}h ${a}m`})(a-r);return x.jsxs("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsxs("div",{className:"font-medium text-white flex items-center gap-2",children:[t.name," ",x.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.techKey,")"]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-800 text-purple-300",children:e.locationCoord}),x.jsx("button",{onClick:()=>g(e._id),className:"text-xs px-2 py-1 bg-red-700 text-white rounded hover:bg-red-800 disabled:opacity-50",disabled:u===e._id,title:"Cancel this research item",children:u===e._id?"Cancelling...":"Cancel"})]})]}),t.description&&x.jsx("p",{className:"text-sm text-gray-400 mb-3",children:t.description}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2",children:x.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,n))}%`}})}),x.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[x.jsxs("span",{children:[n.toFixed(1),"% complete"]}),x.jsxs("span",{children:["ETA: ",i]})]}),x.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[x.jsxs("span",{children:["Started: ",new Date(e.startedAt).toLocaleString()]}),x.jsxs("span",{children:["Completes: ",new Date(e.completesAt).toLocaleString()]})]})]})]},e._id||`${e.techKey}-${e.locationCoord}-${e.startedAt}`)})})]}),x.jsxs("div",{children:[x.jsx("div",{className:"text-sm text-gray-300 mb-2",children:"Waiting"}),0===y.length?x.jsx("div",{className:"p-3 bg-gray-800/60 border border-gray-700 rounded text-gray-400",children:"No queued items waiting for credits/capacity."}):x.jsx("div",{className:"space-y-2",children:y.map((e,t)=>{const s=ln(e.techKey);return x.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/60 border border-gray-700 rounded",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs("span",{className:"text-xs text-gray-400 w-5 text-right",children:[t+1,"."]}),x.jsxs("div",{className:"text-white",children:[s.name," ",x.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.techKey,")"]})]}),x.jsx("span",{className:"text-xs px-2 py-1 rounded bg-gray-900 text-purple-300",children:e.locationCoord}),x.jsx("span",{className:"text-xs text-gray-400",children:"(Queued)"})]}),x.jsx("button",{onClick:()=>g(e._id),className:"text-xs px-2 py-1 bg-red-700 text-white rounded hover:bg-red-800 disabled:opacity-50",disabled:u===e._id,title:"Cancel this queued item",children:u===e._id?"Cancelling...":"Cancel"})]},e._id||`${e.techKey}-${e.locationCoord}-${e.startedAt}-waiting`)})})]})]}):x.jsx("div",{className:"p-4 bg-gray-700 rounded-lg border border-gray-600 text-gray-300",children:"No technology research queued."})]})},yl=({catalog:e,status:t,loading:s,onRefresh:a,onStart:r,onQueue:n,locationCoord:i})=>{if(!t)return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Defenses"}),x.jsx("button",{onClick:a,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:s?"Loading...":"Refresh"})]}),x.jsx("div",{className:"text-gray-400",children:s?"Loading defenses...":"No status available."})]});const o=[{key:"credits",header:"Credits",align:"left",render:e=>e.creditsCost.toLocaleString()},{key:"energy",header:"Energy",align:"left",render:e=>0===e.energyDelta?"":String(e.energyDelta)},{key:"area",header:"Area",align:"left",render:e=>(e=>"number"==typeof e.areaRequired?0===e.areaRequired?"":`-${e.areaRequired}`:"-1")(e)},{key:"requires",header:"Requires",align:"left",render:e=>{const s=(e=>e.techPrereqs&&0!==e.techPrereqs.length?e.techPrereqs.map(e=>`${e.key.replace(/_/g," ")} ${e.level}`).join(", "):"â€”")(e);if(!(!!e.techPrereqs&&e.techPrereqs.length>0))return x.jsx("span",{className:"text-gray-400",children:s});const a=t?.techLevels||{},r=e.techPrereqs.every(e=>(a[e.key]??0)>=e.level);return x.jsx("span",{className:r?"text-green-400":"text-red-400",children:s})}}],{isFullyConnected:l}=aa(),{addToast:c}=Si(),{empire:d}=ta();return x.jsx(ul,{title:"Defenses",firstColumnHeader:"Defense",actionHeader:"Start",summary:void 0,loading:s,onRefresh:a,items:e||[],getKey:e=>e.key,getTitleText:e=>e.name,getDescriptionText:e=>(e=>{const t=[];return e.weapon&&t.push(`Weapon: ${e.weapon}`),"number"==typeof e.attack&&t.push(`Attack ${e.attack}`),"number"==typeof e.armour&&t.push(`Armour ${e.armour}`),"number"==typeof e.shield&&t.push(`Shield ${e.shield}`),t.length?t.join(" â€¢ "):"â€”"})(e),getEligibility:e=>{const s=t.eligibility[e.key];return{canStart:!!s?.canStart,reasons:s?.reasons||[]}},columns:o,onAction:e=>(async e=>{if(!l){if(!d)return void c({type:"error",text:"Not authenticated"});const t={empireId:d._id,locationCoord:i,catalogKey:e},s={identityKey:`${d._id}:${i}:${e}`};if(!window.desktop?.eventQueue)return void c({type:"error",text:"Desktop API not available"});const a=await window.desktop.eventQueue.enqueue("defenses",t,s);return void c(a?.success?{type:"success",text:`Queued ${e} for sync`}:{type:"error",text:a?.error||"Failed to queue defense"})}r?.(e)})(e.key),onQueue:async e=>n?await n(e):{success:!1,error:"Queue not available"},isOffline:!l,actionLabel:(e,t,s,a)=>s?"...":a?t?"Queue":"Unavailable":t?"Start":"Unavailable",actionTestIdPrefix:"start",nameTestIdPrefix:"name",defaultSort:(e,t)=>e.creditsCost-t.creditsCost,tableTestId:"build-table"})},gl=e=>{const t=[];return t.push(`Drive: ${e.drive??"â€”"}`),t.push(`Weapon: ${e.weapon??"â€”"}`),void 0!==e.speed&&t.push(`Speed: ${e.speed}`),void 0!==e.hangar&&t.push(`Hangar: ${e.hangar}`),t.join(" â€¢ ")};function xl(e,t){const s=Math.max(0,Number(t||0));if(!Number.isFinite(s)||s<=0)return null;const a=e/s;return Math.max(1,Math.ceil(60*a))}function fl(e){if(!Number.isFinite(e)||e<=0)return"0m";const t=Math.floor(e/60),s=e%60;return t>0?`${t}h ${s}m`:`${s}m`}const bl=({catalog:t,status:s,loading:a,onRefresh:r,productionPerHour:n,onSubmit:i})=>{const[o,l]=e.useState({}),c=e.useMemo(()=>t||[],[t]),d=e.useMemo(()=>{const e=new Map;for(const t of c)e.set(t.key,xl(t.creditsCost,n));return e},[c,n]),u=e.useMemo(()=>{let e=0,t=0;for(const s of c){const a=Math.max(0,Math.floor(o[s.key]||0));if(a<=0)continue;e+=a*Math.max(0,Number(s.creditsCost||0));const r=d.get(s.key)??null;r&&r>0&&(t+=a*r)}return{totalCredits:e,totalMinutes:t}},[c,o,d]);return x.jsxs("div",{className:"game-card !bg-gray-900 border border-gray-700",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Fleets"}),x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs("div",{className:"text-xs text-gray-300",children:[x.jsxs("span",{className:"mr-4",children:["Total credits:"," ",x.jsx("span",{className:"font-mono text-white",children:u.totalCredits.toLocaleString()})]}),x.jsxs("span",{children:["Total time: ",x.jsx("span",{className:"font-mono text-white",children:fl(u.totalMinutes)})]})]}),x.jsx("button",{onClick:r,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:a?"Loading...":"Refresh"}),x.jsx("button",{onClick:()=>l({}),className:"text-xs px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-800",children:"Reset"}),x.jsx("button",{onClick:async()=>{const e=c.map(e=>({key:e.key,quantity:Math.max(0,Math.floor(o[e.key]||0))})).filter(e=>e.quantity>0);0!==e.length&&("function"==typeof i?await i(e,{credits:u.totalCredits,minutes:u.totalMinutes}):alert(`Submit not yet wired.\nTotal credits: ${u.totalCredits.toLocaleString()}\nTotal time: ${fl(u.totalMinutes)}`))},disabled:a||u.totalCredits<=0,className:"text-xs px-3 py-1 rounded "+(a||u.totalCredits<=0?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:"Submit"})]})]}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"sticky top-0 bg-gray-800",children:x.jsxs("tr",{className:"text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 px-3 text-left",children:"Unit"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Credits"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Energy"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Hangar"}),x.jsx("th",{className:"py-2 px-3 text-left",children:"Time"}),x.jsx("th",{className:"py-2 px-3 text-right",children:"Quantity"})]})}),x.jsx("tbody",{children:c.map(e=>{const t=e.key,{canStart:r,reasons:n}=(e=>{const t=s?.eligibility?.[e.key];return{canStart:!!t?.canStart,reasons:t?.reasons||[]}})(e),i=!r&&Array.isArray(n)&&n.length>0?n.join("; "):"",c=d.get(t)??null;return x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/60",children:[x.jsxs("td",{className:"py-2 px-3 align-top",children:[x.jsx("div",{className:"text-white",children:e.name}),x.jsx("div",{className:"text-xs text-gray-400",children:gl(e)}),i&&x.jsx("div",{className:"text-xs text-red-300 mt-1",children:i}),(()=>{const t=((e,t)=>{const s=(e.techPrereqs||[]).map(e=>`${e.key.replace(/_/g," ")} ${e.level}`).join(", "),a="number"==typeof e.requiredShipyardLevel?"number"==typeof e.requiredOrbitalShipyardLevel?`Shipyard ${e.requiredShipyardLevel} (Orbital ${e.requiredOrbitalShipyardLevel})`:`Shipyard ${e.requiredShipyardLevel}`:"",r=[];return s&&r.push(s),a&&r.push(a),{text:r.length?r.join(" â€¢ "):"â€”",hasRequirements:r.length>0,isUnmet:!!(t&&t.length>0&&t.some(e=>e.includes("Shipyard level")||e.includes("Orbital Shipyard level")||e.includes("Requires")))}})(e,n);return t.hasRequirements&&x.jsx("div",{className:"text-xs mt-1 "+(t.isUnmet?"text-red-300":"text-gray-500"),children:t.text})})()]}),x.jsx("td",{className:"py-2 px-3 align-top",children:e.creditsCost.toLocaleString()}),x.jsx("td",{className:"py-2 px-3 align-top",children:0===e.energyDelta||"number"!=typeof e.energyDelta?"":String(e.energyDelta)}),x.jsx("td",{className:"py-2 px-3 align-top",children:"number"==typeof e.hangar&&0!==e.hangar?e.hangar:""}),x.jsx("td",{className:"py-2 px-3 align-top",children:c&&c>0?fl(c):"â€”"}),x.jsx("td",{className:"py-2 px-3 align-top text-right",children:x.jsx("input",{type:"number",min:0,step:1,inputMode:"numeric",pattern:"[0-9]*",value:o[t]??"",onChange:e=>((e,t)=>{const s=Math.max(0,Math.floor(Number(t||0)));l(t=>({...t,[e]:s}))})(t,e.target.value),disabled:!r||a,title:!r&&i?i:void 0,className:"w-24 px-2 py-1 rounded text-right font-mono bg-gray-800 border "+(r&&!a?"border-gray-600 text-white":"border-gray-700 text-gray-400 cursor-not-allowed")})})]},t)})})]})}),x.jsx("div",{className:"px-3 py-2 text-xs text-gray-400",children:n&&n>0?`Time is computed from production capacity: ${n.toLocaleString()} credits/hour`:"Time is unavailable until this base has production capacity."})]})},vl=({productionQueue:t,unitsCatalog:s,productionPerHour:a,onRefresh:r,onCancel:n})=>{const[,i]=e.useState(0),o=e.useRef(null);e.useEffect(()=>{if(0!==t.length)return o.current=window.setInterval(()=>{i(e=>e+1)},1e3),()=>{o.current&&(window.clearInterval(o.current),o.current=null)};o.current&&(window.clearInterval(o.current),o.current=null)},[t.length]);return 0===t.length?null:x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h4",{className:"text-sm font-semibold text-empire-gold",children:"Ship Production"}),x.jsxs("div",{className:"text-xs text-gray-400",children:[t.length," item",1!==t.length?"s":""," in queue"]})]}),t.map(e=>{const t=(e=>{const t=Date.now(),s=new Date(e.startedAt).getTime(),a=new Date(e.completesAt).getTime();if(!Number.isFinite(s)||!Number.isFinite(a)||s>=a)return t>=a?100:0;const r=a-s,n=Math.max(0,Math.min(r,t-s))/r*100;return Math.max(0,Math.min(100,n))})(e),r=(e=>{const t=Date.now(),s=new Date(e).getTime(),a=Math.max(0,s-t);if(a<1e3)return"Completed";const r=Math.floor(a/36e5),n=Math.floor(a%36e5/6e4),i=Math.floor(a%6e4/1e3);return r>0?`${r}h ${n}m ${i}s`:n>0?`${n}m ${i}s`:`${i}s`})(e.completesAt),i=(e=>{const t=s.find(t=>t.key===e);return t?.name||e})(e.unitKey),o=t>=100;return x.jsxs("div",{className:"p-3 bg-gray-800/60 border border-gray-600 rounded-md",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsxs("div",{className:"text-sm text-gray-200",children:[x.jsx("span",{className:"font-medium",children:i}),e.totalQuantity>1&&x.jsxs("span",{className:"ml-2 text-gray-400",children:["(",e.quantity,"/",e.totalQuantity,")"]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("div",{className:"text-sm "+(o?"text-green-400":"text-yellow-300"),children:o?"Completed":`ETA: ${r}`}),n&&!o&&x.jsx("button",{onClick:()=>(async e=>{if(n)try{await n(e)}catch(t){console.error("Failed to cancel production:",t)}})(e.id),className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded transition-colors",title:"Cancel production",children:"Cancel"})]})]}),x.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2 mb-2",children:x.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(o?"bg-green-600":"bg-blue-600"),style:{width:`${t}%`}})}),x.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[x.jsxs("span",{children:["Cost: ",e.creditsCost.toLocaleString()," credits"]}),a&&x.jsxs("span",{children:["Production: ",a.toLocaleString()," credits/hour"]})]})]},e.id)}),r&&x.jsx("div",{className:"text-center",children:x.jsx("button",{onClick:r,className:"text-xs px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"Refresh Status"})})]})},jl=({activeConstruction:t,structuresCatalog:s,levels:a,constructionPerHour:r,baseCoord:n,onRefresh:i,onCancel:o})=>{const[,l]=e.useState(0),c=e.useRef(null);e.useEffect(()=>{if(t)return c.current=window.setInterval(()=>{l(e=>e+1)},1e3),()=>{c.current&&(window.clearInterval(c.current),c.current=null)};c.current&&(window.clearInterval(c.current),c.current=null)},[!!t]);if(!t)return null;const d=(e=>{const t=Date.now(),n=new Date(e.completionAt).getTime();if(!Number.isFinite(n))return t>=n?100:0;let i=NaN;try{const t=e.key,o=(a?.[t]??0)+1;let l=null;try{l=Sn(t,o)}catch{l=1===o?s.find(e=>e.key===t)?.creditsCost??null:null}const c=r??0;if(l&&c>0){i=n-l/c*3600*1e3}}catch{}if(!Number.isFinite(i)||i>=n)return t>=n?100:0;const o=n-i,l=Math.max(0,Math.min(o,t-i))/o*100;return Math.max(0,Math.min(100,l))})(t),u=(e=>{const t=Date.now(),s=new Date(e).getTime(),a=Math.max(0,s-t);if(a<1e3)return"Completed";const r=Math.floor(a/36e5),n=Math.floor(a%36e5/6e4),i=Math.floor(a%6e4/1e3);return r>0?`${r}h ${n}m ${i}s`:n>0?`${n}m ${i}s`:`${i}s`})(t.completionAt),h=(e=>{const t=s.find(t=>t.key===e);return t?.name||e})(t.key),m=d>=100;let p=null;try{const e=(a?.[t.key]??0)+1;try{p=Sn(t.key,e)}catch{p=1===e?s.find(e=>e.key===t.key)?.creditsCost??null:null}}catch{}return x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h4",{className:"text-sm font-semibold text-empire-gold",children:"Structure Construction"}),x.jsx("div",{className:"text-xs text-gray-400",children:"Active construction"})]}),x.jsxs("div",{className:"p-3 bg-gray-800/60 border border-gray-600 rounded-md",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsxs("div",{className:"text-sm text-gray-200",children:[x.jsx("span",{className:"font-medium",children:h}),x.jsxs("span",{className:"ml-2 text-gray-400",children:["(Level ",(a?.[t.key]??0)+1,")"]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("div",{className:"text-sm "+(m?"text-green-400":"text-yellow-300"),children:m?"Completed":`ETA: ${u}`}),o&&!m&&x.jsx("button",{onClick:async()=>{if(o&&t)try{await o(n)}catch(e){console.error("Failed to cancel construction:",e)}},className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded transition-colors",title:"Cancel construction",children:"Cancel"})]})]}),x.jsx("div",{className:"w-full bg-gray-600 rounded-full h-2 mb-2",children:x.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(m?"bg-green-600":"bg-purple-600"),style:{width:`${d}%`}})}),x.jsxs("div",{className:"flex justify-between text-xs text-gray-400",children:[x.jsx("span",{children:p?`Cost: ${p.toLocaleString()} credits`:"Cost: calculating..."}),r&&r>0&&x.jsxs("span",{children:["Construction: ",r.toLocaleString()," credits/hour"]})]})]}),i&&x.jsx("div",{className:"text-center",children:x.jsx("button",{onClick:i,className:"text-xs px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"Refresh Status"})})]})},wl=({onClick:e,title:t="View breakdown âŸ¶",dataTestId:s,className:a})=>x.jsx("button",{onClick:e,className:["text-blue-400 hover:text-blue-300 text-xs",a].filter(Boolean).join(" "),...s?{"data-testid":s}:{},children:t}),Nl=e=>{if(e.displayName&&e.displayName.trim().length>0)return e.displayName;if(e.catalogKey)try{const t=hn().find(t=>t.key===e.catalogKey);if(t)return t.name}catch{}return e.catalogKey||"Unknown Structure"},kl=e=>{if(!e)return"";const t=new Date(e).getTime()-Date.now();if(t<=0)return"Completing...";const s=Math.ceil(t/1e3);return`${Math.floor(s/60)}m ${s%60}s`};function Sl({label:e,main:t,sub:s}){return x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:e}),x.jsx("div",{className:"mt-1 text-lg text-white font-mono",children:t}),s&&x.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:s})]})}const _l=({base:t,onBack:s,initialActivePanel:a,onPanelChange:r})=>{const[n,i]=e.useState(a??"overview"),[o,l]=e.useState(0);e.useEffect(()=>{a&&a!==n&&i(a)},[a]);const[c,d]=e.useState(null),u=e=>{d(e),window.setTimeout(()=>d(null),3e3)},[h,m]=e.useState([]),[p,y]=e.useState(!1),[g,f]=e.useState(null),[b,v]=e.useState(!1),[j,w]=e.useState(null),[N,k]=e.useState([]),[S,_]=e.useState(null),{checkAuth:C}=ta(),{openModal:P}=ha(),A=async()=>{if(t?.locationCoord)try{const e=await Go.get(t.locationCoord);e.success&&e.data&&_(e.data.stats)}catch{}finally{l(e=>e+1)}},R=async()=>{try{f(null),y(!0);const e=await dl.getBaseStructures(t.locationCoord);if(e.success&&e.data){const s=[];for(const a of e.data.items)if(a.currentLevel>0){const e={_id:`${t.locationCoord}-${a.key}`,type:"metal_mine",level:a.currentLevel,isActive:!0,constructionStarted:null,constructionCompleted:null,displayName:a.name,catalogKey:a.key,empireId:t.empireId||"",locationCoord:t.locationCoord};s.push(e)}m(s)}else f(e.error||"Failed to load buildings")}catch{f("Network error")}finally{y(!1)}},T=async()=>{if(t?.locationCoord)try{w(null),v(!0);const e=await En.getFleets(t.locationCoord);e.success&&e.data?k(Array.isArray(e.data.fleets)?e.data.fleets:[]):w(e.error||"Failed to load fleets")}catch{w("Network error")}finally{v(!1)}};e.useEffect(()=>{"overview"===n&&t?.locationCoord&&(R(),T())},[n,t?.locationCoord]),e.useEffect(()=>{if("overview"!==n)return;if(!h||0===h.length)return;if(!h.some(e=>!e.isActive))return;const e=window.setInterval(()=>{R(),l(e=>e+1)},15e3);return()=>{window.clearInterval(e)}},[n,h]);const[E,O]=e.useState([]),[I,M]=e.useState(null),[F,$]=e.useState(!1),[L,q]=e.useState(null),[U,D]=e.useState(null),[W,B]=e.useState([]),[z,H]=e.useState(null),[Z,G]=e.useState(!1),[K,Y]=e.useState(null),[V,J]=e.useState({}),[Q,X]=e.useState(null),[ee,te]=e.useState(void 0),[se,ae]=e.useState(null),[re,ne]=e.useState(null),[ie,oe]=e.useState(null),[le,ce]=e.useState(null),[de,ue]=e.useState(null),[he,me]=e.useState(null),[pe,ye]=e.useState([]),[ge,xe]=e.useState(null),[fe,be]=e.useState(!1),[ve,je]=e.useState(null),[we,Ne]=e.useState([]),[ke,Se]=e.useState(null),[_e,Ce]=e.useState(!1),[Pe,Ae]=e.useState(null),[Re,Te]=e.useState([]),Ee=async()=>{try{q(null);const[e,s]=await Promise.all([Xo.getCatalog(),Xo.getStatus(t.locationCoord)]);e.success?O(e.data.catalog):q(e.error||"Failed to load catalog"),s.success?M(s.data.status):q(s.error||"Failed to load status")}catch(Vl){q("Failed to load research data")}},Oe=async()=>{if(t?.locationCoord)try{const e=await Xo.getQueue(t.locationCoord);if(e.success&&e.data){const t=e.data.queue||[],s=t.length>0?t[0]:null;D(s?{key:s.techKey,completesAt:String(s.completesAt)}:null)}}catch{}};e.useEffect(()=>{"research"===n&&(Ee(),Oe(),$e())},[n,t?.locationCoord]);const Ie=async()=>{try{Y(null),G(!0);const e=await tl.getCatalog();e.success?B(e.data.catalog):Y(e.error||"Failed to load structures catalog")}catch(Vl){Y("Failed to load structures data")}finally{G(!1)}},Fe=async()=>{if(t?.locationCoord)try{const e=await dl.getBaseStructures(t.locationCoord);if(e.success&&e.data){const t={},s={};for(const a of e.data.items)t[a.key]=a.currentLevel||0,s[a.key]={canStart:!!a.canStart,reasons:a.reasons||[]};J(t),H({techLevels:{},eligibility:s}),te(e.data.constructionPerHour),X(e.data.activeConstruction??null)}}catch{}},$e=async()=>{if(t?.locationCoord)try{const e=await nl.getStatus(t.locationCoord);e.success&&e.data&&ae(e.data)}catch{}},Le=async()=>{if(t?.locationCoord)try{const e=await Rn.getLocationByCoord(t.locationCoord);e.success&&e.data&&(ne("number"==typeof e.data.result?.solarEnergy?e.data.result.solarEnergy:null),oe("number"==typeof e.data.result?.yields?.gas?e.data.result.yields.gas:null),ce("number"==typeof e.data.result?.yields?.metal?e.data.result.yields.metal:null),ue("number"==typeof e.data.result?.yields?.crystals?e.data.result.yields.crystals:null),me("number"==typeof e.data.result?.fertility?e.data.result.fertility:null))}catch{}},qe=async()=>{},{isFullyConnected:Ue}=aa(),[De,We]=e.useState(0),Be=e.useRef(null),ze=e.useRef(!1);e.useEffect(()=>{if(ze.current=!1,Q)return Be.current=window.setInterval(()=>{We(e=>e+1)},1e3),()=>{Be.current&&(window.clearInterval(Be.current),Be.current=null)};Be.current&&(window.clearInterval(Be.current),Be.current=null)},[Q?.key,Q?.completionAt]),e.useEffect(()=>{if(!Q)return;const e=Date.now(),t=new Date(Q.completionAt).getTime();let s=e-1e3;try{const e=Q.key,a=(V?.[e]??0)+1;let r=null;try{r=Sn(e,a)}catch{r=1===a?W.find(t=>t.key===e)?.creditsCost??null:null}const n=ee??se?.construction?.value??0;if(r&&n>0){s=t-r/n*3600*1e3}}catch{}const a=Math.max(1,t-s);Math.max(0,Math.min(a,e-s))/a*100>=100&&!ze.current&&(ze.current=!0,(async()=>{try{await Promise.all([C(!0),A()]),await Fe()}catch{}})())},[De,Q?.completionAt]);e.useEffect(()=>{"structures"===n&&(Ie(),Fe(),$e(),qe(),Le(),Ee())},[n]);const He=async()=>{try{je(null),be(!0);const[e,t]=await Promise.all([sl.getCatalog(),sl.getStatus()]);e.success?ye(e.data.catalog):je(e.error||"Failed to load defenses catalog"),t.success?xe(t.data.status):je(t.error||"Failed to load defenses status")}catch(Vl){je("Failed to load defenses data")}finally{be(!1)}};e.useEffect(()=>{"defense"===n&&He()},[n,t?.locationCoord]);const Ze=async()=>{try{Ae(null),Ce(!0);const[e,s]=await Promise.all([al.getCatalog(),al.getStatus(t.locationCoord)]);e.success?Ne(e.data.catalog):Ae(e.error||"Failed to load units catalog"),s.success?Se(s.data.status):Ae(s.error||"Failed to load units status")}catch(Vl){Ae("Failed to load units data")}finally{Ce(!1)}},Ge=async()=>{if(t?.locationCoord)try{const e=await al.getProductionQueue(t.locationCoord);e.success&&e.data?Te(e.data.queue||[]):Te([])}catch{Te([])}};e.useEffect(()=>{"fleet"===n&&(Ze(),$e(),Ge())},[n,t?.locationCoord]),e.useEffect(()=>{let e=!0;return _(null),t?.locationCoord&&Go.get(t.locationCoord).then(t=>{e&&t.success&&t.data&&_(t.data.stats)}).catch(()=>{}),()=>{e=!1}},[t?.locationCoord]);return x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsx("div",{className:"flex items-center mb-4",children:x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",title:"Back to overview",children:"â† Back"}),x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl font-bold text-empire-gold",children:t.name}),x.jsx("p",{className:"text-gray-400 font-mono",children:t.locationCoord})]})]})}),S&&x.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[x.jsx(Sl,{label:"Area Usage",main:x.jsxs("span",{className:S.area.free>0?"text-green-300":"text-red-300",children:[S.area.used.toLocaleString()," / ",S.area.total.toLocaleString()]}),sub:x.jsx(wl,{onClick:async()=>{try{if(!t?.locationCoord)return;const e=await dl.getBaseStructures(t.locationCoord);if(!e.success||!e.data)return;const s=e.data.items||[],a={};for(const t of s)a[String(t.key)]=Math.max(0,Number(t.currentLevel||0));const r=hn(),n=new Map(r.map(e=>[e.key,e.name])),i=new Map(r.map(e=>[e.key,Number(e.areaRequired||0)])),o=[];for(const[t,l]of Object.entries(a)){if(!l)continue;const e=i.get(t)||0;if(!e)continue;const s=n.get(t)||t;o.push({key:t,name:s,value:l*e})}P("area_breakdown",{coord:t.locationCoord,totals:{used:S?.area.used??0,free:S?.area.free??0,total:S?.area.total??0},breakdown:{consumers:o.sort((e,t)=>t.value-e.value)}})}catch{}},dataTestId:"area-breakdown-link",title:"View breakdown âŸ¶"})}),x.jsx(Sl,{label:"Energy Balance",main:x.jsx("span",{className:S.energy.balance>=0?"text-green-300":"text-red-300",children:S.energy.balance.toLocaleString()}),sub:x.jsx(wl,{onClick:async()=>{try{if(!t?.locationCoord)return;const[e,s]=await Promise.all([dl.getBaseStructures(t.locationCoord),Rn.getLocationByCoord(t.locationCoord)]);if(!e.success||!e.data)return;const a=e.data.items||[],r={};for(const t of a)r[String(t.key)]=Math.max(0,Number(t.currentLevel||0));const n="number"==typeof s?.data?.result?.solarEnergy?s.data.result.solarEnergy:0,i="number"==typeof s?.data?.result?.yields?.gas?s.data.result.yields.gas:0,o=function(e){const{buildingsAtBase:t,location:s,includeQueuedReservations:a=!0,baseline:r=2}=e,n=Math.max(0,Number(s?.solarEnergy??0)),i=Math.max(0,Number(s?.gasYield??0));let o=r,l=0;for(const d of t||[]){if(!d?.isActive)continue;const e=String(d.key),t=Math.max(1,Number(d.level||1));if("solar_plants"===e){o+=t*n;continue}if("gas_plants"===e){o+=t*i;continue}const s=_n(e),a=Number(s?.energyDelta||0);a>=0?o+=t*a:l+=t*Math.abs(a)}let c=0;if(a)for(const d of t||[]){if(!d?.isQueuedConsumer)continue;const e=_n(String(d.key)),t=Number(e?.energyDelta||0);t<0&&(c+=t)}return{produced:o,consumed:l,balance:o-l,reservedNegative:c}}({buildingsAtBase:Object.entries(r).filter(([e,t])=>(t||0)>0).map(([e,t])=>({key:e,level:t,isActive:!0})),location:{solarEnergy:n,gasYield:i},includeQueuedReservations:!0}),l=hn(),c=new Map(l.map(e=>[e.key,e.name])),d=new Map(l.map(e=>[e.key,Number(e.energyDelta||0)])),u=2,h=(r.solar_plants||0)*n,m=(r.gas_plants||0)*i,p=[],y=[];for(const[t,g]of Object.entries(r)){if(!g)continue;if("solar_plants"===t||"gas_plants"===t)continue;const e=d.get(t)||0;if(!e)continue;const s=c.get(t)||t;e>=0?p.push({key:t,name:s,value:g*e}):y.push({key:t,name:s,value:g*Math.abs(e)})}P("energy_breakdown",{coord:t.locationCoord,totals:o,breakdown:{baseline:u,solar:h,gas:m,producers:p.sort((e,t)=>t.value-e.value),consumers:y.sort((e,t)=>t.value-e.value)}})}catch{}},dataTestId:"energy-breakdown-link",title:"View breakdown âŸ¶"})}),x.jsx(Sl,{label:"Population",main:x.jsxs("span",{className:S.population.free>0?"text-green-300":"text-red-300",children:[S.population.used.toLocaleString()," / ",S.population.capacity.toLocaleString()]}),sub:x.jsx(wl,{onClick:async()=>{try{if(!t?.locationCoord)return;const e=await dl.getBaseStructures(t.locationCoord);if(!e.success||!e.data)return;const s=e.data.items||[],a={};for(const t of s)a[String(t.key)]=Math.max(0,Number(t.currentLevel||0));const r=hn(),n=new Map(r.map(e=>[e.key,e.name])),i=new Map(r.map(e=>[e.key,Number(e.populationRequired||0)])),o=[];for(const[t,l]of Object.entries(a)){if(!l)continue;const e=i.get(t)||0;if(!e)continue;const s=n.get(t)||t;o.push({key:t,name:s,value:l*e})}P("population_breakdown",{coord:t.locationCoord,totals:{used:S?.population.used??0,free:S?.population.free??0,capacity:S?.population.capacity??0},breakdown:{users:o.sort((e,t)=>t.value-e.value),sources:[]}})}catch{}},dataTestId:"population-breakdown-link",title:"View breakdown âŸ¶"})})]})]}),x.jsx("div",{className:"game-card",children:x.jsxs("div",{className:"flex border-b border-gray-600",children:[x.jsx("button",{"data-testid":"tab-overview",onClick:()=>{i("overview"),r?.("overview")},className:"px-4 py-2 font-medium transition-colors "+("overview"===n?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200"),children:"ðŸ“‹ Overview"}),x.jsx("button",{"data-testid":"tab-fleet",onClick:()=>{i("fleet"),r?.("fleet")},className:"px-4 py-2 font-medium transition-colors "+("fleet"===n?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200"),children:"ðŸš€ Production"}),x.jsx("button",{"data-testid":"tab-defense",onClick:()=>{i("defense"),r?.("defense")},className:"px-4 py-2 font-medium transition-colors "+("defense"===n?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200"),children:"ðŸ›¡ï¸ Defense"}),x.jsx("button",{"data-testid":"tab-research",onClick:()=>{i("research"),r?.("research")},className:"px-4 py-2 font-medium transition-colors "+("research"===n?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200"),children:"ðŸ”¬ Research"}),x.jsx("button",{"data-testid":"tab-structures",onClick:()=>{i("structures"),r?.("structures")},className:"px-4 py-2 font-medium transition-colors "+("structures"===n?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200"),children:"ðŸ—ï¸ Structures"}),x.jsx("button",{"data-testid":"tab-trade",onClick:()=>{i("trade"),r?.("trade")},className:"px-4 py-2 font-medium transition-colors "+("trade"===n?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200"),children:"ðŸ’± Trade"})]})}),c&&x.jsx("div",{className:"game-card",children:x.jsx("div",{"data-testid":"notice-banner",className:"p-3 bg-blue-900/50 border border-blue-700 rounded-md text-blue-200",children:c})}),"overview"===n&&x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"game-card",children:x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsx("div",{className:"p-4 rounded-lg border border-gray-600 bg-gray-800/60 flex items-center justify-center",children:x.jsx(ll,{coord:t.locationCoord,className:"w-56 h-56 md:w-64 md:h-64"})}),x.jsx("div",{className:"p-4 rounded-lg border border-gray-600 bg-gray-800/60",children:x.jsx(ol,{coord:t.locationCoord,refreshKey:o,showBudgets:!1})})]})}),x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Fleets"}),x.jsx("button",{onClick:T,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:b?"Loading...":"Refresh"})]}),j&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3",children:j}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Fleet"}),x.jsx("th",{className:"text-left py-1 pr-4",children:"Player"}),x.jsx("th",{className:"text-left py-1 pr-4",children:"Arrival"}),x.jsx("th",{className:"text-right py-1",children:"Size"})]})}),x.jsx("tbody",{className:"text-white",children:N.length>0?N.map(e=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4",children:x.jsx(Me,{to:`/fleets/${e._id}`,className:"text-blue-300 hover:text-blue-200",children:e.name})}),x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:e.ownerName||"â€”"}),x.jsx("td",{className:"py-1 pr-4 text-gray-300",children:"â€”"}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.sizeCredits.toLocaleString()})]},e._id)):x.jsx("tr",{children:x.jsx("td",{colSpan:4,className:"py-3 text-center text-gray-400",children:"No fleets detected in orbit."})})})]})})]}),x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Structures"}),x.jsx("button",{onClick:R,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:p?"Loading...":"Refresh"})]}),g&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3",children:g}),x.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Structures"}),x.jsx("th",{className:"text-right py-1",children:"Level"}),x.jsx("th",{className:"text-left py-1 pl-4",children:"Status"})]})}),x.jsx("tbody",{className:"text-white",children:h.map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:Nl(e)}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.level}),x.jsx("td",{className:"py-1 pl-4",children:e.isActive?x.jsx("span",{className:"text-green-400",children:"Active"}):x.jsxs("span",{className:"text-yellow-300",children:["Under construction â€¢ ETA ",kl(e.constructionCompleted)]})})]},e._id||t))})]})}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Structures"}),x.jsx("th",{className:"text-right py-1",children:"Level"}),x.jsx("th",{className:"text-left py-1 pl-4",children:"Status"})]})}),x.jsx("tbody",{className:"text-white",children:h.filter(e=>"command_center"===e.type||"shipyard"===e.type).map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:Nl(e)}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.level}),x.jsx("td",{className:"py-1 pl-4",children:e.isActive?x.jsx("span",{className:"text-green-400",children:"Active"}):x.jsxs("span",{className:"text-yellow-300",children:["Under construction â€¢ ETA ",kl(e.constructionCompleted)]})})]},e._id||t))})]})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Defenses"}),x.jsx("th",{className:"text-right py-1",children:"Level"}),x.jsx("th",{className:"text-left py-1 pl-4",children:"Status"})]})}),x.jsx("tbody",{className:"text-white",children:h.filter(e=>"defense_station"===e.type).map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:Nl(e)}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.level}),x.jsx("td",{className:"py-1 pl-4",children:e.isActive?x.jsx("span",{className:"text-green-400",children:"Active"}):x.jsxs("span",{className:"text-yellow-300",children:["Under construction â€¢ ETA ",kl(e.constructionCompleted)]})})]},e._id||t))})]})})]})]})]})]}),"structures"===n&&x.jsxs("div",{className:"space-y-6",children:[K&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200",children:K}),x.jsx(jl,{activeConstruction:Q,structuresCatalog:W,levels:V,constructionPerHour:ee??se?.construction?.value,baseCoord:t.locationCoord,onRefresh:()=>{Ie(),Fe(),$e(),qe()},onCancel:async e=>{try{const t=await tl.cancelConstruction(e);t.success?(u("Construction cancelled"),await Promise.all([C(!0),A()]),await Ie(),await Fe(),await $e(),await qe()):u(t.error||t.message||"Failed to cancel construction")}catch{u("Network error")}}}),x.jsx(hl,{catalog:W,status:z,levels:V,loading:Z,onRefresh:()=>{Ie(),$e(),qe(),Le()},onStart:async e=>{try{const s=await tl.start(t.locationCoord,e);s.success?(u("Construction started"),await Promise.all([C(!0),A()]),await Fe()):u(s.error||s.message||"Failed to start construction")}catch{u("Network error")}},onQueue:async e=>(u("Construction is currently disabled while the system is being rebuilt."),{success:!1}),isOffline:!Ue,actionLabel:(e,t)=>t?"Build":"Unavailable",constructionPerHour:ee??se?.construction?.value,activeConstruction:Q,locationCoord:t.locationCoord,techLevels:I?.techLevels,planetSolarEnergy:re??void 0,planetGasYield:ie??void 0,planetMetalYield:le??void 0,planetCrystalsYield:de??void 0,planetFertility:he??void 0})]}),"trade"===n&&x.jsx("div",{className:"game-card text-center",children:x.jsxs("div",{className:"py-12",children:[x.jsx("div",{className:"text-6xl mb-4",children:"ðŸ’±"}),x.jsx("h3",{className:"text-xl font-semibold mb-2 text-gray-300",children:"Trade Center"}),x.jsx("p",{className:"text-gray-400 mb-6",children:"Trade systems are coming soon. Use the Structures tab to build infrastructure that unlocks trading."})]})}),"fleet"===n&&x.jsxs("div",{className:"space-y-6",children:[Pe&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200",children:Pe}),x.jsx(vl,{productionQueue:Re,unitsCatalog:we,productionPerHour:se?.production?.value,onRefresh:Ge,onCancel:async e=>{try{const t=await al.cancelProduction(e);t.success?(u("Production cancelled"),await Promise.all([C(!0),A()]),await Ge()):u(t.error||t.message||"Failed to cancel production")}catch{u("Network error")}}}),x.jsx(bl,{catalog:we,status:ke,loading:_e,onRefresh:Ze,productionPerHour:se?.production?.value,onSubmit:async(e,s)=>{try{Ae(null);let a=0,r=0,n=0;const i=[];for(const{key:s,quantity:d}of e){const e=Math.max(0,Math.floor(d||0));for(let o=0;o<e;o++)try{const e=await al.start(t.locationCoord,s);if(e?.success)a++;else if("ALREADY_IN_PROGRESS"===e?.code||409===e?.status)r++;else{n++;const t=e?.message||e?.error||"Failed";Array.isArray(e?.reasons)&&e.reasons.length?i.push(...e.reasons):i.push(String(t))}}catch(Vl){n++;const t=Vl?.response?.data?.message||Vl?.message||"Request failed",s=Vl?.response?.data?.reasons;Array.isArray(s)&&s.length?i.push(...s):i.push(String(t))}}await Promise.all([C(!0),A()]),await Ze(),await Ge();const o=Math.floor(s.minutes/60),l=s.minutes%60,c=o>0?`${o}h ${l}m`:`${l}m`;if(u(`Queued ${a.toLocaleString()} â€¢ conflicts ${r.toLocaleString()} â€¢ failed ${n.toLocaleString()} â€¢ ${c}`),n>0){const e=Array.from(new Set(i.map(String)));Ae(`Some items failed: ${e.join("; ")}`)}}catch{Ae("Production submission failed.")}}})]}),"defense"===n&&x.jsxs("div",{className:"space-y-6",children:[ve&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200",children:ve}),x.jsx(yl,{catalog:pe,status:ge,loading:fe,onRefresh:He,onStart:async e=>{try{be(!0),je(null);const s=await sl.start(t.locationCoord,e);s.success?(await Promise.all([C(!0),A()]),await He()):"ALREADY_IN_PROGRESS"===s.code?(console.info("Defense already in progress:",s.message),u("Already in progress â€” refreshed."),await Promise.all([C(!0),A()]),await He()):je(s.error||s.message||"Failed to start defense")}catch{je("Network error")}finally{be(!1)}}})]}),"research"===n&&x.jsxs("div",{className:"space-y-6",children:[x.jsx(pl,{baseCoord:t.locationCoord,onChanged:async()=>{await Promise.all([C(!0),A()]),await Ee(),await Oe(),await $e()}}),L&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200",children:L}),x.jsx(ml,{catalog:E,status:I,loading:F,researchPerHour:se?.research?.value,activeResearch:U,onRefresh:()=>{Ee(),Oe(),$e()},onStart:async e=>{try{$(!0),q(null);const s=await Xo.start(t.locationCoord,e);s.success?(await Promise.all([C(!0),A()]),await Ee(),await Oe(),await $e()):"ALREADY_IN_PROGRESS"===s.code?(console.info("Research already in progress:",s.message),u("Already in progress â€” refreshed."),await Promise.all([C(!0),A()]),await Ee(),await Oe(),await $e()):q(s.error||s.message||"Failed to start technology")}catch{q("Network error")}finally{$(!1)}}})]})]})},Cl=({empire:t})=>{const{selectedBaseId:s,bases:a,loading:r,error:n,setSelectedBase:i,setBases:o,setLoading:l,setError:c,getSelectedBase:d}=oo(),[u,h]=e.useState("overview"),m=async()=>{if(t){l(!0),c(null);try{const e=await Bs.get("/game/territories");if(!e.data.success)throw new Error(e.data.error||"Failed to fetch territories");const t=e.data.data.territories,a=(await Promise.all(t.map(async e=>{try{const t=await Bs.get(`/game/buildings/location/${e.coord}`),s=t.data.success?t.data.data.buildings:[];return{_id:e._id??e.coord,name:e.name??e.coord,locationCoord:e.coord,buildings:s}}catch(t){return console.error(`Error fetching buildings for ${e.coord}:`,t),null}}))).filter(e=>null!==e);o(a),!s&&a.length>0&&(i(a[0]._id),h("detail"))}catch(Jl){console.error("Error fetching bases:",Jl),c("Failed to load bases. Please try again.")}finally{l(!1)}}},p=e=>{h(e),"overview"===e&&i(null)};if(e.useEffect(()=>{t&&m()},[t]),r)return x.jsx("div",{className:"flex items-center justify-center h-64",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-400",children:"Loading bases..."})]})});if(n)return x.jsx("div",{className:"game-card",children:x.jsxs("div",{className:"text-center",children:[x.jsxs("div",{className:"text-red-400 mb-4",children:["âš ï¸ ",n]}),x.jsx("button",{onClick:m,className:"game-button",children:"Retry"})]})});const y=d();return x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsx("h1",{className:"text-2xl font-bold text-empire-gold",children:"Empire Management"}),x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsxs("span",{className:"text-sm text-gray-400",children:[a.length," ",1===a.length?"Base":"Bases"]}),x.jsx("button",{onClick:m,className:"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Refresh"})]})]}),x.jsxs("div",{className:"flex border-b border-gray-600",children:[x.jsx("button",{onClick:()=>p("overview"),className:"px-4 py-2 font-medium transition-colors "+("overview"===u?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200"),children:"All Bases Overview"}),x.jsx("button",{onClick:()=>p("detail"),disabled:!y,className:"px-4 py-2 font-medium transition-colors "+("detail"===u&&y?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"),children:y?`${y.name}`:"Select a Base"})]})]}),"overview"===u?x.jsx(Jo,{bases:a,empire:t,onBaseSelect:e=>{i(e),h("detail")},onUpdate:m}):y?x.jsx(_l,{base:y,onBack:()=>p("overview")}):x.jsxs("div",{className:"game-card text-center",children:[x.jsx("p",{className:"text-gray-400 mb-4",children:"No base selected"}),x.jsx("button",{onClick:()=>p("overview"),className:"game-button",children:"View All Bases"})]})]})},Pl=()=>{const{empire:e,isLoading:t}=ta();return t?x.jsx("div",{className:"flex items-center justify-center h-64",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-400",children:"Loading bases..."})]})}):e?x.jsx(Cl,{empire:e,onUpdate:()=>{}}):x.jsx("div",{className:"game-card",children:x.jsxs("div",{className:"text-center",children:[x.jsx("p",{className:"text-gray-300 mb-2",children:"No empire data available."}),x.jsx("p",{className:"text-gray-500 text-sm",children:"Please create an empire or refresh the page."})]})})},Al=({label:e,main:t,sub:s})=>x.jsxs("div",{className:"bg-gray-800/60 border border-gray-700 rounded-md px-4 py-3",children:[x.jsx("div",{className:"text-xs text-gray-400",children:e}),x.jsx("div",{className:"mt-1 text-lg text-white font-mono",children:t}),s&&x.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:s})]}),Rl={metal_mine:"Metal Mine",energy_plant:"Energy Plant",factory:"Manufacturing Plant",research_lab:"Research Laboratory",defense_station:"Defense Station",shipyard:"Shipyard",command_center:"Command Center",habitat:"Habitat Module"},Tl=e=>{if(e.displayName&&e.displayName.trim().length>0)return e.displayName;if(e.catalogKey)try{return un(e.catalogKey).name}catch{}return Rl[e.type]??e.type},El=()=>{const t=ue(),{coord:s}=he(),[a]=Ue(),{user:r,empire:n}=ta(),i=a.get("tab"),o="fleets"===i?"fleet":i,l="overview"===o||"fleet"===o||"defense"===o||"research"===o||"structures"===o||"trade"===o?o:void 0,c=e=>{const s=new URLSearchParams(a);s.set("tab",e),t({search:`?${s.toString()}`},{replace:!0})},[d,u]=e.useState(!0),[h,m]=e.useState(null),[p,y]=e.useState(null),[g,f]=e.useState(null),[b,v]=e.useState(null),[j,w]=e.useState([]),[N,k]=e.useState(null),[S,_]=e.useState([]),[C,P]=e.useState(null),[A,R]=e.useState(null),T=!!r&&!!g&&r._id===g;return e.useEffect(()=>{let e=!0;return(async()=>{if(!s)return m("Missing coordinate"),void u(!1);u(!0),m(null);try{const t=await Rn.getLocationByCoord(s);if(!e)return;if(!t.success||!t.data)return m(t.error||"Failed to load location"),void u(!1);y(t.data.owner?.username??null),f(t.data.owner?.id??null);try{const t=await Go.get(s);e&&t.success&&t.data&&R(t.data.stats)}catch{}if(r&&t.data.owner?.id===r._id){v({_id:s,empireId:n?._id,locationCoord:s,name:`Base ${s}`,createdAt:new Date,updatedAt:new Date}),w([]),k(null)}else{v(null);try{k(null);const e=await dl.getBaseStructures(s);if(e.success&&e.data){const t=e.data.items.map(e=>({...e,displayName:e.name,catalogKey:e.key,level:e.currentLevel,isActive:!0,_id:`${s}-${e.key}`,type:e.type||"unknown",empireId:void 0,locationCoord:s}));w(t)}else w([]),k(e.error||"Failed to load buildings")}catch{w([]),k("Network error while loading buildings")}try{P(null);const e=await En.getFleets(s);e.success&&e.data&&e.data.fleets?_(e.data.fleets):(_([]),P(e.error||"Failed to load fleets"))}catch{_([]),P("Network error while loading fleets")}}}catch(Vl){if(!e)return;m("Network error while loading base")}finally{e&&u(!1)}})(),()=>{e=!1}},[s,r,n?._id]),d?x.jsx("div",{className:"game-card",children:x.jsx("div",{className:"py-10 text-center text-gray-300",children:"Loading base..."})}):h?x.jsx("div",{className:"game-card",children:x.jsx("div",{className:"py-6 text-center text-red-300",children:h})}):T&&b&&n?x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"game-card mb-0",children:x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl font-bold text-empire-gold",children:b.name}),x.jsx("p",{className:"text-gray-400 font-mono",children:s})]}),x.jsx("button",{className:"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",onClick:()=>t(-1),children:"â† Back"})]})}),x.jsx(_l,{base:b,onBack:()=>t(-1),initialActivePanel:l,onPanelChange:c})]}):x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl font-bold text-white",children:"Base (Public View)"}),x.jsx("p",{className:"text-sm text-gray-400",children:s})]}),x.jsx("button",{className:"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",onClick:()=>t(-1),children:"â† Back"})]}),x.jsxs("div",{className:"text-sm text-gray-300",children:["Owner: ",x.jsx("span",{className:"text-empire-gold",children:p??"â€”"})]}),A&&x.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-3",children:[x.jsx(Al,{label:"Area Usage",main:x.jsxs("span",{children:[A.area.used.toLocaleString()," / ",A.area.total.toLocaleString()]}),sub:x.jsxs("span",{children:["(free ",A.area.free.toLocaleString(),")"]})}),x.jsx(Al,{label:"Energy Balance",main:x.jsx("span",{className:A.energy.balance>=0?"text-green-300":"text-red-300",children:A.energy.balance.toLocaleString()}),sub:x.jsxs("span",{children:["+",A.energy.produced.toLocaleString()," prod "," ","âˆ’",A.energy.consumed.toLocaleString()," cons"]})}),x.jsx(Al,{label:"Population",main:x.jsxs("span",{children:[A.population.used.toLocaleString()," / ",A.population.capacity.toLocaleString()]}),sub:x.jsxs("span",{children:["(free ",A.population.free.toLocaleString(),")"]})})]})]}),x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"grid md:grid-cols-2 gap-6 items-start",children:[x.jsx("div",{className:"flex items-center justify-center",children:x.jsx(ll,{coord:s,className:"w-56 h-56 md:w-72 md:h-72"})}),x.jsx("div",{children:x.jsx(ol,{coord:s,showLinkToPlanetPage:!1,showBudgets:!1})})]}),x.jsx("div",{className:"mt-3 text-center",children:x.jsx("span",{className:"text-yellow-300",children:"Move fleet here"})})]}),x.jsxs("div",{className:"game-card",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold mb-3",children:"Fleets"}),C&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3",children:C}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Fleet"}),x.jsx("th",{className:"text-left py-1 pr-4",children:"Player"}),x.jsx("th",{className:"text-left py-1 pr-4",children:"Arrival"}),x.jsx("th",{className:"text-right py-1",children:"Size"})]})}),x.jsxs("tbody",{className:"text-white",children:[S.map(e=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-blue-300 hover:text-blue-200 cursor-default",children:e.name}),x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:e.ownerName}),x.jsx("td",{className:"py-1 pr-4 text-gray-300",children:e.arrival||"â€”"}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.sizeCredits.toLocaleString()})]},e._id)),0===S.length&&!C&&x.jsx("tr",{children:x.jsx("td",{colSpan:4,className:"py-3 text-center text-gray-400",children:"No fleets detected in orbit."})})]})]})})]}),x.jsxs("div",{className:"game-card",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold mb-3",children:"Structures"}),N&&x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded-md text-red-200 mb-3",children:N}),x.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Structures"}),x.jsx("th",{className:"text-right py-1",children:"Level"})]})}),x.jsxs("tbody",{className:"text-white",children:[j.filter(e=>"defense_station"!==e.type).map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:Tl(e)}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.level})]},e._id||t)),0===j.length&&x.jsx("tr",{children:x.jsx("td",{colSpan:2,className:"py-3 text-center text-gray-400",children:"No structures detected."})})]})]})}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Structures"}),x.jsx("th",{className:"text-right py-1",children:"Level"})]})}),x.jsx("tbody",{className:"text-white",children:j.filter(e=>"command_center"===e.type||"shipyard"===e.type).map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:Tl(e)}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.level})]},e._id||t))})]})}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Defenses"}),x.jsx("th",{className:"text-right py-1",children:"Level"})]})}),x.jsxs("tbody",{className:"text-white",children:[j.filter(e=>"defense_station"===e.type).map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:Tl(e)}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.level})]},e._id||t)),0===j.filter(e=>"defense_station"===e.type).length&&x.jsx("tr",{children:x.jsx("td",{colSpan:2,className:"py-3 text-center text-gray-400",children:"No defenses detected."})})]})]})})]})]})]})]})},Ol=[{id:"introduction",title:"Introduction",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Attrition is a massively multiplayer online game of space strategy. Build bases, expand your influence, research new technologies, command fleets, wage battles, form alliances, and grow a powerful interstellar empire."}),x.jsx("p",{children:"Each player starts from a single astro and can expand into a fullâ€‘fledged empire from there. Use the left navigation to explore specific topics. The FAQ and assistant tools can be added later as separate tabs if desired."})]})},{id:"map",title:"Map",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Each server on Attrition has many galaxies. Each galaxy has hundreds of stars and thousands of planets and asteroids. No two galaxies are the same; each is different from the others."}),x.jsx("p",{children:"A galaxy is divided into 100 square regions, laid out in a 10 x 10 grid. Each region can contain stars; some regions have several dozen stars, while others only have a few (and sometimes none at all)."}),x.jsx("p",{children:"Each star on the map represents a solar system, which can have several astros (a term used to refer to planets and other objects that orbit stars). Most astros can support bases, which allow a player to expand their empire. Only one base can be on any given astro, but bases can be expanded and improved by building various structures. All astros have certain common characteristics, such as terrain type, construction area, solar energy, fertility and various resources (namely metal, gas, and crystals)."}),x.jsx("p",{children:"A player can only see detailed information about bases or fleets owned by other players if they have a base or fleet somewhere in that region of space, or if one of their guild members has a base or fleet in that star system."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Wormholes"}),x.jsx("p",{children:"A wormhole is a portal that creates a shortcut, allowing for fast travel."}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"In each galaxy, there are 2 randomly placed wormholes with fixed positions. Being one located centrally (regions 44/45/54/55) and other placed in the outer regions."}),x.jsx("li",{children:"Players can use the wormholes to travel to any location with a speed boost. By using wormholes, stellar units can travel to other galaxies. Death Stars are not able to use wormholes."}),x.jsx("li",{children:"Wormholes provide a speed factor of 1+0.5*n, where n is the floor(average of the top 5 server Jump Gates). For example, if the average top 5 Jump Gates is level 2, then the Wormhole speed factor becomes 1+0.5*2=2, meaning the fleet will move 2x the normal speed."}),x.jsx("li",{children:"In newly opened galaxy clusters, the wormholes speed bonus depend on that cluster's Jump Gates until fleets can move from older to new clusters, then all server Jump Gates count."}),x.jsx("li",{children:"To use a wormhole, the player must place the desired fleet at the location of the wormhole and select the option 'Use Wormhole' to use it."}),x.jsx("li",{children:"It's not possible to build bases at wormhole locations"})]})]})},{id:"coordinates",title:"Coordinates",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Attrition uses a specialized coordinate system to denote locations, as detailed below (all numbers are separated by colons):"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"First, the galaxy coordinate is designated by the initial of whatever server is being viewed followed by a number representing the specific galaxy on that server. For example, in server Alpha, the first galaxy is represented by A00."}),x.jsx("li",{children:"Next, the region coordinate is designated by what row and column of the galaxy it is in. For example, the region in row 5 and the column of 1 is represented by the number 51, for a region address of A00:51."}),x.jsx("li",{children:"Third, the system coordinate is designated by what row and column of the region it is in, in the same manner as the region coordinate. So a system in the top-right corner of the region would be represented by the number 09, for a system address of A00:51:09."}),x.jsx("li",{children:"Fourth, the astro coordinate is designated by the star orbit number. Thus, the first planet for the above system would have an astro address of A00:51:09:01. A star can upwards of 20 astros."})]})]})},{id:"credits",title:"Credits",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Credits are the monetary unit used in Attrition, and are the basis of the game's economy. Credits are used to build structures and defenses on bases, to set up trade routes, to produce fleet (ships), and to invest in researching new technologies."}),x.jsx("p",{children:"Credits are received every hour on the hour, based on the total economy of a player's empire. There are three main methods of increasing the amount of credits gained: building structures to improve an individual base's economy, establishing trade routes between bases, and occupying the bases of another player's. In addition, a player can also gain more credits by recycling debris left at an astro after ships are destroyed, plundering trade routes, and by pillaging bases that have been conquered, or by scrapping ships or base structures that have been previously built."}),x.jsx("p",{children:"The main goal of Attrition is to optimize the resources at each base so as to efficiently improve them and use them to expand one's empire, by conquering other bases or by building new bases, and thus to increase one's credit income. Diplomacy and treaties as Alliances and Mutual Defense Pacts are good ways to achieve this objective."})]})},{id:"bases",title:"Bases",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Having a base on a planet means that a player owns that planet, and can use it to build various structures, most of which boost the base's ability to construct new buildings, produce new ships, and research new technologies, and many of which improve its economy, thus boosting the player's credit income."}),x.jsx("p",{children:"Player can build defensive structures at bases to protect the base, shipyards to produce starships, and research labs to research technologies, beside others structures."}),x.jsx("p",{children:"All structures cost a certain amount of credits, which directly affects how long it takes the structure to be built, and require a certain amount of energy as well. Most structures require one 'area' on the planet and one 'population' unit for each level, although there are some exceptions; for example, Urban Structures do not require a population unit, and Terraforming and Orbital Bases require neither area nor population."}),x.jsx("p",{children:"Defenses are a special kind of structure that automatically help to protect a base from other players who attack it, and also protect that player's ships in orbit around the base. However, defenses will not protect the fleets of guild members who might be in orbit around that base."}),x.jsx("p",{children:"To determine how long it will take a base to construct a new structure, divide the credit cost of the structure by the base's construction rating (which is measured in a number of credits that can be spent per hour); for example, a new base can construct buildings at the rate of 12 credits per hour, and a metal refinery initially costs 1 credit. Thus, it takes 1/12 of an hour to build the metal refinery, or 5 minutes."}),x.jsx("p",{children:"Fleet (ships) can only be produced at bases which have shipyards at them. Like structures, ships have a credit cost and will require a certain amount of time to build (determined by the base's production rating, again measured in a number of credits that can be spent each hour). In addition, most ships require multiple shipyards to be built, and all ships have technological requirements that must be met in order to be built at all."}),x.jsx("p",{children:"Likewise, technologies can only be researched at bases which have built research labs. As might be expected, they have a cost in credits and take a certain amount of time to research (this time determined by the base's research rating)."}),x.jsx("p",{children:"The only way to build new bases is to construct outpost ships and send them to empty planets. Thus, it is important to scout potential base locations first, to ensure that a player does not waste time by sending an outpost ship to a planet which already has a base or by building a base on a bad planet. Once a base is constructed, it can be managed in the same manner as a player's existing bases."}),x.jsx("p",{children:"A player can also conquer other players' bases, which are then occupied by the conquering player. However, this does not allow the conqueror to control the occupied base; instead, they receive 30% of the base's income. The base also suffers an additional 30% reduction to its construction and research ratings, and a 30% reduction to its production rating."})]})},{id:"technologies",title:"Technologies",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Researching new technologies primarily increase the capacities of a player's ships and bases."}),x.jsx("p",{children:"They also unlock new structures and starships that can be built, and grant access to more advanced technologies to further develop your empire."}),x.jsx("p",{children:"You can only research technologies at bases with research labs on them. Nearly all technologies require multiple research labs."})]})},{id:"trade",title:"Trade",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Once a base has at least one spaceport built, it can start a trade route with another base."}),x.jsx("p",{children:"The setting cost of a trade route is equal to 2 times the distance between the two bases. For example, a trade route from a base located in A00:49:10 to a base located in A00:59:10 will cost 20 credits, since they are 10 lightyears apart."}),x.jsx("p",{children:"If a trade route is set between 2 different players, both players pay half the trade route cost."}),x.jsx("p",{children:"A trade route will provide income to a base, equivalent to:"}),x.jsx("p",{children:"Trade Income = Sqrt(Lowest base's income) x [ 1 + Sqrt(2*Distance)/75 + Sqrt(Players)/10 ]"}),x.jsx("p",{children:"Where Players is the number of players involved in your trade network."}),x.jsx("p",{children:"A base can have one trade route for each 5 levels of spaceports - 1 route at level 1, another at level 5, another at level 10, etc."}),x.jsx("p",{children:"Trade routes can be plundered by other players, which terminates the trade route and gives a profit to the plunderer, equal to the trade route's cost."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Closing trade routes"}),x.jsx("p",{children:'When a trade route is canceled, each trading partner receives a 50% refund. The route then enters a "Closing" status for 12 hours if under 1000 distance, or 24 hours if longer. Pillaging a base yields 50% of the cost of any closing trade routes, which are then terminated.'})]})},{id:"fleets",title:"Fleets",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"The main way which players can attack other players is through using fleets, and can also be used to defend against another player's attack. You build ships at shipyards, a fleet being a group of ships. A fleet can be used to protect a base, or attack another player's fleets or bases."}),x.jsx("p",{children:"Fleets can be moved to other astros."}),x.jsx("p",{children:"Fleets from several players can be moved to the same location. If a player has two or more fleets headed to the same astro, they will automatically merge once both have arrived at the planet. No fleet will automatically attack any other fleet unless directed to by the player who owns it. The only way to launch an attack is to select the fleet number, select 'Attack' from the menu, then choose the target of the attack."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Detection time"}),x.jsx("p",{children:"Fleets from players outside your guild, can only be detected, once it is a certain arriving time from its destination, the detection time is given by the following formula:"}),x.jsx("p",{children:"Detection time (hrs) = 24*((-200000/((Size*1.6*0.9^Stealth tech)+200000))+1) + 1/120"}),x.jsx("h3",{className:"text-lg font-semibold",children:"Fleet Limit"}),x.jsx("p",{children:"Fleets are limited by the player's industrial capability to support them. The maximum total size of a player's fleet is based on their total production capacity, including any commander bonuses."}),x.jsx("p",{children:"Maximum Supported Fleet Size = Total Production * 2500"}),x.jsx("p",{children:"Once the total fleet size reaches this maximum limit, it is no longer possible to produce new units unless the production capacity is increased."})]})},{id:"attacks",title:"Attacks",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"A successful attack on a base does two things. First, it allows the attacking player to occupy the base, transferring 30% of the base's credit income to the occupier. This represents a tribute from the conquered base to the occupier. No structures can be destroyed by an attack, although base defenses have a percentage rating which represents how effective they are. Base defenses are automatically set at 0% once a base is occupied, and will automatically regenerate by 1% every hour after an occupation ends."}),x.jsx("p",{children:"Second, a successful attack will also give the attacker a percentage of the defending player's credits, due to the attacking ships ransacking the resources and materials (represented by credits) stored there. The actual amount is determined by the following formula:"}),x.jsx("p",{children:"Pillage = (number of hours since last pillage; max 100)% * (Base Economy/Total Bases Economy) * Base Owner Credits."}),x.jsx("p",{children:"In NPC bases: Pillage = number of hours since last pillage (max 100)% * Base Economy * 16"}),x.jsx("p",{children:"Also an additional pillage bonus is given"}),x.jsx("p",{children:"Additional Pillage bonus: (base actual income - new income)^2 * 5"}),x.jsx("p",{children:"No base can be pillaged more than once every 24 hours, however. Additional attacks launched during this time will result in the base being occupied, but will not give additional credits from pillaging."}),x.jsx("p",{children:"An occupied base has 30% less construction, production and research capacity. This makes any tasks performed at the base take longer."}),x.jsx("p",{children:"If ships are destroyed during an attack, 20% of the cost of the units destroyed will be given to each player as combat loot, and 40% will be converted into debris which will remain at the location of the attack. A player can collect those debris by sending recyclers to that astro, recyclers will work automatically, converting debris into credits every hour."}),x.jsx("p",{children:"The combat loot can be collected in the game credits page. Uncollected loot is automatically credited to the player's account after 24 hours."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Unrest"}),x.jsx("p",{children:"Bases that are occupied or have being occupied or pillaged in the last 24 hours, increases unrest by 10% each day."}),x.jsx("p",{children:"However, if a base has not been occupied or pillaged in the last 24 hours, its unrest level decreases by 10% each day, down to a minimum of 0%."}),x.jsx("p",{children:"When unrest reaches 100% the base owner will have an Revolt button that will free the base from occupation."}),x.jsx("p",{children:"It's important to note that the enemy fleet remains present at the base but cannot occupy it. However, they can still attack your fleet if you have any located at the base."}),x.jsx("p",{children:"While a base's unrest level is at 50% or higher, it canâ€™t get a new occupation (but the base and fleet can still be attacked, but a successful attack on the base will not result in pillaging). Additionally, if the base's unrest level is at 50% or higher and there are fleets present that do not belong to the base owner or their guild, the Jump Gates of the base are disabled."}),x.jsx("p",{children:"When a base's unrest level decreases from 50% to 40%, all of its defenses are fully restored. At this point, the base becomes open to occupation again, and its Jump Gates can be used."})]})},{id:"combat",title:"Combat",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold",children:"Combat basics"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"Attack = The amount of damage a unit deals."}),x.jsx("li",{children:"Armour = The amount of damage a unit can receive before being killed."}),x.jsx("li",{children:"Shielding = The shielding of a unit prevents damage equal to itself from each shot of enemy fire."})]}),x.jsx("p",{children:"(Note: 1% of the attack always cross the shields, except Ion Bombers and Ion Frigates of which 50% damage crosses any shielding)"}),x.jsx("h3",{className:"text-lg font-semibold",children:"Example"}),x.jsx("p",{children:"A Cruiser that deals 40 damage against a Titan with 30 shielding will only deal 10 damage to the Titan. If the Titan has 4000 armour then it will take 400 Cruisers to one shot kill it."}),x.jsx("p",{children:"(note: to simplify the 1% of cross-shield damage was not considered in this example)"}),x.jsx("p",{children:"For ships of Cruiser type and up any damage dealt to it that is not sufficient to kill it will leave a percentage of a ship behind. This will require 50% of the cost to build the ship to repair modified by the percentage of damage dealt to the ship (ie a Battleships at 0.6 will cost 400 credits to repair)."}),x.jsx("p",{children:"Bases defenses will auto repair at 1% per hour in non occupied bases."}),x.jsx("p",{children:"Max number of fighters that can target a unit in a combat round = 2 x unit size."})]})},{id:"experience",title:"Experience",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"After combat, players gain experience points based on the total destruction to both players multiplied by a % based on the difference of levels between players."}),x.jsx("p",{children:"If the enemy's level is above your level:"}),x.jsx("p",{children:"XP = (enemy/your level) /20 * Total Fleet destroyed"}),x.jsx("p",{children:"(max: 10% * Total fleet destroyed)"}),x.jsx("p",{children:"If your level is above the enemy's level:"}),x.jsx("p",{children:"XP = (enemy/your level)^2 /20 * Total Fleet destroyed"}),x.jsx("p",{children:"Combat with NPCs:"}),x.jsx("p",{children:"XP = 5% * Total Fleet destroyed"}),x.jsx("p",{children:"The total combat experience points a player has does not directly measure how well they fight, it only means that they have been involved in more or larger battles, and against stronger opponents."}),x.jsx("p",{children:"It works also as a small compensation for players that are fighting higher level players, and an incentive to players to fight players at their own level or even above."}),x.jsx("p",{children:"Experience points can be spent on commanders."})]})},{id:"newbies",title:"Newbies",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold",children:"Newbie Protection"}),x.jsx("p",{children:"In order to protect newbies (new players) the following rules are applied:"}),x.jsx("p",{children:"--------------------------------------------------------------------------------"}),x.jsx("p",{children:"Players under level 10 - Player bases canâ€™t be attacked."}),x.jsx("p",{children:"Players over level 10 - Bases can only be attacked by players within 150% of the defender's level."}),x.jsx("p",{children:"These protections are only valid to the player bases and not to his fleets outside of his bases or to unguarded trade routes."}),x.jsx("p",{children:"These protections are not valid in occupied bases if the attack is done by the occupier or someone from the same guild."}),x.jsx("p",{children:"If a protected player attacks others over the protection level outside his bases he/she loses his protection for 48 hours."}),x.jsx("p",{children:"--------------------------------------------------------------------------------"}),x.jsx("p",{children:"If a player attacks/occupies a player less than 65% of their level; then they only get x% of the pillage/trade route plunder/occupation income."}),x.jsx("p",{children:"x% = Defender level / Attacker level x 100%"}),x.jsx("p",{children:"--------------------------------------------------------------------------------"}),x.jsx("p",{children:"However, if you start surrounded by stronger players, it is recommended that you join a guild as soon as possible, to gain protection from stronger players."})]})},{id:"empire",title:"Empire",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"A player's empire is represented by all of that player's bases and fleet and all bases occupied by that player."}),x.jsx("p",{children:"The three main ways of measuring an empire's strength; the total economy of the empire, the total amount of fleet that the empire has, and the total technological development of the empire."}),x.jsx("p",{children:"The latter two are measured in credits spent in each category. Finally, another indicator of an empire's strength is the player's level. This is calculated with the following formula:"}),x.jsx("p",{children:"Player Level = (Economy x 100 + fleet + technology) ^ 0.25"}),x.jsx("p",{children:"(The ^ symbol denotes an exponent; ^.25 means to take the 4th root)"})]})},{id:"guild",title:"Guild",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"A guild is a group of players that work together under the same banner. It is run by the player who is designated as the guildmaster, and other players can play important roles in the guild (diplomacy, for example). Guilds can be democratic, anarchistic, totalitarian, and/or some many other types of government. Players can join for various reasons, most often due to friends wanting to work together and players wanting to find protection."}),x.jsx("p",{children:"A guild generally provides protection to its members (safety in numbers), and a member can usually count on assistance and support from other guildmembers."}),x.jsx("p",{children:"Guild members have access to a guild board where they can easily communicate with others guild members."}),x.jsx("p",{children:"Guilds can also have their own website and messageboard/web forum, which is recommended to improve guild communication."}),x.jsx("p",{children:"A player can create a new guild, or apply to join an existing guild. The guildmaster has the authority of accepting new members, kicking existing members (although any player can withdraw from a guild at any time for any reason), and even to appoint a new guild master from one of the other guild members. Guildmasters can also give individual members permissions to help out around the guild."}),x.jsx("p",{children:"Obviously, members of the same guild are unable to attack each other or otherwise interfere with another guild member's fleets or planets."}),x.jsx("p",{children:"An indicator of a guild strength is the guild's level. This is calculated with the following formula:"}),x.jsx("p",{children:"Guild Level = (Guild Economy x 100 + Guild Fleet + Avg. Guild Technology) ^ 0.25"}),x.jsx("p",{children:"(The ^ symbol denotes an exponent; ^.25 means to take the 4th root)"})]})},{id:"commanders",title:"Commanders",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Commanders can be recruited and trained to give specific bonuses. You can do so by using either experience points or credits."}),x.jsx("p",{children:"A base can only have one base commander assigned there, giving a bonus that is based on the commander's skill and level."}),x.jsx("p",{children:"When a base is pillaged or successfully attacked, there is a 10% chance that each commander located there will be killed. Commanders not in duty can also die."}),x.jsx("p",{children:"When a construction commander is assigned to a base, it cannot be removed if the base has a structure currently being constructed. The same goes for research commanders while researching and production commanders while building ships."}),x.jsx("p",{children:"Also, if a commander is assigned to a base you must wait at least 48 hours before removing their assigned task."}),x.jsx("p",{children:"You must have at least 1 command center to recruit a commander. The maximum number of commanders you can have is equal to the level of your Computer technology."}),x.jsx("p",{children:"When your commander is in the commander pool, it takes 10 minutes to get to any of your bases. You can move your commanders between bases, the travel duration being equivalent to a scout ship's travel time."})]})},{id:"upgrading",title:"Upgrading",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Upgrading will remove advertising and add extra game features, improving gameplay."}),x.jsx("p",{children:"Upgrade costs less than 0.06â‚¬ per day if you upgrading 12 months."}),x.jsx("p",{children:"At the game account/upgrade page you can compare the game upgraded account versus free accounts, and see the upgrades prices."}),x.jsx("p",{children:"We accept several payment methods, as PayPal, credit card, wire transfer, Western Union, and phone (DaoPay)."}),x.jsx("p",{children:"You can also upgrade others players accounts, by going to their game profiles."}),x.jsx("p",{children:"New game accounts start upgraded for the first 7 days of play."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Why should I upgrade my account?"}),x.jsx("p",{children:"This is needed to allow us to pay for servers, personnel and to support further development. This also ensures sustainability and the long term success of Attrition which benefits all players."})]})},{id:"vacation_mode",title:"Vacation Mode",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Player can select to be in vacation mode, if for some reason they will be away from the game during several days."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Vacation Mode Rules"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"Only upgraded players can set the vacation mode."}),x.jsx("li",{children:"Vacation mode cannot be removed for 72 hours except within the first hour it's set."}),x.jsx("li",{children:"After the vacation mode is removed you can only start attacks after 4 hours."}),x.jsx("li",{children:"After vacation mode is removed it can only be reactivated after 5 days."}),x.jsx("li",{children:"Vacation mode can only be used for 35 days in a civil year."})]}),x.jsx("h3",{className:"text-lg font-semibold",children:"While in vacation mode"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"Your bases cannot be attacked (only comes into effect 24 hours after vacation mode is set)."}),x.jsx("li",{children:"Your fleets outside your bases and on your occupied bases can still be attacked."}),x.jsx("li",{children:"Your occupied bases can still be attacked and pillaged during vacation mode."}),x.jsx("li",{children:"Your profile will display a vacation mode badge (only comes into effect 24 hours after vacation mode is set)."}),x.jsx("li",{children:"You get half of your economy income, even after 4 days of inactivity."}),x.jsx("li",{children:"You cannot move or do any other action with your fleets."}),x.jsx("li",{children:"Your recyclers don't collect debris."}),x.jsx("li",{children:"You cannot start or queue new constructions, productions, research or trade routes."}),x.jsx("li",{children:"Constructions and researches that are already in the queue stay there, but the time to complete them doubles."}),x.jsx("li",{children:"Your guild mates cannot use your bases jump gates."})]})]})},{id:"others",title:"Others",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold",children:"Messages"}),x.jsx("p",{children:"Attrition includes a private messaging system that allows a player to contact any other player in the game."}),x.jsx("p",{children:"Players are responsible for the contents of their communications. offensive, racist, pornographic material, and other such harmful comments are prohibited, and may result in the game administration deleting or otherwise preventing a user from communciating who violates this rule."}),x.jsx("p",{children:"If you wish to save any messages that have been sent to you, there is a savebox available."}),x.jsx("p",{children:"All players can place other players into their contacts list, which is a quick way of keeping track of them so they are easily located to send messages to."}),x.jsx("p",{children:"In addition, players can also block other players if they do not wish to receive messages from that player."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Notes"}),x.jsx("p",{children:"Each player has the ability to create and store individual notes, allowing easy access to important information for later review. You can edit and delete current notes."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Bookmarks"}),x.jsx("p",{children:"Each player has the ability to store individual location bookmarks."}),x.jsx("p",{children:"Those locations are shown when you go at the fleet movement page, so you can fast select those locations as fleet destinations."}),x.jsx("h3",{className:"text-lg font-semibold",children:"Recruiting"}),x.jsx("p",{children:"Help promoting Attrition."}),x.jsx("p",{children:"If you use your recruit link to bring new players to game, you will get extra credits as bonus."}),x.jsx("p",{children:"For each recruit upgraded you will receive a one turn bonus of 10% of your total economy (up to a max. of 100%). This bonus is given daily at server time 0h."}),x.jsx("p",{children:"There are game banners with your recruit link attached, in the account/banner page. All you need to do is copy the appropriate code into your HTML page."}),x.jsx("p",{children:"(Note: Players must join the same server as you using your recruit link to be your recruit. The trial upgrade does not count as upgraded)"}),x.jsx("h3",{className:"text-lg font-semibold",children:"Forum"}),x.jsx("p",{children:"The game forum is a place where players can talk about game-related subjects, such as politics, guild recruitment, game feedback, support, and assistance, and there are also alternative languages forums."}),x.jsx("p",{children:"Offensive or otherwise harmful comments are prohibited, and may result in a player being suspended or banned from the forums or game."})]})},{id:"starting_guide",title:"Starting Guide",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"If you have just started the game, there is a good chance that many other players are already playing, and that they are far stronger than you. You should not worry too much about these players now, as the game will protect your bases against stronger players in the first few days."}),x.jsx("p",{children:"So, your first concern should be to raise your base construction, in order to make structures build faster. We advise you to build a few Metal Refineries first, as these will not only improve your construction and production capacities, but will also increase your economy."}),x.jsx("p",{children:"After you get Metal Refineries up to about level 4, you will probably have noticed that they are getting more expensive and taking longer to build every time. So now you should build a Research Labs, and research Computer technology up to level 2, to unlock the Robotic Factories structures. These are similar to Metal Refineries, so you can build both alternately to compensate for the increase in the prices at each level."}),x.jsx("p",{children:"Next, while you continue to build structures, you should research Energy technology up to level 6, to unlock Fusion Plants. These are more expensive than Solar Plants and Gas Plants, but will allow you to generate more Energy each time (unless you're lucky to be on a planet with solar or gas energy 4)."}),x.jsx("p",{children:"At some point you should also start building some Shipyards, because they are cheap at the start and they will also help boost your economy (and you never know when you'll need them)."}),x.jsx("p",{children:"Now you probably have a few levels of Metal Refineries and Robotic Factories, and a relatively fast Construction, and your credits are running out, right? It's time to raise your Economy a little more. Build some Spaceports and set up a Trade Route with someone who has a good Economy (don't forget to ask for permission first, and if you are in a guild, try to make it with someone from your guild)."}),x.jsx("p",{children:"Crystal Mines are also great to raise your Economy, but only if you're lucky enough to have started on a planet with Crystals (in that case you should have been building them since earlier on in the guide)."}),x.jsx("p",{children:"Well, now you have a decent Construction, Production, and Economy, and everything is getting even more expensive. You need to prepare to set up new bases on other planets, wich means you'll have to create Outpost Ships."}),x.jsx("p",{children:"If you look at the game Tables you'll see that you need Warp Drive (1) to unlock the Outpost Ship, but that also means that you will first need to have Research Labs (8), Stellar Drive (4), and Energy (8). Finally, you will need Shipyards (8) in order to build your Outpost ship. It may seem a lot, but this should take less than one day, if you keep your Construction and Research queues full."}),x.jsx("p",{children:"When you're done, just choose an astro, move your Outpost Ship there, and when it arrives choose 'Build Base' from the Fleet Menu (note that you'll have to pay 100 credits to construct up your first new Base, and this value will increase with each new base)."}),x.jsx("p",{children:"Now you should evolve your second Base faster than the first one and your Economy will rise fast too. But be weary of other players trying to Conquer you. By now, you should have started to prepare your defenses too!"}),x.jsx("p",{children:"Is recommended that you join a guild early as possible, to get some protection from stronger players."}),x.jsx("p",{children:"Have a good game! :-)"})]}),group:"footer"},{id:"occupied_guide",title:"Occupied Guide",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("p",{children:"Simple strategy guide to follow, when your bases are occupied."}),x.jsx("p",{children:"There are several ways and tactics to get rid of occupations. Here are some tips and hints to achieve that goal:"}),x.jsxs("ol",{className:"list-decimal pl-6 space-y-1",children:[x.jsx("li",{children:"Build a lot of command centers. The more the better."}),x.jsx("li",{children:"Match the unit you build to attack an occupier. If they have a lot of unshielded craft, use fighters. If they have mostly cruisers or heavy cruisers, use bombers or heavy bombers. With battleships, use heavy bombers. If they have really big units, use ion bombers."}),x.jsx("li",{children:"Don't get into a pattern of always attacking at a certain time."}),x.jsx("li",{children:"If there's a lot of debris, use recyclers to collect the debris. However, don't leave the recyclers there."}),x.jsx("li",{children:"Bases that are occupied increases unrest by 10% each day. When unrest reaches 100% you can Revolt and free the base from occupation. While a base is with unrest at 50% or more it canâ€™t get a new occupation. When a base unrest decreases from 50% to 40% the base gets all the defenses restored. So is good to build defenses to make harder your base get occupied again."})]}),x.jsx("p",{children:"If you do a good job, the occupier will start losing more credits than he earns from your bases, increasing significantly your chances that he/she will withdraw and leave you alone."}),x.jsx("p",{children:"Still, your best option will always be to join a good guild and get help from other players to liberate your bases."}),x.jsx("p",{children:"Diplomacy is also very important against a much stronger opponent. Try talking him out of your bases."}),x.jsx("p",{children:"If all this fails, your final and more desperate solution may be to disband your bases and relocate to a safer area. For each base you disband you get a portion of the base's structures value in discount when establishing new bases to replace the ones you disbanded."})]}),group:"footer"},{id:"dictionary",title:"ATT Dictionary",content:x.jsxs("div",{className:"space-y-4",children:[x.jsx("h3",{className:"text-lg font-semibold",children:"General"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"ATT = Attrition"}),x.jsx("li",{children:"Acc = Account"}),x.jsx("li",{children:"Newbie = New player"}),x.jsx("li",{children:"Mod = Moderator"}),x.jsx("li",{children:"Indy = Independent player not associated with a guild"}),x.jsx("li",{children:"Exp = Combat Experience"}),x.jsx("li",{children:"Farm (verb) = Occupying a base for an extended period"}),x.jsx("li",{children:"AI = Artificial Intelligence"}),x.jsx("li",{children:"Tech = Technology"}),x.jsx("li",{children:"Loc = Location"}),x.jsx("li",{children:"TR = Trade Routes"}),x.jsx("li",{children:"JG = Gate = Jump Gate"}),x.jsx("li",{children:"CC = Command Centers"}),x.jsx("li",{children:"UC = United Colonies (a NPC account)"}),x.jsx("li",{children:"P-rings = Rings = Planetary Ring"}),x.jsx("li",{children:"P-shield = Planetary Shield"})]}),x.jsx("h3",{className:"text-lg font-semibold",children:"Diplomacy"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"NAP = Non Aggression Pact"}),x.jsx("li",{children:"MDP = Mutual Defense Pact"}),x.jsx("li",{children:"Bloodpact = very strong alliance"}),x.jsx("li",{children:"KOS = Kill On Sight"}),x.jsx("li",{children:"CF = Cease Fire"}),x.jsx("li",{children:"ToA = Treaty of Armistice"})]}),x.jsx("h3",{className:"text-lg font-semibold",children:"Ship Terms"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"FT = Fighter"}),x.jsx("li",{children:"BO = Bombers"}),x.jsx("li",{children:"HB = Heavy Bombers"}),x.jsx("li",{children:"IB = Ion Bomber"}),x.jsx("li",{children:"CV = Vette = Corvette"}),x.jsx("li",{children:"RC = Cyclers = Recyclers"}),x.jsx("li",{children:"DE = Destroyers"}),x.jsx("li",{children:"FR = Frigate"}),x.jsx("li",{children:"IF = Ion Frigate"}),x.jsx("li",{children:"SS = Scout = Scout Ship"}),x.jsx("li",{children:"OS = Outpost Ship"}),x.jsx("li",{children:"CR = Cruiser"}),x.jsx("li",{children:"CA = Carrier"}),x.jsx("li",{children:"HC = Heavy Cruiser"}),x.jsx("li",{children:"BS = Battleship"}),x.jsx("li",{children:"FC = Fleet Carrier"}),x.jsx("li",{children:"DN = Dread = Dreadnought"}),x.jsx("li",{children:"TI = Titan"}),x.jsx("li",{children:"LV = Levi = Leviathan"}),x.jsx("li",{children:"DS = Death Star"})]}),x.jsx("h3",{className:"text-lg font-semibold",children:"Combat"}),x.jsxs("ul",{className:"list-disc pl-6 space-y-1",children:[x.jsx("li",{children:"Waves = breaking an assault into multiple attacks"}),x.jsx("li",{children:"Meat Shields = many small units to keep your large units safer"}),x.jsx("li",{children:"Ratio = Kill Ratio, eg: losses: 1000 / 6000 = 6:1 kill ratio for attacker"})]})]}),group:"footer"}],Il=[{id:"astro_empires",title:"Astro Empires",items:[{q:"What is Astro Empires?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Astro Empires is a persistent space strategy game where you build bases, manage resources, research technologies, trade, command fleets, and coordinate with a guild to expand your empire."})})},{q:"How do I progress efficiently?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Focus on establishing stable economic bases, researching key technologies, and using trade routes to sustain growth. Coordinate fleet movements to protect assets and seize opportunities."})})}]},{id:"upgraded_account",title:"Upgraded Account",items:[{q:"I have just created a game account, but I noticed that it will expire in few days. What does that mean?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Every new game account starts off with an account upgrade lasting 7 days. After those seven days, the account turns into a free account unless the owner of the account (or anyone else) upgraded it beforehand."})})},{q:"After my upgrade expires what happens?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"After your account upgrade expires your account becomes a free account, free accounts shows advertising and are limited in some features, compare here."})})},{q:"Do I lose my bases above 9, or my advanced structures above level 5 if my account upgrade expires?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No, you get to keep what you already have, but you cannot build any more bases or advanced structures than their current number/level."})})},{q:"How does Upgrading an account work?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Upgrading will improve your gameplay, removing site advertising and add extra features to your account. See the upgrade page for more information."}),x.jsx("p",{children:"This is needed in order to ensure the long term success and sustainability of the Astro Empires game, to the benefit of all players."}),x.jsx("p",{children:"This allows us to have fast and reliable servers, remove most game limits, and help us to improve this game."})]})},{q:"Which payment processors you are using?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"We accept payments via debit/credit card and PayPal."}),x.jsx("p",{children:"It is also possible to pay via Wire Transfer or Western Union."})]})},{q:"What are the upgrade prices in US Dollars or other currencies?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"To convert Euros into other currencies, please check on the internet, for example on this website: https://www.xe.com."})})},{q:"Can I pay with U.S. Dollars instead of Euros?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"When you pay via debit/credit card or Paypal the payments are converted automatically from your currency to Euros."})})},{q:"I am having problem upgrading via Paypal, what can I do?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Try to contact Paypal directly if you are having problem with your credit card."}),x.jsx("p",{children:"If you are still unable to upgrade, you can pay by alternative ways such as debit/credit card, wire transfer or Western Union (available at most post offices)."})]})},{q:"How long takes to I get my account upgraded after the payment?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"If you pay using your credit card or PayPal account, the account upgrade takes place immediately after payment."}),x.jsx("p",{children:"If you pay via wire transfer the account upgrade takes about 1 or 2 business days."}),x.jsx("p",{children:"If you pay via Western Union the account upgrade takes about 1 or 2 business days."})]})},{q:"My account upgrade expiration date is not correct.",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"This is most probably because you understand a different date format, for example 05-10-2007, mean day 5 of October 2007, as this is the date format (day-month-year) used in most European Countries including Portugal where the game is established. In the US and other far-western countries, the date goes month-day-year."})})},{q:"Are credit card payments charged recurringly?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"The payments are one-time; they do not recur."})})},{q:"Can I split upgrade time between game accounts?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No, it is not possible."})})},{q:"How do I upgrade a friendâ€™s game account?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Just go to that player profile page and click on Â«Upgrade this accountÂ» and follow the prompts to complete the upgrade process."})})},{q:"Can I pay real money for in game credits?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. ATT does not run such a system."})})}]},{id:"game_account",title:"Game Account",items:[{q:"How can I change my account password or email?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Go to your game account page and click on Â«ProfileÂ», then at your profile page click on Â«Edit ProfileÂ»."})})},{q:"Can I share the one account with my brother and or friend?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. Account sharing is explicitly forbidden in AE for it is seen as unfair."})})},{q:"How can I delete my game account?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Go to your account page, and click on Â«Delete AccountÂ»."})})},{q:"Can I transfer upgrade time from one game account to other game account?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No, is not possible (the only exception is when you delete your account to restart on a new one, see below)."})})},{q:"I want to restart, how can I do that?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"To restart your game account, go to your game account page, and there is a Restart Account option."}),x.jsx("p",{children:"If your account is above a certain level, it may not be possible to restart it directly. In this case, you will need to delete your game account and start a new one in the same server. If you have upgraded your account, you can contact the game's support with both account numbers (the deleted account and the new one) and request to transfer any remaining upgrade time between accounts."}),x.jsxs("p",{children:[x.jsx("strong",{children:"Important:"})," Transfer upgrade time between accounts is only possible if you restart in the same server."]})]})},{q:"Can I start over with my current technology/credits?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. Is not possible to restart with your current credits or technology, you can only restart with a complete new account."})})}]},{id:"recruiting_players",title:"Recruiting Players",items:[{q:"If I advertise this game to others, will I receive something?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"If you give someone your recruit link (found in Account/Recruits) and they sign up for the game, they become your recruit."}),x.jsx("p",{children:"For each upgraded recruit you will receive a one-turn bonus of 10% of your total economy (up to a maximum of 100%). This bonus is awarded daily at 00:00 server time."}),x.jsx("p",{children:"Note: The 7-day trial upgrade does not count toward this bonus. The recruit must also join the same game server as your recruit-link account for you to receive the bonus."})]})},{q:"I have recruited a friend to game, but he/she is not displayed as my recruit.",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"A player must join the game by using your recruit link, and in the same server, for them to become your recruit."})})},{q:"Can I request to an Attrition staff to change a player to be my recruit as I told him about the game?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. They must join using your recruit link, otherwise they will not be your recruit."})})}]},{id:"guilds",title:"Guilds",items:[{q:"What is a Guild?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"A Guild is a group of players within the same organization, run by players themselves. It could be democratic, anarchistic, totalitarian, etc. Any player can join a guild for whatever reasons, and more simply a guild can just be a group of friends."}),x.jsx("p",{children:"Each guild is supposed to provide mutual protection for all guild members, and a place where they can draw support and assistance from the other players (guildees, as they are often referred to)."})]})},{q:"How do I join a guild?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"To join a guild, go to that guildâ€™s profile and click Â«Request to join this guildÂ»."}),x.jsx("p",{children:"Your request must be accepted by a member of that guild with permission to accept new members."})]})},{q:"Do I have to be a certain level to join a guild?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"There is no level requirement to apply to a guild. However, some guilds may set their own minimum thresholds."}),x.jsx("p",{children:"You cannot apply to join a guild if you are already in one."})]})},{q:"Is there any limit of number of members in a guild?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Guilds are limited to 50 members."})})},{q:"What does the inactivity column mean at the guild page?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"It shows how long it has been since each player last accessed that server."}),x.jsx("p",{children:"Example: an inactivity of â€œ30 minâ€ means they last accessed the game 30 minutes ago."})]})},{q:"When defending a guild members base, will his defenses and/or command centers assist you in defending?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Base defenses assist only the base owner, not other members of their guild. The same applies to command centers."})})},{q:"How is a guild level calculated?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Guild Level"})," = (Guild Economy Ã— 100 + Guild Fleet + Avg. Guild Technology) ^ 0.25"]}),x.jsx("p",{children:"(The ^ symbol denotes an exponent; ^0.25 means to take the fourth root.)"})]})}]},{id:"bases",title:"Bases",items:[{q:"How do I get more energy at my base?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"To increase the amount of energy your base has, build energy facilities (usually known as power plants) such as solar plants, gas plants and fusion plants. These all increase the base energy. You can also build antimatter plants, which provide a large amount of energy compared to the other energy facilities."})})},{q:"Why cannot I build anything?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"If you cannot build anything, then you are either out of population, energy or land. To increase population build more Urban Centers and Orbital Bases; for energy build different plants and for land build Terraforms and Multi-Level Platforms."})})},{q:"I do not see the structure Crystal Mines on my building screen. Why is that so?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Your planet does not have any crystals on it (only Crystallines, Asteroids, Craters, and Metallics do)."})})},{q:"If I make a Biosphere Modification, does it affect the Urban Structure I already have?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"It gives you the bonus for every Urban Structure you already have."})})},{q:"How can I decrease a level of my building?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"To decrease your buildings you need to click on the name of the building on your construction screen. You will then be given a list of the costs to build each level and an option to disband one level, you will get 50% of the cost back as a discount in the price of your next base."})})},{q:"I disbanded a base but did not receive any credits.",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"You do not receive credits for disbanding bases; instead, the credits go into a discount which is taken away from the cost of your next base. You can view this discount in your game Account page."})})},{q:"I downgraded a structure/defense base but did not receive any credits.",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Works just like the above (I disbanded a base did not receive any credits)."})})},{q:"Can I disband my home planet?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Yes, it is no different than disbanding any other base, however you must have always at least one base."})})},{q:"Why don't my construction or other events update? They keep showing the -",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"When the server is too busy, the game events (construction, production, research, fleets arrive, etc..) can take some time to update."}),x.jsx("p",{children:"This also occurs after a server downtime, but all will be back to normal in seconds or minutes."})]})},{q:"Why do my game events (constructions etc..) keep restarting their times?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Probably you are seeing an old page saved in your browser cache, which is not updated, try to select on your browser options to always load the web pages instead of display pages saved in your browser cache."})})},{q:"Why I cannot see my bases or fleets on the galaxy map?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Check if you are seeing the galaxy where you have your bases/fleets, if not change the galaxy you want to see."}),x.jsx("p",{children:"If this is not the problem, check your browser options to see if the JavaScript is active."})]})},{q:"Do I get the same credits disbanding the base at once, or I should downgrade the buildings before disbanding?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"You will get the same amount of credits (in discount on the next base construction) in both ways, so the first is recommended for convenience."})})}]},{id:"colonization",title:"Colonization",items:[{q:"How much do bases cost?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Every base you build will cost more than the previous base."}),x.jsxs("p",{children:[x.jsx("strong",{children:"New bases cost:"})," 100, 200, 500, 1k, 2k, 5k, 10k, 20k, 50k, 100k, 200k, 400k, 650k, 1M, 1.5M, 2.5M, 4M, 6.5M, 10M, 15M, 25M, 40M, 65M, 100M, 150M, 250M, 400M, 650M, ..."]}),x.jsxs("p",{children:["However, if you delete one of your bases the next one will cost ",x.jsx("strong",{children:"25%"})," of the cost it would have."]})]})},{q:"What decides a good planet to colonize from a bad planet?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"This depends on what you want the astro to do: fleet production, boosting your economy, research, etc."}),x.jsxs("p",{children:["For ",x.jsx("strong",{children:"economy"}),", aim for either an ",x.jsx("strong",{children:"Asteroid"})," or a"," ",x.jsx("strong",{children:"Crystalline"})," (though Crystallines are rarer)."]}),x.jsxs("p",{children:["For ",x.jsx("strong",{children:"production"}),", ",x.jsx("strong",{children:"Rockies"})," are the best, with"," ",x.jsx("strong",{children:"Metallics"})," and ",x.jsx("strong",{children:"Craters"})," also filling this role well."]}),x.jsxs("p",{children:["For ",x.jsx("strong",{children:"research"}),", ",x.jsx("strong",{children:"Gaia"}),", ",x.jsx("strong",{children:"Earthly"}),", or"," ",x.jsx("strong",{children:"Arid"})," are usually preferred due to large area and high fertility, though they suit most tasks well."]})]})},{q:"How can I build another base on an empty planet?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:["Build an ",x.jsx("strong",{children:"Outpost Ship"}),"."]}),x.jsx("p",{children:"Move the Outpost Ship to the desired location (escorting it with other ships is recommended)."}),x.jsx("p",{children:"Go into the fleet with the Outpost Ship and click Â«Build baseÂ»."})]})},{q:"Do I lose my Outpost Ship when I build a new base?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Yes. An Outpost Ship is only usable to build one base."})})}]},{id:"trade",title:"Trade",items:[{q:"How do I get more trade routes?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:["You get more trade routes by building ",x.jsx("strong",{children:"Spaceports"}),". Spaceports increase the available number of trades for a base by one at levels ",x.jsx("strong",{children:"1, 5, 10, 15, 20"})," and so on."]}),x.jsxs("p",{children:["Each Spaceport also increases your base economy by ",x.jsx("strong",{children:"2 credits/hour"}),"."]})]})},{q:"How is a trade income calculated?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Trade Income"})," = Sqrt(Lowest base's income) Ã— [ 1 + Sqrt(2 Ã— Distance)/75 + Sqrt(Players)/10 ]"]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Players"})," = number of different players you trade with."]})]})},{q:"Can I trade with myself?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Yes. There is no real disadvantage other than you only count as one trading partner."}),x.jsx("p",{children:"When you trade with yourself you get twice the value for the trade route, but it occupies two slots (one on each base)."})]})},{q:"How do I boost the income from trade routes?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"These are the main ways to increase trade income:"}),x.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[x.jsx("li",{children:"Increase the economy of the bases involved in the trade route."}),x.jsx("li",{children:"Increase the distance between the bases."}),x.jsx("li",{children:"Increase the total number of different players you trade with."})]})]})},{q:"How can I plunder trade routes?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:["Access your fleet and click on the ",x.jsx("strong",{children:"Piracy"})," option. Your fleet must be stationed at the targeted base, and there must be no opposing fleets present â€” including the base owner, their guild members, or fleets belonging to the owner of the trade routeâ€™s destination base."]}),x.jsx("p",{children:"Base defenses alone will not prevent plundering of trade routes."})]})}]},{id:"fleets",title:"Fleets",items:[{q:"How do I build fleets?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:["To build fleets (ships) at a base, there must be at least one level of ",x.jsx("strong",{children:"Shipyards"}),", and you must have researched at least one level of the ",x.jsx("strong",{children:"Laser"})," technology. This allows you to build Fighters, the cheapest ship."]}),x.jsx("p",{children:"More expensive and stronger ships require higher Shipyard levels and additional technologies to be produced."})]})},{q:"I have the tech researched for a ship but cannot build it! Why not?",a:x.jsx("div",{className:"space-y-2",children:x.jsxs("p",{children:["You likely do not meet the ",x.jsx("strong",{children:"Shipyard level requirements"})," for that ship at the current base. Ensure the baseâ€™s Shipyards are at or above the required level."]})})},{q:"What does fleet size mean?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"The Â«fleet sizeÂ» is the total cost in credits of every ship in the fleet added together."}),x.jsx("p",{children:"Example: 500 Fighters (cost 5 credits each) have a fleet size of 2,500."})]})},{q:"How do I move my fleets?",a:x.jsx("div",{className:"space-y-2",children:x.jsxs("p",{children:["Once you have ships capable of moving on their own (",x.jsx("strong",{children:"Corvettes"})," are the first), go to ",x.jsx("strong",{children:"Fleets"}),", click the fleet, enter valid coordinates, choose amounts to move, then click Â«MoveÂ»."]})})},{q:"How do I move fighters from base to base?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Hangar-requiring ships (Fighters, Bombers, Heavy Bombers, Ion Bombers) must move along with ships that have hangar capacity (e.g., Carriers). There is a limit to how many hangar units can be carried."}),x.jsx("p",{children:"Example: A Carrier with hangar 60 can carry up to 60 Fighters/Bombers, or 30 Heavy Bombers/Ion Bombers."}),x.jsx("p",{children:"To move them, specify how many to move with the carrier. You can also click the Â«HangarÂ» link to move the maximum number possible."})]})},{q:"How do I use jump gates?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"To use one of your (or your guildmateâ€™s) jump gates, place the fleet at the astro with the jump gate and send the fleet somewhere â€” the game will automatically use the gate when applicable."})})},{q:"Can I redirect my fleets in transit?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. Once a fleet is in transit, you can either let it continue to its destination or recall it to its origin."})})},{q:"If one of my bases is occupied, can I build fleet there and can I move that fleet?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Yes. You can build and move fleet from an occupied base. This allows you to fight back and potentially free the base."}),x.jsxs("p",{children:["Note: While occupied, the baseâ€™s economy is cut by ",x.jsx("strong",{children:"1/3"}),", and construction, production, and research capacities are reduced by ",x.jsx("strong",{children:"30%"}),"."]})]})}]},{id:"commanders",title:"Commanders",items:[{q:"How are names determined for Commanders when you recruit them?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"All names are randomly generated, but you can rename your Commanders."})})},{q:"I have a commander at a base but it has no effect, why is this?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"You must assign commanders to be Base Commander of a base in order for their effect to take place."})})},{q:"What exactly does dismissing commanders do?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"It is similar to demolishing structures or decommissioning fleet; you do not gain any of your credits or XP back."})})},{q:"Do commanders use jump gates?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"When moving a commander to another base, they will use a jump gate if there is one available."}),x.jsx("p",{children:"Note that you must de-assign a commander before moving them."})]})}]},{id:"attacks_on_bases",title:"Attacks on Bases",items:[{q:"What happens to my base if someone attacks it?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:["If your base is attacked, the ",x.jsx("strong",{children:"structures"})," will suffer no damage."]}),x.jsxs("p",{children:["Your base ",x.jsx("strong",{children:"defences"})," and any ",x.jsx("strong",{children:"fleet"})," you have at that base will attempt to protect your base. Fleets can be destroyed; defences cannot be destroyed but can be damaged."]}),x.jsxs("p",{children:["If the attack is successful and they occupy your base, they receive ",x.jsx("strong",{children:"30%"})," of your base income each hour. You still have full control over the base."]})]})},{q:"How is pillage calculated?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"At a playerâ€™s base:"})," (number of hours since last pillage; max 100)% Ã— (Base Economy / Total Bases Economy) Ã— Base Owner Credits"]}),x.jsxs("p",{children:[x.jsx("strong",{children:"At an NPC base:"})," (number of hours since last pillage; max 100)% Ã— Base Economy Ã— 16"]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Additional Pillage bonus:"})," (base actual income âˆ’ new income)",x.jsx("sup",{children:"2"})," Ã— 5"]})]})},{q:"How is experience calculated?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"If the enemy level is above your level:"}),x.jsx("br",{}),"XP = (enemy / your level) / 20 Ã— Total Fleet destroyed",x.jsx("br",{}),"(max: 10% Ã— Total Fleet destroyed)"]}),x.jsxs("p",{children:[x.jsx("strong",{children:"If your level is above the enemy level:"}),x.jsx("br",{}),"XP = (enemy / your level)",x.jsx("sup",{children:"2"})," / 20 Ã— Total Fleet destroyed"]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Combat with NPCs:"}),x.jsx("br",{}),"XP = 5% Ã— Total Fleet destroyed"]})]})},{q:"After occupation ends, how does a base get back the economy it lost?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"It recovers 1 economy per 8 hours until it reaches the normal economy."})})},{q:"How can I repair my defenses?",a:x.jsx("div",{className:"space-y-2",children:x.jsxs("p",{children:["They repair themselves automatically by ",x.jsx("strong",{children:"1% per hour"}),", but they do not repair while the base is occupied."]})})}]},{id:"recyclers",title:"Recyclers",items:[{q:"How to use Recyclers?",a:x.jsx("div",{className:"space-y-2",children:x.jsxs("p",{children:["Deploy your Recyclers to an astro with ",x.jsx("strong",{children:"debris"})," present. Each Recycler will automatically collect ",x.jsx("strong",{children:"10 credits"})," from the debris field at ",x.jsx("strong",{children:"xx:30"})," every hour."]})})},{q:"How much debris is left after a unit has been destroyed?",a:x.jsx("div",{className:"space-y-2",children:x.jsxs("p",{children:["If ships are destroyed during an attack, ",x.jsx("strong",{children:"40%"})," of the cost of the units destroyed is converted into debris, which remains at the location of the attack."]})})}]},{id:"players",title:"Players",items:[{q:"How is a player level calculated?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Player Level"})," = (Economy Ã— 100 + Fleet + Technology) ^ 0.25"]}),x.jsx("p",{children:"(The ^ symbol denotes an exponent; ^0.25 means to take the 4th root.)"})]})}]},{id:"server_npcs",title:"Server NPCs",items:[{q:"What is U.C. base stability?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:["United Colonies bases lose ",x.jsx("strong",{children:"3%"})," stability every day at ",x.jsx("strong",{children:"00:00"})," server time."]}),x.jsx("p",{children:"Once base stability reaches 0%, the base disbands (this can take a few minutes)."})]})}]},{id:"inactivity",title:"Inactivity",items:[{q:"What will happen to my bases and fleets if I do not login regularly?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{children:["If a player does not log in for ",x.jsx("strong",{children:"4 days"}),", that player stops receiving income from bases until they log in again."]}),x.jsxs("p",{children:["When a ",x.jsx("strong",{children:"free"})," player profile is marked as inactive, their bases' stability begins at 100% and degrades by ",x.jsx("strong",{children:"3% daily"}),". Once stability reaches zero, the account will be deleted soon after. If the player logs in during this period, the bases' stability is restored to 100%."]}),x.jsx("p",{children:"Deleting an account includes deletion of all things related to the account, including player bases, fleets, credits, etc."})]})},{q:"How long does a player need to be inactive before this shows up in his profile?",a:x.jsx("div",{className:"space-y-2",children:x.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Accounts under 80 days old:"})," Inactivity appears when it exceeds half the account's age (minimum of 10 days of inactivity)."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Accounts 80 days or older:"})," Inactivity appears after 40 days of inactivity."]})]})})}]},{id:"others",title:"Others",items:[{q:"Can a friend account sit for me?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. With the advent of Vacation Mode, Account Sitting is no longer allowed in the game."})})},{q:"How do I report a game exploit?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"Please contact us directly regarding that â€” see the contact page for how to reach us."}),x.jsx("p",{children:"Important: Never share a game exploit with anyone. Always send us all related information about it directly."})]})},{q:"Where can I make suggestions to improve the game?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"You can post ideas and suggestions in the game forum under the Feature Requests section. Feel free to discuss them with other players. Note that while staff regularly read these topics, they may not always have time to reply."})})},{q:"How do I report a player cheating?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Please contact us directly with all the information you have â€” see the contact page for details."})})},{q:"What is Server Time?",a:x.jsx("div",{className:"space-y-2",children:x.jsxs("p",{children:["Server time is set to ",x.jsx("strong",{children:"GMT+1"}),". Battles, payments, and all times in the game are recorded in server time. There is also a clock at the top centre of the screen that shows server time."]})})},{q:"What does the '-' at the time counter mean?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"It means the client-side timer reached zero. Refresh the page to load updated data. If after refresh the counter is still '-', the server has not yet processed the event (can happen when the server is busy)."})})},{q:"When do new galaxies / servers get added?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"New galaxies are added occasionally in batches of 10 when the universe gets too crowded. New servers are added about every six months."})})},{q:"I have the same value in one category of the ranks as another player, how are ranks sorted in this case?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"When more than one player or guild has the same value in the ranks, the ordering favors the player/guild with the lower account number (appears on top)."})})}]},{id:"shared_ips",title:"Shared IPs",items:[{q:"Why did I get a warning claiming that I was using a shared IP?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"It means one or more Astro Empires accounts are connecting to the internet with the same public IP address as you."})})},{q:"Does this mean AE thinks I am cheating?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. It does not mean you are cheating or have a second account â€” only that your IP is shared with other Astro Empires account(s)."})})},{q:"Why does Astro Empires have rules about shared IPs?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"We prohibit shared IP usage for free accounts and limit some interactions to help prevent cheating and second accounts. This helps keep the game fair for all players."})})},{q:"Why am I being accused of using a shared IP? I do not think I am using one.",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"If you are unsure, possible reasons include:"}),x.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[x.jsx("li",{children:"Someone else at your home also plays."}),x.jsx("li",{children:"You log in from a public or shared network (school, work, library, cybercafe, hotel, airport, LAN party, etc.), and someone there plays as well."}),x.jsx("li",{children:"You are using a public proxy server."}),x.jsx("li",{children:"You logged in at a friendâ€™s house or allowed a friend to log in from yours. Even once can appear in our system â€” do not do it again and it will not be a problem."}),x.jsx("li",{children:"Your ISP uses shared IPs for some clients."}),x.jsx("li",{children:"You are accessing from a mobile connection."})]})]})},{q:"What can I do if I am caught using a shared IP?",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"You must either use a unique IP address or follow the shared IP rules:"}),x.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[x.jsx("li",{children:"Your account must be upgraded (the first 7 days trial period does not count)."}),x.jsx("li",{children:"You are forbidden to attack, occupy bases, or take debris from players with the same IP."}),x.jsx("li",{children:"You are forbidden to make joint attacks on bases with accounts with the same IP (e.g., one or more accounts attacking and another occupying the base or collecting the debris)."}),x.jsx("li",{children:"You are forbidden to transfer occupied bases to other players with the same IP."})]}),x.jsx("p",{children:"If you are playing with a friend on the same network and cannot comply with the rules above, one of you must delete your account so the other can continue."}),x.jsx("p",{children:"If you only received an initial warning, simply stop using shared IPs â€” your account will not be deleted."})]})},{q:"My account was suspended while I was absent from the game, what can I do now?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"If your account is upgraded, contact us with your account number. If your account is free, you will be required to upgrade to reactivate it. Do not delay or your account might be deleted."})})},{q:"What if I do not want or cannot afford to upgrade my account? Can I still use a shared IP?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Rules apply equally to all players; we cannot make exceptions. If you do not want or cannot upgrade, you cannot use shared IPs."})})},{q:"Is there any way to use the same IP for two accounts without having to upgrade my account?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Yes. You may play one account on one game server and the other on a different server. Shared IPs are not allowed within the same server, but you can use the same IP across different servers (one account per server)."})})},{q:"I already upgraded my account, why were others using the same IP suspended?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"Other players using the same IP must also upgrade their own accounts or they will be suspended."})})},{q:"How does this IP address thing work? I do not think anyone is using my IP.",a:x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{children:"In private local networks (e.g., school or office), multiple devices share the same public IP, so different computers can appear as the same address."}),x.jsxs("p",{children:["Many ISPs use ",x.jsx("strong",{children:"dynamic IPs"}),", meaning your IP can change over time and may have been used recently by someone else."]}),x.jsxs("p",{children:["Some ISPs use ",x.jsx("strong",{children:"carrier-grade NAT"})," where several customers share one IP simultaneously (common with mobile and satellite connections)."]})]})},{q:"If I stop using a shared IP do I still need to upgrade my account?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. If you stop using a shared IP after the first warnings, you do not need to upgrade. If your account is already suspended, you will need to upgrade to reactivate it."})})},{q:"Can I know which accounts are sharing the same IP as me?",a:x.jsx("div",{className:"space-y-2",children:x.jsx("p",{children:"No. Due to privacy laws we cannot share that information. The other person(s) may not want you to know they are also playing from the same location."})})}]}],Ml=()=>{const[t,s]=e.useState("help"),[a,r]=e.useState("introduction"),[n,i]=e.useState("astro_empires"),o=e.useMemo(()=>({mainTopics:Ol.filter(e=>"main"===(e.group??"main")),footerTopics:Ol.filter(e=>"footer"===e.group),current:Ol.find(e=>e.id===a)??Ol[0]}),[a]),l=e.useMemo(()=>({mainTopics:Il.filter(e=>"main"===(e.group??"main")),footerTopics:Il.filter(e=>"footer"===e.group),current:Il.find(e=>e.id===n)??Il[0]}),[n]),c=({value:e,label:a})=>x.jsx("button",{onClick:()=>s(e),className:"px-4 py-2 rounded-md text-sm font-semibold border border-gray-700 "+(t===e?"bg-gray-700 text-empire-gold":"text-gray-300 hover:text-white hover:bg-gray-700"),children:a});return x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex gap-2",children:[x.jsx(c,{value:"help",label:"Help"}),x.jsx(c,{value:"faq",label:"FAQ"}),x.jsx(c,{value:"ai",label:"AI Helper"}),x.jsx(c,{value:"settings",label:"Settings"})]}),"help"===t&&x.jsxs("div",{className:"flex gap-6",children:[x.jsxs("aside",{className:"w-64 bg-gray-800 border border-gray-700 rounded-lg p-3 max-h-[72vh] overflow-auto",children:[x.jsx("h2",{className:"text-center text-empire-gold font-semibold mb-2",children:"Help"}),x.jsx("nav",{className:"space-y-1",children:o.mainTopics.map(e=>{const t=e.id===a;return x.jsx("button",{onClick:()=>r(e.id),className:"w-full text-left px-3 py-2 rounded text-sm font-semibold "+(t?"bg-gray-700 text-empire-gold":"text-gray-300 hover:text-white hover:bg-gray-700"),children:e.title},e.id)})}),o.footerTopics.length>0&&x.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-1",children:o.footerTopics.map(e=>{const t=e.id===a;return x.jsx("button",{onClick:()=>r(e.id),className:"w-full text-left px-3 py-2 rounded text-sm font-semibold "+(t?"bg-gray-700 text-empire-gold":"text-gray-300 hover:text-white hover:bg-gray-700"),children:e.title},e.id)})})]}),x.jsxs("section",{className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg p-6 min-h-[60vh]",children:[x.jsx("h1",{className:"text-2xl font-bold mb-4",children:o.current.title}),x.jsx("div",{className:"prose prose-invert max-w-none",children:o.current.content})]})]}),"faq"===t&&x.jsxs("div",{className:"flex gap-6",children:[x.jsxs("aside",{className:"w-64 bg-gray-800 border border-gray-700 rounded-lg p-3 max-h-[72vh] overflow-auto",children:[x.jsx("h2",{className:"text-center text-empire-gold font-semibold mb-2",children:"FAQ"}),x.jsx("nav",{className:"space-y-1",children:l.mainTopics.map(e=>{const t=e.id===n;return x.jsx("button",{onClick:()=>i(e.id),className:"w-full text-left px-3 py-2 rounded text-sm font-semibold "+(t?"bg-gray-700 text-empire-gold":"text-gray-300 hover:text-white hover:bg-gray-700"),children:e.title},e.id)})}),l.footerTopics.length>0&&x.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-1",children:l.footerTopics.map(e=>{const t=e.id===n;return x.jsx("button",{onClick:()=>i(e.id),className:"w-full text-left px-3 py-2 rounded text-sm font-semibold "+(t?"bg-gray-700 text-empire-gold":"text-gray-300 hover:text-white hover:bg-gray-700"),children:e.title},e.id)})})]}),x.jsxs("section",{className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg p-6 min-h-[60vh]",children:[x.jsx("h1",{className:"text-2xl font-bold mb-4",children:l.current.title}),x.jsx("div",{className:"prose prose-invert max-w-none",children:0===l.current.items.length?x.jsx("p",{className:"text-gray-400",children:"Content coming soon."}):x.jsx("div",{className:"space-y-6",children:l.current.items.map((e,t)=>x.jsxs("div",{className:"space-y-2",children:[x.jsx("h3",{className:"text-lg font-semibold",children:e.q}),x.jsx("div",{className:"space-y-2",children:e.a})]},t))})})]})]}),"ai"===t&&x.jsxs("section",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6 min-h-[40vh]",children:[x.jsx("h1",{className:"text-2xl font-bold mb-2",children:"AI Helper"}),x.jsx("div",{className:"prose prose-invert max-w-none",children:x.jsx("p",{className:"text-gray-300",children:"An AI helper experience will be available here to answer questions, summarize topics, and guide new players. This section is a placeholder and will be implemented in a future update."})})]}),"settings"===t&&x.jsx("div",{className:"space-y-6",children:x.jsxs("section",{className:"bg-gray-800 border border-gray-700 rounded-lg p-6",children:[x.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Application Settings"}),x.jsx("p",{className:"text-gray-300 mb-6",children:"Configure your Attrition desktop application preferences and settings."}),x.jsx("div",{className:"space-y-6",children:x.jsxs("div",{className:"bg-blue-900/30 border border-blue-600 rounded-lg p-6",children:[x.jsx("h3",{className:"text-lg font-semibold text-blue-300 mb-3",children:"ðŸš€ Automatic Updates"}),x.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[x.jsx("p",{children:x.jsx("strong",{children:"Updates are now managed by the Attrition Launcher."})}),x.jsx("p",{children:"The launcher automatically checks for updates every time you start the game and ensures you always have the latest version before allowing you to play."}),x.jsxs("p",{className:"text-blue-300",children:["ðŸ’¡ ",x.jsx("strong",{children:"No manual update checks needed!"})," The launcher handles everything automatically."]})]})]})})]})})]})},Fl=()=>{const{id:t}=he(),s=ue(),{addToast:a}=Si(),{empire:r}=ta(),[n,i]=e.useState(!0),[o,l]=e.useState(null),[c,d]=e.useState(null),[u,h]=e.useState(!0),m=async()=>{if(!t)return l("Missing fleet id"),void i(!1);try{l(null),i(!0);const e=await En.getFleet(t);e.success&&e.data?d(e.data.fleet):l(e.error||"Failed to load fleet")}catch{l("Network error while loading fleet")}finally{i(!1)}},p=()=>{m(),a({type:"info",text:"Fleet data updated"})};return e.useEffect(()=>{m()},[t]),n?x.jsx("div",{className:"game-card",children:x.jsx("div",{className:"py-10 text-center text-gray-300",children:"Loading fleetâ€¦"})}):o?x.jsx("div",{className:"space-y-6",children:x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-4",children:[x.jsx("h1",{className:"text-2xl font-bold text-empire-gold",children:"Fleet"}),x.jsx("button",{onClick:()=>s(-1),className:"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",children:"â† Back"})]}),x.jsx("div",{className:"p-3 bg-red-900/50 border border-red-700 rounded text-red-200",children:o})]})}):c?u?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-start justify-between mb-4",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl font-bold text-empire-gold",children:c.name}),x.jsxs("div",{className:"text-gray-400 font-mono",children:[c.locationCoord," ",x.jsx("span",{className:"text-gray-500",children:"â€¢"})," ","Owner: ",x.jsx("span",{className:"text-gray-300",children:c.ownerName||"â€”"})]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{onClick:()=>h(!1),className:"px-3 py-1 bg-gray-600 text-gray-200 rounded hover:bg-gray-700 text-xs",title:"Switch to legacy view",children:"Legacy View"}),x.jsx("button",{onClick:()=>s(-1),className:"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",children:"â† Back"})]})]}),x.jsx("div",{children:x.jsx(Me,{to:`/base/${encodeURIComponent(c.locationCoord)}`,className:"text-blue-300 hover:text-blue-200",children:"View Base"})})]}),x.jsx("div",{className:"game-card",children:x.jsx(Ri,{fleetId:t,empire:r||void 0,onFleetUpdate:p})})]}):x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl font-bold text-empire-gold",children:c.name}),x.jsxs("div",{className:"text-gray-400 font-mono",children:[c.locationCoord," ",x.jsx("span",{className:"text-gray-500",children:"â€¢"})," ","Owner: ",x.jsx("span",{className:"text-gray-300",children:c.ownerName||"â€”"})]}),x.jsxs("div",{className:"mt-1 text-gray-300",children:["Size: ",x.jsx("span",{className:"font-mono",children:c.sizeCredits.toLocaleString()})," credits"]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{onClick:()=>h(!0),className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs",title:"Use new fleet management interface",children:"âœ¨ New Fleet UI"}),x.jsx("button",{disabled:!0,title:"Use new Fleet UI for movement",className:"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed",children:"Move"}),x.jsx("button",{disabled:!0,title:"Coming soon",className:"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed",children:"Attack"}),x.jsx("button",{disabled:!0,title:"Coming soon",className:"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed",children:"Build Base"}),x.jsx("button",{disabled:!0,title:"Coming soon",className:"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed",children:"Rename"}),x.jsx("button",{disabled:!0,title:"Coming soon",className:"px-3 py-1 bg-gray-700 text-gray-400 rounded cursor-not-allowed",children:"Disband"}),x.jsx("button",{onClick:()=>s(-1),className:"px-3 py-1 bg-gray-700 text-gray-200 rounded hover:bg-gray-600",children:"â† Back"})]})]}),x.jsx("div",{className:"mt-2",children:x.jsx(Me,{to:`/base/${encodeURIComponent(c.locationCoord)}`,className:"text-blue-300 hover:text-blue-200",children:"View Base"})})]}),x.jsx("div",{className:"p-4 bg-green-900/30 border border-green-700 rounded",children:x.jsxs("div",{className:"text-green-200",children:[x.jsx("div",{className:"font-medium mb-1",children:"ðŸš€ Fleet Movement Now Available!"}),x.jsx("p",{className:"text-sm text-green-300 mb-2",children:'Fleet movement and deployment features are now live! Click "New Fleet UI" above to access:'}),x.jsxs("ul",{className:"text-xs text-green-300 space-y-1 ml-4",children:[x.jsx("li",{children:"â€¢ Dispatch fleets to new locations"}),x.jsx("li",{children:"â€¢ Track movement progress in real-time"}),x.jsx("li",{children:"â€¢ Recall fleets during travel"}),x.jsx("li",{children:"â€¢ View comprehensive fleet status"})]})]})}),x.jsxs("div",{className:"game-card",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-empire-gold",children:"Composition"}),x.jsx("button",{onClick:m,className:"text-xs px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Refresh"})]}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"text-gray-300",children:x.jsxs("tr",{className:"border-b border-gray-700",children:[x.jsx("th",{className:"text-left py-1 pr-4",children:"Unit"}),x.jsx("th",{className:"text-left py-1 pr-4",children:"Key"}),x.jsx("th",{className:"text-right py-1",children:"Count"})]})}),x.jsx("tbody",{className:"text-white",children:c.units&&c.units.length>0?c.units.map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800/60",children:[x.jsx("td",{className:"py-1 pr-4 text-gray-200",children:e.name||e.unitKey}),x.jsx("td",{className:"py-1 pr-4 text-gray-400 font-mono",children:e.unitKey}),x.jsx("td",{className:"py-1 text-right font-mono",children:e.count.toLocaleString()})]},`${e.unitKey}-${t}`)):x.jsx("tr",{children:x.jsx("td",{colSpan:3,className:"py-3 text-center text-gray-400",children:"No units in this fleet."})})})]})})]})]}):x.jsx("div",{className:"game-card",children:x.jsx("div",{className:"py-10 text-center text-gray-300",children:"Fleet not found."})})},$l=()=>{const{activeTab:t,inboxMessages:s,sentboxMessages:a,selectedMessage:r,isLoading:n,error:i,composeForm:o,summary:l,setActiveTab:c,setSelectedMessage:d,loadSummary:u,loadInbox:h,loadSentbox:m,clearError:p,sendMessage:y,updateComposeForm:g,clearComposeForm:f,markAllAsRead:b,deleteMessage:v}=Do(),[j,w]=e.useState(null);e.useEffect(()=>{u(),"inbox"===t?h():"sentbox"===t&&m()},[]);const N="inbox"===t?s:a,k=e=>{try{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/6e4),r=Math.floor(a/60),n=Math.floor(r/24);return a<60?a<=1?"just now":`${a} minutes ago`:r<24?1===r?"1 hour ago":`${r} hours ago`:n<7?1===n?"1 day ago":`${n} days ago`:t.toLocaleDateString()}catch{return"Unknown date"}},S=({tab:e,label:s,count:a})=>{const r=t===e;return x.jsxs("button",{onClick:()=>c(e),className:"px-4 py-2 text-sm font-medium rounded-t-lg transition-colors "+(r?"bg-blue-600 text-white border-b-2 border-blue-400":"bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600"),children:[s,"number"==typeof a&&a>0&&x.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-red-500 text-white rounded-full",children:a})]})};return x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"game-card",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h1",{className:"text-2xl font-bold",children:"Messages"}),l&&x.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-400",children:[x.jsxs("span",{children:["Total: ",l.totalMessages]}),x.jsxs("span",{children:["Unread: ",l.unreadMessages]}),"inbox"===t&&l.unreadMessages>0&&x.jsx("button",{onClick:b,className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Mark All Read"})]})]})}),x.jsxs("div",{className:"game-card p-0",children:[x.jsx("div",{className:"border-b border-gray-600",children:x.jsxs("div",{className:"flex space-x-1 p-4",children:[x.jsx(S,{tab:"inbox",label:"Inbox",count:l?.unreadMessages}),x.jsx(S,{tab:"sentbox",label:"Sentbox"}),x.jsx(S,{tab:"compose",label:"Compose"})]})}),i&&x.jsx("div",{className:"p-4 bg-red-900/30 border border-red-700 text-red-300",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{children:i}),x.jsx("button",{onClick:p,className:"text-red-400 hover:text-red-300",children:"âœ•"})]})}),x.jsxs("div",{className:"p-6",children:[("inbox"===t||"sentbox"===t)&&x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[x.jsxs("div",{className:"space-y-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"inbox"===t?"Inbox":"Sent Messages"}),n&&x.jsx("div",{className:"flex items-center justify-center py-8",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),!n&&0===N.length&&x.jsx("div",{className:"text-center py-8 text-gray-400",children:"No messages found"}),x.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.map(e=>x.jsx("div",{onClick:()=>{try{if(p(),!e||!e._id)return void console.error("Invalid message data:",e);d(e)}catch(t){console.error("Error selecting message:",t)}},className:"p-3 rounded cursor-pointer transition-colors "+(r?._id===e._id?"bg-blue-900/50 border border-blue-700":"bg-gray-800 hover:bg-gray-700"),children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("span",{className:"text-sm font-medium text-gray-200",children:"inbox"===t?e.from.username:e.to.username}),"inbox"===t&&!e.isRead&&x.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]}),x.jsx("div",{className:"text-sm text-gray-300 truncate",children:e.subject}),x.jsx("div",{className:"text-xs text-gray-500",children:k(e.createdAt)})]}),x.jsx("button",{onClick:t=>{t.stopPropagation(),(async e=>{j===e?(await v(e),w(null)):(w(e),setTimeout(()=>w(null),3e3))})(e._id)},className:"text-xs px-2 py-1 rounded "+(j===e._id?"bg-red-600 text-white":"text-gray-400 hover:text-red-400"),children:j===e._id?"Confirm":"Delete"})]})},e._id))})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Message Detail"}),r?x.jsxs("div",{className:"bg-gray-800 rounded p-4 space-y-4",children:[x.jsxs("div",{className:"border-b border-gray-600 pb-3",children:[x.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"From:"})," ",r.from.username,r.from.empireName&&x.jsxs("span",{className:"ml-1 text-gray-500",children:["(",r.from.empireName,")"]})]}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"To:"})," ",r.to.username,r.to.empireName&&x.jsxs("span",{className:"ml-1 text-gray-500",children:["(",r.to.empireName,")"]})]}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"Date:"})," ",k(r.createdAt)]})]}),x.jsx("h4",{className:"text-lg font-semibold text-gray-200 mt-2",children:r.subject})]}),x.jsx("div",{className:"text-gray-300 whitespace-pre-wrap",children:r.content}),"inbox"===t&&x.jsx("div",{className:"flex space-x-2 pt-3",children:x.jsx("button",{onClick:()=>{g({to:r.from.username,subject:`Re: ${r.subject}`,content:""}),c("compose")},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Reply"})})]}):x.jsx("div",{className:"bg-gray-800 rounded p-8 text-center text-gray-400",children:"Select a message to view details"})]})]}),"compose"===t&&x.jsxs("div",{className:"max-w-2xl",children:[x.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Compose Message"}),o.error&&x.jsx("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-700 text-red-300 rounded",children:o.error}),x.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o.to.trim()&&o.subject.trim()&&o.content.trim()?await y({toUsername:o.to.trim(),subject:o.subject.trim(),content:o.content.trim()}):g({error:"Please fill in all fields"})},className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"to",className:"block text-sm font-medium text-gray-300 mb-2",children:"To (Username)"}),x.jsx("input",{type:"text",id:"to",value:o.to,onChange:e=>g({to:e.target.value}),placeholder:"Enter recipient username",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o.isSending})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"subject",className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),x.jsx("input",{type:"text",id:"subject",value:o.subject,onChange:e=>g({subject:e.target.value}),placeholder:"Enter message subject",className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o.isSending})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),x.jsx("textarea",{id:"content",value:o.content,onChange:e=>g({content:e.target.value}),placeholder:"Enter your message...",rows:8,className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o.isSending})]}),x.jsxs("div",{className:"flex space-x-3",children:[x.jsx("button",{type:"submit",disabled:o.isSending,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o.isSending?"Sending...":"Send Message"}),x.jsx("button",{type:"button",onClick:f,disabled:o.isSending,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Clear"})]})]})]})]})]})]})},Ll=[1,6,24,168];const ql=()=>{const[t,s]=e.useState(24),[a,r]=e.useState(!1),[n,i]=e.useState(null),[o,l]=e.useState(null),[c,d]=e.useState([]),[u,h]=e.useState([]),m="undefined"!=typeof window&&!!window.desktop?.perf,p=e.useCallback(async e=>{if(m){r(!0),i(null);try{const t=await window.desktop.perf.getStats(e);t.success?l(t.stats||null):(i(t.error||"Failed to load stats"),l(null))}catch(Vl){console.error("perf:getStats failed",Vl),i(Vl?.message||"Failed to load stats"),l(null)}finally{r(!1)}}},[m]);e.useEffect(()=>{m&&p(t)},[t,m,p]);const y=e.useCallback(async()=>{if(m)try{const e=await window.desktop.perf.getThresholds();e.success&&d(e.thresholds||[])}catch(Vl){}},[m]),g=e.useCallback(async e=>{if(m)try{const t=await window.desktop.perf.getThresholdBreaches(e);t.success&&h(t.breaches||[])}catch(Vl){}},[m]);e.useEffect(()=>{m&&(y(),g(t))},[m,t,y,g]);const f=async e=>{if(m)try{const s=await window.desktop.perf.export(e,t);if(s.success&&"string"==typeof s.data){const a=`sync_performance_${t}h.${"json"===e?"json":"csv"}`;!function(e,t,s){try{const a=new Blob([e],{type:s}),r=URL.createObjectURL(a),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(r)}catch(Jl){console.error("Download failed:",Jl)}}(s.data,a,"json"===e?"application/json":"text/csv")}else alert(`Export failed: ${s.error||"unknown error"}`)}catch(Vl){alert(`Export failed: ${Vl?.message||"exception"}`)}};if(!m)return x.jsx("div",{className:"p-6",children:x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Performance Monitoring"}),x.jsx("p",{className:"text-gray-400",children:"Desktop-only feature. Launch the Electron desktop app to view sync performance metrics."})]})});const b=o?.operationsByType?Object.entries(o.operationsByType):[];return x.jsxs("div",{className:"p-6 space-y-6",children:[x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h2",{className:"text-xl font-semibold",children:"Performance Monitoring"}),x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("label",{className:"text-sm text-gray-300",children:"Window:"}),x.jsx("select",{className:"bg-gray-700 text-white text-sm px-2 py-1 rounded",value:t,onChange:e=>s(Number(e.target.value)),disabled:a,children:Ll.map(e=>x.jsxs("option",{value:e,children:[e,"h"]},e))}),x.jsx("button",{onClick:()=>f("json"),className:"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:a,children:"Export JSON"}),x.jsx("button",{onClick:()=>f("csv"),className:"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",disabled:a,children:"Export CSV"}),x.jsx("button",{onClick:async()=>{if(!m)return;if(window.confirm("Clear stored performance metrics now? This cannot be undone."))try{const e=await window.desktop.perf.clear();e.success?p(t):alert(`Clear failed: ${e.error||"unknown error"}`)}catch(Vl){alert(`Clear failed: ${Vl?.message||"exception"}`)}},className:"text-sm px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",disabled:a,children:"Clear"})]})]}),a&&x.jsx("div",{className:"text-gray-400 mt-3",children:"Loading..."}),n&&x.jsxs("div",{className:"text-red-400 mt-3",children:["Error: ",n]})]}),o&&x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("div",{className:"text-gray-400 text-sm",children:"Success Rate"}),x.jsxs("div",{className:"text-2xl font-bold",children:[(o.successRate??0).toFixed(1),"%"]})]}),x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("div",{className:"text-gray-400 text-sm",children:"Avg / Median"}),x.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(o.averageDurationMs??0),"ms",x.jsxs("span",{className:"text-gray-400 text-base ml-2",children:["(",Math.round(o.medianDurationMs??0),"ms)"]})]})]}),x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("div",{className:"text-gray-400 text-sm",children:"P95 / P99"}),x.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(o.p95DurationMs??0),"ms",x.jsxs("span",{className:"text-gray-400 text-base ml-2",children:["(",Math.round(o.p99DurationMs??0),"ms)"]})]})]}),x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("div",{className:"text-gray-400 text-sm",children:"Throughput"}),x.jsxs("div",{className:"text-2xl font-bold",children:[(o.throughput?.operationsPerMinute??0).toFixed(1)," ops/min"]}),x.jsxs("div",{className:"text-gray-400 text-sm",children:[(o.throughput?.bytesPerSecond??0).toFixed(0)," B/s"]})]}),x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("div",{className:"text-gray-400 text-sm",children:"Total Operations"}),x.jsx("div",{className:"text-2xl font-bold",children:o.totalOperations??0})]})]}),b.length>0&&x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Operations Breakdown"}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-left text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 pr-4",children:"Operation"}),x.jsx("th",{className:"py-2 pr-4",children:"Count"}),x.jsx("th",{className:"py-2 pr-4",children:"Success"}),x.jsx("th",{className:"py-2 pr-4",children:"Avg (ms)"}),x.jsx("th",{className:"py-2 pr-4",children:"p95 (ms)"}),x.jsx("th",{className:"py-2 pr-4",children:"p99 (ms)"})]})}),x.jsx("tbody",{children:b.map(([e,t])=>x.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-750/50",children:[x.jsx("td",{className:"py-2 pr-4",children:e}),x.jsx("td",{className:"py-2 pr-4",children:t.count??0}),x.jsxs("td",{className:"py-2 pr-4",children:[(t.successRate??0).toFixed(1),"%"]}),x.jsx("td",{className:"py-2 pr-4",children:Math.round(t.avgDuration??0)}),x.jsx("td",{className:"py-2 pr-4",children:Math.round(t.p95DurationMs??0)}),x.jsx("td",{className:"py-2 pr-4",children:Math.round(t.p99DurationMs??0)})]},e))})]})})]}),o?.errorDistribution&&Object.keys(o.errorDistribution).length>0&&x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Error Distribution"}),x.jsx("ul",{className:"list-disc ml-6 text-sm text-gray-300",children:Object.entries(o.errorDistribution).map(([e,t])=>x.jsxs("li",{className:"mb-1",children:[x.jsxs("span",{className:"text-gray-400",children:[e,":"]})," ",t]},e))})]}),x.jsx(Ul,{hours:t,thresholds:c,breaches:u,onChange:d,onReload:()=>{y(),g(t)}})]})},Ul=({hours:t,thresholds:s,breaches:a,onChange:r,onReload:n})=>{const[i,o]=e.useState(!1),l=(e,t)=>{const a=[...s];a[e]={...a[e]||{},...t},r(a)};return x.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded p-4",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h3",{className:"text-lg font-semibold",children:"Thresholds & Breaches"}),x.jsxs("div",{className:"text-sm text-gray-300",children:["Window: ",x.jsxs("span",{className:"font-mono",children:[t,"h"]})]})]}),a.length>0?x.jsxs("div",{className:"mb-4 p-3 rounded bg-yellow-900/40 border border-yellow-700 text-yellow-300",children:[x.jsxs("div",{className:"font-medium mb-1",children:["Active Breaches (",a.length,")"]}),x.jsx("ul",{className:"list-disc ml-6",children:a.map((e,t)=>x.jsxs("li",{children:[x.jsx("span",{className:"font-mono",children:e.op??"GLOBAL"})," ",e.metric," = ",Math.round(e.value)," ",">"," ",Math.round(e.threshold)]},`${e.metric}-${e.op??"global"}-${t}`))})]}):x.jsx("div",{className:"mb-4 p-3 rounded bg-green-900/30 border border-green-700 text-green-300",children:"No threshold breaches detected."}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{children:x.jsxs("tr",{className:"text-left text-gray-300 border-b border-gray-700",children:[x.jsx("th",{className:"py-2 pr-4",children:"Operation (optional)"}),x.jsx("th",{className:"py-2 pr-4",children:"p95 (ms)"}),x.jsx("th",{className:"py-2 pr-4",children:"Fail Rate (%)"}),x.jsx("th",{className:"py-2 pr-4"})]})}),x.jsx("tbody",{children:(s||[]).map((e,t)=>x.jsxs("tr",{className:"border-b border-gray-800",children:[x.jsx("td",{className:"py-2 pr-4",children:x.jsx("input",{className:"bg-gray-700 text-white text-sm px-2 py-1 rounded w-full",placeholder:"e.g., flush_structures (leave blank for GLOBAL)",value:e.op??"",onChange:e=>l(t,{op:e.target.value})})}),x.jsx("td",{className:"py-2 pr-4",children:x.jsx("input",{className:"bg-gray-700 text-white text-sm px-2 py-1 rounded w-28",type:"number",min:0,step:1,value:e.p95Ms??"",onChange:e=>l(t,{p95Ms:""===e.target.value?void 0:Number(e.target.value)})})}),x.jsx("td",{className:"py-2 pr-4",children:x.jsx("input",{className:"bg-gray-700 text-white text-sm px-2 py-1 rounded w-28",type:"number",min:0,max:100,step:.1,value:e.failRatePct??"",onChange:e=>l(t,{failRatePct:""===e.target.value?void 0:Number(e.target.value)})})}),x.jsx("td",{className:"py-2 pr-4",children:x.jsx("button",{onClick:()=>(e=>{const t=[...s];t.splice(e,1),r(t)})(t),className:"text-sm px-2 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Remove"})})]},t))})]})}),x.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[x.jsx("button",{onClick:()=>{r([...s||[],{op:"",p95Ms:void 0,failRatePct:void 0}])},className:"text-sm px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Add Threshold"}),x.jsx("button",{onClick:async()=>{if(window.desktop?.perf?.setThresholds){o(!0);try{const e=(s||[]).map(e=>({op:(e.op||"")?.trim()||void 0,p95Ms:"number"!=typeof e.p95Ms||Number.isNaN(e.p95Ms)?void 0:e.p95Ms,failRatePct:"number"!=typeof e.failRatePct||Number.isNaN(e.failRatePct)?void 0:e.failRatePct}));(await window.desktop.perf.setThresholds(e)).success?n():alert("Failed to save thresholds")}catch(Vl){alert(`Save failed: ${Vl?.message||"exception"}`)}finally{o(!1)}}},className:"text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",disabled:i,children:i?"Savingâ€¦":"Save Thresholds"}),x.jsx("button",{onClick:n,className:"text-sm px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Reload"})]})]})},Dl=e.createContext(void 0),Wl="undefined"!=typeof window&&window.desktop?.updater,Bl=({children:t})=>{const[s,a]=e.useState({updateAvailable:!1,updateDownloaded:!1,checkingForUpdate:!1,autoCheckEnabled:!0});e.useEffect(()=>{if(!Wl)return;const e=window.desktop;let t=null;try{t=e.updater.onUpdateEvent(e=>{const{type:t,data:s}=e;switch(console.log("[UpdateContext] Received update event:",{type:t,data:s}),t){case"update-checking":a(e=>({...e,checkingForUpdate:!0,error:void 0}));break;case"update-available":a(e=>({...e,checkingForUpdate:!1,updateAvailable:!0,updateInfo:{version:s.version,releaseDate:s.releaseDate,releaseNotes:s.releaseNotes}}));break;case"update-not-available":a(e=>({...e,checkingForUpdate:!1,lastChecked:new Date}));break;case"update-download-progress":a(e=>({...e,downloadProgress:{percent:s.percent,transferred:s.transferred,total:s.total,bytesPerSecond:s.bytesPerSecond}}));break;case"update-downloaded":a(e=>({...e,updateDownloaded:!0,downloadProgress:void 0}));break;case"update-error":a(e=>({...e,checkingForUpdate:!1,error:s.message,downloadProgress:void 0}));break;case"update-restart-later":a(e=>({...e,downloadProgress:void 0}));break;default:console.warn("[UpdateContext] Unknown update event:",t,s)}})}catch(s){console.error("[UpdateContext] Failed to setup update event listener:",s)}return()=>{t&&t()}},[]),e.useEffect(()=>{if(!Wl)return void console.log("[UpdateContext] Not desktop environment, skipping status load");(async()=>{try{console.log("[UpdateContext] Loading initial update status...");const e=window.desktop,t=await e.updater.getStatus();console.log("[UpdateContext] Initial status response:",t),t.success?(console.log("[UpdateContext] Setting initial state from status:",t.status),a(e=>({...e,updateAvailable:t.status.updateAvailable,updateDownloaded:t.status.updateDownloaded,checkingForUpdate:t.status.checkingForUpdate,downloadProgress:t.status.downloadProgress}))):console.warn("[UpdateContext] Initial status load failed:",t.error)}catch(e){console.error("[UpdateContext] Failed to load initial update status:",e)}})()},[]);const r=e.useCallback(async()=>{if(console.log("[UpdateContext] checkForUpdates called",{isDesktop:Wl}),Wl)try{const e=window.desktop;console.log("[UpdateContext] Calling desktop.updater.checkForUpdates()");const t=await e.updater.checkForUpdates();console.log("[UpdateContext] checkForUpdates response:",t),t.success?console.log("[UpdateContext] checkForUpdates succeeded"):(console.warn("[UpdateContext] checkForUpdates failed:",t.error),a(e=>({...e,error:t.error})))}catch(e){console.error("[UpdateContext] Check for updates failed:",e),a(t=>({...t,error:e instanceof Error?e.message:"Unknown error",checkingForUpdate:!1}))}else console.warn("[UpdateContext] checkForUpdates called in non-desktop environment")},[]),n=e.useCallback(async()=>{if(Wl&&s.updateAvailable)try{const e=window.desktop,t=await e.updater.downloadUpdate();t.success||a(e=>({...e,error:t.error}))}catch(e){console.error("[UpdateContext] Download update failed:",e),a(t=>({...t,error:e instanceof Error?e.message:"Unknown error"}))}},[s.updateAvailable]),i=e.useCallback(async()=>{if(Wl&&s.updateDownloaded)try{const e=window.desktop,t=await e.updater.installUpdate();t.success||a(e=>({...e,error:t.error}))}catch(e){console.error("[UpdateContext] Install update failed:",e),a(t=>({...t,error:e instanceof Error?e.message:"Unknown error"}))}},[s.updateDownloaded]),o=e.useCallback(()=>{a(e=>({...e,updateAvailable:!1,updateInfo:void 0,downloadProgress:void 0,error:void 0}))},[]),l=e.useCallback(e=>{a(t=>({...t,autoCheckEnabled:e})),localStorage.setItem("autoUpdateCheck",e.toString())},[]);e.useEffect(()=>{const e=localStorage.getItem("autoUpdateCheck");null!==e&&a(t=>({...t,autoCheckEnabled:"true"===e}))},[]);const c=e.useMemo(()=>({state:s,checkForUpdates:r,downloadUpdate:n,installUpdate:i,dismissUpdate:o,setAutoCheck:l}),[s,r,n,i,o,l]);return x.jsx(Dl.Provider,{value:c,children:t})},zl=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},Hl=()=>{const{status:t}=ia(),{addToast:s}=Si(),a=e.useRef(t.state),r=e.useRef(t.queuedCount),n=e.useRef(t.lastRunAt);return e.useEffect(()=>{const e=a.current;if("error"===t.state&&"error"!==e){const e=t.lastError?String(t.lastError):"Sync error";s({type:"error",text:e,durationMs:4e3})}if("syncing"===e&&"idle"===t.state){const e=r.current||0,a="number"==typeof t.lastRunAt&&t.lastRunAt!==n.current;let i="Sync complete";if(e>0?i=`Synced ${e} ${1===e?"action":"actions"}`:a&&(i="Sync up to date"),"number"==typeof t.lastDurationMs&&t.lastDurationMs>=0){i+=` (${Math.max(.1,Math.round(t.lastDurationMs/100)/10)}s)`}s({type:"success",text:i,durationMs:3e3})}a.current=t.state,r.current=t.queuedCount,n.current=t.lastRunAt},[t,s]),null},Zl=()=>{const{state:t,downloadUpdate:s,installUpdate:a,dismissUpdate:r,checkForUpdates:n}=(()=>{const t=e.useContext(Dl);if(!t)throw new Error("useUpdate must be used within an UpdateProvider");return t})(),{addToast:i}=Si(),[o,l]=e.useState(!1);if(!(t.updateAvailable||t.checkingForUpdate||t.downloadProgress||t.updateDownloaded))return null;const c=async()=>{try{await s(),i({type:"info",text:"Update download started..."})}catch(e){i({type:"error",text:`Failed to start download: ${e instanceof Error?e.message:"Unknown error"}`})}},d=async()=>{try{await a(),i({type:"info",text:"Installing update and restarting..."})}catch(e){i({type:"error",text:`Failed to install update: ${e instanceof Error?e.message:"Unknown error"}`})}},u=()=>{r(),i({type:"info",text:"Update dismissed. You can check for updates later in settings."})};if(t.checkingForUpdate&&!t.updateAvailable)return x.jsx("div",{className:"fixed top-16 right-4 z-40 bg-gray-800/95 border border-gray-600 rounded-lg shadow-xl p-4 max-w-sm",children:x.jsxs("div",{className:"flex items-center space-x-3",children:[x.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-400"}),x.jsx("span",{className:"text-gray-200",children:"Checking for updates..."})]})});if(t.error)return x.jsx("div",{className:"fixed top-16 right-4 z-40 bg-red-900/90 border border-red-600 rounded-lg shadow-xl p-4 max-w-sm",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx("div",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-red-400 mt-0.5"}),x.jsxs("div",{className:"flex-1",children:[x.jsx("h4",{className:"font-medium text-red-100",children:"Update Error"}),x.jsx("p",{className:"text-sm text-red-200 mt-1",children:t.error}),x.jsxs("div",{className:"flex space-x-2 mt-3",children:[x.jsx("button",{onClick:()=>n(),className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-500 text-white rounded transition-colors",children:"Retry"}),x.jsx("button",{onClick:u,className:"px-3 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors",children:"Dismiss"})]})]})]})});if(t.downloadProgress){const e=t.downloadProgress,s=Math.round(e.percent);return o?x.jsx("div",{className:"fixed top-16 right-4 z-40 bg-blue-900/90 border border-blue-600 rounded-lg shadow-xl p-3",children:x.jsxs("div",{className:"flex items-center space-x-3",children:[x.jsx("div",{className:"w-4 h-4 bg-blue-600 rounded",children:x.jsx("div",{className:"h-full bg-blue-400 rounded transition-all duration-300",style:{width:`${s}%`}})}),x.jsxs("span",{className:"text-blue-100 text-sm",children:[s,"%"]}),x.jsx("button",{onClick:()=>l(!1),className:"text-blue-300 hover:text-blue-100 text-sm",title:"Expand",children:"â†—"})]})}):x.jsxs("div",{className:"fixed top-16 right-4 z-40 bg-blue-900/90 border border-blue-600 rounded-lg shadow-xl p-4 max-w-sm",children:[x.jsxs("div",{className:"flex items-start justify-between mb-2",children:[x.jsx("h4",{className:"font-medium text-blue-100",children:"Downloading Update"}),x.jsx("button",{onClick:()=>l(!0),className:"text-blue-300 hover:text-blue-100 text-sm",title:"Minimize",children:"âˆ’"})]}),x.jsx("div",{className:"w-full bg-blue-800 rounded-full h-2.5 mb-2",children:x.jsx("div",{className:"bg-blue-400 h-2.5 rounded-full transition-all duration-300",style:{width:`${s}%`}})}),x.jsxs("div",{className:"flex justify-between text-sm text-blue-200 mb-2",children:[x.jsxs("span",{children:[s,"%"]}),x.jsxs("span",{children:[zl(e.transferred)," / ",zl(e.total)]})]}),x.jsx("div",{className:"text-xs text-blue-300",children:(h=e.bytesPerSecond,zl(h)+"/s")})]})}var h;return t.updateDownloaded?x.jsx("div",{className:"fixed top-16 right-4 z-40 bg-green-900/90 border border-green-600 rounded-lg shadow-xl p-4 max-w-sm",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx("div",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-green-400 mt-0.5"}),x.jsxs("div",{className:"flex-1",children:[x.jsx("h4",{className:"font-medium text-green-100",children:"Update Ready!"}),x.jsxs("p",{className:"text-sm text-green-200 mt-1",children:[t.updateInfo?.version&&`Version ${t.updateInfo.version} `,"has been downloaded and is ready to install."]}),x.jsxs("div",{className:"flex space-x-2 mt-3",children:[x.jsx("button",{onClick:d,className:"px-3 py-1 text-sm bg-green-600 hover:bg-green-500 text-white rounded transition-colors font-medium",children:"Restart & Install"}),x.jsx("button",{onClick:u,className:"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors",children:"Later"})]})]})]})}):t.updateAvailable?x.jsx("div",{className:"fixed top-16 right-4 z-40 bg-orange-900/90 border border-orange-600 rounded-lg shadow-xl p-4 max-w-sm",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx("div",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-orange-400 mt-0.5"}),x.jsxs("div",{className:"flex-1",children:[x.jsx("h4",{className:"font-medium text-orange-100",children:"Update Available"}),t.updateInfo&&x.jsxs("div",{className:"text-sm text-orange-200 mt-1",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Version:"})," ",t.updateInfo.version]}),t.updateInfo.releaseDate&&x.jsxs("p",{children:[x.jsx("strong",{children:"Released:"})," ",new Date(t.updateInfo.releaseDate).toLocaleDateString()]})]}),t.updateInfo?.releaseNotes&&x.jsxs("details",{className:"mt-2",children:[x.jsx("summary",{className:"text-xs text-orange-300 cursor-pointer hover:text-orange-100",children:"What's New"}),x.jsx("div",{className:"mt-1 text-xs text-orange-200 max-h-32 overflow-y-auto",children:t.updateInfo.releaseNotes})]}),x.jsxs("div",{className:"flex space-x-2 mt-3",children:[x.jsx("button",{onClick:c,className:"px-3 py-1 text-sm bg-orange-600 hover:bg-orange-500 text-white rounded transition-colors font-medium",children:"Download"}),x.jsx("button",{onClick:u,className:"px-3 py-1 text-sm bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors",children:"Skip"})]})]})]})}):null},Gl=()=>{const[t,s]=e.useState([]);e.useEffect(()=>{const e=Xs();if(!e)return;const t=e=>{const t=`toast-${e._id}-${Date.now()}`,a={id:t,message:e,timestamp:Date.now()};s(e=>[...e,a]),setTimeout(()=>{s(e=>e.filter(e=>e.id!==t))},5e3)};return e.on("message:new",t),()=>{e.off("message:new",t)}},[]);const a=e=>{s(t=>t.filter(t=>t.id!==e))};return 0===t.length?null:x.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(e=>x.jsx("div",{className:"bg-blue-600 border border-blue-500 text-white p-4 rounded-lg shadow-lg max-w-sm animate-pulse",children:x.jsx("div",{className:"flex items-start justify-between",children:x.jsxs("div",{className:"flex-1",children:[x.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[x.jsx("span",{className:"text-sm font-medium",children:"ðŸ“§ New Message"}),x.jsx("button",{onClick:()=>a(e.id),className:"text-blue-200 hover:text-white text-lg leading-none",children:"Ã—"})]}),x.jsxs("div",{className:"text-sm",children:[x.jsxs("div",{className:"font-medium mb-1",children:["From: ",e.message.from.username]}),x.jsx("div",{className:"text-blue-100 truncate",children:e.message.subject})]}),x.jsx("div",{className:"mt-3",children:x.jsx(Me,{to:"/messages",onClick:()=>a(e.id),className:"inline-block px-3 py-1 bg-blue-700 hover:bg-blue-800 text-white text-xs rounded transition-colors",children:"View Messages"})})]})})},e.id))})},Kl="undefined"!=typeof window&&(window.desktop||"file:"===window.location.protocol)?function(t){let{basename:s,children:a,future:r,window:n}=t,i=e.useRef();var o;null==i.current&&(i.current=(void 0===(o={window:n,v5Compat:!0})&&(o={}),P(function(e,t){let{pathname:s="/",search:a="",hash:r=""}=C(e.location.hash.substr(1));return s.startsWith("/")||s.startsWith(".")||(s="/"+s),S("",{pathname:s,search:a,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){let s=e.document.querySelector("base"),a="";if(s&&s.getAttribute("href")){let t=e.location.href,s=t.indexOf("#");a=-1===s?t:t.slice(0,s)}return a+"#"+("string"==typeof t?t:_(t))},function(e,t){N("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")},o)));let l=i.current,[c,d]=e.useState({action:l.action,location:l.location}),{v7_startTransition:u}=r||{},h=e.useCallback(e=>{u&&Ee?Ee(()=>d(e)):d(e)},[d,u]);return e.useLayoutEffect(()=>l.listen(h),[l,h]),e.useEffect(()=>Ne(r),[r]),e.createElement(_e,{basename:s,children:a,location:c.location,navigationType:c.action,navigator:l,future:r})}:function(t){let{basename:s,children:a,future:r,window:n}=t,i=e.useRef();var o;null==i.current&&(i.current=(void 0===(o={window:n,v5Compat:!0})&&(o={}),P(function(e,t){let{pathname:s,search:a,hash:r}=e.location;return S("",{pathname:s,search:a,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:_(t)},null,o)));let l=i.current,[c,d]=e.useState({action:l.action,location:l.location}),{v7_startTransition:u}=r||{},h=e.useCallback(e=>{u&&Ee?Ee(()=>d(e)):d(e)},[d,u]);return e.useLayoutEffect(()=>l.listen(h),[l,h]),e.useEffect(()=>Ne(r),[r]),e.createElement(_e,{basename:s,children:a,location:c.location,navigationType:c.action,navigator:l,future:r})};function Yl(){const t=ta(e=>e.getIsAuthed()),s=ta(e=>e.isLoading),a=t?{}:null;return e.useEffect(()=>{const e=()=>{try{ta.getState().unauthorize()}catch{}};return window.addEventListener("auth:unauthorized",e),()=>{window.removeEventListener("auth:unauthorized",e)}},[]),s?x.jsx("div",{className:"game-container flex items-center justify-center",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),x.jsx("p",{className:"mt-4 text-lg",children:"Loading Attrition..."})]})}):x.jsx(ra,{children:x.jsx(_i,{children:x.jsx(Bl,{children:x.jsx(oa,{children:x.jsxs(Kl,{children:[x.jsx(la,{}),x.jsx(Ci,{}),x.jsx(Zl,{}),x.jsx(Hl,{}),x.jsx(Gl,{}),x.jsx("div",{className:"game-container",children:x.jsxs(Ce,{children:[x.jsx(Se,{path:"/login",element:a?x.jsx(ke,{to:"/dashboard",replace:!0}):x.jsx(da,{})}),x.jsx(Se,{path:"/register",element:a?x.jsx(ke,{to:"/dashboard",replace:!0}):x.jsx(ua,{})}),x.jsx(Se,{path:"/dashboard",element:a?x.jsx(Wo,{children:x.jsx(Io,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/galaxy",element:a?x.jsx(Wo,{children:x.jsx(zo,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/bases",element:a?x.jsx(Wo,{children:x.jsx(Pl,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/help",element:a?x.jsx(Wo,{children:x.jsx(Ml,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/planet/:coord",element:a?x.jsx(Wo,{children:x.jsx(Ho,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/base/:coord",element:a?x.jsx(Wo,{children:x.jsx(El,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/fleets/:id",element:a?x.jsx(Wo,{children:x.jsx(Fl,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/messages",element:a?x.jsx(Wo,{children:x.jsx($l,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/admin/performance",element:a?x.jsx(Wo,{children:x.jsx(ql,{})}):x.jsx(ke,{to:"/login",replace:!0})}),x.jsx(Se,{path:"/",element:x.jsx(ke,{to:a?"/dashboard":"/login",replace:!0})}),x.jsx(Se,{path:"*",element:x.jsx(ke,{to:a?"/dashboard":"/login",replace:!0})})]})})]})})})})})}f.createRoot(document.getElementById("root")).render(x.jsx(a.StrictMode,{children:x.jsx(Yl,{})}));
//# sourceMappingURL=index-DX1_SPab.js.map

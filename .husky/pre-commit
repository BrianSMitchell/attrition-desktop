#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit quality checks..."
echo "============================================="

# Run ESLint with Attrition plugin
echo "ğŸ“‹ Running ESLint quality checks..."
cd packages/server

# Check if ESLint passes
if npx eslint . --ext .js,.ts --config .eslintrc.js --max-warnings 0; then
    echo "âœ… ESLint checks passed!"
else
    echo ""
    echo "âŒ COMMIT BLOCKED: ESLint violations found!"
    echo ""
    echo "ğŸš« Your commit has been blocked due to code quality violations."
    echo ""
    echo "Common issues that may have been detected:"
    echo "â€¢ Excessive console.log statements"
    echo "â€¢ Functions exceeding complexity limits"
    echo "â€¢ Inconsistent ID patterns (ObjectId vs UUID)"
    echo "â€¢ Legacy database operations"
    echo "â€¢ Missing service layer abstractions"
    echo ""
    echo "How to fix:"
    echo "1. Review the ESLint errors above for specific locations"
    echo "2. Use VS Code ESLint extension for real-time feedback"
    echo "3. Run 'npm run lint:fix' to auto-fix many issues"
    echo "4. Fix remaining issues manually"
    echo "5. Stage your changes and try committing again"
    echo ""
    echo "ğŸ’¡ Tip: Use the VS Code ESLint extension for immediate feedback"
    echo "   as you type, preventing these issues before commit."
    exit 1
fi

echo ""
echo "ğŸ¯ Running additional quality checks..."

# Check for other quality metrics if needed
# Add more quality checks here as needed

echo "âœ… All quality checks passed!"
echo "ğŸš€ Proceeding with commit..."
echo ""